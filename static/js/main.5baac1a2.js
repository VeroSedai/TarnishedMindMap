/*! For license information please see main.5baac1a2.js.LICENSE.txt */
(()=>{var t={4630:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Headers:()=>o,Request:()=>a,Response:()=>l,default:()=>s,fetch:()=>i});var r=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("unable to locate global object")}();const i=r.fetch,s=r.fetch.bind(r),o=r.Headers,a=r.Request,l=r.Response},9286:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(n(4630)),s=r(n(2611));e.default=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:"undefined"===typeof fetch?this.fetch=i.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=Object.assign({},this.headers),this.headers[t]=e,this}then(t,e){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let n=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async t=>{var e,n,r;let i=null,o=null,a=null,l=t.status,c=t.statusText;if(t.ok){if("HEAD"!==this.method){const e=await t.text();""===e||(o="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?e:JSON.parse(e))}const r=null===(e=this.headers.Prefer)||void 0===e?void 0:e.match(/count=(exact|planned|estimated)/),s=null===(n=t.headers.get("content-range"))||void 0===n?void 0:n.split("/");r&&s&&s.length>1&&(a=parseInt(s[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(i={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,a=null,l=406,c="Not Acceptable"):o=1===o.length?o[0]:null)}else{const e=await t.text();try{i=JSON.parse(e),Array.isArray(i)&&404===t.status&&(o=[],i=null,l=200,c="OK")}catch(u){404===t.status&&""===e?(l=204,c="No Content"):i={message:e}}if(i&&this.isMaybeSingle&&(null===(r=null===i||void 0===i?void 0:i.details)||void 0===r?void 0:r.includes("0 rows"))&&(i=null,l=200,c="OK"),i&&this.shouldThrowOnError)throw new s.default(i)}return{error:i,data:o,count:a,status:l,statusText:c}}));return this.shouldThrowOnError||(n=n.catch((t=>{var e,n,r;return{error:{message:`${null!==(e=null===t||void 0===t?void 0:t.name)&&void 0!==e?e:"FetchError"}: ${null===t||void 0===t?void 0:t.message}`,details:`${null!==(n=null===t||void 0===t?void 0:t.stack)&&void 0!==n?n:""}`,hint:"",code:`${null!==(r=null===t||void 0===t?void 0:t.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}}))),n.then(t,e)}}},1210:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(n(8829)),s=r(n(5736)),o=n(5745);class a{constructor(t){let{headers:e={},schema:n,fetch:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=t,this.headers=Object.assign(Object.assign({},o.DEFAULT_HEADERS),e),this.schemaName=n,this.fetch=r}from(t){const e=new URL(`${this.url}/${t}`);return new i.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new a(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{head:r=!1,get:i=!1,count:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=new URL(`${this.url}/rpc/${t}`);let l;r||i?(e=r?"HEAD":"GET",Object.entries(n).filter((t=>{let[e,n]=t;return void 0!==n})).map((t=>{let[e,n]=t;return[e,Array.isArray(n)?`{${n.join(",")}}`:`${n}`]})).forEach((t=>{let[e,n]=t;a.searchParams.append(e,n)}))):(e="POST",l=n);const c=Object.assign({},this.headers);return o&&(c.Prefer=`count=${o}`),new s.default({method:e,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}e.default=a},2611:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}e.default=n},5736:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(n(7374));class s extends i.default{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map((t=>"string"===typeof t&&new RegExp("[,()]").test(t)?`"${t}"`:`${t}`)).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}contains(t,e){return"string"===typeof e?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return"string"===typeof e?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return"string"===typeof e?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e){let{config:n,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i="";"plain"===r?i="pl":"phrase"===r?i="ph":"websearch"===r&&(i="w");const s=void 0===n?"":`(${n})`;return this.url.searchParams.append(t,`${i}fts${s}.${e}`),this}match(t){return Object.entries(t).forEach((t=>{let[e,n]=t;this.url.searchParams.append(e,`eq.${n}`)})),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t){let{foreignTable:e,referencedTable:n=e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}}e.default=s},8829:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(n(5736));e.default=class{constructor(t,e){let{headers:n={},schema:r,fetch:i}=e;this.url=t,this.headers=n,this.schema=r,this.fetch=i}select(t){let{head:e=!1,count:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e?"HEAD":"GET";let s=!1;const o=(null!==t&&void 0!==t?t:"*").split("").map((t=>/\s/.test(t)&&!s?"":('"'===t&&(s=!s),t))).join("");return this.url.searchParams.set("select",o),n&&(this.headers.Prefer=`count=${n}`),new i.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t){let{count:e,defaultToNull:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),e&&r.push(`count=${e}`),n||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(t)){const e=t.reduce(((t,e)=>t.concat(Object.keys(e))),[]);if(e.length>0){const t=[...new Set(e)].map((t=>`"${t}"`));this.url.searchParams.set("columns",t.join(","))}}return new i.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t){let{onConflict:e,ignoreDuplicates:n=!1,count:r,defaultToNull:s=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=[`resolution=${n?"ignore":"merge"}-duplicates`];if(void 0!==e&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&o.push(this.headers.Prefer),r&&o.push(`count=${r}`),s||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(t)){const e=t.reduce(((t,e)=>t.concat(Object.keys(e))),[]);if(e.length>0){const t=[...new Set(e)].map((t=>`"${t}"`));this.url.searchParams.set("columns",t.join(","))}}return new i.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t){let{count:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),e&&n.push(`count=${e}`),this.headers.Prefer=n.join(","),new i.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete(){let{count:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=[];return t&&e.push(`count=${t}`),this.headers.Prefer&&e.unshift(this.headers.Prefer),this.headers.Prefer=e.join(","),new i.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}},7374:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(n(9286));class s extends i.default{select(t){let e=!1;const n=(null!==t&&void 0!==t?t:"*").split("").map((t=>/\s/.test(t)&&!e?"":('"'===t&&(e=!e),t))).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t){let{ascending:e=!0,nullsFirst:n,foreignTable:r,referencedTable:i=r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=i?`${i}.order`:"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${void 0===n?"":n?".nullsfirst":".nullslast"}`),this}limit(t){let{foreignTable:e,referencedTable:n=e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r="undefined"===typeof n?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e){let{foreignTable:n,referencedTable:r=n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i="undefined"===typeof r?"offset":`${r}.offset`,s="undefined"===typeof r?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${t}`),this.url.searchParams.set(s,""+(e-t+1)),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain(){let{analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:r=!1,wal:i=!1,format:s="text"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var o;const a=[t?"analyze":null,e?"verbose":null,n?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${s}; for="${l}"; options=${a};`,this}rollback(){var t;return(null!==(t=this.headers.Prefer)&&void 0!==t?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}e.default=s},5745:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_HEADERS=void 0;const r=n(400);e.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${r.version}`}},7980:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.PostgrestError=e.PostgrestBuilder=e.PostgrestTransformBuilder=e.PostgrestFilterBuilder=e.PostgrestQueryBuilder=e.PostgrestClient=void 0;const i=r(n(1210));e.PostgrestClient=i.default;const s=r(n(8829));e.PostgrestQueryBuilder=s.default;const o=r(n(5736));e.PostgrestFilterBuilder=o.default;const a=r(n(7374));e.PostgrestTransformBuilder=a.default;const l=r(n(9286));e.PostgrestBuilder=l.default;const c=r(n(2611));e.PostgrestError=c.default,e.default={PostgrestClient:i.default,PostgrestQueryBuilder:s.default,PostgrestFilterBuilder:o.default,PostgrestTransformBuilder:a.default,PostgrestBuilder:l.default,PostgrestError:c.default}},400:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.version=void 0,e.version="0.0.0-automated"},3215:(t,e,n)=>{t.exports=n(6004)},6004:(t,e,n)=>{var r=n(3567);t.exports=function(t,e,n){n=n||{},9===e.nodeType&&(e=r.getWindow(e));var i=n.allowHorizontalScroll,s=n.onlyScrollIfNeeded,o=n.alignWithTop,a=n.alignWithLeft;i=void 0===i||i;var l,c,u,h,d,p,f,m,g,v,y=r.isWindow(e),_=r.offset(t),b=r.outerHeight(t),x=r.outerWidth(t);y?(f=e,v=r.height(f),g=r.width(f),m={left:r.scrollLeft(f),top:r.scrollTop(f)},d={left:_.left-m.left,top:_.top-m.top},p={left:_.left+x-(m.left+g),top:_.top+b-(m.top+v)},h=m):(l=r.offset(e),c=e.clientHeight,u=e.clientWidth,h={left:e.scrollLeft,top:e.scrollTop},d={left:_.left-(l.left+(parseFloat(r.css(e,"borderLeftWidth"))||0)),top:_.top-(l.top+(parseFloat(r.css(e,"borderTopWidth"))||0))},p={left:_.left+x-(l.left+u+(parseFloat(r.css(e,"borderRightWidth"))||0)),top:_.top+b-(l.top+c+(parseFloat(r.css(e,"borderBottomWidth"))||0))}),d.top<0||p.top>0?!0===o?r.scrollTop(e,h.top+d.top):!1===o?r.scrollTop(e,h.top+p.top):d.top<0?r.scrollTop(e,h.top+d.top):r.scrollTop(e,h.top+p.top):s||((o=void 0===o||!!o)?r.scrollTop(e,h.top+d.top):r.scrollTop(e,h.top+p.top)),i&&(d.left<0||p.left>0?!0===a?r.scrollLeft(e,h.left+d.left):!1===a?r.scrollLeft(e,h.left+p.left):d.left<0?r.scrollLeft(e,h.left+d.left):r.scrollLeft(e,h.left+p.left):s||((a=void 0===a||!!a)?r.scrollLeft(e,h.left+d.left):r.scrollLeft(e,h.left+p.left)))}},3567:t=>{function e(t,e){var n=t["page"+(e?"Y":"X")+"Offset"],r="scroll"+(e?"Top":"Left");if("number"!==typeof n){var i=t.document;"number"!==typeof(n=i.documentElement[r])&&(n=i.body[r])}return n}function n(t){return e(t)}function r(t){return e(t,!0)}function i(t){var e=function(t){var e,n,r,i=t.ownerDocument,s=i.body,o=i&&i.documentElement;return n=(e=t.getBoundingClientRect()).left,r=e.top,{left:n-=o.clientLeft||s.clientLeft||0,top:r-=o.clientTop||s.clientTop||0}}(t),i=t.ownerDocument,s=i.defaultView||i.parentWindow;return e.left+=n(s),e.top+=r(s),e}var s,o=new RegExp("^("+/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source+")(?!px)[a-z%]+$","i"),a=/^(top|right|bottom|left)$/,l="currentStyle",c="runtimeStyle",u="left";function h(t,e){for(var n=0;n<t.length;n++)e(t[n])}function d(t){return"border-box"===s(t,"boxSizing")}"undefined"!==typeof window&&(s=window.getComputedStyle?function(t,e,n){var r="",i=t.ownerDocument;return(n=n||i.defaultView.getComputedStyle(t,null))&&(r=n.getPropertyValue(e)||n[e]),r}:function(t,e){var n=t[l]&&t[l][e];if(o.test(n)&&!a.test(e)){var r=t.style,i=r[u],s=t[c][u];t[c][u]=t[l][u],r[u]="fontSize"===e?"1em":n||0,n=r.pixelLeft+"px",r[u]=i,t[c][u]=s}return""===n?"auto":n});var p=["margin","border","padding"];function f(t,e,n){var r,i,o,a=0;for(i=0;i<e.length;i++)if(r=e[i])for(o=0;o<n.length;o++){var l;l="border"===r?r+n[o]+"Width":r+n[o],a+=parseFloat(s(t,l))||0}return a}function m(t){return null!=t&&t==t.window}var g={};function v(t,e,n){if(m(t))return"width"===e?g.viewportWidth(t):g.viewportHeight(t);if(9===t.nodeType)return"width"===e?g.docWidth(t):g.docHeight(t);var r="width"===e?["Left","Right"]:["Top","Bottom"],i="width"===e?t.offsetWidth:t.offsetHeight,o=(s(t),d(t)),a=0;(null==i||i<=0)&&(i=void 0,(null==(a=s(t,e))||Number(a)<0)&&(a=t.style[e]||0),a=parseFloat(a)||0),void 0===n&&(n=o?1:-1);var l=void 0!==i||o,c=i||a;return-1===n?l?c-f(t,["border","padding"],r):a:l?c+(1===n?0:2===n?-f(t,["border"],r):f(t,["margin"],r)):a+f(t,p.slice(n),r)}h(["Width","Height"],(function(t){g["doc"+t]=function(e){var n=e.document;return Math.max(n.documentElement["scroll"+t],n.body["scroll"+t],g["viewport"+t](n))},g["viewport"+t]=function(e){var n="client"+t,r=e.document,i=r.body,s=r.documentElement[n];return"CSS1Compat"===r.compatMode&&s||i&&i[n]||s}}));var y={position:"absolute",visibility:"hidden",display:"block"};function _(t){var e,n=arguments;return 0!==t.offsetWidth?e=v.apply(void 0,n):function(t,e,n){var r,i={},s=t.style;for(r in e)i[r]=s[r],s[r]=e[r];for(r in n.call(t),e)s[r]=i[r]}(t,y,(function(){e=v.apply(void 0,n)})),e}function b(t,e,n){if("object"!==typeof e){if("undefined"===typeof n)return s(t,e);"number"===typeof n&&(n+="px"),t.style[e]=n}else for(var r in e)b(t,r,e[r])}function x(t,e){for(var n in e)t[n]=e[n];return t}h(["width","height"],(function(t){var e=t.charAt(0).toUpperCase()+t.slice(1);g["outer"+e]=function(e,n){return e&&_(e,t,n?0:1)};var n="width"===t?["Left","Right"]:["Top","Bottom"];g[t]=function(e,r){if(void 0===r)return e&&_(e,t,-1);if(e){s(e);return d(e)&&(r+=f(e,["padding","border"],n)),b(e,t,r)}}}));var w=t.exports={getWindow:function(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow},offset:function(t,e){if("undefined"===typeof e)return i(t);!function(t,e){"static"===b(t,"position")&&(t.style.position="relative");var n,r,s=i(t),o={};for(r in e)n=parseFloat(b(t,r))||0,o[r]=n+e[r]-s[r];b(t,o)}(t,e)},isWindow:m,each:h,css:b,clone:function(t){var e={};for(var n in t)e[n]=t[n];if(t.overflow)for(n in t)e.overflow[n]=t.overflow[n];return e},mix:x,scrollLeft:function(t,e){if(m(t)){if(void 0===e)return n(t);window.scrollTo(e,r(t))}else{if(void 0===e)return t.scrollLeft;t.scrollLeft=e}},scrollTop:function(t,e){if(m(t)){if(void 0===e)return r(t);window.scrollTo(n(t),e)}else{if(void 0===e)return t.scrollTop;t.scrollTop=e}},merge:function(){for(var t={},e=0;e<arguments.length;e++)w.mix(t,arguments[e]);return t},viewportWidth:0,viewportHeight:0};x(w,g)},1497:(t,e,n)=>{"use strict";var r=n(3218);function i(){}function s(){}s.resetWarningCache=i,t.exports=function(){function t(t,e,n,i,s,o){if(o!==r){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function e(){return t}t.isRequired=t;var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:s,resetWarningCache:i};return n.PropTypes=n,n}},5173:(t,e,n)=>{t.exports=n(1497)()},3218:t=>{"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},3597:(t,e,n)=>{"use strict";var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var s=n(5043),o=n(5173),a=n(7950).findDOMNode,l=n(3215),c=["blur","checkValidity","click","focus","select","setCustomValidity","setSelectionRange","setRangeText"];var u=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.state={isOpen:!1,highlightedIndex:null},n._debugStates=[],n.ensureHighlightedIndex=n.ensureHighlightedIndex.bind(n),n.exposeAPI=n.exposeAPI.bind(n),n.handleInputFocus=n.handleInputFocus.bind(n),n.handleInputBlur=n.handleInputBlur.bind(n),n.handleChange=n.handleChange.bind(n),n.handleKeyDown=n.handleKeyDown.bind(n),n.handleInputClick=n.handleInputClick.bind(n),n.maybeAutoCompleteText=n.maybeAutoCompleteText.bind(n),n}return function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"componentWillMount",value:function(){this.refs={},this._ignoreBlur=!1,this._ignoreFocus=!1,this._scrollOffset=null,this._scrollTimer=null}},{key:"componentWillUnmount",value:function(){clearTimeout(this._scrollTimer),this._scrollTimer=null}},{key:"componentWillReceiveProps",value:function(t){null!==this.state.highlightedIndex&&this.setState(this.ensureHighlightedIndex),!t.autoHighlight||this.props.value===t.value&&null!==this.state.highlightedIndex||this.setState(this.maybeAutoCompleteText)}},{key:"componentDidMount",value:function(){this.isOpen()&&this.setMenuPositions()}},{key:"componentDidUpdate",value:function(t,e){(this.state.isOpen&&!e.isOpen||"open"in this.props&&this.props.open&&!t.open)&&this.setMenuPositions(),this.maybeScrollItemIntoView(),e.isOpen!==this.state.isOpen&&this.props.onMenuVisibilityChange(this.state.isOpen)}},{key:"exposeAPI",value:function(t){var e=this;this.refs.input=t,c.forEach((function(n){return e[n]=t&&t[n]&&t[n].bind(t)}))}},{key:"maybeScrollItemIntoView",value:function(){if(this.isOpen()&&null!==this.state.highlightedIndex){var t=this.refs["item-"+this.state.highlightedIndex],e=this.refs.menu;l(a(t),a(e),{onlyScrollIfNeeded:!0})}}},{key:"handleKeyDown",value:function(t){e.keyDownHandlers[t.key]?e.keyDownHandlers[t.key].call(this,t):this.isOpen()||this.setState({isOpen:!0})}},{key:"handleChange",value:function(t){this.props.onChange(t,t.target.value)}},{key:"getFilteredItems",value:function(t){var e=t.items;return t.shouldItemRender&&(e=e.filter((function(e){return t.shouldItemRender(e,t.value)}))),t.sortItems&&e.sort((function(e,n){return t.sortItems(e,n,t.value)})),e}},{key:"maybeAutoCompleteText",value:function(t,e){for(var n=t.highlightedIndex,r=e.value,i=e.getItemValue,s=null===n?0:n,o=this.getFilteredItems(e),a=0;a<o.length&&!e.isItemSelectable(o[s]);a++)s=(s+1)%o.length;var l=o[s]&&e.isItemSelectable(o[s])?o[s]:null;if(""!==r&&l&&0===i(l).toLowerCase().indexOf(r.toLowerCase()))return{highlightedIndex:s};return{highlightedIndex:null}}},{key:"ensureHighlightedIndex",value:function(t,e){if(t.highlightedIndex>=this.getFilteredItems(e).length)return{highlightedIndex:null}}},{key:"setMenuPositions",value:function(){var t=this.refs.input,e=t.getBoundingClientRect(),r=n.g.window.getComputedStyle(t),i=parseInt(r.marginBottom,10)||0,s=parseInt(r.marginLeft,10)||0,o=parseInt(r.marginRight,10)||0;this.setState({menuTop:e.bottom+i,menuLeft:e.left+s,menuWidth:e.width+s+o})}},{key:"highlightItemFromMouse",value:function(t){this.setState({highlightedIndex:t})}},{key:"selectItemFromMouse",value:function(t){var e=this,n=this.props.getItemValue(t);this.setIgnoreBlur(!1),this.setState({isOpen:!1,highlightedIndex:null},(function(){e.props.onSelect(n,t)}))}},{key:"setIgnoreBlur",value:function(t){this._ignoreBlur=t}},{key:"renderMenu",value:function(){var t=this,e=this.getFilteredItems(this.props).map((function(e,n){var r=t.props.renderItem(e,t.state.highlightedIndex===n,{cursor:"default"});return s.cloneElement(r,{onMouseEnter:t.props.isItemSelectable(e)?function(){return t.highlightItemFromMouse(n)}:null,onClick:t.props.isItemSelectable(e)?function(){return t.selectItemFromMouse(e)}:null,ref:function(e){return t.refs["item-"+n]=e}})})),n={left:this.state.menuLeft,top:this.state.menuTop,minWidth:this.state.menuWidth},r=this.props.renderMenu(e,this.props.value,n);return s.cloneElement(r,{ref:function(e){return t.refs.menu=e},onTouchStart:function(){return t.setIgnoreBlur(!0)},onMouseEnter:function(){return t.setIgnoreBlur(!0)},onMouseLeave:function(){return t.setIgnoreBlur(!1)}})}},{key:"handleInputBlur",value:function(t){var e=this;if(this._ignoreBlur)return this._ignoreFocus=!0,this._scrollOffset={x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop},void this.refs.input.focus();var n=void 0,r=this.state.highlightedIndex;if(this.props.selectOnBlur&&null!==r){var i=this.getFilteredItems(this.props)[r],s=this.props.getItemValue(i);n=function(){return e.props.onSelect(s,i)}}this.setState({isOpen:!1,highlightedIndex:null},n);var o=this.props.inputProps.onBlur;o&&o(t)}},{key:"handleInputFocus",value:function(t){var e=this;if(this._ignoreFocus){this._ignoreFocus=!1;var n=this._scrollOffset,r=n.x,i=n.y;return this._scrollOffset=null,window.scrollTo(r,i),clearTimeout(this._scrollTimer),void(this._scrollTimer=setTimeout((function(){e._scrollTimer=null,window.scrollTo(r,i)}),0))}this.setState({isOpen:!0});var s=this.props.inputProps.onFocus;s&&s(t)}},{key:"isInputFocused",value:function(){var t=this.refs.input;return t.ownerDocument&&t===t.ownerDocument.activeElement}},{key:"handleInputClick",value:function(){this.isInputFocused()&&!this.isOpen()&&this.setState({isOpen:!0})}},{key:"composeEventHandlers",value:function(t,e){return e?function(n){t(n),e(n)}:t}},{key:"isOpen",value:function(){return"open"in this.props?this.props.open:this.state.isOpen}},{key:"render",value:function(){this.props.debug&&this._debugStates.push({id:this._debugStates.length,state:this.state});var t=this.props.inputProps,e=this.isOpen();return s.createElement("div",r({style:r({},this.props.wrapperStyle)},this.props.wrapperProps),this.props.renderInput(r({},t,{role:"combobox","aria-autocomplete":"list","aria-expanded":e,autoComplete:"off",ref:this.exposeAPI,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,onChange:this.handleChange,onKeyDown:this.composeEventHandlers(this.handleKeyDown,t.onKeyDown),onClick:this.composeEventHandlers(this.handleInputClick,t.onClick),value:this.props.value})),e&&this.renderMenu(),this.props.debug&&s.createElement("pre",{style:{marginLeft:300}},JSON.stringify(this._debugStates.slice(Math.max(0,this._debugStates.length-5),this._debugStates.length),null,2)))}}]),e}(s.Component);u.propTypes={items:o.array.isRequired,value:o.any,onChange:o.func,onSelect:o.func,shouldItemRender:o.func,isItemSelectable:o.func,sortItems:o.func,getItemValue:o.func.isRequired,renderItem:o.func.isRequired,renderMenu:o.func,menuStyle:o.object,renderInput:o.func,inputProps:o.object,wrapperProps:o.object,wrapperStyle:o.object,autoHighlight:o.bool,selectOnBlur:o.bool,onMenuVisibilityChange:o.func,open:o.bool,debug:o.bool},u.defaultProps={value:"",wrapperProps:{},wrapperStyle:{display:"inline-block"},inputProps:{},renderInput:function(t){return s.createElement("input",t)},onChange:function(){},onSelect:function(){},isItemSelectable:function(){return!0},renderMenu:function(t,e,n){return s.createElement("div",{style:r({},n,this.menuStyle),children:t})},menuStyle:{borderRadius:"3px",boxShadow:"0 2px 12px rgba(0, 0, 0, 0.1)",background:"rgba(255, 255, 255, 0.9)",padding:"2px 0",fontSize:"90%",position:"fixed",overflow:"auto",maxHeight:"50%"},autoHighlight:!0,selectOnBlur:!1,onMenuVisibilityChange:function(){}},u.keyDownHandlers={ArrowDown:function(t){t.preventDefault();var e=this.getFilteredItems(this.props);if(e.length){for(var n=this.state.highlightedIndex,r=null===n?-1:n,i=0;i<e.length;i++){var s=(r+i+1)%e.length;if(this.props.isItemSelectable(e[s])){r=s;break}}r>-1&&r!==n&&this.setState({highlightedIndex:r,isOpen:!0})}},ArrowUp:function(t){t.preventDefault();var e=this.getFilteredItems(this.props);if(e.length){for(var n=this.state.highlightedIndex,r=null===n?e.length:n,i=0;i<e.length;i++){var s=(r-(1+i)+e.length)%e.length;if(this.props.isItemSelectable(e[s])){r=s;break}}r!==e.length&&this.setState({highlightedIndex:r,isOpen:!0})}},Enter:function(t){var e=this;if(13===t.keyCode&&(this.setIgnoreBlur(!1),this.isOpen()))if(null==this.state.highlightedIndex)this.setState({isOpen:!1},(function(){e.refs.input.select()}));else{t.preventDefault();var n=this.getFilteredItems(this.props)[this.state.highlightedIndex],r=this.props.getItemValue(n);this.setState({isOpen:!1,highlightedIndex:null},(function(){e.refs.input.setSelectionRange(r.length,r.length),e.props.onSelect(r,n)}))}},Escape:function(){this.setIgnoreBlur(!1),this.setState({highlightedIndex:null,isOpen:!1})},Tab:function(){this.setIgnoreBlur(!1)}},t.exports=u},2730:(t,e,n)=>{"use strict";var r=n(5043),i=n(8853);function s(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function l(t,e){c(t,e),c(t+"Capture",e)}function c(t,e){for(a[t]=e,t=0;t<e.length;t++)o.add(e[t])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(t,e,n,r,i,s,o){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(t){g[t]=new m(t,0,!1,t,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(t){var e=t[0];g[e]=new m(e,1,!1,t[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(t){g[t]=new m(t,2,!1,t.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(t){g[t]=new m(t,2,!1,t,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(t){g[t]=new m(t,3,!1,t.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(t){g[t]=new m(t,3,!0,t,null,!1,!1)})),["capture","download"].forEach((function(t){g[t]=new m(t,4,!1,t,null,!1,!1)})),["cols","rows","size","span"].forEach((function(t){g[t]=new m(t,6,!1,t,null,!1,!1)})),["rowSpan","start"].forEach((function(t){g[t]=new m(t,5,!1,t.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(t){return t[1].toUpperCase()}function _(t,e,n,r){var i=g.hasOwnProperty(e)?g[e]:null;(null!==i?0!==i.type:r||!(2<e.length)||"o"!==e[0]&&"O"!==e[0]||"n"!==e[1]&&"N"!==e[1])&&(function(t,e,n,r){if(null===e||"undefined"===typeof e||function(t,e,n,r){if(null!==n&&0===n.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,n,i,r)&&(n=null),r||null===i?function(t){return!!h.call(f,t)||!h.call(p,t)&&(d.test(t)?f[t]=!0:(p[t]=!0,!1))}(e)&&(null===n?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=null===n?3!==i.type&&"":n:(e=i.attributeName,r=i.attributeNamespace,null===n?t.removeAttribute(e):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(t){var e=t.replace(v,y);g[e]=new m(e,1,!1,t,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(t){var e=t.replace(v,y);g[e]=new m(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(t){var e=t.replace(v,y);g[e]=new m(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!0,!0)}));var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),A=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),L=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var N=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function k(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=O&&t[O]||t["@@iterator"])?t:null}var D,z=Object.assign;function U(t){if(void 0===D)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);D=e&&e[1]||""}return"\n"+D+t}var F=!1;function B(t,e){if(!t||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),s=r.stack.split("\n"),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(1!==o||1!==a)do{if(o--,0>--a||i[o]!==s[a]){var l="\n"+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}}while(1<=o&&0<=a);break}}}finally{F=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?U(t):""}function V(t){switch(t.tag){case 5:return U(t.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return t=B(t.type,!1);case 11:return t=B(t.type.render,!1);case 1:return t=B(t.type,!0);default:return""}}function H(t){if(null==t)return null;if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case S:return"Fragment";case w:return"Portal";case E:return"Profiler";case M:return"StrictMode";case P:return"Suspense";case I:return"SuspenseList"}if("object"===typeof t)switch(t.$$typeof){case A:return(t.displayName||"Context")+".Consumer";case T:return(t._context.displayName||"Context")+".Provider";case C:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case R:return null!==(e=t.displayName||null)?e:H(t.type)||"Memo";case L:e=t._payload,t=t._init;try{return H(t(e))}catch(n){}}return null}function j(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=(t=e.render).displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H(e);case 8:return e===M?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e}return null}function W(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function G(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function q(t){t._valueTracker||(t._valueTracker=function(t){var e=G(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(t){r=""+t,s.call(this,t)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(t){r=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function $(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=G(t)?t.checked?"true":"false":t.value),(t=r)!==n&&(e.setValue(t),!0)}function X(t){if("undefined"===typeof(t=t||("undefined"!==typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function J(t,e){var n=e.checked;return z({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:t._wrapperState.initialChecked})}function Y(t,e){var n=null==e.defaultValue?"":e.defaultValue,r=null!=e.checked?e.checked:e.defaultChecked;n=W(null!=e.value?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function Z(t,e){null!=(e=e.checked)&&_(t,"checked",e,!1)}function K(t,e){Z(t,e);var n=W(e.value),r=e.type;if(null!=n)"number"===r?(0===n&&""===t.value||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if("submit"===r||"reset"===r)return void t.removeAttribute("value");e.hasOwnProperty("value")?tt(t,e.type,n):e.hasOwnProperty("defaultValue")&&tt(t,e.type,W(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function Q(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!("submit"!==r&&"reset"!==r||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}""!==(n=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==n&&(t.name=n)}function tt(t,e,n){"number"===e&&X(t.ownerDocument)===t||(null==n?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var et=Array.isArray;function nt(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+W(n),e=null,i=0;i<t.length;i++){if(t[i].value===n)return t[i].selected=!0,void(r&&(t[i].defaultSelected=!0));null!==e||t[i].disabled||(e=t[i])}null!==e&&(e.selected=!0)}}function rt(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(s(91));return z({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function it(t,e){var n=e.value;if(null==n){if(n=e.children,e=e.defaultValue,null!=n){if(null!=e)throw Error(s(92));if(et(n)){if(1<n.length)throw Error(s(93));n=n[0]}e=n}null==e&&(e=""),n=e}t._wrapperState={initialValue:W(n)}}function st(t,e){var n=W(e.value),r=W(e.defaultValue);null!=n&&((n=""+n)!==t.value&&(t.value=n),null==e.defaultValue&&t.defaultValue!==n&&(t.defaultValue=n)),null!=r&&(t.defaultValue=""+r)}function ot(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}function at(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lt(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?at(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var ct,ut=function(t){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction((function(){return t(e,n)}))}:t}((function(t,e){if("http://www.w3.org/2000/svg"!==t.namespaceURI||"innerHTML"in t)t.innerHTML=e;else{for((ct=ct||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ct.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}}));function ht(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&3===n.nodeType)return void(n.nodeValue=e)}t.textContent=e}var dt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pt=["Webkit","ms","Moz","O"];function ft(t,e,n){return null==e||"boolean"===typeof e||""===e?"":n||"number"!==typeof e||0===e||dt.hasOwnProperty(t)&&dt[t]?(""+e).trim():e+"px"}function mt(t,e){for(var n in t=t.style,e)if(e.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=ft(n,e[n],r);"float"===n&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}Object.keys(dt).forEach((function(t){pt.forEach((function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),dt[e]=dt[t]}))}));var gt=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vt(t,e){if(e){if(gt[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(s(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(s(60));if("object"!==typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=e.style&&"object"!==typeof e.style)throw Error(s(62))}}function yt(t,e){if(-1===t.indexOf("-"))return"string"===typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _t=null;function bt(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var xt=null,wt=null,St=null;function Mt(t){if(t=mi(t)){if("function"!==typeof xt)throw Error(s(280));var e=t.stateNode;e&&(e=vi(e),xt(t.stateNode,t.type,e))}}function Et(t){wt?St?St.push(t):St=[t]:wt=t}function Tt(){if(wt){var t=wt,e=St;if(St=wt=null,Mt(t),e)for(t=0;t<e.length;t++)Mt(e[t])}}function At(t,e){return t(e)}function Ct(){}var Pt=!1;function It(t,e,n){if(Pt)return t(e,n);Pt=!0;try{return At(t,e,n)}finally{Pt=!1,(null!==wt||null!==St)&&(Ct(),Tt())}}function Rt(t,e){var n=t.stateNode;if(null===n)return null;var r=vi(n);if(null===r)return null;n=r[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!r;break t;default:t=!1}if(t)return null;if(n&&"function"!==typeof n)throw Error(s(231,e,typeof n));return n}var Lt=!1;if(u)try{var Nt={};Object.defineProperty(Nt,"passive",{get:function(){Lt=!0}}),window.addEventListener("test",Nt,Nt),window.removeEventListener("test",Nt,Nt)}catch(tu){Lt=!1}function Ot(t,e,n,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var kt=!1,Dt=null,zt=!1,Ut=null,Ft={onError:function(t){kt=!0,Dt=t}};function Bt(t,e,n,r,i,s,o,a,l){kt=!1,Dt=null,Ot.apply(Ft,arguments)}function Vt(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(4098&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function Ht(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function jt(t){if(Vt(t)!==t)throw Error(s(188))}function Wt(t){return null!==(t=function(t){var e=t.alternate;if(!e){if(null===(e=Vt(t)))throw Error(s(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return jt(i),t;if(o===r)return jt(i),e;o=o.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,l=i.child;l;){if(l===n){a=!0,n=i,r=o;break}if(l===r){a=!0,r=i,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,r=i;break}if(l===r){a=!0,r=o,n=i;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?t:e}(t))?Gt(t):null}function Gt(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var e=Gt(t);if(null!==e)return e;t=t.sibling}return null}var qt=i.unstable_scheduleCallback,$t=i.unstable_cancelCallback,Xt=i.unstable_shouldYield,Jt=i.unstable_requestPaint,Yt=i.unstable_now,Zt=i.unstable_getCurrentPriorityLevel,Kt=i.unstable_ImmediatePriority,Qt=i.unstable_UserBlockingPriority,te=i.unstable_NormalPriority,ee=i.unstable_LowPriority,ne=i.unstable_IdlePriority,re=null,ie=null;var se=Math.clz32?Math.clz32:function(t){return 0===(t>>>=0)?32:31-(oe(t)/ae|0)|0},oe=Math.log,ae=Math.LN2;var le=64,ce=4194304;function ue(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&t;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&t;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function he(t,e){var n=t.pendingLanes;if(0===n)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=268435455&n;if(0!==o){var a=o&~i;0!==a?r=ue(a):0!==(s&=o)&&(r=ue(s))}else 0!==(o=n&~i)?r=ue(o):0!==s&&(r=ue(s));if(0===r)return 0;if(0!==e&&e!==r&&0===(e&i)&&((i=r&-r)>=(s=e&-e)||16===i&&0!==(4194240&s)))return e;if(0!==(4&r)&&(r|=16&n),0!==(e=t.entangledLanes))for(t=t.entanglements,e&=r;0<e;)i=1<<(n=31-se(e)),r|=t[n],e&=~i;return r}function de(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function pe(t){return 0!==(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function fe(){var t=le;return 0===(4194240&(le<<=1))&&(le=64),t}function me(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ge(t,e,n){t.pendingLanes|=e,536870912!==e&&(t.suspendedLanes=0,t.pingedLanes=0),(t=t.eventTimes)[e=31-se(e)]=n}function ve(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-se(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var ye=0;function _e(t){return 1<(t&=-t)?4<t?0!==(268435455&t)?16:536870912:4:1}var be,xe,we,Se,Me,Ee=!1,Te=[],Ae=null,Ce=null,Pe=null,Ie=new Map,Re=new Map,Le=[],Ne="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Oe(t,e){switch(t){case"focusin":case"focusout":Ae=null;break;case"dragenter":case"dragleave":Ce=null;break;case"mouseover":case"mouseout":Pe=null;break;case"pointerover":case"pointerout":Ie.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Re.delete(e.pointerId)}}function ke(t,e,n,r,i,s){return null===t||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},null!==e&&(null!==(e=mi(e))&&xe(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,null!==i&&-1===e.indexOf(i)&&e.push(i),t)}function De(t){var e=fi(t.target);if(null!==e){var n=Vt(e);if(null!==n)if(13===(e=n.tag)){if(null!==(e=Ht(n)))return t.blockedOn=e,void Me(t.priority,(function(){we(n)}))}else if(3===e&&n.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}t.blockedOn=null}function ze(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var n=Xe(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==n)return null!==(e=mi(n))&&xe(e),t.blockedOn=n,!1;var r=new(n=t.nativeEvent).constructor(n.type,n);_t=r,n.target.dispatchEvent(r),_t=null,e.shift()}return!0}function Ue(t,e,n){ze(t)&&n.delete(e)}function Fe(){Ee=!1,null!==Ae&&ze(Ae)&&(Ae=null),null!==Ce&&ze(Ce)&&(Ce=null),null!==Pe&&ze(Pe)&&(Pe=null),Ie.forEach(Ue),Re.forEach(Ue)}function Be(t,e){t.blockedOn===e&&(t.blockedOn=null,Ee||(Ee=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Fe)))}function Ve(t){function e(e){return Be(e,t)}if(0<Te.length){Be(Te[0],t);for(var n=1;n<Te.length;n++){var r=Te[n];r.blockedOn===t&&(r.blockedOn=null)}}for(null!==Ae&&Be(Ae,t),null!==Ce&&Be(Ce,t),null!==Pe&&Be(Pe,t),Ie.forEach(e),Re.forEach(e),n=0;n<Le.length;n++)(r=Le[n]).blockedOn===t&&(r.blockedOn=null);for(;0<Le.length&&null===(n=Le[0]).blockedOn;)De(n),null===n.blockedOn&&Le.shift()}var He=b.ReactCurrentBatchConfig,je=!0;function We(t,e,n,r){var i=ye,s=He.transition;He.transition=null;try{ye=1,qe(t,e,n,r)}finally{ye=i,He.transition=s}}function Ge(t,e,n,r){var i=ye,s=He.transition;He.transition=null;try{ye=4,qe(t,e,n,r)}finally{ye=i,He.transition=s}}function qe(t,e,n,r){if(je){var i=Xe(t,e,n,r);if(null===i)Br(t,e,r,$e,n),Oe(t,r);else if(function(t,e,n,r,i){switch(e){case"focusin":return Ae=ke(Ae,t,e,n,r,i),!0;case"dragenter":return Ce=ke(Ce,t,e,n,r,i),!0;case"mouseover":return Pe=ke(Pe,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return Ie.set(s,ke(Ie.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Re.set(s,ke(Re.get(s)||null,t,e,n,r,i)),!0}return!1}(i,t,e,n,r))r.stopPropagation();else if(Oe(t,r),4&e&&-1<Ne.indexOf(t)){for(;null!==i;){var s=mi(i);if(null!==s&&be(s),null===(s=Xe(t,e,n,r))&&Br(t,e,r,$e,n),s===i)break;i=s}null!==i&&r.stopPropagation()}else Br(t,e,r,null,n)}}var $e=null;function Xe(t,e,n,r){if($e=null,null!==(t=fi(t=bt(r))))if(null===(e=Vt(t)))t=null;else if(13===(n=e.tag)){if(null!==(t=Ht(e)))return t;t=null}else if(3===n){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return $e=t,null}function Je(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Zt()){case Kt:return 1;case Qt:return 4;case te:case ee:return 16;case ne:return 536870912;default:return 16}default:return 16}}var Ye=null,Ze=null,Ke=null;function Qe(){if(Ke)return Ke;var t,e,n=Ze,r=n.length,i="value"in Ye?Ye.value:Ye.textContent,s=i.length;for(t=0;t<r&&n[t]===i[t];t++);var o=r-t;for(e=1;e<=o&&n[r-e]===i[s-e];e++);return Ke=i.slice(t,1<e?1-e:void 0)}function tn(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function en(){return!0}function nn(){return!1}function rn(t){function e(e,n,r,i,s){for(var o in this._reactName=e,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=s,this.currentTarget=null,t)t.hasOwnProperty(o)&&(e=t[o],this[o]=e?e(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?en:nn,this.isPropagationStopped=nn,this}return z(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!==typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=en)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!==typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=en)},persist:function(){},isPersistent:en}),e}var sn,on,an,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=rn(ln),un=z({},ln,{view:0,detail:0}),hn=rn(un),dn=z({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sn,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==an&&(an&&"mousemove"===t.type?(sn=t.screenX-an.screenX,on=t.screenY-an.screenY):on=sn=0,an=t),sn)},movementY:function(t){return"movementY"in t?t.movementY:on}}),pn=rn(dn),fn=rn(z({},dn,{dataTransfer:0})),mn=rn(z({},un,{relatedTarget:0})),gn=rn(z({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=rn(z({},ln,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}})),yn=rn(z({},ln,{data:0})),_n={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wn(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=xn[t])&&!!e[t]}function Sn(){return wn}var Mn=rn(z({},un,{key:function(t){if(t.key){var e=_n[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=tn(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?bn[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sn,charCode:function(t){return"keypress"===t.type?tn(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?tn(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}})),En=rn(z({},dn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Tn=rn(z({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sn})),An=rn(z({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),Cn=rn(z({},dn,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0})),Pn=[9,13,27,32],In=u&&"CompositionEvent"in window,Rn=null;u&&"documentMode"in document&&(Rn=document.documentMode);var Ln=u&&"TextEvent"in window&&!Rn,Nn=u&&(!In||Rn&&8<Rn&&11>=Rn),On=String.fromCharCode(32),kn=!1;function Dn(t,e){switch(t){case"keyup":return-1!==Pn.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(t){return"object"===typeof(t=t.detail)&&"data"in t?t.data:null}var Un=!1;var Fn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Fn[t.type]:"textarea"===e}function Vn(t,e,n,r){Et(r),0<(e=Hr(e,"onChange")).length&&(n=new cn("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Hn=null,jn=null;function Wn(t){Or(t,0)}function Gn(t){if($(gi(t)))return t}function qn(t,e){if("change"===t)return e}var $n=!1;if(u){var Xn;if(u){var Jn="oninput"in document;if(!Jn){var Yn=document.createElement("div");Yn.setAttribute("oninput","return;"),Jn="function"===typeof Yn.oninput}Xn=Jn}else Xn=!1;$n=Xn&&(!document.documentMode||9<document.documentMode)}function Zn(){Hn&&(Hn.detachEvent("onpropertychange",Kn),jn=Hn=null)}function Kn(t){if("value"===t.propertyName&&Gn(jn)){var e=[];Vn(e,jn,t,bt(t)),It(Wn,e)}}function Qn(t,e,n){"focusin"===t?(Zn(),jn=n,(Hn=e).attachEvent("onpropertychange",Kn)):"focusout"===t&&Zn()}function tr(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return Gn(jn)}function er(t,e){if("click"===t)return Gn(e)}function nr(t,e){if("input"===t||"change"===t)return Gn(e)}var rr="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e};function ir(t,e){if(rr(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!h.call(e,i)||!rr(t[i],e[i]))return!1}return!0}function sr(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function or(t,e){var n,r=sr(t);for(t=0;r;){if(3===r.nodeType){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}t:{for(;r;){if(r.nextSibling){r=r.nextSibling;break t}r=r.parentNode}r=void 0}r=sr(r)}}function ar(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?ar(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function lr(){for(var t=window,e=X();e instanceof t.HTMLIFrameElement;){try{var n="string"===typeof e.contentWindow.location.href}catch(r){n=!1}if(!n)break;e=X((t=e.contentWindow).document)}return e}function cr(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}function ur(t){var e=lr(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&ar(n.ownerDocument.documentElement,n)){if(null!==r&&cr(n))if(e=r.start,void 0===(t=r.end)&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if((t=(e=n.ownerDocument||document)&&e.defaultView||window).getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=void 0===r.end?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=or(n,s);var o=or(n,r);i&&o&&(1!==t.rangeCount||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&((e=e.createRange()).setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}for(e=[],t=n;t=t.parentNode;)1===t.nodeType&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<e.length;n++)(t=e[n]).element.scrollLeft=t.left,t.element.scrollTop=t.top}}var hr=u&&"documentMode"in document&&11>=document.documentMode,dr=null,pr=null,fr=null,mr=!1;function gr(t,e,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;mr||null==dr||dr!==X(r)||("selectionStart"in(r=dr)&&cr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},fr&&ir(fr,r)||(fr=r,0<(r=Hr(pr,"onSelect")).length&&(e=new cn("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=dr)))}function vr(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var yr={animationend:vr("Animation","AnimationEnd"),animationiteration:vr("Animation","AnimationIteration"),animationstart:vr("Animation","AnimationStart"),transitionend:vr("Transition","TransitionEnd")},_r={},br={};function xr(t){if(_r[t])return _r[t];if(!yr[t])return t;var e,n=yr[t];for(e in n)if(n.hasOwnProperty(e)&&e in br)return _r[t]=n[e];return t}u&&(br=document.createElement("div").style,"AnimationEvent"in window||(delete yr.animationend.animation,delete yr.animationiteration.animation,delete yr.animationstart.animation),"TransitionEvent"in window||delete yr.transitionend.transition);var wr=xr("animationend"),Sr=xr("animationiteration"),Mr=xr("animationstart"),Er=xr("transitionend"),Tr=new Map,Ar="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cr(t,e){Tr.set(t,e),l(e,[t])}for(var Pr=0;Pr<Ar.length;Pr++){var Ir=Ar[Pr];Cr(Ir.toLowerCase(),"on"+(Ir[0].toUpperCase()+Ir.slice(1)))}Cr(wr,"onAnimationEnd"),Cr(Sr,"onAnimationIteration"),Cr(Mr,"onAnimationStart"),Cr("dblclick","onDoubleClick"),Cr("focusin","onFocus"),Cr("focusout","onBlur"),Cr(Er,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rr));function Nr(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,function(t,e,n,r,i,o,a,l,c){if(Bt.apply(this,arguments),kt){if(!kt)throw Error(s(198));var u=Dt;kt=!1,Dt=null,zt||(zt=!0,Ut=u)}}(r,e,void 0,t),t.currentTarget=null}function Or(t,e){e=0!==(4&e);for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;t:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break t;Nr(i,a,c),s=l}else for(o=0;o<r.length;o++){if(l=(a=r[o]).instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break t;Nr(i,a,c),s=l}}}if(zt)throw t=Ut,zt=!1,Ut=null,t}function kr(t,e){var n=e[hi];void 0===n&&(n=e[hi]=new Set);var r=t+"__bubble";n.has(r)||(Fr(e,t,2,!1),n.add(r))}function Dr(t,e,n){var r=0;e&&(r|=4),Fr(n,t,r,e)}var zr="_reactListening"+Math.random().toString(36).slice(2);function Ur(t){if(!t[zr]){t[zr]=!0,o.forEach((function(e){"selectionchange"!==e&&(Lr.has(e)||Dr(e,!1,t),Dr(e,!0,t))}));var e=9===t.nodeType?t:t.ownerDocument;null===e||e[zr]||(e[zr]=!0,Dr("selectionchange",!1,e))}}function Fr(t,e,n,r){switch(Je(e)){case 1:var i=We;break;case 4:i=Ge;break;default:i=qe}n=i.bind(null,e,n,t),i=void 0,!Lt||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(i=!0),r?void 0!==i?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):void 0!==i?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Br(t,e,n,r,i){var s=r;if(0===(1&e)&&0===(2&e)&&null!==r)t:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;o=o.return}for(;null!==a;){if(null===(o=fi(a)))return;if(5===(l=o.tag)||6===l){r=s=o;continue t}a=a.parentNode}}r=r.return}It((function(){var r=s,i=bt(n),o=[];t:{var a=Tr.get(t);if(void 0!==a){var l=cn,c=t;switch(t){case"keypress":if(0===tn(n))break t;case"keydown":case"keyup":l=Mn;break;case"focusin":c="focus",l=mn;break;case"focusout":c="blur",l=mn;break;case"beforeblur":case"afterblur":l=mn;break;case"click":if(2===n.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Tn;break;case wr:case Sr:case Mr:l=gn;break;case Er:l=An;break;case"scroll":l=hn;break;case"wheel":l=Cn;break;case"copy":case"cut":case"paste":l=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=En}var u=0!==(4&e),h=!u&&"scroll"===t,d=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=Rt(f,d))&&u.push(Vr(f,m,p)))),h)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,i),o.push({event:a,listeners:u}))}}if(0===(7&e)){if(l="mouseout"===t||"pointerout"===t,(!(a="mouseover"===t||"pointerover"===t)||n===_t||!(c=n.relatedTarget||n.fromElement)||!fi(c)&&!c[ui])&&(l||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?fi(c):null)&&(c!==(h=Vt(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=pn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==t&&"pointerover"!==t||(u=En,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?a:gi(l),p=null==c?a:gi(c),(a=new u(m,f+"leave",l,n,i)).target=h,a.relatedTarget=p,m=null,fi(i)===r&&((u=new u(d,f+"enter",c,n,i)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)t:{for(d=c,f=0,p=u=l;p;p=jr(p))f++;for(p=0,m=d;m;m=jr(m))p++;for(;0<f-p;)u=jr(u),f--;for(;0<p-f;)d=jr(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break t;u=jr(u),d=jr(d)}u=null}else u=null;null!==l&&Wr(o,a,l,u,!1),null!==c&&null!==h&&Wr(o,h,c,u,!0)}if("select"===(l=(a=r?gi(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=qn;else if(Bn(a))if($n)g=nr;else{g=tr;var v=Qn}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=er);switch(g&&(g=g(t,r))?Vn(o,g,n,i):(v&&v(t,a,r),"focusout"===t&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&tt(a,"number",a.value)),v=r?gi(r):window,t){case"focusin":(Bn(v)||"true"===v.contentEditable)&&(dr=v,pr=r,fr=null);break;case"focusout":fr=pr=dr=null;break;case"mousedown":mr=!0;break;case"contextmenu":case"mouseup":case"dragend":mr=!1,gr(o,n,i);break;case"selectionchange":if(hr)break;case"keydown":case"keyup":gr(o,n,i)}var y;if(In)t:{switch(t){case"compositionstart":var _="onCompositionStart";break t;case"compositionend":_="onCompositionEnd";break t;case"compositionupdate":_="onCompositionUpdate";break t}_=void 0}else Un?Dn(t,n)&&(_="onCompositionEnd"):"keydown"===t&&229===n.keyCode&&(_="onCompositionStart");_&&(Nn&&"ko"!==n.locale&&(Un||"onCompositionStart"!==_?"onCompositionEnd"===_&&Un&&(y=Qe()):(Ze="value"in(Ye=i)?Ye.value:Ye.textContent,Un=!0)),0<(v=Hr(r,_)).length&&(_=new yn(_,t,null,n,i),o.push({event:_,listeners:v}),y?_.data=y:null!==(y=zn(n))&&(_.data=y))),(y=Ln?function(t,e){switch(t){case"compositionend":return zn(e);case"keypress":return 32!==e.which?null:(kn=!0,On);case"textInput":return(t=e.data)===On&&kn?null:t;default:return null}}(t,n):function(t,e){if(Un)return"compositionend"===t||!In&&Dn(t,e)?(t=Qe(),Ke=Ze=Ye=null,Un=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Nn&&"ko"!==e.locale?null:e.data}}(t,n))&&(0<(r=Hr(r,"onBeforeInput")).length&&(i=new yn("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=y))}Or(o,e)}))}function Vr(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Hr(t,e){for(var n=e+"Capture",r=[];null!==t;){var i=t,s=i.stateNode;5===i.tag&&null!==s&&(i=s,null!=(s=Rt(t,n))&&r.unshift(Vr(t,s,i)),null!=(s=Rt(t,e))&&r.push(Vr(t,s,i))),t=t.return}return r}function jr(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function Wr(t,e,n,r,i){for(var s=e._reactName,o=[];null!==n&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===r)break;5===a.tag&&null!==c&&(a=c,i?null!=(l=Rt(n,s))&&o.unshift(Vr(n,l,a)):i||null!=(l=Rt(n,s))&&o.push(Vr(n,l,a))),n=n.return}0!==o.length&&t.push({event:e,listeners:o})}var Gr=/\r\n?/g,qr=/\u0000|\uFFFD/g;function $r(t){return("string"===typeof t?t:""+t).replace(Gr,"\n").replace(qr,"")}function Xr(t,e,n){if(e=$r(e),$r(t)!==e&&n)throw Error(s(425))}function Jr(){}var Yr=null,Zr=null;function Kr(t,e){return"textarea"===t||"noscript"===t||"string"===typeof e.children||"number"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var Qr="function"===typeof setTimeout?setTimeout:void 0,ti="function"===typeof clearTimeout?clearTimeout:void 0,ei="function"===typeof Promise?Promise:void 0,ni="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ei?function(t){return ei.resolve(null).then(t).catch(ri)}:Qr;function ri(t){setTimeout((function(){throw t}))}function ii(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return t.removeChild(i),void Ve(e);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Ve(e)}function si(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e)break;if("/$"===e)return null}}return t}function oi(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var n=t.data;if("$"===n||"$!"===n||"$?"===n){if(0===e)return t;e--}else"/$"===n&&e++}t=t.previousSibling}return null}var ai=Math.random().toString(36).slice(2),li="__reactFiber$"+ai,ci="__reactProps$"+ai,ui="__reactContainer$"+ai,hi="__reactEvents$"+ai,di="__reactListeners$"+ai,pi="__reactHandles$"+ai;function fi(t){var e=t[li];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ui]||n[li]){if(n=e.alternate,null!==e.child||null!==n&&null!==n.child)for(t=oi(t);null!==t;){if(n=t[li])return n;t=oi(t)}return e}n=(t=n).parentNode}return null}function mi(t){return!(t=t[li]||t[ui])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function gi(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(s(33))}function vi(t){return t[ci]||null}var yi=[],_i=-1;function bi(t){return{current:t}}function xi(t){0>_i||(t.current=yi[_i],yi[_i]=null,_i--)}function wi(t,e){_i++,yi[_i]=t.current,t.current=e}var Si={},Mi=bi(Si),Ei=bi(!1),Ti=Si;function Ai(t,e){var n=t.type.contextTypes;if(!n)return Si;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i,s={};for(i in n)s[i]=e[i];return r&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Ci(t){return null!==(t=t.childContextTypes)&&void 0!==t}function Pi(){xi(Ei),xi(Mi)}function Ii(t,e,n){if(Mi.current!==Si)throw Error(s(168));wi(Mi,e),wi(Ei,n)}function Ri(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in e))throw Error(s(108,j(t)||"Unknown",i));return z({},n,r)}function Li(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Si,Ti=Mi.current,wi(Mi,t),wi(Ei,Ei.current),!0}function Ni(t,e,n){var r=t.stateNode;if(!r)throw Error(s(169));n?(t=Ri(t,e,Ti),r.__reactInternalMemoizedMergedChildContext=t,xi(Ei),xi(Mi),wi(Mi,t)):xi(Ei),wi(Ei,n)}var Oi=null,ki=!1,Di=!1;function zi(t){null===Oi?Oi=[t]:Oi.push(t)}function Ui(){if(!Di&&null!==Oi){Di=!0;var t=0,e=ye;try{var n=Oi;for(ye=1;t<n.length;t++){var r=n[t];do{r=r(!0)}while(null!==r)}Oi=null,ki=!1}catch(i){throw null!==Oi&&(Oi=Oi.slice(t+1)),qt(Kt,Ui),i}finally{ye=e,Di=!1}}return null}var Fi=[],Bi=0,Vi=null,Hi=0,ji=[],Wi=0,Gi=null,qi=1,$i="";function Xi(t,e){Fi[Bi++]=Hi,Fi[Bi++]=Vi,Vi=t,Hi=e}function Ji(t,e,n){ji[Wi++]=qi,ji[Wi++]=$i,ji[Wi++]=Gi,Gi=t;var r=qi;t=$i;var i=32-se(r)-1;r&=~(1<<i),n+=1;var s=32-se(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,qi=1<<32-se(e)+i|n<<i|r,$i=s+t}else qi=1<<s|n<<i|r,$i=t}function Yi(t){null!==t.return&&(Xi(t,1),Ji(t,1,0))}function Zi(t){for(;t===Vi;)Vi=Fi[--Bi],Fi[Bi]=null,Hi=Fi[--Bi],Fi[Bi]=null;for(;t===Gi;)Gi=ji[--Wi],ji[Wi]=null,$i=ji[--Wi],ji[Wi]=null,qi=ji[--Wi],ji[Wi]=null}var Ki=null,Qi=null,ts=!1,es=null;function ns(t,e){var n=Ac(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,null===(e=t.deletions)?(t.deletions=[n],t.flags|=16):e.push(n)}function rs(t,e){switch(t.tag){case 5:var n=t.type;return null!==(e=1!==e.nodeType||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,Ki=t,Qi=si(e.firstChild),!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,Ki=t,Qi=null,!0);case 13:return null!==(e=8!==e.nodeType?null:e)&&(n=null!==Gi?{id:qi,overflow:$i}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},(n=Ac(18,null,null,0)).stateNode=e,n.return=t,t.child=n,Ki=t,Qi=null,!0);default:return!1}}function is(t){return 0!==(1&t.mode)&&0===(128&t.flags)}function ss(t){if(ts){var e=Qi;if(e){var n=e;if(!rs(t,e)){if(is(t))throw Error(s(418));e=si(n.nextSibling);var r=Ki;e&&rs(t,e)?ns(r,n):(t.flags=-4097&t.flags|2,ts=!1,Ki=t)}}else{if(is(t))throw Error(s(418));t.flags=-4097&t.flags|2,ts=!1,Ki=t}}}function os(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;Ki=t}function as(t){if(t!==Ki)return!1;if(!ts)return os(t),ts=!0,!1;var e;if((e=3!==t.tag)&&!(e=5!==t.tag)&&(e="head"!==(e=t.type)&&"body"!==e&&!Kr(t.type,t.memoizedProps)),e&&(e=Qi)){if(is(t))throw ls(),Error(s(418));for(;e;)ns(t,e),e=si(e.nextSibling)}if(os(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(s(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var n=t.data;if("/$"===n){if(0===e){Qi=si(t.nextSibling);break t}e--}else"$"!==n&&"$!"!==n&&"$?"!==n||e++}t=t.nextSibling}Qi=null}}else Qi=Ki?si(t.stateNode.nextSibling):null;return!0}function ls(){for(var t=Qi;t;)t=si(t.nextSibling)}function cs(){Qi=Ki=null,ts=!1}function us(t){null===es?es=[t]:es.push(t)}var hs=b.ReactCurrentBatchConfig;function ds(t,e,n){if(null!==(t=n.ref)&&"function"!==typeof t&&"object"!==typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,t));var i=r,o=""+t;return null!==e&&null!==e.ref&&"function"===typeof e.ref&&e.ref._stringRef===o?e.ref:(e=function(t){var e=i.refs;null===t?delete e[o]:e[o]=t},e._stringRef=o,e)}if("string"!==typeof t)throw Error(s(284));if(!n._owner)throw Error(s(290,t))}return t}function ps(t,e){throw t=Object.prototype.toString.call(e),Error(s(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function fs(t){return(0,t._init)(t._payload)}function ms(t){function e(e,n){if(t){var r=e.deletions;null===r?(e.deletions=[n],e.flags|=16):r.push(n)}}function n(n,r){if(!t)return null;for(;null!==r;)e(n,r),r=r.sibling;return null}function r(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(t,e){return(t=Pc(t,e)).index=0,t.sibling=null,t}function o(e,n,r){return e.index=r,t?null!==(r=e.alternate)?(r=r.index)<n?(e.flags|=2,n):r:(e.flags|=2,n):(e.flags|=1048576,n)}function a(e){return t&&null===e.alternate&&(e.flags|=2),e}function l(t,e,n,r){return null===e||6!==e.tag?((e=Nc(n,t.mode,r)).return=t,e):((e=i(e,n)).return=t,e)}function c(t,e,n,r){var s=n.type;return s===S?h(t,e,n.props.children,r,n.key):null!==e&&(e.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===L&&fs(s)===e.type)?((r=i(e,n.props)).ref=ds(t,e,n),r.return=t,r):((r=Ic(n.type,n.key,n.props,null,t.mode,r)).ref=ds(t,e,n),r.return=t,r)}function u(t,e,n,r){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=Oc(n,t.mode,r)).return=t,e):((e=i(e,n.children||[])).return=t,e)}function h(t,e,n,r,s){return null===e||7!==e.tag?((e=Rc(n,t.mode,r,s)).return=t,e):((e=i(e,n)).return=t,e)}function d(t,e,n){if("string"===typeof e&&""!==e||"number"===typeof e)return(e=Nc(""+e,t.mode,n)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case x:return(n=Ic(e.type,e.key,e.props,null,t.mode,n)).ref=ds(t,null,e),n.return=t,n;case w:return(e=Oc(e,t.mode,n)).return=t,e;case L:return d(t,(0,e._init)(e._payload),n)}if(et(e)||k(e))return(e=Rc(e,t.mode,n,null)).return=t,e;ps(t,e)}return null}function p(t,e,n,r){var i=null!==e?e.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:l(t,e,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===i?c(t,e,n,r):null;case w:return n.key===i?u(t,e,n,r):null;case L:return p(t,e,(i=n._init)(n._payload),r)}if(et(n)||k(n))return null!==i?null:h(t,e,n,r,null);ps(t,n)}return null}function f(t,e,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return l(e,t=t.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case x:return c(e,t=t.get(null===r.key?n:r.key)||null,r,i);case w:return u(e,t=t.get(null===r.key?n:r.key)||null,r,i);case L:return f(t,e,n,(0,r._init)(r._payload),i)}if(et(r)||k(r))return h(e,t=t.get(n)||null,r,i,null);ps(e,r)}return null}function m(i,s,a,l){for(var c=null,u=null,h=s,m=s=0,g=null;null!==h&&m<a.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var v=p(i,h,a[m],l);if(null===v){null===h&&(h=g);break}t&&h&&null===v.alternate&&e(i,h),s=o(v,s,m),null===u?c=v:u.sibling=v,u=v,h=g}if(m===a.length)return n(i,h),ts&&Xi(i,m),c;if(null===h){for(;m<a.length;m++)null!==(h=d(i,a[m],l))&&(s=o(h,s,m),null===u?c=h:u.sibling=h,u=h);return ts&&Xi(i,m),c}for(h=r(i,h);m<a.length;m++)null!==(g=f(h,i,m,a[m],l))&&(t&&null!==g.alternate&&h.delete(null===g.key?m:g.key),s=o(g,s,m),null===u?c=g:u.sibling=g,u=g);return t&&h.forEach((function(t){return e(i,t)})),ts&&Xi(i,m),c}function g(i,a,l,c){var u=k(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,m=a,g=a=0,v=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var _=p(i,m,y.value,c);if(null===_){null===m&&(m=v);break}t&&m&&null===_.alternate&&e(i,m),a=o(_,a,g),null===h?u=_:h.sibling=_,h=_,m=v}if(y.done)return n(i,m),ts&&Xi(i,g),u;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=d(i,y.value,c))&&(a=o(y,a,g),null===h?u=y:h.sibling=y,h=y);return ts&&Xi(i,g),u}for(m=r(i,m);!y.done;g++,y=l.next())null!==(y=f(m,i,g,y.value,c))&&(t&&null!==y.alternate&&m.delete(null===y.key?g:y.key),a=o(y,a,g),null===h?u=y:h.sibling=y,h=y);return t&&m.forEach((function(t){return e(i,t)})),ts&&Xi(i,g),u}return function t(r,s,o,l){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case x:t:{for(var c=o.key,u=s;null!==u;){if(u.key===c){if((c=o.type)===S){if(7===u.tag){n(r,u.sibling),(s=i(u,o.props.children)).return=r,r=s;break t}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===L&&fs(c)===u.type){n(r,u.sibling),(s=i(u,o.props)).ref=ds(r,u,o),s.return=r,r=s;break t}n(r,u);break}e(r,u),u=u.sibling}o.type===S?((s=Rc(o.props.children,r.mode,l,o.key)).return=r,r=s):((l=Ic(o.type,o.key,o.props,null,r.mode,l)).ref=ds(r,s,o),l.return=r,r=l)}return a(r);case w:t:{for(u=o.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){n(r,s.sibling),(s=i(s,o.children||[])).return=r,r=s;break t}n(r,s);break}e(r,s),s=s.sibling}(s=Oc(o,r.mode,l)).return=r,r=s}return a(r);case L:return t(r,s,(u=o._init)(o._payload),l)}if(et(o))return m(r,s,o,l);if(k(o))return g(r,s,o,l);ps(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==s&&6===s.tag?(n(r,s.sibling),(s=i(s,o)).return=r,r=s):(n(r,s),(s=Nc(o,r.mode,l)).return=r,r=s),a(r)):n(r,s)}}var gs=ms(!0),vs=ms(!1),ys=bi(null),_s=null,bs=null,xs=null;function ws(){xs=bs=_s=null}function Ss(t){var e=ys.current;xi(ys),t._currentValue=e}function Ms(t,e,n){for(;null!==t;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==r&&(r.childLanes|=e)):null!==r&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Es(t,e){_s=t,xs=bs=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!==(t.lanes&e)&&(ma=!0),t.firstContext=null)}function Ts(t){var e=t._currentValue;if(xs!==t)if(t={context:t,memoizedValue:e,next:null},null===bs){if(null===_s)throw Error(s(308));bs=t,_s.dependencies={lanes:0,firstContext:t}}else bs=bs.next=t;return e}var As=null;function Cs(t){null===As?As=[t]:As.push(t)}function Ps(t,e,n,r){var i=e.interleaved;return null===i?(n.next=n,Cs(e)):(n.next=i.next,i.next=n),e.interleaved=n,Is(t,r)}function Is(t,e){t.lanes|=e;var n=t.alternate;for(null!==n&&(n.lanes|=e),n=t,t=t.return;null!==t;)t.childLanes|=e,null!==(n=t.alternate)&&(n.childLanes|=e),n=t,t=t.return;return 3===n.tag?n.stateNode:null}var Rs=!1;function Ls(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ns(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Os(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ks(t,e,n){var r=t.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ml)){var i=r.pending;return null===i?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Is(t,n)}return null===(i=r.interleaved)?(e.next=e,Cs(r)):(e.next=i.next,i.next=e),r.interleaved=e,Is(t,n)}function Ds(t,e,n){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194240&n))){var r=e.lanes;n|=r&=t.pendingLanes,e.lanes=n,ve(t,n)}}function zs(t,e){var n=t.updateQueue,r=t.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?i=s=o:s=s.next=o,n=n.next}while(null!==n);null===s?i=s=e:s=s.next=e}else i=s=e;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Us(t,e,n,r){var i=t.updateQueue;Rs=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,c=l.next;l.next=null,null===o?s=c:o.next=c,o=l;var u=t.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==s){var h=i.baseState;for(o=0,u=c=l=null,a=s;;){var d=a.lane,p=a.eventTime;if((r&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});t:{var f=t,m=a;switch(d=e,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){h=f.call(p,h,d);break t}h=f;break t;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,h,d):f)||void 0===d)break t;h=z({},h,d);break t;case 2:Rs=!0}}null!==a.callback&&0!==a.lane&&(t.flags|=64,null===(d=i.effects)?i.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,o|=d;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(d=a).next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}if(null===u&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(e=i.shared.interleaved)){i=e;do{o|=i.lane,i=i.next}while(i!==e)}else null===s&&(i.shared.lanes=0);Ll|=o,t.lanes=o,t.memoizedState=h}}function Fs(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(s(191,i));i.call(r)}}}var Bs={},Vs=bi(Bs),Hs=bi(Bs),js=bi(Bs);function Ws(t){if(t===Bs)throw Error(s(174));return t}function Gs(t,e){switch(wi(js,e),wi(Hs,t),wi(Vs,Bs),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lt(null,"");break;default:e=lt(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}xi(Vs),wi(Vs,e)}function qs(){xi(Vs),xi(Hs),xi(js)}function $s(t){Ws(js.current);var e=Ws(Vs.current),n=lt(e,t.type);e!==n&&(wi(Hs,t),wi(Vs,n))}function Xs(t){Hs.current===t&&(xi(Vs),xi(Hs))}var Js=bi(0);function Ys(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Zs=[];function Ks(){for(var t=0;t<Zs.length;t++)Zs[t]._workInProgressVersionPrimary=null;Zs.length=0}var Qs=b.ReactCurrentDispatcher,to=b.ReactCurrentBatchConfig,eo=0,no=null,ro=null,io=null,so=!1,oo=!1,ao=0,lo=0;function co(){throw Error(s(321))}function uo(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!rr(t[n],e[n]))return!1;return!0}function ho(t,e,n,r,i,o){if(eo=o,no=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Qs.current=null===t||null===t.memoizedState?Jo:Yo,t=n(r,i),oo){o=0;do{if(oo=!1,ao=0,25<=o)throw Error(s(301));o+=1,io=ro=null,e.updateQueue=null,Qs.current=Zo,t=n(r,i)}while(oo)}if(Qs.current=Xo,e=null!==ro&&null!==ro.next,eo=0,io=ro=no=null,so=!1,e)throw Error(s(300));return t}function po(){var t=0!==ao;return ao=0,t}function fo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===io?no.memoizedState=io=t:io=io.next=t,io}function mo(){if(null===ro){var t=no.alternate;t=null!==t?t.memoizedState:null}else t=ro.next;var e=null===io?no.memoizedState:io.next;if(null!==e)io=e,ro=t;else{if(null===t)throw Error(s(310));t={memoizedState:(ro=t).memoizedState,baseState:ro.baseState,baseQueue:ro.baseQueue,queue:ro.queue,next:null},null===io?no.memoizedState=io=t:io=io.next=t}return io}function go(t,e){return"function"===typeof e?e(t):e}function vo(t){var e=mo(),n=e.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=t;var r=ro,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,n.pending=null}if(null!==i){o=i.next,r=r.baseState;var l=a=null,c=null,u=o;do{var h=u.lane;if((eo&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,a=r):c=c.next=d,no.lanes|=h,Ll|=h}u=u.next}while(null!==u&&u!==o);null===c?a=r:c.next=l,rr(r,e.memoizedState)||(ma=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=c,n.lastRenderedState=r}if(null!==(t=n.interleaved)){i=t;do{o=i.lane,no.lanes|=o,Ll|=o,i=i.next}while(i!==t)}else null===i&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function yo(t){var e=mo(),n=e.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,o=e.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{o=t(o,a.action),a=a.next}while(a!==i);rr(o,e.memoizedState)||(ma=!0),e.memoizedState=o,null===e.baseQueue&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function _o(){}function bo(t,e){var n=no,r=mo(),i=e(),o=!rr(r.memoizedState,i);if(o&&(r.memoizedState=i,ma=!0),r=r.queue,Lo(So.bind(null,n,r,t),[t]),r.getSnapshot!==e||o||null!==io&&1&io.memoizedState.tag){if(n.flags|=2048,Ao(9,wo.bind(null,n,r,i,e),void 0,null),null===El)throw Error(s(349));0!==(30&eo)||xo(n,e,i)}return i}function xo(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},null===(e=no.updateQueue)?(e={lastEffect:null,stores:null},no.updateQueue=e,e.stores=[t]):null===(n=e.stores)?e.stores=[t]:n.push(t)}function wo(t,e,n,r){e.value=n,e.getSnapshot=r,Mo(e)&&Eo(t)}function So(t,e,n){return n((function(){Mo(e)&&Eo(t)}))}function Mo(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!rr(t,n)}catch(r){return!0}}function Eo(t){var e=Is(t,1);null!==e&&Kl(e,t,1,-1)}function To(t){var e=fo();return"function"===typeof t&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:go,lastRenderedState:t},e.queue=t,t=t.dispatch=Wo.bind(null,no,t),[e.memoizedState,t]}function Ao(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},null===(e=no.updateQueue)?(e={lastEffect:null,stores:null},no.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t),t}function Co(){return mo().memoizedState}function Po(t,e,n,r){var i=fo();no.flags|=t,i.memoizedState=Ao(1|e,n,void 0,void 0===r?null:r)}function Io(t,e,n,r){var i=mo();r=void 0===r?null:r;var s=void 0;if(null!==ro){var o=ro.memoizedState;if(s=o.destroy,null!==r&&uo(r,o.deps))return void(i.memoizedState=Ao(e,n,s,r))}no.flags|=t,i.memoizedState=Ao(1|e,n,s,r)}function Ro(t,e){return Po(8390656,8,t,e)}function Lo(t,e){return Io(2048,8,t,e)}function No(t,e){return Io(4,2,t,e)}function Oo(t,e){return Io(4,4,t,e)}function ko(t,e){return"function"===typeof e?(t=t(),e(t),function(){e(null)}):null!==e&&void 0!==e?(t=t(),e.current=t,function(){e.current=null}):void 0}function Do(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Io(4,4,ko.bind(null,e,t),n)}function zo(){}function Uo(t,e){var n=mo();e=void 0===e?null:e;var r=n.memoizedState;return null!==r&&null!==e&&uo(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Fo(t,e){var n=mo();e=void 0===e?null:e;var r=n.memoizedState;return null!==r&&null!==e&&uo(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Bo(t,e,n){return 0===(21&eo)?(t.baseState&&(t.baseState=!1,ma=!0),t.memoizedState=n):(rr(n,e)||(n=fe(),no.lanes|=n,Ll|=n,t.baseState=!0),e)}function Vo(t,e){var n=ye;ye=0!==n&&4>n?n:4,t(!0);var r=to.transition;to.transition={};try{t(!1),e()}finally{ye=n,to.transition=r}}function Ho(){return mo().memoizedState}function jo(t,e,n){var r=Zl(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Go(t))qo(e,n);else if(null!==(n=Ps(t,e,n,r))){Kl(n,t,r,Yl()),$o(n,e,r)}}function Wo(t,e,n){var r=Zl(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Go(t))qo(e,i);else{var s=t.alternate;if(0===t.lanes&&(null===s||0===s.lanes)&&null!==(s=e.lastRenderedReducer))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,rr(a,o)){var l=e.interleaved;return null===l?(i.next=i,Cs(e)):(i.next=l.next,l.next=i),void(e.interleaved=i)}}catch(c){}null!==(n=Ps(t,e,i,r))&&(Kl(n,t,r,i=Yl()),$o(n,e,r))}}function Go(t){var e=t.alternate;return t===no||null!==e&&e===no}function qo(t,e){oo=so=!0;var n=t.pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function $o(t,e,n){if(0!==(4194240&n)){var r=e.lanes;n|=r&=t.pendingLanes,e.lanes=n,ve(t,n)}}var Xo={readContext:Ts,useCallback:co,useContext:co,useEffect:co,useImperativeHandle:co,useInsertionEffect:co,useLayoutEffect:co,useMemo:co,useReducer:co,useRef:co,useState:co,useDebugValue:co,useDeferredValue:co,useTransition:co,useMutableSource:co,useSyncExternalStore:co,useId:co,unstable_isNewReconciler:!1},Jo={readContext:Ts,useCallback:function(t,e){return fo().memoizedState=[t,void 0===e?null:e],t},useContext:Ts,useEffect:Ro,useImperativeHandle:function(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Po(4194308,4,ko.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Po(4194308,4,t,e)},useInsertionEffect:function(t,e){return Po(4,2,t,e)},useMemo:function(t,e){var n=fo();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=fo();return e=void 0!==n?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=jo.bind(null,no,t),[r.memoizedState,t]},useRef:function(t){return t={current:t},fo().memoizedState=t},useState:To,useDebugValue:zo,useDeferredValue:function(t){return fo().memoizedState=t},useTransition:function(){var t=To(!1),e=t[0];return t=Vo.bind(null,t[1]),fo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=no,i=fo();if(ts){if(void 0===n)throw Error(s(407));n=n()}else{if(n=e(),null===El)throw Error(s(349));0!==(30&eo)||xo(r,e,n)}i.memoizedState=n;var o={value:n,getSnapshot:e};return i.queue=o,Ro(So.bind(null,r,o,t),[t]),r.flags|=2048,Ao(9,wo.bind(null,r,o,n,e),void 0,null),n},useId:function(){var t=fo(),e=El.identifierPrefix;if(ts){var n=$i;e=":"+e+"R"+(n=(qi&~(1<<32-se(qi)-1)).toString(32)+n),0<(n=ao++)&&(e+="H"+n.toString(32)),e+=":"}else e=":"+e+"r"+(n=lo++).toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Yo={readContext:Ts,useCallback:Uo,useContext:Ts,useEffect:Lo,useImperativeHandle:Do,useInsertionEffect:No,useLayoutEffect:Oo,useMemo:Fo,useReducer:vo,useRef:Co,useState:function(){return vo(go)},useDebugValue:zo,useDeferredValue:function(t){return Bo(mo(),ro.memoizedState,t)},useTransition:function(){return[vo(go)[0],mo().memoizedState]},useMutableSource:_o,useSyncExternalStore:bo,useId:Ho,unstable_isNewReconciler:!1},Zo={readContext:Ts,useCallback:Uo,useContext:Ts,useEffect:Lo,useImperativeHandle:Do,useInsertionEffect:No,useLayoutEffect:Oo,useMemo:Fo,useReducer:yo,useRef:Co,useState:function(){return yo(go)},useDebugValue:zo,useDeferredValue:function(t){var e=mo();return null===ro?e.memoizedState=t:Bo(e,ro.memoizedState,t)},useTransition:function(){return[yo(go)[0],mo().memoizedState]},useMutableSource:_o,useSyncExternalStore:bo,useId:Ho,unstable_isNewReconciler:!1};function Ko(t,e){if(t&&t.defaultProps){for(var n in e=z({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}return e}function Qo(t,e,n,r){n=null===(n=n(r,e=t.memoizedState))||void 0===n?e:z({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var ta={isMounted:function(t){return!!(t=t._reactInternals)&&Vt(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Yl(),i=Zl(t),s=Os(r,i);s.payload=e,void 0!==n&&null!==n&&(s.callback=n),null!==(e=ks(t,s,i))&&(Kl(e,t,i,r),Ds(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Yl(),i=Zl(t),s=Os(r,i);s.tag=1,s.payload=e,void 0!==n&&null!==n&&(s.callback=n),null!==(e=ks(t,s,i))&&(Kl(e,t,i,r),Ds(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Yl(),r=Zl(t),i=Os(n,r);i.tag=2,void 0!==e&&null!==e&&(i.callback=e),null!==(e=ks(t,i,r))&&(Kl(e,t,r,n),Ds(e,t,r))}};function ea(t,e,n,r,i,s,o){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(r,s,o):!e.prototype||!e.prototype.isPureReactComponent||(!ir(n,r)||!ir(i,s))}function na(t,e,n){var r=!1,i=Si,s=e.contextType;return"object"===typeof s&&null!==s?s=Ts(s):(i=Ci(e)?Ti:Mi.current,s=(r=null!==(r=e.contextTypes)&&void 0!==r)?Ai(t,i):Si),e=new e(n,s),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=ta,t.stateNode=e,e._reactInternals=t,r&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function ra(t,e,n,r){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,r),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&ta.enqueueReplaceState(e,e.state,null)}function ia(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Ls(t);var s=e.contextType;"object"===typeof s&&null!==s?i.context=Ts(s):(s=Ci(e)?Ti:Mi.current,i.context=Ai(t,s)),i.state=t.memoizedState,"function"===typeof(s=e.getDerivedStateFromProps)&&(Qo(t,e,s,n),i.state=t.memoizedState),"function"===typeof e.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(e=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),e!==i.state&&ta.enqueueReplaceState(i,i.state,null),Us(t,n,i,r),i.state=t.memoizedState),"function"===typeof i.componentDidMount&&(t.flags|=4194308)}function sa(t,e){try{var n="",r=e;do{n+=V(r),r=r.return}while(r);var i=n}catch(s){i="\nError generating stack: "+s.message+"\n"+s.stack}return{value:t,source:e,stack:i,digest:null}}function oa(t,e,n){return{value:t,source:null,stack:null!=n?n:null,digest:null!=e?e:null}}function aa(t,e){try{console.error(e.value)}catch(n){setTimeout((function(){throw n}))}}var la="function"===typeof WeakMap?WeakMap:Map;function ca(t,e,n){(n=Os(-1,n)).tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Bl||(Bl=!0,Vl=r),aa(0,e)},n}function ua(t,e,n){(n=Os(-1,n)).tag=3;var r=t.type.getDerivedStateFromError;if("function"===typeof r){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){aa(0,e)}}var s=t.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){aa(0,e),"function"!==typeof r&&(null===Hl?Hl=new Set([this]):Hl.add(this));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),n}function ha(t,e,n){var r=t.pingCache;if(null===r){r=t.pingCache=new la;var i=new Set;r.set(e,i)}else void 0===(i=r.get(e))&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=xc.bind(null,t,e,n),e.then(t,t))}function da(t){do{var e;if((e=13===t.tag)&&(e=null===(e=t.memoizedState)||null!==e.dehydrated),e)return t;t=t.return}while(null!==t);return null}function pa(t,e,n,r,i){return 0===(1&t.mode)?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((e=Os(-1,1)).tag=2,ks(n,e,1))),n.lanes|=1),t):(t.flags|=65536,t.lanes=i,t)}var fa=b.ReactCurrentOwner,ma=!1;function ga(t,e,n,r){e.child=null===t?vs(e,null,n,r):gs(e,t.child,n,r)}function va(t,e,n,r,i){n=n.render;var s=e.ref;return Es(e,i),r=ho(t,e,n,r,s,i),n=po(),null===t||ma?(ts&&n&&Yi(e),e.flags|=1,ga(t,e,r,i),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Ba(t,e,i))}function ya(t,e,n,r,i){if(null===t){var s=n.type;return"function"!==typeof s||Cc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=Ic(n.type,null,r,e,e.mode,i)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=s,_a(t,e,s,r,i))}if(s=t.child,0===(t.lanes&i)){var o=s.memoizedProps;if((n=null!==(n=n.compare)?n:ir)(o,r)&&t.ref===e.ref)return Ba(t,e,i)}return e.flags|=1,(t=Pc(s,r)).ref=e.ref,t.return=e,e.child=t}function _a(t,e,n,r,i){if(null!==t){var s=t.memoizedProps;if(ir(s,r)&&t.ref===e.ref){if(ma=!1,e.pendingProps=r=s,0===(t.lanes&i))return e.lanes=t.lanes,Ba(t,e,i);0!==(131072&t.flags)&&(ma=!0)}}return wa(t,e,n,r,i)}function ba(t,e,n){var r=e.pendingProps,i=r.children,s=null!==t?t.memoizedState:null;if("hidden"===r.mode)if(0===(1&e.mode))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},wi(Pl,Cl),Cl|=n;else{if(0===(1073741824&n))return t=null!==s?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,wi(Pl,Cl),Cl|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==s?s.baseLanes:n,wi(Pl,Cl),Cl|=r}else null!==s?(r=s.baseLanes|n,e.memoizedState=null):r=n,wi(Pl,Cl),Cl|=r;return ga(t,e,i,n),e.child}function xa(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function wa(t,e,n,r,i){var s=Ci(n)?Ti:Mi.current;return s=Ai(e,s),Es(e,i),n=ho(t,e,n,r,s,i),r=po(),null===t||ma?(ts&&r&&Yi(e),e.flags|=1,ga(t,e,n,i),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Ba(t,e,i))}function Sa(t,e,n,r,i){if(Ci(n)){var s=!0;Li(e)}else s=!1;if(Es(e,i),null===e.stateNode)Fa(t,e),na(e,n,r),ia(e,n,r,i),r=!0;else if(null===t){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=Ts(c):c=Ai(e,c=Ci(n)?Ti:Mi.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==r||l!==c)&&ra(e,o,r,c),Rs=!1;var d=e.memoizedState;o.state=d,Us(e,r,o,i),l=e.memoizedState,a!==r||d!==l||Ei.current||Rs?("function"===typeof u&&(Qo(e,n,u,r),l=e.memoizedState),(a=Rs||ea(e,n,a,r,d,l,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(e.flags|=4194308)):("function"===typeof o.componentDidMount&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):("function"===typeof o.componentDidMount&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Ns(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Ko(e.type,a),o.props=c,h=e.pendingProps,d=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=Ts(l):l=Ai(e,l=Ci(n)?Ti:Mi.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==h||d!==l)&&ra(e,o,r,l),Rs=!1,d=e.memoizedState,o.state=d,Us(e,r,o,i);var f=e.memoizedState;a!==h||d!==f||Ei.current||Rs?("function"===typeof p&&(Qo(e,n,p,r),f=e.memoizedState),(c=Rs||ea(e,n,c,r,d,f,l)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,l)),"function"===typeof o.componentDidUpdate&&(e.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof o.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=f),o.props=r,o.state=f,o.context=l,r=c):("function"!==typeof o.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),r=!1)}return Ma(t,e,n,r,s,i)}function Ma(t,e,n,r,i,s){xa(t,e);var o=0!==(128&e.flags);if(!r&&!o)return i&&Ni(e,n,!1),Ba(t,e,s);r=e.stateNode,fa.current=e;var a=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return e.flags|=1,null!==t&&o?(e.child=gs(e,t.child,null,s),e.child=gs(e,null,a,s)):ga(t,e,a,s),e.memoizedState=r.state,i&&Ni(e,n,!0),e.child}function Ea(t){var e=t.stateNode;e.pendingContext?Ii(0,e.pendingContext,e.pendingContext!==e.context):e.context&&Ii(0,e.context,!1),Gs(t,e.containerInfo)}function Ta(t,e,n,r,i){return cs(),us(i),e.flags|=256,ga(t,e,n,r),e.child}var Aa,Ca,Pa,Ia,Ra={dehydrated:null,treeContext:null,retryLane:0};function La(t){return{baseLanes:t,cachePool:null,transitions:null}}function Na(t,e,n){var r,i=e.pendingProps,o=Js.current,a=!1,l=0!==(128&e.flags);if((r=l)||(r=(null===t||null!==t.memoizedState)&&0!==(2&o)),r?(a=!0,e.flags&=-129):null!==t&&null===t.memoizedState||(o|=1),wi(Js,1&o),null===t)return ss(e),null!==(t=e.memoizedState)&&null!==(t=t.dehydrated)?(0===(1&e.mode)?e.lanes=1:"$!"===t.data?e.lanes=8:e.lanes=1073741824,null):(l=i.children,t=i.fallback,a?(i=e.mode,a=e.child,l={mode:"hidden",children:l},0===(1&i)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Lc(l,i,0,null),t=Rc(t,i,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=La(n),e.memoizedState=Ra,t):Oa(e,l));if(null!==(o=t.memoizedState)&&null!==(r=o.dehydrated))return function(t,e,n,r,i,o,a){if(n)return 256&e.flags?(e.flags&=-257,ka(t,e,a,r=oa(Error(s(422))))):null!==e.memoizedState?(e.child=t.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=Lc({mode:"visible",children:r.children},i,0,null),(o=Rc(o,i,a,null)).flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,0!==(1&e.mode)&&gs(e,t.child,null,a),e.child.memoizedState=La(a),e.memoizedState=Ra,o);if(0===(1&e.mode))return ka(t,e,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,ka(t,e,a,r=oa(o=Error(s(419)),r,void 0))}if(l=0!==(a&t.childLanes),ma||l){if(null!==(r=El)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|a))?0:i)&&i!==o.retryLane&&(o.retryLane=i,Is(t,i),Kl(r,t,i,-1))}return hc(),ka(t,e,a,r=oa(Error(s(421))))}return"$?"===i.data?(e.flags|=128,e.child=t.child,e=Sc.bind(null,t),i._reactRetry=e,null):(t=o.treeContext,Qi=si(i.nextSibling),Ki=e,ts=!0,es=null,null!==t&&(ji[Wi++]=qi,ji[Wi++]=$i,ji[Wi++]=Gi,qi=t.id,$i=t.overflow,Gi=e),e=Oa(e,r.children),e.flags|=4096,e)}(t,e,l,i,r,o,n);if(a){a=i.fallback,l=e.mode,r=(o=t.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&l)&&e.child!==o?((i=e.child).childLanes=0,i.pendingProps=c,e.deletions=null):(i=Pc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?a=Pc(r,a):(a=Rc(a,l,n,null)).flags|=2,a.return=e,i.return=e,i.sibling=a,e.child=i,i=a,a=e.child,l=null===(l=t.child.memoizedState)?La(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=t.childLanes&~n,e.memoizedState=Ra,i}return t=(a=t.child).sibling,i=Pc(a,{mode:"visible",children:i.children}),0===(1&e.mode)&&(i.lanes=n),i.return=e,i.sibling=null,null!==t&&(null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Oa(t,e){return(e=Lc({mode:"visible",children:e},t.mode,0,null)).return=t,t.child=e}function ka(t,e,n,r){return null!==r&&us(r),gs(e,t.child,null,n),(t=Oa(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function Da(t,e,n){t.lanes|=e;var r=t.alternate;null!==r&&(r.lanes|=e),Ms(t.return,e,n)}function za(t,e,n,r,i){var s=t.memoizedState;null===s?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Ua(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(ga(t,e,r.children,n),0!==(2&(r=Js.current)))r=1&r|2,e.flags|=128;else{if(null!==t&&0!==(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&Da(t,n,e);else if(19===t.tag)Da(t,n,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(wi(Js,r),0===(1&e.mode))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;null!==n;)null!==(t=n.alternate)&&null===Ys(t)&&(i=n),n=n.sibling;null===(n=i)?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),za(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;null!==i;){if(null!==(t=i.alternate)&&null===Ys(t)){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}za(e,!0,n,null,s);break;case"together":za(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Fa(t,e){0===(1&e.mode)&&null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ba(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),Ll|=e.lanes,0===(n&e.childLanes))return null;if(null!==t&&e.child!==t.child)throw Error(s(153));if(null!==e.child){for(n=Pc(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=Pc(t,t.pendingProps)).return=e;n.sibling=null}return e.child}function Va(t,e){if(!ts)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?e||null===t.tail?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ha(t){var e=null!==t.alternate&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=t,i=i.sibling;else for(i=t.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function ja(t,e,n){var r=e.pendingProps;switch(Zi(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ha(e),null;case 1:case 17:return Ci(e.type)&&Pi(),Ha(e),null;case 3:return r=e.stateNode,qs(),xi(Ei),xi(Mi),Ks(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==t&&null!==t.child||(as(e)?e.flags|=4:null===t||t.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,null!==es&&(nc(es),es=null))),Ca(t,e),Ha(e),null;case 5:Xs(e);var i=Ws(js.current);if(n=e.type,null!==t&&null!=e.stateNode)Pa(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(null===e.stateNode)throw Error(s(166));return Ha(e),null}if(t=Ws(Vs.current),as(e)){r=e.stateNode,n=e.type;var o=e.memoizedProps;switch(r[li]=e,r[ci]=o,t=0!==(1&e.mode),n){case"dialog":kr("cancel",r),kr("close",r);break;case"iframe":case"object":case"embed":kr("load",r);break;case"video":case"audio":for(i=0;i<Rr.length;i++)kr(Rr[i],r);break;case"source":kr("error",r);break;case"img":case"image":case"link":kr("error",r),kr("load",r);break;case"details":kr("toggle",r);break;case"input":Y(r,o),kr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},kr("invalid",r);break;case"textarea":it(r,o),kr("invalid",r)}for(var l in vt(n,o),i=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&Xr(r.textContent,c,t),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Xr(r.textContent,c,t),i=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&kr("scroll",r)}switch(n){case"input":q(r),Q(r,o,!0);break;case"textarea":q(r),ot(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=Jr)}r=i,e.updateQueue=r,null!==r&&(e.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===t&&(t=at(n)),"http://www.w3.org/1999/xhtml"===t?"script"===n?((t=l.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"===typeof r.is?t=l.createElement(n,{is:r.is}):(t=l.createElement(n),"select"===n&&(l=t,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):t=l.createElementNS(t,n),t[li]=e,t[ci]=r,Aa(t,e,!1,!1),e.stateNode=t;t:{switch(l=yt(n,r),n){case"dialog":kr("cancel",t),kr("close",t),i=r;break;case"iframe":case"object":case"embed":kr("load",t),i=r;break;case"video":case"audio":for(i=0;i<Rr.length;i++)kr(Rr[i],t);i=r;break;case"source":kr("error",t),i=r;break;case"img":case"image":case"link":kr("error",t),kr("load",t),i=r;break;case"details":kr("toggle",t),i=r;break;case"input":Y(t,r),i=J(t,r),kr("invalid",t);break;case"option":default:i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=z({},r,{value:void 0}),kr("invalid",t);break;case"textarea":it(t,r),i=rt(t,r),kr("invalid",t)}for(o in vt(n,i),c=i)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?mt(t,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&ut(t,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&ht(t,u):"number"===typeof u&&ht(t,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(a.hasOwnProperty(o)?null!=u&&"onScroll"===o&&kr("scroll",t):null!=u&&_(t,o,u,l))}switch(n){case"input":q(t),Q(t,r,!1);break;case"textarea":q(t),ot(t);break;case"option":null!=r.value&&t.setAttribute("value",""+W(r.value));break;case"select":t.multiple=!!r.multiple,null!=(o=r.value)?nt(t,!!r.multiple,o,!1):null!=r.defaultValue&&nt(t,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(t.onclick=Jr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break t;case"img":r=!0;break t;default:r=!1}}r&&(e.flags|=4)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return Ha(e),null;case 6:if(t&&null!=e.stateNode)Ia(t,e,t.memoizedProps,r);else{if("string"!==typeof r&&null===e.stateNode)throw Error(s(166));if(n=Ws(js.current),Ws(Vs.current),as(e)){if(r=e.stateNode,n=e.memoizedProps,r[li]=e,(o=r.nodeValue!==n)&&null!==(t=Ki))switch(t.tag){case 3:Xr(r.nodeValue,n,0!==(1&t.mode));break;case 5:!0!==t.memoizedProps.suppressHydrationWarning&&Xr(r.nodeValue,n,0!==(1&t.mode))}o&&(e.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[li]=e,e.stateNode=r}return Ha(e),null;case 13:if(xi(Js),r=e.memoizedState,null===t||null!==t.memoizedState&&null!==t.memoizedState.dehydrated){if(ts&&null!==Qi&&0!==(1&e.mode)&&0===(128&e.flags))ls(),cs(),e.flags|=98560,o=!1;else if(o=as(e),null!==r&&null!==r.dehydrated){if(null===t){if(!o)throw Error(s(318));if(!(o=null!==(o=e.memoizedState)?o.dehydrated:null))throw Error(s(317));o[li]=e}else cs(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;Ha(e),o=!1}else null!==es&&(nc(es),es=null),o=!0;if(!o)return 65536&e.flags?e:null}return 0!==(128&e.flags)?(e.lanes=n,e):((r=null!==r)!==(null!==t&&null!==t.memoizedState)&&r&&(e.child.flags|=8192,0!==(1&e.mode)&&(null===t||0!==(1&Js.current)?0===Il&&(Il=3):hc())),null!==e.updateQueue&&(e.flags|=4),Ha(e),null);case 4:return qs(),Ca(t,e),null===t&&Ur(e.stateNode.containerInfo),Ha(e),null;case 10:return Ss(e.type._context),Ha(e),null;case 19:if(xi(Js),null===(o=e.memoizedState))return Ha(e),null;if(r=0!==(128&e.flags),null===(l=o.rendering))if(r)Va(o,!1);else{if(0!==Il||null!==t&&0!==(128&t.flags))for(t=e.child;null!==t;){if(null!==(l=Ys(t))){for(e.flags|=128,Va(o,!1),null!==(r=l.updateQueue)&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;null!==n;)t=r,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,t=l.dependencies,o.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return wi(Js,1&Js.current|2),e.child}t=t.sibling}null!==o.tail&&Yt()>Ul&&(e.flags|=128,r=!0,Va(o,!1),e.lanes=4194304)}else{if(!r)if(null!==(t=Ys(l))){if(e.flags|=128,r=!0,null!==(n=t.updateQueue)&&(e.updateQueue=n,e.flags|=4),Va(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!ts)return Ha(e),null}else 2*Yt()-o.renderingStartTime>Ul&&1073741824!==n&&(e.flags|=128,r=!0,Va(o,!1),e.lanes=4194304);o.isBackwards?(l.sibling=e.child,e.child=l):(null!==(n=o.last)?n.sibling=l:e.child=l,o.last=l)}return null!==o.tail?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Yt(),e.sibling=null,n=Js.current,wi(Js,r?1&n|2:1&n),e):(Ha(e),null);case 22:case 23:return ac(),r=null!==e.memoizedState,null!==t&&null!==t.memoizedState!==r&&(e.flags|=8192),r&&0!==(1&e.mode)?0!==(1073741824&Cl)&&(Ha(e),6&e.subtreeFlags&&(e.flags|=8192)):Ha(e),null;case 24:case 25:return null}throw Error(s(156,e.tag))}function Wa(t,e){switch(Zi(e),e.tag){case 1:return Ci(e.type)&&Pi(),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return qs(),xi(Ei),xi(Mi),Ks(),0!==(65536&(t=e.flags))&&0===(128&t)?(e.flags=-65537&t|128,e):null;case 5:return Xs(e),null;case 13:if(xi(Js),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(s(340));cs()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return xi(Js),null;case 4:return qs(),null;case 10:return Ss(e.type._context),null;case 22:case 23:return ac(),null;default:return null}}Aa=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)t.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ca=function(){},Pa=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,Ws(Vs.current);var s,o=null;switch(n){case"input":i=J(t,i),r=J(t,r),o=[];break;case"select":i=z({},i,{value:void 0}),r=z({},r,{value:void 0}),o=[];break;case"textarea":i=rt(t,i),r=rt(t,r),o=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(t.onclick=Jr)}for(u in vt(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(o||(o=[]),o.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&kr("scroll",t),o||l===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(e.updateQueue=u)&&(e.flags|=4)}},Ia=function(t,e,n,r){n!==r&&(e.flags|=4)};var Ga=!1,qa=!1,$a="function"===typeof WeakSet?WeakSet:Set,Xa=null;function Ja(t,e){var n=t.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){bc(t,e,r)}else n.current=null}function Ya(t,e,n){try{n()}catch(r){bc(t,e,r)}}var Za=!1;function Ka(t,e,n){var r=e.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,void 0!==s&&Ya(e,n,s)}i=i.next}while(i!==r)}}function Qa(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function tl(t){var e=t.ref;if(null!==e){var n=t.stateNode;t.tag,t=n,"function"===typeof e?e(t):e.current=t}}function el(t){var e=t.alternate;null!==e&&(t.alternate=null,el(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&(delete e[li],delete e[ci],delete e[hi],delete e[di],delete e[pi])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function nl(t){return 5===t.tag||3===t.tag||4===t.tag}function rl(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||nl(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function il(t,e,n){var r=t.tag;if(5===r||6===r)t=t.stateNode,e?8===n.nodeType?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(8===n.nodeType?(e=n.parentNode).insertBefore(t,n):(e=n).appendChild(t),null!==(n=n._reactRootContainer)&&void 0!==n||null!==e.onclick||(e.onclick=Jr));else if(4!==r&&null!==(t=t.child))for(il(t,e,n),t=t.sibling;null!==t;)il(t,e,n),t=t.sibling}function sl(t,e,n){var r=t.tag;if(5===r||6===r)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(4!==r&&null!==(t=t.child))for(sl(t,e,n),t=t.sibling;null!==t;)sl(t,e,n),t=t.sibling}var ol=null,al=!1;function ll(t,e,n){for(n=n.child;null!==n;)cl(t,e,n),n=n.sibling}function cl(t,e,n){if(ie&&"function"===typeof ie.onCommitFiberUnmount)try{ie.onCommitFiberUnmount(re,n)}catch(a){}switch(n.tag){case 5:qa||Ja(n,e);case 6:var r=ol,i=al;ol=null,ll(t,e,n),al=i,null!==(ol=r)&&(al?(t=ol,n=n.stateNode,8===t.nodeType?t.parentNode.removeChild(n):t.removeChild(n)):ol.removeChild(n.stateNode));break;case 18:null!==ol&&(al?(t=ol,n=n.stateNode,8===t.nodeType?ii(t.parentNode,n):1===t.nodeType&&ii(t,n),Ve(t)):ii(ol,n.stateNode));break;case 4:r=ol,i=al,ol=n.stateNode.containerInfo,al=!0,ll(t,e,n),ol=r,al=i;break;case 0:case 11:case 14:case 15:if(!qa&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,void 0!==o&&(0!==(2&s)||0!==(4&s))&&Ya(n,e,o),i=i.next}while(i!==r)}ll(t,e,n);break;case 1:if(!qa&&(Ja(n,e),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){bc(n,e,a)}ll(t,e,n);break;case 21:ll(t,e,n);break;case 22:1&n.mode?(qa=(r=qa)||null!==n.memoizedState,ll(t,e,n),qa=r):ll(t,e,n);break;default:ll(t,e,n)}}function ul(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new $a),e.forEach((function(e){var r=Mc.bind(null,t,e);n.has(e)||(n.add(e),e.then(r,r))}))}}function hl(t,e){var n=e.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=t,a=e,l=a;t:for(;null!==l;){switch(l.tag){case 5:ol=l.stateNode,al=!1;break t;case 3:case 4:ol=l.stateNode.containerInfo,al=!0;break t}l=l.return}if(null===ol)throw Error(s(160));cl(o,a,i),ol=null,al=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(u){bc(i,e,u)}}if(12854&e.subtreeFlags)for(e=e.child;null!==e;)dl(e,t),e=e.sibling}function dl(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(hl(e,t),pl(t),4&r){try{Ka(3,t,t.return),Qa(3,t)}catch(g){bc(t,t.return,g)}try{Ka(5,t,t.return)}catch(g){bc(t,t.return,g)}}break;case 1:hl(e,t),pl(t),512&r&&null!==n&&Ja(n,n.return);break;case 5:if(hl(e,t),pl(t),512&r&&null!==n&&Ja(n,n.return),32&t.flags){var i=t.stateNode;try{ht(i,"")}catch(g){bc(t,t.return,g)}}if(4&r&&null!=(i=t.stateNode)){var o=t.memoizedProps,a=null!==n?n.memoizedProps:o,l=t.type,c=t.updateQueue;if(t.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&Z(i,o),yt(l,a);var u=yt(l,o);for(a=0;a<c.length;a+=2){var h=c[a],d=c[a+1];"style"===h?mt(i,d):"dangerouslySetInnerHTML"===h?ut(i,d):"children"===h?ht(i,d):_(i,h,d,u)}switch(l){case"input":K(i,o);break;case"textarea":st(i,o);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?nt(i,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?nt(i,!!o.multiple,o.defaultValue,!0):nt(i,!!o.multiple,o.multiple?[]:"",!1))}i[ci]=o}catch(g){bc(t,t.return,g)}}break;case 6:if(hl(e,t),pl(t),4&r){if(null===t.stateNode)throw Error(s(162));i=t.stateNode,o=t.memoizedProps;try{i.nodeValue=o}catch(g){bc(t,t.return,g)}}break;case 3:if(hl(e,t),pl(t),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ve(e.containerInfo)}catch(g){bc(t,t.return,g)}break;case 4:default:hl(e,t),pl(t);break;case 13:hl(e,t),pl(t),8192&(i=t.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(zl=Yt())),4&r&&ul(t);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&t.mode?(qa=(u=qa)||h,hl(e,t),qa=u):hl(e,t),pl(t),8192&r){if(u=null!==t.memoizedState,(t.stateNode.isHidden=u)&&!h&&0!==(1&t.mode))for(Xa=t,h=t.child;null!==h;){for(d=Xa=h;null!==Xa;){switch(f=(p=Xa).child,p.tag){case 0:case 11:case 14:case 15:Ka(4,p,p.return);break;case 1:Ja(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){r=p,n=p.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(g){bc(r,n,g)}}break;case 5:Ja(p,p.return);break;case 22:if(null!==p.memoizedState){vl(d);continue}}null!==f?(f.return=p,Xa=f):vl(d)}h=h.sibling}t:for(h=null,d=t;;){if(5===d.tag){if(null===h){h=d;try{i=d.stateNode,u?"function"===typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=d.stateNode,a=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=ft("display",a))}catch(g){bc(t,t.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){bc(t,t.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===t)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===t)break t;for(;null===d.sibling;){if(null===d.return||d.return===t)break t;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:hl(e,t),pl(t),4&r&&ul(t);case 21:}}function pl(t){var e=t.flags;if(2&e){try{t:{for(var n=t.return;null!==n;){if(nl(n)){var r=n;break t}n=n.return}throw Error(s(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(ht(i,""),r.flags&=-33),sl(t,rl(t),i);break;case 3:case 4:var o=r.stateNode.containerInfo;il(t,rl(t),o);break;default:throw Error(s(161))}}catch(a){bc(t,t.return,a)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function fl(t,e,n){Xa=t,ml(t,e,n)}function ml(t,e,n){for(var r=0!==(1&t.mode);null!==Xa;){var i=Xa,s=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Ga;if(!o){var a=i.alternate,l=null!==a&&null!==a.memoizedState||qa;a=Ga;var c=qa;if(Ga=o,(qa=l)&&!c)for(Xa=i;null!==Xa;)l=(o=Xa).child,22===o.tag&&null!==o.memoizedState?yl(i):null!==l?(l.return=o,Xa=l):yl(i);for(;null!==s;)Xa=s,ml(s,e,n),s=s.sibling;Xa=i,Ga=a,qa=c}gl(t)}else 0!==(8772&i.subtreeFlags)&&null!==s?(s.return=i,Xa=s):gl(t)}}function gl(t){for(;null!==Xa;){var e=Xa;if(0!==(8772&e.flags)){var n=e.alternate;try{if(0!==(8772&e.flags))switch(e.tag){case 0:case 11:case 15:qa||Qa(5,e);break;case 1:var r=e.stateNode;if(4&e.flags&&!qa)if(null===n)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Ko(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;null!==o&&Fs(e,o,r);break;case 3:var a=e.updateQueue;if(null!==a){if(n=null,null!==e.child)switch(e.child.tag){case 5:case 1:n=e.child.stateNode}Fs(e,a,n)}break;case 5:var l=e.stateNode;if(null===n&&4&e.flags){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===e.memoizedState){var u=e.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Ve(d)}}}break;default:throw Error(s(163))}qa||512&e.flags&&tl(e)}catch(p){bc(e,e.return,p)}}if(e===t){Xa=null;break}if(null!==(n=e.sibling)){n.return=e.return,Xa=n;break}Xa=e.return}}function vl(t){for(;null!==Xa;){var e=Xa;if(e===t){Xa=null;break}var n=e.sibling;if(null!==n){n.return=e.return,Xa=n;break}Xa=e.return}}function yl(t){for(;null!==Xa;){var e=Xa;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Qa(4,e)}catch(l){bc(e,n,l)}break;case 1:var r=e.stateNode;if("function"===typeof r.componentDidMount){var i=e.return;try{r.componentDidMount()}catch(l){bc(e,i,l)}}var s=e.return;try{tl(e)}catch(l){bc(e,s,l)}break;case 5:var o=e.return;try{tl(e)}catch(l){bc(e,o,l)}}}catch(l){bc(e,e.return,l)}if(e===t){Xa=null;break}var a=e.sibling;if(null!==a){a.return=e.return,Xa=a;break}Xa=e.return}}var _l,bl=Math.ceil,xl=b.ReactCurrentDispatcher,wl=b.ReactCurrentOwner,Sl=b.ReactCurrentBatchConfig,Ml=0,El=null,Tl=null,Al=0,Cl=0,Pl=bi(0),Il=0,Rl=null,Ll=0,Nl=0,Ol=0,kl=null,Dl=null,zl=0,Ul=1/0,Fl=null,Bl=!1,Vl=null,Hl=null,jl=!1,Wl=null,Gl=0,ql=0,$l=null,Xl=-1,Jl=0;function Yl(){return 0!==(6&Ml)?Yt():-1!==Xl?Xl:Xl=Yt()}function Zl(t){return 0===(1&t.mode)?1:0!==(2&Ml)&&0!==Al?Al&-Al:null!==hs.transition?(0===Jl&&(Jl=fe()),Jl):0!==(t=ye)?t:t=void 0===(t=window.event)?16:Je(t.type)}function Kl(t,e,n,r){if(50<ql)throw ql=0,$l=null,Error(s(185));ge(t,n,r),0!==(2&Ml)&&t===El||(t===El&&(0===(2&Ml)&&(Nl|=n),4===Il&&rc(t,Al)),Ql(t,r),1===n&&0===Ml&&0===(1&e.mode)&&(Ul=Yt()+500,ki&&Ui()))}function Ql(t,e){var n=t.callbackNode;!function(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-se(s),a=1<<o,l=i[o];-1===l?0!==(a&n)&&0===(a&r)||(i[o]=de(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}(t,e);var r=he(t,t===El?Al:0);if(0===r)null!==n&&$t(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(null!=n&&$t(n),1===e)0===t.tag?function(t){ki=!0,zi(t)}(ic.bind(null,t)):zi(ic.bind(null,t)),ni((function(){0===(6&Ml)&&Ui()})),n=null;else{switch(_e(r)){case 1:n=Kt;break;case 4:n=Qt;break;case 16:default:n=te;break;case 536870912:n=ne}n=Ec(n,tc.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function tc(t,e){if(Xl=-1,Jl=0,0!==(6&Ml))throw Error(s(327));var n=t.callbackNode;if(yc()&&t.callbackNode!==n)return null;var r=he(t,t===El?Al:0);if(0===r)return null;if(0!==(30&r)||0!==(r&t.expiredLanes)||e)e=dc(t,r);else{e=r;var i=Ml;Ml|=2;var o=uc();for(El===t&&Al===e||(Fl=null,Ul=Yt()+500,lc(t,e));;)try{fc();break}catch(l){cc(t,l)}ws(),xl.current=o,Ml=i,null!==Tl?e=0:(El=null,Al=0,e=Il)}if(0!==e){if(2===e&&(0!==(i=pe(t))&&(r=i,e=ec(t,i))),1===e)throw n=Rl,lc(t,0),rc(t,r),Ql(t,Yt()),n;if(6===e)rc(t,r);else{if(i=t.current.alternate,0===(30&r)&&!function(t){for(var e=t;;){if(16384&e.flags){var n=e.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!rr(s(),i))return!1}catch(a){return!1}}}if(n=e.child,16384&e.subtreeFlags&&null!==n)n.return=e,e=n;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(i)&&(2===(e=dc(t,r))&&(0!==(o=pe(t))&&(r=o,e=ec(t,o))),1===e))throw n=Rl,lc(t,0),rc(t,r),Ql(t,Yt()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(s(345));case 2:case 5:vc(t,Dl,Fl);break;case 3:if(rc(t,r),(130023424&r)===r&&10<(e=zl+500-Yt())){if(0!==he(t,0))break;if(((i=t.suspendedLanes)&r)!==r){Yl(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Qr(vc.bind(null,t,Dl,Fl),e);break}vc(t,Dl,Fl);break;case 4:if(rc(t,r),(4194240&r)===r)break;for(e=t.eventTimes,i=-1;0<r;){var a=31-se(r);o=1<<a,(a=e[a])>i&&(i=a),r&=~o}if(r=i,10<(r=(120>(r=Yt()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*bl(r/1960))-r)){t.timeoutHandle=Qr(vc.bind(null,t,Dl,Fl),r);break}vc(t,Dl,Fl);break;default:throw Error(s(329))}}}return Ql(t,Yt()),t.callbackNode===n?tc.bind(null,t):null}function ec(t,e){var n=kl;return t.current.memoizedState.isDehydrated&&(lc(t,e).flags|=256),2!==(t=dc(t,e))&&(e=Dl,Dl=n,null!==e&&nc(e)),t}function nc(t){null===Dl?Dl=t:Dl.push.apply(Dl,t)}function rc(t,e){for(e&=~Ol,e&=~Nl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-se(e),r=1<<n;t[n]=-1,e&=~r}}function ic(t){if(0!==(6&Ml))throw Error(s(327));yc();var e=he(t,0);if(0===(1&e))return Ql(t,Yt()),null;var n=dc(t,e);if(0!==t.tag&&2===n){var r=pe(t);0!==r&&(e=r,n=ec(t,r))}if(1===n)throw n=Rl,lc(t,0),rc(t,e),Ql(t,Yt()),n;if(6===n)throw Error(s(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,vc(t,Dl,Fl),Ql(t,Yt()),null}function sc(t,e){var n=Ml;Ml|=1;try{return t(e)}finally{0===(Ml=n)&&(Ul=Yt()+500,ki&&Ui())}}function oc(t){null!==Wl&&0===Wl.tag&&0===(6&Ml)&&yc();var e=Ml;Ml|=1;var n=Sl.transition,r=ye;try{if(Sl.transition=null,ye=1,t)return t()}finally{ye=r,Sl.transition=n,0===(6&(Ml=e))&&Ui()}}function ac(){Cl=Pl.current,xi(Pl)}function lc(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(-1!==n&&(t.timeoutHandle=-1,ti(n)),null!==Tl)for(n=Tl.return;null!==n;){var r=n;switch(Zi(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Pi();break;case 3:qs(),xi(Ei),xi(Mi),Ks();break;case 5:Xs(r);break;case 4:qs();break;case 13:case 19:xi(Js);break;case 10:Ss(r.type._context);break;case 22:case 23:ac()}n=n.return}if(El=t,Tl=t=Pc(t.current,null),Al=Cl=e,Il=0,Rl=null,Ol=Nl=Ll=0,Dl=kl=null,null!==As){for(e=0;e<As.length;e++)if(null!==(r=(n=As[e]).interleaved)){n.interleaved=null;var i=r.next,s=n.pending;if(null!==s){var o=s.next;s.next=i,r.next=o}n.pending=r}As=null}return t}function cc(t,e){for(;;){var n=Tl;try{if(ws(),Qs.current=Xo,so){for(var r=no.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}so=!1}if(eo=0,io=ro=no=null,oo=!1,ao=0,wl.current=null,null===n||null===n.return){Il=1,Rl=e,Tl=null;break}t:{var o=t,a=n.return,l=n,c=e;if(e=Al,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=da(a);if(null!==f){f.flags&=-257,pa(f,a,l,0,e),1&f.mode&&ha(o,u,e),c=u;var m=(e=f).updateQueue;if(null===m){var g=new Set;g.add(c),e.updateQueue=g}else m.add(c);break t}if(0===(1&e)){ha(o,u,e),hc();break t}c=Error(s(426))}else if(ts&&1&l.mode){var v=da(a);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),pa(v,a,l,0,e),us(sa(c,l));break t}}o=c=sa(c,l),4!==Il&&(Il=2),null===kl?kl=[o]:kl.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e,zs(o,ca(0,c,e));break t;case 1:l=c;var y=o.type,_=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===Hl||!Hl.has(_)))){o.flags|=65536,e&=-e,o.lanes|=e,zs(o,ua(o,l,e));break t}}o=o.return}while(null!==o)}gc(n)}catch(b){e=b,Tl===n&&null!==n&&(Tl=n=n.return);continue}break}}function uc(){var t=xl.current;return xl.current=Xo,null===t?Xo:t}function hc(){0!==Il&&3!==Il&&2!==Il||(Il=4),null===El||0===(268435455&Ll)&&0===(268435455&Nl)||rc(El,Al)}function dc(t,e){var n=Ml;Ml|=2;var r=uc();for(El===t&&Al===e||(Fl=null,lc(t,e));;)try{pc();break}catch(i){cc(t,i)}if(ws(),Ml=n,xl.current=r,null!==Tl)throw Error(s(261));return El=null,Al=0,Il}function pc(){for(;null!==Tl;)mc(Tl)}function fc(){for(;null!==Tl&&!Xt();)mc(Tl)}function mc(t){var e=_l(t.alternate,t,Cl);t.memoizedProps=t.pendingProps,null===e?gc(t):Tl=e,wl.current=null}function gc(t){var e=t;do{var n=e.alternate;if(t=e.return,0===(32768&e.flags)){if(null!==(n=ja(n,e,Cl)))return void(Tl=n)}else{if(null!==(n=Wa(n,e)))return n.flags&=32767,void(Tl=n);if(null===t)return Il=6,void(Tl=null);t.flags|=32768,t.subtreeFlags=0,t.deletions=null}if(null!==(e=e.sibling))return void(Tl=e);Tl=e=t}while(null!==e);0===Il&&(Il=5)}function vc(t,e,n){var r=ye,i=Sl.transition;try{Sl.transition=null,ye=1,function(t,e,n,r){do{yc()}while(null!==Wl);if(0!==(6&Ml))throw Error(s(327));n=t.finishedWork;var i=t.finishedLanes;if(null===n)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(s(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-se(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}(t,o),t===El&&(Tl=El=null,Al=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||jl||(jl=!0,Ec(te,(function(){return yc(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Sl.transition,Sl.transition=null;var a=ye;ye=1;var l=Ml;Ml|=4,wl.current=null,function(t,e){if(Yr=je,cr(t=lr())){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else t:{var r=(n=(n=t.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(x){n=null;break t}var a=0,l=-1,c=-1,u=0,h=0,d=t,p=null;e:for(;;){for(var f;d!==n||0!==i&&3!==d.nodeType||(l=a+i),d!==o||0!==r&&3!==d.nodeType||(c=a+r),3===d.nodeType&&(a+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===t)break e;if(p===n&&++u===i&&(l=a),p===o&&++h===r&&(c=a),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Zr={focusedElem:t,selectionRange:n},je=!1,Xa=e;null!==Xa;)if(t=(e=Xa).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,Xa=t;else for(;null!==Xa;){e=Xa;try{var m=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=e.stateNode,_=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:Ko(e.type,g),v);y.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var b=e.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(s(163))}}catch(x){bc(e,e.return,x)}if(null!==(t=e.sibling)){t.return=e.return,Xa=t;break}Xa=e.return}m=Za,Za=!1}(t,n),dl(n,t),ur(Zr),je=!!Yr,Zr=Yr=null,t.current=n,fl(n,t,i),Jt(),Ml=l,ye=a,Sl.transition=o}else t.current=n;if(jl&&(jl=!1,Wl=t,Gl=i),o=t.pendingLanes,0===o&&(Hl=null),function(t){if(ie&&"function"===typeof ie.onCommitFiberRoot)try{ie.onCommitFiberRoot(re,t,void 0,128===(128&t.current.flags))}catch(e){}}(n.stateNode),Ql(t,Yt()),null!==e)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Bl)throw Bl=!1,t=Vl,Vl=null,t;0!==(1&Gl)&&0!==t.tag&&yc(),o=t.pendingLanes,0!==(1&o)?t===$l?ql++:(ql=0,$l=t):ql=0,Ui()}(t,e,n,r)}finally{Sl.transition=i,ye=r}return null}function yc(){if(null!==Wl){var t=_e(Gl),e=Sl.transition,n=ye;try{if(Sl.transition=null,ye=16>t?16:t,null===Wl)var r=!1;else{if(t=Wl,Wl=null,Gl=0,0!==(6&Ml))throw Error(s(331));var i=Ml;for(Ml|=4,Xa=t.current;null!==Xa;){var o=Xa,a=o.child;if(0!==(16&Xa.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Xa=u;null!==Xa;){var h=Xa;switch(h.tag){case 0:case 11:case 15:Ka(8,h,o)}var d=h.child;if(null!==d)d.return=h,Xa=d;else for(;null!==Xa;){var p=(h=Xa).sibling,f=h.return;if(el(h),h===u){Xa=null;break}if(null!==p){p.return=f,Xa=p;break}Xa=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Xa=o}}if(0!==(2064&o.subtreeFlags)&&null!==a)a.return=o,Xa=a;else t:for(;null!==Xa;){if(0!==(2048&(o=Xa).flags))switch(o.tag){case 0:case 11:case 15:Ka(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,Xa=y;break t}Xa=o.return}}var _=t.current;for(Xa=_;null!==Xa;){var b=(a=Xa).child;if(0!==(2064&a.subtreeFlags)&&null!==b)b.return=a,Xa=b;else t:for(a=_;null!==Xa;){if(0!==(2048&(l=Xa).flags))try{switch(l.tag){case 0:case 11:case 15:Qa(9,l)}}catch(w){bc(l,l.return,w)}if(l===a){Xa=null;break t}var x=l.sibling;if(null!==x){x.return=l.return,Xa=x;break t}Xa=l.return}}if(Ml=i,Ui(),ie&&"function"===typeof ie.onPostCommitFiberRoot)try{ie.onPostCommitFiberRoot(re,t)}catch(w){}r=!0}return r}finally{ye=n,Sl.transition=e}}return!1}function _c(t,e,n){t=ks(t,e=ca(0,e=sa(n,e),1),1),e=Yl(),null!==t&&(ge(t,1,e),Ql(t,e))}function bc(t,e,n){if(3===t.tag)_c(t,t,n);else for(;null!==e;){if(3===e.tag){_c(e,t,n);break}if(1===e.tag){var r=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Hl||!Hl.has(r))){e=ks(e,t=ua(e,t=sa(n,t),1),1),t=Yl(),null!==e&&(ge(e,1,t),Ql(e,t));break}}e=e.return}}function xc(t,e,n){var r=t.pingCache;null!==r&&r.delete(e),e=Yl(),t.pingedLanes|=t.suspendedLanes&n,El===t&&(Al&n)===n&&(4===Il||3===Il&&(130023424&Al)===Al&&500>Yt()-zl?lc(t,0):Ol|=n),Ql(t,e)}function wc(t,e){0===e&&(0===(1&t.mode)?e=1:(e=ce,0===(130023424&(ce<<=1))&&(ce=4194304)));var n=Yl();null!==(t=Is(t,e))&&(ge(t,e,n),Ql(t,n))}function Sc(t){var e=t.memoizedState,n=0;null!==e&&(n=e.retryLane),wc(t,n)}function Mc(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(s(314))}null!==r&&r.delete(e),wc(t,n)}function Ec(t,e){return qt(t,e)}function Tc(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ac(t,e,n,r){return new Tc(t,e,n,r)}function Cc(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Pc(t,e){var n=t.alternate;return null===n?((n=Ac(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&t.flags,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ic(t,e,n,r,i,o){var a=2;if(r=t,"function"===typeof t)Cc(t)&&(a=1);else if("string"===typeof t)a=5;else t:switch(t){case S:return Rc(n.children,i,o,e);case M:a=8,i|=8;break;case E:return(t=Ac(12,n,e,2|i)).elementType=E,t.lanes=o,t;case P:return(t=Ac(13,n,e,i)).elementType=P,t.lanes=o,t;case I:return(t=Ac(19,n,e,i)).elementType=I,t.lanes=o,t;case N:return Lc(n,i,o,e);default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case T:a=10;break t;case A:a=9;break t;case C:a=11;break t;case R:a=14;break t;case L:a=16,r=null;break t}throw Error(s(130,null==t?t:typeof t,""))}return(e=Ac(a,n,e,i)).elementType=t,e.type=r,e.lanes=o,e}function Rc(t,e,n,r){return(t=Ac(7,t,r,e)).lanes=n,t}function Lc(t,e,n,r){return(t=Ac(22,t,r,e)).elementType=N,t.lanes=n,t.stateNode={isHidden:!1},t}function Nc(t,e,n){return(t=Ac(6,t,null,e)).lanes=n,t}function Oc(t,e,n){return(e=Ac(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function kc(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=me(0),this.expirationTimes=me(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=me(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Dc(t,e,n,r,i,s,o,a,l){return t=new kc(t,e,n,a,l),1===e?(e=1,!0===s&&(e|=8)):e=0,s=Ac(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ls(s),t}function zc(t){if(!t)return Si;t:{if(Vt(t=t._reactInternals)!==t||1!==t.tag)throw Error(s(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(Ci(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(null!==e);throw Error(s(171))}if(1===t.tag){var n=t.type;if(Ci(n))return Ri(t,n,e)}return e}function Uc(t,e,n,r,i,s,o,a,l){return(t=Dc(n,r,!0,t,0,s,0,a,l)).context=zc(null),n=t.current,(s=Os(r=Yl(),i=Zl(n))).callback=void 0!==e&&null!==e?e:null,ks(n,s,i),t.current.lanes=i,ge(t,i,r),Ql(t,r),t}function Fc(t,e,n,r){var i=e.current,s=Yl(),o=Zl(i);return n=zc(n),null===e.context?e.context=n:e.pendingContext=n,(e=Os(s,o)).payload={element:t},null!==(r=void 0===r?null:r)&&(e.callback=r),null!==(t=ks(i,e,o))&&(Kl(t,i,o,s),Ds(t,i,o)),o}function Bc(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function Vc(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function Hc(t,e){Vc(t,e),(t=t.alternate)&&Vc(t,e)}_l=function(t,e,n){if(null!==t)if(t.memoizedProps!==e.pendingProps||Ei.current)ma=!0;else{if(0===(t.lanes&n)&&0===(128&e.flags))return ma=!1,function(t,e,n){switch(e.tag){case 3:Ea(e),cs();break;case 5:$s(e);break;case 1:Ci(e.type)&&Li(e);break;case 4:Gs(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;wi(ys,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=e.memoizedState))return null!==r.dehydrated?(wi(Js,1&Js.current),e.flags|=128,null):0!==(n&e.child.childLanes)?Na(t,e,n):(wi(Js,1&Js.current),null!==(t=Ba(t,e,n))?t.sibling:null);wi(Js,1&Js.current);break;case 19:if(r=0!==(n&e.childLanes),0!==(128&t.flags)){if(r)return Ua(t,e,n);e.flags|=128}if(null!==(i=e.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),wi(Js,Js.current),r)break;return null;case 22:case 23:return e.lanes=0,ba(t,e,n)}return Ba(t,e,n)}(t,e,n);ma=0!==(131072&t.flags)}else ma=!1,ts&&0!==(1048576&e.flags)&&Ji(e,Hi,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Fa(t,e),t=e.pendingProps;var i=Ai(e,Mi.current);Es(e,n),i=ho(null,e,r,t,i,n);var o=po();return e.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ci(r)?(o=!0,Li(e)):o=!1,e.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Ls(e),i.updater=ta,e.stateNode=i,i._reactInternals=e,ia(e,r,t,n),e=Ma(null,e,r,!0,o,n)):(e.tag=0,ts&&o&&Yi(e),ga(null,e,i,n),e=e.child),e;case 16:r=e.elementType;t:{switch(Fa(t,e),t=e.pendingProps,r=(i=r._init)(r._payload),e.type=r,i=e.tag=function(t){if("function"===typeof t)return Cc(t)?1:0;if(void 0!==t&&null!==t){if((t=t.$$typeof)===C)return 11;if(t===R)return 14}return 2}(r),t=Ko(r,t),i){case 0:e=wa(null,e,r,t,n);break t;case 1:e=Sa(null,e,r,t,n);break t;case 11:e=va(null,e,r,t,n);break t;case 14:e=ya(null,e,r,Ko(r.type,t),n);break t}throw Error(s(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,wa(t,e,r,i=e.elementType===r?i:Ko(r,i),n);case 1:return r=e.type,i=e.pendingProps,Sa(t,e,r,i=e.elementType===r?i:Ko(r,i),n);case 3:t:{if(Ea(e),null===t)throw Error(s(387));r=e.pendingProps,i=(o=e.memoizedState).element,Ns(t,e),Us(e,r,null,n);var a=e.memoizedState;if(r=a.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=o,e.memoizedState=o,256&e.flags){e=Ta(t,e,r,n,i=sa(Error(s(423)),e));break t}if(r!==i){e=Ta(t,e,r,n,i=sa(Error(s(424)),e));break t}for(Qi=si(e.stateNode.containerInfo.firstChild),Ki=e,ts=!0,es=null,n=vs(e,null,r,n),e.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(cs(),r===i){e=Ba(t,e,n);break t}ga(t,e,r,n)}e=e.child}return e;case 5:return $s(e),null===t&&ss(e),r=e.type,i=e.pendingProps,o=null!==t?t.memoizedProps:null,a=i.children,Kr(r,i)?a=null:null!==o&&Kr(r,o)&&(e.flags|=32),xa(t,e),ga(t,e,a,n),e.child;case 6:return null===t&&ss(e),null;case 13:return Na(t,e,n);case 4:return Gs(e,e.stateNode.containerInfo),r=e.pendingProps,null===t?e.child=gs(e,null,r,n):ga(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,va(t,e,r,i=e.elementType===r?i:Ko(r,i),n);case 7:return ga(t,e,e.pendingProps,n),e.child;case 8:case 12:return ga(t,e,e.pendingProps.children,n),e.child;case 10:t:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,a=i.value,wi(ys,r._currentValue),r._currentValue=a,null!==o)if(rr(o.value,a)){if(o.children===i.children&&!Ei.current){e=Ba(t,e,n);break t}}else for(null!==(o=e.child)&&(o.return=e);null!==o;){var l=o.dependencies;if(null!==l){a=o.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Os(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Ms(o.return,n,e),l.lanes|=n;break}c=c.next}}else if(10===o.tag)a=o.type===e.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Ms(a,n,e),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===e){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}ga(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Es(e,n),r=r(i=Ts(i)),e.flags|=1,ga(t,e,r,n),e.child;case 14:return i=Ko(r=e.type,e.pendingProps),ya(t,e,r,i=Ko(r.type,i),n);case 15:return _a(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Ko(r,i),Fa(t,e),e.tag=1,Ci(r)?(t=!0,Li(e)):t=!1,Es(e,n),na(e,r,i),ia(e,r,i,n),Ma(null,e,r,!0,t,n);case 19:return Ua(t,e,n);case 22:return ba(t,e,n)}throw Error(s(156,e.tag))};var jc="function"===typeof reportError?reportError:function(t){console.error(t)};function Wc(t){this._internalRoot=t}function Gc(t){this._internalRoot=t}function qc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}function $c(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function Xc(){}function Jc(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if("function"===typeof i){var a=i;i=function(){var t=Bc(o);a.call(t)}}Fc(e,o,t,i)}else o=function(t,e,n,r,i){if(i){if("function"===typeof r){var s=r;r=function(){var t=Bc(o);s.call(t)}}var o=Uc(e,r,t,0,null,!1,0,"",Xc);return t._reactRootContainer=o,t[ui]=o.current,Ur(8===t.nodeType?t.parentNode:t),oc(),o}for(;i=t.lastChild;)t.removeChild(i);if("function"===typeof r){var a=r;r=function(){var t=Bc(l);a.call(t)}}var l=Dc(t,0,!1,null,0,!1,0,"",Xc);return t._reactRootContainer=l,t[ui]=l.current,Ur(8===t.nodeType?t.parentNode:t),oc((function(){Fc(e,l,n,r)})),l}(n,e,t,i,r);return Bc(o)}Gc.prototype.render=Wc.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(s(409));Fc(t,e,null,null)},Gc.prototype.unmount=Wc.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;oc((function(){Fc(null,t,null,null)})),e[ui]=null}},Gc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Se();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Le.length&&0!==e&&e<Le[n].priority;n++);Le.splice(n,0,t),0===n&&De(t)}},be=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ue(e.pendingLanes);0!==n&&(ve(e,1|n),Ql(e,Yt()),0===(6&Ml)&&(Ul=Yt()+500,Ui()))}break;case 13:oc((function(){var e=Is(t,1);if(null!==e){var n=Yl();Kl(e,t,1,n)}})),Hc(t,1)}},xe=function(t){if(13===t.tag){var e=Is(t,134217728);if(null!==e)Kl(e,t,134217728,Yl());Hc(t,134217728)}},we=function(t){if(13===t.tag){var e=Zl(t),n=Is(t,e);if(null!==n)Kl(n,t,e,Yl());Hc(t,e)}},Se=function(){return ye},Me=function(t,e){var n=ye;try{return ye=t,e()}finally{ye=n}},xt=function(t,e,n){switch(e){case"input":if(K(t,n),e=n.name,"radio"===n.type&&null!=e){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=vi(r);if(!i)throw Error(s(90));$(r),K(r,i)}}}break;case"textarea":st(t,n);break;case"select":null!=(e=n.value)&&nt(t,!!n.multiple,e,!1)}},At=sc,Ct=oc;var Yc={usingClientEntryPoint:!1,Events:[mi,gi,vi,Et,Tt,sc]},Zc={findFiberByHostInstance:fi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Kc={bundleType:Zc.bundleType,version:Zc.version,rendererPackageName:Zc.rendererPackageName,rendererConfig:Zc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=Wt(t))?null:t.stateNode},findFiberByHostInstance:Zc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Qc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qc.isDisabled&&Qc.supportsFiber)try{re=Qc.inject(Kc),ie=Qc}catch(tu){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Yc,e.createPortal=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!qc(e))throw Error(s(200));return function(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:t,containerInfo:e,implementation:n}}(t,e,null,n)},e.createRoot=function(t,e){if(!qc(t))throw Error(s(299));var n=!1,r="",i=jc;return null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(n=!0),void 0!==e.identifierPrefix&&(r=e.identifierPrefix),void 0!==e.onRecoverableError&&(i=e.onRecoverableError)),e=Dc(t,1,!1,null,0,n,0,r,i),t[ui]=e.current,Ur(8===t.nodeType?t.parentNode:t),new Wc(e)},e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(s(188));throw t=Object.keys(t).join(","),Error(s(268,t))}return t=null===(t=Wt(e))?null:t.stateNode},e.flushSync=function(t){return oc(t)},e.hydrate=function(t,e,n){if(!$c(e))throw Error(s(200));return Jc(null,t,e,!0,n)},e.hydrateRoot=function(t,e,n){if(!qc(t))throw Error(s(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",a=jc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),e=Uc(e,null,t,1,null!=n?n:null,i,0,o,a),t[ui]=e.current,Ur(t),r)for(t=0;t<r.length;t++)i=(i=(n=r[t])._getVersion)(n._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Gc(e)},e.render=function(t,e,n){if(!$c(e))throw Error(s(200));return Jc(null,t,e,!1,n)},e.unmountComponentAtNode=function(t){if(!$c(t))throw Error(s(40));return!!t._reactRootContainer&&(oc((function(){Jc(null,null,t,!1,(function(){t._reactRootContainer=null,t[ui]=null}))})),!0)},e.unstable_batchedUpdates=sc,e.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!$c(n))throw Error(s(200));if(null==t||void 0===t._reactInternals)throw Error(s(38));return Jc(t,e,n,!1,r)},e.version="18.3.1-next-f1338f8080-20240426"},4391:(t,e,n)=>{"use strict";var r=n(7950);e.createRoot=r.createRoot,e.hydrateRoot=r.hydrateRoot},7950:(t,e,n)=>{"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=n(2730)},1153:(t,e,n)=>{"use strict";var r=n(5043),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(t,e,n){var r,s={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==e.key&&(c=""+e.key),void 0!==e.ref&&(u=e.ref),e)o.call(e,r)&&!l.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps)void 0===s[r]&&(s[r]=e[r]);return{$$typeof:i,type:t,key:c,ref:u,props:s,_owner:a.current}}e.Fragment=s,e.jsx=c,e.jsxs=c},4202:(t,e)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||f}function y(){}function _(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},v.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},y.prototype=v.prototype;var b=_.prototype=new y;b.constructor=_,m(b,v.prototype),b.isPureReactComponent=!0;var x=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function E(t,e,r){var i,s={},o=null,a=null;if(null!=e)for(i in void 0!==e.ref&&(a=e.ref),void 0!==e.key&&(o=""+e.key),e)w.call(e,i)&&!M.hasOwnProperty(i)&&(s[i]=e[i]);var l=arguments.length-2;if(1===l)s.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(t&&t.defaultProps)for(i in l=t.defaultProps)void 0===s[i]&&(s[i]=l[i]);return{$$typeof:n,type:t,key:o,ref:a,props:s,_owner:S.current}}function T(t){return"object"===typeof t&&null!==t&&t.$$typeof===n}var A=/\/+/g;function C(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,(function(t){return e[t]}))}(""+t.key):e.toString(36)}function P(t,e,i,s,o){var a=typeof t;"undefined"!==a&&"boolean"!==a||(t=null);var l=!1;if(null===t)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case n:case r:l=!0}}if(l)return o=o(l=t),t=""===s?"."+C(l,0):s,x(o)?(i="",null!=t&&(i=t.replace(A,"$&/")+"/"),P(o,e,i,"",(function(t){return t}))):null!=o&&(T(o)&&(o=function(t,e){return{$$typeof:n,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(o,i+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(A,"$&/")+"/")+t)),e.push(o)),1;if(l=0,s=""===s?".":s+":",x(t))for(var c=0;c<t.length;c++){var u=s+C(a=t[c],c);l+=P(a,e,i,u,o)}else if(u=function(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=p&&t[p]||t["@@iterator"])?t:null}(t),"function"===typeof u)for(t=u.call(t),c=0;!(a=t.next()).done;)l+=P(a=a.value,e,i,u=s+C(a,c++),o);else if("object"===a)throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function I(t,e,n){if(null==t)return t;var r=[],i=0;return P(t,r,"","",(function(t){return e.call(n,t,i++)})),r}function R(t){if(-1===t._status){var e=t._result;(e=e()).then((function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)}),(function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)})),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var L={current:null},N={transition:null},O={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:N,ReactCurrentOwner:S};function k(){throw Error("act(...) is not supported in production builds of React.")}e.Children={map:I,forEach:function(t,e,n){I(t,(function(){e.apply(this,arguments)}),n)},count:function(t){var e=0;return I(t,(function(){e++})),e},toArray:function(t){return I(t,(function(t){return t}))||[]},only:function(t){if(!T(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=v,e.Fragment=i,e.Profiler=o,e.PureComponent=_,e.StrictMode=s,e.Suspense=u,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,e.act=k,e.cloneElement=function(t,e,r){if(null===t||void 0===t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=m({},t.props),s=t.key,o=t.ref,a=t._owner;if(null!=e){if(void 0!==e.ref&&(o=e.ref,a=S.current),void 0!==e.key&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)w.call(e,c)&&!M.hasOwnProperty(c)&&(i[c]=void 0===e[c]&&void 0!==l?l[c]:e[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:t.type,key:s,ref:o,props:i,_owner:a}},e.createContext=function(t){return(t={$$typeof:l,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:t},t.Consumer=t},e.createElement=E,e.createFactory=function(t){var e=E.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:c,render:t}},e.isValidElement=T,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:R}},e.memo=function(t,e){return{$$typeof:h,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=N.transition;N.transition={};try{t()}finally{N.transition=e}},e.unstable_act=k,e.useCallback=function(t,e){return L.current.useCallback(t,e)},e.useContext=function(t){return L.current.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t){return L.current.useDeferredValue(t)},e.useEffect=function(t,e){return L.current.useEffect(t,e)},e.useId=function(){return L.current.useId()},e.useImperativeHandle=function(t,e,n){return L.current.useImperativeHandle(t,e,n)},e.useInsertionEffect=function(t,e){return L.current.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return L.current.useLayoutEffect(t,e)},e.useMemo=function(t,e){return L.current.useMemo(t,e)},e.useReducer=function(t,e,n){return L.current.useReducer(t,e,n)},e.useRef=function(t){return L.current.useRef(t)},e.useState=function(t){return L.current.useState(t)},e.useSyncExternalStore=function(t,e,n){return L.current.useSyncExternalStore(t,e,n)},e.useTransition=function(){return L.current.useTransition()},e.version="18.3.1"},5043:(t,e,n)=>{"use strict";t.exports=n(4202)},579:(t,e,n)=>{"use strict";t.exports=n(1153)},7234:(t,e)=>{"use strict";function n(t,e){var n=t.length;t.push(e);t:for(;0<n;){var r=n-1>>>1,i=t[r];if(!(0<s(i,e)))break t;t[r]=e,t[n]=i,n=r}}function r(t){return 0===t.length?null:t[0]}function i(t){if(0===t.length)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;t:for(var r=0,i=t.length,o=i>>>1;r<o;){var a=2*(r+1)-1,l=t[a],c=a+1,u=t[c];if(0>s(l,n))c<i&&0>s(u,l)?(t[r]=u,t[c]=n,r=c):(t[r]=l,t[a]=n,r=a);else{if(!(c<i&&0>s(u,n)))break t;t[r]=u,t[c]=n,r=c}}}return e}function s(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function b(t){for(var e=r(u);null!==e;){if(null===e.callback)i(u);else{if(!(e.startTime<=t))break;i(u),e.sortIndex=e.expirationTime,n(c,e)}e=r(u)}}function x(t){if(g=!1,b(t),!m)if(null!==r(c))m=!0,N(w);else{var e=r(u);null!==e&&O(x,e.startTime-t)}}function w(t,n){m=!1,g&&(g=!1,y(T),T=-1),f=!0;var s=p;try{for(b(n),d=r(c);null!==d&&(!(d.expirationTime>n)||t&&!P());){var o=d.callback;if("function"===typeof o){d.callback=null,p=d.priorityLevel;var a=o(d.expirationTime<=n);n=e.unstable_now(),"function"===typeof a?d.callback=a:d===r(c)&&i(c),b(n)}else i(c);d=r(c)}if(null!==d)var l=!0;else{var h=r(u);null!==h&&O(x,h.startTime-n),l=!1}return l}finally{d=null,p=s,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,E=null,T=-1,A=5,C=-1;function P(){return!(e.unstable_now()-C<A)}function I(){if(null!==E){var t=e.unstable_now();C=t;var n=!0;try{n=E(!0,t)}finally{n?S():(M=!1,E=null)}}else M=!1}if("function"===typeof _)S=function(){_(I)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,L=R.port2;R.port1.onmessage=I,S=function(){L.postMessage(null)}}else S=function(){v(I,0)};function N(t){E=t,M||(M=!0,S())}function O(t,n){T=v((function(){t(e.unstable_now())}),n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){m||f||(m=!0,N(w))},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(t){switch(p){case 1:case 2:case 3:var e=3;break;default:e=p}var n=p;p=e;try{return t()}finally{p=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=p;p=t;try{return e()}finally{p=n}},e.unstable_scheduleCallback=function(t,i,s){var o=e.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?o+s:o:s=o,t){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return t={id:h++,callback:i,priorityLevel:t,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(t.sortIndex=s,n(u,t),null===r(c)&&t===r(u)&&(g?(y(T),T=-1):g=!0,O(x,s-o))):(t.sortIndex=a,n(c,t),m||f||(m=!0,N(w))),t},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(t){var e=p;return function(){var n=p;p=e;try{return t.apply(this,arguments)}finally{p=n}}}},8853:(t,e,n)=>{"use strict";t.exports=n(7234)},5956:(t,e,n)=>{"use strict";var r=n(5043);var i="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e},s=r.useState,o=r.useEffect,a=r.useLayoutEffect,l=r.useDebugValue;function c(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!i(t,n)}catch(r){return!0}}var u="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(t,e){return e()}:function(t,e){var n=e(),r=s({inst:{value:n,getSnapshot:e}}),i=r[0].inst,u=r[1];return a((function(){i.value=n,i.getSnapshot=e,c(i)&&u({inst:i})}),[t,n,e]),o((function(){return c(i)&&u({inst:i}),t((function(){c(i)&&u({inst:i})}))}),[t]),l(n),n};e.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},5039:(t,e,n)=>{"use strict";var r=n(5043),i=n(9461);var s="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e},o=i.useSyncExternalStore,a=r.useRef,l=r.useEffect,c=r.useMemo,u=r.useDebugValue;e.useSyncExternalStoreWithSelector=function(t,e,n,r,i){var h=a(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;h=c((function(){function t(t){if(!l){if(l=!0,o=t,t=r(t),void 0!==i&&d.hasValue){var e=d.value;if(i(e,t))return a=e}return a=t}if(e=a,s(o,t))return e;var n=r(t);return void 0!==i&&i(e,n)?e:(o=t,a=n)}var o,a,l=!1,c=void 0===n?null:n;return[function(){return t(e())},null===c?void 0:function(){return t(c())}]}),[e,n,r,i]);var p=o(t,h[0],h[1]);return l((function(){d.hasValue=!0,d.value=p}),[p]),u(p),p}},9461:(t,e,n)=>{"use strict";t.exports=n(5956)},8443:(t,e,n)=>{"use strict";t.exports=n(5039)},4994:(t,e,n)=>{"use strict";n.d(e,{A:()=>vi,B:()=>_p,C:()=>_i,F:()=>mp,G:()=>Si,M:()=>Yd,R:()=>Kd,S:()=>qd,U:()=>bp,a:()=>Ri,b:()=>$d,e:()=>wi,f:()=>qi,g:()=>yi,i:()=>Ui,l:()=>oa,u:()=>xp,y:()=>Mi,z:()=>mi});const r=()=>new Map,i=t=>{const e=r();return t.forEach(((t,n)=>{e.set(n,t)})),e},s=(t,e,n)=>{let r=t.get(e);return void 0===r&&t.set(e,r=n()),r},a=()=>new Set,l=t=>t[t.length-1],c=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},u=Array.from,h=Array.isArray;class d{constructor(){this._observers=r()}on(t,e){return s(this._observers,t,a).add(e),e}once(t,e){var n=this;const r=function(){n.off(t,r),e(...arguments)};this.on(t,r)}off(t,e){const n=this._observers.get(t);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(t))}emit(t,e){return u((this._observers.get(t)||r()).values()).forEach((t=>t(...e)))}destroy(){this._observers=r()}}const p=Math.floor,f=(Math.ceil,Math.abs),m=(Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,(t,e)=>t<e?t:e),g=(t,e)=>t>e?t:e,v=(Number.isNaN,Math.pow,Math.sign,t=>0!==t?t<0:1/t<0),y=64,_=128,b=127,x=2147483647,w=Number.MAX_SAFE_INTEGER,S=(Number.MIN_SAFE_INTEGER,Number.isInteger||(t=>"number"===typeof t&&isFinite(t)&&p(t)===t)),M=(Number.isNaN,Number.parseInt,String.fromCharCode),E=(String.fromCodePoint,M(65535),/^\s*/g),T=/([A-Z])/g,A=(t,e)=>(t=>t.replace(E,""))(t.replace(T,(t=>`${e}${(t=>t.toLowerCase())(t)}`))),C="undefined"!==typeof TextEncoder?new TextEncoder:null,P=C?t=>C.encode(t):t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r};let I="undefined"===typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});I&&1===I.decode(new Uint8Array).length&&(I=null);class R{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const L=()=>new R,N=t=>{const e=new Uint8Array((t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e})(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},O=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*n),t.cpos=0),t.cbuf[t.cpos++]=e},k=O,D=(t,e)=>{for(;e>b;)O(t,_|b&e),e=p(e/128);O(t,b&e)},z=(t,e)=>{const n=v(e);for(n&&(e=-e),O(t,(e>63?_:0)|(n?y:0)|63&e),e=p(e/64);e>0;)O(t,(e>b?_:0)|b&e),e=p(e/128)},U=new Uint8Array(3e4),F=U.length/3,B=C&&C.encodeInto?(t,e)=>{if(e.length<F){const n=C.encodeInto(e,U).written||0;D(t,n);for(let e=0;e<n;e++)O(t,U[e])}else H(t,P(e))}:(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;D(t,r);for(let i=0;i<r;i++)O(t,n.codePointAt(i))},V=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=m(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(g(2*n,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},H=(t,e)=>{D(t,e.byteLength),V(t,e)},W=(t,e)=>{((t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(2*g(n,e)),t.cpos=0)})(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},G=new DataView(new ArrayBuffer(4)),q=(t,e)=>{switch(typeof e){case"string":O(t,119),B(t,e);break;case"number":S(e)&&f(e)<=x?(O(t,125),z(t,e)):(n=e,G.setFloat32(0,n),G.getFloat32(0)===n?(O(t,124),((t,e)=>{W(t,4).setFloat32(0,e,!1)})(t,e)):(O(t,123),((t,e)=>{W(t,8).setFloat64(0,e,!1)})(t,e)));break;case"bigint":O(t,122),((t,e)=>{W(t,8).setBigInt64(0,e,!1)})(t,e);break;case"object":if(null===e)O(t,126);else if(h(e)){O(t,117),D(t,e.length);for(let n=0;n<e.length;n++)q(t,e[n])}else if(e instanceof Uint8Array)O(t,116),H(t,e);else{O(t,118);const n=Object.keys(e);D(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];B(t,i),q(t,e[i])}}break;case"boolean":O(t,e?120:121);break;default:O(t,127)}var n};class $ extends R{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&D(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const X=t=>{t.count>0&&(z(t.encoder,1===t.count?t.s:-t.s),t.count>1&&D(t.encoder,t.count-2))};class J{constructor(){this.encoder=new R,this.s=0,this.count=0}write(t){this.s===t?this.count++:(X(this),this.count=1,this.s=t)}toUint8Array(){return X(this),N(this.encoder)}}const Y=t=>{if(t.count>0){const e=2*t.diff+(1===t.count?0:1);z(t.encoder,e),t.count>1&&D(t.encoder,t.count-2)}};class Z{constructor(){this.encoder=new R,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Y(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Y(this),N(this.encoder)}}class K{constructor(){this.sarr=[],this.s="",this.lensE=new J}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new R;return this.sarr.push(this.s),this.s="",B(t,this.sarr.join("")),V(t,this.lensE.toUint8Array()),N(t)}}const Q=t=>new Error(t),tt=()=>{throw Q("Method unimplemented")},et=()=>{throw Q("Unexpected case")},nt=Q("Unexpected end of array"),rt=Q("Integer out of Range");class it{constructor(t){this.arr=t,this.pos=0}}const st=t=>new it(t),ot=t=>t.pos!==t.arr.length,at=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},lt=t=>at(t,ut(t)),ct=t=>t.arr[t.pos++],ut=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const r=t.arr[t.pos++];if(e+=(r&b)*n,n*=128,r<_)return e;if(e>w)throw rt}throw nt},ht=t=>{let e=t.arr[t.pos++],n=63&e,r=64;const i=(e&y)>0?-1:1;if(0===(e&_))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n+=(e&b)*r,r*=128,e<_)return i*n;if(n>w)throw rt}throw nt},dt=I?t=>I.decode(lt(t)):t=>{let e=ut(t);if(0===e)return"";{let n=String.fromCodePoint(ct(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(ct(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},pt=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},ft=[t=>{},t=>null,ht,t=>pt(t,4).getFloat32(0,!1),t=>pt(t,8).getFloat64(0,!1),t=>pt(t,8).getBigInt64(0,!1),t=>!1,t=>!0,dt,t=>{const e=ut(t),n={};for(let r=0;r<e;r++){n[dt(t)]=mt(t)}return n},t=>{const e=ut(t),n=[];for(let r=0;r<e;r++)n.push(mt(t));return n},lt],mt=t=>ft[127-ct(t)](t);class gt extends it{constructor(t,e){super(t),this.reader=e,this.s=null,this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),ot(this)?this.count=ut(this)+1:this.count=-1),this.count--,this.s}}class vt extends it{constructor(t){super(t),this.s=0,this.count=0}read(){if(0===this.count){this.s=ht(this);const t=v(this.s);this.count=1,t&&(this.s=-this.s,this.count=ut(this)+2)}return this.count--,this.s}}class yt extends it{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const t=ht(this),e=1&t;this.diff=p(t/2),this.count=1,e&&(this.count=ut(this)+2)}return this.s+=this.diff,this.count--,this.s}}class _t{constructor(t){this.decoder=new vt(t),this.str=dt(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),e=this.str.slice(this.spos,t);return this.spos=t,e}}crypto.subtle;const bt=crypto.getRandomValues.bind(crypto),xt=(Math.random,()=>bt(new Uint32Array(1))[0]),wt=[1e7]+-1e3+-4e3+-8e3+-1e11,St=()=>wt.replace(/[018]/g,(t=>(t^xt()&15>>t/4).toString(16))),Mt=t=>new Promise(t),Et=(Promise.all.bind(Promise),t=>void 0===t?null:t);let Tt=new class{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}},At=!0;try{"undefined"!==typeof localStorage&&localStorage&&(Tt=localStorage,At=!1)}catch(Ei){}const Ct=Tt,Pt=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Pt(t,e,n+1)}},It=t=>t,Rt="undefined"!==typeof process&&process.release&&/node|io\.js/.test(process.release.name)&&"[object process]"===Object.prototype.toString.call("undefined"!==typeof process?process:0);"undefined"!==typeof navigator&&/Mac/.test(navigator.platform);let Lt;const Nt=[],Ot=()=>{if(void 0===Lt)if(Rt){Lt=r();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];"-"===r[0]?(null!==e&&Lt.set(e,""),e=r):null!==e?(Lt.set(e,r),e=null):Nt.push(r)}null!==e&&Lt.set(e,"")}else"object"===typeof location?(Lt=r(),(location.search||"?").slice(1).split("&").forEach((t=>{if(0!==t.length){const[e,n]=t.split("=");Lt.set(`--${A(e,"-")}`,n),Lt.set(`-${A(e,"-")}`,n)}}))):Lt=r();return Lt},kt=t=>Ot().has(t),Dt=t=>Et(Rt?{NODE_ENV:"production",PUBLIC_URL:"/react-elden-ring-mind-map",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUPA_ANON:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdiZHlydXJ6eXlmbXVvYmVja2l0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjkzMzAyNDcsImV4cCI6MjA0NDkwNjI0N30.s5aKdX6BdWojAewKoJwCcvBVzCHJumwbe8cok9Z0yv4",REACT_APP_SUPA_URL:"https://gbdyrurzyyfmuobeckit.supabase.co",REACT_APP_SUPVIZ:"96ai280e79vr8qgpw42kk8gj7gixre"}[t.toUpperCase().replaceAll("-","_")]:Ct.getItem(t)),zt=t=>kt("--"+t)||null!==Dt(t);zt("production");const Ut=Rt&&["true","1","2"].includes({NODE_ENV:"production",PUBLIC_URL:"/react-elden-ring-mind-map",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUPA_ANON:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdiZHlydXJ6eXlmbXVvYmVja2l0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjkzMzAyNDcsImV4cCI6MjA0NDkwNjI0N30.s5aKdX6BdWojAewKoJwCcvBVzCHJumwbe8cok9Z0yv4",REACT_APP_SUPA_URL:"https://gbdyrurzyyfmuobeckit.supabase.co",REACT_APP_SUPVIZ:"96ai280e79vr8qgpw42kk8gj7gixre"}.FORCE_COLOR)||!kt("--no-colors")&&!zt("no-color")&&(!Rt||process.stdout.isTTY)&&(!Rt||kt("--color")||null!==Dt("COLORTERM")||(Dt("TERM")||"").includes("color")),Ft=t=>new Uint8Array(t);class Bt{constructor(t,e){this.left=t,this.right=e}}const Vt=(t,e)=>new Bt(t,e),Ht="undefined"!==typeof document?document:{},jt=("undefined"!==typeof DOMParser&&new DOMParser,t=>((t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n})(t,((t,e)=>`${e}:${t};`)).join("")),Wt=(Ht.ELEMENT_NODE,Ht.TEXT_NODE,Ht.CDATA_SECTION_NODE,Ht.COMMENT_NODE,Ht.DOCUMENT_NODE,Ht.DOCUMENT_TYPE_NODE,Ht.DOCUMENT_FRAGMENT_NODE,Symbol),Gt=Date.now,qt=Wt(),$t=Wt(),Xt=Wt(),Jt=Wt(),Yt=Wt(),Zt=Wt(),Kt=Wt(),Qt=Wt(),te=Wt();Gt();const ee={[qt]:Vt("font-weight","bold"),[$t]:Vt("font-weight","normal"),[Xt]:Vt("color","blue"),[Yt]:Vt("color","green"),[Jt]:Vt("color","grey"),[Zt]:Vt("color","red"),[Kt]:Vt("color","purple"),[Qt]:Vt("color","orange"),[te]:Vt("color","black")},ne=Ut?t=>{1===t.length&&t[0]?.constructor===Function&&(t=t[0]());const e=[],n=[],i=r();let s=[],o=0;for(;o<t.length;o++){const r=t[o],s=ee[r];if(void 0!==s)i.set(s.left,s.right);else{if(void 0===r)break;if(r.constructor!==String&&r.constructor!==Number)break;{const t=jt(i);o>0||t.length>0?(e.push("%c"+r),n.push(t)):e.push(r)}}}for(o>0&&(s=n,s.unshift(e.join("")));o<t.length;o++){const e=t[o];e instanceof Symbol||s.push(e)}return s}:t=>{1===t.length&&t[0]?.constructor===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const n=t[r];if(void 0===n)break;if(n.constructor===String||n.constructor===Number)e.push(n);else if(n.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const e=t[r];e instanceof Symbol||n.push(e)}return n},re=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console.log(...ne(e)),se.forEach((t=>t.print(e)))},ie=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console.warn(...ne(e)),e.unshift(Qt),se.forEach((t=>t.print(e)))},se=a();const oe=t=>({[Symbol.iterator](){return this},next:t}),ae=(t,e)=>oe((()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}})),le=Object.assign,ce=Object.keys,ue=t=>ce(t).length,he=(t,e)=>t===e||ue(t)===ue(e)&&((t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0})(t,((t,n)=>(void 0!==t||((t,e)=>Object.prototype.hasOwnProperty.call(t,e))(e,n))&&e[n]===t)),de=Object.freeze,pe=t=>{for(const e in t){const n=t[e];"object"!==typeof n&&"function"!==typeof n||pe(t[e])}return de(t)};class fe{constructor(t,e){this.clock=t,this.len=e}}class me{constructor(){this.clients=new Map}}const ge=(t,e,n)=>e.clients.forEach(((e,r)=>{const i=t.doc.store.clients.get(r);for(let s=0;s<e.length;s++){const r=e[s];hn(t,i,r.clock,r.len,n)}})),ve=(t,e)=>{const n=t.clients.get(e.client);return void 0!==n&&null!==((t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=p((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null})(n,e.clock)},ye=t=>{t.clients.forEach((t=>{let e,n;for(t.sort(((t,e)=>t.clock-e.clock)),e=1,n=1;e<t.length;e++){const r=t[n-1],i=t[e];r.clock+r.len>=i.clock?r.len=g(r.len,i.clock+i.len-r.clock):(n<e&&(t[n]=i),n++)}t.length=n}))},_e=t=>{const e=new me;for(let n=0;n<t.length;n++)t[n].clients.forEach(((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let e=n+1;e<t.length;e++)c(s,t[e].clients.get(i)||[]);e.clients.set(i,s)}}));return ye(e),e},be=(t,e,n,r)=>{s(t.clients,e,(()=>[])).push(new fe(n,r))},xe=()=>new me,we=t=>{const e=xe();return t.clients.forEach(((t,n)=>{const r=[];for(let e=0;e<t.length;e++){const n=t[e];if(n.deleted){const i=n.id.clock;let s=n.length;if(e+1<t.length)for(let n=t[e+1];e+1<t.length&&n.deleted;n=t[1+ ++e])s+=n.length;r.push(new fe(i,s))}}r.length>0&&e.clients.set(n,r)})),e},Se=(t,e)=>{D(t.restEncoder,e.clients.size),u(e.clients.entries()).sort(((t,e)=>e[0]-t[0])).forEach((e=>{let[n,r]=e;t.resetDsCurVal(),D(t.restEncoder,n);const i=r.length;D(t.restEncoder,i);for(let s=0;s<i;s++){const e=r[s];t.writeDsClock(e.clock),t.writeDsLen(e.len)}}))},Me=t=>{const e=new me,n=ut(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const n=ut(t.restDecoder),r=ut(t.restDecoder);if(r>0){const i=s(e.clients,n,(()=>[]));for(let e=0;e<r;e++)i.push(new fe(t.readDsClock(),t.readDsLen()))}}return e},Ee=(t,e,n)=>{const r=new me,i=ut(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const i=ut(t.restDecoder),s=ut(t.restDecoder),o=n.clients.get(i)||[],a=rn(n,i);for(let n=0;n<s;n++){const n=t.readDsClock(),s=n+t.readDsLen();if(n<a){a<s&&be(r,i,a,s-a);let t=on(o,n),l=o[t];for(!l.deleted&&l.id.clock<n&&(o.splice(t+1,0,Zr(e,l,n-l.id.clock)),t++);t<o.length&&(l=o[t++],l.id.clock<s);)l.deleted||(s<l.id.clock+l.length&&o.splice(t,0,Zr(e,l,s-l.id.clock)),l.delete(e))}else be(r,i,n,s-n)}}if(r.clients.size>0){const t=new ke;return D(t.restEncoder,0),Se(t,r),t.toUint8Array()}return null},Te=xt;class Ae extends d{constructor(){let{guid:t=St(),collectionid:e=null,gc:n=!0,gcFilter:r=()=>!0,meta:i=null,autoLoad:s=!1,shouldLoad:o=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.gc=n,this.gcFilter=r,this.clientID=Te(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new en,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=s,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Mt((t=>{this.on("load",(()=>{this.isLoaded=!0,t(this)}))}));const a=()=>Mt((t=>{const e=n=>{void 0!==n&&!0!==n||(this.off("sync",e),t())};this.on("sync",e)}));this.on("sync",(t=>{!1===t&&this.isSynced&&(this.whenSynced=a()),this.isSynced=void 0===t||!0===t,this.isSynced&&!this.isLoaded&&this.emit("load",[this])})),this.whenSynced=a()}load(){const t=this._item;null===t||this.shouldLoad||_n(t.parent.doc,(t=>{t.subdocsLoaded.add(this)}),null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(u(this.subdocs).map((t=>t.guid)))}transact(t){return _n(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vn;const n=s(this.share,t,(()=>{const t=new e;return t._integrate(this,null),t})),r=n.constructor;if(e!==Vn&&r!==e){if(r===Vn){const r=new e;r._map=n._map,n._map.forEach((t=>{for(;null!==t;t=t.left)t.parent=r})),r._start=n._start;for(let t=r._start;null!==t;t=t.right)t.parent=r;return r._length=n._length,this.share.set(t,r),r._integrate(this,null),r}throw new Error(`Type with the name ${t} has already been defined with a different constructor`)}return n}getArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.get(t,sr)}getText(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.get(t,Sr)}getMap(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.get(t,ar)}getXmlElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.get(t,Tr)}getXmlFragment(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.get(t,Er)}toJSON(){const t={};return this.share.forEach(((e,n)=>{t[n]=e.toJSON()})),t}destroy(){this.isDestroyed=!0,u(this.subdocs).forEach((t=>t.destroy()));const t=this._item;if(null!==t){this._item=null;const e=t.content;e.doc=new Ae({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,_n(t.parent.doc,(n=>{const r=e.doc;t.deleted||n.subdocsAdded.add(r),n.subdocsRemoved.add(this)}),null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Ce{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return ut(this.restDecoder)}readDsLen(){return ut(this.restDecoder)}}class Pe extends Ce{readLeftID(){return Je(ut(this.restDecoder),ut(this.restDecoder))}readRightID(){return Je(ut(this.restDecoder),ut(this.restDecoder))}readClient(){return ut(this.restDecoder)}readInfo(){return ct(this.restDecoder)}readString(){return dt(this.restDecoder)}readParentInfo(){return 1===ut(this.restDecoder)}readTypeRef(){return ut(this.restDecoder)}readLen(){return ut(this.restDecoder)}readAny(){return mt(this.restDecoder)}readBuf(){return(t=>{const e=Ft(t.byteLength);return e.set(t),e})(lt(this.restDecoder))}readJSON(){return JSON.parse(dt(this.restDecoder))}readKey(){return dt(this.restDecoder)}}class Ie{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ut(this.restDecoder),this.dsCurrVal}readDsLen(){const t=ut(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Re extends Ie{constructor(t){super(t),this.keys=[],ut(t),this.keyClockDecoder=new yt(lt(t)),this.clientDecoder=new vt(lt(t)),this.leftClockDecoder=new yt(lt(t)),this.rightClockDecoder=new yt(lt(t)),this.infoDecoder=new gt(lt(t),ct),this.stringDecoder=new _t(lt(t)),this.parentInfoDecoder=new gt(lt(t),ct),this.typeRefDecoder=new vt(lt(t)),this.lenDecoder=new vt(lt(t))}readLeftID(){return new $e(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new $e(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return mt(this.restDecoder)}readBuf(){return lt(this.restDecoder)}readJSON(){return mt(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class Le{constructor(){this.restEncoder=L()}toUint8Array(){return N(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){D(this.restEncoder,t)}writeDsLen(t){D(this.restEncoder,t)}}class Ne extends Le{writeLeftID(t){D(this.restEncoder,t.client),D(this.restEncoder,t.clock)}writeRightID(t){D(this.restEncoder,t.client),D(this.restEncoder,t.clock)}writeClient(t){D(this.restEncoder,t)}writeInfo(t){k(this.restEncoder,t)}writeString(t){B(this.restEncoder,t)}writeParentInfo(t){D(this.restEncoder,t?1:0)}writeTypeRef(t){D(this.restEncoder,t)}writeLen(t){D(this.restEncoder,t)}writeAny(t){q(this.restEncoder,t)}writeBuf(t){H(this.restEncoder,t)}writeJSON(t){B(this.restEncoder,JSON.stringify(t))}writeKey(t){B(this.restEncoder,t)}}class Oe{constructor(){this.restEncoder=L(),this.dsCurrVal=0}toUint8Array(){return N(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,D(this.restEncoder,e)}writeDsLen(t){0===t&&et(),D(this.restEncoder,t-1),this.dsCurrVal+=t}}class ke extends Oe{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Z,this.clientEncoder=new J,this.leftClockEncoder=new Z,this.rightClockEncoder=new Z,this.infoEncoder=new $(k),this.stringEncoder=new K,this.parentInfoEncoder=new $(k),this.typeRefEncoder=new J,this.lenEncoder=new J}toUint8Array(){const t=L();return D(t,0),H(t,this.keyClockEncoder.toUint8Array()),H(t,this.clientEncoder.toUint8Array()),H(t,this.leftClockEncoder.toUint8Array()),H(t,this.rightClockEncoder.toUint8Array()),H(t,N(this.infoEncoder)),H(t,this.stringEncoder.toUint8Array()),H(t,N(this.parentInfoEncoder)),H(t,this.typeRefEncoder.toUint8Array()),H(t,this.lenEncoder.toUint8Array()),V(t,N(this.restEncoder)),N(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){q(this.restEncoder,t)}writeBuf(t){H(this.restEncoder,t)}writeJSON(t){q(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);void 0===e?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const De=(t,e,n)=>{const r=new Map;n.forEach(((t,n)=>{rn(e,n)>t&&r.set(n,t)})),nn(e).forEach(((t,e)=>{n.has(e)||r.set(e,0)})),D(t.restEncoder,r.size),u(r.entries()).sort(((t,e)=>e[0]-t[0])).forEach((n=>{let[r,i]=n;((t,e,n,r)=>{r=g(r,e[0].id.clock);const i=on(e,r);D(t.restEncoder,e.length-i),t.writeClient(n),D(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)})(t,e.clients.get(r),r,i)}))},ze=function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Re(t);return _n(e,(t=>{t.local=!1;let e=!1;const n=t.doc,o=n.store,a=((t,e)=>{const n=r(),i=ut(t.restDecoder);for(let r=0;r<i;r++){const r=ut(t.restDecoder),i=new Array(r),s=t.readClient();let o=ut(t.restDecoder);n.set(s,{i:0,refs:i});for(let n=0;n<r;n++){const r=t.readInfo();switch(31&r){case 0:{const e=t.readLen();i[n]=new Rr(Je(s,o),e),o+=e;break}case 10:{const e=ut(t.restDecoder);i[n]=new ei(Je(s,o),e),o+=e;break}default:{const a=0===(192&r),l=new Kr(Je(s,o),null,(r&_)===_?t.readLeftID():null,null,(r&y)===y?t.readRightID():null,a?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,a&&32===(32&r)?t.readString():null,Qr(t,r));i[n]=l,o+=l.length}}}}return n})(i,n),l=((t,e,n)=>{const r=[];let i=u(n.keys()).sort(((t,e)=>t-e));if(0===i.length)return null;const o=()=>{if(0===i.length)return null;let t=n.get(i[i.length-1]);for(;t.refs.length===t.i;){if(i.pop(),!(i.length>0))return null;t=n.get(i[i.length-1])}return t};let a=o();if(null===a)return null;const l=new en,c=new Map,h=(t,e)=>{const n=c.get(t);(null==n||n>e)&&c.set(t,e)};let d=a.refs[a.i++];const p=new Map,f=()=>{for(const t of r){const e=t.id.client,r=n.get(e);r?(r.i--,l.clients.set(e,r.refs.slice(r.i)),n.delete(e),r.i=0,r.refs=[]):l.clients.set(e,[t]),i=i.filter((t=>t!==e))}r.length=0};for(;;){if(d.constructor!==ei){const i=s(p,d.id.client,(()=>rn(e,d.id.client)))-d.id.clock;if(i<0)r.push(d),h(d.id.client,d.id.clock-1),f();else{const s=d.getMissing(t,e);if(null!==s){r.push(d);const t=n.get(s)||{refs:[],i:0};if(t.refs.length!==t.i){d=t.refs[t.i++];continue}h(s,rn(e,s)),f()}else(0===i||i<d.length)&&(d.integrate(t,i),p.set(d.id.client,d.id.clock+d.length))}}if(r.length>0)d=r.pop();else if(null!==a&&a.i<a.refs.length)d=a.refs[a.i++];else{if(a=o(),null===a)break;d=a.refs[a.i++]}}if(l.clients.size>0){const t=new ke;return De(t,l,new Map),D(t.restEncoder,0),{missing:c,update:t.toUint8Array()}}return null})(t,o,a),c=o.pendingStructs;if(c){for(const[t,n]of c.missing)if(n<rn(o,t)){e=!0;break}if(l){for(const[t,e]of l.missing){const n=c.missing.get(t);(null==n||n>e)&&c.missing.set(t,e)}c.update=Mn([c.update,l.update])}}else o.pendingStructs=l;const h=Ee(i,t,o);if(o.pendingDs){const e=new Re(st(o.pendingDs));ut(e.restDecoder);const n=Ee(e,t,o);o.pendingDs=h&&n?Mn([h,n]):h||n}else o.pendingDs=h;if(e){const e=o.pendingStructs.update;o.pendingStructs=null,Ue(t.doc,e)}}),n,!1)},Ue=function(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Re;const i=st(e);ze(i,t,n,new r(i))},Fe=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uint8Array([0]),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ke;!function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map;De(t,e.store,n),Se(t,we(e.store))}(n,t,Ve(e));const r=[n.toUint8Array()];if(t.store.pendingDs&&r.push(t.store.pendingDs),t.store.pendingStructs&&r.push(En(t.store.pendingStructs.update,e)),r.length>1){if(n.constructor===Ne)return wn(r.map(((t,e)=>0===e?t:In(t))));if(n.constructor===ke)return Mn(r)}return r[0]},Be=t=>{const e=new Map,n=ut(t.restDecoder);for(let r=0;r<n;r++){const n=ut(t.restDecoder),r=ut(t.restDecoder);e.set(n,r)}return e},Ve=t=>Be(new Ce(st(t)));class He{constructor(){this.l=[]}}const je=()=>new He,We=(t,e)=>t.l.push(e),Ge=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter((t=>e!==t)),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},qe=(t,e,n)=>Pt(t.l,[e,n]);class $e{constructor(t,e){this.client=t,this.clock=e}}const Xe=(t,e)=>t===e||null!==t&&null!==e&&t.client===e.client&&t.clock===e.clock,Je=(t,e)=>new $e(t,e),Ye=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw et()};class Ze{constructor(t,e){this.ds=t,this.sv=e}}const Ke=(t,e)=>new Ze(t,e),Qe=(Ke(xe(),new Map),(t,e)=>void 0===e?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!ve(e.ds,t.id)),tn=(t,e)=>{const n=s(t.meta,tn,a),r=t.doc.store;n.has(e)||(e.sv.forEach(((e,n)=>{e<rn(r,n)&&cn(t,Je(n,e))})),ge(t,e.ds,(t=>{})),n.add(e))};class en{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const nn=t=>{const e=new Map;return t.clients.forEach(((t,n)=>{const r=t[t.length-1];e.set(n,r.id.clock+r.length)})),e},rn=(t,e)=>{const n=t.clients.get(e);if(void 0===n)return 0;const r=n[n.length-1];return r.id.clock+r.length},sn=(t,e)=>{let n=t.clients.get(e.id.client);if(void 0===n)n=[],t.clients.set(e.id.client,n);else{const t=n[n.length-1];if(t.id.clock+t.length!==e.id.clock)throw et()}n.push(e)},on=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=p(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=p((n+r)/2)}throw et()},an=(t,e)=>{const n=t.clients.get(e.client);return n[on(n,e.clock)]},ln=(t,e,n)=>{const r=on(e,n),i=e[r];return i.id.clock<n&&i instanceof Kr?(e.splice(r+1,0,Zr(t,i,n-i.id.clock)),r+1):r},cn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[ln(t,n,e.clock)]},un=(t,e,n)=>{const r=e.clients.get(n.client),i=on(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Rr&&r.splice(i+1,0,Zr(t,s,n.clock-s.id.clock+1)),s},hn=(t,e,n,r,i)=>{if(0===r)return;const s=n+r;let o,a=ln(t,e,n);do{o=e[a++],s<o.id.clock+o.length&&ln(t,e,s),i(o)}while(a<e.length&&e[a].id.clock<s)};class dn{constructor(t,e,n){this.doc=t,this.deleteSet=new me,this.beforeState=nn(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const pn=(t,e)=>!(0===e.deleteSet.clients.size&&!((t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1})(e.afterState,((t,n)=>e.beforeState.get(n)!==t)))&&(ye(e.deleteSet),((t,e)=>{De(t,e.doc.store,e.beforeState)})(t,e),Se(t,e.deleteSet),!0),fn=(t,e,n)=>{const r=e._item;(null===r||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&s(t.changed,e,a).add(n)},mn=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0&&(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n));n=r,r=t[--i-1])n instanceof Kr&&null!==n.parentSub&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);const s=e-i;return s&&t.splice(e+1-s,s),s},gn=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const t=e.clients.get(r);for(let r=i.length-1;r>=0;r--){const s=i[r],o=s.clock+s.len;for(let r=on(t,s.clock),i=t[r];r<t.length&&i.id.clock<o;i=t[++r]){const i=t[r];if(s.clock+s.len<=i.id.clock)break;i instanceof Kr&&i.deleted&&!i.keep&&n(i)&&i.gc(e,!1)}}}},vn=(t,e)=>{t.clients.forEach(((t,n)=>{const r=e.clients.get(n);for(let e=t.length-1;e>=0;e--){const n=t[e];for(let t=m(r.length-1,1+on(r,n.clock+n.len-1)),e=r[t];t>0&&e.id.clock>=n.clock;e=r[t])t-=1+mn(r,t)}}))},yn=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{ye(s),n.afterState=nn(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const t=[];n.changed.forEach(((e,r)=>t.push((()=>{null!==r._item&&r._item.deleted||r._callObserver(n,e)})))),t.push((()=>{n.changedParentTypes.forEach(((t,e)=>{e._dEH.l.length>0&&(null===e._item||!e._item.deleted)&&((t=t.filter((t=>null===t.target._item||!t.target._item.deleted))).forEach((t=>{t.currentTarget=e,t._path=null})),t.sort(((t,e)=>t.path.length-e.path.length)),qe(e._dEH,t,n))}))})),t.push((()=>r.emit("afterTransaction",[n,r]))),Pt(t,[]),n._needFormattingCleanup&&br(n)}finally{r.gc&&gn(s,i,r.gcFilter),vn(s,i),n.afterState.forEach(((t,e)=>{const r=n.beforeState.get(e)||0;if(r!==t){const t=i.clients.get(e),n=g(on(t,r),1);for(let e=t.length-1;e>=n;)e-=1+mn(t,e)}}));for(let t=o.length-1;t>=0;t--){const{client:e,clock:n}=o[t].id,r=i.clients.get(e),s=on(r,n);s+1<r.length&&mn(r,s+1)>1||s>0&&mn(r,s)}if(n.local||n.afterState.get(r.clientID)===n.beforeState.get(r.clientID)||(re(Qt,qt,"[yjs] ",$t,Zt,"Changed the client-id because another client seems to be using it."),r.clientID=Te()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const t=new Ne;pn(t,n)&&r.emit("update",[t.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const t=new ke;pn(t,n)&&r.emit("updateV2",[t.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=n;(a.size>0||c.size>0||l.size>0)&&(a.forEach((t=>{t.clientID=r.clientID,null==t.collectionid&&(t.collectionid=r.collectionid),r.subdocs.add(t)})),c.forEach((t=>r.subdocs.delete(t))),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,n]),c.forEach((t=>t.destroy()))),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):yn(t,e+1)}}},_n=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=t._transactionCleanups;let s=!1,o=null;null===t._transaction&&(s=!0,t._transaction=new dn(t,n,r),i.push(t._transaction),1===i.length&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const e=t._transaction===i[0];t._transaction=null,e&&yn(i,0)}}return o};class bn{constructor(t,e){this.gen=function*(t){const e=ut(t.restDecoder);for(let n=0;n<e;n++){const e=ut(t.restDecoder),n=t.readClient();let r=ut(t.restDecoder);for(let i=0;i<e;i++){const e=t.readInfo();if(10===e){const e=ut(t.restDecoder);yield new ei(Je(n,r),e),r+=e}else if(0!==(31&e)){const i=0===(192&e),s=new Kr(Je(n,r),null,(e&_)===_?t.readLeftID():null,null,(e&y)===y?t.readRightID():null,i?t.readParentInfo()?t.readString():t.readLeftID():null,i&&32===(32&e)?t.readString():null,Qr(t,e));yield s,r+=s.length}else{const e=t.readLen();yield new Rr(Je(n,r),e),r+=e}}}}(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===ei);return this.curr}}class xn{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const wn=t=>Mn(t,Pe,Ne),Sn=(t,e)=>{if(t.constructor===Rr){const{client:n,clock:r}=t.id;return new Rr(Je(n,r+e),t.length-e)}if(t.constructor===ei){const{client:n,clock:r}=t.id;return new ei(Je(n,r+e),t.length-e)}{const n=t,{client:r,clock:i}=n.id;return new Kr(Je(r,i+e),null,Je(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Mn=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Re,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ke;if(1===t.length)return t[0];const r=t.map((t=>new e(st(t))));let i=r.map((t=>new bn(t,!0))),s=null;const o=new n,a=new xn(o);for(;i=i.filter((t=>null!==t.curr)),i.sort(((t,e)=>{if(t.curr.id.client===e.curr.id.client){const n=t.curr.id.clock-e.curr.id.clock;return 0===n?t.curr.constructor===e.curr.constructor?0:t.curr.constructor===ei?1:-1:n}return e.curr.id.client-t.curr.id.client})),0!==i.length;){const t=i[0],e=t.curr.id.client;if(null!==s){let n=t.curr,r=!1;for(;null!==n&&n.id.clock+n.length<=s.struct.id.clock+s.struct.length&&n.id.client>=s.struct.id.client;)n=t.next(),r=!0;if(null===n||n.id.client!==e||r&&n.id.clock>s.struct.id.clock+s.struct.length)continue;if(e!==s.struct.id.client)An(a,s.struct,s.offset),s={struct:n,offset:0},t.next();else if(s.struct.id.clock+s.struct.length<n.id.clock)if(s.struct.constructor===ei)s.struct.length=n.id.clock+n.length-s.struct.id.clock;else{An(a,s.struct,s.offset);const t=n.id.clock-s.struct.id.clock-s.struct.length;s={struct:new ei(Je(e,s.struct.id.clock+s.struct.length),t),offset:0}}else{const e=s.struct.id.clock+s.struct.length-n.id.clock;e>0&&(s.struct.constructor===ei?s.struct.length-=e:n=Sn(n,e)),s.struct.mergeWith(n)||(An(a,s.struct,s.offset),s={struct:n,offset:0},t.next())}}else s={struct:t.curr,offset:0},t.next();for(let n=t.curr;null!==n&&n.id.client===e&&n.id.clock===s.struct.id.clock+s.struct.length&&n.constructor!==ei;n=t.next())An(a,s.struct,s.offset),s={struct:n,offset:0}}null!==s&&(An(a,s.struct,s.offset),s=null),Cn(a);const l=r.map((t=>Me(t))),c=_e(l);return Se(o,c),o.toUint8Array()},En=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Re,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ke;const i=Ve(e),s=new r,o=new xn(s),a=new n(st(t)),l=new bn(a,!1);for(;l.curr;){const t=l.curr,e=t.id.client,n=i.get(e)||0;if(l.curr.constructor!==ei)if(t.id.clock+t.length>n)for(An(o,t,g(n-t.id.clock,0)),l.next();l.curr&&l.curr.id.client===e;)An(o,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===e&&l.curr.id.clock+l.curr.length<=n;)l.next();else l.next()}Cn(o);const c=Me(a);return Se(s,c),s.toUint8Array()},Tn=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:N(t.encoder.restEncoder)}),t.encoder.restEncoder=L(),t.written=0)},An=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&Tn(t),0===t.written&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),D(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Cn=t=>{Tn(t);const e=t.encoder.restEncoder;D(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];D(e,r.written),V(e,r.restEncoder)}},Pn=(t,e,n,r)=>{const i=new n(st(t)),s=new bn(i,!1),o=new r,a=new xn(o);for(let c=s.curr;null!==c;c=s.next())An(a,e(c),0);Cn(a);const l=Me(i);return Se(o,l),o.toUint8Array()},In=t=>Pn(t,It,Re,Ne),Rn="You must not compute changes after the event-handler fired.";class Ln{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Nn(this.currentTarget,this.target))}deletes(t){return ve(this.transaction.deleteSet,t.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw Q(Rn);const t=new Map,e=this.target;this.transaction.changed.get(e).forEach((n=>{if(null!==n){const r=e._map.get(n);let i,s;if(this.adds(r)){let t=r.left;for(;null!==t&&this.adds(t);)t=t.left;if(this.deletes(r)){if(null===t||!this.deletes(t))return;i="delete",s=l(t.content.getContent())}else null!==t&&this.deletes(t)?(i="update",s=l(t.content.getContent())):(i="add",s=void 0)}else{if(!this.deletes(r))return;i="delete",s=l(r.content.getContent())}t.set(n,{action:i,oldValue:s})}})),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(null===t){if(0===this.transaction.doc._transactionCleanups.length)throw Q(Rn);const e=this.target,n=a(),r=a(),i=[];t={added:n,deleted:r,delta:i,keys:this.keys};if(this.transaction.changed.get(e).has(null)){let t=null;const s=()=>{t&&i.push(t)};for(let i=e._start;null!==i;i=i.right)i.deleted?this.deletes(i)&&!this.adds(i)&&(null!==t&&void 0!==t.delete||(s(),t={delete:0}),t.delete+=i.length,r.add(i)):this.adds(i)?(null!==t&&void 0!==t.insert||(s(),t={insert:[]}),t.insert=t.insert.concat(i.content.getContent()),n.add(i)):(null!==t&&void 0!==t.retain||(s(),t={retain:0}),t.retain+=i.length);null!==t&&void 0===t.retain&&s()}this._changes=t}return t}}const Nn=(t,e)=>{const n=[];for(;null!==e._item&&e!==t;){if(null!==e._item.parentSub)n.unshift(e._item.parentSub);else{let t=0,r=e._item.parent._start;for(;r!==e._item&&null!==r;)!r.deleted&&r.countable&&(t+=r.length),r=r.right;n.unshift(t)}e=e._item.parent}return n},On=()=>{ie("Invalid access: Add Yjs type to a document before reading data.")};let kn=0;class Dn{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=kn++}}const zn=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=kn++},Un=(t,e)=>{if(null===t._start||0===e||null===t._searchMarker)return null;const n=0===t._searchMarker.length?null:t._searchMarker.reduce(((t,n)=>f(e-t.index)<f(e-n.index)?t:n));let r=t._start,i=0;for(null!==n&&(r=n.p,i=n.index,(t=>{t.timestamp=kn++})(n));null!==r.right&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;null!==r.left&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;null!==r.left&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return null!==n&&f(n.index-i)<r.parent.length/80?(zn(n,r,i),n):((t,e,n)=>{if(t.length>=80){const r=t.reduce(((t,e)=>t.timestamp<e.timestamp?t:e));return zn(r,e,n),r}{const r=new Dn(e,n);return t.push(r),r}})(t._searchMarker,r,i)},Fn=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let e=i.p;for(e.marker=!1;e&&(e.deleted||!e.countable);)e=e.left,e&&!e.deleted&&e.countable&&(i.index-=e.length);if(null===e||!0===e.marker){t.splice(r,1);continue}i.p=e,e.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=g(e,i.index+n))}},Bn=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;s(i,t,(()=>[])).push(n),null!==t._item;)t=t._item.parent;qe(r._eH,n,e)};class Vn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=je(),this._dEH=je(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw tt()}clone(){throw tt()}_write(t){}get _first(){let t=this._start;for(;null!==t&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){We(this._eH,t)}observeDeep(t){We(this._dEH,t)}unobserve(t){Ge(this._eH,t)}unobserveDeep(t){Ge(this._dEH,t)}toJSON(){}}const Hn=(t,e,n)=>{t.doc??On(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;null!==s&&r>0;){if(s.countable&&!s.deleted){const t=s.content.getContent();if(t.length<=e)e-=t.length;else{for(let n=e;n<t.length&&r>0;n++)i.push(t[n]),r--;e=0}}s=s.right}return i},jn=t=>{t.doc??On();const e=[];let n=t._start;for(;null!==n;){if(n.countable&&!n.deleted){const t=n.content.getContent();for(let n=0;n<t.length;n++)e.push(t[n])}n=n.right}return e},Wn=(t,e)=>{let n=0,r=t._start;for(t.doc??On();null!==r;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let r=0;r<i.length;r++)e(i[r],n++,t)}r=r.right}},Gn=(t,e)=>{const n=[];return Wn(t,((r,i)=>{n.push(e(r,i,t))})),n},qn=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(null===n){for(;null!==e&&e.deleted;)e=e.right;if(null===e)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const t=n[r++];return n.length<=r&&(n=null),{done:!1,value:t}}}},$n=(t,e)=>{t.doc??On();const n=Un(t,e);let r=t._start;for(null!==n&&(r=n.p,e-=n.index);null!==r;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Xn=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,l=null===n?e._start:n.right;let c=[];const u=()=>{c.length>0&&(i=new Kr(Je(o,rn(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Br(c)),i.integrate(t,0),c=[])};r.forEach((n=>{if(null===n)c.push(n);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(n);break;default:switch(u(),n.constructor){case Uint8Array:case ArrayBuffer:i=new Kr(Je(o,rn(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Lr(new Uint8Array(n))),i.integrate(t,0);break;case Ae:i=new Kr(Je(o,rn(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new kr(n)),i.integrate(t,0);break;default:if(!(n instanceof Vn))throw new Error("Unexpected content type in insert operation");i=new Kr(Je(o,rn(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Yr(n)),i.integrate(t,0)}}})),u()},Jn=()=>Q("Length exceeded!"),Yn=(t,e,n,r)=>{if(n>e._length)throw Jn();if(0===n)return e._searchMarker&&Fn(e._searchMarker,n,r.length),Xn(t,e,null,r);const i=n,s=Un(e,n);let o=e._start;for(null!==s&&(o=s.p,0===(n-=s.index)&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));null!==o;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&cn(t,Je(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Fn(e._searchMarker,i,r.length),Xn(t,e,o,r)},Zn=(t,e,n,r)=>{if(0===r)return;const i=n,s=r,o=Un(e,n);let a=e._start;for(null!==o&&(a=o.p,n-=o.index);null!==a&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&cn(t,Je(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&null!==a;)a.deleted||(r<a.length&&cn(t,Je(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw Jn();e._searchMarker&&Fn(e._searchMarker,i,-s+r)},Kn=(t,e,n)=>{const r=e._map.get(n);void 0!==r&&r.delete(t)},Qn=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(null==r)a=new Br([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Br([r]);break;case Uint8Array:a=new Lr(r);break;case Ae:a=new kr(r);break;default:if(!(r instanceof Vn))throw new Error("Unexpected content type");a=new Yr(r)}new Kr(Je(o,rn(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},tr=(t,e)=>{t.doc??On();const n=t._map.get(e);return void 0===n||n.deleted?void 0:n.content.getContent()[n.length-1]},er=t=>{const e={};return t.doc??On(),t._map.forEach(((t,n)=>{t.deleted||(e[n]=t.content.getContent()[t.length-1])})),e},nr=(t,e)=>{t.doc??On();const n=t._map.get(e);return void 0!==n&&!n.deleted},rr=t=>{return t.doc??On(),e=t._map.entries(),n=t=>!t[1].deleted,oe((()=>{let t;do{t=e.next()}while(!t.done&&!n(t.value));return t}));var e,n};class ir extends Ln{}class sr extends Vn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new sr;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new sr}clone(){const t=new sr;return t.insert(0,this.toArray().map((t=>t instanceof Vn?t.clone():t))),t}get length(){return this.doc??On(),this._length}_callObserver(t,e){super._callObserver(t,e),Bn(this,t,new ir(this,t))}insert(t,e){null!==this.doc?_n(this.doc,(n=>{Yn(n,this,t,e)})):this._prelimContent.splice(t,0,...e)}push(t){null!==this.doc?_n(this.doc,(e=>{((t,e,n)=>{let r=(e._searchMarker||[]).reduce(((t,e)=>e.index>t.index?e:t),{index:0,p:e._start}).p;if(r)for(;r.right;)r=r.right;Xn(t,e,r,n)})(e,this,t)})):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;null!==this.doc?_n(this.doc,(n=>{Zn(n,this,t,e)})):this._prelimContent.splice(t,e)}get(t){return $n(this,t)}toArray(){return jn(this)}slice(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length;return Hn(this,t,e)}toJSON(){return this.map((t=>t instanceof Vn?t.toJSON():t))}map(t){return Gn(this,t)}forEach(t){Wn(this,t)}[Symbol.iterator](){return qn(this)}_write(t){t.writeTypeRef(jr)}}class or extends Ln{constructor(t,e,n){super(t,e),this.keysChanged=n}}class ar extends Vn{constructor(t){super(),this._prelimContent=null,this._prelimContent=void 0===t?new Map:new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach(((t,e)=>{this.set(e,t)})),this._prelimContent=null}_copy(){return new ar}clone(){const t=new ar;return this.forEach(((e,n)=>{t.set(n,e instanceof Vn?e.clone():e)})),t}_callObserver(t,e){Bn(this,t,new or(this,t,e))}toJSON(){this.doc??On();const t={};return this._map.forEach(((e,n)=>{if(!e.deleted){const r=e.content.getContent()[e.length-1];t[n]=r instanceof Vn?r.toJSON():r}})),t}get size(){return[...rr(this)].length}keys(){return ae(rr(this),(t=>t[0]))}values(){return ae(rr(this),(t=>t[1].content.getContent()[t[1].length-1]))}entries(){return ae(rr(this),(t=>[t[0],t[1].content.getContent()[t[1].length-1]]))}forEach(t){this.doc??On(),this._map.forEach(((e,n)=>{e.deleted||t(e.content.getContent()[e.length-1],n,this)}))}[Symbol.iterator](){return this.entries()}delete(t){null!==this.doc?_n(this.doc,(e=>{Kn(e,this,t)})):this._prelimContent.delete(t)}set(t,e){return null!==this.doc?_n(this.doc,(n=>{Qn(n,this,t,e)})):this._prelimContent.set(t,e),e}get(t){return tr(this,t)}has(t){return nr(this,t)}clear(){null!==this.doc?_n(this.doc,(t=>{this.forEach((function(e,n,r){Kn(t,r,n)}))})):this._prelimContent.clear()}_write(t){t.writeTypeRef(Wr)}}const lr=(t,e)=>t===e||"object"===typeof t&&"object"===typeof e&&t&&e&&he(t,e);class cr{constructor(t,e,n,r){this.left=t,this.right=e,this.index=n,this.currentAttributes=r}forward(){if(null===this.right&&et(),this.right.content.constructor===zr)this.right.deleted||pr(this.currentAttributes,this.right.content);else this.right.deleted||(this.index+=this.right.length);this.left=this.right,this.right=this.right.right}}const ur=(t,e,n)=>{for(;null!==e.right&&n>0;){if(e.right.content.constructor===zr)e.right.deleted||pr(e.currentAttributes,e.right.content);else e.right.deleted||(n<e.right.length&&cn(t,Je(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);e.left=e.right,e.right=e.right.right}return e},hr=(t,e,n,r)=>{const i=new Map,s=r?Un(e,n):null;if(s){const e=new cr(s.p.left,s.p,s.index,i);return ur(t,e,n-s.index)}{const r=new cr(null,e._start,0,i);return ur(t,r,n)}},dr=(t,e,n,r)=>{for(;null!==n.right&&(!0===n.right.deleted||n.right.content.constructor===zr&&lr(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach(((r,o)=>{const a=n.left,l=n.right,c=new Kr(Je(s,rn(i.store,s)),a,a&&a.lastId,l,l&&l.id,e,null,new zr(o,r));c.integrate(t,0),n.right=c,n.forward()}))},pr=(t,e)=>{const{key:n,value:r}=e;null===r?t.delete(n):t.set(n,r)},fr=(t,e)=>{for(;null!==t.right&&(t.right.deleted||t.right.content.constructor===zr&&lr(e[t.right.content.key]??null,t.right.content.value));)t.forward()},mr=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const l=r[a],c=n.currentAttributes.get(a)??null;if(!lr(c,l)){o.set(a,c);const{left:r,right:u}=n;n.right=new Kr(Je(s,rn(i.store,s)),r,r&&r.lastId,u,u&&u.id,e,null,new zr(a,l)),n.right.integrate(t,0),n.forward()}}return o},gr=(t,e,n,r,i)=>{n.currentAttributes.forEach(((t,e)=>{void 0===i[e]&&(i[e]=null)}));const s=t.doc,o=s.clientID;fr(n,i);const a=mr(t,e,n,i),l=r.constructor===String?new Vr(r):r instanceof Vn?new Yr(r):new Dr(r);let{left:c,right:u,index:h}=n;e._searchMarker&&Fn(e._searchMarker,n.index,l.getLength()),u=new Kr(Je(o,rn(s.store,o)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(t,0),n.right=u,n.index=h,n.forward(),dr(t,e,n,a)},vr=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;fr(n,i);const a=mr(t,e,n,i);t:for(;null!==n.right&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===zr));){if(!n.right.deleted)switch(n.right.content.constructor){case zr:{const{key:e,value:s}=n.right.content,o=i[e];if(void 0!==o){if(lr(o,s))a.delete(e);else{if(0===r)break t;a.set(e,s)}n.right.delete(t)}else n.currentAttributes.set(e,s);break}default:r<n.right.length&&cn(t,Je(n.right.id.client,n.right.id.clock+r)),r-=n.right.length}n.forward()}if(r>0){let i="";for(;r>0;r--)i+="\n";n.right=new Kr(Je(o,rn(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Vr(i)),n.right.integrate(t,0),n.forward()}dr(t,e,n,a)},yr=(t,e,n,i,s)=>{let o=e;const a=r();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===zr){const t=o.content;a.set(t.key,t)}o=o.right}let l=0,c=!1;for(;e!==o;){if(n===e&&(c=!0),!e.deleted){const n=e.content;switch(n.constructor){case zr:{const{key:r,value:o}=n,u=i.get(r)??null;a.get(r)===n&&u!==o||(e.delete(t),l++,c||(s.get(r)??null)!==o||u===o||(null===u?s.delete(r):s.set(r,u))),c||e.deleted||pr(s,n);break}}}e=e.right}return l},_r=t=>{let e=0;return _n(t.doc,(n=>{let s=t._start,o=t._start,a=r();const l=i(a);for(;o;){if(!1===o.deleted)if(o.content.constructor===zr)pr(l,o.content);else e+=yr(n,s,o,a,l),a=i(l),s=o;o=o.right}})),e},br=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&hn(t,n.store.clients.get(r),s,i,(t=>{t.deleted||t.content.constructor!==zr||t.constructor===Rr||e.add(t.parent)}))}_n(n,(n=>{ge(t,t.deleteSet,(t=>{if(t instanceof Rr||!t.parent._hasFormatting||e.has(t.parent))return;const r=t.parent;t.content.constructor===zr?e.add(r):((t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===zr){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}})(n,t)}));for(const t of e)_r(t)}))},xr=(t,e,n)=>{const r=n,s=i(e.currentAttributes),o=e.right;for(;n>0&&null!==e.right;){if(!1===e.right.deleted)switch(e.right.content.constructor){case Yr:case Dr:case Vr:n<e.right.length&&cn(t,Je(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t)}e.forward()}o&&yr(t,o,e.right,s,e.currentAttributes);const a=(e.left||e.right).parent;return a._searchMarker&&Fn(a._searchMarker,e.index,-r+n),e};class wr extends Ln{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach((t=>{null===t?this.childListChanged=!0:this.keysChanged.add(t)}))}get changes(){if(null===this._changes){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(null===this._delta){const t=this.target.doc,e=[];_n(t,(t=>{const n=new Map,r=new Map;let i=this.target._start,s=null;const o={};let a="",l=0,c=0;const u=()=>{if(null!==s){let t=null;switch(s){case"delete":c>0&&(t={delete:c}),c=0;break;case"insert":("object"===typeof a||a.length>0)&&(t={insert:a},n.size>0&&(t.attributes={},n.forEach(((e,n)=>{null!==e&&(t.attributes[n]=e)})))),a="";break;case"retain":l>0&&(t={retain:l},(t=>{for(const e in t)return!1;return!0})(o)||(t.attributes=le({},o))),l=0}t&&e.push(t),s=null}};for(;null!==i;){switch(i.content.constructor){case Yr:case Dr:this.adds(i)?this.deletes(i)||(u(),s="insert",a=i.content.getContent()[0],u()):this.deletes(i)?("delete"!==s&&(u(),s="delete"),c+=1):i.deleted||("retain"!==s&&(u(),s="retain"),l+=1);break;case Vr:this.adds(i)?this.deletes(i)||("insert"!==s&&(u(),s="insert"),a+=i.content.str):this.deletes(i)?("delete"!==s&&(u(),s="delete"),c+=i.length):i.deleted||("retain"!==s&&(u(),s="retain"),l+=i.length);break;case zr:{const{key:e,value:a}=i.content;if(this.adds(i)){if(!this.deletes(i)){const l=n.get(e)??null;lr(l,a)?null!==a&&i.delete(t):("retain"===s&&u(),lr(a,r.get(e)??null)?delete o[e]:o[e]=a)}}else if(this.deletes(i)){r.set(e,a);const t=n.get(e)??null;lr(t,a)||("retain"===s&&u(),o[e]=t)}else if(!i.deleted){r.set(e,a);const n=o[e];void 0!==n&&(lr(n,a)?null!==n&&i.delete(t):("retain"===s&&u(),null===a?delete o[e]:o[e]=a))}i.deleted||("insert"===s&&u(),pr(n,i.content));break}}i=i.right}for(u();e.length>0;){const t=e[e.length-1];if(void 0===t.retain||void 0!==t.attributes)break;e.pop()}})),this._delta=e}return this._delta}}class Sr extends Vn{constructor(t){super(),this._pending=void 0!==t?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??On(),this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach((t=>t()))}catch(Ei){console.error(Ei)}this._pending=null}_copy(){return new Sr}clone(){const t=new Sr;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const n=new wr(this,t,e);Bn(this,t,n),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??On();let t="",e=this._start;for(;null!==e;)!e.deleted&&e.countable&&e.content.constructor===Vr&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t){let{sanitize:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!==this.doc?_n(this.doc,(n=>{const r=new cr(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const s=t[i];if(void 0!==s.insert){const o=e||"string"!==typeof s.insert||i!==t.length-1||null!==r.right||"\n"!==s.insert.slice(-1)?s.insert:s.insert.slice(0,-1);("string"!==typeof o||o.length>0)&&gr(n,this,r,o,s.attributes||{})}else void 0!==s.retain?vr(n,this,r,s.retain,s.attributes||{}):void 0!==s.delete&&xr(n,r,s.delete)}})):this._pending.push((()=>this.applyDelta(t)))}toDelta(t,e,n){this.doc??On();const r=[],i=new Map,s=this.doc;let o="",a=this._start;function l(){if(o.length>0){const t={};let e=!1;i.forEach(((n,r)=>{e=!0,t[r]=n}));const n={insert:o};e&&(n.attributes=t),r.push(n),o=""}}const c=()=>{for(;null!==a;){if(Qe(a,t)||void 0!==e&&Qe(a,e))switch(a.content.constructor){case Vr:{const r=i.get("ychange");void 0===t||Qe(a,t)?void 0===e||Qe(a,e)?void 0!==r&&(l(),i.delete("ychange")):void 0!==r&&r.user===a.id.client&&"added"===r.type||(l(),i.set("ychange",n?n("added",a.id):{type:"added"})):void 0!==r&&r.user===a.id.client&&"removed"===r.type||(l(),i.set("ychange",n?n("removed",a.id):{type:"removed"})),o+=a.content.str;break}case Yr:case Dr:{l();const t={insert:a.content.getContent()[0]};if(i.size>0){const e={};t.attributes=e,i.forEach(((t,n)=>{e[n]=t}))}r.push(t);break}case zr:Qe(a,t)&&(l(),pr(i,a.content))}a=a.right}l()};return t||e?_n(s,(n=>{t&&tn(n,t),e&&tn(n,e),c()}),"cleanup"):c(),r}insert(t,e,n){if(e.length<=0)return;const r=this.doc;null!==r?_n(r,(r=>{const i=hr(r,this,t,!n);n||(n={},i.currentAttributes.forEach(((t,e)=>{n[e]=t}))),gr(r,this,i,e,n)})):this._pending.push((()=>this.insert(t,e,n)))}insertEmbed(t,e,n){const r=this.doc;null!==r?_n(r,(r=>{const i=hr(r,this,t,!n);gr(r,this,i,e,n||{})})):this._pending.push((()=>this.insertEmbed(t,e,n||{})))}delete(t,e){if(0===e)return;const n=this.doc;null!==n?_n(n,(n=>{xr(n,hr(n,this,t,!0),e)})):this._pending.push((()=>this.delete(t,e)))}format(t,e,n){if(0===e)return;const r=this.doc;null!==r?_n(r,(r=>{const i=hr(r,this,t,!1);null!==i.right&&vr(r,this,i,e,n)})):this._pending.push((()=>this.format(t,e,n)))}removeAttribute(t){null!==this.doc?_n(this.doc,(e=>{Kn(e,this,t)})):this._pending.push((()=>this.removeAttribute(t)))}setAttribute(t,e){null!==this.doc?_n(this.doc,(n=>{Qn(n,this,t,e)})):this._pending.push((()=>this.setAttribute(t,e)))}getAttribute(t){return tr(this,t)}getAttributes(){return er(this)}_write(t){t.writeTypeRef(Gr)}}class Mr{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??On()}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(null!==t&&(!this._firstCall||t.deleted||!this._filter(e)))do{if(e=t.content.type,t.deleted||e.constructor!==Tr&&e.constructor!==Er||null===e._start)for(;null!==t;){if(null!==t.right){t=t.right;break}t=t.parent===this._root?null:t.parent._item}else t=e._start}while(null!==t&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,null===t?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Er extends Vn{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Er}clone(){const t=new Er;return t.insert(0,this.toArray().map((t=>t instanceof Vn?t.clone():t))),t}get length(){return this.doc??On(),null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(t){return new Mr(this,t)}querySelector(t){t=t.toUpperCase();const e=new Mr(this,(e=>e.nodeName&&e.nodeName.toUpperCase()===t)).next();return e.done?null:e.value}querySelectorAll(t){return t=t.toUpperCase(),u(new Mr(this,(e=>e.nodeName&&e.nodeName.toUpperCase()===t)))}_callObserver(t,e){Bn(this,t,new Ar(this,e,t))}toString(){return Gn(this,(t=>t.toString())).join("")}toJSON(){return this.toString()}toDOM(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=t.createDocumentFragment();return void 0!==n&&n._createAssociation(r,this),Wn(this,(i=>{r.insertBefore(i.toDOM(t,e,n),null)})),r}insert(t,e){null!==this.doc?_n(this.doc,(n=>{Yn(n,this,t,e)})):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(null!==this.doc)_n(this.doc,(n=>{const r=t&&t instanceof Vn?t._item:t;Xn(n,this,r,e)}));else{const n=this._prelimContent,r=null===t?0:n.findIndex((e=>e===t))+1;if(0===r&&null!==t)throw Q("Reference item not found");n.splice(r,0,...e)}}delete(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;null!==this.doc?_n(this.doc,(n=>{Zn(n,this,t,e)})):this._prelimContent.splice(t,e)}toArray(){return jn(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return $n(this,t)}slice(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length;return Hn(this,t,e)}forEach(t){Wn(this,t)}_write(t){t.writeTypeRef($r)}}class Tr extends Er{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"UNDEFINED";super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach(((t,e)=>{this.setAttribute(e,t)})),this._prelimAttrs=null}_copy(){return new Tr(this.nodeName)}clone(){const t=new Tr(this.nodeName);return((t,e)=>{for(const n in t)e(t[n],n)})(this.getAttributes(),((e,n)=>{"string"===typeof e&&t.setAttribute(n,e)})),t.insert(0,this.toArray().map((t=>t instanceof Vn?t.clone():t))),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const s in t)n.push(s);n.sort();const r=n.length;for(let s=0;s<r;s++){const r=n[s];e.push(r+'="'+t[r]+'"')}const i=this.nodeName.toLocaleLowerCase();return`<${i}${e.length>0?" "+e.join(" "):""}>${super.toString()}</${i}>`}removeAttribute(t){null!==this.doc?_n(this.doc,(e=>{Kn(e,this,t)})):this._prelimAttrs.delete(t)}setAttribute(t,e){null!==this.doc?_n(this.doc,(n=>{Qn(n,this,t,e)})):this._prelimAttrs.set(t,e)}getAttribute(t){return tr(this,t)}hasAttribute(t){return nr(this,t)}getAttributes(t){return t?((t,e)=>{const n={};return t._map.forEach(((t,r)=>{let i=t;for(;null!==i&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;null!==i&&Qe(i,e)&&(n[r]=i.content.getContent()[i.length-1])})),n})(this,t):er(this)}toDOM(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=t.createElement(this.nodeName),i=this.getAttributes();for(const s in i){const t=i[s];"string"===typeof t&&r.setAttribute(s,t)}return Wn(this,(i=>{r.appendChild(i.toDOM(t,e,n))})),void 0!==n&&n._createAssociation(r,this),r}_write(t){t.writeTypeRef(qr),t.writeKey(this.nodeName)}}class Ar extends Ln{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach((t=>{null===t?this.childListChanged=!0:this.attributesChanged.add(t)}))}}class Cr extends ar{constructor(t){super(),this.hookName=t}_copy(){return new Cr(this.hookName)}clone(){const t=new Cr(this.hookName);return this.forEach(((e,n)=>{t.set(n,e)})),t}toDOM(){arguments.length>0&&void 0!==arguments[0]||document;let t=arguments.length>2?arguments[2]:void 0;const e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})[this.hookName];let n;return n=void 0!==e?e.createDom(this):document.createElement(this.hookName),n.setAttribute("data-yjs-hook",this.hookName),void 0!==t&&t._createAssociation(n,this),n}_write(t){t.writeTypeRef(Xr),t.writeKey(this.hookName)}}class Pr extends Sr{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Pr}clone(){const t=new Pr;return t.applyDelta(this.toDelta()),t}toDOM(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=arguments.length>2?arguments[2]:void 0;const n=t.createTextNode(this.toString());return void 0!==e&&e._createAssociation(n,this),n}toString(){return this.toDelta().map((t=>{const e=[];for(const r in t.attributes){const n=[];for(const e in t.attributes[r])n.push({key:e,value:t.attributes[r][e]});n.sort(((t,e)=>t.key<e.key?-1:1)),e.push({nodeName:r,attrs:n})}e.sort(((t,e)=>t.nodeName<e.nodeName?-1:1));let n="";for(let r=0;r<e.length;r++){const t=e[r];n+=`<${t.nodeName}`;for(let e=0;e<t.attrs.length;e++){const r=t.attrs[e];n+=` ${r.key}="${r.value}"`}n+=">"}n+=t.insert;for(let r=e.length-1;r>=0;r--)n+=`</${e[r].nodeName}>`;return n})).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Jr)}}class Ir{constructor(t,e){this.id=t,this.length=e}get deleted(){throw tt()}mergeWith(t){return!1}write(t,e,n){throw tt()}integrate(t,e){throw tt()}}class Rr extends Ir{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),sn(t.doc.store,this)}write(t,e){t.writeInfo(0),t.writeLen(this.length-e)}getMissing(t,e){return null}}class Lr{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Lr(this.content)}splice(t){throw tt()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}class Nr{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Nr(this.len)}splice(t){const e=new Nr(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){be(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const Or=(t,e)=>new Ae({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class kr{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),null!==t.meta&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new kr(Or(this.doc.guid,this.opts))}splice(t){throw tt()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}class Dr{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Dr(this.embed)}splice(t){throw tt()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}class zr{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new zr(this.key,this.value)}splice(t){throw tt()}mergeWith(t){return!1}integrate(t,e){const n=e.parent;n._searchMarker=null,n._hasFormatting=!0}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}class Ur{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ur(this.arr)}splice(t){const e=new Ur(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let r=e;r<n;r++){const e=this.arr[r];t.writeString(void 0===e?"undefined":JSON.stringify(e))}}getRef(){return 2}}const Fr="development"===Dt("node_env");class Br{constructor(t){this.arr=t,Fr&&pe(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Br(this.arr)}splice(t){const e=new Br(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let r=e;r<n;r++){const e=this.arr[r];t.writeAny(e)}}getRef(){return 8}}class Vr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Vr(this.str)}splice(t){const e=new Vr(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"\ufffd",e.str="\ufffd"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(0===e?this.str:this.str.slice(e))}getRef(){return 4}}const Hr=[t=>new sr,t=>new ar,t=>new Sr,t=>new Tr(t.readKey()),t=>new Er,t=>new Cr(t.readKey()),t=>new Pr],jr=0,Wr=1,Gr=2,qr=3,$r=4,Xr=5,Jr=6;class Yr{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Yr(this.type._copy())}splice(t){throw tt()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;null!==e;)e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach((e=>{e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t)})),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;null!==e;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach((e=>{for(;null!==e;)e.gc(t,!0),e=e.left})),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Zr=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new Kr(Je(r,i+n),e,Je(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),null!==e.redone&&(s.redone=Je(e.redone.client,e.redone.clock+n)),e.right=s,null!==s.right&&(s.right.left=s),t._mergeStructs.push(s),null!==s.parentSub&&null===s.right&&s.parent._map.set(s.parentSub,s),e.length=n,s};class Kr extends Ir{constructor(t,e,n,r,i,s,o,a){super(t,a.getLength()),this.origin=n,this.left=e,this.right=r,this.rightOrigin=i,this.parent=s,this.parentSub=o,this.redone=null,this.content=a,this.info=this.content.isCountable()?2:0}set marker(t){(8&this.info)>0!==t&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=rn(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=rn(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===$e&&this.id.client!==this.parent.client&&this.parent.clock>=rn(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=un(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=cn(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Rr||this.right&&this.right.constructor===Rr)this.parent=null;else if(this.parent){if(this.parent.constructor===$e){const t=an(e,this.parent);t.constructor===Rr?this.parent=null:this.parent=t.content.type}}else this.left&&this.left.constructor===Kr&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Kr&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=un(t,t.doc.store,Je(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let e,n=this.left;if(null!==n)e=n.right;else if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start;const r=new Set,i=new Set;for(;null!==e&&e!==this.right;){if(i.add(e),r.add(e),Xe(this.origin,e.origin)){if(e.id.client<this.id.client)n=e,r.clear();else if(Xe(this.rightOrigin,e.rightOrigin))break}else{if(null===e.origin||!i.has(an(t.doc.store,e.origin)))break;r.has(an(t.doc.store,e.origin))||(n=e,r.clear())}e=e.right}this.left=n}if(null!==this.left){const t=this.left.right;this.right=t,this.left.right=this}else{let t;if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start,this.parent._start=this;this.right=t}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(t)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),sn(t.doc.store,this),this.content.integrate(t,this),fn(t,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(t)}else new Rr(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;null!==t&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;null!==t&&t.deleted;)t=t.left;return t}get lastId(){return 1===this.length?this.id:Je(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Xe(t.origin,this.lastId)&&this.right===t&&Xe(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&null===this.redone&&null===t.redone&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach((e=>{e.p===t&&(e.p=this,!this.deleted&&this.countable&&(e.index-=this.length))})),t.keep&&(this.keep=!0),this.right=t.right,null!==this.right&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&null===this.parentSub&&(e._length-=this.length),this.markDeleted(),be(t.deleteSet,this.id.client,this.id.clock,this.length),fn(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw et();this.content.gc(t),e?((t,e,n)=>{const r=t.clients.get(e.id.client);r[on(r,e.id.clock)]=n})(t,this,new Rr(this.id,this.length)):this.content=new Nr(this.length)}write(t,e){const n=e>0?Je(this.id.client,this.id.clock+e-1):this.origin,r=this.rightOrigin,i=this.parentSub,s=31&this.content.getRef()|(null===n?0:_)|(null===r?0:y)|(null===i?0:32);if(t.writeInfo(s),null!==n&&t.writeLeftID(n),null!==r&&t.writeRightID(r),null===n&&null===r){const e=this.parent;if(void 0!==e._item){const n=e._item;if(null===n){const n=Ye(e);t.writeParentInfo(!0),t.writeString(n)}else t.writeParentInfo(!1),t.writeLeftID(n.id)}else e.constructor===String?(t.writeParentInfo(!0),t.writeString(e)):e.constructor===$e?(t.writeParentInfo(!1),t.writeLeftID(e)):et();null!==i&&t.writeString(i)}this.content.write(t,e)}}const Qr=(t,e)=>ti[31&e](t),ti=[()=>{et()},t=>new Nr(t.readLen()),t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const e=t.readString();"undefined"===e?n.push(void 0):n.push(JSON.parse(e))}return new Ur(n)},t=>new Lr(t.readBuf()),t=>new Vr(t.readString()),t=>new Dr(t.readJSON()),t=>new zr(t.readKey(),t.readJSON()),t=>new Yr(Hr[t.readTypeRef()](t)),t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Br(n)},t=>new kr(Or(t.readString(),t.readAny())),()=>{et()}];class ei extends Ir{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){et()}write(t,e){t.writeInfo(10),D(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const ni="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:{},ri="__ $YJS$ __";!0===ni[ri]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),ni[ri]=!0;var ii,si=Object.create,oi=Object.defineProperty,ai=Object.defineProperties,li=Object.getOwnPropertyDescriptor,ci=Object.getOwnPropertyDescriptors,ui=Object.getOwnPropertyNames,hi=Object.getOwnPropertySymbols,di=Object.getPrototypeOf,pi=Object.prototype.hasOwnProperty,fi=Object.prototype.propertyIsEnumerable,mi=Math.pow,gi=(t,e,n)=>e in t?oi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,vi=(t,e)=>{for(var n in e||(e={}))pi.call(e,n)&&gi(t,n,e[n]);if(hi)for(var n of hi(e))fi.call(e,n)&&gi(t,n,e[n]);return t},yi=(t,e)=>ai(t,ci(e)),_i=(t,e)=>{var n={};for(var r in t)pi.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&hi)for(var r of hi(t))e.indexOf(r)<0&&fi.call(t,r)&&(n[r]=t[r]);return n},bi=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),xi=(t,e,n)=>(n=null!=t?si(di(t)):{},((t,e,n,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of ui(e))!pi.call(t,i)&&i!==n&&oi(t,i,{get:()=>e[i],enumerable:!(r=li(e,i))||r.enumerable});return t})(t&&t.__esModule?n:oi(n,"default",{value:t,enumerable:!0}),t)),wi=(t,e,n,r)=>{for(var i,s=e,o=t.length-1;o>=0;o--)(i=t[o])&&(s=i(s)||s);return s},Si=(t,e,n)=>new Promise(((r,i)=>{var s=t=>{try{a(n.next(t))}catch(e){i(e)}},o=t=>{try{a(n.throw(t))}catch(e){i(e)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,o);a((n=n.apply(t,e)).next())})),Mi=((t,e)=>()=>(t&&(e=t(t=0)),e))((()=>{ii={}}));Mi();var Ei,Ti=((Ei=Ti||{}).MEETING_START="meeting.start",Ei.MEETING_LEAVE="meeting.leave",Ei.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",Ei.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",Ei.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",Ei.MEETING_PARTICIPANT_LEFT="meeting.participant-left",Ei.MEETING_JOIN="meeting.join",Ei.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",Ei.MEETING_HOST_CHANGE="meeting.host-change",Ei.MEETING_HOST_AVAILABLE="meeting.host-available",Ei.MEETING_NO_HOST_AVAILABLE="meeting.no-host-available",Ei.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",Ei.MEETING_DEVICES_CHANGE="meeting.devices-change",Ei.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",Ei.MEETING_STATE_UPDATE="meeting.state-update",Ei.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",Ei.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",Ei.MY_PARTICIPANT_UPDATED="my-participant.update",Ei.MY_PARTICIPANT_LEFT="my-participant.left",Ei.MY_PARTICIPANT_JOINED="my-participant.joined",Ei.MEETING_KICK_PARTICIPANT="meeting.kick-participant",Ei.DESTROY="destroy",Ei),Ai=(t=>(t.FRAME_LOAD="frame.load",t.FRAME_DIMENSIONS_UPDATE="frame.dimensions-update",t.FRAME_PARENT_SIZE_UPDATE="frame.parent-window-size-update",t.FRAME_LOCALE_UPDATE="frame.locales-update",t.FRAME_AVATAR_LIST_UPDATE="frame.avatar-list-update",t.FRAME_COLOR_LIST_UPDATE="frame.color-list-update",t.FRAME_STYLES_UPDATE="frame.styles-update",t.FRAME_CALLBACKS_UPDATE="frame.callbacks-update",t))(Ai||{}),Ci=(t=>(t.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",t.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",t.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",t.TOGGLE_CAM="meeting-controls.toggle-cam",t.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",t.TOGGLE_RECORDING="meeting-controls.toggle-recording",t.HANG_UP="hang-up",t.CALLBACK_CALLED="callback-called",t))(Ci||{}),Pi=(t=>(t.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",t.REALTIME_HOST_CHANGE="realtime.host-change",t.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",t.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",t.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",t.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",t.REALTIME_GATHER="realtime.gather",t.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",t.REALTIME_LOCAL_FOLLOW_PARTICIPANT="realtime.local-follow-participant",t.REALTIME_SET_AVATAR="realtime.set-avatar",t.REALTIME_DRAWING_CHANGE="realtime.drawing-change",t.REALTIME_TRANSCRIPT_CHANGE="realtime.transcript-change",t.REALTIME_PRIVATE_MODE="realtime.private-mode",t))(Pi||{}),Ii=(t=>(t[t.MEETING_FAILED=-1]="MEETING_FAILED",t[t.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",t[t.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",t[t.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",t[t.MEETING_CONNECTING=3]="MEETING_CONNECTING",t[t.MEETING_CONNECTED=4]="MEETING_CONNECTED",t[t.MEETING_RECONNECT=5]="MEETING_RECONNECT",t[t.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",t[t.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",t[t.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",t))(Ii||{}),Ri=(t=>(t.JOINED="participant.joined",t.LOCAL_JOINED="participant.local-joined",t.LEFT="participant.left",t.LOCAL_LEFT="participant.local-left",t.LOCAL_UPDATED="participant.updated",t.LIST_UPDATED="participant.list-updated",t.SAME_ACCOUNT_ERROR="participant.same-account-error",t))(Ri||{}),Li=(t=>(t[t.NOT_AVAILABLE=0]="NOT_AVAILABLE",t[t.GOOD=1]="GOOD",t[t.BAD=2]="BAD",t[t.POOR=3]="POOR",t[t.DISCONNECTED=4]="DISCONNECTED",t[t.RECONNECTING=5]="RECONNECTING",t[t.LOST_CONNECTION=6]="LOST_CONNECTION",t))(Li||{}),Ni=(t=>(t.NO_CAM="devices.no-cam",t.NO_DEVICES="devices.no-devices",t.DEVICES_BLOCKED="devices.blocked",t.DEVICES_CAM_BLOCKED="devices.cam-blocked",t.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",t.DEVICES_UNKNOWN_ERROR="devices.unknown-error",t.DEVICES_ALLOWED="devices.allowed",t))(Ni||{}),Oi=(t=>(t.PIN_ACTIVE="pin-mode.active",t.PIN_INACTIVE="pin-mode.inactive",t))(Oi||{}),ki=(t=>(t.MOUNT="mount",t.UNMOUNT="unmount",t))(ki||{}),Di=(t=>(t.START_FOLLOWING_PARTICIPANT="who-is-online.start-following-participant",t.STOP_FOLLOWING_PARTICIPANT="who-is-online.stop-following-participant",t.ENTER_PRIVATE_MODE="who-is-online.enter-private-mode",t.LEAVE_PRIVATE_MODE="who-is-online.leave-private-mode",t.GATHER_ALL="who-is-online.gather-all",t.GO_TO_PARTICIPANT="who-is-online.go-to-participant",t.START_FOLLOW_ME="who-is-online.start-follow-me",t.STOP_FOLLOW_ME="who-is-online.stop-follow-me",t))(Di||{});Mi();var zi=["rosybrown","red","saddlebrown","coral","orange","brown","goldenrod","olivegreen","darkolivegreen","seagreen","lightsea","teal","cadetblue","pastelblue","mediumslateblue","bluedark","navy","rebeccapurple","purple","vividorchid","darkmagenta","deepmagenta","fuchsia","violetred","pink","vibrantpink","paleredviolet","carmine","wine"],Ui={turquoise:"#31E0B0",orange:"#FF5E10",blue:"#00ABF7",pink:"#FF00BB",purple:"#9C29FF",green:"#6FDD00",red:"#E30000",bluedark:"#304AFF",pinklight:"#FF89C4",purplelight:"#D597FF",greenlight:"#C6EC5C",orangelight:"#FFA115",bluelight:"#75DEFE",redlight:"#FAA291",brown:"#BB813F",yellow:"#FFEF33",olivegreen:"#93A000",lightyellow:"#FAE391",violetred:"#C03FA3",rosybrown:"#B58787",cadetblue:"#2095BB",lightsteelblue:"#ABB5FF",seagreen:"#04B45F",palegreen:"#8DE990",saddlebrown:"#964C42",pastelblue:"#77A1CC",palesilver:"#D2BABA",coral:"#DF6B6B",bisque:"#FFD9C4",goldenrod:"#DAA520",tan:"#D2BD93",darkolivegreen:"#536C27",mint:"#ADE6DF",lightsea:"#45AFAA",teal:"#036E6E",wine:"#760040",cyan:"#00FFFF",mediumslateblue:"#6674D7",navy:"#0013BB",rebeccapurple:"#663399",vividorchid:"#D429FF",darkmagenta:"#810E81",deepmagenta:"#C303C6",fuchsia:"#FA00FF",lavendermagenta:"#EE82EE",thistle:"#EEB4DD",vibrantpink:"#FF007A",cottoncandy:"#FFC0DE",paleredviolet:"#D96598",carmine:"#B50A52",gray:"#878291"};Mi();var Fi=(t=>(t.TOP_LEFT="top-left",t.TOP_RIGHT="top-right",t.BOTTOM_LEFT="bottom-left",t.BOTTOM_RIGHT="bottom-right",t))(Fi||{});Mi();var Bi=(t=>(t.LEFT="left",t.RIGHT="right",t))(Bi||{}),Vi=(t=>(t.TOP_LEFT="top-left",t.TOP_RIGHT="top-right",t.BOTTOM_LEFT="bottom-left",t.BOTTOM_RIGHT="bottom-right",t))(Vi||{});Mi();var Hi=(t=>(t.ADD="add",t.SHOW="show",t))(Hi||{}),ji=bi(((t,e)=>{Mi(),function(){var n,r="Expected a function",i="__lodash_hash_undefined__",s="__lodash_placeholder__",o=16,a=32,l=64,c=128,u=256,h=1/0,d=9007199254740991,p=NaN,f=4294967295,m=f-1,g=f>>>1,v=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",o],["flip",512],["partial",a],["partialRight",l],["rearg",u]],y="[object Arguments]",_="[object Array]",b="[object Boolean]",x="[object Date]",w="[object Error]",S="[object Function]",M="[object GeneratorFunction]",E="[object Map]",T="[object Number]",A="[object Object]",C="[object Promise]",P="[object RegExp]",I="[object Set]",R="[object String]",L="[object Symbol]",N="[object WeakMap]",O="[object ArrayBuffer]",k="[object DataView]",D="[object Float32Array]",z="[object Float64Array]",U="[object Int8Array]",F="[object Int16Array]",B="[object Int32Array]",V="[object Uint8Array]",H="[object Uint8ClampedArray]",j="[object Uint16Array]",W="[object Uint32Array]",G=/\b__p \+= '';/g,q=/\b(__p \+=) '' \+/g,$=/(__e\(.*?\)|\b__t\)) \+\n'';/g,X=/&(?:amp|lt|gt|quot|#39);/g,J=/[&<>"']/g,Y=RegExp(X.source),Z=RegExp(J.source),K=/<%-([\s\S]+?)%>/g,Q=/<%([\s\S]+?)%>/g,tt=/<%=([\s\S]+?)%>/g,et=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nt=/^\w*$/,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/[\\^$.*+?()[\]{}|]/g,st=RegExp(it.source),ot=/^\s+/,at=/\s/,lt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ct=/\{\n\/\* \[wrapped with (.+)\] \*/,ut=/,? & /,ht=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,dt=/[()=,{}\[\]\/\s]/,pt=/\\(\\)?/g,ft=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mt=/\w*$/,gt=/^[-+]0x[0-9a-f]+$/i,vt=/^0b[01]+$/i,yt=/^\[object .+?Constructor\]$/,_t=/^0o[0-7]+$/i,bt=/^(?:0|[1-9]\d*)$/,xt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,wt=/($^)/,St=/['\n\r\u2028\u2029\\]/g,Mt="\\ud800-\\udfff",Et="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Tt="\\u2700-\\u27bf",At="a-z\\xdf-\\xf6\\xf8-\\xff",Ct="A-Z\\xc0-\\xd6\\xd8-\\xde",Pt="\\ufe0e\\ufe0f",It="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Rt="['\u2019]",Lt="["+Mt+"]",Nt="["+It+"]",Ot="["+Et+"]",kt="\\d+",Dt="["+Tt+"]",zt="["+At+"]",Ut="[^"+Mt+It+kt+Tt+At+Ct+"]",Ft="\\ud83c[\\udffb-\\udfff]",Bt="[^"+Mt+"]",Vt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ht="[\\ud800-\\udbff][\\udc00-\\udfff]",jt="["+Ct+"]",Wt="\\u200d",Gt="(?:"+zt+"|"+Ut+")",qt="(?:"+jt+"|"+Ut+")",$t="(?:['\u2019](?:d|ll|m|re|s|t|ve))?",Xt="(?:['\u2019](?:D|LL|M|RE|S|T|VE))?",Jt="(?:"+Ot+"|"+Ft+")"+"?",Yt="["+Pt+"]?",Zt=Yt+Jt+("(?:"+Wt+"(?:"+[Bt,Vt,Ht].join("|")+")"+Yt+Jt+")*"),Kt="(?:"+[Dt,Vt,Ht].join("|")+")"+Zt,Qt="(?:"+[Bt+Ot+"?",Ot,Vt,Ht,Lt].join("|")+")",te=RegExp(Rt,"g"),ee=RegExp(Ot,"g"),ne=RegExp(Ft+"(?="+Ft+")|"+Qt+Zt,"g"),re=RegExp([jt+"?"+zt+"+"+$t+"(?="+[Nt,jt,"$"].join("|")+")",qt+"+"+Xt+"(?="+[Nt,jt+Gt,"$"].join("|")+")",jt+"?"+Gt+"+"+$t,jt+"+"+Xt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",kt,Kt].join("|"),"g"),ie=RegExp("["+Wt+Mt+Et+Pt+"]"),se=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,oe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ae=-1,le={};le[D]=le[z]=le[U]=le[F]=le[B]=le[V]=le[H]=le[j]=le[W]=!0,le[y]=le[_]=le[O]=le[b]=le[k]=le[x]=le[w]=le[S]=le[E]=le[T]=le[A]=le[P]=le[I]=le[R]=le[N]=!1;var ce={};ce[y]=ce[_]=ce[O]=ce[k]=ce[b]=ce[x]=ce[D]=ce[z]=ce[U]=ce[F]=ce[B]=ce[E]=ce[T]=ce[A]=ce[P]=ce[I]=ce[R]=ce[L]=ce[V]=ce[H]=ce[j]=ce[W]=!0,ce[w]=ce[S]=ce[N]=!1;var ue={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},he=parseFloat,de=parseInt,pe="object"==typeof window&&window&&window.Object===Object&&window,fe="object"==typeof self&&self&&self.Object===Object&&self,me=pe||fe||Function("return this")(),ge="object"==typeof t&&t&&!t.nodeType&&t,ve=ge&&"object"==typeof e&&e&&!e.nodeType&&e,ye=ve&&ve.exports===ge,_e=ye&&pe.process,be=function(){try{return ve&&ve.require&&ve.require("util").types||_e&&_e.binding&&_e.binding("util")}catch{}}(),xe=be&&be.isArrayBuffer,we=be&&be.isDate,Se=be&&be.isMap,Me=be&&be.isRegExp,Ee=be&&be.isSet,Te=be&&be.isTypedArray;function Ae(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ce(t,e,n,r){for(var i=-1,s=null==t?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function Pe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Ie(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Re(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Le(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Ne(t,e){return!!(null==t?0:t.length)&&je(t,e,0)>-1}function Oe(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function ke(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function De(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function ze(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function Ue(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Fe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Be=$e("length");function Ve(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function He(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function je(t,e,n){return e===e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):He(t,Ge,n)}function We(t,e,n,r){for(var i=n-1,s=t.length;++i<s;)if(r(t[i],e))return i;return-1}function Ge(t){return t!==t}function qe(t,e){var n=null==t?0:t.length;return n?Ye(t,e)/n:p}function $e(t){return function(e){return null==e?n:e[t]}}function Xe(t){return function(e){return null==t?n:t[e]}}function Je(t,e,n,r,i){return i(t,(function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)})),n}function Ye(t,e){for(var r,i=-1,s=t.length;++i<s;){var o=e(t[i]);o!==n&&(r=r===n?o:r+o)}return r}function Ze(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ke(t){return t&&t.slice(0,mn(t)+1).replace(ot,"")}function Qe(t){return function(e){return t(e)}}function tn(t,e){return ke(e,(function(e){return t[e]}))}function en(t,e){return t.has(e)}function nn(t,e){for(var n=-1,r=t.length;++n<r&&je(e,t[n],0)>-1;);return n}function rn(t,e){for(var n=t.length;n--&&je(e,t[n],0)>-1;);return n}var sn=Xe({"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"}),on=Xe({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function an(t){return"\\"+ue[t]}function ln(t){return ie.test(t)}function cn(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function un(t,e){return function(n){return t(e(n))}}function hn(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];(a===e||a===s)&&(t[n]=s,o[i++]=n)}return o}function dn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function pn(t){return ln(t)?function(t){for(var e=ne.lastIndex=0;ne.test(t);)++e;return e}(t):Be(t)}function fn(t){return ln(t)?function(t){return t.match(ne)||[]}(t):function(t){return t.split("")}(t)}function mn(t){for(var e=t.length;e--&&at.test(t.charAt(e)););return e}var gn=Xe({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var vn=function t(e){var at=(e=null==e?me:vn.defaults(me.Object(),e,vn.pick(me,oe))).Array,Mt=e.Date,Et=e.Error,Tt=e.Function,At=e.Math,Ct=e.Object,Pt=e.RegExp,It=e.String,Rt=e.TypeError,Lt=at.prototype,Nt=Tt.prototype,Ot=Ct.prototype,kt=e["__core-js_shared__"],Dt=Nt.toString,zt=Ot.hasOwnProperty,Ut=0,Ft=function(){var t=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Bt=Ot.toString,Vt=Dt.call(Ct),Ht=me._,jt=Pt("^"+Dt.call(zt).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Wt=ye?e.Buffer:n,Gt=e.Symbol,qt=e.Uint8Array,$t=Wt?Wt.allocUnsafe:n,Xt=un(Ct.getPrototypeOf,Ct),Jt=Ct.create,Yt=Ot.propertyIsEnumerable,Zt=Lt.splice,Kt=Gt?Gt.isConcatSpreadable:n,Qt=Gt?Gt.iterator:n,ne=Gt?Gt.toStringTag:n,ie=function(){try{var t=ds(Ct,"defineProperty");return t({},"",{}),t}catch{}}(),ue=e.clearTimeout!==me.clearTimeout&&e.clearTimeout,pe=Mt&&Mt.now!==me.Date.now&&Mt.now,fe=e.setTimeout!==me.setTimeout&&e.setTimeout,ge=At.ceil,ve=At.floor,_e=Ct.getOwnPropertySymbols,be=Wt?Wt.isBuffer:n,Be=e.isFinite,Xe=Lt.join,yn=un(Ct.keys,Ct),_n=At.max,bn=At.min,xn=Mt.now,wn=e.parseInt,Sn=At.random,Mn=Lt.reverse,En=ds(e,"DataView"),Tn=ds(e,"Map"),An=ds(e,"Promise"),Cn=ds(e,"Set"),Pn=ds(e,"WeakMap"),In=ds(Ct,"create"),Rn=Pn&&new Pn,Ln={},Nn=Us(En),On=Us(Tn),kn=Us(An),Dn=Us(Cn),zn=Us(Pn),Un=Gt?Gt.prototype:n,Fn=Un?Un.valueOf:n,Bn=Un?Un.toString:n;function Vn(t){if(na(t)&&!Go(t)&&!(t instanceof Gn)){if(t instanceof Wn)return t;if(zt.call(t,"__wrapped__"))return Fs(t)}return new Wn(t)}var Hn=function(){function t(){}return function(e){if(!ea(e))return{};if(Jt)return Jt(e);t.prototype=e;var r=new t;return t.prototype=n,r}}();function jn(){}function Wn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=n}function Gn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}function qn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function $n(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Xn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Jn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Xn;++e<n;)this.add(t[e])}function Yn(t){var e=this.__data__=new $n(t);this.size=e.size}function Zn(t,e){var n=Go(t),r=!n&&Wo(t),i=!n&&!r&&Jo(t),s=!n&&!r&&!i&&ua(t),o=n||r||i||s,a=o?Ze(t.length,It):[],l=a.length;for(var c in t)(e||zt.call(t,c))&&(!o||!("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||_s(c,l)))&&a.push(c);return a}function Kn(t){var e=t.length;return e?t[Jr(0,e-1)]:n}function Qn(t,e){return ks(Ii(t),lr(e,0,t.length))}function tr(t){return ks(Ii(t))}function er(t,e,r){(r!==n&&!Vo(t[e],r)||r===n&&!(e in t))&&or(t,e,r)}function nr(t,e,r){var i=t[e];(!zt.call(t,e)||!Vo(i,r)||r===n&&!(e in t))&&or(t,e,r)}function rr(t,e){for(var n=t.length;n--;)if(Vo(t[n][0],e))return n;return-1}function ir(t,e,n,r){return pr(t,(function(t,i,s){e(r,t,n(t),s)})),r}function sr(t,e){return t&&Ri(e,La(e),t)}function or(t,e,n){"__proto__"==e&&ie?ie(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ar(t,e){for(var r=-1,i=e.length,s=at(i),o=null==t;++r<i;)s[r]=o?n:Aa(t,e[r]);return s}function lr(t,e,r){return t===t&&(r!==n&&(t=t<=r?t:r),e!==n&&(t=t>=e?t:e)),t}function cr(t,e,r,i,s,o){var a,l=1&e,c=2&e,u=4&e;if(r&&(a=s?r(t,i,s,o):r(t)),a!==n)return a;if(!ea(t))return t;var h=Go(t);if(h){if(a=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&zt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!l)return Ii(t,a)}else{var d=ms(t),p=d==S||d==M;if(Jo(t))return Mi(t,l);if(d==A||d==y||p&&!s){if(a=c||p?{}:vs(t),!l)return c?function(t,e){return Ri(t,fs(t),e)}(t,function(t,e){return t&&Ri(e,Na(e),t)}(a,t)):function(t,e){return Ri(t,ps(t),e)}(t,sr(a,t))}else{if(!ce[d])return s?t:{};a=function(t,e,n){var r=t.constructor;switch(e){case O:return Ei(t);case b:case x:return new r(+t);case k:return function(t,e){var n=e?Ei(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case D:case z:case U:case F:case B:case V:case H:case j:case W:return Ti(t,n);case E:return new r;case T:case R:return new r(t);case P:return function(t){var e=new t.constructor(t.source,mt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case I:return new r;case L:return function(t){return Fn?Ct(Fn.call(t)):{}}(t)}}(t,d,l)}}o||(o=new Yn);var f=o.get(t);if(f)return f;o.set(t,a),aa(t)?t.forEach((function(n){a.add(cr(n,e,r,n,t,o))})):ra(t)&&t.forEach((function(n,i){a.set(i,cr(n,e,r,i,t,o))}));var m=h?n:(u?c?ss:is:c?Na:La)(t);return Pe(m||t,(function(n,i){m&&(n=t[i=n]),nr(a,i,cr(n,e,r,i,t,o))})),a}function ur(t,e,r){var i=r.length;if(null==t)return!i;for(t=Ct(t);i--;){var s=r[i],o=e[s],a=t[s];if(a===n&&!(s in t)||!o(a))return!1}return!0}function hr(t,e,i){if("function"!=typeof t)throw new Rt(r);return Rs((function(){t.apply(n,i)}),e)}function dr(t,e,n,r){var i=-1,s=Ne,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;n&&(e=ke(e,Qe(n))),r?(s=Oe,o=!1):e.length>=200&&(s=en,o=!1,e=new Jn(e));t:for(;++i<a;){var u=t[i],h=null==n?u:n(u);if(u=r||0!==u?u:0,o&&h===h){for(var d=c;d--;)if(e[d]===h)continue t;l.push(u)}else s(e,h,r)||l.push(u)}return l}Vn.templateSettings={escape:K,evaluate:Q,interpolate:tt,variable:"",imports:{_:Vn}},Vn.prototype=jn.prototype,Vn.prototype.constructor=Vn,Wn.prototype=Hn(jn.prototype),Wn.prototype.constructor=Wn,Gn.prototype=Hn(jn.prototype),Gn.prototype.constructor=Gn,qn.prototype.clear=function(){this.__data__=In?In(null):{},this.size=0},qn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},qn.prototype.get=function(t){var e=this.__data__;if(In){var r=e[t];return r===i?n:r}return zt.call(e,t)?e[t]:n},qn.prototype.has=function(t){var e=this.__data__;return In?e[t]!==n:zt.call(e,t)},qn.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=In&&e===n?i:e,this},$n.prototype.clear=function(){this.__data__=[],this.size=0},$n.prototype.delete=function(t){var e=this.__data__,n=rr(e,t);return!(n<0)&&(n==e.length-1?e.pop():Zt.call(e,n,1),--this.size,!0)},$n.prototype.get=function(t){var e=this.__data__,r=rr(e,t);return r<0?n:e[r][1]},$n.prototype.has=function(t){return rr(this.__data__,t)>-1},$n.prototype.set=function(t,e){var n=this.__data__,r=rr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Xn.prototype.clear=function(){this.size=0,this.__data__={hash:new qn,map:new(Tn||$n),string:new qn}},Xn.prototype.delete=function(t){var e=us(this,t).delete(t);return this.size-=e?1:0,e},Xn.prototype.get=function(t){return us(this,t).get(t)},Xn.prototype.has=function(t){return us(this,t).has(t)},Xn.prototype.set=function(t,e){var n=us(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Jn.prototype.add=Jn.prototype.push=function(t){return this.__data__.set(t,i),this},Jn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.clear=function(){this.__data__=new $n,this.size=0},Yn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Yn.prototype.get=function(t){return this.__data__.get(t)},Yn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof $n){var r=n.__data__;if(!Tn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Xn(r)}return n.set(t,e),this.size=n.size,this};var pr=Oi(xr),fr=Oi(wr,!0);function mr(t,e){var n=!0;return pr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function gr(t,e,r){for(var i=-1,s=t.length;++i<s;){var o=t[i],a=e(o);if(null!=a&&(l===n?a===a&&!ca(a):r(a,l)))var l=a,c=o}return c}function vr(t,e){var n=[];return pr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function yr(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=ys),i||(i=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?yr(a,e-1,n,r,i):De(i,a):r||(i[i.length]=a)}return i}var _r=ki(),br=ki(!0);function xr(t,e){return t&&_r(t,e,La)}function wr(t,e){return t&&br(t,e,La)}function Sr(t,e){return Le(e,(function(e){return Ko(t[e])}))}function Mr(t,e){for(var r=0,i=(e=bi(e,t)).length;null!=t&&r<i;)t=t[zs(e[r++])];return r&&r==i?t:n}function Er(t,e,n){var r=e(t);return Go(t)?r:De(r,n(t))}function Tr(t){return null==t?t===n?"[object Undefined]":"[object Null]":ne&&ne in Ct(t)?function(t){var e=zt.call(t,ne),r=t[ne];try{t[ne]=n;var i=!0}catch{}var s=Bt.call(t);return i&&(e?t[ne]=r:delete t[ne]),s}(t):function(t){return Bt.call(t)}(t)}function Ar(t,e){return t>e}function Cr(t,e){return null!=t&&zt.call(t,e)}function Pr(t,e){return null!=t&&e in Ct(t)}function Ir(t,e,r){for(var i=r?Oe:Ne,s=t[0].length,o=t.length,a=o,l=at(o),c=1/0,u=[];a--;){var h=t[a];a&&e&&(h=ke(h,Qe(e))),c=bn(h.length,c),l[a]=!r&&(e||s>=120&&h.length>=120)?new Jn(a&&h):n}h=t[0];var d=-1,p=l[0];t:for(;++d<s&&u.length<c;){var f=h[d],m=e?e(f):f;if(f=r||0!==f?f:0,!(p?en(p,m):i(u,m,r))){for(a=o;--a;){var g=l[a];if(!(g?en(g,m):i(t[a],m,r)))continue t}p&&p.push(m),u.push(f)}}return u}function Rr(t,e,r){var i=null==(t=Cs(t,e=bi(e,t)))?t:t[zs(Ys(e))];return null==i?n:Ae(i,t,r)}function Lr(t){return na(t)&&Tr(t)==y}function Nr(t,e,r,i,s){return t===e||(null==t||null==e||!na(t)&&!na(e)?t!==t&&e!==e:function(t,e,r,i,s,o){var a=Go(t),l=Go(e),c=a?_:ms(t),u=l?_:ms(e),h=(c=c==y?A:c)==A,d=(u=u==y?A:u)==A,p=c==u;if(p&&Jo(t)){if(!Jo(e))return!1;a=!0,h=!1}if(p&&!h)return o||(o=new Yn),a||ua(t)?ns(t,e,r,i,s,o):function(t,e,n,r,i,s,o){switch(n){case k:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case O:return!(t.byteLength!=e.byteLength||!s(new qt(t),new qt(e)));case b:case x:case T:return Vo(+t,+e);case w:return t.name==e.name&&t.message==e.message;case P:case R:return t==e+"";case E:var a=cn;case I:var l=1&r;if(a||(a=dn),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;r|=2,o.set(t,e);var u=ns(a(t),a(e),r,i,s,o);return o.delete(t),u;case L:if(Fn)return Fn.call(t)==Fn.call(e)}return!1}(t,e,c,r,i,s,o);if(!(1&r)){var f=h&&zt.call(t,"__wrapped__"),m=d&&zt.call(e,"__wrapped__");if(f||m){var g=f?t.value():t,v=m?e.value():e;return o||(o=new Yn),s(g,v,r,i,o)}}return!!p&&(o||(o=new Yn),function(t,e,r,i,s,o){var a=1&r,l=is(t),c=l.length,u=is(e),h=u.length;if(c!=h&&!a)return!1;for(var d=c;d--;){var p=l[d];if(!(a?p in e:zt.call(e,p)))return!1}var f=o.get(t),m=o.get(e);if(f&&m)return f==e&&m==t;var g=!0;o.set(t,e),o.set(e,t);for(var v=a;++d<c;){var y=t[p=l[d]],_=e[p];if(i)var b=a?i(_,y,p,e,t,o):i(y,_,p,t,e,o);if(!(b===n?y===_||s(y,_,r,i,o):b)){g=!1;break}v||(v="constructor"==p)}if(g&&!v){var x=t.constructor,w=e.constructor;x!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w)&&(g=!1)}return o.delete(t),o.delete(e),g}(t,e,r,i,s,o))}(t,e,r,i,Nr,s))}function Or(t,e,r,i){var s=r.length,o=s,a=!i;if(null==t)return!o;for(t=Ct(t);s--;){var l=r[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<o;){var c=(l=r[s])[0],u=t[c],h=l[1];if(a&&l[2]){if(u===n&&!(c in t))return!1}else{var d=new Yn;if(i)var p=i(u,h,c,t,e,d);if(!(p===n?Nr(h,u,3,i,d):p))return!1}}return!0}function kr(t){return!(!ea(t)||function(t){return!!Ft&&Ft in t}(t))&&(Ko(t)?jt:yt).test(Us(t))}function Dr(t){return"function"==typeof t?t:null==t?il:"object"==typeof t?Go(t)?Hr(t[0],t[1]):Vr(t):pl(t)}function zr(t){if(!Ms(t))return yn(t);var e=[];for(var n in Ct(t))zt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Ur(t){if(!ea(t))return function(t){var e=[];if(null!=t)for(var n in Ct(t))e.push(n);return e}(t);var e=Ms(t),n=[];for(var r in t)"constructor"==r&&(e||!zt.call(t,r))||n.push(r);return n}function Fr(t,e){return t<e}function Br(t,e){var n=-1,r=$o(t)?at(t.length):[];return pr(t,(function(t,i,s){r[++n]=e(t,i,s)})),r}function Vr(t){var e=hs(t);return 1==e.length&&e[0][2]?Ts(e[0][0],e[0][1]):function(n){return n===t||Or(n,t,e)}}function Hr(t,e){return xs(t)&&Es(e)?Ts(zs(t),e):function(r){var i=Aa(r,t);return i===n&&i===e?Ca(r,t):Nr(e,i,3)}}function jr(t,e,r,i,s){t!==e&&_r(e,(function(o,a){if(s||(s=new Yn),ea(o))!function(t,e,r,i,s,o,a){var l=Ps(t,r),c=Ps(e,r),u=a.get(c);if(u)return void er(t,r,u);var h=o?o(l,c,r+"",t,e,a):n,d=h===n;if(d){var p=Go(c),f=!p&&Jo(c),m=!p&&!f&&ua(c);h=c,p||f||m?Go(l)?h=l:Xo(l)?h=Ii(l):f?(d=!1,h=Mi(c,!0)):m?(d=!1,h=Ti(c,!0)):h=[]:sa(c)||Wo(c)?(h=l,Wo(l)?h=ya(l):(!ea(l)||Ko(l))&&(h=vs(c))):d=!1}d&&(a.set(c,h),s(h,c,i,o,a),a.delete(c)),er(t,r,h)}(t,e,a,r,jr,i,s);else{var l=i?i(Ps(t,a),o,a+"",t,e,s):n;l===n&&(l=o),er(t,a,l)}}),Na)}function Wr(t,e){var r=t.length;if(r)return _s(e+=e<0?r:0,r)?t[e]:n}function Gr(t,e,n){e=e.length?ke(e,(function(t){return Go(t)?function(e){return Mr(e,1===t.length?t[0]:t)}:t})):[il];var r=-1;return e=ke(e,Qe(cs())),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(Br(t,(function(t,n,i){return{criteria:ke(e,(function(e){return e(t)})),index:++r,value:t}})),(function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,s=e.criteria,o=i.length,a=n.length;++r<o;){var l=Ai(i[r],s[r]);if(l)return r>=a?l:l*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function qr(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Mr(t,o);n(a,o)&&ti(s,bi(o,t),a)}return s}function $r(t,e,n,r){var i=r?We:je,s=-1,o=e.length,a=t;for(t===e&&(e=Ii(e)),n&&(a=ke(t,Qe(n)));++s<o;)for(var l=0,c=e[s],u=n?n(c):c;(l=i(a,u,l,r))>-1;)a!==t&&Zt.call(a,l,1),Zt.call(t,l,1);return t}function Xr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==s){var s=i;_s(i)?Zt.call(t,i,1):di(t,i)}}return t}function Jr(t,e){return t+ve(Sn()*(e-t+1))}function Yr(t,e){var n="";if(!t||e<1||e>d)return n;do{e%2&&(n+=t),(e=ve(e/2))&&(t+=t)}while(e);return n}function Zr(t,e){return Ls(As(t,e,il),t+"")}function Kr(t){return Kn(Va(t))}function Qr(t,e){var n=Va(t);return ks(n,lr(e,0,n.length))}function ti(t,e,r,i){if(!ea(t))return t;for(var s=-1,o=(e=bi(e,t)).length,a=o-1,l=t;null!=l&&++s<o;){var c=zs(e[s]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(s!=a){var h=l[c];(u=i?i(h,c,l):n)===n&&(u=ea(h)?h:_s(e[s+1])?[]:{})}nr(l,c,u),l=l[c]}return t}var ei=Rn?function(t,e){return Rn.set(t,e),t}:il,ni=ie?function(t,e){return ie(t,"toString",{configurable:!0,enumerable:!1,value:el(e),writable:!0})}:il;function ri(t){return ks(Va(t))}function ii(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=at(i);++r<i;)s[r]=t[r+e];return s}function si(t,e){var n;return pr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function oi(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e===e&&i<=g){for(;r<i;){var s=r+i>>>1,o=t[s];null!==o&&!ca(o)&&(n?o<=e:o<e)?r=s+1:i=s}return i}return ai(t,e,il,n)}function ai(t,e,r,i){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=r(e))!==e,l=null===e,c=ca(e),u=e===n;s<o;){var h=ve((s+o)/2),d=r(t[h]),p=d!==n,f=null===d,g=d===d,v=ca(d);if(a)var y=i||g;else y=u?g&&(i||p):l?g&&p&&(i||!f):c?g&&p&&!f&&(i||!v):!f&&!v&&(i?d<=e:d<e);y?s=h+1:o=h}return bn(o,m)}function li(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var o=t[n],a=e?e(o):o;if(!n||!Vo(a,l)){var l=a;s[i++]=0===o?0:o}}return s}function ci(t){return"number"==typeof t?t:ca(t)?p:+t}function ui(t){if("string"==typeof t)return t;if(Go(t))return ke(t,ui)+"";if(ca(t))return Bn?Bn.call(t):"";var e=t+"";return"0"==e&&1/t==-h?"-0":e}function hi(t,e,n){var r=-1,i=Ne,s=t.length,o=!0,a=[],l=a;if(n)o=!1,i=Oe;else if(s>=200){var c=e?null:Yi(t);if(c)return dn(c);o=!1,i=en,l=new Jn}else l=e?[]:a;t:for(;++r<s;){var u=t[r],h=e?e(u):u;if(u=n||0!==u?u:0,o&&h===h){for(var d=l.length;d--;)if(l[d]===h)continue t;e&&l.push(h),a.push(u)}else i(l,h,n)||(l!==a&&l.push(h),a.push(u))}return a}function di(t,e){return null==(t=Cs(t,e=bi(e,t)))||delete t[zs(Ys(e))]}function pi(t,e,n,r){return ti(t,e,n(Mr(t,e)),r)}function fi(t,e,n,r){for(var i=t.length,s=r?i:-1;(r?s--:++s<i)&&e(t[s],s,t););return n?ii(t,r?0:s,r?s+1:i):ii(t,r?s+1:0,r?i:s)}function mi(t,e){var n=t;return n instanceof Gn&&(n=n.value()),ze(e,(function(t,e){return e.func.apply(e.thisArg,De([t],e.args))}),n)}function gi(t,e,n){var r=t.length;if(r<2)return r?hi(t[0]):[];for(var i=-1,s=at(r);++i<r;)for(var o=t[i],a=-1;++a<r;)a!=i&&(s[i]=dr(s[i]||o,t[a],e,n));return hi(yr(s,1),e,n)}function vi(t,e,r){for(var i=-1,s=t.length,o=e.length,a={};++i<s;){var l=i<o?e[i]:n;r(a,t[i],l)}return a}function yi(t){return Xo(t)?t:[]}function _i(t){return"function"==typeof t?t:il}function bi(t,e){return Go(t)?t:xs(t,e)?[t]:Ds(_a(t))}var xi=Zr;function wi(t,e,r){var i=t.length;return r=r===n?i:r,!e&&r>=i?t:ii(t,e,r)}var Si=ue||function(t){return me.clearTimeout(t)};function Mi(t,e){if(e)return t.slice();var n=t.length,r=$t?$t(n):new t.constructor(n);return t.copy(r),r}function Ei(t){var e=new t.constructor(t.byteLength);return new qt(e).set(new qt(t)),e}function Ti(t,e){var n=e?Ei(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Ai(t,e){if(t!==e){var r=t!==n,i=null===t,s=t===t,o=ca(t),a=e!==n,l=null===e,c=e===e,u=ca(e);if(!l&&!u&&!o&&t>e||o&&a&&c&&!l&&!u||i&&a&&c||!r&&c||!s)return 1;if(!i&&!o&&!u&&t<e||u&&r&&s&&!i&&!o||l&&r&&s||!a&&s||!c)return-1}return 0}function Ci(t,e,n,r){for(var i=-1,s=t.length,o=n.length,a=-1,l=e.length,c=_n(s-o,0),u=at(l+c),h=!r;++a<l;)u[a]=e[a];for(;++i<o;)(h||i<s)&&(u[n[i]]=t[i]);for(;c--;)u[a++]=t[i++];return u}function Pi(t,e,n,r){for(var i=-1,s=t.length,o=-1,a=n.length,l=-1,c=e.length,u=_n(s-a,0),h=at(u+c),d=!r;++i<u;)h[i]=t[i];for(var p=i;++l<c;)h[p+l]=e[l];for(;++o<a;)(d||i<s)&&(h[p+n[o]]=t[i++]);return h}function Ii(t,e){var n=-1,r=t.length;for(e||(e=at(r));++n<r;)e[n]=t[n];return e}function Ri(t,e,r,i){var s=!r;r||(r={});for(var o=-1,a=e.length;++o<a;){var l=e[o],c=i?i(r[l],t[l],l,r,t):n;c===n&&(c=t[l]),s?or(r,l,c):nr(r,l,c)}return r}function Li(t,e){return function(n,r){var i=Go(n)?Ce:ir,s=e?e():{};return i(n,t,cs(r,2),s)}}function Ni(t){return Zr((function(e,r){var i=-1,s=r.length,o=s>1?r[s-1]:n,a=s>2?r[2]:n;for(o=t.length>3&&"function"==typeof o?(s--,o):n,a&&bs(r[0],r[1],a)&&(o=s<3?n:o,s=1),e=Ct(e);++i<s;){var l=r[i];l&&t(e,l,i,o)}return e}))}function Oi(t,e){return function(n,r){if(null==n)return n;if(!$o(n))return t(n,r);for(var i=n.length,s=e?i:-1,o=Ct(n);(e?s--:++s<i)&&!1!==r(o[s],s,o););return n}}function ki(t){return function(e,n,r){for(var i=-1,s=Ct(e),o=r(e),a=o.length;a--;){var l=o[t?a:++i];if(!1===n(s[l],l,s))break}return e}}function Di(t){return function(e){var r=ln(e=_a(e))?fn(e):n,i=r?r[0]:e.charAt(0),s=r?wi(r,1).join(""):e.slice(1);return i[t]()+s}}function zi(t){return function(e){return ze(Ka(Wa(e).replace(te,"")),t,"")}}function Ui(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Hn(t.prototype),r=t.apply(n,e);return ea(r)?r:n}}function Fi(t){return function(e,r,i){var s=Ct(e);if(!$o(e)){var o=cs(r,3);e=La(e),r=function(t){return o(s[t],t,s)}}var a=t(e,r,i);return a>-1?s[o?e[a]:a]:n}}function Bi(t){return rs((function(e){var i=e.length,s=i,o=Wn.prototype.thru;for(t&&e.reverse();s--;){var a=e[s];if("function"!=typeof a)throw new Rt(r);if(o&&!l&&"wrapper"==as(a))var l=new Wn([],!0)}for(s=l?s:i;++s<i;){var c=as(a=e[s]),u="wrapper"==c?os(a):n;l=u&&ws(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[as(u[0])].apply(l,u[3]):1==a.length&&ws(a)?l[c]():l.thru(a)}return function(){var t=arguments,n=t[0];if(l&&1==t.length&&Go(n))return l.plant(n).value();for(var r=0,s=i?e[r].apply(this,t):n;++r<i;)s=e[r].call(this,s);return s}}))}function Vi(t,e,r,i,s,o,a,l,u,h){var d=e&c,p=1&e,f=2&e,m=24&e,g=512&e,v=f?n:Ui(t);return function c(){for(var y=arguments.length,_=at(y),b=y;b--;)_[b]=arguments[b];if(m)var x=ls(c),w=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(_,x);if(i&&(_=Ci(_,i,s,m)),o&&(_=Pi(_,o,a,m)),y-=w,m&&y<h){var S=hn(_,x);return Xi(t,e,Vi,c.placeholder,r,_,S,l,u,h-y)}var M=p?r:this,E=f?M[t]:t;return y=_.length,l?_=function(t,e){for(var r=t.length,i=bn(e.length,r),s=Ii(t);i--;){var o=e[i];t[i]=_s(o,r)?s[o]:n}return t}(_,l):g&&y>1&&_.reverse(),d&&u<y&&(_.length=u),this&&this!==me&&this instanceof c&&(E=v||Ui(E)),E.apply(M,_)}}function Hi(t,e){return function(n,r){return function(t,e,n,r){return xr(t,(function(t,i,s){e(r,n(t),i,s)})),r}(n,t,e(r),{})}}function ji(t,e){return function(r,i){var s;if(r===n&&i===n)return e;if(r!==n&&(s=r),i!==n){if(s===n)return i;"string"==typeof r||"string"==typeof i?(r=ui(r),i=ui(i)):(r=ci(r),i=ci(i)),s=t(r,i)}return s}}function Wi(t){return rs((function(e){return e=ke(e,Qe(cs())),Zr((function(n){var r=this;return t(e,(function(t){return Ae(t,r,n)}))}))}))}function Gi(t,e){var r=(e=e===n?" ":ui(e)).length;if(r<2)return r?Yr(e,t):e;var i=Yr(e,ge(t/pn(e)));return ln(e)?wi(fn(i),0,t).join(""):i.slice(0,t)}function qi(t){return function(e,r,i){return i&&"number"!=typeof i&&bs(e,r,i)&&(r=i=n),e=fa(e),r===n?(r=e,e=0):r=fa(r),function(t,e,n,r){for(var i=-1,s=_n(ge((e-t)/(n||1)),0),o=at(s);s--;)o[r?s:++i]=t,t+=n;return o}(e,r,i=i===n?e<r?1:-1:fa(i),t)}}function $i(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=va(e),n=va(n)),t(e,n)}}function Xi(t,e,r,i,s,o,c,u,h,d){var p=8&e;e|=p?a:l,4&(e&=~(p?l:a))||(e&=-4);var f=[t,e,s,p?o:n,p?c:n,p?n:o,p?n:c,u,h,d],m=r.apply(n,f);return ws(t)&&Is(m,f),m.placeholder=i,Ns(m,t,e)}function Ji(t){var e=At[t];return function(t,n){if(t=va(t),(n=null==n?0:bn(ma(n),292))&&Be(t)){var r=(_a(t)+"e").split("e");return+((r=(_a(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Yi=Cn&&1/dn(new Cn([,-0]))[1]==h?function(t){return new Cn(t)}:cl;function Zi(t){return function(e){var n=ms(e);return n==E?cn(e):n==I?function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}(e):function(t,e){return ke(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ki(t,e,i,h,d,p,f,m){var g=2&e;if(!g&&"function"!=typeof t)throw new Rt(r);var v=h?h.length:0;if(v||(e&=-97,h=d=n),f=f===n?f:_n(ma(f),0),m=m===n?m:ma(m),v-=d?d.length:0,e&l){var y=h,_=d;h=d=n}var b=g?n:os(t),x=[t,e,i,h,d,y,_,p,f,m];if(b&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<131,a=r==c&&8==n||r==c&&n==u&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!o&&!a)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var l=e[3];if(l){var h=t[3];t[3]=h?Ci(h,l,e[4]):l,t[4]=h?hn(t[3],s):e[4]}l=e[5],l&&(h=t[5],t[5]=h?Pi(h,l,e[6]):l,t[6]=h?hn(t[5],s):e[6]),l=e[7],l&&(t[7]=l),r&c&&(t[8]=null==t[8]?e[8]:bn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i}(x,b),t=x[0],e=x[1],i=x[2],h=x[3],d=x[4],!(m=x[9]=x[9]===n?g?0:t.length:_n(x[9]-v,0))&&24&e&&(e&=-25),e&&1!=e)w=8==e||e==o?function(t,e,r){var i=Ui(t);return function s(){for(var o=arguments.length,a=at(o),l=o,c=ls(s);l--;)a[l]=arguments[l];var u=o<3&&a[0]!==c&&a[o-1]!==c?[]:hn(a,c);return(o-=u.length)<r?Xi(t,e,Vi,s.placeholder,n,a,u,n,n,r-o):Ae(this&&this!==me&&this instanceof s?i:t,this,a)}}(t,e,m):e!=a&&33!=e||d.length?Vi.apply(n,x):function(t,e,n,r){var i=1&e,s=Ui(t);return function e(){for(var o=-1,a=arguments.length,l=-1,c=r.length,u=at(c+a),h=this&&this!==me&&this instanceof e?s:t;++l<c;)u[l]=r[l];for(;a--;)u[l++]=arguments[++o];return Ae(h,i?n:this,u)}}(t,e,i,h);else var w=function(t,e,n){var r=1&e,i=Ui(t);return function e(){return(this&&this!==me&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,i);return Ns((b?ei:Is)(w,x),t,e)}function Qi(t,e,r,i){return t===n||Vo(t,Ot[r])&&!zt.call(i,r)?e:t}function ts(t,e,r,i,s,o){return ea(t)&&ea(e)&&(o.set(e,t),jr(t,e,n,ts,o),o.delete(e)),t}function es(t){return sa(t)?n:t}function ns(t,e,r,i,s,o){var a=1&r,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var u=o.get(t),h=o.get(e);if(u&&h)return u==e&&h==t;var d=-1,p=!0,f=2&r?new Jn:n;for(o.set(t,e),o.set(e,t);++d<l;){var m=t[d],g=e[d];if(i)var v=a?i(g,m,d,e,t,o):i(m,g,d,t,e,o);if(v!==n){if(v)continue;p=!1;break}if(f){if(!Fe(e,(function(t,e){if(!en(f,e)&&(m===t||s(m,t,r,i,o)))return f.push(e)}))){p=!1;break}}else if(m!==g&&!s(m,g,r,i,o)){p=!1;break}}return o.delete(t),o.delete(e),p}function rs(t){return Ls(As(t,n,Gs),t+"")}function is(t){return Er(t,La,ps)}function ss(t){return Er(t,Na,fs)}var os=Rn?function(t){return Rn.get(t)}:cl;function as(t){for(var e=t.name+"",n=Ln[e],r=zt.call(Ln,e)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==t)return i.name}return e}function ls(t){return(zt.call(Vn,"placeholder")?Vn:t).placeholder}function cs(){var t=Vn.iteratee||sl;return t=t===sl?Dr:t,arguments.length?t(arguments[0],arguments[1]):t}function us(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function hs(t){for(var e=La(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Es(i)]}return e}function ds(t,e){var r=function(t,e){return null==t?n:t[e]}(t,e);return kr(r)?r:n}var ps=_e?function(t){return null==t?[]:(t=Ct(t),Le(_e(t),(function(e){return Yt.call(t,e)})))}:gl,fs=_e?function(t){for(var e=[];t;)De(e,ps(t)),t=Xt(t);return e}:gl,ms=Tr;function gs(t,e,n){for(var r=-1,i=(e=bi(e,t)).length,s=!1;++r<i;){var o=zs(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&ta(i)&&_s(o,i)&&(Go(t)||Wo(t))}function vs(t){return"function"!=typeof t.constructor||Ms(t)?{}:Hn(Xt(t))}function ys(t){return Go(t)||Wo(t)||!!(Kt&&t&&t[Kt])}function _s(t,e){var n=typeof t;return!!(e=e??d)&&("number"==n||"symbol"!=n&&bt.test(t))&&t>-1&&t%1==0&&t<e}function bs(t,e,n){if(!ea(n))return!1;var r=typeof e;return!!("number"==r?$o(n)&&_s(e,n.length):"string"==r&&e in n)&&Vo(n[e],t)}function xs(t,e){if(Go(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ca(t))||(nt.test(t)||!et.test(t)||null!=e&&t in Ct(e))}function ws(t){var e=as(t),n=Vn[e];if("function"!=typeof n||!(e in Gn.prototype))return!1;if(t===n)return!0;var r=os(n);return!!r&&t===r[0]}(En&&ms(new En(new ArrayBuffer(1)))!=k||Tn&&ms(new Tn)!=E||An&&ms(An.resolve())!=C||Cn&&ms(new Cn)!=I||Pn&&ms(new Pn)!=N)&&(ms=function(t){var e=Tr(t),r=e==A?t.constructor:n,i=r?Us(r):"";if(i)switch(i){case Nn:return k;case On:return E;case kn:return C;case Dn:return I;case zn:return N}return e});var Ss=kt?Ko:vl;function Ms(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ot)}function Es(t){return t===t&&!ea(t)}function Ts(t,e){return function(r){return null!=r&&(r[t]===e&&(e!==n||t in Ct(r)))}}function As(t,e,r){return e=_n(e===n?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=_n(n.length-e,0),o=at(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=at(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),Ae(t,this,a)}}function Cs(t,e){return e.length<2?t:Mr(t,ii(e,0,-1))}function Ps(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Is=Os(ei),Rs=fe||function(t,e){return me.setTimeout(t,e)},Ls=Os(ni);function Ns(t,e,n){var r=e+"";return Ls(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(lt,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Pe(v,(function(n){var r="_."+n[0];e&n[1]&&!Ne(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(ct);return e?e[1].split(ut):[]}(r),n)))}function Os(t){var e=0,r=0;return function(){var i=xn(),s=16-(i-r);if(r=i,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(n,arguments)}}function ks(t,e){var r=-1,i=t.length,s=i-1;for(e=e===n?i:e;++r<e;){var o=Jr(r,s),a=t[o];t[o]=t[r],t[r]=a}return t.length=e,t}var Ds=function(t){var e=ko(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(rt,(function(t,n,r,i){e.push(r?i.replace(pt,"$1"):n||t)})),e}));function zs(t){if("string"==typeof t||ca(t))return t;var e=t+"";return"0"==e&&1/t==-h?"-0":e}function Us(t){if(null!=t){try{return Dt.call(t)}catch{}try{return t+""}catch{}}return""}function Fs(t){if(t instanceof Gn)return t.clone();var e=new Wn(t.__wrapped__,t.__chain__);return e.__actions__=Ii(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Bs=Zr((function(t,e){return Xo(t)?dr(t,yr(e,1,Xo,!0)):[]})),Vs=Zr((function(t,e){var r=Ys(e);return Xo(r)&&(r=n),Xo(t)?dr(t,yr(e,1,Xo,!0),cs(r,2)):[]})),Hs=Zr((function(t,e){var r=Ys(e);return Xo(r)&&(r=n),Xo(t)?dr(t,yr(e,1,Xo,!0),n,r):[]}));function js(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ma(n);return i<0&&(i=_n(r+i,0)),He(t,cs(e,3),i)}function Ws(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i-1;return r!==n&&(s=ma(r),s=r<0?_n(i+s,0):bn(s,i-1)),He(t,cs(e,3),s,!0)}function Gs(t){return(null==t?0:t.length)?yr(t,1):[]}function qs(t){return t&&t.length?t[0]:n}var $s=Zr((function(t){var e=ke(t,yi);return e.length&&e[0]===t[0]?Ir(e):[]})),Xs=Zr((function(t){var e=Ys(t),r=ke(t,yi);return e===Ys(r)?e=n:r.pop(),r.length&&r[0]===t[0]?Ir(r,cs(e,2)):[]})),Js=Zr((function(t){var e=Ys(t),r=ke(t,yi);return(e="function"==typeof e?e:n)&&r.pop(),r.length&&r[0]===t[0]?Ir(r,n,e):[]}));function Ys(t){var e=null==t?0:t.length;return e?t[e-1]:n}var Zs=Zr(Ks);function Ks(t,e){return t&&t.length&&e&&e.length?$r(t,e):t}var Qs=rs((function(t,e){var n=null==t?0:t.length,r=ar(t,e);return Xr(t,ke(e,(function(t){return _s(t,n)?+t:t})).sort(Ai)),r}));function to(t){return null==t?t:Mn.call(t)}var eo=Zr((function(t){return hi(yr(t,1,Xo,!0))})),no=Zr((function(t){var e=Ys(t);return Xo(e)&&(e=n),hi(yr(t,1,Xo,!0),cs(e,2))})),ro=Zr((function(t){var e=Ys(t);return e="function"==typeof e?e:n,hi(yr(t,1,Xo,!0),n,e)}));function io(t){if(!t||!t.length)return[];var e=0;return t=Le(t,(function(t){if(Xo(t))return e=_n(t.length,e),!0})),Ze(e,(function(e){return ke(t,$e(e))}))}function so(t,e){if(!t||!t.length)return[];var r=io(t);return null==e?r:ke(r,(function(t){return Ae(e,n,t)}))}var oo=Zr((function(t,e){return Xo(t)?dr(t,e):[]})),ao=Zr((function(t){return gi(Le(t,Xo))})),lo=Zr((function(t){var e=Ys(t);return Xo(e)&&(e=n),gi(Le(t,Xo),cs(e,2))})),co=Zr((function(t){var e=Ys(t);return e="function"==typeof e?e:n,gi(Le(t,Xo),n,e)})),uo=Zr(io);var ho=Zr((function(t){var e=t.length,r=e>1?t[e-1]:n;return r="function"==typeof r?(t.pop(),r):n,so(t,r)}));function po(t){var e=Vn(t);return e.__chain__=!0,e}function fo(t,e){return e(t)}var mo=rs((function(t){var e=t.length,r=e?t[0]:0,i=this.__wrapped__,s=function(e){return ar(e,t)};return!(e>1||this.__actions__.length)&&i instanceof Gn&&_s(r)?((i=i.slice(r,+r+(e?1:0))).__actions__.push({func:fo,args:[s],thisArg:n}),new Wn(i,this.__chain__).thru((function(t){return e&&!t.length&&t.push(n),t}))):this.thru(s)}));var go=Li((function(t,e,n){zt.call(t,n)?++t[n]:or(t,n,1)}));var vo=Fi(js),yo=Fi(Ws);function _o(t,e){return(Go(t)?Pe:pr)(t,cs(e,3))}function bo(t,e){return(Go(t)?Ie:fr)(t,cs(e,3))}var xo=Li((function(t,e,n){zt.call(t,n)?t[n].push(e):or(t,n,[e])}));var wo=Zr((function(t,e,n){var r=-1,i="function"==typeof e,s=$o(t)?at(t.length):[];return pr(t,(function(t){s[++r]=i?Ae(e,t,n):Rr(t,e,n)})),s})),So=Li((function(t,e,n){or(t,n,e)}));function Mo(t,e){return(Go(t)?ke:Br)(t,cs(e,3))}var Eo=Li((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var To=Zr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&bs(t,e[0],e[1])?e=[]:n>2&&bs(e[0],e[1],e[2])&&(e=[e[0]]),Gr(t,yr(e,1),[])})),Ao=pe||function(){return me.Date.now()};function Co(t,e,r){return e=r?n:e,e=t&&null==e?t.length:e,Ki(t,c,n,n,n,n,e)}function Po(t,e){var i;if("function"!=typeof e)throw new Rt(r);return t=ma(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=n),i}}var Io=Zr((function(t,e,n){var r=1;if(n.length){var i=hn(n,ls(Io));r|=a}return Ki(t,r,e,n,i)})),Ro=Zr((function(t,e,n){var r=3;if(n.length){var i=hn(n,ls(Ro));r|=a}return Ki(e,r,t,n,i)}));function Lo(t,e,i){var s,o,a,l,c,u,h=0,d=!1,p=!1,f=!0;if("function"!=typeof t)throw new Rt(r);function m(e){var r=s,i=o;return s=o=n,h=e,l=t.apply(i,r)}function g(t){var r=t-u;return u===n||r>=e||r<0||p&&t-h>=a}function v(){var t=Ao();if(g(t))return y(t);c=Rs(v,function(t){var n=e-(t-u);return p?bn(n,a-(t-h)):n}(t))}function y(t){return c=n,f&&s?m(t):(s=o=n,l)}function _(){var t=Ao(),r=g(t);if(s=arguments,o=this,u=t,r){if(c===n)return function(t){return h=t,c=Rs(v,e),d?m(t):l}(u);if(p)return Si(c),c=Rs(v,e),m(u)}return c===n&&(c=Rs(v,e)),l}return e=va(e)||0,ea(i)&&(d=!!i.leading,a=(p="maxWait"in i)?_n(va(i.maxWait)||0,e):a,f="trailing"in i?!!i.trailing:f),_.cancel=function(){c!==n&&Si(c),h=0,s=u=o=c=n},_.flush=function(){return c===n?l:y(Ao())},_}var No=Zr((function(t,e){return hr(t,1,e)})),Oo=Zr((function(t,e,n){return hr(t,va(e)||0,n)}));function ko(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Rt(r);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(ko.Cache||Xn),n}function Do(t){if("function"!=typeof t)throw new Rt(r);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}ko.Cache=Xn;var zo=xi((function(t,e){var n=(e=1==e.length&&Go(e[0])?ke(e[0],Qe(cs())):ke(yr(e,1),Qe(cs()))).length;return Zr((function(r){for(var i=-1,s=bn(r.length,n);++i<s;)r[i]=e[i].call(this,r[i]);return Ae(t,this,r)}))})),Uo=Zr((function(t,e){var r=hn(e,ls(Uo));return Ki(t,a,n,e,r)})),Fo=Zr((function(t,e){var r=hn(e,ls(Fo));return Ki(t,l,n,e,r)})),Bo=rs((function(t,e){return Ki(t,u,n,n,n,e)}));function Vo(t,e){return t===e||t!==t&&e!==e}var Ho=$i(Ar),jo=$i((function(t,e){return t>=e})),Wo=Lr(function(){return arguments}())?Lr:function(t){return na(t)&&zt.call(t,"callee")&&!Yt.call(t,"callee")},Go=at.isArray,qo=xe?Qe(xe):function(t){return na(t)&&Tr(t)==O};function $o(t){return null!=t&&ta(t.length)&&!Ko(t)}function Xo(t){return na(t)&&$o(t)}var Jo=be||vl,Yo=we?Qe(we):function(t){return na(t)&&Tr(t)==x};function Zo(t){if(!na(t))return!1;var e=Tr(t);return e==w||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!sa(t)}function Ko(t){if(!ea(t))return!1;var e=Tr(t);return e==S||e==M||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Qo(t){return"number"==typeof t&&t==ma(t)}function ta(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=d}function ea(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function na(t){return null!=t&&"object"==typeof t}var ra=Se?Qe(Se):function(t){return na(t)&&ms(t)==E};function ia(t){return"number"==typeof t||na(t)&&Tr(t)==T}function sa(t){if(!na(t)||Tr(t)!=A)return!1;var e=Xt(t);if(null===e)return!0;var n=zt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Dt.call(n)==Vt}var oa=Me?Qe(Me):function(t){return na(t)&&Tr(t)==P};var aa=Ee?Qe(Ee):function(t){return na(t)&&ms(t)==I};function la(t){return"string"==typeof t||!Go(t)&&na(t)&&Tr(t)==R}function ca(t){return"symbol"==typeof t||na(t)&&Tr(t)==L}var ua=Te?Qe(Te):function(t){return na(t)&&ta(t.length)&&!!le[Tr(t)]};var ha=$i(Fr),da=$i((function(t,e){return t<=e}));function pa(t){if(!t)return[];if($o(t))return la(t)?fn(t):Ii(t);if(Qt&&t[Qt])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[Qt]());var e=ms(t);return(e==E?cn:e==I?dn:Va)(t)}function fa(t){return t?(t=va(t))===h||t===-h?17976931348623157e292*(t<0?-1:1):t===t?t:0:0===t?t:0}function ma(t){var e=fa(t),n=e%1;return e===e?n?e-n:e:0}function ga(t){return t?lr(ma(t),0,f):0}function va(t){if("number"==typeof t)return t;if(ca(t))return p;if(ea(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=ea(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ke(t);var n=vt.test(t);return n||_t.test(t)?de(t.slice(2),n?2:8):gt.test(t)?p:+t}function ya(t){return Ri(t,Na(t))}function _a(t){return null==t?"":ui(t)}var ba=Ni((function(t,e){if(Ms(e)||$o(e))Ri(e,La(e),t);else for(var n in e)zt.call(e,n)&&nr(t,n,e[n])})),xa=Ni((function(t,e){Ri(e,Na(e),t)})),wa=Ni((function(t,e,n,r){Ri(e,Na(e),t,r)})),Sa=Ni((function(t,e,n,r){Ri(e,La(e),t,r)})),Ma=rs(ar);var Ea=Zr((function(t,e){t=Ct(t);var r=-1,i=e.length,s=i>2?e[2]:n;for(s&&bs(e[0],e[1],s)&&(i=1);++r<i;)for(var o=e[r],a=Na(o),l=-1,c=a.length;++l<c;){var u=a[l],h=t[u];(h===n||Vo(h,Ot[u])&&!zt.call(t,u))&&(t[u]=o[u])}return t})),Ta=Zr((function(t){return t.push(n,ts),Ae(ka,n,t)}));function Aa(t,e,r){var i=null==t?n:Mr(t,e);return i===n?r:i}function Ca(t,e){return null!=t&&gs(t,e,Pr)}var Pa=Hi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),t[e]=n}),el(il)),Ia=Hi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),zt.call(t,e)?t[e].push(n):t[e]=[n]}),cs),Ra=Zr(Rr);function La(t){return $o(t)?Zn(t):zr(t)}function Na(t){return $o(t)?Zn(t,!0):Ur(t)}var Oa=Ni((function(t,e,n){jr(t,e,n)})),ka=Ni((function(t,e,n,r){jr(t,e,n,r)})),Da=rs((function(t,e){var n={};if(null==t)return n;var r=!1;e=ke(e,(function(e){return e=bi(e,t),r||(r=e.length>1),e})),Ri(t,ss(t),n),r&&(n=cr(n,7,es));for(var i=e.length;i--;)di(n,e[i]);return n}));var za=rs((function(t,e){return null==t?{}:function(t,e){return qr(t,e,(function(e,n){return Ca(t,n)}))}(t,e)}));function Ua(t,e){if(null==t)return{};var n=ke(ss(t),(function(t){return[t]}));return e=cs(e),qr(t,n,(function(t,n){return e(t,n[0])}))}var Fa=Zi(La),Ba=Zi(Na);function Va(t){return null==t?[]:tn(t,La(t))}var Ha=zi((function(t,e,n){return e=e.toLowerCase(),t+(n?ja(e):e)}));function ja(t){return Za(_a(t).toLowerCase())}function Wa(t){return(t=_a(t))&&t.replace(xt,sn).replace(ee,"")}var Ga=zi((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),qa=zi((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),$a=Di("toLowerCase");var Xa=zi((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var Ja=zi((function(t,e,n){return t+(n?" ":"")+Za(e)}));var Ya=zi((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Za=Di("toUpperCase");function Ka(t,e,r){return t=_a(t),(e=r?n:e)===n?function(t){return se.test(t)}(t)?function(t){return t.match(re)||[]}(t):function(t){return t.match(ht)||[]}(t):t.match(e)||[]}var Qa=Zr((function(t,e){try{return Ae(t,n,e)}catch(r){return Zo(r)?r:new Et(r)}})),tl=rs((function(t,e){return Pe(e,(function(e){e=zs(e),or(t,e,Io(t[e],t))})),t}));function el(t){return function(){return t}}var nl=Bi(),rl=Bi(!0);function il(t){return t}function sl(t){return Dr("function"==typeof t?t:cr(t,1))}var ol=Zr((function(t,e){return function(n){return Rr(n,t,e)}})),al=Zr((function(t,e){return function(n){return Rr(t,n,e)}}));function ll(t,e,n){var r=La(e),i=Sr(e,r);null==n&&(!ea(e)||!i.length&&r.length)&&(n=e,e=t,t=this,i=Sr(e,La(e)));var s=!(ea(n)&&"chain"in n)||!!n.chain,o=Ko(t);return Pe(i,(function(n){var r=e[n];t[n]=r,o&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__);return(n.__actions__=Ii(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,De([this.value()],arguments))})})),t}function cl(){}var ul=Wi(ke),hl=Wi(Re),dl=Wi(Fe);function pl(t){return xs(t)?$e(zs(t)):function(t){return function(e){return Mr(e,t)}}(t)}var fl=qi(),ml=qi(!0);function gl(){return[]}function vl(){return!1}var yl=ji((function(t,e){return t+e}),0),_l=Ji("ceil"),bl=ji((function(t,e){return t/e}),1),xl=Ji("floor");var wl=ji((function(t,e){return t*e}),1),Sl=Ji("round"),Ml=ji((function(t,e){return t-e}),0);return Vn.after=function(t,e){if("function"!=typeof e)throw new Rt(r);return t=ma(t),function(){if(--t<1)return e.apply(this,arguments)}},Vn.ary=Co,Vn.assign=ba,Vn.assignIn=xa,Vn.assignInWith=wa,Vn.assignWith=Sa,Vn.at=Ma,Vn.before=Po,Vn.bind=Io,Vn.bindAll=tl,Vn.bindKey=Ro,Vn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Go(t)?t:[t]},Vn.chain=po,Vn.chunk=function(t,e,r){e=(r?bs(t,e,r):e===n)?1:_n(ma(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var s=0,o=0,a=at(ge(i/e));s<i;)a[o++]=ii(t,s,s+=e);return a},Vn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i},Vn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=at(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return De(Go(n)?Ii(n):[n],yr(e,1))},Vn.cond=function(t){var e=null==t?0:t.length,n=cs();return t=e?ke(t,(function(t){if("function"!=typeof t[1])throw new Rt(r);return[n(t[0]),t[1]]})):[],Zr((function(n){for(var r=-1;++r<e;){var i=t[r];if(Ae(i[0],this,n))return Ae(i[1],this,n)}}))},Vn.conforms=function(t){return function(t){var e=La(t);return function(n){return ur(n,t,e)}}(cr(t,1))},Vn.constant=el,Vn.countBy=go,Vn.create=function(t,e){var n=Hn(t);return null==e?n:sr(n,e)},Vn.curry=function t(e,r,i){var s=Ki(e,8,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Vn.curryRight=function t(e,r,i){var s=Ki(e,o,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Vn.debounce=Lo,Vn.defaults=Ea,Vn.defaultsDeep=Ta,Vn.defer=No,Vn.delay=Oo,Vn.difference=Bs,Vn.differenceBy=Vs,Vn.differenceWith=Hs,Vn.drop=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=r||e===n?1:ma(e))<0?0:e,i):[]},Vn.dropRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,0,(e=i-(e=r||e===n?1:ma(e)))<0?0:e):[]},Vn.dropRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0,!0):[]},Vn.dropWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0):[]},Vn.fill=function(t,e,r,i){var s=null==t?0:t.length;return s?(r&&"number"!=typeof r&&bs(t,e,r)&&(r=0,i=s),function(t,e,r,i){var s=t.length;for((r=ma(r))<0&&(r=-r>s?0:s+r),(i=i===n||i>s?s:ma(i))<0&&(i+=s),i=r>i?0:ga(i);r<i;)t[r++]=e;return t}(t,e,r,i)):[]},Vn.filter=function(t,e){return(Go(t)?Le:vr)(t,cs(e,3))},Vn.flatMap=function(t,e){return yr(Mo(t,e),1)},Vn.flatMapDeep=function(t,e){return yr(Mo(t,e),h)},Vn.flatMapDepth=function(t,e,r){return r=r===n?1:ma(r),yr(Mo(t,e),r)},Vn.flatten=Gs,Vn.flattenDeep=function(t){return(null==t?0:t.length)?yr(t,h):[]},Vn.flattenDepth=function(t,e){return(null==t?0:t.length)?yr(t,e=e===n?1:ma(e)):[]},Vn.flip=function(t){return Ki(t,512)},Vn.flow=nl,Vn.flowRight=rl,Vn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Vn.functions=function(t){return null==t?[]:Sr(t,La(t))},Vn.functionsIn=function(t){return null==t?[]:Sr(t,Na(t))},Vn.groupBy=xo,Vn.initial=function(t){return(null==t?0:t.length)?ii(t,0,-1):[]},Vn.intersection=$s,Vn.intersectionBy=Xs,Vn.intersectionWith=Js,Vn.invert=Pa,Vn.invertBy=Ia,Vn.invokeMap=wo,Vn.iteratee=sl,Vn.keyBy=So,Vn.keys=La,Vn.keysIn=Na,Vn.map=Mo,Vn.mapKeys=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){or(n,e(t,r,i),t)})),n},Vn.mapValues=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){or(n,r,e(t,r,i))})),n},Vn.matches=function(t){return Vr(cr(t,1))},Vn.matchesProperty=function(t,e){return Hr(t,cr(e,1))},Vn.memoize=ko,Vn.merge=Oa,Vn.mergeWith=ka,Vn.method=ol,Vn.methodOf=al,Vn.mixin=ll,Vn.negate=Do,Vn.nthArg=function(t){return t=ma(t),Zr((function(e){return Wr(e,t)}))},Vn.omit=Da,Vn.omitBy=function(t,e){return Ua(t,Do(cs(e)))},Vn.once=function(t){return Po(2,t)},Vn.orderBy=function(t,e,r,i){return null==t?[]:(Go(e)||(e=null==e?[]:[e]),Go(r=i?n:r)||(r=null==r?[]:[r]),Gr(t,e,r))},Vn.over=ul,Vn.overArgs=zo,Vn.overEvery=hl,Vn.overSome=dl,Vn.partial=Uo,Vn.partialRight=Fo,Vn.partition=Eo,Vn.pick=za,Vn.pickBy=Ua,Vn.property=pl,Vn.propertyOf=function(t){return function(e){return null==t?n:Mr(t,e)}},Vn.pull=Zs,Vn.pullAll=Ks,Vn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?$r(t,e,cs(n,2)):t},Vn.pullAllWith=function(t,e,r){return t&&t.length&&e&&e.length?$r(t,e,n,r):t},Vn.pullAt=Qs,Vn.range=fl,Vn.rangeRight=ml,Vn.rearg=Bo,Vn.reject=function(t,e){return(Go(t)?Le:vr)(t,Do(cs(e,3)))},Vn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],s=t.length;for(e=cs(e,3);++r<s;){var o=t[r];e(o,r,t)&&(n.push(o),i.push(r))}return Xr(t,i),n},Vn.rest=function(t,e){if("function"!=typeof t)throw new Rt(r);return Zr(t,e=e===n?e:ma(e))},Vn.reverse=to,Vn.sampleSize=function(t,e,r){return e=(r?bs(t,e,r):e===n)?1:ma(e),(Go(t)?Qn:Qr)(t,e)},Vn.set=function(t,e,n){return null==t?t:ti(t,e,n)},Vn.setWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:ti(t,e,r,i)},Vn.shuffle=function(t){return(Go(t)?tr:ri)(t)},Vn.slice=function(t,e,r){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&bs(t,e,r)?(e=0,r=i):(e=null==e?0:ma(e),r=r===n?i:ma(r)),ii(t,e,r)):[]},Vn.sortBy=To,Vn.sortedUniq=function(t){return t&&t.length?li(t):[]},Vn.sortedUniqBy=function(t,e){return t&&t.length?li(t,cs(e,2)):[]},Vn.split=function(t,e,r){return r&&"number"!=typeof r&&bs(t,e,r)&&(e=r=n),(r=r===n?f:r>>>0)?(t=_a(t))&&("string"==typeof e||null!=e&&!oa(e))&&(!(e=ui(e))&&ln(t))?wi(fn(t),0,r):t.split(e,r):[]},Vn.spread=function(t,e){if("function"!=typeof t)throw new Rt(r);return e=null==e?0:_n(ma(e),0),Zr((function(n){var r=n[e],i=wi(n,0,e);return r&&De(i,r),Ae(t,this,i)}))},Vn.tail=function(t){var e=null==t?0:t.length;return e?ii(t,1,e):[]},Vn.take=function(t,e,r){return t&&t.length?ii(t,0,(e=r||e===n?1:ma(e))<0?0:e):[]},Vn.takeRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=i-(e=r||e===n?1:ma(e)))<0?0:e,i):[]},Vn.takeRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!1,!0):[]},Vn.takeWhile=function(t,e){return t&&t.length?fi(t,cs(e,3)):[]},Vn.tap=function(t,e){return e(t),t},Vn.throttle=function(t,e,n){var i=!0,s=!0;if("function"!=typeof t)throw new Rt(r);return ea(n)&&(i="leading"in n?!!n.leading:i,s="trailing"in n?!!n.trailing:s),Lo(t,e,{leading:i,maxWait:e,trailing:s})},Vn.thru=fo,Vn.toArray=pa,Vn.toPairs=Fa,Vn.toPairsIn=Ba,Vn.toPath=function(t){return Go(t)?ke(t,zs):ca(t)?[t]:Ii(Ds(_a(t)))},Vn.toPlainObject=ya,Vn.transform=function(t,e,n){var r=Go(t),i=r||Jo(t)||ua(t);if(e=cs(e,4),null==n){var s=t&&t.constructor;n=i?r?new s:[]:ea(t)&&Ko(s)?Hn(Xt(t)):{}}return(i?Pe:xr)(t,(function(t,r,i){return e(n,t,r,i)})),n},Vn.unary=function(t){return Co(t,1)},Vn.union=eo,Vn.unionBy=no,Vn.unionWith=ro,Vn.uniq=function(t){return t&&t.length?hi(t):[]},Vn.uniqBy=function(t,e){return t&&t.length?hi(t,cs(e,2)):[]},Vn.uniqWith=function(t,e){return e="function"==typeof e?e:n,t&&t.length?hi(t,n,e):[]},Vn.unset=function(t,e){return null==t||di(t,e)},Vn.unzip=io,Vn.unzipWith=so,Vn.update=function(t,e,n){return null==t?t:pi(t,e,_i(n))},Vn.updateWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:pi(t,e,_i(r),i)},Vn.values=Va,Vn.valuesIn=function(t){return null==t?[]:tn(t,Na(t))},Vn.without=oo,Vn.words=Ka,Vn.wrap=function(t,e){return Uo(_i(e),t)},Vn.xor=ao,Vn.xorBy=lo,Vn.xorWith=co,Vn.zip=uo,Vn.zipObject=function(t,e){return vi(t||[],e||[],nr)},Vn.zipObjectDeep=function(t,e){return vi(t||[],e||[],ti)},Vn.zipWith=ho,Vn.entries=Fa,Vn.entriesIn=Ba,Vn.extend=xa,Vn.extendWith=wa,ll(Vn,Vn),Vn.add=yl,Vn.attempt=Qa,Vn.camelCase=Ha,Vn.capitalize=ja,Vn.ceil=_l,Vn.clamp=function(t,e,r){return r===n&&(r=e,e=n),r!==n&&(r=(r=va(r))===r?r:0),e!==n&&(e=(e=va(e))===e?e:0),lr(va(t),e,r)},Vn.clone=function(t){return cr(t,4)},Vn.cloneDeep=function(t){return cr(t,5)},Vn.cloneDeepWith=function(t,e){return cr(t,5,e="function"==typeof e?e:n)},Vn.cloneWith=function(t,e){return cr(t,4,e="function"==typeof e?e:n)},Vn.conformsTo=function(t,e){return null==e||ur(t,e,La(e))},Vn.deburr=Wa,Vn.defaultTo=function(t,e){return null==t||t!==t?e:t},Vn.divide=bl,Vn.endsWith=function(t,e,r){t=_a(t),e=ui(e);var i=t.length,s=r=r===n?i:lr(ma(r),0,i);return(r-=e.length)>=0&&t.slice(r,s)==e},Vn.eq=Vo,Vn.escape=function(t){return(t=_a(t))&&Z.test(t)?t.replace(J,on):t},Vn.escapeRegExp=function(t){return(t=_a(t))&&st.test(t)?t.replace(it,"\\$&"):t},Vn.every=function(t,e,r){var i=Go(t)?Re:mr;return r&&bs(t,e,r)&&(e=n),i(t,cs(e,3))},Vn.find=vo,Vn.findIndex=js,Vn.findKey=function(t,e){return Ve(t,cs(e,3),xr)},Vn.findLast=yo,Vn.findLastIndex=Ws,Vn.findLastKey=function(t,e){return Ve(t,cs(e,3),wr)},Vn.floor=xl,Vn.forEach=_o,Vn.forEachRight=bo,Vn.forIn=function(t,e){return null==t?t:_r(t,cs(e,3),Na)},Vn.forInRight=function(t,e){return null==t?t:br(t,cs(e,3),Na)},Vn.forOwn=function(t,e){return t&&xr(t,cs(e,3))},Vn.forOwnRight=function(t,e){return t&&wr(t,cs(e,3))},Vn.get=Aa,Vn.gt=Ho,Vn.gte=jo,Vn.has=function(t,e){return null!=t&&gs(t,e,Cr)},Vn.hasIn=Ca,Vn.head=qs,Vn.identity=il,Vn.includes=function(t,e,n,r){t=$o(t)?t:Va(t),n=n&&!r?ma(n):0;var i=t.length;return n<0&&(n=_n(i+n,0)),la(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&je(t,e,n)>-1},Vn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ma(n);return i<0&&(i=_n(r+i,0)),je(t,e,i)},Vn.inRange=function(t,e,r){return e=fa(e),r===n?(r=e,e=0):r=fa(r),function(t,e,n){return t>=bn(e,n)&&t<_n(e,n)}(t=va(t),e,r)},Vn.invoke=Ra,Vn.isArguments=Wo,Vn.isArray=Go,Vn.isArrayBuffer=qo,Vn.isArrayLike=$o,Vn.isArrayLikeObject=Xo,Vn.isBoolean=function(t){return!0===t||!1===t||na(t)&&Tr(t)==b},Vn.isBuffer=Jo,Vn.isDate=Yo,Vn.isElement=function(t){return na(t)&&1===t.nodeType&&!sa(t)},Vn.isEmpty=function(t){if(null==t)return!0;if($o(t)&&(Go(t)||"string"==typeof t||"function"==typeof t.splice||Jo(t)||ua(t)||Wo(t)))return!t.length;var e=ms(t);if(e==E||e==I)return!t.size;if(Ms(t))return!zr(t).length;for(var n in t)if(zt.call(t,n))return!1;return!0},Vn.isEqual=function(t,e){return Nr(t,e)},Vn.isEqualWith=function(t,e,r){var i=(r="function"==typeof r?r:n)?r(t,e):n;return i===n?Nr(t,e,n,r):!!i},Vn.isError=Zo,Vn.isFinite=function(t){return"number"==typeof t&&Be(t)},Vn.isFunction=Ko,Vn.isInteger=Qo,Vn.isLength=ta,Vn.isMap=ra,Vn.isMatch=function(t,e){return t===e||Or(t,e,hs(e))},Vn.isMatchWith=function(t,e,r){return r="function"==typeof r?r:n,Or(t,e,hs(e),r)},Vn.isNaN=function(t){return ia(t)&&t!=+t},Vn.isNative=function(t){if(Ss(t))throw new Et("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return kr(t)},Vn.isNil=function(t){return null==t},Vn.isNull=function(t){return null===t},Vn.isNumber=ia,Vn.isObject=ea,Vn.isObjectLike=na,Vn.isPlainObject=sa,Vn.isRegExp=oa,Vn.isSafeInteger=function(t){return Qo(t)&&t>=-d&&t<=d},Vn.isSet=aa,Vn.isString=la,Vn.isSymbol=ca,Vn.isTypedArray=ua,Vn.isUndefined=function(t){return t===n},Vn.isWeakMap=function(t){return na(t)&&ms(t)==N},Vn.isWeakSet=function(t){return na(t)&&"[object WeakSet]"==Tr(t)},Vn.join=function(t,e){return null==t?"":Xe.call(t,e)},Vn.kebabCase=Ga,Vn.last=Ys,Vn.lastIndexOf=function(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i;return r!==n&&(s=(s=ma(r))<0?_n(i+s,0):bn(s,i-1)),e===e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,s):He(t,Ge,s,!0)},Vn.lowerCase=qa,Vn.lowerFirst=$a,Vn.lt=ha,Vn.lte=da,Vn.max=function(t){return t&&t.length?gr(t,il,Ar):n},Vn.maxBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Ar):n},Vn.mean=function(t){return qe(t,il)},Vn.meanBy=function(t,e){return qe(t,cs(e,2))},Vn.min=function(t){return t&&t.length?gr(t,il,Fr):n},Vn.minBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Fr):n},Vn.stubArray=gl,Vn.stubFalse=vl,Vn.stubObject=function(){return{}},Vn.stubString=function(){return""},Vn.stubTrue=function(){return!0},Vn.multiply=wl,Vn.nth=function(t,e){return t&&t.length?Wr(t,ma(e)):n},Vn.noConflict=function(){return me._===this&&(me._=Ht),this},Vn.noop=cl,Vn.now=Ao,Vn.pad=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Gi(ve(i),n)+t+Gi(ge(i),n)},Vn.padEnd=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;return e&&r<e?t+Gi(e-r,n):t},Vn.padStart=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;return e&&r<e?Gi(e-r,n)+t:t},Vn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),wn(_a(t).replace(ot,""),e||0)},Vn.random=function(t,e,r){if(r&&"boolean"!=typeof r&&bs(t,e,r)&&(e=r=n),r===n&&("boolean"==typeof e?(r=e,e=n):"boolean"==typeof t&&(r=t,t=n)),t===n&&e===n?(t=0,e=1):(t=fa(t),e===n?(e=t,t=0):e=fa(e)),t>e){var i=t;t=e,e=i}if(r||t%1||e%1){var s=Sn();return bn(t+s*(e-t+he("1e-"+((s+"").length-1))),e)}return Jr(t,e)},Vn.reduce=function(t,e,n){var r=Go(t)?ze:Je,i=arguments.length<3;return r(t,cs(e,4),n,i,pr)},Vn.reduceRight=function(t,e,n){var r=Go(t)?Ue:Je,i=arguments.length<3;return r(t,cs(e,4),n,i,fr)},Vn.repeat=function(t,e,r){return e=(r?bs(t,e,r):e===n)?1:ma(e),Yr(_a(t),e)},Vn.replace=function(){var t=arguments,e=_a(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Vn.result=function(t,e,r){var i=-1,s=(e=bi(e,t)).length;for(s||(s=1,t=n);++i<s;){var o=null==t?n:t[zs(e[i])];o===n&&(i=s,o=r),t=Ko(o)?o.call(t):o}return t},Vn.round=Sl,Vn.runInContext=t,Vn.sample=function(t){return(Go(t)?Kn:Kr)(t)},Vn.size=function(t){if(null==t)return 0;if($o(t))return la(t)?pn(t):t.length;var e=ms(t);return e==E||e==I?t.size:zr(t).length},Vn.snakeCase=Xa,Vn.some=function(t,e,r){var i=Go(t)?Fe:si;return r&&bs(t,e,r)&&(e=n),i(t,cs(e,3))},Vn.sortedIndex=function(t,e){return oi(t,e)},Vn.sortedIndexBy=function(t,e,n){return ai(t,e,cs(n,2))},Vn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=oi(t,e);if(r<n&&Vo(t[r],e))return r}return-1},Vn.sortedLastIndex=function(t,e){return oi(t,e,!0)},Vn.sortedLastIndexBy=function(t,e,n){return ai(t,e,cs(n,2),!0)},Vn.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=oi(t,e,!0)-1;if(Vo(t[n],e))return n}return-1},Vn.startCase=Ja,Vn.startsWith=function(t,e,n){return t=_a(t),n=null==n?0:lr(ma(n),0,t.length),e=ui(e),t.slice(n,n+e.length)==e},Vn.subtract=Ml,Vn.sum=function(t){return t&&t.length?Ye(t,il):0},Vn.sumBy=function(t,e){return t&&t.length?Ye(t,cs(e,2)):0},Vn.template=function(t,e,r){var i=Vn.templateSettings;r&&bs(t,e,r)&&(e=n),t=_a(t),e=wa({},e,i,Qi);var s,o,a=wa({},e.imports,i.imports,Qi),l=La(a),c=tn(a,l),u=0,h=e.interpolate||wt,d="__p += '",p=Pt((e.escape||wt).source+"|"+h.source+"|"+(h===tt?ft:wt).source+"|"+(e.evaluate||wt).source+"|$","g"),f="//# sourceURL="+(zt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ae+"]")+"\n";t.replace(p,(function(e,n,r,i,a,l){return r||(r=i),d+=t.slice(u,l).replace(St,an),n&&(s=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+e.length,e})),d+="';\n";var m=zt.call(e,"variable")&&e.variable;if(m){if(dt.test(m))throw new Et("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(G,""):d).replace(q,"$1").replace($,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Qa((function(){return Tt(l,f+"return "+d).apply(n,c)}));if(g.source=d,Zo(g))throw g;return g},Vn.times=function(t,e){if((t=ma(t))<1||t>d)return[];var n=f,r=bn(t,f);e=cs(e),t-=f;for(var i=Ze(r,e);++n<t;)e(n);return i},Vn.toFinite=fa,Vn.toInteger=ma,Vn.toLength=ga,Vn.toLower=function(t){return _a(t).toLowerCase()},Vn.toNumber=va,Vn.toSafeInteger=function(t){return t?lr(ma(t),-d,d):0===t?t:0},Vn.toString=_a,Vn.toUpper=function(t){return _a(t).toUpperCase()},Vn.trim=function(t,e,r){if((t=_a(t))&&(r||e===n))return Ke(t);if(!t||!(e=ui(e)))return t;var i=fn(t),s=fn(e);return wi(i,nn(i,s),rn(i,s)+1).join("")},Vn.trimEnd=function(t,e,r){if((t=_a(t))&&(r||e===n))return t.slice(0,mn(t)+1);if(!t||!(e=ui(e)))return t;var i=fn(t);return wi(i,0,rn(i,fn(e))+1).join("")},Vn.trimStart=function(t,e,r){if((t=_a(t))&&(r||e===n))return t.replace(ot,"");if(!t||!(e=ui(e)))return t;var i=fn(t);return wi(i,nn(i,fn(e))).join("")},Vn.truncate=function(t,e){var r=30,i="...";if(ea(e)){var s="separator"in e?e.separator:s;r="length"in e?ma(e.length):r,i="omission"in e?ui(e.omission):i}var o=(t=_a(t)).length;if(ln(t)){var a=fn(t);o=a.length}if(r>=o)return t;var l=r-pn(i);if(l<1)return i;var c=a?wi(a,0,l).join(""):t.slice(0,l);if(s===n)return c+i;if(a&&(l+=c.length-l),oa(s)){if(t.slice(l).search(s)){var u,h=c;for(s.global||(s=Pt(s.source,_a(mt.exec(s))+"g")),s.lastIndex=0;u=s.exec(h);)var d=u.index;c=c.slice(0,d===n?l:d)}}else if(t.indexOf(ui(s),l)!=l){var p=c.lastIndexOf(s);p>-1&&(c=c.slice(0,p))}return c+i},Vn.unescape=function(t){return(t=_a(t))&&Y.test(t)?t.replace(X,gn):t},Vn.uniqueId=function(t){var e=++Ut;return _a(t)+e},Vn.upperCase=Ya,Vn.upperFirst=Za,Vn.each=_o,Vn.eachRight=bo,Vn.first=qs,ll(Vn,function(){var t={};return xr(Vn,(function(e,n){zt.call(Vn.prototype,n)||(t[n]=e)})),t}(),{chain:!1}),Vn.VERSION="4.17.21",Pe(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Vn[t].placeholder=Vn})),Pe(["drop","take"],(function(t,e){Gn.prototype[t]=function(r){r=r===n?1:_n(ma(r),0);var i=this.__filtered__&&!e?new Gn(this):this.clone();return i.__filtered__?i.__takeCount__=bn(r,i.__takeCount__):i.__views__.push({size:bn(r,f),type:t+(i.__dir__<0?"Right":"")}),i},Gn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Pe(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Gn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:cs(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),Pe(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Gn.prototype[t]=function(){return this[n](1).value()[0]}})),Pe(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Gn.prototype[t]=function(){return this.__filtered__?new Gn(this):this[n](1)}})),Gn.prototype.compact=function(){return this.filter(il)},Gn.prototype.find=function(t){return this.filter(t).head()},Gn.prototype.findLast=function(t){return this.reverse().find(t)},Gn.prototype.invokeMap=Zr((function(t,e){return"function"==typeof t?new Gn(this):this.map((function(n){return Rr(n,t,e)}))})),Gn.prototype.reject=function(t){return this.filter(Do(cs(t)))},Gn.prototype.slice=function(t,e){t=ma(t);var r=this;return r.__filtered__&&(t>0||e<0)?new Gn(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==n&&(r=(e=ma(e))<0?r.dropRight(-e):r.take(e-t)),r)},Gn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Gn.prototype.toArray=function(){return this.take(f)},xr(Gn.prototype,(function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),s=Vn[i?"take"+("last"==e?"Right":""):e],o=i||/^find/.test(e);s&&(Vn.prototype[e]=function(){var e=this.__wrapped__,a=i?[1]:arguments,l=e instanceof Gn,c=a[0],u=l||Go(e),h=function(t){var e=s.apply(Vn,De([t],a));return i&&d?e[0]:e};u&&r&&"function"==typeof c&&1!=c.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,f=o&&!d,m=l&&!p;if(!o&&u){e=m?e:new Gn(this);var g=t.apply(e,a);return g.__actions__.push({func:fo,args:[h],thisArg:n}),new Wn(g,d)}return f&&m?t.apply(this,a):(g=this.thru(h),f?i?g.value()[0]:g.value():g)})})),Pe(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Lt[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Vn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Go(i)?i:[],t)}return this[n]((function(n){return e.apply(Go(n)?n:[],t)}))}})),xr(Gn.prototype,(function(t,e){var n=Vn[e];if(n){var r=n.name+"";zt.call(Ln,r)||(Ln[r]=[]),Ln[r].push({name:e,func:n})}})),Ln[Vi(n,2).name]=[{name:"wrapper",func:n}],Gn.prototype.clone=function(){var t=new Gn(this.__wrapped__);return t.__actions__=Ii(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ii(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ii(this.__views__),t},Gn.prototype.reverse=function(){if(this.__filtered__){var t=new Gn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Gn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Go(t),r=e<0,i=n?t.length:0,s=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var s=n[r],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=bn(e,t+o);break;case"takeRight":t=_n(t,e-o)}}return{start:t,end:e}}(0,i,this.__views__),o=s.start,a=s.end,l=a-o,c=r?a:o-1,u=this.__iteratees__,h=u.length,d=0,p=bn(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return mi(t,this.__actions__);var f=[];t:for(;l--&&d<p;){for(var m=-1,g=t[c+=e];++m<h;){var v=u[m],y=v.iteratee,_=v.type,b=y(g);if(2==_)g=b;else if(!b){if(1==_)continue t;break t}}f[d++]=g}return f},Vn.prototype.at=mo,Vn.prototype.chain=function(){return po(this)},Vn.prototype.commit=function(){return new Wn(this.value(),this.__chain__)},Vn.prototype.next=function(){this.__values__===n&&(this.__values__=pa(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?n:this.__values__[this.__index__++]}},Vn.prototype.plant=function(t){for(var e,r=this;r instanceof jn;){var i=Fs(r);i.__index__=0,i.__values__=n,e?s.__wrapped__=i:e=i;var s=i;r=r.__wrapped__}return s.__wrapped__=t,e},Vn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Gn){var e=t;return this.__actions__.length&&(e=new Gn(this)),(e=e.reverse()).__actions__.push({func:fo,args:[to],thisArg:n}),new Wn(e,this.__chain__)}return this.thru(to)},Vn.prototype.toJSON=Vn.prototype.valueOf=Vn.prototype.value=function(){return mi(this.__wrapped__,this.__actions__)},Vn.prototype.first=Vn.prototype.head,Qt&&(Vn.prototype[Qt]=function(){return this}),Vn}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(me._=vn,define((function(){return vn}))):ve?((ve.exports=vn)._=vn,ge._=vn):me._=vn}.call(t)}));Mi();var Wi=(t=>(t.GLOBAL="global-store",t.COMMENTS="comments-store",t.WHO_IS_ONLINE="who-is-online-store",t.VIDEO="video-store",t.PRESENCE_3D="presence-3d-store",t.CORE="core-store",t))(Wi||{});Mi();var Gi=xi(ji()),qi=new class{setConfig(t){this.configuration=t}get(t,e){return this.configuration?(0,Gi.get)(this.configuration,t,e):e}};function $i(){return{set value(t){this.instance=t,setTimeout((()=>Object.freeze(this)))},get value(){return this.instance}}}Mi(),Mi(),Mi(),Mi(),Mi(),Mi(),Mi();var Xi=function(t,e){return(Xi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function Ji(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Xi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Yi(t,e,n,r){return new(n||(n=Promise))((function(e,i){function s(t){try{a(r.next(t))}catch(e){i(e)}}function o(t){try{a(r.throw(t))}catch(e){i(e)}}function a(t){t.done?e(t.value):function(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(s,o)}a((r=r.apply(t,[])).next())}))}function Zi(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(l){a=[6,l],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function Ki(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qi(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function ts(t,e,n){if(2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function es(t){return this instanceof es?(this.v=t,this):new es(t)}function ns(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){s.push([t,e,n,r])>1||a(t,e)}))})}function a(t,e){try{!function(t){t.value instanceof es?Promise.resolve(t.value.v).then(l,c):u(s[0][2],t)}(i[t](e))}catch(n){u(s[0][3],n)}}function l(t){a("next",t)}function c(t){a("throw",t)}function u(t,e){t(e),s.shift(),s.length&&a(s[0][0],s[0][1])}}function rs(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=Ki(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}}function is(t){return"function"==typeof t}function ss(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}Mi(),Mi(),Mi(),Mi();var os=ss((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function as(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}Mi();var ls=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,n,r,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=Ki(s),a=o.next();!a.done;a=o.next()){a.value.remove(this)}}catch(p){t={error:p}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else s.remove(this);var l=this.initialTeardown;if(is(l))try{l()}catch(p){i=p instanceof os?p.errors:[p]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=Ki(c),h=u.next();!h.done;h=u.next()){var d=h.value;try{hs(d)}catch(p){i=i??[],p instanceof os?i=ts(ts([],Qi(i)),Qi(p.errors)):i.push(p)}}}catch(p){n={error:p}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new os(i)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)hs(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&as(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&as(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),cs=ls.EMPTY;function us(t){return t instanceof ls||t&&"closed"in t&&is(t.remove)&&is(t.add)&&is(t.unsubscribe)}function hs(t){is(t)?t():t.unsubscribe()}Mi();var ds=void 0,ps=!1;Mi(),Mi();var fs=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,ts([t,e],Qi(n)))};function ms(t){fs((function(){throw t}))}function gs(){}function vs(t){t()}Mi(),Mi(),Mi();var ys=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,us(e)&&e.add(n)):n.destination=Ms,n}return Ji(e,t),e.create=function(t,e,n){return new ws(t,e,n)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(ls),_s=Function.prototype.bind;function bs(t,e){return _s.call(t,e)}var xs=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(n){Ss(n)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(n){Ss(n)}else Ss(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){Ss(e)}},t}(),ws=function(t){function e(e,n,r){var i,s,o=t.call(this)||this;is(e)||!e?i={next:e??void 0,error:n??void 0,complete:r??void 0}:o&&ps?((s=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},i={next:e.next&&bs(e.next,s),error:e.error&&bs(e.error,s),complete:e.complete&&bs(e.complete,s)}):i=e;return o.destination=new xs(i),o}return Ji(e,t),e}(ys);function Ss(t){ms(t)}var Ms={closed:!0,next:gs,error:function(t){throw t},complete:gs};Mi();var Es="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ts(t){return t}Mi(),Mi();var As=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this,i=function(t){return t&&t instanceof ys||function(t){return t&&is(t.next)&&is(t.error)&&is(t.complete)}(t)&&us(t)}(t)?t:new ws(t,e,n);return vs((function(){var t=r,e=t.operator,n=t.source;i.add(e?e.call(i,n):n?r._subscribe(i):r._trySubscribe(i))})),i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=Cs(e))((function(e,r){var i=new ws({next:function(e){try{t(e)}catch(n){r(n),i.unsubscribe()}},error:r,complete:e});n.subscribe(i)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[Es]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(t){return 0===t.length?Ts:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=Cs(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function Cs(t){var e;return null!==(e=t??ds)&&void 0!==e?e:Promise}function Ps(t){return function(e){if(function(t){return is(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(n){this.error(n)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Is(t,e,n,r,i){return new Rs(t,e,n,r,i)}Mi(),Mi();var Rs=function(t){function e(e,n,r,i,s,o){var a=t.call(this,e)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=n?function(t){try{n(t)}catch(r){e.error(r)}}:t.prototype._next,a._error=i?function(t){try{i(t)}catch(n){e.error(n)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=r?function(){try{r()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return Ji(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}(ys);Mi(),Mi();var Ls=ss((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Ns=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return Ji(e,t),e.prototype.lift=function(t){var e=new Os(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new Ls},e.prototype.next=function(t){var e=this;vs((function(){var n,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var i=Ki(e.currentObservers),s=i.next();!s.done;s=i.next()){s.value.next(t)}}catch(o){n={error:o}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},e.prototype.error=function(t){var e=this;vs((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}}))},e.prototype.complete=function(){var t=this;vs((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,n=this,r=n.hasError,i=n.isStopped,s=n.observers;return r||i?cs:(this.currentObservers=null,s.push(t),new ls((function(){e.currentObservers=null,as(s,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,r=e.thrownError,i=e.isStopped;n?t.error(r):i&&t.complete()},e.prototype.asObservable=function(){var t=new As;return t.source=this,t},e.create=function(t,e){return new Os(t,e)},e}(As),Os=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return Ji(e,t),e.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},e.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:cs},e}(Ns);Mi();var ks=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return Ji(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){var t=this,e=t.hasError,n=t.thrownError,r=t._value;if(e)throw n;return this._throwIfClosed(),r},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(Ns);Mi(),Mi();var Ds={now:function(){return(Ds.delegate||Date).now()},delegate:void 0},zs=function(t){function e(e,n,r){void 0===e&&(e=1/0),void 0===n&&(n=1/0),void 0===r&&(r=Ds);var i=t.call(this)||this;return i._bufferSize=e,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,e),i._windowTime=Math.max(1,n),i}return Ji(e,t),e.prototype.next=function(e){var n=this,r=n.isStopped,i=n._buffer,s=n._infiniteTimeWindow,o=n._timestampProvider,a=n._windowTime;r||(i.push(e),!s&&i.push(o.now()+a)),this._trimBuffer(),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(t),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!t.closed;i+=n?1:2)t.next(r[i]);return this._checkFinalizedStatuses(t),e},e.prototype._trimBuffer=function(){var t=this,e=t._bufferSize,n=t._timestampProvider,r=t._buffer,i=t._infiniteTimeWindow,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){for(var o=n.now(),a=0,l=1;l<r.length&&r[l]<=o;l+=2)a=l;a&&r.splice(0,a+1)}},e}(Ns);Mi(),Mi();var Us=function(t){function e(e,n){return t.call(this)||this}return Ji(e,t),e.prototype.schedule=function(t,e){return this},e}(ls);Mi();var Fs={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Fs.delegate;return null!=i&&i.setInterval?i.setInterval.apply(i,ts([t,e],Qi(n))):setInterval.apply(void 0,ts([t,e],Qi(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},Bs=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return Ji(e,t),e.prototype.schedule=function(t,e){var n;if(void 0===e&&(e=0),this.closed)return this;this.state=t;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,e)),this.pending=!0,this.delay=e,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),Fs.setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return e;null!=e&&Fs.clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n,r=!1;try{this.work(t)}catch(i){r=!0,n=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},e.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,as(r,this),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(Us);Mi(),Mi();var Vs=function(){function t(e,n){void 0===n&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(n,e)},t.now=Ds.now,t}(),Hs=function(t){function e(e,n){void 0===n&&(n=Vs.now);var r=t.call(this,e,n)||this;return r.actions=[],r._active=!1,r}return Ji(e,t),e.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(Vs);Mi();var js=new Hs(Bs),Ws=js;Mi(),Mi(),Mi();var Gs=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};Mi(),Mi(),Mi(),Mi(),Mi(),Mi();var qs="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function $s(t){if(t instanceof As)return t;if(null!=t){if(function(t){return is(t[Es])}(t))return function(t){return new As((function(e){var n=t[Es]();if(is(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}))}(t);if(Gs(t))return function(t){return new As((function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()}))}(t);if(function(t){return is(null==t?void 0:t.then)}(t))return function(t){return new As((function(e){t.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,ms)}))}(t);if(function(t){return Symbol.asyncIterator&&is(null==t?void 0:t[Symbol.asyncIterator])}(t))return Xs(t);if(function(t){return is(null==t?void 0:t[qs])}(t))return function(t){return new As((function(e){var n,r;try{for(var i=Ki(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()}))}(t);if(function(t){return is(null==t?void 0:t.getReader)}(t))return function(t){return Xs(function(t){return ns(this,arguments,(function(){var e,n,r;return Zi(this,(function(i){switch(i.label){case 0:e=t.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,es(e.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,es(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,es(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}}))}))}(t))}(t)}throw function(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}(t)}function Xs(t){return new As((function(e){(function(t,e){var n,r,i,s;return Yi(this,0,void 0,(function(){var o,a;return Zi(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=rs(t),l.label=1;case 1:return[4,n.next()];case 2:if((r=l.sent()).done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}}))}))})(t,e).catch((function(t){return e.error(t)}))}))}function Js(t,e){return Ps((function(n,r){var i=0;n.subscribe(Is(r,(function(n){r.next(t.call(e,n,i++))})))}))}Mi(),Mi(),Mi(),Mi(),Mi();var Ys=Array.isArray;function Zs(t){return Js((function(e){return function(t,e){return Ys(e)?t.apply(void 0,ts([],Qi(e))):t(e)}(t,e)}))}function Ks(t,e,n){return void 0===n&&(n=1/0),is(e)?Ks((function(n,r){return Js((function(t,i){return e(n,t,r,i)}))($s(t(n,r)))}),n):("number"==typeof e&&(n=e),Ps((function(e,r){return function(t,e,n,r,i,s,o){var a=[],l=0,c=0,u=!1,h=function(){u&&!a.length&&!l&&e.complete()},d=function(t){l++;var i=!1;$s(n(t,c++)).subscribe(Is(e,(function(t){e.next(t)}),(function(){i=!0}),void 0,(function(){if(i)try{l--;for(var t=function(){var t=a.shift();o?function(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var s=e.schedule((function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()}),r);t.add(s)}(e,o,(function(){return d(t)})):d(t)};a.length&&l<r;)t();h()}catch(j){e.error(j)}})))};return t.subscribe(Is(e,(function(t){return l<r?d(t):a.push(t)}),(function(){u=!0,h()}))),function(){}}(e,r,t,n)})))}Mi(),Mi(),Mi();var Qs=["addListener","removeListener"],to=["addEventListener","removeEventListener"],eo=["on","off"];function no(t,e,n,r){if(is(n)&&(r=n,n=void 0),r)return no(t,e,n).pipe(Zs(r));var i=Qi(function(t){return is(t.addEventListener)&&is(t.removeEventListener)}(t)?to.map((function(r){return function(i){return t[r](e,i,n)}})):function(t){return is(t.addListener)&&is(t.removeListener)}(t)?Qs.map(ro(t,e)):function(t){return is(t.on)&&is(t.off)}(t)?eo.map(ro(t,e)):[],2),s=i[0],o=i[1];if(!s&&Gs(t))return Ks((function(t){return no(t,e,n)}))($s(t));if(!s)throw new TypeError("Invalid event target");return new As((function(t){var e=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.next(1<e.length?e:e[0])};return s(e),function(){return o(e)}}))}function ro(t,e){return function(n){return function(r){return t[n](e,r)}}}function io(t,e,n){void 0===n&&(n=Ws);var r=-1;return null!=e&&(function(t){return t&&is(t.schedule)}(e)?n=e:r=e),new As((function(e){var i=function(t){return t instanceof Date&&!isNaN(t)}(t)?+t-n.now():t;i<0&&(i=0);var s=0;return n.schedule((function(){e.closed||(e.next(s++),0<=r?this.schedule(void 0,r):e.complete())}),i)}))}function so(t,e){return void 0===e&&(e=Ts),t=t??oo,Ps((function(n,r){var i,s=!0;n.subscribe(Is(r,(function(n){var o=e(n);(s||!t(i,o))&&(s=!1,i=o,r.next(n))})))}))}function oo(t,e){return t===e}function ao(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==e){if(!1!==e){var i=new ws({next:function(){i.unsubscribe(),t()}});return $s(e.apply(void 0,ts([],Qi(n)))).subscribe(i)}}else t()}function lo(t,e,n){var r,i,s,o,a=!1;return t&&"object"==typeof t?(r=t.bufferSize,o=void 0===r?1/0:r,i=t.windowTime,e=void 0===i?1/0:i,a=void 0!==(s=t.refCount)&&s,n=t.scheduler):o=t??1/0,function(t){void 0===t&&(t={});var e=t.connector,n=void 0===e?function(){return new Ns}:e,r=t.resetOnError,i=void 0===r||r,s=t.resetOnComplete,o=void 0===s||s,a=t.resetOnRefCountZero,l=void 0===a||a;return function(t){var e,r,s,a=0,c=!1,u=!1,h=function(){null==r||r.unsubscribe(),r=void 0},d=function(){h(),e=s=void 0,c=u=!1},p=function(){var t=e;d(),null==t||t.unsubscribe()};return Ps((function(t,f){a++,!u&&!c&&h();var m=s=s??n();f.add((function(){0===--a&&!u&&!c&&(r=ao(p,l))})),m.subscribe(f),!e&&a>0&&(e=new ws({next:function(t){return m.next(t)},error:function(t){u=!0,h(),r=ao(d,i,t),m.error(t)},complete:function(){c=!0,h(),r=ao(d,o),m.complete()}}),$s(t).subscribe(e))}))(t)}}({connector:function(){return new zs(o,e,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function co(t,e,n){void 0===e&&(e=js);var r=io(t,e);return function(t,e){return Ps((function(n,r){var i=e??{},s=i.leading,o=void 0===s||s,a=i.trailing,l=void 0!==a&&a,c=!1,u=null,h=null,d=!1,p=function(){null==h||h.unsubscribe(),h=null,l&&(g(),d&&r.complete())},f=function(){h=null,d&&r.complete()},m=function(e){return h=$s(t(e)).subscribe(Is(r,p,f))},g=function(){if(c){c=!1;var t=u;u=null,r.next(t),!d&&m(t)}};n.subscribe(Is(r,(function(t){c=!0,u=t,(!h||h.closed)&&(o?g():m(t))}),(function(){d=!0,(!(l&&c&&h)||h.closed)&&r.complete()})))}))}((function(){return r}),n)}Mi(),Mi(),Mi(),Mi(),Mi(),Mi();var uo=class{constructor(t,e){this.subscriptions=new Map,this.setValue=t=>{this.state=t,this.subject.next(this.state)},this.subscribe=(t,e)=>{let n=this.subject.subscribe(e);this.subscriptions.has(t)?this.subscriptions.get(t).push(n):this.subscriptions.set(t,[n])},this.state=t,this.firstState=t,this.subject=e.pipe(so(),lo({bufferSize:1,refCount:!0}))}getValue(){return this.state}unsubscribe(t){var e;null==(e=this.subscriptions.get(t))||e.forEach((t=>t.unsubscribe())),this.subscriptions.delete(t)}destroy(){this.subscriptions.clear(),this.subject.complete(),this.restart()}restart(){this.state=this.firstState,this.subject=new ks(this.firstState).pipe(so(),lo({bufferSize:1,refCount:!0}))}expose(){let t=this.subscribe.bind(this),e=this.unsubscribe.bind(this),n=this.getValue.bind(this),r=this.setValue.bind(this);return{get value(){return n()},set value(t){r(t)},subscribe:t,unsubscribe:e}}};function ho(t){let e=new ks(t);return new uo(t,e)}var po=$i(),fo=new class{constructor(){if(this.localParticipant=ho({}),this.participants=ho({}),this.group=ho(null),this.isDomainWhitelisted=ho(!0),this.hasJoinedRoom=ho(!1),po.value)throw new Error("CommentsStore is a singleton. There can only be one instance of it.");po.value=this}destroy(){this.localParticipant.destroy(),this.participants.destroy(),this.group.destroy(),this.isDomainWhitelisted.destroy(),this.hasJoinedRoom.destroy()}},mo=fo.destroy.bind(fo),go=fo.group.expose(),vo=fo.participants.expose(),yo=fo.localParticipant.expose(),_o=fo.isDomainWhitelisted.expose(),bo=fo.hasJoinedRoom.expose();function xo(){return{localParticipant:yo,participants:vo,group:go,isDomainWhitelisted:_o,hasJoinedRoom:bo,destroy:mo}}Mi(),Mi();var wo=$i(),So=new class{constructor(){if(this.localParticipant=ho({}),this.participants=ho({}),wo.value)throw new Error("CoreStore is a singleton. There can only be one instance of it.");wo.value=this}destroy(){this.localParticipant.destroy(),this.participants.destroy()}},Mo=So.destroy.bind(So),Eo=So.localParticipant.expose(),To=So.participants.expose();Mi();var Ao=$i(),Co=new class{constructor(){if(this.hasJoined3D=ho(!1),this.participants=ho([]),Ao.value)throw new Error("Presence3DStore is a singleton. There can only be one instance of it.");Ao.value=this}destroy(){this.hasJoined3D.destroy(),this.participants.destroy()}},Po=Co.destroy.bind(Co),Io=Co.hasJoined3D.expose(),Ro=Co.participants.expose();Mi(),Mi();var Lo=(t=>(t[t.DISCONNECTED=0]="DISCONNECTED",t[t.INITIALIZING=1]="INITIALIZING",t[t.READY_TO_JOIN=2]="READY_TO_JOIN",t[t.CONNECTING=3]="CONNECTING",t[t.CONNECTED=4]="CONNECTED",t[t.JOINED=5]="JOINED",t[t.FAILED=-1]="FAILED",t[t.RETRYING=-2]="RETRYING",t))(Lo||{}),No=$i(),Oo=new class{constructor(){if(this.meetingState=ho(0),this.gather=ho(!1),this.hostId=ho(""),this.isGridModeEnabled=ho(!1),this.followParticipantId=ho(""),this.drawing=ho(null),this.transcript=ho(null),No.value)throw new Error("VideoStore is a singleton. There can only be one instance of it.");No.value=this}destroy(){this.meetingState.destroy(),this.gather.destroy(),this.hostId.destroy(),this.isGridModeEnabled.destroy(),this.followParticipantId.destroy(),this.drawing.destroy(),this.transcript.destroy()}},ko=Oo.destroy.bind(Oo),Do=Oo.meetingState.expose(),zo=Oo.gather.expose(),Uo=Oo.hostId.expose(),Fo=Oo.isGridModeEnabled.expose(),Bo=Oo.followParticipantId.expose(),Vo=Oo.drawing.expose(),Ho=Oo.transcript.expose();Mi();var jo=$i(),Wo=new class{constructor(){if(this.disablePresenceControls=ho(!1),this.disableGoToParticipant=ho(!1),this.disableFollowParticipant=ho(!1),this.disablePrivateMode=ho(!1),this.disableGatherAll=ho(!1),this.disableFollowMe=ho(!1),this.participants=ho([]),this.extras=ho([]),this.joinedPresence=ho(void 0),this.everyoneFollowsMe=ho(!1),this.privateMode=ho(!1),this.following=ho(void 0),jo.value)throw new Error("WhoIsOnlineStore is a singleton. There can only be one instance of it.");jo.value=this}destroy(){this.disableGoToParticipant.destroy(),this.disablePresenceControls.destroy(),this.disableFollowParticipant.destroy(),this.disablePrivateMode.destroy(),this.disableGatherAll.destroy(),this.disableFollowMe.destroy(),this.participants.destroy(),this.extras.destroy(),this.joinedPresence.destroy(),this.everyoneFollowsMe.destroy(),this.privateMode.destroy(),this.following.destroy()}},Go=Wo.destroy.bind(Wo),qo=Wo.disablePresenceControls.expose(),$o=Wo.disableGoToParticipant.expose(),Xo=Wo.disableFollowParticipant.expose(),Jo=Wo.disablePrivateMode.expose(),Yo=Wo.disableGatherAll.expose(),Zo=Wo.disableFollowMe.expose(),Ko=Wo.joinedPresence.expose(),Qo=Wo.participants.expose(),ta=Wo.extras.expose(),ea=Wo.everyoneFollowsMe.expose(),na=Wo.privateMode.expose(),ra=Wo.following.expose();var ia={"global-store":xo,"who-is-online-store":function(){return{disablePresenceControls:qo,disableGoToParticipant:$o,disableFollowParticipant:Xo,disablePrivateMode:Jo,disableGatherAll:Yo,disableFollowMe:Zo,participants:Qo,extras:ta,joinedPresence:Ko,everyoneFollowsMe:ea,privateMode:na,following:ra,destroy:Go}},"video-store":function(){return{meetingState:Do,gather:zo,destroy:ko,hostId:Uo,isGridModeEnabled:Fo,followParticipantId:Bo,drawing:Vo,transcript:Ho}},"presence-3d-store":function(){return{hasJoined3D:Io,participants:Ro,destroy:Po}},"core-store":function(){return{localParticipant:Eo,participants:To,destroy:Mo}}};function sa(t,e,n){e.subscribe(this,(()=>{n?n(e.value):this[t]=e.value,this.requestUpdate&&this.requestUpdate()})),this.unsubscribeFrom||(this.unsubscribeFrom=[]),this.unsubscribeFrom.push(e.unsubscribe)}function oa(t){let e=ia[t](),n=sa.bind(this);return new Proxy(e,{get:(t,e)=>"destroy"===e?t.destroy:{subscribe(r){n(e,t[e],r)},subject:t[e],get value(){return this.subject.value},publish(t){this.subject.value=t}}})}var aa=bi(((t,e)=>{Mi();var n=1e3,r=60*n,i=60*r,s=24*i,o=7*s,a=365.25*s;function l(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}e.exports=function(t,e){e=e||{};var c=typeof t;if("string"===c&&t.length>0)return function(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var l=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*a;case"weeks":case"week":case"w":return l*o;case"days":case"day":case"d":return l*s;case"hours":case"hour":case"hrs":case"hr":case"h":return l*i;case"minutes":case"minute":case"mins":case"min":case"m":return l*r;case"seconds":case"second":case"secs":case"sec":case"s":return l*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}(t);if("number"===c&&isFinite(t))return e.long?function(t){var e=Math.abs(t);return e>=s?l(t,e,s,"day"):e>=i?l(t,e,i,"hour"):e>=r?l(t,e,r,"minute"):e>=n?l(t,e,n,"second"):t+" ms"}(t):function(t){var e=Math.abs(t);return e>=s?Math.round(t/s)+"d":e>=i?Math.round(t/i)+"h":e>=r?Math.round(t/r)+"m":e>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}})),la=bi(((t,e)=>{Mi(),e.exports=function(t){function e(t){let r,i,s,o=null;function a(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!a.enabled)return;let s=a,o=Number(new Date),l=o-(r||o);s.diff=l,s.prev=r,s.curr=o,r=o,n[0]=e.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");let c=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,((t,r)=>{if("%%"===t)return"%";c++;let i=e.formatters[r];if("function"==typeof i){let e=n[c];t=i.call(s,e),n.splice(c,1),c--}return t})),e.formatArgs.call(s,n),(s.log||e.log).apply(s,n)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=n,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function n(t,n){let r=e(this.namespace+(typeof n>"u"?":":n)+t);return r.log=this.log,r}function r(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){let t=[...e.names.map(r),...e.skips.map(r).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){e.save(t),e.namespaces=t,e.names=[],e.skips=[];let n,r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=aa(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e}})),ca=bi(((t,e)=>{Mi(),t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch{}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=ii.DEBUG),e},t.useColors=function(){if(typeof window<"u"&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch{}}(),t.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=la()(t);var{formatters:n}=e.exports;n.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),ua=bi(((t,e)=>{Mi(),e.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}})),ha=bi(((t,e)=>{Mi();var n="object"==typeof window&&window&&window.Object===Object&&window;e.exports=n})),da=bi(((t,e)=>{Mi();var n=ha(),r="object"==typeof self&&self&&self.Object===Object&&self,i=n||r||Function("return this")();e.exports=i})),pa=bi(((t,e)=>{Mi();var n=da();e.exports=function(){return n.Date.now()}})),fa=bi(((t,e)=>{Mi();var n=/\s/;e.exports=function(t){for(var e=t.length;e--&&n.test(t.charAt(e)););return e}})),ma=bi(((t,e)=>{Mi();var n=fa(),r=/^\s+/;e.exports=function(t){return t&&t.slice(0,n(t)+1).replace(r,"")}})),ga=bi(((t,e)=>{Mi();var n=da().Symbol;e.exports=n})),va=bi(((t,e)=>{Mi();var n=ga(),r=Object.prototype,i=r.hasOwnProperty,s=r.toString,o=n?n.toStringTag:void 0;e.exports=function(t){var e=i.call(t,o),n=t[o];try{t[o]=void 0;var r=!0}catch{}var a=s.call(t);return r&&(e?t[o]=n:delete t[o]),a}})),ya=bi(((t,e)=>{Mi();var n=Object.prototype.toString;e.exports=function(t){return n.call(t)}})),_a=bi(((t,e)=>{Mi();var n=ga(),r=va(),i=ya(),s=n?n.toStringTag:void 0;e.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":s&&s in Object(t)?r(t):i(t)}})),ba=bi(((t,e)=>{Mi(),e.exports=function(t){return null!=t&&"object"==typeof t}})),xa=bi(((t,e)=>{Mi();var n=_a(),r=ba();e.exports=function(t){return"symbol"==typeof t||r(t)&&"[object Symbol]"==n(t)}})),wa=bi(((t,e)=>{Mi();var n=ma(),r=ua(),i=xa(),s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,a=/^0o[0-7]+$/i,l=parseInt;e.exports=function(t){if("number"==typeof t)return t;if(i(t))return NaN;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=n(t);var c=o.test(t);return c||a.test(t)?l(t.slice(2),c?2:8):s.test(t)?NaN:+t}})),Sa=bi(((t,e)=>{Mi();var n=ua(),r=pa(),i=wa(),s=Math.max,o=Math.min;e.exports=function(t,e,a){var l,c,u,h,d,p,f=0,m=!1,g=!1,v=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var n=l,r=c;return l=c=void 0,f=e,h=t.apply(r,n)}function _(t){var n=t-p;return void 0===p||n>=e||n<0||g&&t-f>=u}function b(){var t=r();if(_(t))return x(t);d=setTimeout(b,function(t){var n=e-(t-p);return g?o(n,u-(t-f)):n}(t))}function x(t){return d=void 0,v&&l?y(t):(l=c=void 0,h)}function w(){var t=r(),n=_(t);if(l=arguments,c=this,p=t,n){if(void 0===d)return function(t){return f=t,d=setTimeout(b,e),m?y(t):h}(p);if(g)return clearTimeout(d),d=setTimeout(b,e),y(p)}return void 0===d&&(d=setTimeout(b,e)),h}return e=i(e)||0,n(a)&&(m=!!a.leading,u=(g="maxWait"in a)?s(i(a.maxWait)||0,e):u,v="trailing"in a?!!a.trailing:v),w.cancel=function(){void 0!==d&&clearTimeout(d),f=0,l=p=c=d=void 0},w.flush=function(){return void 0===d?h:x(r())},w}})),Ma=bi(((t,e)=>{Mi();var n=Sa(),r=ua();e.exports=function(t,e,i){var s=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return r(i)&&(s="leading"in i?!!i.leading:s,o="trailing"in i?!!i.trailing:o),n(t,e,{leading:s,maxWait:e,trailing:o})}})),Ea=bi(((t,e)=>{Mi(),function(n,r){"object"==typeof t&&"object"==typeof e?e.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof t?t.bowser=r():n.bowser=r()}(t,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e||4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=90)}({17:function(t,e,n){e.__esModule=!0,e.default=void 0;var r=n(18),i=function(){function t(){}return t.getFirstMatch=function(t,e){var n=e.match(t);return n&&n.length>0&&n[1]||""},t.getSecondMatch=function(t,e){var n=e.match(t);return n&&n.length>1&&n[2]||""},t.matchAndReturnConst=function(t,e,n){if(t.test(e))return n},t.getWindowsVersionName=function(t){switch(t){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},t.getMacOSVersionName=function(t){var e=t.split(".").splice(0,2).map((function(t){return parseInt(t,10)||0}));if(e.push(0),10===e[0])switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},t.getAndroidVersionName=function(t){var e=t.split(".").splice(0,2).map((function(t){return parseInt(t,10)||0}));if(e.push(0),!(1===e[0]&&e[1]<5))return 1===e[0]&&e[1]<6?"Cupcake":1===e[0]&&e[1]>=6?"Donut":2===e[0]&&e[1]<2?"Eclair":2===e[0]&&2===e[1]?"Froyo":2===e[0]&&e[1]>2?"Gingerbread":3===e[0]?"Honeycomb":4===e[0]&&e[1]<1?"Ice Cream Sandwich":4===e[0]&&e[1]<4?"Jelly Bean":4===e[0]&&e[1]>=4?"KitKat":5===e[0]?"Lollipop":6===e[0]?"Marshmallow":7===e[0]?"Nougat":8===e[0]?"Oreo":9===e[0]?"Pie":void 0},t.getVersionPrecision=function(t){return t.split(".").length},t.compareVersions=function(e,n,r){void 0===r&&(r=!1);var i=t.getVersionPrecision(e),s=t.getVersionPrecision(n),o=Math.max(i,s),a=0,l=t.map([e,n],(function(e){var n=o-t.getVersionPrecision(e),r=e+new Array(n+1).join(".0");return t.map(r.split("."),(function(t){return new Array(20-t.length).join("0")+t})).reverse()}));for(r&&(a=o-Math.min(i,s)),o-=1;o>=a;){if(l[0][o]>l[1][o])return 1;if(l[0][o]===l[1][o]){if(o===a)return 0;o-=1}else if(l[0][o]<l[1][o])return-1}},t.map=function(t,e){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(t,e);for(n=0;n<t.length;n+=1)r.push(e(t[n]));return r},t.find=function(t,e){var n,r;if(Array.prototype.find)return Array.prototype.find.call(t,e);for(n=0,r=t.length;n<r;n+=1){var i=t[n];if(e(i,n))return i}},t.assign=function(t){for(var e,n,r=t,i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];if(Object.assign)return Object.assign.apply(Object,[t].concat(s));var a=function(){var t=s[e];"object"==typeof t&&null!==t&&Object.keys(t).forEach((function(e){r[e]=t[e]}))};for(e=0,n=s.length;e<n;e+=1)a();return t},t.getBrowserAlias=function(t){return r.BROWSER_ALIASES_MAP[t]},t.getBrowserTypeByAlias=function(t){return r.BROWSER_MAP[t]||""},t}();e.default=i,t.exports=e.default},18:function(t,e,n){e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(t,e,n){e.__esModule=!0,e.default=void 0;var r,i=(r=n(91))&&r.__esModule?r:{default:r},s=n(18);function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a=function(){function t(){}var e,n;return t.getParser=function(t,e){if(void 0===e&&(e=!1),"string"!=typeof t)throw new Error("UserAgent should be a string");return new i.default(t,e)},t.parse=function(t){return new i.default(t).getResult()},e=t,n=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],null&&o(e.prototype,null),n&&o(e,n),t}();e.default=a,t.exports=e.default},91:function(t,e,n){e.__esModule=!0,e.default=void 0;var r=l(n(92)),i=l(n(93)),s=l(n(94)),o=l(n(95)),a=l(n(17));function l(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(t,e){if(void 0===e&&(e=!1),null==t||""===t)throw new Error("UserAgent parameter can't be empty");this._ua=t,this.parsedResult={},!0!==e&&this.parse()}var e=t.prototype;return e.getUA=function(){return this._ua},e.test=function(t){return t.test(this._ua)},e.parseBrowser=function(){var t=this;this.parsedResult.browser={};var e=a.default.find(r.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},e.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},e.getBrowserName=function(t){return t?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},e.getBrowserVersion=function(){return this.getBrowser().version},e.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},e.parseOS=function(){var t=this;this.parsedResult.os={};var e=a.default.find(i.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},e.getOSName=function(t){var e=this.getOS().name;return t?String(e).toLowerCase()||"":e||""},e.getOSVersion=function(){return this.getOS().version},e.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},e.getPlatformType=function(t){void 0===t&&(t=!1);var e=this.getPlatform().type;return t?String(e).toLowerCase()||"":e||""},e.parsePlatform=function(){var t=this;this.parsedResult.platform={};var e=a.default.find(s.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},e.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},e.getEngineName=function(t){return t?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},e.parseEngine=function(){var t=this;this.parsedResult.engine={};var e=a.default.find(o.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},e.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},e.getResult=function(){return a.default.assign({},this.parsedResult)},e.satisfies=function(t){var e=this,n={},r=0,i={},s=0;if(Object.keys(t).forEach((function(e){var o=t[e];"string"==typeof o?(i[e]=o,s+=1):"object"==typeof o&&(n[e]=o,r+=1)})),r>0){var o=Object.keys(n),l=a.default.find(o,(function(t){return e.isOS(t)}));if(l){var c=this.satisfies(n[l]);if(void 0!==c)return c}var u=a.default.find(o,(function(t){return e.isPlatform(t)}));if(u){var h=this.satisfies(n[u]);if(void 0!==h)return h}}if(s>0){var d=Object.keys(i),p=a.default.find(d,(function(t){return e.isBrowser(t,!0)}));if(void 0!==p)return this.compareVersion(i[p])}},e.isBrowser=function(t,e){void 0===e&&(e=!1);var n=this.getBrowserName().toLowerCase(),r=t.toLowerCase(),i=a.default.getBrowserTypeByAlias(r);return e&&i&&(r=i.toLowerCase()),r===n},e.compareVersion=function(t){var e=[0],n=t,r=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===t[0]||"<"===t[0]?(n=t.substr(1),"="===t[1]?(r=!0,n=t.substr(2)):e=[],">"===t[0]?e.push(1):e.push(-1)):"="===t[0]?n=t.substr(1):"~"===t[0]&&(r=!0,n=t.substr(1)),e.indexOf(a.default.compareVersions(i,n,r))>-1},e.isOS=function(t){return this.getOSName(!0)===String(t).toLowerCase()},e.isPlatform=function(t){return this.getPlatformType(!0)===String(t).toLowerCase()},e.isEngine=function(t){return this.getEngineName(!0)===String(t).toLowerCase()},e.is=function(t,e){return void 0===e&&(e=!1),this.isBrowser(t,e)||this.isOS(t)||this.isPlatform(t)},e.some=function(t){var e=this;return void 0===t&&(t=[]),t.some((function(t){return e.is(t)}))},t}();e.default=c,t.exports=e.default},92:function(t,e,n){e.__esModule=!0,e.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},s=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(t){var e={name:"Googlebot"},n=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/opera/i],describe:function(t){var e={name:"Opera"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opr\/|opios/i],describe:function(t){var e={name:"Opera"},n=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/SamsungBrowser/i],describe:function(t){var e={name:"Samsung Internet for Android"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Whale/i],describe:function(t){var e={name:"NAVER Whale Browser"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MZBrowser/i],describe:function(t){var e={name:"MZ Browser"},n=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/focus/i],describe:function(t){var e={name:"Focus"},n=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/swing/i],describe:function(t){var e={name:"Swing"},n=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/coast/i],describe:function(t){var e={name:"Opera Coast"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(t){var e={name:"Opera Touch"},n=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/yabrowser/i],describe:function(t){var e={name:"Yandex Browser"},n=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/ucbrowser/i],describe:function(t){var e={name:"UC Browser"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Maxthon|mxios/i],describe:function(t){var e={name:"Maxthon"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/epiphany/i],describe:function(t){var e={name:"Epiphany"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/puffin/i],describe:function(t){var e={name:"Puffin"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sleipnir/i],describe:function(t){var e={name:"Sleipnir"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/k-meleon/i],describe:function(t){var e={name:"K-Meleon"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/micromessenger/i],describe:function(t){var e={name:"WeChat"},n=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/qqbrowser/i],describe:function(t){var e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},n=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/msie|trident/i],describe:function(t){var e={name:"Internet Explorer"},n=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/\sedg\//i],describe:function(t){var e={name:"Microsoft Edge"},n=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/edg([ea]|ios)/i],describe:function(t){var e={name:"Microsoft Edge"},n=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/vivaldi/i],describe:function(t){var e={name:"Vivaldi"},n=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/seamonkey/i],describe:function(t){var e={name:"SeaMonkey"},n=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sailfish/i],describe:function(t){var e={name:"Sailfish"},n=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return n&&(e.version=n),e}},{test:[/silk/i],describe:function(t){var e={name:"Amazon Silk"},n=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/phantom/i],describe:function(t){var e={name:"PhantomJS"},n=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/slimerjs/i],describe:function(t){var e={name:"SlimerJS"},n=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e={name:"BlackBerry"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e={name:"WebOS Browser"},n=i.default.getFirstMatch(s,t)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/bada/i],describe:function(t){var e={name:"Bada"},n=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/tizen/i],describe:function(t){var e={name:"Tizen"},n=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/qupzilla/i],describe:function(t){var e={name:"QupZilla"},n=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/firefox|iceweasel|fxios/i],describe:function(t){var e={name:"Firefox"},n=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/electron/i],describe:function(t){var e={name:"Electron"},n=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MiuiBrowser/i],describe:function(t){var e={name:"Miui"},n=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/chromium/i],describe:function(t){var e={name:"Chromium"},n=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/chrome|crios|crmo/i],describe:function(t){var e={name:"Chrome"},n=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/GSA/i],describe:function(t){var e={name:"Google Search"},n=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:function(t){var e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe:function(t){var e={name:"Android Browser"},n=i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/playstation 4/i],describe:function(t){var e={name:"PlayStation 4"},n=i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/safari|applewebkit/i],describe:function(t){var e={name:"Safari"},n=i.default.getFirstMatch(s,t);return n&&(e.version=n),e}},{test:[/.*/i],describe:function(t){var e=-1!==t.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(e,t),version:i.default.getSecondMatch(e,t)}}}];e.default=o,t.exports=e.default},93:function(t,e,n){e.__esModule=!0,e.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},s=n(18),o=[{test:[/Roku\/DVP/],describe:function(t){var e=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:s.OS_MAP.Roku,version:e}}},{test:[/windows phone/i],describe:function(t){var e=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:s.OS_MAP.WindowsPhone,version:e}}},{test:[/windows /i],describe:function(t){var e=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),n=i.default.getWindowsVersionName(e);return{name:s.OS_MAP.Windows,version:e,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(t){var e={name:s.OS_MAP.iOS},n=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return n&&(e.version=n),e}},{test:[/macintosh/i],describe:function(t){var e=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),n=i.default.getMacOSVersionName(e),r={name:s.OS_MAP.MacOS,version:e};return n&&(r.versionName=n),r}},{test:[/(ipod|iphone|ipad)/i],describe:function(t){var e=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:e}}},{test:function(t){var e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe:function(t){var e=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),n=i.default.getAndroidVersionName(e),r={name:s.OS_MAP.Android,version:e};return n&&(r.versionName=n),r}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),n={name:s.OS_MAP.WebOS};return e&&e.length&&(n.version=e),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||i.default.getFirstMatch(/\bbb(\d+)/i,t);return{name:s.OS_MAP.BlackBerry,version:e}}},{test:[/bada/i],describe:function(t){var e=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:s.OS_MAP.Bada,version:e}}},{test:[/tizen/i],describe:function(t){var e=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:s.OS_MAP.Tizen,version:e}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(t){var e=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:s.OS_MAP.PlayStation4,version:e}}}];e.default=o,t.exports=e.default},94:function(t,e,n){e.__esModule=!0,e.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},s=n(18),o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(t){var e=i.default.getFirstMatch(/(can-l01)/i,t)&&"Nova",n={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return e&&(n.model=e),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(t){var e=t.test(/ipod|iphone/i),n=t.test(/like (ipod|iphone)/i);return e&&!n},describe:function(t){var e=i.default.getFirstMatch(/(ipod|iphone)/i,t);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(t){return"blackberry"===t.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(t){return"bada"===t.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(t){return"windows phone"===t.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(t){var e=Number(String(t.getOSVersion()).split(".")[0]);return"android"===t.getOSName(!0)&&e>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(t){return"android"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(t){return"macos"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(t){return"windows"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(t){return"linux"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(t){return"playstation 4"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(t){return"roku"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];e.default=o,t.exports=e.default},95:function(t,e,n){e.__esModule=!0,e.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},s=n(18),o=[{test:function(t){return"microsoft edge"===t.getBrowserName(!0)},describe:function(t){if(/\sedg\//i.test(t))return{name:s.ENGINE_MAP.Blink};var e=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:s.ENGINE_MAP.EdgeHTML,version:e}}},{test:[/trident/i],describe:function(t){var e={name:s.ENGINE_MAP.Trident},n=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:function(t){return t.test(/presto/i)},describe:function(t){var e={name:s.ENGINE_MAP.Presto},n=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:function(t){var e=t.test(/gecko/i),n=t.test(/like gecko/i);return e&&!n},describe:function(t){var e={name:s.ENGINE_MAP.Gecko},n=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(t){var e={name:s.ENGINE_MAP.WebKit},n=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}}];e.default=o,t.exports=e.default}})}))}));Mi(),Mi();var Ta=xi(ca());Mi();var Aa=(t=>(t.svPrimary="sv-primary",t.svPrimary900="sv-primary-900",t.svPrimary200="sv-primary-200",t.svSecondary="sv-secondary",t.svGray="sv-gray",t.svSuccess="sv-success",t.svDanger="sv-danger",t.svBlack="sv-black",t.svWhite="sv-white",t.svGray100="sv-gray-100",t.svGray200="sv-gray-200",t.svGray300="sv-gray-300",t.svGray400="sv-gray-400",t.svGray500="sv-gray-500",t.svGray600="sv-gray-600",t.svGray700="sv-gray-700",t.svGray800="sv-gray-800",t))(Aa||{});Mi(),Mi(),Mi(),Mi();var Ca=function(t,e,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];return Si(void 0,[t,e,n,...i],(function(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function*(){let i=yield fetch(t,{method:e,headers:vi({"Content-Type":"application/json"},r),body:n?JSON.stringify(n):null});if(!i.ok)throw i;try{return yield i.json()}catch{return i.ok}}()}))};Mi();var Pa=xi(ca()),Ia=class{constructor(t){this.debug=(0,Pa.default)(t)}log(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.debug(t,...n)}};Mi(),Mi();var Ra=xi(Ma()),La=class{constructor(){var t=this;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.subscribe=t=>{this.callbacks.push(t)},this.unsubscribe=t=>{this.callbacks=this.callbacks.filter((e=>e!==t))},this.publish=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.callbacks&&t.callbacks.forEach((e=>{t.callListener(e,n).catch((r=>{var i;null==(i=t.logger)||i.log("superviz-sdk:observer-helper:publish:error",`\n            Failed to execute callback on publish value.\n            Callback: ${e.name}\n            Event: ${JSON.stringify(n)}\n            Error: ${r}\n          `)}))}))},this.reset=()=>{this.callbacks=[]},this.destroy=()=>{delete this.logger,delete this.callbacks},this.callListener=(t,e)=>new Promise(((n,r)=>{try{n(t(...e))}catch(i){r(i)}}));let{logger:n,throttleTime:r}=e;this.logger=n||new Ia("@superviz/sdk/observer-helper"),this.throttle=r,this.callbacks=[],this.throttle&&(this.publish=(0,Ra.default)(this.publish,this.throttle))}},Na=class{constructor(){this.observers={},this.subscribe=(t,e)=>{this.logger.log(`subscribed to ${t} event`),this.observers[t]||(this.observers[t]=new La({logger:this.logger})),this.observers[t].subscribe(e)},this.unsubscribe=(t,e)=>{if(this.logger.log(`unsubscribed from ${t} event`),this.observers[t]){if(!e)return this.observers[t].destroy(),void delete this.observers[t];this.observers[t].unsubscribe(e)}},this.publish=(t,e)=>{t in this.observers&&this.observers[t].publish(e)}}};Mi();var Oa=class{static createUrl(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new URL(e,t);return Object.keys(n).forEach((t=>r.searchParams.append(t,n[t]))),r.toString()}static validateApiKey(t,e){let n=this.createUrl(t,"/user/checkapikey");return Ca(n,"POST",{apiKey:e})}static fetchConfig(t,e){let n=this.createUrl(t,"/immersive-config");return Ca(n,"POST",{apiKey:e})}static fetchLimits(t,e){return Si(this,null,(function*(){let n=this.createUrl(t,"/user/check_limits_v2");return(yield Ca(n,"GET","",{apikey:e})).limits}))}static fetchWaterMark(t,e){return Si(this,null,(function*(){let n=this.createUrl(t,"/user/watermark"),{message:r}=yield Ca(n,"POST",{apiKey:e});return r}))}static createAnnotations(t,e,n){return Si(this,null,(function*(){let r=this.createUrl(t,"/annotations");return Ca(r,"POST",vi({},n),{apikey:e})}))}static updateComment(t,e,n,r){return Si(this,null,(function*(){let i=`/comments/${n}`,s=this.createUrl(t,i);return Ca(s,"PUT",{text:r},{apikey:e})}))}static createComment(t,e,n){return Si(this,null,(function*(){let r=this.createUrl(t,"/comments");return Ca(r,"POST",vi({},n),{apikey:e})}))}static fetchAnnotation(t,e,n){return Si(this,null,(function*(){let r=this.createUrl(t,"/annotations",{roomId:n.roomId});return Ca(r,"GET",void 0,{apikey:e})}))}static resolveAnnotation(t,e,n){return Si(this,null,(function*(){let r=`/annotations/resolve/${n}`,i=this.createUrl(t,r);return Ca(i,"POST",{},{apikey:e})}))}static deleteComment(t,e,n){return Si(this,null,(function*(){let r=`/comments/${n}`,i=this.createUrl(t,r);return Ca(i,"DELETE",{},{apikey:e})}))}static deleteAnnotation(t,e,n){return Si(this,null,(function*(){let r=`/annotations/${n}`,i=this.createUrl(t,r);return Ca(i,"DELETE",{},{apikey:e})}))}static createParticipant(t){return Si(this,null,(function*(){let e=qi.get("apiUrl"),n=this.createUrl(e,"/participants");return Ca(n,"POST",vi({},t),{apikey:qi.get("apiKey")})}))}static fetchParticipant(t){return Si(this,null,(function*(){let e=qi.get("apiUrl"),n=`/participants/${t}`,r=this.createUrl(e,n);return Ca(r,"GET",void 0,{apikey:qi.get("apiKey")})}))}static sendActivity(t,e,n,r){return Si(this,null,(function*(){let i=qi.get("apiUrl"),s=qi.get("roomId"),o=qi.get("apiKey"),a=this.createUrl(i,"/activity");return Ca(a,"POST",{groupId:e,groupName:n,meetingId:s,product:r,userId:t},{apikey:o})}))}static fetchParticipantsByGroup(t){return Si(this,null,(function*(){let e=`/groups/participants/${t}`,n=qi.get("apiUrl"),r=this.createUrl(n,e,{take:1e4});return Ca(r,"GET",void 0,{apikey:qi.get("apiKey")})}))}static createMentions(t){return Si(this,null,(function*(){let e=qi.get("apiUrl"),n=this.createUrl(e,"/mentions");return Ca(n,"POST",t,{apikey:qi.get("apiKey")})}))}};Mi();var ka=function(t,e){return Si(this,null,(function*(){try{return!0===(yield Oa.validateApiKey(t,e))}catch(n){if(404===n.status)return!1;throw new Error("Unable to validate API key")}}))};Mi();var Da=class{static getRemoteConfig(){return Si(this,arguments,(function(){var t=this;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"prod";return function*(){if("local"===e)return(yield n.e(513).then(n.bind(n,1513))).default.remoteConfig;let r={version:"6.7.1-beta.1",environment:e},i=t.createUrl(r);return Ca(i,"GET",null)}()}))}static getFeatures(t){return Si(this,null,(function*(){return Ca(`${this.REMOTE_CONFIG_BASE_URL}/features/${t}`,"GET",void 0)}))}static createUrl(t){let{version:e,environment:n}=t;return`${this.REMOTE_CONFIG_BASE_URL}/sdk/${e}?env=${n}`}};Da.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com",Mi(),Mi();var za=Object.create,Ua=Object.defineProperty,Fa=Object.defineProperties,Ba=Object.getOwnPropertyDescriptor,Va=Object.getOwnPropertyDescriptors,Ha=Object.getOwnPropertyNames,ja=Object.getOwnPropertySymbols,Wa=Object.getPrototypeOf,Ga=Object.prototype.hasOwnProperty,qa=Object.prototype.propertyIsEnumerable,$a=(t,e,n)=>e in t?Ua(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Xa=(t,e)=>{for(var n in e||(e={}))Ga.call(e,n)&&$a(t,n,e[n]);if(ja)for(var n of ja(e))qa.call(e,n)&&$a(t,n,e[n]);return t},Ja=(t,e)=>Fa(t,Va(e)),Ya=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Za=(t,e,n)=>new Promise(((r,i)=>{var s=t=>{try{a(n.next(t))}catch(e){i(e)}},o=t=>{try{a(n.throw(t))}catch(e){i(e)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,o);a((n=n.apply(t,e)).next())})),Ka=Ya(((t,e)=>{var n=1e3,r=60*n,i=60*r,s=24*i,o=7*s,a=365.25*s;function l(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}e.exports=function(t,e){e=e||{};var c=typeof t;if("string"===c&&t.length>0)return function(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var l=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*a;case"weeks":case"week":case"w":return l*o;case"days":case"day":case"d":return l*s;case"hours":case"hour":case"hrs":case"hr":case"h":return l*i;case"minutes":case"minute":case"mins":case"min":case"m":return l*r;case"seconds":case"second":case"secs":case"sec":case"s":return l*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}(t);if("number"===c&&isFinite(t))return e.long?function(t){var e=Math.abs(t);return e>=s?l(t,e,s,"day"):e>=i?l(t,e,i,"hour"):e>=r?l(t,e,r,"minute"):e>=n?l(t,e,n,"second"):t+" ms"}(t):function(t){var e=Math.abs(t);return e>=s?Math.round(t/s)+"d":e>=i?Math.round(t/i)+"h":e>=r?Math.round(t/r)+"m":e>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}})),Qa=Ya(((t,e)=>{e.exports=function(t){function e(t){let r,i,s,o=null;function a(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!a.enabled)return;let s=a,o=Number(new Date),l=o-(r||o);s.diff=l,s.prev=r,s.curr=o,r=o,n[0]=e.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");let c=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,((t,r)=>{if("%%"===t)return"%";c++;let i=e.formatters[r];if("function"==typeof i){let e=n[c];t=i.call(s,e),n.splice(c,1),c--}return t})),e.formatArgs.call(s,n),(s.log||e.log).apply(s,n)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=n,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function n(t,n){let r=e(this.namespace+(typeof n>"u"?":":n)+t);return r.log=this.log,r}function r(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){let t=[...e.names.map(r),...e.skips.map(r).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){e.save(t),e.namespaces=t,e.names=[],e.skips=[];let n,r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=Ka(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e}})),tl=Ya(((t,e)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch{}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=ii.DEBUG),e},t.useColors=function(){if(typeof window<"u"&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch{}}(),t.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=Qa()(t);var{formatters:n}=e.exports;n.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),el=(t=>(t.JOIN_ROOM="room.join",t.JOINED_ROOM="room.joined",t.LEAVE_ROOM="room.leave",t.UPDATE="room.update",t.ERROR="room.error",t))(el||{}),nl=(t=>(t.JOINED_ROOM="presence.joined-room",t.LEAVE="presence.leave",t.UPDATE="presence.update",t))(nl||{}),rl=(t=>(t.CONNECTED="CONNECTED",t.CONNECTING="CONNECTING",t.DISCONNECTED="DISCONNECTED",t.CONNECTION_ERROR="CONNECTION_ERROR",t.RECONNECTING="RECONNECTING",t.RECONNECT_ERROR="RECONNECT_ERROR",t))(rl||{}),il=function(t,e){return(il=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function sl(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}il(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function ol(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function al(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function ll(t,e,n){if(2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function cl(t){return"function"==typeof t}function ul(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var hl=ul((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function dl(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var pl=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,n,r,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=ol(s),a=o.next();!a.done;a=o.next()){a.value.remove(this)}}catch(p){t={error:p}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else s.remove(this);var l=this.initialTeardown;if(cl(l))try{l()}catch(p){i=p instanceof hl?p.errors:[p]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=ol(c),h=u.next();!h.done;h=u.next()){var d=h.value;try{gl(d)}catch(p){i=i??[],p instanceof hl?i=ll(ll([],al(i)),al(p.errors)):i.push(p)}}}catch(p){n={error:p}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new hl(i)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)gl(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&dl(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&dl(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),fl=pl.EMPTY;function ml(t){return t instanceof pl||t&&"closed"in t&&cl(t.remove)&&cl(t.add)&&cl(t.unsubscribe)}function gl(t){cl(t)?t():t.unsubscribe()}var vl=void 0,yl=!1,_l=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,ll([t,e],al(n)))};function bl(){}function xl(t){t()}var wl=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,ml(e)&&e.add(n)):n.destination=Cl,n}return sl(e,t),e.create=function(t,e,n){return new Tl(t,e,n)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(pl),Sl=Function.prototype.bind;function Ml(t,e){return Sl.call(t,e)}var El=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(n){Al(n)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(n){Al(n)}else Al(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){Al(e)}},t}(),Tl=function(t){function e(e,n,r){var i,s,o=t.call(this)||this;cl(e)||!e?i={next:e??void 0,error:n??void 0,complete:r??void 0}:o&&yl?((s=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},i={next:e.next&&Ml(e.next,s),error:e.error&&Ml(e.error,s),complete:e.complete&&Ml(e.complete,s)}):i=e;return o.destination=new El(i),o}return sl(e,t),e}(wl);function Al(t){!function(t){_l((function(){throw t}))}(t)}var Cl={closed:!0,next:bl,error:function(t){throw t},complete:bl},Pl="function"==typeof Symbol&&Symbol.observable||"@@observable";function Il(t){return t}var Rl=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this,i=function(t){return t&&t instanceof wl||function(t){return t&&cl(t.next)&&cl(t.error)&&cl(t.complete)}(t)&&ml(t)}(t)?t:new Tl(t,e,n);return xl((function(){var t=r,e=t.operator,n=t.source;i.add(e?e.call(i,n):n?r._subscribe(i):r._trySubscribe(i))})),i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=Ll(e))((function(e,r){var i=new Tl({next:function(e){try{t(e)}catch(n){r(n),i.unsubscribe()}},error:r,complete:e});n.subscribe(i)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[Pl]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(t){return 0===t.length?Il:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=Ll(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function Ll(t){var e;return null!==(e=t??vl)&&void 0!==e?e:Promise}var Nl=ul((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Ol=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return sl(e,t),e.prototype.lift=function(t){var e=new kl(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new Nl},e.prototype.next=function(t){var e=this;xl((function(){var n,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var i=ol(e.currentObservers),s=i.next();!s.done;s=i.next()){s.value.next(t)}}catch(o){n={error:o}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},e.prototype.error=function(t){var e=this;xl((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}}))},e.prototype.complete=function(){var t=this;xl((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,n=this,r=n.hasError,i=n.isStopped,s=n.observers;return r||i?fl:(this.currentObservers=null,s.push(t),new pl((function(){e.currentObservers=null,dl(s,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,r=e.thrownError,i=e.isStopped;n?t.error(r):i&&t.complete()},e.prototype.asObservable=function(){var t=new Rl;return t.source=this,t},e.create=function(t,e){return new kl(t,e)},e}(Rl),kl=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return sl(e,t),e.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},e.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:fl},e}(Ol),Dl=((t,e,n)=>(n=null!=t?za(Wa(t)):{},((t,e,n,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of Ha(e))!Ga.call(t,i)&&i!==n&&Ua(t,i,{get:()=>e[i],enumerable:!(r=Ba(e,i))||r.enumerable});return t})(t&&t.__esModule?n:Ua(n,"default",{value:t,enumerable:!0}),t)))(tl()),zl=class{constructor(t){this.debug=(0,Dl.default)(t),Dl.default.enable("*")}log(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.debug(t,...n)}},Ul=class t{constructor(t,e,n){this.io=t,this.presence=e,this.roomId=n,this.presences=new Set,this.observers=new Map,this.onPresenceJoin=t=>{(null==t?void 0:t.roomId)===this.roomId&&(this.logger.log("presence room @ presence join",t),this.presences.add(t),this.observers.get("presence.joined-room").next({connectionId:t.connectionId,data:t.data,id:t.id,name:t.name,timestamp:t.timestamp}))},this.onPresenceLeave=t=>{(null==t?void 0:t.roomId)===this.roomId&&(this.logger.log("presence room @ presence leave",t),this.presences.delete(t),this.observers.get("presence.leave").next(t))},this.onPresenceUpdate=t=>{(null==t?void 0:t.roomId)===this.roomId&&(this.logger.log("presence room @ presence update",t),this.observers.get("presence.update").next({connectionId:t.connectionId,data:t.data,id:t.id,name:t.name,roomId:null==t?void 0:t.roomId,timestamp:t.timestamp}))},this.logger=new zl("@superviz/socket-client/presence"),this.registerSubjects(),this.subscribeToPresenceEvents()}static register(e,n,r){return new t(e,n,r)}get(t,e){let n=new Ol;n.subscribe({next:t,error:e});let r=t=>{let e=t.presences.map((t=>({connectionId:t.connectionId,data:t.data,id:t.id,name:t.name,timestamp:t.timestamp})));this.logger.log("presence room @ get",t),this.io.off("presence.get",r),n.next(e),n.complete()};this.io.on("presence.get",r),this.io.emit("presence.get",this.roomId)}update(t){let e={connectionId:this.io.id,data:t,id:this.presence.id,name:this.presence.name,timestamp:Date.now()};this.io.emit("presence.update",this.roomId,e),this.logger.log("presence room @ update",this.roomId,e)}destroy(){this.io.off("presence.joined-room",this.onPresenceJoin),this.io.off("presence.leave",this.onPresenceLeave),this.io.off("presence.update",this.onPresenceUpdate),this.observers.forEach((t=>t.unsubscribe())),this.observers.clear()}registerSubjects(){this.observers.set("presence.joined-room",new Ol),this.observers.set("presence.leave",new Ol),this.observers.set("presence.update",new Ol)}on(t,e,n){this.observers.get(t).subscribe({error:n,next:e})}off(t){this.observers.get(t).unsubscribe(),this.observers.delete(t),this.observers.set(t,new Ol)}subscribeToPresenceEvents(){this.io.on("presence.joined-room",this.onPresenceJoin),this.io.on("presence.leave",this.onPresenceLeave),this.io.on("presence.update",this.onPresenceUpdate)}},Fl=Object.create(null);Fl.open="0",Fl.close="1",Fl.ping="2",Fl.pong="3",Fl.message="4",Fl.upgrade="5",Fl.noop="6";var Bl=Object.create(null);Object.keys(Fl).forEach((t=>{Bl[Fl[t]]=t}));var Vl,Hl={type:"error",data:"parser error"},jl="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Wl="function"==typeof ArrayBuffer,Gl=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,ql=(t,e,n)=>{let{type:r,data:i}=t;return jl&&i instanceof Blob?e?n(i):$l(i,n):Wl&&(i instanceof ArrayBuffer||Gl(i))?e?n(i):$l(new Blob([i]),n):n(Fl[r]+(i||""))},$l=(t,e)=>{let n=new FileReader;return n.onload=function(){let t=n.result.split(",")[1];e("b"+(t||""))},n.readAsDataURL(t)};function Xl(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}var Jl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Yl=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let o=0;o<64;o++)Yl[Jl.charCodeAt(o)]=o;var Zl,Kl="function"==typeof ArrayBuffer,Ql=(t,e)=>{if("string"!=typeof t)return{type:"message",data:ec(t,e)};let n=t.charAt(0);return"b"===n?{type:"message",data:tc(t.substring(1),e)}:Bl[n]?t.length>1?{type:Bl[n],data:t.substring(1)}:{type:Bl[n]}:Hl},tc=(t,e)=>{if(Kl){let n=(t=>{let e,n,r,i,s,o=.75*t.length,a=t.length,l=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);let c=new ArrayBuffer(o),u=new Uint8Array(c);for(e=0;e<a;e+=4)n=Yl[t.charCodeAt(e)],r=Yl[t.charCodeAt(e+1)],i=Yl[t.charCodeAt(e+2)],s=Yl[t.charCodeAt(e+3)],u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|i>>2,u[l++]=(3&i)<<6|63&s;return c})(t);return ec(n,e)}return{base64:!0,data:t}},ec=(t,e)=>"blob"===e?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer;function nc(){return new TransformStream({transform(t,e){!function(t,e){jl&&t.data instanceof Blob?t.data.arrayBuffer().then(Xl).then(e):Wl&&(t.data instanceof ArrayBuffer||Gl(t.data))?e(Xl(t.data)):ql(t,!1,(t=>{Vl||(Vl=new TextEncoder),e(Vl.encode(t))}))}(t,(n=>{let r,i=n.length;if(i<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,i);else if(i<65536){r=new Uint8Array(3);let t=new DataView(r.buffer);t.setUint8(0,126),t.setUint16(1,i)}else{r=new Uint8Array(9);let t=new DataView(r.buffer);t.setUint8(0,127),t.setBigUint64(1,BigInt(i))}t.data&&"string"!=typeof t.data&&(r[0]|=128),e.enqueue(r),e.enqueue(n)}))}})}function rc(t){return t.reduce(((t,e)=>t+e.length),0)}function ic(t,e){if(t[0].length===e)return t.shift();let n=new Uint8Array(e),r=0;for(let i=0;i<e;i++)n[i]=t[0][r++],r===t[0].length&&(t.shift(),r=0);return t.length&&r<t[0].length&&(t[0]=t[0].slice(r)),n}function sc(t){if(t)return function(t){for(var e in sc.prototype)t[e]=sc.prototype[e];return t}(t)}sc.prototype.on=sc.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},sc.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},sc.prototype.off=sc.prototype.removeListener=sc.prototype.removeAllListeners=sc.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+t],this},sc.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){r=0;for(var i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,e)}return this},sc.prototype.emitReserved=sc.prototype.emit,sc.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},sc.prototype.hasListeners=function(t){return!!this.listeners(t).length};var oc=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function ac(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return n.reduce(((e,n)=>(t.hasOwnProperty(n)&&(e[n]=t[n]),e)),{})}var lc=oc.setTimeout,cc=oc.clearTimeout;function uc(t,e){e.useNativeTimers?(t.setTimeoutFn=lc.bind(oc),t.clearTimeoutFn=cc.bind(oc)):(t.setTimeoutFn=oc.setTimeout.bind(oc),t.clearTimeoutFn=oc.clearTimeout.bind(oc))}function hc(t){return"string"==typeof t?function(t){let e=0,n=0;for(let r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))}var dc,pc=class extends Error{constructor(t,e,n){super(t),this.description=e,this.context=n,this.type="TransportError"}},fc=class extends sc{constructor(t){super(),this.writable=!1,uc(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,e,n){return super.emitReserved("error",new pc(t,e,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){let e=Ql(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){let t=this.opts.hostname;return-1===t.indexOf(":")?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(t){let e=function(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}(t);return e.length?"?"+e:""}},mc="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),gc={},vc=0,yc=0;function _c(t){let e="";do{e=mc[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function bc(){let t=_c(+new Date);return t!==dc?(vc=0,dc=t):t+"."+_c(vc++)}for(;yc<64;yc++)gc[mc[yc]]=yc;var xc=!1;try{xc=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var wc=xc;function Sc(t){let e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||wc))return new XMLHttpRequest}catch{}if(!e)try{return new(oc[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function Mc(){}var Ec=null!=new Sc({xdomain:!1}).responseType,Tc=class t extends sc{constructor(t,e){super(),uc(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.data=void 0!==e.data?e.data:null,this.create()}create(){var e;let n=ac(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;let r=this.xhr=new Sc(n);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&r.setRequestHeader(t,this.opts.extraHeaders[t])}}catch{}if("POST"===this.method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var t;3===r.readyState&&(null===(t=this.opts.cookieJar)||void 0===t||t.parseCookies(r)),4===r.readyState&&(200===r.status||1223===r.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof r.status?r.status:0)}),0))},r.send(this.data)}catch(o){return void this.setTimeoutFn((()=>{this.onError(o)}),0)}typeof document<"u"&&(this.index=t.requestsCount++,t.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=Mc,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete t.requests[this.index],this.xhr=null}}onLoad(){let t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};if(Tc.requestsCount=0,Tc.requests={},typeof document<"u")if("function"==typeof attachEvent)attachEvent("onunload",Ac);else if("function"==typeof addEventListener){addEventListener("onpagehide"in oc?"pagehide":"unload",Ac,!1)}function Ac(){for(let t in Tc.requests)Tc.requests.hasOwnProperty(t)&&Tc.requests[t].abort()}var Cc="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),Pc=oc.WebSocket||oc.MozWebSocket,Ic=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),Rc={websocket:class extends fc{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let t=this.uri(),e=this.opts.protocols,n=Ic?{}:ac(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Ic?new Pc(t,e,n):e?new Pc(t,e):new Pc(t)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){let n=t[e],r=e===t.length-1;ql(n,this.supportsBinary,(t=>{try{this.ws.send(t)}catch{}r&&Cc((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=bc()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}check(){return!!Pc}},webtransport:class extends fc{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((t=>{this.onError("webtransport error",t)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((t=>{let e=function(t,e){Zl||(Zl=new TextDecoder);let n=[],r=0,i=-1,s=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(0===r){if(rc(n)<1)break;let t=ic(n,1);s=128===(128&t[0]),i=127&t[0],r=i<126?3:126===i?1:2}else if(1===r){if(rc(n)<2)break;let t=ic(n,2);i=new DataView(t.buffer,t.byteOffset,t.length).getUint16(0),r=3}else if(2===r){if(rc(n)<8)break;let t=ic(n,8),e=new DataView(t.buffer,t.byteOffset,t.length),s=e.getUint32(0);if(s>Math.pow(2,21)-1){a.enqueue(Hl);break}i=s*Math.pow(2,32)+e.getUint32(4),r=3}else{if(rc(n)<i)break;let t=ic(n,i);a.enqueue(Ql(s?t:Zl.decode(t),e)),r=0}if(0===i||i>t){a.enqueue(Hl);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=t.readable.pipeThrough(e).getReader(),r=nc();r.readable.pipeTo(t.writable),this.writer=r.writable.getWriter();let i=()=>{n.read().then((t=>{let{done:e,value:n}=t;e||(this.onPacket(n),i())})).catch((t=>{}))};i();let s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this.writer.write(s).then((()=>this.onOpen()))}))})))}write(t){this.writable=!1;for(let e=0;e<t.length;e++){let n=t[e],r=e===t.length-1;this.writer.write(n).then((()=>{r&&Cc((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var t;null===(t=this.transport)||void 0===t||t.close()}},polling:class extends fc{constructor(t){if(super(t),this.polling=!1,typeof location<"u"){let e="https:"===location.protocol,n=location.port;n||(n=e?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||n!==t.port}let e=t&&t.forceBase64;this.supportsBinary=Ec&&!e,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";let e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((t,e)=>{let n=t.split("\x1e"),r=[];for(let i=0;i<n.length;i++){let t=Ql(n[i],e);if(r.push(t),"error"===t.type)break}return r})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){let t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{let n=t.length,r=new Array(n),i=0;t.forEach(((t,s)=>{ql(t,!1,(t=>{r[s]=t,++i===n&&e(r.join("\x1e"))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let t=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=bc()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(t,e)}request(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(t,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Tc(this.uri(),t)}doWrite(t,e){let n=this.request({method:"POST",data:t});n.on("success",e),n.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){let t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}},Lc=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Nc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Oc(t){if(t.length>2e3)throw"URI too long";let e=t,n=t.indexOf("["),r=t.indexOf("]");-1!=n&&-1!=r&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let i=Lc.exec(t||""),s={},o=14;for(;o--;)s[Nc[o]]=i[o]||"";return-1!=n&&-1!=r&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(t,e){let n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return("/"==e.slice(0,1)||0===e.length)&&r.splice(0,1),"/"==e.slice(-1)&&r.splice(r.length-1,1),r}(0,s.path),s.queryKey=function(t,e){let n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,r){e&&(n[e]=r)})),n}(0,s.query),s}var kc=class t extends sc{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.binaryType="arraybuffer",this.writeBuffer=[],t&&"object"==typeof t&&(e=t,t=null),t?(t=Oc(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Oc(e.host).host),uc(this,e),this.secure=null!=e.secure?e.secure:typeof location<"u"&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=e.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(t){let e={},n=t.split("&");for(let r=0,i=n.length;r<i;r++){let t=n[r].split("=");e[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){let e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);let n=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new Rc[t](n)}open(){let e;if(this.opts.rememberUpgrade&&t.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch{return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(e){let n=this.createTransport(e),r=!1;t.priorWebsocketSuccess=!1;let i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",(e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;t.priorWebsocketSuccess="websocket"===n.name,this.transport.pause((()=>{r||"closed"!==this.readyState&&(u(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())}))}else{let t=new Error("probe error");t.transport=n.name,this.emitReserved("upgradeError",t)}})))};function s(){r||(r=!0,u(),n.close(),n=null)}let o=t=>{let e=new Error("probe error: "+t);e.transport=n.name,s(),this.emitReserved("upgradeError",e)};function a(){o("transport closed")}function l(){o("socket closed")}function c(t){n&&t.name!==n.name&&s()}let u=()=>{n.removeListener("open",i),n.removeListener("error",o),n.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};n.once("open",i),n.once("error",o),n.once("close",a),this.once("close",l),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{r||n.open()}),200):n.open()}onOpen(){if(this.readyState="open",t.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0,e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let e=0;e<this.writeBuffer.length;e++){let n=this.writeBuffer[e].data;if(n&&(t+=hc(n)),e>0&&t>this.maxPayload)return this.writeBuffer.slice(0,e);t+=2}return this.writeBuffer}write(t,e,n){return this.sendPacket("message",t,e,n),this}send(t,e,n){return this.sendPacket("message",t,e,n),this}sendPacket(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;let i={type:t,data:e,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}close(){let t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},n=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():t()})):this.upgrading?n():t()),this}onError(e){t.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(t,e){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){let e=[],n=0,r=t.length;for(;n<r;n++)~this.transports.indexOf(t[n])&&e.push(t[n]);return e}};kc.protocol=4;var Dc={};((t,e)=>{for(var n in e)Ua(t,n,{get:e[n],enumerable:!0})})(Dc,{Decoder:()=>Kc,Encoder:()=>Yc,PacketType:()=>$c,protocol:()=>Jc});var zc="function"==typeof ArrayBuffer,Uc=Object.prototype.toString,Fc="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Uc.call(Blob),Bc="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===Uc.call(File);function Vc(t){return zc&&(t instanceof ArrayBuffer||(t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||Fc&&t instanceof Blob||Bc&&t instanceof File}function Hc(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,n=t.length;e<n;e++)if(Hc(t[e]))return!0;return!1}if(Vc(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return Hc(t.toJSON(),!0);for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&Hc(t[n]))return!0;return!1}function jc(t){let e=[],n=t.data,r=t;return r.data=Wc(n,e),r.attachments=e.length,{packet:r,buffers:e}}function Wc(t,e){if(!t)return t;if(Vc(t)){let n={_placeholder:!0,num:e.length};return e.push(t),n}if(Array.isArray(t)){let n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=Wc(t[r],e);return n}if("object"==typeof t&&!(t instanceof Date)){let n={};for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=Wc(t[r],e));return n}return t}function Gc(t,e){return t.data=qc(t.data,e),delete t.attachments,t}function qc(t,e){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=qc(t[n],e);else if("object"==typeof t)for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=qc(t[n],e));return t}var $c,Xc=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Jc=5;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}($c||($c={}));var Yc=class{constructor(t){this.replacer=t}encode(t){return t.type!==$c.EVENT&&t.type!==$c.ACK||!Hc(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===$c.EVENT?$c.BINARY_EVENT:$c.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return(t.type===$c.BINARY_EVENT||t.type===$c.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){let e=jc(t),n=this.encodeAsString(e.packet),r=e.buffers;return r.unshift(n),r}};function Zc(t){return"[object Object]"===Object.prototype.toString.call(t)}var Kc=class t extends sc{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);let n=e.type===$c.BINARY_EVENT;n||e.type===$c.BINARY_ACK?(e.type=n?$c.EVENT:$c.ACK,this.reconstructor=new Qc(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!Vc(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(e){let n=0,r={type:Number(e.charAt(0))};if(void 0===$c[r.type])throw new Error("unknown packet type "+r.type);if(r.type===$c.BINARY_EVENT||r.type===$c.BINARY_ACK){let t=n+1;for(;"-"!==e.charAt(++n)&&n!=e.length;);let i=e.substring(t,n);if(i!=Number(i)||"-"!==e.charAt(n))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(n+1)){let t=n+1;for(;++n&&","!==e.charAt(n)&&n!==e.length;);r.nsp=e.substring(t,n)}else r.nsp="/";let i=e.charAt(n+1);if(""!==i&&Number(i)==i){let t=n+1;for(;++n;){let t=e.charAt(n);if(null==t||Number(t)!=t){--n;break}if(n===e.length)break}r.id=Number(e.substring(t,n+1))}if(e.charAt(++n)){let i=this.tryParse(e.substr(n));if(!t.isPayloadValid(r.type,i))throw new Error("invalid payload");r.data=i}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,e){switch(t){case $c.CONNECT:return Zc(e);case $c.DISCONNECT:return void 0===e;case $c.CONNECT_ERROR:return"string"==typeof e||Zc(e);case $c.EVENT:case $c.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===Xc.indexOf(e[0]));case $c.ACK:case $c.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},Qc=class{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){let t=Gc(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function tu(t,e,n){return t.on(e,n),function(){t.off(e,n)}}var eu=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),nu=class extends sc{constructor(t,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let t=this.io;this.subs=[tu(t,"open",this.onopen.bind(this)),tu(t,"packet",this.onpacket.bind(this)),tu(t,"error",this.onerror.bind(this)),tu(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.unshift("message"),this.emit.apply(this,e),this}emit(t){if(eu.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;let i={type:$c.EVENT,data:n,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]){let t=this.ids++,e=n.pop();this._registerAckCallback(t,e),i.id=t}let s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(t,e){var n,r=this;let i=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===i)return void(this.acks[t]=e);let s=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),i),o=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];r.io.clearTimeoutFn(s),e.apply(r,n)};o.withError=!0,this.acks[t]=o}emitWithAck(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new Promise(((e,r)=>{let i=(t,n)=>t?r(t):e(n);i.withError=!0,n.push(i),this.emit(t,...n)}))}_addToQueue(t){var e=this;let n;"function"==typeof t[t.length-1]&&(n=t.pop());let r={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((function(t){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return r!==e._queue[0]?void 0:(null!==t?r.tryCount>e._opts.retries&&(e._queue.shift(),n&&n(t)):(e._queue.shift(),n&&n(null,...s)),r.pending=!1,e._drainQueue())})),this._queue.push(r),this._drainQueue()}_drainQueue(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||0===this._queue.length)return;let e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:$c.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((t=>{if(!this.sendBuffer.some((e=>String(e.id)===t))){let e=this.acks[t];delete this.acks[t],e.withError&&e.call(this,new Error("socket has been disconnected"))}}))}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case $c.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case $c.EVENT:case $c.BINARY_EVENT:this.onevent(t);break;case $c.ACK:case $c.BINARY_ACK:this.onack(t);break;case $c.DISCONNECT:this.ondisconnect();break;case $c.CONNECT_ERROR:this.destroy();let e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){let e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){let e=this._anyListeners.slice();for(let n of e)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){let e=this,n=!1;return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];n||(n=!0,e.packet({type:$c.ACK,id:t,data:i}))}}onack(t){let e=this.acks[t.id];"function"==typeof e&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:$c.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){let e=this._anyListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){let e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let e=this._anyOutgoingListeners.slice();for(let n of e)n.apply(this,t.data)}}};function ru(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}ru.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=1&Math.floor(10*e)?t+n:t-n}return 0|Math.min(t,this.max)},ru.prototype.reset=function(){this.attempts=0},ru.prototype.setMin=function(t){this.ms=t},ru.prototype.setMax=function(t){this.max=t},ru.prototype.setJitter=function(t){this.jitter=t};var iu,su,ou=class extends sc{constructor(t,e){var n;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,uc(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=e.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new ru({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;let r=e.parser||Dc;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new kc(this.uri,this.opts);let e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;let r=tu(e,"open",(function(){n.onopen(),t&&t()})),i=e=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",e),t?t(e):this.maybeReconnectOnOpen()},s=tu(e,"error",i);if(!1!==this._timeout){let t=this._timeout,n=this.setTimeoutFn((()=>{r(),i(new Error("timeout")),e.close()}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(r),this.subs.push(s),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let t=this.engine;this.subs.push(tu(t,"ping",this.onping.bind(this)),tu(t,"data",this.ondata.bind(this)),tu(t,"error",this.onerror.bind(this)),tu(t,"close",this.onclose.bind(this)),tu(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){Cc((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new nu(this,t,e),this.nsps[t]=n),n}_destroy(t){let e=Object.keys(this.nsps);for(let n of e)if(this.nsps[n].active)return;this._close()}_packet(t){let e=this.encoder.encode(t);for(let n=0;n<e.length;n++)this.engine.write(e[n],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let e=this.backoff.duration();this._reconnecting=!0;let n=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){let t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}},au={};function lu(t,e){"object"==typeof t&&(e=t,t=void 0);let n,r=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=t;n=n||typeof location<"u"&&location,null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(t=typeof n<"u"?n.protocol+"//"+t:"https://"+t),r=Oc(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";let i=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(n&&n.port===r.port?"":":"+r.port),r}(t,(e=e||{}).path||"/socket.io"),i=r.source,s=r.id,o=r.path,a=au[s]&&o in au[s].nsps;return e.forceNew||e["force new connection"]||!1===e.multiplex||a?n=new ou(i,e):(au[s]||(au[s]=new ou(i,e)),n=au[s]),r.query&&!e.query&&(e.query=r.queryKey),n.socket(r.path,e)}Object.assign(lu,{Manager:ou,Socket:nu,io:lu,connect:lu}),function(t){t.assertEqual=t=>t,t.assertIs=function(t){},t.assertNever=function(t){throw new Error},t.arrayToEnum=t=>{let e={};for(let n of t)e[n]=n;return e},t.getValidEnumValues=e=>{let n=t.objectKeys(e).filter((t=>"number"!=typeof e[e[t]])),r={};for(let t of n)r[t]=e[t];return t.objectValues(r)},t.objectValues=e=>t.objectKeys(e).map((function(t){return e[t]})),t.objectKeys="function"==typeof Object.keys?t=>Object.keys(t):t=>{let e=[];for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},t.find=(t,e)=>{for(let n of t)if(e(n))return n},t.isInteger="function"==typeof Number.isInteger?t=>Number.isInteger(t):t=>"number"==typeof t&&isFinite(t)&&Math.floor(t)===t,t.joinValues=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" | ";return t.map((t=>"string"==typeof t?`'${t}'`:t)).join(e)},t.jsonStringifyReplacer=(t,e)=>"bigint"==typeof e?e.toString():e}(iu||(iu={})),function(t){t.mergeShapes=(t,e)=>Xa(Xa({},t),e)}(su||(su={}));var cu=iu.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),uu=t=>{switch(typeof t){case"undefined":return cu.undefined;case"string":return cu.string;case"number":return isNaN(t)?cu.nan:cu.number;case"boolean":return cu.boolean;case"function":return cu.function;case"bigint":return cu.bigint;case"symbol":return cu.symbol;case"object":return Array.isArray(t)?cu.array:null===t?cu.null:t.then&&"function"==typeof t.then&&t.catch&&"function"==typeof t.catch?cu.promise:typeof Map<"u"&&t instanceof Map?cu.map:typeof Set<"u"&&t instanceof Set?cu.set:typeof Date<"u"&&t instanceof Date?cu.date:cu.object;default:return cu.unknown}},hu=iu.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),du=class t extends Error{constructor(t){var e;super(),e=this,this.issues=[],this.addIssue=t=>{this.issues=[...this.issues,t]},this.addIssues=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.issues=[...e.issues,...t]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){let e=t||function(t){return t.message},n={_errors:[]},r=t=>{for(let i of t.issues)if("invalid_union"===i.code)i.unionErrors.map(r);else if("invalid_return_type"===i.code)r(i.returnTypeError);else if("invalid_arguments"===i.code)r(i.argumentsError);else if(0===i.path.length)n._errors.push(e(i));else{let t=n,r=0;for(;r<i.path.length;){let n=i.path[r];r===i.path.length-1?(t[n]=t[n]||{_errors:[]},t[n]._errors.push(e(i))):t[n]=t[n]||{_errors:[]},t=t[n],r++}}};return r(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,iu.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t=>t.message,e={},n=[];for(let r of this.issues)r.path.length>0?(e[r.path[0]]=e[r.path[0]]||[],e[r.path[0]].push(t(r))):n.push(t(r));return{formErrors:n,fieldErrors:e}}get formErrors(){return this.flatten()}};du.create=t=>new du(t);var pu=(t,e)=>{let n;switch(t.code){case hu.invalid_type:n=t.received===cu.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case hu.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,iu.jsonStringifyReplacer)}`;break;case hu.unrecognized_keys:n=`Unrecognized key(s) in object: ${iu.joinValues(t.keys,", ")}`;break;case hu.invalid_union:n="Invalid input";break;case hu.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${iu.joinValues(t.options)}`;break;case hu.invalid_enum_value:n=`Invalid enum value. Expected ${iu.joinValues(t.options)}, received '${t.received}'`;break;case hu.invalid_arguments:n="Invalid function arguments";break;case hu.invalid_return_type:n="Invalid function return type";break;case hu.invalid_date:n="Invalid date";break;case hu.invalid_string:"object"==typeof t.validation?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,"number"==typeof t.validation.position&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:iu.assertNever(t.validation):n="regex"!==t.validation?`Invalid ${t.validation}`:"Invalid";break;case hu.too_small:n="array"===t.type?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:"string"===t.type?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:"number"===t.type?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:"date"===t.type?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case hu.too_big:n="array"===t.type?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:"string"===t.type?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:"number"===t.type?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:"bigint"===t.type?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:"date"===t.type?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case hu.custom:n="Invalid input";break;case hu.invalid_intersection_types:n="Intersection results could not be merged";break;case hu.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case hu.not_finite:n="Number must be finite";break;default:n=e.defaultError,iu.assertNever(t)}return{message:n}},fu=pu;function mu(){return fu}var gu=t=>{let{data:e,path:n,errorMaps:r,issueData:i}=t,s=[...n,...i.path||[]],o=Ja(Xa({},i),{path:s});if(void 0!==i.message)return Ja(Xa({},i),{path:s,message:i.message});let a="",l=r.filter((t=>!!t)).slice().reverse();for(let c of l)a=c(o,{data:e,defaultError:a}).message;return Ja(Xa({},i),{path:s,message:a})};function vu(t,e){let n=mu(),r=gu({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===pu?void 0:pu].filter((t=>!!t))});t.common.issues.push(r)}var yu,_u=class t{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(t,e){let n=[];for(let r of e){if("aborted"===r.status)return bu;"dirty"===r.status&&t.dirty(),n.push(r.value)}return{status:t.value,value:n}}static mergeObjectAsync(e,n){return Za(this,null,(function*(){let r=[];for(let t of n){let e=yield t.key,n=yield t.value;r.push({key:e,value:n})}return t.mergeObjectSync(e,r)}))}static mergeObjectSync(t,e){let n={};for(let r of e){let{key:e,value:i}=r;if("aborted"===e.status||"aborted"===i.status)return bu;"dirty"===e.status&&t.dirty(),"dirty"===i.status&&t.dirty(),"__proto__"!==e.value&&(typeof i.value<"u"||r.alwaysSet)&&(n[e.value]=i.value)}return{status:t.value,value:n}}},bu=Object.freeze({status:"aborted"}),xu=t=>({status:"dirty",value:t}),wu=t=>({status:"valid",value:t}),Su=t=>"aborted"===t.status,Mu=t=>"dirty"===t.status,Eu=t=>"valid"===t.status,Tu=t=>typeof Promise<"u"&&t instanceof Promise;function Au(t,e,n,r){if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function Cu(t,e,n,r,i){if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}!function(t){t.errToObj=t=>"string"==typeof t?{message:t}:t||{},t.toString=t=>"string"==typeof t?t:null==t?void 0:t.message}(yu||(yu={}));var Pu,Iu,Ru=class{constructor(t,e,n,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=n,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Lu=(t,e)=>{if(Eu(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let e=new du(t.common.issues);return this._error=e,this._error}}};function Nu(t){if(!t)return{};let{errorMap:e,invalid_type_error:n,required_error:r,description:i}=t;if(e&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return e?{errorMap:e,description:i}:{errorMap:(e,i)=>{var s,o;let{message:a}=t;return"invalid_enum_value"===e.code?{message:a??i.defaultError}:typeof i.data>"u"?{message:null!==(s=a??r)&&void 0!==s?s:i.defaultError}:"invalid_type"!==e.code?{message:i.defaultError}:{message:null!==(o=a??n)&&void 0!==o?o:i.defaultError}},description:i}}var Ou,ku=class{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return uu(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:uu(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new _u,ctx:{common:t.parent.common,data:t.data,parsedType:uu(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let e=this._parse(t);if(Tu(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(t){let e=this._parse(t);return Promise.resolve(e)}parse(t,e){let n=this.safeParse(t,e);if(n.success)return n.data;throw n.error}safeParse(t,e){var n;let r={common:{issues:[],async:null!==(n=null==e?void 0:e.async)&&void 0!==n&&n,contextualErrorMap:null==e?void 0:e.errorMap},path:(null==e?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:uu(t)},i=this._parseSync({data:t,path:r.path,parent:r});return Lu(r,i)}parseAsync(t,e){return Za(this,null,(function*(){let n=yield this.safeParseAsync(t,e);if(n.success)return n.data;throw n.error}))}safeParseAsync(t,e){return Za(this,null,(function*(){let n={common:{issues:[],contextualErrorMap:null==e?void 0:e.errorMap,async:!0},path:(null==e?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:uu(t)},r=this._parse({data:t,path:n.path,parent:n}),i=yield Tu(r)?r:Promise.resolve(r);return Lu(n,i)}))}refine(t,e){return this._refinement(((n,r)=>{let i=t(n),s=()=>r.addIssue(Xa({code:hu.custom},(t=>"string"==typeof e||typeof e>"u"?{message:e}:"function"==typeof e?e(t):e)(n)));return typeof Promise<"u"&&i instanceof Promise?i.then((t=>!!t||(s(),!1))):!!i||(s(),!1)}))}refinement(t,e){return this._refinement(((n,r)=>!!t(n)||(r.addIssue("function"==typeof e?e(n,r):e),!1)))}_refinement(t){return new Ih({schema:this,typeName:Vh.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return Rh.create(this,this._def)}nullable(){return Lh.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return hh.create(this,this._def)}promise(){return Ph.create(this,this._def)}or(t){return fh.create([this,t],this._def)}and(t){return yh.create(this,t,this._def)}transform(t){return new Ih(Ja(Xa({},Nu(this._def)),{schema:this,typeName:Vh.ZodEffects,effect:{type:"transform",transform:t}}))}default(t){let e="function"==typeof t?t:()=>t;return new Nh(Ja(Xa({},Nu(this._def)),{innerType:this,defaultValue:e,typeName:Vh.ZodDefault}))}brand(){return new zh(Xa({typeName:Vh.ZodBranded,type:this},Nu(this._def)))}catch(t){let e="function"==typeof t?t:()=>t;return new Oh(Ja(Xa({},Nu(this._def)),{innerType:this,catchValue:e,typeName:Vh.ZodCatch}))}describe(t){return new(0,this.constructor)(Ja(Xa({},this._def),{description:t}))}pipe(t){return Uh.create(this,t)}readonly(){return Fh.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Du=/^c[^\s-]{8,}$/i,zu=/^[0-9a-z]+$/,Uu=/^[0-9A-HJKMNP-TV-Z]{26}$/,Fu=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Bu=/^[a-z0-9_-]{21}$/i,Vu=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Hu=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ju=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Wu=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Gu=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,qu="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",$u=new RegExp(`^${qu}$`);function Xu(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:null==t.precision&&(e=`${e}(\\.\\d+)?`),e}function Ju(t){return new RegExp(`^${Xu(t)}$`)}function Yu(t){let e=`${qu}T${Xu(t)}`,n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function Zu(t,e){return!(("v4"!==e&&e||!ju.test(t))&&("v6"!==e&&e||!Wu.test(t)))}var Ku=class t extends ku{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==cu.string){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.string,received:e.parsedType}),bu}let e,n=new _u;for(let r of this._def.checks)if("min"===r.kind)t.data.length<r.value&&(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),n.dirty());else if("max"===r.kind)t.data.length>r.value&&(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),n.dirty());else if("length"===r.kind){let i=t.data.length>r.value,s=t.data.length<r.value;(i||s)&&(e=this._getOrReturnCtx(t,e),i?vu(e,{code:hu.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):s&&vu(e,{code:hu.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),n.dirty())}else if("email"===r.kind)Hu.test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{validation:"email",code:hu.invalid_string,message:r.message}),n.dirty());else if("emoji"===r.kind)Ou||(Ou=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ou.test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{validation:"emoji",code:hu.invalid_string,message:r.message}),n.dirty());else if("uuid"===r.kind)Fu.test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{validation:"uuid",code:hu.invalid_string,message:r.message}),n.dirty());else if("nanoid"===r.kind)Bu.test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{validation:"nanoid",code:hu.invalid_string,message:r.message}),n.dirty());else if("cuid"===r.kind)Du.test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{validation:"cuid",code:hu.invalid_string,message:r.message}),n.dirty());else if("cuid2"===r.kind)zu.test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{validation:"cuid2",code:hu.invalid_string,message:r.message}),n.dirty());else if("ulid"===r.kind)Uu.test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{validation:"ulid",code:hu.invalid_string,message:r.message}),n.dirty());else if("url"===r.kind)try{new URL(t.data)}catch{e=this._getOrReturnCtx(t,e),vu(e,{validation:"url",code:hu.invalid_string,message:r.message}),n.dirty()}else"regex"===r.kind?(r.regex.lastIndex=0,r.regex.test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{validation:"regex",code:hu.invalid_string,message:r.message}),n.dirty())):"trim"===r.kind?t.data=t.data.trim():"includes"===r.kind?t.data.includes(r.value,r.position)||(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),n.dirty()):"toLowerCase"===r.kind?t.data=t.data.toLowerCase():"toUpperCase"===r.kind?t.data=t.data.toUpperCase():"startsWith"===r.kind?t.data.startsWith(r.value)||(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.invalid_string,validation:{startsWith:r.value},message:r.message}),n.dirty()):"endsWith"===r.kind?t.data.endsWith(r.value)||(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.invalid_string,validation:{endsWith:r.value},message:r.message}),n.dirty()):"datetime"===r.kind?Yu(r).test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.invalid_string,validation:"datetime",message:r.message}),n.dirty()):"date"===r.kind?$u.test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.invalid_string,validation:"date",message:r.message}),n.dirty()):"time"===r.kind?Ju(r).test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.invalid_string,validation:"time",message:r.message}),n.dirty()):"duration"===r.kind?Vu.test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{validation:"duration",code:hu.invalid_string,message:r.message}),n.dirty()):"ip"===r.kind?Zu(t.data,r.version)||(e=this._getOrReturnCtx(t,e),vu(e,{validation:"ip",code:hu.invalid_string,message:r.message}),n.dirty()):"base64"===r.kind?Gu.test(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{validation:"base64",code:hu.invalid_string,message:r.message}),n.dirty()):iu.assertNever(r);return{status:n.value,value:t.data}}_regex(t,e,n){return this.refinement((e=>t.test(e)),Xa({validation:e,code:hu.invalid_string},yu.errToObj(n)))}_addCheck(e){return new t(Ja(Xa({},this._def),{checks:[...this._def.checks,e]}))}email(t){return this._addCheck(Xa({kind:"email"},yu.errToObj(t)))}url(t){return this._addCheck(Xa({kind:"url"},yu.errToObj(t)))}emoji(t){return this._addCheck(Xa({kind:"emoji"},yu.errToObj(t)))}uuid(t){return this._addCheck(Xa({kind:"uuid"},yu.errToObj(t)))}nanoid(t){return this._addCheck(Xa({kind:"nanoid"},yu.errToObj(t)))}cuid(t){return this._addCheck(Xa({kind:"cuid"},yu.errToObj(t)))}cuid2(t){return this._addCheck(Xa({kind:"cuid2"},yu.errToObj(t)))}ulid(t){return this._addCheck(Xa({kind:"ulid"},yu.errToObj(t)))}base64(t){return this._addCheck(Xa({kind:"base64"},yu.errToObj(t)))}ip(t){return this._addCheck(Xa({kind:"ip"},yu.errToObj(t)))}datetime(t){var e,n;return"string"==typeof t?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck(Xa({kind:"datetime",precision:typeof(null==t?void 0:t.precision)>"u"?null:null==t?void 0:t.precision,offset:null!==(e=null==t?void 0:t.offset)&&void 0!==e&&e,local:null!==(n=null==t?void 0:t.local)&&void 0!==n&&n},yu.errToObj(null==t?void 0:t.message)))}date(t){return this._addCheck({kind:"date",message:t})}time(t){return"string"==typeof t?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck(Xa({kind:"time",precision:typeof(null==t?void 0:t.precision)>"u"?null:null==t?void 0:t.precision},yu.errToObj(null==t?void 0:t.message)))}duration(t){return this._addCheck(Xa({kind:"duration"},yu.errToObj(t)))}regex(t,e){return this._addCheck(Xa({kind:"regex",regex:t},yu.errToObj(e)))}includes(t,e){return this._addCheck(Xa({kind:"includes",value:t,position:null==e?void 0:e.position},yu.errToObj(null==e?void 0:e.message)))}startsWith(t,e){return this._addCheck(Xa({kind:"startsWith",value:t},yu.errToObj(e)))}endsWith(t,e){return this._addCheck(Xa({kind:"endsWith",value:t},yu.errToObj(e)))}min(t,e){return this._addCheck(Xa({kind:"min",value:t},yu.errToObj(e)))}max(t,e){return this._addCheck(Xa({kind:"max",value:t},yu.errToObj(e)))}length(t,e){return this._addCheck(Xa({kind:"length",value:t},yu.errToObj(e)))}nonempty(t){return this.min(1,yu.errToObj(t))}trim(){return new t(Ja(Xa({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new t(Ja(Xa({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new t(Ja(Xa({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find((t=>"datetime"===t.kind))}get isDate(){return!!this._def.checks.find((t=>"date"===t.kind))}get isTime(){return!!this._def.checks.find((t=>"time"===t.kind))}get isDuration(){return!!this._def.checks.find((t=>"duration"===t.kind))}get isEmail(){return!!this._def.checks.find((t=>"email"===t.kind))}get isURL(){return!!this._def.checks.find((t=>"url"===t.kind))}get isEmoji(){return!!this._def.checks.find((t=>"emoji"===t.kind))}get isUUID(){return!!this._def.checks.find((t=>"uuid"===t.kind))}get isNANOID(){return!!this._def.checks.find((t=>"nanoid"===t.kind))}get isCUID(){return!!this._def.checks.find((t=>"cuid"===t.kind))}get isCUID2(){return!!this._def.checks.find((t=>"cuid2"===t.kind))}get isULID(){return!!this._def.checks.find((t=>"ulid"===t.kind))}get isIP(){return!!this._def.checks.find((t=>"ip"===t.kind))}get isBase64(){return!!this._def.checks.find((t=>"base64"===t.kind))}get minLength(){let t=null;for(let e of this._def.checks)"min"===e.kind&&(null===t||e.value>t)&&(t=e.value);return t}get maxLength(){let t=null;for(let e of this._def.checks)"max"===e.kind&&(null===t||e.value<t)&&(t=e.value);return t}};function Qu(t,e){let n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=n>r?n:r;return parseInt(t.toFixed(i).replace(".",""))%parseInt(e.toFixed(i).replace(".",""))/Math.pow(10,i)}Ku.create=t=>{var e;return new Ku(Xa({checks:[],typeName:Vh.ZodString,coerce:null!==(e=null==t?void 0:t.coerce)&&void 0!==e&&e},Nu(t)))};var th=class t extends ku{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==cu.number){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.number,received:e.parsedType}),bu}let e,n=new _u;for(let r of this._def.checks)"int"===r.kind?iu.isInteger(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty()):"min"===r.kind?(r.inclusive?t.data<r.value:t.data<=r.value)&&(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?t.data>r.value:t.data>=r.value)&&(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"multipleOf"===r.kind?0!==Qu(t.data,r.value)&&(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(t.data)||(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.not_finite,message:r.message}),n.dirty()):iu.assertNever(r);return{status:n.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,yu.toString(e))}gt(t,e){return this.setLimit("min",t,!1,yu.toString(e))}lte(t,e){return this.setLimit("max",t,!0,yu.toString(e))}lt(t,e){return this.setLimit("max",t,!1,yu.toString(e))}setLimit(e,n,r,i){return new t(Ja(Xa({},this._def),{checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:yu.toString(i)}]}))}_addCheck(e){return new t(Ja(Xa({},this._def),{checks:[...this._def.checks,e]}))}int(t){return this._addCheck({kind:"int",message:yu.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:yu.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:yu.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:yu.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:yu.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:yu.toString(e)})}finite(t){return this._addCheck({kind:"finite",message:yu.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:yu.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:yu.toString(t)})}get minValue(){let t=null;for(let e of this._def.checks)"min"===e.kind&&(null===t||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(let e of this._def.checks)"max"===e.kind&&(null===t||e.value<t)&&(t=e.value);return t}get isInt(){return!!this._def.checks.find((t=>"int"===t.kind||"multipleOf"===t.kind&&iu.isInteger(t.value)))}get isFinite(){let t=null,e=null;for(let n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===e||n.value>e)&&(e=n.value):"max"===n.kind&&(null===t||n.value<t)&&(t=n.value)}return Number.isFinite(e)&&Number.isFinite(t)}};th.create=t=>new th(Xa({checks:[],typeName:Vh.ZodNumber,coerce:(null==t?void 0:t.coerce)||!1},Nu(t)));var eh=class t extends ku{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==cu.bigint){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.bigint,received:e.parsedType}),bu}let e,n=new _u;for(let r of this._def.checks)"min"===r.kind?(r.inclusive?t.data<r.value:t.data<=r.value)&&(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?t.data>r.value:t.data>=r.value)&&(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"multipleOf"===r.kind?t.data%r.value!==BigInt(0)&&(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):iu.assertNever(r);return{status:n.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,yu.toString(e))}gt(t,e){return this.setLimit("min",t,!1,yu.toString(e))}lte(t,e){return this.setLimit("max",t,!0,yu.toString(e))}lt(t,e){return this.setLimit("max",t,!1,yu.toString(e))}setLimit(e,n,r,i){return new t(Ja(Xa({},this._def),{checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:yu.toString(i)}]}))}_addCheck(e){return new t(Ja(Xa({},this._def),{checks:[...this._def.checks,e]}))}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:yu.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:yu.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:yu.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:yu.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:yu.toString(e)})}get minValue(){let t=null;for(let e of this._def.checks)"min"===e.kind&&(null===t||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(let e of this._def.checks)"max"===e.kind&&(null===t||e.value<t)&&(t=e.value);return t}};eh.create=t=>{var e;return new eh(Xa({checks:[],typeName:Vh.ZodBigInt,coerce:null!==(e=null==t?void 0:t.coerce)&&void 0!==e&&e},Nu(t)))};var nh=class extends ku{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==cu.boolean){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.boolean,received:e.parsedType}),bu}return wu(t.data)}};nh.create=t=>new nh(Xa({typeName:Vh.ZodBoolean,coerce:(null==t?void 0:t.coerce)||!1},Nu(t)));var rh=class t extends ku{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==cu.date){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.date,received:e.parsedType}),bu}if(isNaN(t.data.getTime())){return vu(this._getOrReturnCtx(t),{code:hu.invalid_date}),bu}let e,n=new _u;for(let r of this._def.checks)"min"===r.kind?t.data.getTime()<r.value&&(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),n.dirty()):"max"===r.kind?t.data.getTime()>r.value&&(e=this._getOrReturnCtx(t,e),vu(e,{code:hu.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),n.dirty()):iu.assertNever(r);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(e){return new t(Ja(Xa({},this._def),{checks:[...this._def.checks,e]}))}min(t,e){return this._addCheck({kind:"min",value:t.getTime(),message:yu.toString(e)})}max(t,e){return this._addCheck({kind:"max",value:t.getTime(),message:yu.toString(e)})}get minDate(){let t=null;for(let e of this._def.checks)"min"===e.kind&&(null===t||e.value>t)&&(t=e.value);return null!=t?new Date(t):null}get maxDate(){let t=null;for(let e of this._def.checks)"max"===e.kind&&(null===t||e.value<t)&&(t=e.value);return null!=t?new Date(t):null}};rh.create=t=>new rh(Xa({checks:[],coerce:(null==t?void 0:t.coerce)||!1,typeName:Vh.ZodDate},Nu(t)));var ih=class extends ku{_parse(t){if(this._getType(t)!==cu.symbol){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.symbol,received:e.parsedType}),bu}return wu(t.data)}};ih.create=t=>new ih(Xa({typeName:Vh.ZodSymbol},Nu(t)));var sh=class extends ku{_parse(t){if(this._getType(t)!==cu.undefined){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.undefined,received:e.parsedType}),bu}return wu(t.data)}};sh.create=t=>new sh(Xa({typeName:Vh.ZodUndefined},Nu(t)));var oh=class extends ku{_parse(t){if(this._getType(t)!==cu.null){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.null,received:e.parsedType}),bu}return wu(t.data)}};oh.create=t=>new oh(Xa({typeName:Vh.ZodNull},Nu(t)));var ah=class extends ku{constructor(){super(...arguments),this._any=!0}_parse(t){return wu(t.data)}};ah.create=t=>new ah(Xa({typeName:Vh.ZodAny},Nu(t)));var lh=class extends ku{constructor(){super(...arguments),this._unknown=!0}_parse(t){return wu(t.data)}};lh.create=t=>new lh(Xa({typeName:Vh.ZodUnknown},Nu(t)));var ch=class extends ku{_parse(t){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.never,received:e.parsedType}),bu}};ch.create=t=>new ch(Xa({typeName:Vh.ZodNever},Nu(t)));var uh=class extends ku{_parse(t){if(this._getType(t)!==cu.undefined){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.void,received:e.parsedType}),bu}return wu(t.data)}};uh.create=t=>new uh(Xa({typeName:Vh.ZodVoid},Nu(t)));var hh=class t extends ku{_parse(t){let{ctx:e,status:n}=this._processInputParams(t),r=this._def;if(e.parsedType!==cu.array)return vu(e,{code:hu.invalid_type,expected:cu.array,received:e.parsedType}),bu;if(null!==r.exactLength){let t=e.data.length>r.exactLength.value,i=e.data.length<r.exactLength.value;(t||i)&&(vu(e,{code:t?hu.too_big:hu.too_small,minimum:i?r.exactLength.value:void 0,maximum:t?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&e.data.length<r.minLength.value&&(vu(e,{code:hu.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&e.data.length>r.maxLength.value&&(vu(e,{code:hu.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),e.common.async)return Promise.all([...e.data].map(((t,n)=>r.type._parseAsync(new Ru(e,t,e.path,n))))).then((t=>_u.mergeArray(n,t)));let i=[...e.data].map(((t,n)=>r.type._parseSync(new Ru(e,t,e.path,n))));return _u.mergeArray(n,i)}get element(){return this._def.type}min(e,n){return new t(Ja(Xa({},this._def),{minLength:{value:e,message:yu.toString(n)}}))}max(e,n){return new t(Ja(Xa({},this._def),{maxLength:{value:e,message:yu.toString(n)}}))}length(e,n){return new t(Ja(Xa({},this._def),{exactLength:{value:e,message:yu.toString(n)}}))}nonempty(t){return this.min(1,t)}};function dh(t){if(t instanceof ph){let e={};for(let n in t.shape){let r=t.shape[n];e[n]=Rh.create(dh(r))}return new ph(Ja(Xa({},t._def),{shape:()=>e}))}return t instanceof hh?new hh(Ja(Xa({},t._def),{type:dh(t.element)})):t instanceof Rh?Rh.create(dh(t.unwrap())):t instanceof Lh?Lh.create(dh(t.unwrap())):t instanceof _h?_h.create(t.items.map((t=>dh(t)))):t}hh.create=(t,e)=>new hh(Xa({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Vh.ZodArray},Nu(e)));var ph=class t extends ku{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let t=this._def.shape(),e=iu.objectKeys(t);return this._cached={shape:t,keys:e}}_parse(t){if(this._getType(t)!==cu.object){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.object,received:e.parsedType}),bu}let{status:e,ctx:n}=this._processInputParams(t),{shape:r,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof ch&&"strip"===this._def.unknownKeys))for(let a in n.data)i.includes(a)||s.push(a);let o=[];for(let a of i){let t=r[a],e=n.data[a];o.push({key:{status:"valid",value:a},value:t._parse(new Ru(n,e,n.path,a)),alwaysSet:a in n.data})}if(this._def.catchall instanceof ch){let t=this._def.unknownKeys;if("passthrough"===t)for(let e of s)o.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===t)s.length>0&&(vu(n,{code:hu.unrecognized_keys,keys:s}),e.dirty());else if("strip"!==t)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let t=this._def.catchall;for(let e of s){let r=n.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new Ru(n,r,n.path,e)),alwaysSet:e in n.data})}}return n.common.async?Promise.resolve().then((()=>Za(this,null,(function*(){let t=[];for(let e of o){let n=yield e.key,r=yield e.value;t.push({key:n,value:r,alwaysSet:e.alwaysSet})}return t})))).then((t=>_u.mergeObjectSync(e,t))):_u.mergeObjectSync(e,o)}get shape(){return this._def.shape()}strict(e){return yu.errToObj,new t(Xa(Ja(Xa({},this._def),{unknownKeys:"strict"}),void 0!==e?{errorMap:(t,n)=>{var r,i,s,o;let a=null!==(s=null===(i=(r=this._def).errorMap)||void 0===i?void 0:i.call(r,t,n).message)&&void 0!==s?s:n.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=yu.errToObj(e).message)&&void 0!==o?o:a}:{message:a}}}:{}))}strip(){return new t(Ja(Xa({},this._def),{unknownKeys:"strip"}))}passthrough(){return new t(Ja(Xa({},this._def),{unknownKeys:"passthrough"}))}extend(e){return new t(Ja(Xa({},this._def),{shape:()=>Xa(Xa({},this._def.shape()),e)}))}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>Xa(Xa({},this._def.shape()),e._def.shape()),typeName:Vh.ZodObject})}setKey(t,e){return this.augment({[t]:e})}catchall(e){return new t(Ja(Xa({},this._def),{catchall:e}))}pick(e){let n={};return iu.objectKeys(e).forEach((t=>{e[t]&&this.shape[t]&&(n[t]=this.shape[t])})),new t(Ja(Xa({},this._def),{shape:()=>n}))}omit(e){let n={};return iu.objectKeys(this.shape).forEach((t=>{e[t]||(n[t]=this.shape[t])})),new t(Ja(Xa({},this._def),{shape:()=>n}))}deepPartial(){return dh(this)}partial(e){let n={};return iu.objectKeys(this.shape).forEach((t=>{let r=this.shape[t];e&&!e[t]?n[t]=r:n[t]=r.optional()})),new t(Ja(Xa({},this._def),{shape:()=>n}))}required(e){let n={};return iu.objectKeys(this.shape).forEach((t=>{if(e&&!e[t])n[t]=this.shape[t];else{let e=this.shape[t];for(;e instanceof Rh;)e=e._def.innerType;n[t]=e}})),new t(Ja(Xa({},this._def),{shape:()=>n}))}keyof(){return Th(iu.objectKeys(this.shape))}};ph.create=(t,e)=>new ph(Xa({shape:()=>t,unknownKeys:"strip",catchall:ch.create(),typeName:Vh.ZodObject},Nu(e))),ph.strictCreate=(t,e)=>new ph(Xa({shape:()=>t,unknownKeys:"strict",catchall:ch.create(),typeName:Vh.ZodObject},Nu(e))),ph.lazycreate=(t,e)=>new ph(Xa({shape:t,unknownKeys:"strip",catchall:ch.create(),typeName:Vh.ZodObject},Nu(e)));var fh=class extends ku{_parse(t){let{ctx:e}=this._processInputParams(t),n=this._def.options;if(e.common.async)return Promise.all(n.map((t=>Za(this,null,(function*(){let n=Ja(Xa({},e),{common:Ja(Xa({},e.common),{issues:[]}),parent:null});return{result:yield t._parseAsync({data:e.data,path:e.path,parent:n}),ctx:n}}))))).then((function(t){for(let e of t)if("valid"===e.result.status)return e.result;for(let r of t)if("dirty"===r.result.status)return e.common.issues.push(...r.ctx.common.issues),r.result;let n=t.map((t=>new du(t.ctx.common.issues)));return vu(e,{code:hu.invalid_union,unionErrors:n}),bu}));{let t,r=[];for(let s of n){let n=Ja(Xa({},e),{common:Ja(Xa({},e.common),{issues:[]}),parent:null}),i=s._parseSync({data:e.data,path:e.path,parent:n});if("valid"===i.status)return i;"dirty"===i.status&&!t&&(t={result:i,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(t)return e.common.issues.push(...t.ctx.common.issues),t.result;let i=r.map((t=>new du(t)));return vu(e,{code:hu.invalid_union,unionErrors:i}),bu}}get options(){return this._def.options}};fh.create=(t,e)=>new fh(Xa({options:t,typeName:Vh.ZodUnion},Nu(e)));var mh=t=>t instanceof Mh?mh(t.schema):t instanceof Ih?mh(t.innerType()):t instanceof Eh?[t.value]:t instanceof Ah?t.options:t instanceof Ch?iu.objectValues(t.enum):t instanceof Nh?mh(t._def.innerType):t instanceof sh?[void 0]:t instanceof oh?[null]:t instanceof Rh?[void 0,...mh(t.unwrap())]:t instanceof Lh?[null,...mh(t.unwrap())]:t instanceof zh||t instanceof Fh?mh(t.unwrap()):t instanceof Oh?mh(t._def.innerType):[],gh=class t extends ku{_parse(t){let{ctx:e}=this._processInputParams(t);if(e.parsedType!==cu.object)return vu(e,{code:hu.invalid_type,expected:cu.object,received:e.parsedType}),bu;let n=this.discriminator,r=e.data[n],i=this.optionsMap.get(r);return i?e.common.async?i._parseAsync({data:e.data,path:e.path,parent:e}):i._parseSync({data:e.data,path:e.path,parent:e}):(vu(e,{code:hu.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),bu)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){let i=new Map;for(let t of n){let n=mh(t.shape[e]);if(!n.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let r of n){if(i.has(r))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(r)}`);i.set(r,t)}}return new t(Xa({typeName:Vh.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:i},Nu(r)))}};function vh(t,e){let n=uu(t),r=uu(e);if(t===e)return{valid:!0,data:t};if(n===cu.object&&r===cu.object){let n=iu.objectKeys(e),r=iu.objectKeys(t).filter((t=>-1!==n.indexOf(t))),i=Xa(Xa({},t),e);for(let s of r){let n=vh(t[s],e[s]);if(!n.valid)return{valid:!1};i[s]=n.data}return{valid:!0,data:i}}if(n===cu.array&&r===cu.array){if(t.length!==e.length)return{valid:!1};let n=[];for(let r=0;r<t.length;r++){let i=vh(t[r],e[r]);if(!i.valid)return{valid:!1};n.push(i.data)}return{valid:!0,data:n}}return n===cu.date&&r===cu.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var yh=class extends ku{_parse(t){let{status:e,ctx:n}=this._processInputParams(t),r=(t,r)=>{if(Su(t)||Su(r))return bu;let i=vh(t.value,r.value);return i.valid?((Mu(t)||Mu(r))&&e.dirty(),{status:e.value,value:i.data}):(vu(n,{code:hu.invalid_intersection_types}),bu)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then((t=>{let[e,n]=t;return r(e,n)})):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};yh.create=(t,e,n)=>new yh(Xa({left:t,right:e,typeName:Vh.ZodIntersection},Nu(n)));var _h=class t extends ku{_parse(t){let{status:e,ctx:n}=this._processInputParams(t);if(n.parsedType!==cu.array)return vu(n,{code:hu.invalid_type,expected:cu.array,received:n.parsedType}),bu;if(n.data.length<this._def.items.length)return vu(n,{code:hu.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),bu;!this._def.rest&&n.data.length>this._def.items.length&&(vu(n,{code:hu.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e.dirty());let r=[...n.data].map(((t,e)=>{let r=this._def.items[e]||this._def.rest;return r?r._parse(new Ru(n,t,n.path,e)):null})).filter((t=>!!t));return n.common.async?Promise.all(r).then((t=>_u.mergeArray(e,t))):_u.mergeArray(e,r)}get items(){return this._def.items}rest(e){return new t(Ja(Xa({},this._def),{rest:e}))}};_h.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new _h(Xa({items:t,typeName:Vh.ZodTuple,rest:null},Nu(e)))};var bh=class t extends ku{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:n}=this._processInputParams(t);if(n.parsedType!==cu.object)return vu(n,{code:hu.invalid_type,expected:cu.object,received:n.parsedType}),bu;let r=[],i=this._def.keyType,s=this._def.valueType;for(let o in n.data)r.push({key:i._parse(new Ru(n,o,n.path,o)),value:s._parse(new Ru(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?_u.mergeObjectAsync(e,r):_u.mergeObjectSync(e,r)}get element(){return this._def.valueType}static create(e,n,r){return new t(n instanceof ku?Xa({keyType:e,valueType:n,typeName:Vh.ZodRecord},Nu(r)):Xa({keyType:Ku.create(),valueType:e,typeName:Vh.ZodRecord},Nu(n)))}},xh=class extends ku{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:n}=this._processInputParams(t);if(n.parsedType!==cu.map)return vu(n,{code:hu.invalid_type,expected:cu.map,received:n.parsedType}),bu;let r=this._def.keyType,i=this._def.valueType,s=[...n.data.entries()].map(((t,e)=>{let[s,o]=t;return{key:r._parse(new Ru(n,s,n.path,[e,"key"])),value:i._parse(new Ru(n,o,n.path,[e,"value"]))}}));if(n.common.async){let t=new Map;return Promise.resolve().then((()=>Za(this,null,(function*(){for(let n of s){let r=yield n.key,i=yield n.value;if("aborted"===r.status||"aborted"===i.status)return bu;("dirty"===r.status||"dirty"===i.status)&&e.dirty(),t.set(r.value,i.value)}return{status:e.value,value:t}}))))}{let t=new Map;for(let n of s){let r=n.key,i=n.value;if("aborted"===r.status||"aborted"===i.status)return bu;("dirty"===r.status||"dirty"===i.status)&&e.dirty(),t.set(r.value,i.value)}return{status:e.value,value:t}}}};xh.create=(t,e,n)=>new xh(Xa({valueType:e,keyType:t,typeName:Vh.ZodMap},Nu(n)));var wh=class t extends ku{_parse(t){let{status:e,ctx:n}=this._processInputParams(t);if(n.parsedType!==cu.set)return vu(n,{code:hu.invalid_type,expected:cu.set,received:n.parsedType}),bu;let r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(vu(n,{code:hu.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),e.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(vu(n,{code:hu.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),e.dirty());let i=this._def.valueType;function s(t){let n=new Set;for(let r of t){if("aborted"===r.status)return bu;"dirty"===r.status&&e.dirty(),n.add(r.value)}return{status:e.value,value:n}}let o=[...n.data.values()].map(((t,e)=>i._parse(new Ru(n,t,n.path,e))));return n.common.async?Promise.all(o).then((t=>s(t))):s(o)}min(e,n){return new t(Ja(Xa({},this._def),{minSize:{value:e,message:yu.toString(n)}}))}max(e,n){return new t(Ja(Xa({},this._def),{maxSize:{value:e,message:yu.toString(n)}}))}size(t,e){return this.min(t,e).max(t,e)}nonempty(t){return this.min(1,t)}};wh.create=(t,e)=>new wh(Xa({valueType:t,minSize:null,maxSize:null,typeName:Vh.ZodSet},Nu(e)));var Sh=class t extends ku{constructor(){super(...arguments),this.validate=this.implement}_parse(t){let{ctx:e}=this._processInputParams(t);if(e.parsedType!==cu.function)return vu(e,{code:hu.invalid_type,expected:cu.function,received:e.parsedType}),bu;function n(t,n){return gu({data:t,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,mu(),pu].filter((t=>!!t)),issueData:{code:hu.invalid_arguments,argumentsError:n}})}function r(t,n){return gu({data:t,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,mu(),pu].filter((t=>!!t)),issueData:{code:hu.invalid_return_type,returnTypeError:n}})}let i={errorMap:e.common.contextualErrorMap},s=e.data;if(this._def.returns instanceof Ph){let t=this;return wu((function(){for(var e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return Za(this,null,(function*(){let e=new du([]),a=yield t._def.args.parseAsync(o,i).catch((t=>{throw e.addIssue(n(o,t)),e})),l=yield Reflect.apply(s,this,a);return yield t._def.returns._def.type.parseAsync(l,i).catch((t=>{throw e.addIssue(r(l,t)),e}))}))}))}{let t=this;return wu((function(){for(var e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];let l=t._def.args.safeParse(o,i);if(!l.success)throw new du([n(o,l.error)]);let c=Reflect.apply(s,this,l.data),u=t._def.returns.safeParse(c,i);if(!u.success)throw new du([r(c,u.error)]);return u.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new t(Ja(Xa({},this._def),{args:_h.create(n).rest(lh.create())}))}returns(e){return new t(Ja(Xa({},this._def),{returns:e}))}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(e,n,r){return new t(Xa({args:e||_h.create([]).rest(lh.create()),returns:n||lh.create(),typeName:Vh.ZodFunction},Nu(r)))}},Mh=class extends ku{get schema(){return this._def.getter()}_parse(t){let{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};Mh.create=(t,e)=>new Mh(Xa({getter:t,typeName:Vh.ZodLazy},Nu(e)));var Eh=class extends ku{_parse(t){if(t.data!==this._def.value){let e=this._getOrReturnCtx(t);return vu(e,{received:e.data,code:hu.invalid_literal,expected:this._def.value}),bu}return{status:"valid",value:t.data}}get value(){return this._def.value}};function Th(t,e){return new Ah(Xa({values:t,typeName:Vh.ZodEnum},Nu(e)))}Eh.create=(t,e)=>new Eh(Xa({value:t,typeName:Vh.ZodLiteral},Nu(e)));var Ah=class t extends ku{constructor(){super(...arguments),Pu.set(this,void 0)}_parse(t){if("string"!=typeof t.data){let e=this._getOrReturnCtx(t),n=this._def.values;return vu(e,{expected:iu.joinValues(n),received:e.parsedType,code:hu.invalid_type}),bu}if(Au(this,Pu)||Cu(this,Pu,new Set(this._def.values)),!Au(this,Pu).has(t.data)){let e=this._getOrReturnCtx(t),n=this._def.values;return vu(e,{received:e.data,code:hu.invalid_enum_value,options:n}),bu}return wu(t.data)}get options(){return this._def.values}get enum(){let t={};for(let e of this._def.values)t[e]=e;return t}get Values(){let t={};for(let e of this._def.values)t[e]=e;return t}get Enum(){let t={};for(let e of this._def.values)t[e]=e;return t}extract(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._def;return t.create(e,Xa(Xa({},this._def),n))}exclude(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._def;return t.create(this.options.filter((t=>!e.includes(t))),Xa(Xa({},this._def),n))}};Pu=new WeakMap,Ah.create=Th;var Ch=class extends ku{constructor(){super(...arguments),Iu.set(this,void 0)}_parse(t){let e=iu.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==cu.string&&n.parsedType!==cu.number){let t=iu.objectValues(e);return vu(n,{expected:iu.joinValues(t),received:n.parsedType,code:hu.invalid_type}),bu}if(Au(this,Iu)||Cu(this,Iu,new Set(iu.getValidEnumValues(this._def.values))),!Au(this,Iu).has(t.data)){let t=iu.objectValues(e);return vu(n,{received:n.data,code:hu.invalid_enum_value,options:t}),bu}return wu(t.data)}get enum(){return this._def.values}};Iu=new WeakMap,Ch.create=(t,e)=>new Ch(Xa({values:t,typeName:Vh.ZodNativeEnum},Nu(e)));var Ph=class extends ku{unwrap(){return this._def.type}_parse(t){let{ctx:e}=this._processInputParams(t);if(e.parsedType!==cu.promise&&!1===e.common.async)return vu(e,{code:hu.invalid_type,expected:cu.promise,received:e.parsedType}),bu;let n=e.parsedType===cu.promise?e.data:Promise.resolve(e.data);return wu(n.then((t=>this._def.type.parseAsync(t,{path:e.path,errorMap:e.common.contextualErrorMap}))))}};Ph.create=(t,e)=>new Ph(Xa({type:t,typeName:Vh.ZodPromise},Nu(e)));var Ih=class extends ku{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Vh.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:e,ctx:n}=this._processInputParams(t),r=this._def.effect||null,i={addIssue:t=>{vu(n,t),t.fatal?e.abort():e.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===r.type){let t=r.transform(n.data,i);if(n.common.async)return Promise.resolve(t).then((t=>Za(this,null,(function*(){if("aborted"===e.value)return bu;let r=yield this._def.schema._parseAsync({data:t,path:n.path,parent:n});return"aborted"===r.status?bu:"dirty"===r.status||"dirty"===e.value?xu(r.value):r}))));{if("aborted"===e.value)return bu;let r=this._def.schema._parseSync({data:t,path:n.path,parent:n});return"aborted"===r.status?bu:"dirty"===r.status||"dirty"===e.value?xu(r.value):r}}if("refinement"===r.type){let t=t=>{let e=r.refinement(t,i);if(n.common.async)return Promise.resolve(e);if(e instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return t};if(!1===n.common.async){let r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?bu:("dirty"===r.status&&e.dirty(),t(r.value),{status:e.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((n=>"aborted"===n.status?bu:("dirty"===n.status&&e.dirty(),t(n.value).then((()=>({status:e.value,value:n.value}))))))}if("transform"===r.type){if(!1===n.common.async){let t=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Eu(t))return t;let s=r.transform(t.value,i);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:s}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((t=>Eu(t)?Promise.resolve(r.transform(t.value,i)).then((t=>({status:e.value,value:t}))):t))}iu.assertNever(r)}};Ih.create=(t,e,n)=>new Ih(Xa({schema:t,typeName:Vh.ZodEffects,effect:e},Nu(n))),Ih.createWithPreprocess=(t,e,n)=>new Ih(Xa({schema:e,effect:{type:"preprocess",transform:t},typeName:Vh.ZodEffects},Nu(n)));var Rh=class extends ku{_parse(t){return this._getType(t)===cu.undefined?wu(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Rh.create=(t,e)=>new Rh(Xa({innerType:t,typeName:Vh.ZodOptional},Nu(e)));var Lh=class extends ku{_parse(t){return this._getType(t)===cu.null?wu(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Lh.create=(t,e)=>new Lh(Xa({innerType:t,typeName:Vh.ZodNullable},Nu(e)));var Nh=class extends ku{_parse(t){let{ctx:e}=this._processInputParams(t),n=e.data;return e.parsedType===cu.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};Nh.create=(t,e)=>new Nh(Xa({innerType:t,typeName:Vh.ZodDefault,defaultValue:"function"==typeof e.default?e.default:()=>e.default},Nu(e)));var Oh=class extends ku{_parse(t){let{ctx:e}=this._processInputParams(t),n=Ja(Xa({},e),{common:Ja(Xa({},e.common),{issues:[]})}),r=this._def.innerType._parse({data:n.data,path:n.path,parent:Xa({},n)});return Tu(r)?r.then((t=>({status:"valid",value:"valid"===t.status?t.value:this._def.catchValue({get error(){return new du(n.common.issues)},input:n.data})}))):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new du(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Oh.create=(t,e)=>new Oh(Xa({innerType:t,typeName:Vh.ZodCatch,catchValue:"function"==typeof e.catch?e.catch:()=>e.catch},Nu(e)));var kh=class extends ku{_parse(t){if(this._getType(t)!==cu.nan){let e=this._getOrReturnCtx(t);return vu(e,{code:hu.invalid_type,expected:cu.nan,received:e.parsedType}),bu}return{status:"valid",value:t.data}}};kh.create=t=>new kh(Xa({typeName:Vh.ZodNaN},Nu(t)));var Dh=Symbol("zod_brand"),zh=class extends ku{_parse(t){let{ctx:e}=this._processInputParams(t),n=e.data;return this._def.type._parse({data:n,path:e.path,parent:e})}unwrap(){return this._def.type}},Uh=class t extends ku{_parse(t){let{status:e,ctx:n}=this._processInputParams(t);if(n.common.async)return Za(this,null,(function*(){let t=yield this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===t.status?bu:"dirty"===t.status?(e.dirty(),xu(t.value)):this._def.out._parseAsync({data:t.value,path:n.path,parent:n})}));{let t=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===t.status?bu:"dirty"===t.status?(e.dirty(),{status:"dirty",value:t.value}):this._def.out._parseSync({data:t.value,path:n.path,parent:n})}}static create(e,n){return new t({in:e,out:n,typeName:Vh.ZodPipeline})}},Fh=class extends ku{_parse(t){let e=this._def.innerType._parse(t),n=t=>(Eu(t)&&(t.value=Object.freeze(t.value)),t);return Tu(e)?e.then((t=>n(t))):n(e)}unwrap(){return this._def.innerType}};function Bh(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return t?ah.create().superRefine(((r,i)=>{var s,o;if(!t(r)){let t="function"==typeof e?e(r):"string"==typeof e?{message:e}:e,a=null===(o=null!==(s=t.fatal)&&void 0!==s?s:n)||void 0===o||o,l="string"==typeof t?{message:t}:t;i.addIssue(Ja(Xa({code:"custom"},l),{fatal:a}))}})):ah.create()}Fh.create=(t,e)=>new Fh(Xa({innerType:t,typeName:Vh.ZodReadonly},Nu(e)));var Vh,Hh={object:ph.lazycreate};!function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"}(Vh||(Vh={}));var jh=Ku.create,Wh=th.create,Gh=kh.create,qh=eh.create,$h=nh.create,Xh=rh.create,Jh=ih.create,Yh=sh.create,Zh=oh.create,Kh=ah.create,Qh=lh.create,td=ch.create,ed=uh.create,nd=hh.create,rd=ph.create,id=ph.strictCreate,sd=fh.create,od=gh.create,ad=yh.create,ld=_h.create,cd=bh.create,ud=xh.create,hd=wh.create,dd=Sh.create,pd=Mh.create,fd=Eh.create,md=Ah.create,gd=Ch.create,vd=Ph.create,yd=Ih.create,_d=Rh.create,bd=Lh.create,xd=Ih.createWithPreprocess,wd=Uh.create,Sd={string:t=>Ku.create(Ja(Xa({},t),{coerce:!0})),number:t=>th.create(Ja(Xa({},t),{coerce:!0})),boolean:t=>nh.create(Ja(Xa({},t),{coerce:!0})),bigint:t=>eh.create(Ja(Xa({},t),{coerce:!0})),date:t=>rh.create(Ja(Xa({},t),{coerce:!0}))},Md=bu,Ed=Object.freeze({__proto__:null,defaultErrorMap:pu,setErrorMap:function(t){fu=t},getErrorMap:mu,makeIssue:gu,EMPTY_PATH:[],addIssueToContext:vu,ParseStatus:_u,INVALID:bu,DIRTY:xu,OK:wu,isAborted:Su,isDirty:Mu,isValid:Eu,isAsync:Tu,get util(){return iu},get objectUtil(){return su},ZodParsedType:cu,getParsedType:uu,ZodType:ku,datetimeRegex:Yu,ZodString:Ku,ZodNumber:th,ZodBigInt:eh,ZodBoolean:nh,ZodDate:rh,ZodSymbol:ih,ZodUndefined:sh,ZodNull:oh,ZodAny:ah,ZodUnknown:lh,ZodNever:ch,ZodVoid:uh,ZodArray:hh,ZodObject:ph,ZodUnion:fh,ZodDiscriminatedUnion:gh,ZodIntersection:yh,ZodTuple:_h,ZodRecord:bh,ZodMap:xh,ZodSet:wh,ZodFunction:Sh,ZodLazy:Mh,ZodLiteral:Eh,ZodEnum:Ah,ZodNativeEnum:Ch,ZodPromise:Ph,ZodEffects:Ih,ZodTransformer:Ih,ZodOptional:Rh,ZodNullable:Lh,ZodDefault:Nh,ZodCatch:Oh,ZodNaN:kh,BRAND:Dh,ZodBranded:zh,ZodPipeline:Uh,ZodReadonly:Fh,custom:Bh,Schema:ku,ZodSchema:ku,late:Hh,get ZodFirstPartyTypeKind(){return Vh},coerce:Sd,any:Kh,array:nd,bigint:qh,boolean:$h,date:Xh,discriminatedUnion:od,effect:yd,enum:md,function:dd,instanceof:function(t){return Bh((e=>e instanceof t),arguments.length>1&&void 0!==arguments[1]?arguments[1]:{message:`Input not instance of ${t.name}`})},intersection:ad,lazy:pd,literal:fd,map:ud,nan:Gh,nativeEnum:gd,never:td,null:Zh,nullable:bd,number:Wh,object:rd,oboolean:()=>$h().optional(),onumber:()=>Wh().optional(),optional:_d,ostring:()=>jh().optional(),pipeline:wd,preprocess:xd,promise:vd,record:cd,set:hd,strictObject:id,string:jh,symbol:Jh,transformer:yd,tuple:ld,undefined:Yh,union:sd,unknown:Qh,void:ed,NEVER:Md,ZodIssueCode:hu,quotelessJson:t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:du}),Td=Ed.object({serverUrl:Ed.string()}).parse({serverUrl:"https://io.superviz.com"}),Ad=class{constructor(t){this.socket=t,this.onConnect=()=>{this.logger.log("connection @ on connect","Connected to the socket"),this.changeState("CONNECTED")},this.onDisconnect=t=>{this.logger.log("connection @ on disconnect","Disconnected from the socket"),this.changeState("DISCONNECTED",t)},this.onConnectError=t=>{this.logger.log("connection @ on connect error","Connection error",t),this.changeState("CONNECTION_ERROR",t.message)},this.onConnectionError=t=>{this.logger.log("connection @ on connection error","Connection error",t),this.changeState("CONNECTION_ERROR",t.message)},this.onReconnect=()=>{this.logger.log("connection @ on reconnect","Reconnected to the socket"),this.changeState("CONNECTED")},this.onReconnectError=t=>{this.logger.log("connection @ on reconnect error","Reconnect error",t),this.changeState("RECONNECT_ERROR",t.message)},this.onReconnectFailed=()=>{this.logger.log("connection @ on reconnect failed","Failed to reconnect to the socket"),this.changeState("RECONNECT_ERROR")},this.onReconnecAttempt=t=>{this.logger.log("connection @ on reconnect attempt",`Reconnect attempt #${t}`),this.changeState("RECONNECTING",`Reconnect attempt #${t}`)},this.onCustomError=t=>{t.needsToDisconnect&&(this.socket.disconnect(),this.changeState("DISCONNECTED",t.errorType));let e=`[SuperViz] \n    - Error: ${t.errorType}\n    - Message: ${t.message}\n    `;"error"!==t.level?console.warn(e):console.error(e)},this.logger=new zl("@superviz/socket-client/connection"),this.subscribeToManagerEvents(),this.stateObserver=new Ol}on(t,e){this.stateObserver.closed&&(this.stateObserver=new Ol),this.stateObserver.subscribe({next:t,error:e})}off(){this.stateObserver.closed||this.stateObserver.unsubscribe()}subscribeToManagerEvents(){this.socket.on("connect",this.onConnect),this.socket.on("disconnect",this.onDisconnect),this.socket.on("connect_error",this.onConnectError),this.socket.io.on("error",this.onConnectionError),this.socket.io.on("reconnect",this.onReconnect),this.socket.io.on("reconnect_attempt",this.onReconnecAttempt),this.socket.io.on("reconnect_error",this.onReconnectError),this.socket.io.on("reconnect_failed",this.onReconnectFailed),this.socket.on("socket-event.error",this.onCustomError)}changeState(t,e){this.state=t,!this.stateObserver.closed&&this.stateObserver.next({state:t,reason:e})}},Cd=class t{constructor(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100;this.io=t,this.user=e,this.roomId=n,this.apiKey=r,this.maxConnections=i,this.isJoined=!1,this.subscriptions=new Map,this.observers=new Map,this.onJoinedRoom=t=>{var e;this.roomId===(null==(e=null==t?void 0:t.data)?void 0:e.name)&&(this.isJoined=!0,this.io.emit("room.joined",this.roomId,t.data),this.logger.log("room @ joined",t))},this.onHttpEvent=t=>{this.publishEventToClient(t.name,t)},this.logger=new zl("@superviz/socket-client/room");let s={name:n,user:e,maxConnections:i};this.presence=Ul.register(t,e,n),this.io.emit("room.join",s),this.subscribeToRoomEvents()}static register(e,n,r,i,s){return new t(e,n,r,i,s)}on(t,e){this.logger.log("room @ on",t);let n=this.observers.get(t);n||(n=new Ol,this.observers.set(t,n),this.io.on(t,(e=>{this.publishEventToClient(t,e)}))),this.subscriptions.set(e,n.subscribe(e))}off(t,e){var n;if(this.logger.log("room @ off",t),!e)return this.observers.delete(t),void this.io.off(t);null==(n=this.subscriptions.get(e))||n.unsubscribe()}emit(t,e){if(!this.isJoined)return void this.logger.log("Cannot emit event. Not joined to room");let n={name:t,roomId:this.roomId,presence:this.user,connectionId:this.io.id,data:e,timestamp:Date.now()};this.io.emit("room.update",this.roomId,n),this.logger.log("room @ emit",t,e)}history(t,e){let n=new Ol;n.subscribe({next:t,error:e});let r=t=>{this.logger.log("room @ history",t),this.io.off("room.get",r),n.next(t),n.complete(),n.unsubscribe()};this.io.on("room.get",r),this.io.emit("room.get",this.roomId)}disconnect(){this.logger.log("room @ disconnect","Leaving room...",this.roomId),this.io.emit("room.leave",this.roomId),this.subscriptions.forEach((t=>t.unsubscribe())),this.subscriptions.clear(),this.observers.forEach((t=>t.unsubscribe())),this.observers.clear(),this.presence.destroy()}publishEventToClient(t,e){let n=this.observers.get(t);!n||e.roomId!==this.roomId||n.next(e)}subscribeToRoomEvents(){this.io.on("room.joined",this.onJoinedRoom),this.io.on("room.error",(t=>{this.logger.log("Error:",t.data)})),this.io.on(`http:${this.roomId}:${this.apiKey}`,this.onHttpEvent)}},Pd=class{constructor(t,e,n,r,i){let s;this.apiKey=t,this.environment=e,this.presence=n,this.secret=r,this.clientId=i,this.manager=new ou(Td.serverUrl,{addTrailingSlash:!1,secure:!0,withCredentials:!0,reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5,extraHeaders:{"sv-api-key":this.apiKey}}),typeof window<"u"&&(s=window.location.origin),this.socket=this.manager.socket(`/${e}`,{auth:{apiKey:this.apiKey,origin:s,envirioment:this.environment,secret:this.secret,clientId:this.clientId}}),this.connection=new Ad(this.socket)}get state(){return this.connection.state}connect(t,e){return Cd.register(this.socket,this.presence,t,this.apiKey,e)}destroy(){this.socket.disconnect(),this.connection.off()}};Ed.object({name:Ed.string(),user:Ed.object({id:Ed.string(),name:Ed.string().nullable()}),maxConnections:Ed.union([Ed.number(),Ed.literal("unlimited"),Ed.undefined()])});var Id=xi(ji());Mi();var Rd=class{constructor(){this.observers=new Map,this.subscribe=(t,e)=>{this.logger.log("event bus service @ subscribe",{event:t,callback:e}),this.observers.has(t)||this.observers.set(t,new La),this.observers.get(t).subscribe(e)},this.unsubscribe=(t,e)=>{this.logger.log("event bus service @ unsubscribe",{event:t,callback:e}),this.observers.has(t)&&(this.observers.get(t).reset(),this.observers.delete(t))},this.publish=(t,e)=>{this.logger.log("event bus service @ publish",{event:t,data:e}),this.observers.has(t)&&this.observers.get(t).publish(e)},this.destroy=()=>{this.logger.log("event bus service @ destroy"),this.observers.forEach((t=>{t.reset(),t.destroy()})),this.observers.clear()},this.logger=new Ia("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};Mi(),Mi();var Ld=class{constructor(t){this.participant=t,this.stateSubject=new Ns,this.handleConnectionState=t=>"Unauthorized connection"===t.reason?(console.error("[Superviz] Unauthorized connection. Please check your API key and if your domain is white listed."),this.state={state:rl.DISCONNECTED,reason:"Unauthorized connection"},void this.stateSubject.next("AUTH_ERROR")):"user-already-in-room"===t.reason?(this.state=t,void this.stateSubject.next("SAME_ACCOUNT_ERROR")):(this.state=t,void this.stateSubject.next(t.state)),this.createClient()}destroy(){this.stateSubject.complete(),this.client.destroy()}subscribeToDefaultEvents(){this.client.connection.on(this.handleConnectionState)}createClient(){let t=qi.get("environment");t=["dev","prod"].includes(t)?t:"dev",this.client=new Pd(qi.get("apiKey"),t,{id:this.participant.id,name:this.participant.name}),this.subscribeToDefaultEvents()}createRoom(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,n=qi.get("roomId");return this.client.connect(`${n}:${t}`,e)}};Mi(),Mi();var Nd=(t=>(t.comments="presence",t.presence3dMatterport="presence",t.presence3dAutodesk="presence",t.presence3dThreejs="presence",t.whoIsOnline="presence",t.formElements="presence",t.yjsProvider="presence",t))(Nd||{}),Od=class{static checkComponentLimit(t){var e,n;let r=qi.get("limits"),i=null!=(e=Nd[t])?e:t;return null!=(n=null==r?void 0:r[i])?n:{canUse:!1,maxParticipants:50}}};Mi();var kd=xi(ji());Mi();var Dd=class{constructor(t,e){this.participants3DObservers=[],this.initializeParticipantsList=()=>{this.room.presence.get((t=>{t.forEach((t=>{this.unthrottledUpdatePresence3D(t.data)}))}))},this.onLocalParticipantJoined=t=>{var e;if(!t.slot||null===(null==(e=t.slot)?void 0:e.index))return void setTimeout((()=>{this.onLocalParticipantJoined(this.localParticipant)}),2e3);if(!this.room.isJoined)return void setTimeout((()=>{this.onLocalParticipantJoined(t)}),2e3);let{hasJoined3D:n}=this.useStore("presence-3d-store");n.publish(!0),this.room.emit("participant-joined",t),this.room.presence.update(t),this.initializeParticipantsList()},this.subscribeToRoomEvents=()=>{this.room.on("participant-joined",this.onJoinedRoom),this.room.presence.on(nl.LEAVE,this.onLeaveRoom),this.room.presence.on(nl.UPDATE,this.onParticipantUpdate),this.room.presence.on(nl.JOINED_ROOM,this.onJoinedPresence)},this.unsubscribeFromRoomEvents=()=>{this.room.off("participant-joined",this.onJoinedRoom),this.room.presence.off(nl.LEAVE),this.room.presence.off(nl.UPDATE),this.room.presence.off(nl.JOINED_ROOM)},this.onJoinedRoom=t=>{let{participants:e}=this.useStore("presence-3d-store"),n=e.value.find((e=>e.id===t.data.id));e.publish([...e.value.filter((e=>e.id!==t.data.id)),vi(vi({},n),t.data)])},this.onLeaveRoom=t=>{if(t.id===this.localParticipant.id)return this.unsubscribeFromRoomEvents(),void this.useStore("presence-3d-store").destroy();let{participants:e}=this.useStore("presence-3d-store"),n=e.value.filter((e=>e.id!==t.id));e.publish(n)},this.unthrottledUpdatePresence3D=t=>{if(null==t||!t.id)return;let{participants:e,hasJoined3D:n}=this.useStore("presence-3d-store"),r=vi(vi({},e.value.find((e=>e.id===t.id))),t);e.publish([...e.value.filter((e=>e.id!==t.id)),r]),n.value&&r.id===this.localParticipant.id&&this.room.presence.update(r)},this.onJoinedPresence=t=>{t.id===this.localParticipant.id&&(this.logger.log("participant joined 3D room",t.id,this.localParticipant),this.onLocalParticipantJoined(this.localParticipant))},this.updatePresence3D=(0,kd.throttle)((t=>{this.unthrottledUpdatePresence3D(t)}),1e3),this.onParticipantUpdate=t=>{if(t.id===this.localParticipant.id)return;let{participants:e}=this.useStore("presence-3d-store"),n=vi(vi({},e.value.filter((e=>e.id===t.id))[0]),t.data),r=e.value.map((e=>e.id===t.id?n:e));e.publish(r),this.participants3DObservers[t.id]&&this.participants3DObservers[t.id].publish(n)},this.setParticipantData=t=>{this.updatePresence3D(t)},this.room=t,this.logger=new Ia("@superviz/sdk/presence3D-manager"),this.useStore=e,this.subscribeToRoomEvents();let{localParticipant:n}=this.useStore("global-store");n.subscribe((t=>{this.room.presence.update(t);let{participants:e}=this.useStore("presence-3d-store"),n=vi(vi({},e.value.find((e=>e.id===t.id))),t);e.publish([...e.value.filter((e=>e.id!==t.id)),n]),this.localParticipant=n}))}subscribeToUpdates(t,e){this.participants3DObservers[t]||(this.participants3DObservers[t]=new La({logger:this.logger})),this.participants3DObservers[t].subscribe(e)}unsubscribeFromUpdates(t,e){this.participants3DObservers[t]&&this.participants3DObservers[t].unsubscribe(e)}get getParticipants(){return this.useStore("presence-3d-store").participants.value}};Mi(),Mi();var zd=(t=>(t.HOST="host",t.GUEST="guest",t.AUDIENCE="audience",t))(zd||{}),Ud=class{constructor(t,e){this.room=t,this.useStore=e,this.isAssigningSlot=!1,this.slot={index:null,color:Ui.gray,textColor:"#fff",colorName:"gray",timestamp:Date.now()},this.onPresenceUpdate=t=>Si(this,null,(function*(){var e,n,r;let{localParticipant:i}=this.useStore("global-store");if(t.id!==i.value.id){if(null!==(null==(e=t.data.slot)?void 0:e.index)&&null!==this.slot.index&&(null==(n=t.data.slot)?void 0:n.index)===(null==(r=this.slot)?void 0:r.index)){let t=yield this.assignSlot();i.publish(yi(vi({},i.value),{slot:t})),console.debug(`[SuperViz] - Slot reassigned to ${i.value.id}, slot: ${t.colorName}`)}}else{let e=yield this.validateSlotType(t.data);i.publish(yi(vi({},i.value),{slot:e}))}})),this.participantNeedsSlot=t=>{var e;let n=["formElements","whoIsOnline","presence","presence3dAutodesk","presence3dMatterport","presence3dThreejs","yjsProvider"].some((e=>{var n;return null==(n=null==t?void 0:t.activeComponents)?void 0:n.includes(e)})),r=(null==(e=null==t?void 0:t.activeComponents)?void 0:e.includes("videoConference"))&&"audience"!==t.type;return n||r},this.validateSlotType=t=>Si(this,null,(function*(){var e,n;if(this.isAssigningSlot)return this.slot;let r=this.participantNeedsSlot(t);if(null===(null==(e=t.slot)?void 0:e.index)&&r){let t=yield this.assignSlot();this.slot=t}return null!==(null==(n=t.slot)?void 0:n.index)&&!r&&this.setDefaultSlot(),this.slot})),this.room=t,this.room.presence.on(nl.UPDATE,this.onPresenceUpdate)}assignSlot(){return Si(this,null,(function*(){if(this.isAssigningSlot)return this.slot;this.isAssigningSlot=!0;let t=Array.from({length:50},((t,e)=>e)),e=Math.floor(50*Math.random()),{localParticipant:n,participants:r}=oa("global-store");try{yield new Promise(((e,r)=>{this.room.presence.get((i=>{if((!i||!i.length)&&e(!0),i.length>=50)return t=[],void r(new Error("[SuperViz] - No more slots available"));i.forEach((e=>{e.id!==n.value.id&&(t=t.filter((t=>{var n,r;return t!==(null==(r=null==(n=e.data)?void 0:n.slot)?void 0:r.index)})))})),e(!0)}))})),!t.includes(e)&&(e=t.shift());let i=Object.keys(Ui)[e],s={index:e,color:Ui[i],textColor:zi.includes(i)?"#fff":"#000",colorName:i,timestamp:Date.now()};return this.slot=s,n.publish(yi(vi({},n.value),{slot:s})),r.publish(yi(vi({},r.value),{[n.value.id]:yi(vi({},r.value[n.value.id]),{slot:s})})),this.room.presence.update({slot:s}),this.isAssigningSlot=!1,s}catch(o){return console.error(o),null}}))}setDefaultSlot(){let{localParticipant:t,participants:e}=oa("global-store"),n={index:null,color:Ui.gray,textColor:"#fff",colorName:"gray",timestamp:Date.now()};this.slot=n,t.publish(yi(vi({},t.value),{slot:n})),e.publish(yi(vi({},e.value),{[t.value.id]:yi(vi({},e.value[t.value.id]),{slot:n})})),this.room.presence.update({slot:n})}};Mi();var Fd=class extends Na{constructor(t){let{participant:e,group:n}=t;super(),this.isDestroyed=!1,this.activeComponents=[],this.componentsToAttachAfterJoin=[],this.activeComponentsInstances=[],this.eventBus=new Rd,this.useStore=oa.bind(this),this.addComponent=t=>Si(this,null,(function*(){if(!this.canAddComponent(t))return;let{hasJoinedRoom:e,group:n,localParticipant:r}=oa("global-store");if(!e.value)return this.logger.log("launcher service @ addComponent - not joined yet"),void this.componentsToAttachAfterJoin.push(t);let i=Od.checkComponentLimit(t.name);t.attach({ioc:this.ioc,config:qi.configuration,eventBus:this.eventBus,useStore:oa,Presence3DManagerService:Dd,connectionLimit:i.maxParticipants}),this.activeComponents.push(t.name),this.activeComponentsInstances.some((e=>e.name===t.name))?this.activeComponentsInstances=this.activeComponentsInstances.map((e=>e.name===t.name?t:e)):this.activeComponentsInstances.push(t),r.publish(yi(vi({},r.value),{activeComponents:this.activeComponents})),this.room.presence.update(yi(vi({},r.value),{slot:this.slotService.slot,activeComponents:this.activeComponents})),Oa.sendActivity(this.participant.id,n.value.id,n.value.name,t.name)})),this.attachComponentsAfterJoin=()=>{this.logger.log("launcher service @ attachComponentsAfterJoin"),this.componentsToAttachAfterJoin.forEach((t=>{this.logger.log("launcher service @ attachComponentsAfterJoin - attaching component",t.name),this.addComponent(t)})),this.componentsToAttachAfterJoin=[]},this.removeComponent=t=>{if(!this.activeComponents.includes(t.name)){let e=`[SuperViz] Component ${t.name} is not initialized yet.`;return this.logger.log(e),void console.error(e)}t.detach(),this.activeComponentsInstances=this.activeComponentsInstances.filter((e=>e.name!==t.name)),this.activeComponents.splice(this.activeComponents.indexOf(t.name),1),this.room.presence.update(yi(vi({},this.participant),{activeComponents:this.activeComponents}))},this.destroy=()=>{var t,e,n,r,i,s;this.logger.log("launcher service @ destroy"),this.activeComponentsInstances.forEach((t=>{this.logger.log("launcher service @ destroy - removing component",t.name),this.removeComponent(t)})),this.activeComponents=[],this.activeComponentsInstances=[],null==(t=xo())||t.destroy(),null==(e=this.eventBus)||e.destroy(),this.eventBus=void 0,null==(n=this.room)||n.presence.off(nl.JOINED_ROOM),null==(r=this.room)||r.presence.off(nl.LEAVE),null==(i=this.room)||i.presence.off(nl.UPDATE),null==(s=this.ioc)||s.destroy(),this.isDestroyed=!0,typeof window<"u"&&(window.SUPERVIZ=void 0)},this.canAddComponent=t=>{var e;let n=qi.get(`features.${t.name}`),r=Od.checkComponentLimit(t.name),i=null==(e=this.activeComponents)?void 0:e.includes(t.name),s=[{isValid:n,message:`[SuperViz] Component ${t.name} is not enabled in the room`},{isValid:!this.isDestroyed,message:"[SuperViz] Component can not be added because the superviz room is destroyed. Initialize a new room to add and use components."},{isValid:!i,message:`[SuperViz] Component ${t.name} is already active. Please remove it first`},{isValid:r.canUse,message:`[SuperViz] You reached the limit usage of ${t.name}`}];for(let o=0;o<s.length;o++){let{isValid:t,message:e}=s[o];if(!t)return this.logger.log(e),console.error(e),!1}return!0},this.onAuthentication=t=>{t||(this.destroy(),console.error("[SuperViz] Room cannot be initialized because this website's domain is not whitelisted. If you are the developer, please add your domain in https://dashboard.superviz.com/developer"))},this.onLocalParticipantUpdateOnStore=t=>{this.participant=t,this.activeComponents=t.activeComponents||[]},this.onLocalParticipantUpdateOnCore=t=>{this.room&&this.room.presence.update(t)},this.onParticipantsListUpdateOnCore=t=>{let{participants:e}=this.useStore("global-store");e.publish(t)},this.onSameAccount=()=>{this.publish("participant.same-account-error"),this.destroy()},this.startIOC=()=>{this.logger.log("launcher service @ startIOC");let{participants:t}=oa("global-store");this.ioc.stateSubject.subscribe(this.onConnectionStateChange),this.room.presence.get((e=>{let n={};e.forEach((t=>{n[t.id]=yi(vi({},t.data),{name:t.name,id:t.id,timestamp:t.timestamp})})),n[this.participant.id]=vi(vi({},n[this.participant.id]),this.participant),t.publish(n)})),this.room.presence.on(nl.JOINED_ROOM,this.onParticipantJoinedIOC),this.room.presence.on(nl.LEAVE,this.onParticipantLeaveIOC),this.room.presence.on(nl.UPDATE,this.onParticipantUpdatedIOC)},this.onConnectionStateChange=t=>{"AUTH_ERROR"!==t?"SAME_ACCOUNT_ERROR"===t&&this.onSameAccount():this.onAuthentication(!1)},this.onParticipantJoinedIOC=t=>Si(this,null,(function*(){if(t.id!==this.participant.id)return;this.room.presence.update(this.participant),this.logger.log("launcher service @ onParticipantJoined - local participant joined");let{hasJoinedRoom:e}=oa("global-store");e.publish(!0),this.attachComponentsAfterJoin(),this.publish("participant.local-joined",this.participant),this.publish("participant.joined",this.participant)})),this.onParticipantLeaveIOC=t=>{let{participants:e,localParticipant:n}=oa("global-store"),r=vi({},e.value);delete r[t.id],e.publish(r),t.id===n.value.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",t.data)),this.logger.log("launcher service @ onParticipantLeave - participant left",t.data),this.publish("participant.left",t.data),this.publish("participant.list-updated",Object.values(r))},this.onParticipantUpdatedIOC=t=>{let{localParticipant:e}=oa("global-store");if(e.value&&t.id===e.value.id){let n=vi(vi({},e.value),t.data);e.publish(yi(vi({},n),{timestamp:t.timestamp})),this.publish("participant.updated",n),this.logger.log("Publishing ParticipantEvent.UPDATED",t.data)}let{participants:n}=oa("global-store"),r=vi({id:t.id,name:t.name,timestamp:t.timestamp},t.data);n.value[t.id]||this.publish("participant.joined",r);let i=Object.assign({},n.value);if(i[t.id]=r,(0,Id.isEqual)(i,n.value))return;n.publish(i);let s=Object.values(n.value);this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",n.value),this.publish("participant.list-updated",s)},this.logger=new Ia("@superviz/sdk/launcher");let{localParticipant:r,group:i,isDomainWhitelisted:s}=this.useStore("global-store"),{localParticipant:o,participants:a}=this.useStore("core-store");r.publish(vi({},e)),s.subscribe(this.onAuthentication),r.subscribe(this.onLocalParticipantUpdateOnStore),o.subscribe(this.onLocalParticipantUpdateOnCore),a.subscribe(this.onParticipantsListUpdateOnCore),i.publish(n),this.ioc=new Ld(r.value),this.room=this.ioc.createRoom("launcher","unlimited"),this.slotService=new Ud(this.room,this.useStore),r.publish(yi(vi({},r.value),{slot:this.slotService.slot,activeComponents:[]})),this.participant=r.value,this.eventBus=new Rd,this.logger.log("launcher created"),this.startIOC()}};function Bd(t){return!(!/^.{2,64}$/.test(t)||!/^[-_&@+=,(){}\[\]\/\xab\xbb.:|'"#a-zA-Z0-9\xc0-\xff\s]*$/.test(t))}var Vd=t=>{Object.entries(t).forEach((t=>{let[e,n]=t;if(!Object.values(Aa).includes(e))throw new Error(`[SuperViz] Color ${e} is not a valid color variable name. Please check the documentation for more information.`);if(!/^(\d{1,3}\s){2}\d{1,3}$/.test(n))throw new Error(`[SuperViz] Color ${e} is not a valid color variable value. Please check the documentation for more information.`)}))},Hd=(t,e)=>Si(void 0,null,(function*(){var n,r,i,s,o;if(!t||!t.trim())throw new Error("API key is required");if(!e)throw new Error("Options is required");(t=>{let{group:e,participant:n,roomId:r,customColors:i}=t;if(i&&Vd(i),!e||!e.name||!e.id)throw new Error("[SuperViz] Group fields is required");if(!n||!n.id)throw new Error("[SuperViz] Participant id is required");if(!r)throw new Error("[SuperViz] Room id is required");if(!Bd(r))throw new Error("[SuperViz] Room id is invalid, it should be between 2 and 64 characters and only accept letters, numbers and special characters: -_&@+=,(){}[]/\xab\xbb.:|'\"");if(!Bd(n.id))throw new Error("[SuperViz] Participant id is invalid, it should be between 2 and 64 characters and only accept letters, numbers and special characters: -_&@+=,(){}[]/\xab\xbb.:|'\"");if(n.email&&!function(t){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t)}(n.email))throw new Error("[SuperViz] Participant email is invalid")})(e),e.debug?Ta.debug.enable("*"):Ta.debug.disable();let[{apiUrl:a,conferenceLayerUrl:l},c]=yield Promise.all([Da.getRemoteConfig(e.environment),Da.getFeatures(t)]);if(!(yield ka(a,t)))throw new Error("Failed to validate API key");let[u,h]=yield Promise.all([Oa.fetchWaterMark(a,t),Oa.fetchLimits(a,t)]).catch((()=>{throw new Error("[SuperViz] Failed to load configuration from server")})),{participant:d,roomId:p,customColors:f}=e;qi.setConfig({apiUrl:a,apiKey:t,conferenceLayerUrl:l,environment:null!=(n=e.environment)?n:"prod",roomId:p,debug:e.debug,limits:h,waterMark:u,colors:f,features:c}),(t=>{t&&Object.entries(t).forEach((t=>{let[e,n]=t,r=n.replace(/\s/g,", ");document.documentElement.style.setProperty(`--${e}`,r)}))})(f);let m=yield Oa.fetchParticipant(d.id).catch((()=>null));if(!m&&!d.name)throw new Error("[SuperViz] - Participant does not exist, create the user in the API or add the name in the initialization to initialize the SuperViz room.");return m||(yield Oa.createParticipant({participantId:d.id,name:null==d?void 0:d.name,avatar:null==(r=d.avatar)?void 0:r.imageUrl,email:null==d?void 0:d.email})),(t=>{if(typeof window<"u"&&window.SUPERVIZ)return console.warn("[SUPERVIZ] Room already initialized"),{destroy:window.SUPERVIZ.destroy,subscribe:window.SUPERVIZ.subscribe,unsubscribe:window.SUPERVIZ.unsubscribe,addComponent:window.SUPERVIZ.addComponent,removeComponent:window.SUPERVIZ.removeComponent};let e=new Fd(t);return typeof window<"u"&&(window.SUPERVIZ=e),{destroy:e.destroy,subscribe:e.subscribe,unsubscribe:e.unsubscribe,addComponent:e.addComponent,removeComponent:e.removeComponent}})(yi(vi({},e),{participant:{id:d.id,name:null!=(i=d.name)?i:null==m?void 0:m.name,avatar:null!=(s=d.avatar)?s:null==m?void 0:m.avatar,email:null!=(o=d.email)?o:null==m?void 0:m.email}}))}));Mi(),typeof window<"u"&&typeof HTMLElement<"u"&&(Promise.all([n.e(999),n.e(157)]).then(n.bind(n,9157)),Promise.all([n.e(999),n.e(830)]).then(n.bind(n,5830)),Promise.all([n.e(999),n.e(898)]).then(n.bind(n,4898)),Promise.all([n.e(999),n.e(739)]).then(n.bind(n,9739)),Promise.all([n.e(999),n.e(546),n.e(401)]).then(n.bind(n,9401)),Promise.all([n.e(999),n.e(546),n.e(523)]).then(n.bind(n,2523)),Promise.all([n.e(999),n.e(546),n.e(844)]).then(n.bind(n,8844)),Promise.all([n.e(999),n.e(546),n.e(251)]).then(n.bind(n,3251)),Promise.all([n.e(999),n.e(546),n.e(277)]).then(n.bind(n,277)),Promise.all([n.e(999),n.e(546),n.e(646)]).then(n.bind(n,8646)),Promise.all([n.e(999),n.e(546),n.e(801)]).then(n.bind(n,6801)),Promise.all([n.e(999),n.e(410)]).then(n.bind(n,8410)),Promise.all([n.e(999),n.e(546),n.e(83)]).then(n.bind(n,3083)),Promise.all([n.e(999),n.e(546),n.e(356)]).then(n.bind(n,9356)),Promise.all([n.e(999),n.e(546),n.e(846)]).then(n.bind(n,846)),Promise.all([n.e(999),n.e(546),n.e(90)]).then(n.bind(n,90)),Promise.all([n.e(999),n.e(921)]).then(n.bind(n,921)),Promise.all([n.e(999),n.e(426)]).then(n.bind(n,6426))),Mi(),Mi();!function(t){if(typeof document<"u"){let e=document.createElement("style");e.id="superviz-style";let n=document.createTextNode(t);e.appendChild(n),document.head.appendChild(e)}}('@import"https://unpkg.com/@superviz/sv-icons@0.8.13/css/style.css";@import"https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap";:root{--sv-primary: 98, 16, 204}html,body{width:100%;height:100%;overflow:hidden}#sv-video-wrapper iframe{position:fixed;border:none;margin:0;padding:0;overflow:hidden;z-index:1000}#sv-video-wrapper iframe.sv-video-frame--right{top:var(--superviz-offset-top);right:var(--superviz-offset-right)}#sv-video-wrapper iframe.sv-video-frame--left{top:var(--superviz-offset-top);left:var(--superviz-offset-left)}#sv-video-wrapper iframe.sv-video-frame--bottom{bottom:var(--superviz-offset-bottom);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--top{top:var(--superviz-offset-top);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--no-overlay{display:none}.pointer-mouse{display:flex;height:15px;width:16px;background-image:url(https://production.cdn.superviz.com/static/pointers/0.svg);background-repeat:no-repeat}.mouse-user-name{display:block;position:absolute;border-radius:30px;padding:2px 8px;font-weight:700;font-size:14px;font-family:Roboto,sans-serif;line-height:22px;margin-left:10px;margin-top:-6px;background:#ff0;white-space:nowrap}.mouse-follower{position:absolute;display:block;z-index:2}\n'),Mi();var jd=(t=>(t.RIGHT="right",t.CENTER="center",t.LEFT="left",t))(jd||{}),Wd=(t=>(t.GRID="grid",t.LIST="list",t))(Wd||{}),Gd=(t=>(t.RIGHT="right",t.LEFT="left",t.TOP="top",t.BOTTOM="bottom",t))(Gd||{});Mi();var qd=(t=>(t.STARTED="STARTED",t.STOPPED="STOPPED",t))(qd||{}),$d=(t=>(t.REALTIME_STATE_CHANGED="realtime-component.state-changed",t))($d||{});Mi();var Xd=(t=>(t.BLUR="field.blur",t.FOCUS="field.focus",t.CONTENT_CHANGE="field.content-change",t.INTERACTION="field.interaction",t))(Xd||{});Mi(),Mi(),Mi();var Jd=class extends Na{constructor(){super(...arguments),this.isAttached=!1,this.unsubscribeFrom=[],this.useStore=oa.bind(this),this.attach=t=>{var e;if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){let t=`${this.name} @ attach - params are required`;throw this.logger.log(t),new Error(t)}let{config:n,eventBus:r,ioc:i}=t,{isDomainWhitelisted:s,hasJoinedRoom:o}=this.useStore("global-store");if(s.value){if(qi.setConfig(n),this.eventBus=r,this.isAttached=!0,this.ioc=i,this.connectionLimit=null!=(e=t.connectionLimit)?e:50,this.room=i.createRoom(this.name,this.connectionLimit),!o.value)return this.logger.log(`${this.name} @ attach - not joined yet`),void setTimeout((()=>{this.logger.log(`${this.name} @ attach - retrying`),this.attach(t)}),1e3);this.logger.log(`${this.name} @ attached`),this.observers={},this.start(),this.publish("mount")}else{let t=`Component ${this.name} can't be used because this website's domain is not whitelisted. Please add your domain in https://dashboard.superviz.com/developer`;this.logger.log(t)}},this.detach=()=>{this.isAttached?(this.logger.log("detached"),this.publish("unmount"),this.destroy(),this.room.disconnect(),this.room=void 0,this.unsubscribeFrom.forEach((t=>t(this))),Object.values(this.observers).forEach((t=>{t.reset(),t.destroy()})),this.observers=void 0,this.isAttached=!1):this.logger.log(`${this.name} @ detach - component is not attached`)}}},Yd=class extends Jd{constructor(t,e){var n,r,i;super(),this.sidebarOpen=!1,this.layoutOptions={},this.openThreads=()=>{var t;this.sidebarOpen||(null==(t=this.element)||t.setAttribute("open",""),this.sidebarOpen=!0,document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0})))},this.closeThreads=()=>{var t;this.sidebarOpen&&(null==(t=this.element)||t.removeAttribute("open"),this.sidebarOpen=!1,document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0})))},this.togglePinActive=()=>{this.pinActive?this.disable():this.enable()},this.onPinFixed=t=>{this.coordinates=t},this.toggleAnnotationSidebar=()=>{this.element.toggleAttribute("open"),this.sidebarOpen=this.element.hasAttribute("open"),document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:void 0,composed:!0,bubbles:!0})),document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0}))},this.onSelectAnnotation=t=>{this.sidebarOpen||this.toggleAnnotationSidebar()},this.positionFloatingButton=()=>{var t,e;this.button=document.createElement("superviz-comments-button");let n=null==(t=this.layoutOptions)?void 0:t.buttonLocation,r=null==(e=this.layoutOptions)?void 0:e.position;if(!n)return document.body.appendChild(this.button),void(this.button.commentsPosition=r);let i="",s=!1,o=!Object.values(Vi).includes(n.toLocaleLowerCase());if(o){let t=window.document.body.querySelector(`#${n}`);t?(t.appendChild(this.button),i="position: relative"):(s=!0,n="top-left")}if(!o||s){document.body.appendChild(this.button);let[t,e]=n.split("-");i=`${t}: 20px; ${e}: 20px;`}this.button.positionStyles=i,this.button.commentsPosition=r},this.positionComments=()=>{var t;this.element=document.createElement("superviz-comments"),this.element.setAttribute("comments",JSON.stringify([])),this.element.side="left",this.element.offset=this.offset,document.body.appendChild(this.element);let e=null==(t=this.layoutOptions)?void 0:t.position;if(!e)return;let n=e.toUpperCase();Bi[n]&&(this.element.side=Bi[n])},this.createAnnotation=t=>Si(this,[t],(function(t){var e=this;let{detail:n}=t;return function*(){try{let{text:t,mentions:r}=n,i=vi({},e.coordinates),s=yield Oa.createAnnotations(qi.get("apiUrl"),qi.get("apiKey"),{roomId:qi.get("roomId"),position:JSON.stringify(i),userId:e.localParticipantId}),o=yield e.createComment(s.uuid,t,r);e.addAnnotation(yi(vi({},s),{comments:[o]})),e.pinAdapter.removeAnnotationPin("temporary-pin"),document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:s.uuid,haltGoToPin:!0,newPin:!0},composed:!0,bubbles:!0}))}catch(t){e.logger.log("error when creating annotation",t)}}()})),this.deleteAnnotation=t=>Si(this,[t],(function(t){var e=this;let{detail:n}=t;return function*(){try{let{uuid:t}=n;yield Oa.deleteAnnotation(qi.get("apiUrl"),qi.get("apiKey"),t);let r=e.annotations.filter((e=>e.uuid!==t));e.updateAnnotationList(r),e.pinAdapter.removeAnnotationPin(t),e.element.updateAnnotations(e.annotations)}catch(t){e.logger.log("error when deleting annotation",t)}}()})),this.updateComment=t=>Si(this,[t],(function(t){var e=this;let{detail:n}=t;return function*(){try{let{uuid:t,text:r,mentions:i}=n,s=yield Oa.updateComment(qi.get("apiUrl"),qi.get("apiKey"),t,r);yield Oa.createMentions({commentsId:s.uuid,participants:i.map((t=>({id:t.userId})))});let o=e.annotations.map((e=>Object.assign({},e,{comments:e.comments.map((e=>e.uuid===t?Object.assign({},e,{text:r,mentions:i}):e))})));e.updateAnnotationList(o)}catch(t){e.logger.log("error when updating comment",t)}}()})),this.resolveAnnotation=t=>Si(this,[t],(function(t){var e=this;let{detail:n}=t;return function*(){try{let{uuid:t}=n,{resolved:r}=yield Oa.resolveAnnotation(qi.get("apiUrl"),qi.get("apiKey"),t),i=e.annotations.map((e=>e.uuid===t?Object.assign({},e,{resolved:r}):e));if(e.updateAnnotationList(i),r)return void e.pinAdapter.removeAnnotationPin(t);e.pinAdapter.updateAnnotations(e.annotations)}catch(t){e.logger.log("error when resolve annotation",t)}}()})),this.deleteComment=t=>Si(this,[t],(function(t){var e=this;let{detail:n}=t;return function*(){try{let{uuid:t,annotationId:r}=n;if(!t||!r)return;yield Oa.deleteComment(qi.get("apiUrl"),qi.get("apiKey"),t);let i=e.annotations.find((t=>t.uuid===r));i.comments=i.comments.filter((e=>e.uuid!==t));let s=e.annotations.map((t=>t.uuid===r?i:t));e.element.updateAnnotations(s),e.updateAnnotationList(s)}catch(t){e.logger.log("error when deleting comment",t)}}()})),this.onAnnotationListUpdate=t=>{let{data:e,clientId:n}=t;this.localParticipantId!==n&&(this.annotations=e,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations))},this.name="comments",this.logger=new Ia("@superviz/sdk/comments-component"),this.annotations=[],this.layoutOptions={buttonLocation:null!=(n=null==e?void 0:e.buttonLocation)?n:"top-left",position:null!=(r=null==e?void 0:e.position)?r:"left"},this.hideDefaultButton=null!=(i=null==e?void 0:e.hideDefaultButton)&&i,this.setStyles(null==e?void 0:e.styles),this.offset=null==e?void 0:e.offset,setTimeout((()=>{var e,n;t.setCommentsMetadata(null!=(n=null==(e=this.layoutOptions)?void 0:e.position)?n:"left")})),this.pinAdapter=t;let{group:s,localParticipant:o}=this.useStore("global-store");s.subscribe(),o.subscribe((t=>{this.localParticipantId=t.id}))}enable(){this.pinAdapter.setActive(!0),this.pinActive=!0,this.publish("pin-mode.active"),document.body.dispatchEvent(new CustomEvent("toggle-pin-active",{detail:{isActive:!0}}))}disable(){this.pinAdapter.setActive(!1),this.pinActive=!1,this.publish("pin-mode.inactive"),document.body.dispatchEvent(new CustomEvent("toggle-pin-active",{detail:{isActive:!1}}))}start(){typeof window<"u"&&(this.clientUrl=window.location.href,this.positionComments(),this.hideDefaultButton||this.positionFloatingButton(),this.fetchAnnotations(),this.waterMarkState(),this.participantsList(),this.addListeners(),this.pinAdapter.setPinsVisibility(!0))}destroy(){var t;this.logger.log("comments component @ destroy"),this.destroyListeners(),null==(t=this.button)||t.remove(),this.element.remove(),this.element=void 0,this.pinAdapter.destroy()}addListeners(){var t;null==(t=this.button)||t.addEventListener("toggle",this.togglePinActive),this.element.addEventListener("close-threads",this.closeThreads),document.body.addEventListener("create-annotation",this.createAnnotation),this.element.addEventListener("resolve-annotation",this.resolveAnnotation),this.element.addEventListener("delete-annotation",this.deleteAnnotation),this.element.addEventListener("create-comment",(t=>{let{detail:e}=t;this.createComment(e.uuid,e.text,e.mentions,!0)})),this.element.addEventListener("update-comment",this.updateComment),this.element.addEventListener("delete-comment",this.deleteComment),document.body.addEventListener("select-annotation",this.onSelectAnnotation),this.room.on("update-comments",this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.subscribe(this.onPinFixed)}destroyListeners(){var t;null==(t=this.button)||t.removeEventListener("toggle",this.togglePinActive),this.element.removeEventListener("close-threads",this.closeThreads),this.element.removeEventListener("resolve-annotation",this.resolveAnnotation),this.element.removeEventListener("create-comment",(t=>{let{detail:e}=t;this.createComment(e.uuid,e.text,e.mentions,!0)})),this.element.removeEventListener("update-comment",this.updateComment),this.element.removeEventListener("delete-comment",this.deleteComment),document.body.removeEventListener("select-annotation",this.onSelectAnnotation),document.body.removeEventListener("create-annotation",this.createAnnotation),this.room.off("update-comments",this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.unsubscribe(this.onPinFixed)}setStyles(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!t)return;let e=document.createElement("style");e.textContent=t,e.id="superviz-comments-styles",document.head.appendChild(e)}createComment(t,e){return Si(this,arguments,(function(t,e){var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return function*(){try{let s=yield Oa.createComment(qi.get("apiUrl"),qi.get("apiKey"),{annotationId:t,userId:n.localParticipantId,text:e});return yield Oa.createMentions({commentsId:s.uuid,participants:r.map((t=>({id:t.userId,readed:0})))}),s.mentions=r,i&&n.addComment(t,s),s}catch(s){n.logger.log("error when creating comment",s)}}()}))}addAnnotation(t){let e=[t,...this.annotations];this.element.updateAnnotations(e),this.pinAdapter.updateAnnotations(e),this.updateAnnotationList(e)}updateAnnotationList(t){this.annotations=t,this.room.emit("update-comments",t)}addComment(t,e){let n=this.annotations.find((e=>e.uuid===t));n.comments.push(e);let r=this.annotations.map((e=>e.uuid===t?n:e));this.updateAnnotationList(r),this.element.updateAnnotations(r)}fetchAnnotations(){return Si(this,null,(function*(){try{let t=yield Oa.fetchAnnotation(qi.get("apiUrl"),qi.get("apiKey"),{roomId:qi.get("roomId")});this.annotations=t,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations)}catch(Ei){this.logger.log("error when fetching annotations",Ei)}}))}waterMarkState(){return Si(this,null,(function*(){try{let t=yield Oa.fetchWaterMark(qi.get("apiUrl"),qi.get("apiKey"));this.element.waterMarkStatus(t)}catch(Ei){this.logger.log("error when fetching waterMark",Ei)}}))}participantsList(){return Si(this,null,(function*(){try{let t=(yield Oa.fetchParticipantsByGroup(this.group.id)).data;this.pinAdapter.participantsList=t,this.element.participantsList=t}catch(Ei){this.logger.log("error when fetching participantsList",Ei)}}))}};Mi();Mi();var Zd=xi(ji()),Kd=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isPinsVisible=!0,this.selectedPin=null,this.dataAttribute="data-superviz-id",this.commentsSide="left",this.temporaryPinCoordinates={},this.elementsWithDataId={},this.divWrappers=new Map,this.voidElementsWrappers=new Map,this.VOID_ELEMENTS=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr","svg","rect","ellipse"],this.animate=()=>{this.voidElementsWrappers&&(this.updatePinsPositions(),this.animateFrame=requestAnimationFrame(this.animate))},this.setCommentsMetadata=t=>{this.commentsSide=t},this.hideTemporaryPin=t=>{var e;let n=t.target,r=this.divWrappers.get(this.temporaryPinCoordinates.elementId);if(!r)return;let i=r.contains(n),s=null==(e=this.pins.get("temporary-pin"))?void 0:e.contains(n);i||s||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={})},this.resetPins=t=>{t&&"Escape"!==(null==t?void 0:t.key)||(this.resetSelectedPin(),this.resetHoveredWrapper(),this.temporaryPinCoordinates.elementId&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={}))},this.annotationSelected=t=>{let{detail:{uuid:e,newPin:n}}=t;if(!e)return;n&&this.pins.get(e).setAttribute("newPin","");let r=this.annotations.find((t=>{var e;return t.uuid===(null==(e=this.selectedPin)?void 0:e.id)}));if(this.resetPins(),(null==r?void 0:r.uuid)===e)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let i=this.pins.get(e);if(!i)return;i.setAttribute("active",""),this.selectedPin=i;let s=this.annotations.find((t=>t.uuid===e));this.selectedPin.setAttribute("elementId",JSON.parse(s.position).elementId)},this.onClick=t=>{if(!this.isActive||t.target===this.pins.get("temporary-pin"))return;let e=t.target,n=t.currentTarget;if(e!==n&&this.pins.has(e.id))return;let r=n.getAttribute("data-wrapper-id"),i=n.getBoundingClientRect(),{x:s,y:o}=this.mouseDownCoordinates,a=t.clientX-i.left,l=t.clientY-i.top,c=s-i.x,u=o-i.y;if(Math.hypot(a-c,l-u)>10)return;let{width:h,height:d}=n.getBoundingClientRect();a=100*a/h,l=100*(l-32*(n.getBoundingClientRect().width/n.offsetWidth||1))/d,this.onPinFixedObserver.publish({x:a,y:l,type:"html",elementId:r}),this.resetSelectedPin(),this.temporaryPinCoordinates=yi(vi({},this.temporaryPinCoordinates),{x:a,y:l}),this.renderTemporaryPin(r);let p=this.pins.get("temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,p.setAttribute("movedPosition",String(this.movedTemporaryPin)),document.body.dispatchEvent(new CustomEvent("unselect-annotation"))},this.onMouseDown=t=>{let{x:e,y:n}=t;this.mouseDownCoordinates={x:e,y:n}},this.handleMutationObserverChanges=t=>{t.forEach((t=>{var e;let{target:n,oldValue:r}=t,i=n.getAttribute(this.dataAttribute);if(!i&&!r||i===r)return;let s=this.dataAttributeValueFilters.some((t=>r.match(t)));if(!i&&r&&!s)return this.removeAnnotationPin("temporary-pin"),this.clearElement(r),void((null==(e=this.selectedPin)?void 0:e.getAttribute("elementId"))===r&&(document.body.dispatchEvent(new CustomEvent("unselect-annotation")),this.selectedPin=null));let o=this.dataAttributeValueFilters.some((t=>i.match(t)));(r&&this.elementsWithDataId[r]||o)&&this.clearElement(r),!o&&(this.setElementReadyToPin(n,i),this.renderAnnotationsPins())}))},this.onToggleAnnotationSidebar=t=>{let{detail:e}=t,{open:n}=e;n||(this.resetSelectedPin(),this.pins.has("temporary-pin")&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates.elementId=void 0))},this.onMouseEnter=t=>{var e;let n=t.target;if(this.hoveredWrapper=n,null==(e=n.getAttribute("data-wrapper-type"))||!e.includes("ellipse"))return void this.hoveredWrapper.style.setProperty("outline","1px solid rgb(var(--sv-primary))");let r=n.querySelector("ellipse");r.setAttribute("stroke","rgb(var(--sv-primary))"),r.setAttribute("stroke-width","1")},this.onMouseLeave=t=>{var e;let n=t.target;if(this.hoveredWrapper=n,null==(e=n.getAttribute("data-wrapper-type"))||!e.includes("ellipse"))return void this.hoveredWrapper.style.setProperty("outline","");let r=n.querySelector("ellipse");r.removeAttribute("stroke"),r.removeAttribute("stroke-width")},this.logger=new Ia("@superviz/sdk/comments-component/container-pin-adapter"),this.container=document.getElementById(t),!this.container){let e=`Element with id ${t} not found`;throw this.logger.log(e),new Error(e)}if("object"!=typeof e)throw new Error("Second argument of the HTMLPin constructor must be an object");let{dataAttributeName:n,dataAttributeValueFilters:r}=e;if(""===n)throw new Error("dataAttributeName must be a non-empty string");if(null===n)throw new Error("dataAttributeName cannot be null");if(void 0!==n&&"string"!=typeof n)throw new Error("dataAttributeName must be a non-empty string");this.dataAttribute=n||this.dataAttribute,this.dataAttributeValueFilters=r||[],this.isActive=!1,this.prepareElements(),this.mutationObserver=new MutationObserver(this.handleMutationObserverChanges),this.observeContainer(),this.pins=new Map,this.onPinFixedObserver=new La({logger:this.logger}),this.annotations=[],document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("keyup",this.resetPins),this.voidElementsWrappers.size&&(this.animateFrame=requestAnimationFrame(this.animate))}destroy(){var t;this.logger.log("Destroying HTML Pin Adapter for Comments"),this.removeListeners(),this.removeObservers(),this.divWrappers.forEach((t=>t.remove())),this.divWrappers.clear(),this.pins.forEach((t=>t.remove())),this.pins.clear(),this.divWrappers=void 0,this.pins=void 0,this.elementsWithDataId=void 0,this.logger=void 0,this.onPinFixedObserver.destroy(),this.onPinFixedObserver=void 0,this.container=void 0,this.voidElementsWrappers.clear(),this.voidElementsWrappers=void 0,this.annotations=[],null==(t=this.svgWrappers)||t.remove(),this.svgWrappers=void 0,document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),cancelAnimationFrame(this.animateFrame)}addElementListeners(t){this.divWrappers.get(t).addEventListener("click",this.onClick,!0),this.divWrappers.get(t).addEventListener("mousedown",this.onMouseDown),this.divWrappers.get(t).addEventListener("mouseenter",this.onMouseEnter),this.divWrappers.get(t).addEventListener("mouseleave",this.onMouseLeave)}removeElementListeners(t){this.divWrappers.get(t).removeEventListener("click",this.onClick,!0),this.divWrappers.get(t).removeEventListener("mousedown",this.onMouseDown),this.divWrappers.get(t).removeEventListener("mouseenter",this.onMouseEnter),this.divWrappers.get(t).removeEventListener("mouseleave",this.onMouseLeave)}set participantsList(t){this.participants=t}removeObservers(){this.mutationObserver.disconnect(),this.mutationObserver=void 0}addListeners(){this.divWrappers.forEach(((t,e)=>this.addElementListeners(e))),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.divWrappers.forEach(((t,e)=>this.removeElementListeners(e))),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("click",this.hideTemporaryPin)}observeContainer(){this.mutationObserver.observe(this.container,{subtree:!0,attributes:!0,attributeFilter:[this.dataAttribute],attributeOldValue:!0})}prepareElements(){this.container.querySelectorAll(`[${this.dataAttribute}]`).forEach((t=>{let e=t.getAttribute(this.dataAttribute);this.dataAttributeValueFilters.some((t=>e.match(t)))||this.setElementReadyToPin(t,e)}))}addAllCursors(){this.divWrappers.forEach(((t,e)=>{this.addCursor(t,e)}))}removeAddCursor(){this.divWrappers.forEach(((t,e)=>{let n=t,r=t.getAttribute("data-wrapper-type");if(r){let t=r.split("-")[1];n=this.divWrappers.get(e).querySelector(t)}n.style.setProperty("cursor","default"),n.style.setProperty("pointer-events","none")}))}setPinsVisibility(t){this.isPinsVisible=t,this.isPinsVisible&&this.renderAnnotationsPins(),this.removeAnnotationsPins()}removeAnnotationPin(t){let e=this.pins.get(t);!e&&"temporary-pin"===t||(e&&(e.remove(),this.pins.delete(t)),"temporary-pin"!==t&&(this.annotations=this.annotations.filter((e=>e.uuid!==t))))}updateAnnotations(t){this.logger.log("updateAnnotations",t),this.annotations=t,this.isPinsVisible&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}setActive(t){if(this.isActive!==t){if(this.isActive=t,this.isActive)return this.addListeners(),this.addAllCursors(),void this.prepareElements();this.resetPins(),this.removeListeners(),this.removeAddCursor()}}renderTemporaryPin(t){var e,n;(e=this.temporaryPinCoordinates).elementId||(e.elementId=t);let r=this.pins.get("temporary-pin");if(t&&t!==this.temporaryPinCoordinates.elementId&&(this.pins.get("temporary-pin").remove(),this.pins.delete("temporary-pin"),this.temporaryPinCoordinates.elementId=t,r=null),!r){let e=null==(n=this.elementsWithDataId[t])?void 0:n.getBoundingClientRect();r=document.createElement("superviz-comments-annotation-pin"),r.id="superviz-temporary-pin",r.setAttribute("type","add"),r.setAttribute("showInput",""),r.setAttribute("containerSides",JSON.stringify(e)),r.setAttribute("commentsSide",this.commentsSide),r.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),r.setAttribute("annotation",JSON.stringify({})),r.setAttribute("participantsList",JSON.stringify(this.participants)),r.setAttribute("keepPositionRatio",""),r.setAttributeNode(document.createAttribute("active")),this.addTemporaryPinToElement(t,r)}let{x:i,y:s}=this.temporaryPinCoordinates;r.setAttribute("position",JSON.stringify({x:i,y:s})),this.pins.set("temporary-pin",r)}renderAnnotationsPins(){this.annotations.length?this.annotations.forEach((t=>{if(t.resolved)return;let{x:e,y:n,elementId:r,type:i}=JSON.parse(t.position);if("html"!==i||this.pins.has(t.uuid)||!this.elementsWithDataId[r])return;let s=this.divWrappers.get(r);if(!s)return;let o=this.createPin(t,e,n);s.appendChild(o),this.pins.set(t.uuid,o)})):this.removeAnnotationsPins()}updatePinsPositions(){this.voidElementsWrappers.forEach(((t,e)=>{let n=JSON.stringify(t.getBoundingClientRect()),r=this.elementsWithDataId[e].getBoundingClientRect();"ellipse"===this.elementsWithDataId[e].tagName.toLowerCase()&&(r=this.elementsWithDataId[e].viewportElement.getBoundingClientRect()),!(0,Zd.isEqual)(JSON.stringify(r),n)&&(t.style.setProperty("top",`${r.top}px`),t.style.setProperty("left",`${r.left}px`),t.style.setProperty("width",`${r.width}px`),t.style.setProperty("height",`${r.height}px`))}))}clearElement(t){if(!this.elementsWithDataId[t])return;let e=this.divWrappers.get(t);if(e){let t=e.children,{length:n}=t;for(let e=0;e<n;++e){let n=t.item(e);this.pins.delete(n.id)}e.remove()}this.voidElementsWrappers.delete(t),this.removeElementListeners(t),this.divWrappers.delete(t),this.elementsWithDataId[t]=void 0,this.voidElementsWrappers.size||(cancelAnimationFrame(this.animateFrame),this.animateFrame=void 0)}resetSelectedPin(){this.selectedPin&&(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}resetHoveredWrapper(){this.hoveredWrapper&&this.onMouseLeave({target:this.hoveredWrapper})}removeAnnotationsPins(){this.pins.forEach((t=>{t.remove()})),this.pins.clear()}setElementReadyToPin(t,e){if(!this.elementsWithDataId[e]){if(this.elementsWithDataId[e]=t,!this.divWrappers.get(e)){let n=this.createWrapper(t,e);this.divWrappers.set(e,n)}!this.isActive||!this.isPinsVisible||(this.addCursor(this.divWrappers.get(e),e),this.addElementListeners(e))}}handleSvgElement(t,e){let n=t.viewportElement;if(void 0===n)return;if("svg"===t.tagName.toLowerCase()){let n=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return n.setAttribute("height","100%"),n.setAttribute("width","100%"),n.style.setProperty("overflow","visible"),n.appendChild(e),t.appendChild(n),t.style.setProperty("overflow","visible"),e}let r=t.tagName.toLowerCase(),i="ellipse"===r,s="rect"===r;if(!i&&!s)return;let o,a,l,c,u=document.createElementNS("http://www.w3.org/2000/svg","svg"),h=document.createElementNS("http://www.w3.org/2000/svg",r);if(s){let e=t;e.getAttribute("x"),e.getAttribute("y"),o=e.getAttribute("width"),a=e.getAttribute("height"),l=e.getAttribute("rx"),c=e.getAttribute("ry"),h.setAttribute("fill","transparent"),h.setAttribute("stroke","transparent"),h.setAttribute("x","0"),h.setAttribute("y","0"),h.setAttribute("rx",l),h.setAttribute("ry",c)}if(i){let e=t.getAttribute("cx"),r=t.getAttribute("cy");l=t.getAttribute("rx"),c=t.getAttribute("ry");let{width:i,height:s}=n.getBoundingClientRect();o=`${i}px`,a=`${s}px`,h.setAttribute("fill","transparent"),h.setAttribute("stroke","transparent"),h.setAttribute("cx",e),h.setAttribute("cy",r),h.setAttribute("rx",l),h.setAttribute("ry",c)}return h.setAttribute("height",a),h.setAttribute("width",o),u.setAttribute("height",a),u.setAttribute("width",o),u.appendChild(h),e.appendChild(u),t.style.setProperty("overflow","visible"),e.setAttribute("data-wrapper-type",`svg-${r}`),e}addTemporaryPinToElement(t,e){if(!this.elementsWithDataId[t])return;let n=this.divWrappers.get(t);n&&n.appendChild(e)}createPin(t,e,n){let r=document.createElement("superviz-comments-annotation-pin");return r.setAttribute("type","show"),r.setAttribute("annotation",JSON.stringify(t)),r.setAttribute("position",JSON.stringify({x:e,y:n})),r.setAttribute("keepPositionRatio",""),r.setAttribute("participantsList",JSON.stringify(this.participants)),r.id=t.uuid,r}addCursor(t,e){let n=t,r=t.getAttribute("data-wrapper-type");if(r){let t=r.split("-")[1];n=this.divWrappers.get(e).querySelector(t)}n.style.setProperty("cursor",'url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer'),n.style.setProperty("pointer-events","auto")}createWrapper(t,e){var n;let r=`superviz-id-${e}`;if(this.divWrappers.get(e))return;let i=t.getBoundingClientRect(),s=document.createElement("div");s.setAttribute("data-wrapper-id",e),s.id=r,s.style.position="absolute",s.style.pointerEvents="none",s.style.transform="translateX(0) translateY(0) scale(1)",s.style.cursor="default",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.pointerEvents="none";let o=window.getComputedStyle(t).getPropertyValue("border-radius");if(s.style.borderRadius=o,!this.VOID_ELEMENTS.includes(this.elementsWithDataId[e].tagName.toLowerCase()))return this.elementsWithDataId[e].appendChild(s),this.setPositionNotStatic(this.elementsWithDataId[e]),s;s=null!=(n=this.handleSvgElement(t,s))?n:s,s.style.position="fixed",s.style.top=`${i.top}px`,s.style.left=`${i.left}px`,s.style.width=`${i.width}px`,s.style.height=`${i.height}px`;let a=this.elementsWithDataId[e].parentElement;return(!a||t.viewportElement)&&(a=document.body),this.setPositionNotStatic(a),a.appendChild(s),this.voidElementsWrappers.set(e,s),this.animateFrame||(this.animateFrame=requestAnimationFrame(this.animate)),s}setPositionNotStatic(t){let{position:e}=window.getComputedStyle(t);"static"===e&&t.style.setProperty("position","relative")}};Mi(),Mi();var Qd=xi(Ea()),tp=class{constructor(){this.browser=Qd.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Qd.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Qd.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Qd.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Qd.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Qd.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Qd.default.PLATFORMS_MAP.mobile)||this.browser.is(Qd.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Qd.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};Mi();var ep=class{constructor(){this.updateMeetingConnectionStatus=t=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=t,this.connectionStatusObserver.publish(t),this.logger.log("CONNECTION STATUS CHANGE",t)},this.onUpdateBrowserOnlineStatus=t=>{let{type:e}=t;"online"!==e?this.updateMeetingConnectionStatus(4):this.updateMeetingConnectionStatus(1)},this.logger=new Ia("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new La({logger:this.logger})}addListeners(){typeof window<"u"&&(window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus))}removeListeners(){typeof window<"u"&&(window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus))}};Mi(),Mi();var np=class{constructor(t,e,n){var r=this;this.myParticipant={},this.localRoomProperties=null,this.drawingData=null,this.state=0,this.MESSAGE_SIZE_LIMIT=6e4,this.useStore=oa.bind(this),this.join=()=>{this.room.presence.on(nl.LEAVE,this.onParticipantLeave),this.room.presence.on(nl.JOINED_ROOM,this.onPresenceEnter),this.enableSync&&(this.room.on("update",this.updateLocalRoomState),this.drawingRoom.presence.on(nl.UPDATE,this.updateDrawing))},this.updateMyProperties=t=>{let e=t??{};this.isMessageTooBig(e)||this.left||!this.enableSync||this.isSyncFrozen||(void 0===e.avatar&&delete e.avatar,this.myParticipant=vi(vi({},this.myParticipant),e),this.room.presence.update(this.myParticipant),this.logger.log("REALTIME","updating my properties",this.myParticipant))},this.isMessageTooBig=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.MESSAGE_SIZE_LIMIT,n=JSON.stringify(t);return(new TextEncoder).encode(n).length>e&&(r.logger.log("Message too long, the message limit size is 60kb."),!0)},this.updateRoomProperties=t=>{if(this.isMessageTooBig(t)||this.isSyncFrozen||this.left)return;let e=vi(vi({},this.localRoomProperties),t);this.localRoomProperties=e,this.room.emit("update",e)},this.updateDrawingProperties=t=>{this.isMessageTooBig(t)||this.isSyncFrozen||this.left||(this.drawingData=vi(vi({},this.drawingData),t),this.drawingRoom.presence.update(this.drawingData))},this.setHost=t=>{this.updateRoomProperties({hostClientId:t})},this.setKickParticipant=t=>{if(!t)return;let{participants:e}=oa("global-store"),n=e.value[t];this.updateRoomProperties({kickParticipant:n})},this.initializeRoomProperties=()=>{let t={isGridModeEnabled:!1,hostClientId:null,followParticipantId:null,gather:!1,transcript:"transcript.stop",kickParticipant:null};this.localRoomProperties=t,this.updateRoomProperties(t)},this.onParticipantLeave=t=>{var e;t.id===this.myParticipant.id&&(this.left=!0),t.id===(null==(e=this.localRoomProperties)?void 0:e.followParticipantId)&&this.setFollowParticipant()},this.start=()=>Si(this,null,(function*(){this.started||(this.started=!0,this.room.isJoined||(this.logger.log("room state service - not joined room yet"),setTimeout((()=>{this.logger.log("room state service - retrying"),this.start()}),2e3)),this.localRoomProperties=yield this.fetchRoomProperties(),this.localRoomProperties?this.updateLocalRoomState({data:this.localRoomProperties}):this.initializeRoomProperties(),this.publishStateUpdate(4),this.logger.log("REALTIME","Joined realtime room"))})),this.onPresenceEnter=()=>{this.updateMyProperties()},this.updateLocalRoomState=t=>Si(this,[t],(function(t){var e=this;let{data:n}=t;return function*(){e.logger.log("REALTIME","Room update received",n),e.localRoomProperties=Object.assign({},e.localRoomProperties,n);let{followParticipantId:t,gather:r,hostId:i,isGridModeEnabled:s,transcript:o}=e.useStore("video-store");t.publish(n.followParticipantId),r.publish(n.gather),i.publish(n.hostClientId),s.publish(n.isGridModeEnabled),o.publish(n.transcript),n.kickParticipant&&n.kickParticipant.id===e.myParticipant.id&&(e.updateRoomProperties({kickParticipant:null}),e.kickParticipantObserver.publish(e.myParticipant.id))}()})),this.updateDrawing=t=>{if(t.id===this.myParticipant.id)return;let{drawing:e}=this.useStore("video-store");e.publish(t.data)},this.freezeSync=t=>{this.isSyncFrozen=t,t?this.destroy():this.join()},this.room=t,this.drawingRoom=e,this.logger=n,this.kickParticipantObserver=new La({logger:this.logger});let{localParticipant:i,participants:s}=this.useStore("global-store");i.subscribe((t=>{this.enableSync="audience"!==t.type,this.myParticipant=vi(vi({},this.myParticipant),t)})),s.subscribe(),this.join()}setGridMode(t){this.updateRoomProperties({isGridModeEnabled:t})}setDrawing(t){this.updateDrawingProperties(t)}setTranscript(t){this.updateRoomProperties({transcript:t})}fetchRoomProperties(){return Si(this,null,(function*(){if((yield new Promise((t=>{this.room.presence.get((e=>{e||t(0),t(e.length)}))})))<=1)return null;let t=yield new Promise(((t,e)=>{this.room.history((n=>{n||e(n),n.events.length||t(null);let r=n.events.pop();t(r)}))})),e=(null==t?void 0:t.timestamp)<Date.now()-36e5;return null==t||!t.data||e?null:t.data}))}publishStateUpdate(t){if(this.state===t)return;this.state=t,this.logger.log("REALTIME",`Realtime state did change. New state: ${Lo[this.state]}`);let{meetingState:e}=this.useStore("video-store");e.publish(this.state)}setFollowParticipant(t){this.updateRoomProperties({followParticipantId:t})}setGather(t){this.updateRoomProperties({gather:t})}destroy(){this.room.presence.off(nl.LEAVE),this.room.presence.off(nl.JOINED_ROOM),this.drawingRoom.presence.off(nl.UPDATE),this.room.off("update",this.updateLocalRoomState)}};Mi(),Mi();var rp=class{build(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=document.querySelector(`#${t}`),o=new URL(e);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(r).forEach((t=>{let[e,n]=t;o.searchParams.set(e,n)})),Object.entries(i).forEach((t=>{let[e,n]=t;this.element.setAttribute(e,n)})),this.element.src=o.toString(),this.element.id=n,s.appendChild(this.element),this.wrapperId=t}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let t=document.querySelector(`#${this.wrapperId}`);t&&t.querySelector(`#${this.element.id}`)&&t.removeChild(this.element),this.wrapperId=null,this.element=null}};Mi();var ip=class{constructor(t){var e=this;this.observers={},this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"],this.originBlockList=["https://sketchfab.com"],this.publish=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.logger.log("MessageBridge","Posting message to frame",t,n),e.contentWindow.postMessage({type:t,data:n},e.allowedOrigins)},this.listen=(t,e)=>{this.observers[t]||(this.observers[t]=new La({logger:this.logger})),this.observers[t].subscribe(e)},this.onReceiveMessage=t=>{let{type:e,data:n,source:r}=t.data;if(this.sourceBlockList.includes(r)||this.originBlockList.includes(t.origin))return;let i=!!e,s=!this.domains.length||this.domains.includes(t.origin),o=this.observers.hasOwnProperty(e);this.logger.log("MessageBridge",`Message received -\n        TYPE: ${t.type}\n        ORIGIN: ${t.origin}\n        DATA: ${JSON.stringify(t.data)} `),i&&s&&o?this.observers[e].publish(n):this.logger.log("MessageBridge","Message discarded")};let{contentWindow:n,domains:r=[],allowedOrigins:i="*",sourceBlockList:s=[],logger:o}=t;if(this.logger=o,this.domains=r,this.allowedOrigins=i,this.sourceBlockList.push(...s),typeof window>"u")throw new Error("MessageBridge: window is undefined");this.contentWindow=n,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach((t=>{let[e,n]=t;n.reset(),delete this.observers[e]})),typeof window<"u"&&window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}},sp="sv-video-frame",op=class{constructor(t){var e,n,r,i;this.logger=new Ia("@superviz/sdk/video-conference-manager"),this.frameStateObserver=new La({logger:this.logger}),this.frameSizeObserver=new La({logger:this.logger}),this.waitingForHostObserver=new La({logger:this.logger}),this.realtimeEventsObserver=new La({logger:this.logger}),this.sameAccountErrorObserver=new La({logger:this.logger}),this.devicesObserver=new La({logger:this.logger}),this.meetingStateObserver=new La({logger:this.logger}),this.meetingConnectionObserver=new La({logger:this.logger}),this.participantJoinedObserver=new La({logger:this.logger}),this.participantLeftObserver=new La({logger:this.logger}),this.participantListObserver=new La({logger:this.logger}),this.frameState=0,this.layoutModalsAndCamerasConfig=(t,e)=>{let n=t,r=e;return["left","right","bottom","top"].includes(r)||(r="right"),["left","right","center"].includes(n)||(n="right"),this.browserService.isMobileDevice?(r="bottom",{layoutPosition:n,camerasPosition:r}):("left"===n&&"right"===r&&(n="right"),"right"===n&&"left"===r&&(n="left"),{layoutPosition:n,camerasPosition:r})},this.onFrameLoad=()=>{this.messageBridge=new ip({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors(),this.setCallbacks()},this.setFrameOffset=t=>{let e=t??{};["top","bottom","left","right"].forEach((t=>{Object.keys(e).includes(t)||(e[t]=0)})),this.frameOffset=e},this.setCustomColors=()=>{this.customColors&&this.messageBridge.publish("frame.color-list-update",this.customColors),this.styles&&this.messageBridge.publish("frame.styles-update",this.styles)},this.setCallbacks=()=>{if(!this.callbacks)return;let t={onToggleMicrophone:!!this.callbacks.onToggleMicrophone,onToggleCam:!!this.callbacks.onToggleCam,onToggleRecording:!!this.callbacks.onToggleRecording,onToggleChat:!!this.callbacks.onToggleChat,onToggleScreenShare:!!this.callbacks.onToggleScreenShare,onClickHangup:!!this.callbacks.onClickHangup,onToggleMeetingSetup:!!this.callbacks.onToggleMeetingSetup};this.messageBridge.listen("callback-called",(t=>{var e,n;null==(n=(e=this.callbacks)[t])||n.call(e)})),this.messageBridge.publish("frame.callbacks-update",JSON.stringify(t))},this.setFrameStyle=t=>{let e=document.createElement("style"),{bottom:n,left:r,right:i,top:s}=this.frameOffset;e.innerHTML=`\n      :root {\n        --superviz-offset-top: ${s}px;\n        --superviz-offset-right: ${i}px;\n        --superviz-offset-left: ${r}px;\n        --superviz-offset-bottom: ${n}px;\n      }     \n    `,document.head.appendChild(e),this.browserService.isMobileDevice?this.bricklayer.element.classList.add("sv-video-frame--bottom"):this.bricklayer.element.classList.add(`sv-video-frame--${t}`)},this.onFrameDimensionsUpdate=t=>{let{width:e,height:n}=t;if(typeof window>"u")return;let r=document.getElementById(sp),{bottom:i,right:s,left:o,top:a}=this.frameOffset,l=`${e}px`,c=`${n+(this.isWaterMarkEnabled?40:0)}px`;(e>=window.innerWidth||this.isHorizontalCameraEnabled)&&(l=`calc(100% - ${s}px - ${o}px)`),n>=window.innerHeight&&(c=`calc(100% - ${a}px - ${i}px)`),r.style.width=l,r.style.height=c,this.frameSizeObserver.publish({width:r.offsetWidth,height:r.offsetHeight})},this.onWindowResize=()=>{let{top:t,bottom:e,right:n,left:r}=this.frameOffset,{innerHeight:i,innerWidth:s}=window,o=i-t-e,a=s-n-r;this.messageBridge&&this.messageBridge.publish("frame.parent-window-size-update",{height:o,width:a})},this.updateFrameLocale=()=>{var t,e;if(!this.frameLocale||(null==(t=this.frameLocale)||!t.language)&&null!=(e=this.frameLocale)&&e.locales)return;let{language:n,locales:r}=this.frameLocale,i=["en",...r.map((t=>null==t?void 0:t.language))];if(n&&!i.includes(n))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)},this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)},this.onParticipantJoined=t=>{this.participantJoinedObserver.publish(t)},this.onParticipantLeft=t=>{this.participantLeftObserver.publish(t)},this.onMeetingHostChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:t})},this.onMeetingKickParticipant=t=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:t})},this.onFollowParticipantDidChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:t})},this.onGoToDidChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:t})},this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})},this.onGridModeChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:t})},this.onDrawingChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:t})},this.onTranscriptChange=t=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:t})},this.onSameAccountError=t=>{this.sameAccountErrorObserver.publish(t)},this.onDevicesChange=t=>{this.devicesObserver.publish(t)},this.meetingStateUpdate=t=>{this.meetingStateObserver.publish(t)},this.onConnectionStatusChange=t=>{this.meetingConnectionObserver.publish(t)},this.onWaitingForHostDidChange=t=>{this.waitingForHostObserver.publish(t)},this.onParticipantListUpdate=t=>{this.participantListObserver.publish(t)};let{language:s,canUseCams:o,canUseChat:a,canUseScreenshare:l,canUseDefaultAvatars:c,canUseFollow:u,canUseGoTo:h,canUseGather:d,canShowAudienceList:p,canUseDefaultToolbar:f,canUseRecording:m,browserService:g,offset:v,locales:y,avatars:_,customColors:b,styles:x,waterMark:w,layoutPosition:S,camerasPosition:M,skipMeetingSettings:E,devices:T,layoutMode:A,collaborationMode:C,callbacks:P}=t;this.browserService=g;let I=this.layoutModalsAndCamerasConfig(S,M),R=document.createElement("div");this.frameConfig={apiKey:qi.get("apiKey"),apiUrl:qi.get("apiUrl"),debug:qi.get("debug"),roomId:qi.get("roomId"),limits:qi.get("limits"),collaborationMode:C,canUseFollow:u,canUseGoTo:h,canUseCams:o,canUseChat:a,canUseGather:d,canUseScreenshare:l,canUseDefaultAvatars:c,canUseRecording:m,canShowAudienceList:p,camerasPosition:null!=(e=I.camerasPosition)?e:"right",canUseDefaultToolbar:f,devices:{audioInput:null==(n=null==T?void 0:T.audioInput)||n,audioOutput:null==(r=null==T?void 0:T.audioOutput)||r,videoInput:null==(i=null==T?void 0:T.videoInput)||i},waterMark:w,layoutMode:A,skipMeetingSettings:E,layoutPosition:I.layoutPosition,transcriptLangs:qi.get("features.transcriptLangs")},this.customColors=b,this.callbacks=P,this.styles=x,R.classList.add("sv_video_wrapper"),R.id="sv-video-wrapper",document.body.appendChild(R),this.updateFrameState(1),this.bricklayer=new rp,this.bricklayer.build(R.id,qi.get("conferenceLayerUrl"),sp,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(v),this.setFrameStyle(I.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:s,locales:y},this.meetingAvatars=_,typeof window<"u"&&(window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize))}get isWaterMarkEnabled(){return!this.browserService.isMobileDevice&&this.frameConfig.waterMark}get isHorizontalCameraEnabled(){return!this.browserService.isMobileDevice&&["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(t){t!==this.frameState&&(this.frameState=t,this.frameStateObserver.publish(this.frameState));this.meetingStateUpdate({1:6,2:7,0:8}[t])}start(t){this.messageBridge.publish("meeting.start",yi(vi({},t),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var t,e,n,r,i,s,o,a,l,c;null==(t=this.messageBridge)||t.destroy(),null==(e=this.bricklayer)||e.destroy(),null==(n=this.frameSizeObserver)||n.destroy(),null==(r=this.realtimeEventsObserver)||r.destroy(),null==(i=this.sameAccountErrorObserver)||i.destroy(),null==(s=this.devicesObserver)||s.destroy(),null==(o=this.meetingStateObserver)||o.destroy(),null==(a=this.meetingConnectionObserver)||a.destroy(),null==(l=this.participantJoinedObserver)||l.destroy(),null==(c=this.participantLeftObserver)||c.destroy(),this.bricklayer=null,this.frameState=null,typeof window<"u"&&(window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("orientationchange",this.onWindowResize))}publishMessageToFrame(t,e){this.messageBridge&&this.messageBridge.publish(t,e)}};Mi();var ap=new class{constructor(){this.logger=new Ia("@superviz/sdk/core-bridge"),this.logger.log("CoreBridge initialized")}updateLocalParticipant(t){this.logger.log("updateLocalParticipant",t);let{localParticipant:e}=oa("core-store");e.publish(t)}updateParticipantsList(t){this.logger.log("updateParticipantsList",t);let{participants:e}=oa("core-store");e.publish(t)}},lp=null;Mi(),Mi();var cp=xi(ji()),up=class extends Jd{constructor(t,e){var n;if(super(),this.camera={x:0,y:0,screen:{width:0,height:0},scale:1},this.subscribeToRealtimeEvents=()=>{this.logger.log("presence-mouse component @ subscribe to realtime events"),this.room.presence.on(nl.JOINED_ROOM,this.onPresenceJoinedRoom),this.room.presence.on(nl.LEAVE,this.onPresenceLeftRoom),this.room.presence.on(nl.UPDATE,this.onPresenceUpdate)},this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.room.presence.off(nl.JOINED_ROOM),this.room.presence.off(nl.LEAVE),this.room.presence.off(nl.UPDATE)},this.setParticipantPrivate=t=>{this.isPrivate=t,this.room.presence.update({visible:!t})},this.onPresenceJoinedRoom=t=>{t.id===this.localParticipant.id&&this.room.presence.update(this.localParticipant)},this.onPresenceLeftRoom=t=>{this.removePresenceMouseParticipant(t.id)},this.onPresenceUpdate=t=>{if(this.following&&this.presences.get(this.following)&&this.goToMouse(this.following),t.id===this.localParticipant.id)return;let e=t.data;this.following&&e.id!==this.following&&this.presences.has(e.id)?this.removePresenceMouseParticipant(e.id):this.presences.set(e.id,e)},this.animate=()=>{this.getCamera(),this.renderDivWrapper(),this.updateParticipantsMouses(),requestAnimationFrame(this.animate)},this.goToMouse=t=>{let e=this.presences.get(t);if(null==e||!e.camera)return;let n=e.camera.x,r=e.camera.y,i=this.divWrapper.clientHeight/e.camera.screen.height,s=Math.min(i,1),o=this.divWrapper.clientWidth/e.camera.screen.width,a=Math.min(o,1);this.goToMouseCallback&&this.goToMouseCallback({x:n,y:r,scaleX:s,scaleY:a})},this.onMyParticipantMouseMove=(0,cp.throttle)((t=>{let e=this.canvas.getContext("2d"),n=this.canvas.getBoundingClientRect(),r=t.x-n.left,i=t.y-n.top,s=(null==e?void 0:e.getTransform()).inverse(),o=new DOMPoint(r,i).matrixTransform(s),a={x:o.x,y:o.y};this.room.presence.update(yi(vi(vi({},this.localParticipant),a),{visible:!this.isPrivate,camera:this.camera}))}),30),this.onMyParticipantMouseOut=t=>{let{x:e,y:n,width:r,height:i}=this.canvas.getBoundingClientRect();t.x>0&&t.y>0&&t.x<e+r&&t.y<n+i||this.room.presence.update({visible:!1})},this.updateParticipantsMouses=()=>{this.presences.forEach((t=>{null==t||!t.visible||this.following&&this.following!==t.id?this.removePresenceMouseParticipant(t.id):this.renderPresenceMouses(t)}))},this.getCamera=()=>{var t;let e=null==(t=this.canvas)?void 0:t.getContext("2d"),n=null==e?void 0:e.getTransform(),r=null==n?void 0:n.e,i=null==n?void 0:n.f,s=null==n?void 0:n.a;this.camera={screen:{width:this.divWrapper.clientHeight,height:this.divWrapper.clientWidth},x:r,y:i,scale:s}},this.renderPresenceMouses=t=>{var e,n,r,i,s;let o=document.getElementById(`mouse-${t.id}`);o||(o=this.createMouseElement(t));let a=document.getElementById(`mouse-${t.id}`),l=document.getElementById(`mouse-${t.id}`);if(!a||!l)return;let c=a.getElementsByClassName("mouse-user-name")[0],u=l.getElementsByClassName("pointer-mouse")[0];u&&(u.style.backgroundImage=`url(https://production.cdn.superviz.com/static/mouse-pointers/${null==(e=t.slot)?void 0:e.colorName}.svg)`),c&&(c.style.color=null!=(r=null==(n=t.slot)?void 0:n.textColor)?r:"#fff",c.style.backgroundColor=null!=(s=null==(i=t.slot)?void 0:i.color)?s:Ui.gray,c.innerHTML=t.name);let{x:h,y:d}=t,p=this.canvas.getContext("2d"),f=null==p?void 0:p.getTransform(),m=null==f?void 0:f.e,g=null==f?void 0:f.f,v=h*f.a+m,y=d*f.d+g,_=this.divWrapper.clientWidth>v&&this.divWrapper.clientHeight>y&&t.visible;o.style.opacity=_?"1":"0",o.style.left=`${v}px`,o.style.top=`${y}px`},this.followMouse=t=>{this.following=t,this.goToMouse(t)},this.name="presence",this.logger=new Ia("@superviz/sdk/presence"),this.canvas=document.getElementById(t),this.presences=new Map,!this.canvas){let e=`Canvas with id ${t} not found`;throw this.logger.log(e),new Error(e)}this.divWrapper=this.renderDivWrapper(),this.animateFrame=requestAnimationFrame(this.animate),this.goToMouseCallback=null==(n=null==e?void 0:e.callbacks)?void 0:n.onGoToPresence;let{localParticipant:r}=this.useStore("global-store");r.subscribe(),this.getCamera()}start(){this.logger.log("presence-mouse component @ start"),this.canvas.addEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.addEventListener("mouseout",this.onMyParticipantMouseOut),this.eventBus.subscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.subscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.subscribe("realtime.private-mode",this.setParticipantPrivate),this.subscribeToRealtimeEvents()}destroy(){this.logger.log("presence-mouse component @ destroy"),this.eventBus.unsubscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.unsubscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.unsubscribe("realtime.private-mode",this.setParticipantPrivate),this.unsubscribeFromRealtimeEvents(),cancelAnimationFrame(this.animateFrame),this.canvas.removeEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.removeEventListener("mouseout",this.onMyParticipantMouseOut),this.divWrapper.remove()}renderDivWrapper(){let t=this.canvas.getBoundingClientRect(),e=document.getElementById("superviz-presence-mouse-wrapper");return e||(e=document.createElement("div"),e.id="superviz-presence-mouse-wrapper",this.canvas.parentElement.style.position="relative",this.canvas.parentElement.appendChild(e)),e.style.position="fixed",e.style.top=`${t.top}px`,e.style.left=`${t.left}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden",e.style.zIndex="2",e}removePresenceMouseParticipant(t){let e=document.getElementById(`mouse-${t}`);e&&(e.remove(),this.presences.delete(t))}createMouseElement(t){let e=document.createElement("div");e.setAttribute("id",`mouse-${t.id}`),e.setAttribute("class","mouse-follower");let n=document.createElement("div");n.setAttribute("class","pointer-mouse");let r=document.createElement("div");return r.setAttribute("class","mouse-user-name"),r.innerHTML=t.name,e.appendChild(n),e.appendChild(r),e.style.left="0px",e.style.top="0px",this.divWrapper.appendChild(e),e}transform(t){console.warn("[SuperViz] - transform method not available when container is a canvas element.")}};Mi();var hp=xi(ji());Mi();var dp=(t=>(t.AREA="area",t.BASE="base",t.BR="br",t.COL="col",t.EMBED="embed",t.HR="hr",t.IMG="img",t.INPUT="input",t.LINK="link",t.META="meta",t.PARAM="param",t.SOURCE="source",t.TRACK="track",t.WBR="wbr",t))(dp||{}),pp=(t=>(t.RECT="rect",t.ELLIPSE="ellipse",t.SVG="svg",t))(pp||{}),fp=class extends Jd{constructor(t,e){var n;if(super(),this.presences=new Map,this.mouses=new Map,this.transformation={translate:{x:0,y:0},scale:1},this.onMyParticipantMouseMove=t=>{if(this.isPrivate)return;let e=t.currentTarget,{left:n,top:r}=e.getBoundingClientRect(),i=(t.x-n-this.transformation.translate.x)/this.transformation.scale,s=(t.y-r-this.transformation.translate.y)/this.transformation.scale;this.room.presence.update(yi(vi({},this.localParticipant),{x:i,y:s,visible:!0,camera:this.camera}))},this.onMyParticipantMouseLeave=t=>{if(typeof window>"u")return;let{left:e,top:n,right:r,bottom:i}=this.container.getBoundingClientRect(),s=t.x>e&&t.y>n&&t.x<r&&t.y<i,o=t.x>0&&t.y>0&&t.x<window.innerWidth&&t.y<window.innerHeight;s&&o||this.room.presence.update({visible:!1})},this.goToMouse=t=>{let e=this.mouses.get(t),n=this.presences.get(t);if(n){if(this.goToPresenceCallback){let t=this.camera.screen.width/n.camera.screen.width,e=this.camera.screen.height/n.camera.screen.height,r=n.camera.x*t,i=n.camera.y*e,s=n.camera.scale*t,o=n.camera.scale*e;return void this.goToPresenceCallback({x:r,y:i,scaleX:s,scaleY:o})}e&&e.scrollIntoView({block:"center",inline:"center",behavior:"smooth"})}},this.followMouse=t=>{this.userBeingFollowedId=t,this.goToMouse(t)},this.setParticipantPrivate=t=>{this.isPrivate=t,this.room.presence.update({visible:!t})},this.onPresenceJoinedRoom=t=>{t.id===this.localParticipant.id&&this.room.presence.update(this.localParticipant)},this.onPresenceLeftRoom=t=>{this.removePresenceMouseParticipant(t.id)},this.onPresenceUpdate=t=>{if(t.id===this.localParticipant.id)return;let e=t.data;this.userBeingFollowedId&&e.id!==this.userBeingFollowedId&&this.presences.has(e.id)?this.removePresenceMouseParticipant(e.id):(this.presences.set(e.id,e),this.animate(),this.updateParticipantsMouses())},this.animate=()=>{dp[this.containerTagname]&&this.updateVoidElementWrapper(),pp[this.containerTagname]&&this.updateSVGElementWrapper(),this.animationFrame=requestAnimationFrame(this.animate)},this.updateParticipantsMouses=t=>{this.presences.forEach((t=>{if(t.id!==this.localParticipant.id){if(null==t||!t.visible)return void this.removePresenceMouseParticipant(t.id);this.renderPresenceMouses(t)}})),!t&&this.presences.has(this.userBeingFollowedId)&&this.goToMouse(this.userBeingFollowedId)},this.renderPresenceMouses=t=>{var e,n,r,i,s;if(t.id===this.localParticipant.id)return;let o=document.getElementById(`mouse-${t.id}`);if(o||(o=this.createMouseElement(t)),!o)return;let a=o.getElementsByClassName("mouse-user-name")[0],l=o.getElementsByClassName("pointer-mouse")[0];l&&(l.style.backgroundImage=`url(https://production.cdn.superviz.com/static/mouse-pointers/${null==(e=t.slot)?void 0:e.colorName}.svg)`),a&&(a.style.color=null!=(r=null==(n=t.slot)?void 0:n.textColor)?r:Ui.gray,a.style.backgroundColor=null!=(s=null==(i=t.slot)?void 0:i.color)?s:"#fff",a.innerHTML=t.name);let{x:c,y:u}=t,{translate:{x:h,y:d},scale:p}=this.transformation;o.style.left=`${h+c*p}px`,o.style.top=`${d+u*p}px`},this.renderVoidElementWrapper=()=>{let t=document.createElement("div"),{width:e,height:n,left:r,top:i}=this.container.getBoundingClientRect();t.style.position="absolute",t.style.width=`${e}px`,t.style.height=`${n}px`,t.style.top=`${i}px`,t.style.left=`${r}px`,t.style.overflow="visible",t.style.pointerEvents="none",this.container.parentElement.appendChild(t),this.wrapper=t},this.renderSVGElementWrapper=()=>{let t=this.containerTagname.toLowerCase();"svg"!==t?"rect"!==t?"ellipse"===t&&this.createEllipseWrapper():this.createRectWrapper():this.createSVGWrapper()},this.container=document.getElementById(t),this.logger=new Ia("@superviz/sdk/presence"),!this.container){let e=`Element with id ${t} not found`;throw this.logger.log(e),new Error(e)}this.camera={x:0,y:0,scale:1,screen:{width:this.container.clientWidth,height:this.container.clientHeight}},this.name="presence";let{localParticipant:r}=this.useStore("global-store");r.subscribe(),this.containerTagname=this.container.tagName.toUpperCase(),this.goToPresenceCallback=null==(n=null==e?void 0:e.callbacks)?void 0:n.onGoToPresence}start(){this.logger.log("presence-mouse component @ start"),this.renderWrapper(),this.addListeners(),this.subscribeToRealtimeEvents(),this.eventBus.subscribe("realtime.private-mode",this.setParticipantPrivate),this.animationFrame=requestAnimationFrame(this.animate),this.eventBus.subscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.subscribe("realtime.local-follow-participant",this.followMouse)}destroy(){cancelAnimationFrame(this.animationFrame),this.logger.log("presence-mouse component @ destroy"),this.removeListeners(),this.wrapper.remove(),this.presences.clear(),this.presences=void 0,this.container=void 0,this.wrapper=void 0,this.unsubscribeFromRealtimeEvents(),this.eventBus.unsubscribe("realtime.private-mode",this.setParticipantPrivate),this.eventBus.unsubscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.unsubscribe("realtime.local-follow-participant",this.followMouse),this.logger=void 0}subscribeToRealtimeEvents(){this.logger.log("presence-mouse component @ subscribe to realtime events"),this.room.presence.on(nl.JOINED_ROOM,this.onPresenceJoinedRoom),this.room.presence.on(nl.LEAVE,this.onPresenceLeftRoom),this.room.presence.on(nl.UPDATE,this.onPresenceUpdate)}unsubscribeFromRealtimeEvents(){this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.room.presence.off(nl.JOINED_ROOM),this.room.presence.off(nl.LEAVE),this.room.presence.off(nl.UPDATE)}addListeners(){this.pointerMoveObserver=no(this.container,"pointermove").pipe(co(30)).subscribe(this.onMyParticipantMouseMove),this.container.addEventListener("pointerleave",this.onMyParticipantMouseLeave)}removeListeners(){var t;null==(t=this.pointerMoveObserver)||t.unsubscribe(),this.container.removeEventListener("pointerleave",this.onMyParticipantMouseLeave)}setPositionNotStatic(){let{position:t}=window.getComputedStyle(this.container);"static"===t&&this.container.style.setProperty("position","relative")}createMouseElement(t){if(!this.wrapper)return;let e=document.createElement("div");e.setAttribute("id",`mouse-${t.id}`),e.setAttribute("class","mouse-follower");let n=document.createElement("div");n.setAttribute("class","pointer-mouse");let r=document.createElement("div");return r.setAttribute("class","mouse-user-name"),r.innerHTML=t.name,e.appendChild(n),e.appendChild(r),e.style.left="0px",e.style.top="0px",this.wrapper.appendChild(e),this.mouses.set(t.id,e),e}updateSVGPosition(){let t=this.container.parentElement.getBoundingClientRect(),e=this.container.getBoundingClientRect(),n=e.left-t.left,r=e.top-t.top,{width:i,height:s}=this.container.getBoundingClientRect();this.wrapper.style.setProperty("width",`${i}px`),this.wrapper.style.setProperty("height",`${s}px`),this.wrapper.style.setProperty("top",`${r}px`),this.wrapper.style.setProperty("left",`${n}px`)}createSVGWrapper(){let t=document.createElement("div"),e=this.container.parentElement.getBoundingClientRect(),n=this.container.getBoundingClientRect(),r=n.left-e.left,i=n.top-e.top,{width:s,height:o}=this.container.getBoundingClientRect();t.style.position="fixed",t.style.width=`${s}px`,t.style.height=`${o}px`,t.style.top=`${i}px`,t.style.left=`${r}px`,t.style.overflow="visible",t.style.pointerEvents="none",t.id="superviz-svg-wrapper",this.container.parentElement.appendChild(t),this.wrapper=t}createRectWrapper(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=document.createElement("div"),r=this.container.getAttribute("width"),i=this.container.getAttribute("height"),s=this.container.getAttribute("rx"),o=this.container.getAttribute("ry");e.setAttribute("fill","transparent"),e.setAttribute("stroke","transparent"),e.setAttribute("x","0"),e.setAttribute("y","0"),e.setAttribute("rx",s),e.setAttribute("ry",o),e.setAttribute("height",i),e.setAttribute("width",r),t.setAttribute("height",i),t.setAttribute("width",r),t.appendChild(e),n.appendChild(t);let a=this.container.getBoundingClientRect();n.style.position="fixed",n.style.top=`${a.top}px`,n.style.left=`${a.left}px`,n.style.width=`${a.width}px`,n.style.height=`${a.height}px`,n.style.overflow="visible",n.style.pointerEvents="none",n.id="superviz-rect-wrapper";let l=this.container.viewportElement;for(;l.viewportElement;)l=l.viewportElement;l.parentElement.appendChild(n),this.wrapper=n}createEllipseWrapper(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),n=document.createElement("div"),r=this.container.getAttribute("cx"),i=this.container.getAttribute("cy"),s=this.container.getAttribute("rx"),o=this.container.getAttribute("ry"),a=Number(r)-Number(s),l=Number(i)-Number(o),c=String(2*Number(r)),u=String(2*Number(i));e.setAttribute("fill","transparent"),e.setAttribute("stroke","transparent"),e.setAttribute("x","0"),e.setAttribute("y","0"),e.setAttribute("rx",s),e.setAttribute("ry",o),e.setAttribute("cx",""+(Number(r)-a)),e.setAttribute("cy",""+(Number(i)-l)),e.setAttribute("height",u),e.setAttribute("width",c),t.setAttribute("height",u),t.setAttribute("width",c),t.appendChild(e),n.appendChild(t);let h=this.container.getBoundingClientRect();n.style.position="fixed",n.style.top=`${h.top}px`,n.style.left=`${h.left}px`,n.style.width=`${h.width}px`,n.style.height=`${h.height}px`,n.style.overflow="visible",n.style.pointerEvents="none",n.id="superviz-ellipse-wrapper";let d=this.container.viewportElement;for(;d.viewportElement;)d=d.viewportElement;d.parentElement.appendChild(n),this.wrapper=n}transform(t){var e,n;this.transformation=t,this.camera={x:t.translate.x,y:t.translate.y,scale:t.scale,screen:{width:(null==(e=this.wrapper)?void 0:e.clientWidth)||1,height:(null==(n=this.wrapper)?void 0:n.clientHeight)||1}},this.updateParticipantsMouses(!0)}updateVoidElementWrapper(){let t=this.container.getBoundingClientRect(),e=this.wrapper.getBoundingClientRect(),n=this.container;if((0,hp.isEqual)(t,e))return;let r=n.offsetLeft,i=n.offsetTop;this.wrapper.style.setProperty("width",`${t.width}px`),this.wrapper.style.setProperty("height",`${t.height}px`),this.wrapper.style.setProperty("top",`${i}px`),this.wrapper.style.setProperty("left",`${r}px`),this.wrapper.id="superviz-void-wrapper"}updateSVGElementWrapper(){let{left:t,top:e,width:n,height:r}=this.container.getBoundingClientRect(),{left:i,top:s,width:o,height:a}=this.wrapper.getBoundingClientRect();if(t!==i||e!==s||n!==o||r!==a){if("svg"===this.containerTagname.toLowerCase())return void this.updateSVGPosition();this.wrapper.style.setProperty("width",`${n}px`),this.wrapper.style.setProperty("height",`${r}px`),this.wrapper.style.setProperty("top",`${e}px`),this.wrapper.style.setProperty("left",`${t}px`)}}renderWrapper(){if(!this.wrapper){if(dp[this.containerTagname])return void this.renderVoidElementWrapper();if(pp[this.containerTagname])return void this.renderSVGElementWrapper();this.renderElementWrapper()}}removePresenceMouseParticipant(t){let e=document.getElementById(`mouse-${t}`);e&&(e.remove(),this.presences.delete(t),this.mouses.delete(t))}renderElementWrapper(){let t=document.createElement("div");t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.top="0",t.style.left="0",t.style.overflow="visible",t.style.pointerEvents="none",this.setPositionNotStatic(),this.container.appendChild(t),this.wrapper=t}},mp=class{constructor(t,e){let n=document.getElementById(t);if(!n)throw new Error(`[Superviz] Container with id ${t} not found`);return"canvas"===n.tagName.toLowerCase()?new up(t,e):new fp(t,e)}transform(t){}};Mi(),Mi();var gp=xi(Ma());Mi();var vp=class{constructor(t){this.room=t,this.logger=new Ia("@superviz/sdk/realtime-presence")}update(t){this.logger.log("Realtime Presence @ update presence",t),this.room.presence.update(t)}subscribe(t,e){this.logger.log("Realtime Presence @ subscribe",t),this.room.presence.on(t,e)}unsubscribe(t){this.logger.log("Realtime Presence @ unsubscribe",t),this.room.presence.off(t)}getAll(){return Si(this,null,(function*(){return this.logger.log("Realtime Presence @ get all"),new Promise(((t,e)=>{this.room.presence.get((e=>t(e)),(t=>{let n=`[SuperViz] ${t.name} - ${t.message}`;this.logger.log(t),console.error(n),e(t)}))}))}))}},yp=class extends Na{constructor(t,e,n,r){super(),this.state="DISCONNECTED",this.callbacksToSubscribeWhenJoined=[],this.publish=(0,gp.default)(((t,e)=>{if("CONNECTED"!==this.state){let e=`Realtime channel ${this.name} is not started yet. You can't publish event ${t} before start`;return this.logger.log(e),void console.warn(`[SuperViz] ${e}`)}this.channel.emit(`message:${this.name}`,{name:t,payload:e})}),30),this.subscribe=(t,e)=>{"CONNECTED"===this.state?(this.observers[t]||(this.observers[t]=new La),this.observers[t].subscribe(e)):this.callbacksToSubscribeWhenJoined.push({event:t,callback:e})},this.unsubscribe=(t,e)=>{var n;null==(n=this.observers[t])||n.unsubscribe(e)},this.fetchHistory=t=>Si(this,null,(function*(){if("CONNECTED"!==this.state){let t="Realtime component is not started yet. You can't retrieve history before start";return this.logger.log(t),console.warn(`[SuperViz] ${t}`),null}return yield new Promise(((e,n)=>{this.channel.history((r=>{var i;null!=(i=r.events)&&i.length||e(null);let s=r.events.reduce(((t,e)=>{var n;return t[e.data.name]||(t[e.data.name]=[]),t[e.data.name].push({data:e.data.payload,connectionId:e.connectionId,name:e.data.name,participantId:null==(n=e.presence)?void 0:n.id,timestamp:e.timestamp}),t}),{});t&&!s[t]&&n(new Error(`Event ${t} not found in the history`)),t&&e(s[t]),e(s)}))}))})),this.publishEventToClient=(t,e)=>{var n;this.logger.log("realtime channel @ publishEventToClient",{event:t,data:e}),null==(n=this.observers[t])||n.publish(e)},this.name=t,this.ioc=e,this.logger=new Ia("@superviz/sdk/realtime-channel"),this.channel=this.ioc.createRoom(`realtime:${this.name}`,r),this.localParticipant=n,this.subscribeToRealtimeEvents(),this.logger.log("started"),this.participant=new vp(this.channel)}disconnect(){return Si(this,null,(function*(){"DISCONNECTED"!==this.state?(this.logger.log("destroyed"),this.changeState("DISCONNECTED"),this.channel.disconnect()):this.logger.log("Realtime channel is already disconnected")}))}changeState(t){this.logger.log("realtime component @ changeState - state changed",t),this.state=t,this.publishEventToClient("realtime-channel.state-changed",this.state)}subscribeToRealtimeEvents(){this.channel.presence.on(nl.JOINED_ROOM,(t=>{t.id===this.localParticipant.id&&(this.changeState("CONNECTED"),this.callbacksToSubscribeWhenJoined.forEach((t=>{let{event:e,callback:n}=t;this.subscribe(e,n)})),this.logger.log("joined room"),this.changeState("CONNECTED"))})),this.channel.on(`message:${this.name}`,(t=>{var e,n;this.logger.log("message received",t),this.publishEventToClient(t.data.name,{data:t.data.payload,participantId:null!=(n=null==(e=null==t?void 0:t.presence)?void 0:e.id)?n:null,name:t.data.name,timestamp:t.timestamp,connectionId:t.connectionId})}))}},_p=class extends Jd{constructor(){super(),this.state="STOPPED",this.channels=new Map,this.callbacksToSubscribeWhenJoined=[],this.subscribe=(t,e)=>{this.channel?this.channel.subscribe(t,e):this.callbacksToSubscribeWhenJoined.push({event:t,callback:e})},this.publish=(t,e)=>{var n;ki[t.toUpperCase()]?this.channel.publishEventToClient(t,e):null==(n=this.channel)||n.publish(t,e)},this.unsubscribe=(t,e)=>{var n;null==(n=this.channel)||n.unsubscribe(t,e)},this.name="realtime",this.logger=new Ia("@superviz/sdk/realtime-component");let{localParticipant:t}=this.useStore("global-store");t.subscribe()}connect(t){if(!this.channel)return new Promise((e=>{let{localParticipant:n}=xo();n.subscribe("connect-after-init",(r=>{r.activeComponents.includes("realtime")&&(n.unsubscribe("connect-after-init"),e(this.connect(t)))}))}));let e=this.channels.get(t);return e||(e=new yp(t,this.ioc,this.localParticipant,this.connectionLimit),this.channels.set(t,e),"STARTED"===this.state)?e:new Promise((t=>{this.subscribe("realtime-component.state-changed",(n=>{"STARTED"===n&&t(e)}))}))}start(){this.logger.log("started"),this.channel=new yp("default",this.ioc,this.localParticipant,this.connectionLimit),this.channel.subscribe("realtime-channel.state-changed",(t=>{"CONNECTED"===t&&(this.callbacksToSubscribeWhenJoined.forEach((t=>{let{event:e,callback:n}=t;this.channel.subscribe(e,n)})),this.changeState("STARTED"),this.callbacksToSubscribeWhenJoined=[],this.channel.unsubscribe("realtime-channel.state-changed"),this.participant=this.channel.participant,this.channels.set("default",this.channel))}))}destroy(){this.logger.log("destroyed"),this.changeState("STOPPED"),this.disconnectFromAllChannels()}disconnectFromAllChannels(){this.channels.forEach((t=>t.disconnect()))}changeState(t){var e;this.logger.log("realtime component @ changeState - state changed",t),this.state=t,null==(e=this.channel)||e.publishEventToClient("realtime-component.state-changed",this.state)}};Mi();var bp=class extends Jd{constructor(t){var e;super(),this.onParticipantListUpdate=t=>{if(void 0===this.localParticipantId||""===this.localParticipantId)return;if(!this.initialized)return this.initialized=!0,void this.initializeList();let e=yi(vi({},t.data),{tooltip:this.getTooltipData(t.data),controls:this.getControls(t.data)}),{participants:n,extras:r}=this.useStore("who-is-online-store");n.value.some((e=>{let{id:n}=e;return n===t.data.id}))?this.updateParticipant(e):r.value.some((e=>{let{id:n}=e;return n===t.data.id}))?this.updateExtra(e):n.value.length<4?n.publish([...n.value,e]):r.publish([...r.value,e])},this.onParticipantLeave=t=>{let{participants:e,extras:n}=this.useStore("who-is-online-store");if(-1===e.value.findIndex((e=>e.id===t.id))){let e=n.value.filter((e=>e.id!==t.id));return void n.publish(e)}let r=e.value.filter((e=>e.id!==t.id));if(n.value.length){r.push(n.value[0]);let t=n.value.slice(1);n.publish(t)}e.publish(r)},this.updateParticipant=t=>{let{participants:e,extras:n}=this.useStore("who-is-online-store");if(t.isPrivate&&t.id!==this.localParticipantId){let r=e.value.filter((e=>{let{id:n}=e;return n!==t.id})),i=n.value.splice(0,1);return e.publish([...r,...i]),void n.publish([...n.value])}let r=e.value.map((e=>e.id===t.id?t:e));e.publish(r)},this.updateExtra=t=>{let{extras:e}=this.useStore("who-is-online-store");if(t.isPrivate&&t.id!==this.localParticipantId){let n=e.value.filter((e=>{let{id:n}=e;return n!==t.id}));return void e.publish(n)}let n=e.value.map((e=>e.id===t.id?t:e));e.publish(n)},this.subscribeToLocalParticipantUpdates=t=>{if(!t.slot)return;this.localParticipantId=t.id;let{privateMode:e,joinedPresence:n}=this.useStore("who-is-online-store"),r=this.isInPresence(t.activeComponents);n.publish(r);let i=this.getParticipant(t);this.room.presence.update(yi(vi({},i),{isPrivate:e.value}))},this.goToMousePointer=t=>{var e,n,r;let i=null!=(r=null==(e=t.presence)?void 0:e.id)?r:null==(n=t.detail)?void 0:n.id;i!==this.localParticipantId&&(this.eventBus.publish("realtime.go-to-participant",i),this.publish("who-is-online.go-to-participant",i))},this.followMousePointer=t=>{let{detail:e}=t;this.eventBus.publish("realtime.local-follow-participant",e.id),this.following&&this.publish("who-is-online.start-following-participant",this.following),this.following||this.publish("who-is-online.stop-following-participant"),"extras"===e.source&&this.highlightParticipantBeingFollowed(),this.updateParticipantsControls(e.id)},this.setPrivate=t=>{let{detail:{isPrivate:e,id:n}}=t,{privateMode:r,participants:i}=this.useStore("who-is-online-store"),s=i.value.find((t=>t.id===n));r.publish(e),this.eventBus.publish("realtime.private-mode",e),this.room.presence.update(yi(vi({},s),{isPrivate:e})),e&&this.publish("who-is-online.enter-private-mode"),e||this.publish("who-is-online.leave-private-mode")},this.setFollow=t=>{let{id:e}=t.presence;if(e===this.localParticipantId)return;let{data:n}=t,{following:r}=this.useStore("who-is-online-store");r.publish(n),this.followMousePointer({detail:{id:n}})},this.follow=t=>{let{detail:e}=t,{everyoneFollowsMe:n}=this.useStore("who-is-online-store");n.publish(!(null==e||!e.id)),this.room.emit("who-is-online.start-follow-me",e),this.following&&this.publish("who-is-online.start-follow-me",this.following),this.following||this.publish("who-is-online.stop-follow-me"),this.updateParticipantsControls(null==e?void 0:e.id)},this.stopFollowing=t=>{var e;if(t.id!==(null==(e=this.following)?void 0:e.id))return;let{following:n}=this.useStore("who-is-online-store");n.publish(void 0),this.eventBus.publish("realtime.local-follow-participant",void 0),this.publish("who-is-online.stop-following-participant")},this.gather=t=>{this.room.emit("who-is-online.gather-all",t.detail.id),this.publish("who-is-online.gather-all",t.detail.id)},this.onJoinedRoom=t=>{if(t.id!==this.localParticipantId)return;let{localParticipant:e}=this.useStore("global-store");e.subscribe(this.subscribeToLocalParticipantUpdates)},this.name="whoIsOnline",this.logger=new Ia("@superviz/sdk/who-is-online-component");let{disablePresenceControls:n,disableGoToParticipant:r,disableFollowParticipant:i,disablePrivateMode:s,disableGatherAll:o,disableFollowMe:a,following:l}=this.useStore("who-is-online-store");l.subscribe(),"object"==typeof t?"object"==typeof t&&(this.position=null!=(e=t.position)?e:"top-right",this.setStyles(t.styles),n.publish(t.disablePresenceControls),r.publish(t.disableGoToParticipant),i.publish(t.disableFollowParticipant),s.publish(t.disablePrivateMode),o.publish(t.disableGatherAll),a.publish(t.disableFollowMe)):this.position=t??"top-right"}start(){let{localParticipant:t}=this.useStore("global-store");this.localParticipantId=t.value.id,this.subscribeToRealtimeEvents(),this.positionWhoIsOnline(),this.addListeners()}destroy(){this.unsubscribeFromRealtimeEvents(),this.removeListeners(),this.element.remove(),this.element=null,this.initialized=!1;let{destroy:t}=this.useStore("who-is-online-store");t()}addListeners(){this.element.addEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.addEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.addEventListener("realtime.private-mode",this.setPrivate),this.element.addEventListener("realtime.follow-participant",this.follow),this.element.addEventListener("realtime.gather",this.gather)}removeListeners(){this.element.removeEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.removeEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.removeEventListener("realtime.private-mode",this.setPrivate),this.element.removeEventListener("realtime.follow-participant",this.follow),this.element.removeEventListener("realtime.gather",this.gather)}subscribeToRealtimeEvents(){this.room.presence.on(nl.UPDATE,this.onParticipantListUpdate),this.room.presence.on(nl.LEAVE,this.onParticipantLeave),this.room.presence.on(nl.LEAVE,this.stopFollowing),this.room.presence.on(nl.JOINED_ROOM,this.onJoinedRoom),this.room.on("who-is-online.gather-all",this.goToMousePointer),this.room.on("who-is-online.start-follow-me",this.setFollow)}unsubscribeFromRealtimeEvents(){this.room.presence.off(nl.UPDATE),this.room.presence.off(nl.LEAVE),this.room.presence.off(nl.JOINED_ROOM),this.room.off("who-is-online.gather-all",this.goToMousePointer),this.room.off("who-is-online.start-follow-me",this.setFollow)}initializeList(){let{participants:t,extras:e}=this.useStore("who-is-online-store");this.room.presence.get((n=>{let r=n.filter((t=>t.data.id)).map((t=>{let{data:e}=t,n=e.avatar;n||(n=this.getAvatar({avatar:e.avatar,color:e.slot.color,name:e.name,letterColor:e.slot.textColor}));let r=this.getTooltipData(e),i=this.getControls(e);return yi(vi({},e),{tooltip:r,controls:i,avatar:n,isLocalParticipant:e.id===this.localParticipantId})}));if(!r.length)return;let i=r.findIndex((t=>t.id===this.localParticipantId)),s=r.splice(i,1)[0],o=r.splice(0,3);t.publish([s,...o]),e.publish(r)}))}setStyles(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!t)return;let e=document.createElement("style");e.textContent=t,e.id="superviz-who-is-online-styles",document.head.appendChild(e)}positionWhoIsOnline(){if(this.element=document.createElement("superviz-who-is-online"),Object.values(Fi).includes(this.position.toLowerCase())){document.body.appendChild(this.element);let[t,e]=this.position.split("-");return void(this.element.position=`${t}: 20px; ${e}: 40px;`)}let t=document.getElementById(this.position);if(!t)return this.element.position="top: 20px; right: 40px;",void document.body.appendChild(this.element);t.appendChild(this.element),this.element.position="position: relative;"}getParticipant(t){let{avatar:e,activeComponents:n,id:r,name:i,slot:{color:s,textColor:o}}=t,a=this.shouldDisableDropdown({activeComponents:n,participantId:r});return{id:r,name:i,avatar:this.getAvatar({avatar:e,color:s,name:i,letterColor:o}),disableDropdown:a,activeComponents:n,isPrivate:!1}}shouldDisableDropdown(t){let{activeComponents:e,participantId:n}=t,{joinedPresence:{value:r},disablePresenceControls:{value:i},disableFollowMe:{value:s},disableFollowParticipant:{value:o},disableGoToParticipant:{value:a},disableGatherAll:{value:l},disablePrivateMode:{value:c}}=this.useStore("who-is-online-store");return!!(!1===r||!0===i||n===this.localParticipantId&&s&&c&&l||n!==this.localParticipantId&&o&&a)||!(null!=e&&e.some((t=>t.toLowerCase().includes("presence"))))}getTooltipData(t){let{name:e,disableDropdown:n,id:r}=t,i=r===this.localParticipantId,s={name:e};return i&&(s.name+=" (You)"),!n&&!i&&(s.info="Click to follow"),s}getAvatar(t){let{avatar:e,color:n,name:r,letterColor:i}=t;var s,o;return{imageUrl:null==e?void 0:e.imageUrl,firstLetter:null!=(o=null==(s=null==r?void 0:r.at(0))?void 0:s.toUpperCase())?o:"A",color:n,letterColor:i}}getControls(t){let{disablePresenceControls:e}=this.useStore("who-is-online-store"),{disableDropdown:n,id:r}=t;return e.value||n?[]:r===this.localParticipantId?this.getLocalParticipantControls():this.getOtherParticipantsControls(r)}getOtherParticipantsControls(t){var e;let{disableGoToParticipant:n,disableFollowParticipant:r,following:i}=this.useStore("who-is-online-store"),s=[];if(n.value||s.push({label:"go to",icon:"place"}),!r.value){let n=(null==(e=i.value)?void 0:e.id)===t,r=n?"unfollow":"follow",o=n?"send-off":"send";s.push({label:r,icon:o})}return s}getLocalParticipantControls(){let{disableFollowMe:{value:t},disableGatherAll:{value:e},disablePrivateMode:{value:n},everyoneFollowsMe:{value:r},privateMode:{value:i}}=this.useStore("who-is-online-store"),s=[];if(e||s.push({label:"gather all",icon:"gather"}),!t){let t=r?"send-off":"send",e=r?"stop followers":"everyone follows me";s.push({label:e,icon:t})}if(!n){let t=i?"eye_inative":"eye",e=i?"leave private mode":"private mode";s.push({label:e,icon:t})}return s}updateParticipantsControls(t){let{participants:e}=this.useStore("who-is-online-store"),n=e.value.map((e=>{if(t&&e.id!==t)return e;let n=this.getControls(e);return yi(vi({},e),{controls:n})}));e.publish(n)}highlightParticipantBeingFollowed(){let{extras:t,participants:e,following:{value:n}}=this.useStore("who-is-online-store"),r=e.value[0],i=t.value.findIndex((t=>t.id===n.id)),s=t.value.splice(i,1)[0];e.value.unshift(r),e.value[1]=s;let o=e.value.pop();t.value.push(o),t.publish(t.value),e.publish(e.value)}isInPresence(t){return null==t?void 0:t.some((t=>t.includes("presence")))}};Mi();typeof window<"u"&&(window.SuperVizRoom={init:Hd,CommentEvent:Oi,MeetingEvent:Ti,DeviceEvent:Ni,RealtimeEvent:Pi,MeetingState:Ii,MeetingConnectionStatus:Li,MeetingControlsEvent:Ci,ParticipantEvent:Ri,FrameEvent:Ai,LayoutMode:Wd,VideoConference:class extends Jd{constructor(t){var e,n;super(),this.participantsOnMeeting=[],this.kickParticipantsOnHostLeave=!1,this.startVideo=()=>{var t,e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g,v,y,_,b,x,w,S,M,E,T,A,C,P,I,R,L,N,O,k,D,z;let U="audience"!==(null==(t=this.params)?void 0:t.userType)&&!0===(null==(e=this.params)?void 0:e.defaultAvatars);this.videoConfig={language:null==(n=this.params)?void 0:n.language,canUseRecording:!(null==(r=this.params)||!r.enableRecording),canShowAudienceList:null==(s=null==(i=this.params)?void 0:i.showAudienceList)||s,canUseChat:!(null!=(o=this.params)&&o.chatOff),canUseCams:!(null!=(a=this.params)&&a.camsOff),canUseScreenshare:!(null!=(l=this.params)&&l.screenshareOff),canUseDefaultAvatars:U&&!(null!=(u=null==(c=this.localParticipant)?void 0:c.avatar)&&u.model3DUrl),canUseGather:!(null==(h=this.params)||!h.enableGather),canUseFollow:!(null==(d=this.params)||!d.enableFollow),canUseGoTo:!(null==(p=this.params)||!p.enableGoTo),canUseDefaultToolbar:null==(m=null==(f=this.params)?void 0:f.defaultToolbar)||m,camerasPosition:null==(v=null==(g=this.params)?void 0:g.collaborationMode)?void 0:v.position,devices:null==(y=this.params)?void 0:y.devices,skipMeetingSettings:null==(_=this.params)?void 0:_.skipMeetingSettings,browserService:this.browserService,offset:null==(b=this.params)?void 0:b.offset,locales:null!=(w=null==(x=this.params)?void 0:x.locales)?w:[],avatars:null!=(M=null==(S=this.params)?void 0:S.avatars)?M:[],customColors:qi.get("colors"),waterMark:qi.get("waterMark"),styles:null==(E=this.params)?void 0:E.styles,collaborationMode:null==(C=null==(A=null==(T=this.params)?void 0:T.collaborationMode)?void 0:A.enabled)||C,layoutPosition:!1===(null==(I=null==(P=this.params)?void 0:P.collaborationMode)?void 0:I.enabled)?"center":null!=(N=null==(L=null==(R=this.params)?void 0:R.collaborationMode)?void 0:L.modalPosition)?N:"center",layoutMode:null!=(D=null==(k=null==(O=this.params)?void 0:O.collaborationMode)?void 0:k.initialView)?D:"list",callbacks:null==(z=this.params)?void 0:z.callbacks},this.logger.log("video conference @ start video",this.videoConfig),this.videoManager=new op(this.videoConfig),this.subscribeToVideoEvents()},this.subscribeToVideoEvents=()=>{this.logger.log("video conference @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)},this.unsubscribeFromVideoEvents=()=>{this.videoManager&&(this.logger.log("video conference @ unsubscribe from video events"),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.unsubscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange))},this.suscribeToRealtimeEvents=()=>{this.logger.log("video conference @ subscribe to realtime events"),this.room.presence.on(nl.UPDATE,this.onParticipantUpdateOnRealtime),this.room.presence.on(nl.JOINED_ROOM,this.onParticipantJoinedOnRealtime),this.room.presence.on(nl.LEAVE,this.onParticipantLeftOnRealtime)},this.unsubscribeFromRealtimeEvents=()=>{var t;this.logger.log("video conference @ unsubscribe from realtime events"),this.room.presence.off(nl.UPDATE),this.room.presence.off(nl.LEAVE),this.room.presence.off(nl.JOINED_ROOM),null==(t=this.roomState)||t.kickParticipantObserver.unsubscribe(this.onKickLocalParticipant)},this.subscribeToStoreUpdates=()=>{let{localParticipant:t,group:e,participants:n}=this.useStore("global-store");n.subscribe((t=>{let e=Object.values(t);this.onRealtimeParticipantsDidChange(e)}));let{drawing:r,hostId:i,isGridModeEnabled:s,transcript:o,followParticipantId:a,gather:l}=this.useStore("video-store");t.subscribe((t=>{this.localParticipant=yi(vi(vi({},this.localParticipant),t),{type:this.params.userType})})),r.subscribe(this.setDrawing),i.subscribe(this.setHost),s.subscribe(this.setGridMode),o.subscribe(this.setTranscript),a.subscribe(this.setFollowParticipant),l.subscribe(this.setGather),e.subscribe()},this.createParticipantFromPresence=t=>{var e;return{participantId:t.id,id:t.id,color:(null==(e=t.data.slot)?void 0:e.color)||Ui.gray,avatar:t.data.avatar,type:t.data.type,name:t.data.name,isHost:t.data.isHost,timestamp:t.timestamp,slot:t.data.slot}},this.onFrameSizeDidChange=t=>{this.publish("frame.dimensions-update",t)},this.onWaitingForHost=t=>{this.publish("meeting.waiting-for-host",t)},this.onConnectionStatusChange=t=>{this.logger.log("video conference @ on connection status change",t);let e=[2,4,3,6];e.includes(t)&&this.roomState.freezeSync(!0),e.includes(this.connectionService.oldConnectionStatus)&&!e.includes(t)&&this.roomState.freezeSync(!1),this.publish("meeting.connection-status-change",t)},this.onMeetingStateChange=t=>{this.logger.log("video conference @ on meeting state change",t),this.publish("meeting.state-update",t)},this.onSameAccountError=t=>{this.publish("meeting.same-participant-error",t),this.detach()},this.onDevicesChange=t=>{this.publish("meeting.devices-change",t)},this.onFrameStateChange=t=>{this.logger.log("video conference @ on frame state change",t),2===t&&(this.roomState=new np(this.room,this.drawingRoom,this.logger),this.roomState.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.roomState.start(),"guest"!==this.params.userType&&(this.localParticipant=Object.assign(this.localParticipant,{type:this.params.userType}),this.roomState.updateMyProperties(vi({},this.localParticipant))),this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:qi.get("roomId")}),this.publish("meeting.start"))},this.onRealtimeEventFromFrame=t=>{let{event:e,data:n}=t;this.logger.log("video conference @ on realtime event from frame",e,n),{"realtime.host-change":t=>this.roomState.setHost(t),"realtime.gather":t=>this.roomState.setGather(t),"realtime.grid-mode-change":t=>this.roomState.setGridMode(t),"realtime.drawing-change":t=>{this.roomState.setDrawing(t)},"realtime.follow-participant":t=>{this.roomState.setFollowParticipant(t)},"meeting.kick-participant":t=>{this.roomState.setKickParticipant(t)},"realtime.transcript-change":t=>{this.roomState.setTranscript(t)},"realtime.go-to-participant":t=>{this.eventBus.publish("realtime.go-to-participant",t)}}[e](n),this.publish(e,n)},this.onParticipantJoined=t=>{var e;this.logger.log("video conference @ on participant joined",t),this.publish("meeting.participant-joined",t),this.publish("my-participant.joined",t),this.kickParticipantsOnHostLeave=!(null!=(e=this.params)&&e.allowGuests);let{localParticipant:n,participants:r}=this.useStore("global-store"),i=t.name.trim();if(this.videoConfig.canUseDefaultAvatars)return this.roomState.updateMyProperties({avatar:t.avatar,name:t.name,type:t.type,joinedMeeting:!0}),ap.updateLocalParticipant(yi(vi({},n.value),{avatar:t.avatar,name:t.name,type:this.params.userType})),void ap.updateParticipantsList(yi(vi({},r.value),{[t.id]:yi(vi({},r.value[t.id]),{avatar:t.avatar,name:t.name})}));ap.updateLocalParticipant(yi(vi({},n.value),{name:i,type:this.params.userType})),ap.updateParticipantsList(yi(vi({},r.value),{[t.id]:yi(vi({},r.value[t.id]),{name:i,type:this.params.userType})})),this.roomState.updateMyProperties({name:t.name,type:t.type,joinedMeeting:!0})},this.onParticipantLeft=t=>{var e,n;this.logger.log("video conference @ on participant left",this.localParticipant);let{localParticipant:r,participants:i}=this.useStore("global-store");r.publish(yi(vi({},r.value),{activeComponents:null==(e=r.value.activeComponents)?void 0:e.filter((t=>"videoConference"!==t))})),i.publish(yi(vi({},i.value),{[this.localParticipant.id]:yi(vi({},r.value),{activeComponents:null==(n=r.value.activeComponents)?void 0:n.filter((t=>"videoConference"!==t))})})),this.connectionService.removeListeners(),this.publish("my-participant.left",this.localParticipant),this.unsubscribeFromVideoEvents(),this.videoManager.leave(),this.videoManager=void 0,this.connectionService=void 0,this.detach()},this.onParticipantListUpdate=t=>{this.logger.log("video conference @ on participant list update",t);let e=Object.values(t).map((t=>{var e,n;return{id:t.id,slot:t.slot,avatar:t.avatar,name:t.name,type:t.type,isHost:null!=(e=t.isHost)&&e,timestamp:t.timestamp,color:(null==(n=t.slot)?void 0:n.color)||Ui.gray}}));this.publish("meeting.participant-list-update",e),this.participantsOnMeeting.length!==e.length&&this.publish("meeting.amount-of-participants-update",e.length),this.participantsOnMeeting=e,this.validateIfInTheRoomHasHost()},this.onKickLocalParticipant=()=>{this.logger.log("video conference @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.detach()},this.setDrawing=t=>{var e;null==(e=this.videoManager)||e.publishMessageToFrame("realtime.drawing-change",t)},this.setHost=t=>{var e;null==(e=this.videoManager)||e.publishMessageToFrame("realtime.host-change",t),this.onHostParticipantDidChange(t)},this.setGridMode=t=>{var e;null==(e=this.videoManager)||e.publishMessageToFrame("realtime.grid-mode-change",t)},this.setTranscript=t=>{var e;null==(e=this.videoManager)||e.publishMessageToFrame("realtime.transcript-change",t)},this.setFollowParticipant=t=>{var e;null==(e=this.videoManager)||e.publishMessageToFrame("realtime.follow-participant",t),this.eventBus.publish("realtime.follow-participant",t)},this.setGather=t=>{if(!this.videoManager||!t)return;let{hostId:e,gather:n}=this.useStore("video-store");n.publish(!1),e.value===this.localParticipant.id?this.videoManager.publishMessageToFrame("realtime.gather",t):this.eventBus.publish("realtime.go-to-participant",e.value)},this.onRealtimeParticipantsDidChange=t=>{var e;this.logger.log("video conference @ on participants did change",t);let n=t.map((t=>{var e,n;return{id:t.id,timestamp:t.timestamp,participantId:t.id,color:(null==(e=t.slot)?void 0:e.color)||Ui.gray,name:t.name,isHost:null!=(n=t.isHost)&&n,avatar:t.avatar,type:t.type,slot:t.slot}}));null==(e=this.videoManager)||e.publishMessageToFrame("realtime.participant-list-update",n)},this.onHostParticipantDidChange=t=>{var e,n;this.logger.log("video conference @ on host participant did change",t),null==(e=this.videoManager)||e.publishMessageToFrame("realtime.host-change",t);let{participants:r}=this.useStore("global-store"),i=Object.values(r.value).find((e=>e.id===t)),s=i?{id:i.id,color:(null==(n=i.slot)?void 0:n.color)||Ui.gray,avatar:i.avatar,type:i.type,name:i.name,isHost:i.id===t}:null;lp&&s&&(this.logger.log("video conference @ on host participant did change - clear kick all participants timeout"),clearTimeout(lp),lp=null),this.publish("meeting.host-change",s)},this.onHostAvailabilityChange=t=>{this.logger.log("launcher service @ onHostAvailabilityChange"),t?this.publish("meeting.host-available"):this.publish("meeting.no-host-available")},this.onParticipantJoinedOnRealtime=t=>{this.logger.log("video conference @ on participant joined on realtime",t),this.publish("meeting.participant-joined",this.createParticipantFromPresence(t)),t.id===this.localParticipant.id&&this.room.presence.update(this.localParticipant)},this.onParticipantLeftOnRealtime=t=>{this.logger.log("video conference @ on participant left on realtime",t),this.publish("meeting.participant-left",this.createParticipantFromPresence(t))},this.onParticipantUpdateOnRealtime=t=>{this.logger.log("video conference @ on participant update on realtime",t);let{localParticipant:e,participants:n}=this.useStore("global-store");t.data.id===this.localParticipant.id&&this.publish("my-participant.update",this.createParticipantFromPresence(t)),n.publish(yi(vi({},n.value),{[t.data.id]:vi(vi({},e.value),t.data)}))},this.validateIfInTheRoomHasHost=()=>{var t,e;if(!this.roomState)return;let{hostId:n}=this.useStore("video-store"),{participants:r}=this.useStore("global-store"),i=Object.values(r.value),s=i.filter((t=>"host"===t.type&&this.participantsOnMeeting.some((e=>e.id===t.id))));!s.length&&this.kickParticipantsOnHostLeave&&"host"!==(null==(t=this.localParticipant)?void 0:t.type)&&!lp&&(this.logger.log("video conference @ validate if in the room has host - init kick all participants timeout"),lp=setTimeout((()=>{this.logger.log("video conference @ validate if in the room has host - kick all participants"),this.onKickLocalParticipant()}),6e4)),s.length&&lp&&(this.logger.log("video conference @ validade if in the room has host - clear kick all participants timeout"),clearTimeout(lp),lp=null),this.onHostAvailabilityChange(!!s.length);let o=i.find((t=>(null==t?void 0:t.id)===(null==n?void 0:n.value)));if(!s.length||o)return;let a=s.reduce(((t,e)=>(this.logger.log("video conference @ validate if in the room has host - reducing participants",{previous:t,current:e}),t&&(null==e?void 0:e.id)!==n.value&&(null==e?void 0:e.timestamp)>t.timestamp?t:e)),null);this.room.presence.update(yi(vi({},this.localParticipant),{isHost:a.id===this.localParticipant.id})),a&&a.id===(null==(e=this.localParticipant)?void 0:e.id)&&(this.logger.log("video conference @ validate if in the room has host - set host",a),n.publish(a.id),this.roomState.setHost(a.id))},this.params=yi(vi({},t),{userType:null!=(n=null!=(e=null==t?void 0:t.participantType)?e:null==t?void 0:t.userType)?n:"guest"}),this.name="videoConference",this.logger=new Ia("@superviz/sdk/videoConference"),this.browserService=new tp,this.connectionService=new ep,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}toggleMeetingSetup(){var t;return null==(t=this.videoManager)?void 0:t.publishMessageToFrame("meeting-controls.toggle-setup")}toggleMicrophone(){var t;if("audience"!==this.localParticipant.type)return null==(t=this.videoManager)?void 0:t.publishMessageToFrame("meeting-controls.toggle-microphone");console.warn("[SuperViz] Audience cannot toggle microphone")}toggleCam(){var t;"audience"!==this.localParticipant.type?null==(t=this.videoManager)||t.publishMessageToFrame("meeting-controls.toggle-cam"):console.warn("[SuperViz] Audience cannot toggle camera")}toggleScreenShare(){var t;if("audience"!==this.localParticipant.type)return null==(t=this.videoManager)?void 0:t.publishMessageToFrame("meeting-controls.toggle-screenshare");console.warn("[SuperViz] Audience cannot toggle screen share")}toggleChat(){var t;return null==(t=this.videoManager)?void 0:t.publishMessageToFrame("meeting-controls.toggle-chat")}toggleRecording(){var t;if(!this.localParticipant.isHost)return null==(t=this.videoManager)?void 0:t.publishMessageToFrame("meeting-controls.toggle-recording");console.warn("[SuperViz] Only host can toggle recording")}hangUp(){var t;null==(t=this.videoManager)||t.publishMessageToFrame("hang-up")}start(){this.logger.log("video conference @ start"),this.drawingRoom=this.ioc.createRoom("drawing"),this.subscribeToStoreUpdates(),this.suscribeToRealtimeEvents(),this.startVideo()}destroy(){var t,e,n;this.logger.log("video conference @ destroy");let{destroy:r}=this.useStore("video-store");r(),null==(t=this.roomState)||t.destroy(),this.drawingRoom.disconnect(),this.kickParticipantsOnHostLeave=!1,this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),null==(e=this.videoManager)||e.leave(),null==(n=this.connectionService)||n.removeListeners()}},MousePointers:mp,Realtime:_p,Comments:Yd,CanvasPin:class{constructor(t,e){if(this.isPinsVisible=!0,this.selectedPin=null,this.temporaryPinCoordinates=null,this.commentsSide="left",this.setCommentsMetadata=t=>{this.commentsSide=t},this.resetPins=t=>{t&&"Escape"!==(null==t?void 0:t.key)||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)},this.animate=()=>{(this.isActive||this.isPinsVisible)&&(this.renderAnnotationsPins(),this.divWrapper=this.renderDivWrapper()),this.temporaryPinCoordinates&&this.renderTemporaryPin(),this.animateFrame=requestAnimationFrame(this.animate)},this.setMouseDownCoordinates=t=>{let{x:e,y:n}=t;this.mouseDownCoordinates={x:e,y:n}},this.annotationSelected=t=>{let{detail:{uuid:e,haltGoToPin:n,newPin:r}}=t;var i,s;if(!e)return;r&&this.pins.get(e).setAttribute("newPin","");let o=JSON.parse(null!=(s=null==(i=this.selectedPin)?void 0:i.getAttribute("annotation"))?s:"{}");if(this.resetPins(),(null==o?void 0:o.uuid)===e)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let a=this.pins.get(e);a&&(a.setAttribute("active",""),this.selectedPin=a,!n&&this.goToPin(e))},this.onClick=t=>{if(!this.isActive)return;let e=this.canvas.getBoundingClientRect(),{x:n,y:r}=this.mouseDownCoordinates,i=n-e.x,s=r-e.y,o=t.clientX-e.left,a=t.clientY-e.top;if(Math.hypot(o-i,a-s)>10)return;let l=this.canvas.getContext("2d").getTransform().inverse(),c=new DOMPoint(o,a-31).matrixTransform(l);this.onPinFixedObserver.publish({x:c.x,y:c.y,type:"canvas"}),this.resetSelectedPin(),this.temporaryPinCoordinates={x:c.x,y:c.y},this.renderTemporaryPin();let u=document.getElementById("superviz-temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,u.setAttribute("movedPosition",String(this.movedTemporaryPin)),!this.selectedPin&&document.body.dispatchEvent(new CustomEvent("unselect-annotation"))},this.onToggleAnnotationSidebar=t=>{let{detail:e}=t,{open:n}=e;n||(this.pins.forEach((t=>{t.removeAttribute("active")})),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))},this.hideTemporaryPin=t=>{var e;let n=t.target,r=n.contains(this.canvas),{x:i,y:s}=t,{left:o,top:a,right:l,bottom:c}=this.canvas.getBoundingClientRect(),u=i>o&&i<l&&s>a&&s<c;this.canvas.contains(n)||null!=(e=this.pins.get("temporary-pin"))&&e.contains(n)||r&&u||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)},this.logger=new Ia("@superviz/sdk/comments-component/canvas-pin-adapter"),this.canvas=document.getElementById(t),this.isActive=!1,this.pins=new Map,this.goToPinCallback=null==e?void 0:e.onGoToPin,!this.canvas){let e=`Canvas with id ${t} not found`;throw this.logger.log(e),new Error(e)}this.canvasSides=this.canvas.getBoundingClientRect(),document.body.style.position="relative",this.onPinFixedObserver=new La({logger:this.logger}),this.divWrapper=this.renderDivWrapper(),this.annotations=[],this.renderAnnotationsPins(),this.animateFrame=requestAnimationFrame(this.animate),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("keyup",this.resetPins)}destroy(){this.isActive=!1,this.removeListeners(),this.removeAnnotationsPins(),this.pins=new Map,this.divWrapper.remove(),this.divWrapper=null,this.onPinFixedObserver.destroy(),this.onPinFixedObserver=null,this.canvas.style.cursor="default",this.annotations=[],cancelAnimationFrame(this.animateFrame),document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("keyup",this.resetPins)}setPinsVisibility(t){this.isPinsVisible=t,this.isPinsVisible?this.renderAnnotationsPins():this.removeAnnotationsPins()}setActive(t){if(this.isActive!==t){if(this.isActive=t,this.isActive)return this.originalCanvasCursor=this.canvas.style.cursor,this.canvas.style.cursor='url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer',void this.addListeners();this.resetPins(),this.removeListeners(),this.canvas.style.cursor=this.originalCanvasCursor}}updateAnnotations(t){this.logger.log("updateAnnotations",t),this.annotations=t,(this.isActive||this.isPinsVisible)&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}removeAnnotationPin(t){let e=this.pins.get(t);e&&(e.remove(),this.pins.delete(t),"temporary-pin"!==t&&(this.annotations=this.annotations.filter((e=>e.uuid!==t))))}renderTemporaryPin(){let t=document.getElementById("superviz-temporary-pin");t||(t=document.createElement("superviz-comments-annotation-pin"),t.id="superviz-temporary-pin",t.setAttribute("type","add"),t.setAttribute("showInput",""),t.setAttribute("containerSides",JSON.stringify(this.canvasSides)),t.setAttribute("commentsSide",this.commentsSide),t.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),t.setAttribute("annotation",JSON.stringify({})),t.setAttribute("participantsList",JSON.stringify(this.participants)),t.setAttributeNode(document.createAttribute("active")),this.divWrapper.appendChild(t));let{x:e,y:n}=this.temporaryPinCoordinates,r=this.canvas.getContext("2d").getTransform(),i=r.e,s=r.f,o=e*r.a+i,a=n*r.d+s;t.setAttribute("position",JSON.stringify({x:o,y:a})),this.pins.set("temporary-pin",t)}addListeners(){this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousedown",this.setMouseDownCoordinates),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousedown",this.setMouseDownCoordinates),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}resetSelectedPin(){this.selectedPin&&(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}renderDivWrapper(){let t=this.canvas.getBoundingClientRect(),e=this.divWrapper;return e||(e=document.createElement("div"),e.id="superviz-canvas-wrapper",["","static"].includes(this.canvas.parentElement.style.position)&&(this.canvas.parentElement.style.position="relative")),e.style.position="absolute",e.style.top=`${this.canvas.offsetTop}px`,e.style.left=`${this.canvas.offsetLeft}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden",document.getElementById("superviz-canvas-wrapper")||this.canvas.parentElement.appendChild(e),e}renderAnnotationsPins(){this.annotations.length&&"none"!==this.canvas.style.display||this.pins.get("temporary-pin")?this.annotations.forEach((t=>{if(t.resolved)return;let e=JSON.parse(t.position);if("canvas"!==(null==e?void 0:e.type))return;let{x:n,y:r}=e,i=this.canvas.getContext("2d").getTransform(),s=i.e,o=i.f,a=n*i.a+s,l=r*i.d+o;if(this.pins.has(t.uuid)){let e=this.pins.get(t.uuid);return this.divWrapper.clientWidth>a&&this.divWrapper.clientHeight>l?(e.setAttribute("style","opacity: 1"),void this.pins.get(t.uuid).setAttribute("position",JSON.stringify({x:a,y:l}))):void e.setAttribute("style","opacity: 0")}let c=document.createElement("superviz-comments-annotation-pin");c.setAttribute("type","show"),c.setAttribute("participantsList",JSON.stringify(this.participants)),c.setAttribute("annotation",JSON.stringify(t)),c.setAttribute("position",JSON.stringify({x:a,y:l})),c.id=t.uuid,this.divWrapper.appendChild(c),this.pins.set(t.uuid,c)})):this.removeAnnotationsPins()}removeAnnotationsPins(){this.pins.forEach((t=>{t.remove()})),this.pins.clear()}set participantsList(t){this.participants=t}goToPin(t){let e=this.annotations.find((e=>e.uuid===t));if(!e)return;let n=JSON.parse(e.position);if("canvas"!==(null==n?void 0:n.type))return;let r=this.canvas.getBoundingClientRect(),{width:i,height:s}=r,{x:o,y:a}=n,l=i/2-o,c=s/2-a;this.goToPinCallback&&this.goToPinCallback({x:l,y:c})}},HTMLPin:Kd,WhoIsOnline:bp,FormElements:class extends Jd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.fields={},this.fieldsOriginalOutline={},this.focusList={},this.enabledOutlineFields={},this.enabledRealtimeSyncFields={},this.flags={},this.allowedTagNames=["input","textarea"],this.allowedInputTypes=["text","email","date","color","datetime-local","month","number","password","range","search","tel","time","url","week","checkbox","radio"],this.throwError={onInvalidFieldsProp:t=>{throw new Error(`"Fields" property must be either a string or an array of strings. Received type: ${t}`)},onFieldNotFound:t=>{throw new Error(`You must pass the id of an existing element. Element with id ${t} not found`)},onInvalidTagName:t=>{throw new Error(`You can't register an element with tag ${t}. Only the tags "${this.allowedTagNames.join(", ")}" are allowed`)},onInvalidInputType:t=>{throw new Error(`You can't register an input element of type ${t}. Only the types "${this.allowedInputTypes.join(", ")}" are allowed`)},onDeregisterInvalidField:t=>{throw new Error(`You can't deregister field of id ${t}. No field was registered with id ${t} `)}},this.sync=t=>{var e,n;let r=this.fields[t],i=this.hasCheckedProperty(r),s={value:i?r.checked:r.value,color:this.localParticipant.slot.color,fieldId:t,showOutline:this.canUpdateColor(t),syncContent:this.canSyncContent(t),attribute:i?"checked":"value"};null==(e=this.room)||e.emit("field.content-change"+t,s),null==(n=this.room)||n.emit("field.interaction"+t,s)},this.handleInput=t=>{var e,n,r,i;let s=t.target;null==(n=this.room)||n.emit("field.interaction"+s.id,{fieldId:s.id,color:null==(e=this.localParticipant.slot)?void 0:e.color});let o=this.canSyncContent(s.id);if(!o)return;let a={value:s.value,color:null==(r=this.localParticipant.slot)?void 0:r.color,fieldId:s.id,showOutline:this.canUpdateColor(s.id),syncContent:o,attribute:"value"};null==(i=this.room)||i.emit("field.content-change"+s.id,a)},this.handleChange=t=>{var e;let n=t.target;if(!this.canSyncContent(n.id))return;let r={fieldId:n.id,value:n.checked,color:this.localParticipant.slot.color,showOutline:this.canUpdateColor(n.id),syncContent:this.canSyncContent(n.id),attribute:"checked"};null==(e=this.room)||e.emit("field.content-change"+n.id,r)},this.handleFocus=t=>{var e;let n=t.target,r={color:this.localParticipant.slot.color,fieldId:n.id};null==(e=this.room)||e.emit("field.focus"+n.id,r)},this.handleBlur=t=>{var e;let n=t.target,r={fieldId:n.id};null==(e=this.room)||e.emit("field.blur"+n.id,r)},this.removeFieldColor=t=>{let{presence:e,data:{fieldId:n}}=t;var r,i;(null==(r=this.focusList[n])?void 0:r.id)!==e.id||!this.fields[n]||(this.fields[n].style.outline=null!=(i=this.fieldsOriginalOutline[n])?i:"",delete this.fieldsOriginalOutline[n],delete this.focusList[n])},this.updateFieldColor=t=>{let{presence:e,data:{color:n,fieldId:r},timestamp:i}=t;var s;let o=null!=(s=this.focusList[r])?s:{},a=!o.id,l=e.id===this.localParticipant.id;if(a&&l)return void(this.focusList[r]={id:e.id,color:n,firstInteraction:i,lastInteraction:i});if(o.id===e.id)return void(this.focusList[r].lastInteraction=i);let c=i-o.lastInteraction>=3e3,u=i-o.firstInteraction>=1e4;if(!(c||u||a))return;this.focusList[r]={id:e.id,color:n,firstInteraction:i,lastInteraction:i};let h=l?this.fieldsOriginalOutline[r]:`1px solid ${n}`;this.fields[r].style.outline=h},this.updateFieldContent=t=>{var e=t,{presence:n,data:{value:r,fieldId:i,color:s,showOutline:o,syncContent:a,attribute:l},timestamp:c}=e,u=_i(e,["presence","data","timestamp"]);this.publish("field.content-change",{value:r,fieldId:i,attribute:l,userId:n.id,userName:n.name,timestamp:c}),a&&this.canSyncContent(i)&&n.id!==this.localParticipant.id&&(this.fields[i][l]=r),o&&this.canUpdateColor(i)&&this.updateFieldColor(vi({presence:n,data:{color:s,fieldId:i},timestamp:c},u))},this.publishTypedEvent=t=>{let{presence:e,data:{fieldId:n,color:r}}=t;this.publish("field.interaction",{fieldId:n,userId:e.id,userName:e.name,color:r})},this.canSyncContent=t=>!this.flags.disableRealtimeSync&&!1!==this.enabledRealtimeSyncFields[t]||!!this.enabledRealtimeSyncFields[t],this.name="formElements",this.logger=new Ia("@superviz/sdk/presence-input-component");let e=t,{fields:n}=e,r=_i(e,["fields"]);if(this.flags=r??{},"string"==typeof n)return this.validateField(n),void(this.fields[n]=null);Array.isArray(n)?n.forEach((t=>{this.validateField(t),this.fields[t]=null})):void 0!==n&&this.throwError.onInvalidFieldsProp(typeof n)}enableOutline(t){let e=this.fields[t];e&&(this.enabledOutlineFields[t]=!0,this.fieldsOriginalOutline[t]=e.style.outline,e.addEventListener("focus",this.handleFocus),e.addEventListener("blur",this.handleBlur),this.room.on("field.focus"+t,this.updateFieldColor),this.room.on("field.blur"+t,this.removeFieldColor))}disableOutline(t){var e,n;let r=this.fields[t];r&&(this.enabledOutlineFields[t]=!1,r.style.outline=null!=(e=this.fieldsOriginalOutline[t])?e:"",r.removeEventListener("focus",this.handleFocus),r.removeEventListener("blur",this.handleBlur),this.room.off("field.focus"+t,this.updateFieldColor),this.room.off("field.blur"+t,this.removeFieldColor),null==(n=this.room)||n.emit("field.blur"+t,{fieldId:t}))}enableRealtimeSync(t){this.enabledRealtimeSyncFields[t]=!0}disableRealtimeSync(t){this.enabledRealtimeSyncFields[t]=!1}registerField(t){this.validateField(t);let e=document.getElementById(t);this.fields[t]=e,this.addListenersToField(e),this.addRealtimeListenersToField(t),this.fieldsOriginalOutline[t]=e.style.outline}deregisterField(t){var e;this.fields[t]||this.throwError.onDeregisterInvalidField(t),this.removeListenersFromField(this.fields[t]),this.removeRealtimeListenersFromField(t),this.fields[t].style.outline=this.fieldsOriginalOutline[t],this.fields[t]=void 0,delete this.enabledOutlineFields[t],delete this.enabledRealtimeSyncFields[t],delete this.fieldsOriginalOutline[t],delete this.focusList[t],null==(e=this.room)||e.emit("field.blur"+t,{fieldId:t})}start(){let{localParticipant:t}=this.useStore("global-store");t.subscribe(),Object.entries(this.fields).forEach((t=>{let[e]=t;this.registerField(e)}))}destroy(){this.restoreOutlines(),this.deregisterAllFields(),this.fieldsOriginalOutline=void 0,this.focusList=void 0}addListenersToField(t){this.hasCheckedProperty(t)?t.addEventListener("change",this.handleChange):t.addEventListener("input",this.handleInput),!this.flags.disableOutline&&(t.addEventListener("focus",this.handleFocus),t.addEventListener("blur",this.handleBlur))}addRealtimeListenersToField(t){this.room&&(this.room.on("field.content-change"+t,this.updateFieldContent),this.room.on("field.interaction"+t,this.publishTypedEvent),!this.flags.disableOutline&&(this.room.on("field.focus"+t,this.updateFieldColor),this.room.on("field.blur"+t,this.removeFieldColor)))}removeListenersFromField(t){this.hasCheckedProperty(t)?t.removeEventListener("change",this.handleChange):t.removeEventListener("input",this.handleInput),!this.flags.disableOutline&&(t.removeEventListener("focus",this.handleFocus),t.removeEventListener("blur",this.handleBlur))}removeRealtimeListenersFromField(t){this.room&&(this.room.off("field.content-change"+t,this.updateFieldContent),this.room.off("field.interaction"+t,this.publishTypedEvent),!this.flags.disableOutline&&(this.room.off("field.focus"+t,this.updateFieldColor),this.room.off("field.blur"+t,this.removeFieldColor)))}deregisterAllFields(){Object.keys(this.fields).forEach((t=>{this.deregisterField(t)})),this.fields=void 0}validateField(t){this.validateFieldId(t);let e=document.getElementById(t);this.validateFieldTagName(e),this.validateFieldType(e)}validateFieldTagName(t){let e=t.tagName.toLowerCase();this.allowedTagNames.includes(e)||(this.logger.log("invalid element tagname"),this.throwError.onInvalidTagName(e))}validateFieldType(t){if("input"!==t.tagName.toLowerCase())return;let e=t.getAttribute("type"),n=this.allowedInputTypes.includes(e);e&&!n&&(this.logger.log("invalid input type"),this.throwError.onInvalidInputType(e))}validateFieldId(t){document.getElementById(t)||this.throwError.onFieldNotFound(t)}restoreOutlines(){Object.entries(this.fields).forEach((t=>{let[e]=t;this.fields[e].style.outline=this.fieldsOriginalOutline[e]}))}hasCheckedProperty(t){let e=t.tagName.toLowerCase(),n=t.getAttribute("type");return"input"===e&&("radio"===n||"checkbox"===n)}canUpdateColor(t){return!this.flags.disableOutline&&!1!==this.enabledOutlineFields[t]||this.enabledOutlineFields[t]}},ParticipantType:zd,LayoutPosition:jd,CamerasPosition:Gd,RealtimeComponentState:qd,RealtimeComponentEvent:$d,ComponentLifeCycleEvent:ki,WhoIsOnlineEvent:Di,StoreType:Wi,PresenceEvents:nl,FieldEvents:Xd,PinMode:Hi,Comment:Comment});var xp=Hd,wp=Object.create,Sp=Object.defineProperty,Mp=Object.defineProperties,Ep=Object.getOwnPropertyDescriptor,Tp=Object.getOwnPropertyDescriptors,Ap=Object.getOwnPropertyNames,Cp=Object.getOwnPropertySymbols,Pp=Object.getPrototypeOf,Ip=Object.prototype.hasOwnProperty,Rp=Object.prototype.propertyIsEnumerable,Lp=(t,e,n)=>e in t?Sp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Np=(t,e)=>{for(var n in e||(e={}))Ip.call(e,n)&&Lp(t,n,e[n]);if(Cp)for(var n of Cp(e))Rp.call(e,n)&&Lp(t,n,e[n]);return t},Op=(t,e)=>Mp(t,Tp(e)),kp=(t,e)=>function(){return e||(0,t[Ap(t)[0]])((e={exports:{}}).exports,e),e.exports},Dp=(t,e,n)=>new Promise(((r,i)=>{var s=t=>{try{a(n.next(t))}catch(e){i(e)}},o=t=>{try{a(n.throw(t))}catch(e){i(e)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,o);a((n=n.apply(t,e)).next())})),zp=kp({"../../node_modules/.pnpm/ms@2.1.3/node_modules/ms/index.js"(t,e){var n=1e3,r=60*n,i=60*r,s=24*i,o=7*s,a=365.25*s;function l(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}e.exports=function(t,e){e=e||{};var c=typeof t;if("string"===c&&t.length>0)return function(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var l=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*a;case"weeks":case"week":case"w":return l*o;case"days":case"day":case"d":return l*s;case"hours":case"hour":case"hrs":case"hr":case"h":return l*i;case"minutes":case"minute":case"mins":case"min":case"m":return l*r;case"seconds":case"second":case"secs":case"sec":case"s":return l*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}(t);if("number"===c&&isFinite(t))return e.long?function(t){var e=Math.abs(t);return e>=s?l(t,e,s,"day"):e>=i?l(t,e,i,"hour"):e>=r?l(t,e,r,"minute"):e>=n?l(t,e,n,"second"):t+" ms"}(t):function(t){var e=Math.abs(t);return e>=s?Math.round(t/s)+"d":e>=i?Math.round(t/i)+"h":e>=r?Math.round(t/r)+"m":e>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}}}),Up=kp({"../../node_modules/.pnpm/debug@4.3.7/node_modules/debug/src/common.js"(t,e){e.exports=function(t){function e(t){let r,i,s,o=null;function a(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!a.enabled)return;const s=a,o=Number(new Date),l=o-(r||o);s.diff=l,s.prev=r,s.curr=o,r=o,n[0]=e.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");let c=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,((t,r)=>{if("%%"===t)return"%";c++;const i=e.formatters[r];if("function"==typeof i){const e=n[c];t=i.call(s,e),n.splice(c,1),c--}return t})),e.formatArgs.call(s,n),(s.log||e.log).apply(s,n)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=n,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function n(t,n){const r=e(this.namespace+(typeof n>"u"?":":n)+t);return r.log=this.log,r}function r(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){const t=[...e.names.map(r),...e.skips.map(r).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){let n;e.save(t),e.namespaces=t,e.names=[],e.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=zp(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e}}}),Fp=kp({"../../node_modules/.pnpm/debug@4.3.7/node_modules/debug/src/browser.js"(t,e){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch{}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:"/react-elden-ring-mind-map",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUPA_ANON:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdiZHlydXJ6eXlmbXVvYmVja2l0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjkzMzAyNDcsImV4cCI6MjA0NDkwNjI0N30.s5aKdX6BdWojAewKoJwCcvBVzCHJumwbe8cok9Z0yv4",REACT_APP_SUPA_URL:"https://gbdyrurzyyfmuobeckit.supabase.co",REACT_APP_SUPVIZ:"96ai280e79vr8qgpw42kk8gj7gixre"}.DEBUG),e},t.useColors=function(){if(typeof window<"u"&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch{}}(),t.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=Up()(t);var{formatters:n}=e.exports;n.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}}),Bp=()=>new Map,Vp=()=>new Set,Hp=Array.from,jp=class{constructor(){this._observers=Bp()}on(t,e){return((t,e,n)=>{let r=t.get(e);return void 0===r&&t.set(e,r=n()),r})(this._observers,t,Vp).add(e),e}once(t,e){var n=this;const r=function(){n.off(t,r),e(...arguments)};this.on(t,r)}off(t,e){const n=this._observers.get(t);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(t))}emit(t,e){return Hp((this._observers.get(t)||Bp()).values()).forEach((t=>t(...e)))}destroy(){this._observers=Bp()}},Wp=class extends jp{constructor(t,e){super(),this.doc=t,this.logger=e,this.clientID=0,this.states=new Map,this._checkInterval=null,this.meta=new Map,this.participantIdToClientId=new Map,this.room=null,this.TIMEOUT_TIMER_MS=3e4,this.YJS_STATE="__yjs",this.previousState=null,this.participantId="",this.setLocalState=t=>{var e,n;if(this.logger.log("[SuperViz | Awareness] - Set local state",t),null===t){if(!this.states.has(this.clientID))return;this.states.delete(this.clientID),null==(e=this.room)||e.presence.update(Op(Np({},this.states.get(this.clientID)),{[this.YJS_STATE]:null,origin:"set local state null"}));const t={added:[],updated:[],removed:[this.clientID]};return void this.emit("change",[t,"local"])}const r={added:[],updated:[],removed:[]};let i=this.states.get(this.clientID);i?r.updated.push(this.clientID):(i={[this.YJS_STATE]:{},clientID:this.clientID},r.added.push(this.clientID));const s=Op(Np({},i),{[this.YJS_STATE]:t,origin:"set local state"});this.states.set(this.clientID,s),null==(n=this.room)||n.presence.update(s),this.emit("change",[r,"local"])},this.onLeave=t=>{const e=this.participantIdToClientId.get(t.id);if(this.logger.log("[SuperViz | Awareness] - Participant left",{participant:t,clientID:e}),!e)return;if(e===this.clientID){const t=Array.from(this.states.keys());return void this.removeAwarenessStates(t,"presence")}const n={added:[],updated:[],removed:[e]};this.participantIdToClientId.delete(t.id),this.states.delete(e),this.emit("update",[n,"presence"]),this.emit("change",[n,"presence"])},this.onUpdate=t=>{if(t.id===this.participantId)return;if(this.logger.log("[SuperViz | Awareness] - Participant updated",t),null===t.data[this.YJS_STATE])return void this.removeAwarenessStates([t.data.clientID],"presence");const e=[],n=[];let r=this.participantIdToClientId.get(t.id);r?n.push(t.data.clientID):(this.participantIdToClientId.set(t.id,t.data.clientID),r=t.data.clientID,e.push(t.data.clientID)),this.states.set(r,Np(Np({},this.states.get(r)||{}),t.data)),this.emit("update",[{added:e,updated:n,removed:[]},"presence"]),this.emit("change",[{added:e,updated:n,removed:[]},"presence"])},this.onVisibilityChange=()=>{if("visible"===document.visibilityState)return clearTimeout(this.visibilityTimeout),void(this.previousState&&(this.setLocalState(this.previousState),this.previousState=null));this.visibilityTimeout=setTimeout((()=>{this.previousState=this.getLocalState(),this.setLocalState(null)}),this.TIMEOUT_TIMER_MS)},this.clientID=this.doc.clientID}connect(t,e){this.logger.log("[SuperViz | Awareness] - Connect awareness to room"),this.participantId=t,this.room=e,this.addRoomListeners(),this.addDocumentListeners(),this.initializePresences()}destroy(){this.logger.log("[SuperViz | Awareness] - Destroy awareness"),this.setLocalState(null),this.removeAwarenessStates(Array.from(this.states.keys()),"local"),clearTimeout(this.visibilityTimeout),this.visibilityTimeout=void 0,this.removeDocumentListeners(),this.removeRoomListeners(),this.room=null,this.states.clear(),this.participantIdToClientId.clear(),this.onLeave({id:this.participantId})}getLocalState(){var t;this.logger.log("[SuperViz | Awareness] - Get local state",null==(t=this.states.get(this.clientID))?void 0:t[this.YJS_STATE]);const e=this.states.get(this.clientID);return e&&e[this.YJS_STATE]?e[this.YJS_STATE]:null}getStates(){const t=new Map;return this.states.forEach(((e,n)=>{t.set(n,e[this.YJS_STATE])})),this.logger.log("[SuperViz | Awareness] - Get states",t),t}setLocalStateField(t,e){this.logger.log("[SuperViz | Awareness] - Set local state field",{field:t,value:e});const n=this.getLocalState();this.setLocalState(Op(Np({},n||{}),{[t]:e}))}addRoomListeners(){this.room.presence.on("presence.update",this.onUpdate),this.room.presence.on("presence.leave",this.onLeave)}removeRoomListeners(){this.room.presence.off("presence.update"),this.room.presence.off("presence.leave")}addDocumentListeners(){document.addEventListener("visibilitychange",this.onVisibilityChange)}removeDocumentListeners(){document.removeEventListener("visibilitychange",this.onVisibilityChange)}initializePresences(){this.room.presence.get((t=>{const e=[];t.forEach((t=>{const{clientID:n}=t.data;n&&(e.push(n),this.participantIdToClientId.set(t.id,n),this.states.set(n,Np({},t.data)))}));const{clientID:n}=this.doc;this.room.presence.update(Op(Np({clientID:n,[this.YJS_STATE]:{}},this.states.get(n)||{}),{origin:"on connect"}));const r={added:e,updated:[],removed:[]};this.emit("change",[r,"presence"])}))}removeAwarenessStates(t,e){this.logger.log("[SuperViz | Awareness] - Remove awareness states",{removed:t,origin:e});const n={added:[],updated:[],removed:[]};t.forEach((t=>{this.states.get(t)&&(this.states.delete(t),n.removed.push(t))})),this.emit("change",[n,e])}},Gp=((t,e,n)=>(n=null!=t?wp(Pp(t)):{},((t,e,n,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of Ap(e))!Ip.call(t,i)&&i!==n&&Sp(t,i,{get:()=>e[i],enumerable:!(r=Ep(e,i))||r.enumerable});return t})(Sp(n,"default",{value:t,enumerable:!0}),t)))(Fp()),qp=class{constructor(t,e){this.prefix=e,this.debug=(0,Gp.default)(t)}log(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.debug(`${this.prefix} -`,t,...n)}};var $p="global-store";typeof window<"u"&&(window.SuperVizYjsProvider=class extends jp{constructor(t,e){super(),this.doc=t,this.name="yjsProvider",this._synced=!1,this.state="provider.disconnected",this.isAttached=!1,this.localParticipant=null,this.room=null,this.ioc=null,this.fetch=()=>Dp(this,null,(function*(){this.logger.log("Fetching the document"),this._synced=!1;const t=yield function(t,e){return Dp(this,null,(function*(){try{const n=yield fetch(`https://io.superviz.com/yjs/${t}:yjs-provider`,{headers:{"sv-api-key":e}});return 200!==n.status?[]:(yield n.json()).events.map((t=>new Uint8Array(t.update.data)))}catch{return[]}}))}(this.roomId,this.ioc.client.apiKey);this._synced=!0,t.length&&Ue(this.doc,Mn(t))})),this.updateDocument=t=>{this.logger.log("Applying remote update",t),Ue(this.doc,t,this)},this.onDocUpdate=t=>{this.logger.log("Local document update",t),this.beforeSendRealtimeMessage("provider.update",{update:t}),this.room.emit("provider.update",{update:t})},this.onLocalJoinRoom=t=>{var e;if("provider.connected"===this.state||t.id!==this.localParticipant.id)return;this.logger.log("Joined the room",t),null==(e=this.awareness)||e.connect(this.localParticipant.id,this.room),this.changeState("provider.connected"),this.emit("connect",[]);const n=Fe(this.doc);this.beforeSendRealtimeMessage("provider.update",{update:n}),this.room.emit("provider.update",{update:n}),this.fetch()},this.onConnectionChange=t=>{"DISCONNECTED"===t.state&&(this.logger.log("Disconnected from the room"),this.emit("disconnect",[]))},this.onRemoteDocUpdate=t=>{var e;if((null==(e=t.presence)?void 0:e.id)===this.localParticipant.id)return;this.logger.log("Received remote document update",t);const n=new Uint8Array(t.data.update);this.onReceiveRealtimeMessage("provider.update",{update:n}),this.updateDocument(n)},this.onReceiveRealtimeMessage=(t,e)=>{this.logger.log("Received message from room",{name:t,data:e}),this.emit("message",[{name:t,data:e}])},this.beforeSendRealtimeMessage=(t,e)=>{this.logger.log("Sending message to room",{name:t,data:e}),this.emit("outgoingMessage",[{name:t,data:e}])},this.document=t,this.logger=new qp("SuperVizYjsProvider","[SuperViz | YjsProvider] - "),!1!==(null==e?void 0:e.awareness)&&(this.awareness=new Wp(this.doc,this.logger))}attach(t){if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){const t=`${this.name} @ attach - params are required`;throw this.logger.log(t),new Error(t)}const{useStore:e,ioc:n,config:r}=t,{isDomainWhitelisted:i,hasJoinedRoom:s,localParticipant:o}=e($p);if(i.value)s.value?(this.roomId=r.roomId,this.ioc=n,this.localParticipant=o.value,this.isAttached=!0,this.connect(),this.emit("mount",[])):s.subscribe((()=>this.attach(t)));else{const t=`Component ${this.name} can't be used because this website's domain is not whitelisted. Please add your domain in https://dashboard.superviz.com/developer`;this.logger.log(t)}}detach(){this.isAttached?(this.logger.log("detached"),this.destroyProvider(),super.destroy(),this.emit("unmount",[])):this.logger.log(`${this.name} @ detach - component is not attached`)}connect(){"provider.disconnected"===this.state&&(this.logger.log("Connecting to the room"),this.changeState("provider.connecting"),this.doc.on("updateV2",this.onDocUpdate),this.startRealtime())}destroyProvider(){var t;"provider.disconnected"!==this.state?(this.logger.log("Destroying the provider"),this.emit("destroy",[]),this._synced=!1,null==(t=this.awareness)||t.destroy(),this.doc.off("updateV2",this.onDocUpdate),this.removeRoomListeners(),this.room&&(this.room.disconnect(),this.room=null),this.changeState("provider.disconnected")):this.logger.log("Can't destroy. Provider disconnected")}get synced(){return this._synced}createRoom(){this.logger.log("Creating room"),this.room=this.ioc.createRoom("yjs-provider")}addRoomListeners(){this.logger.log("Adding room listeners"),this.room.on("provider.update",this.onRemoteDocUpdate),this.room.presence.on("presence.joined-room",this.onLocalJoinRoom),this.ioc.client.connection.on(this.onConnectionChange)}removeRoomListeners(){var t;this.logger.log("Removing room listeners"),this.room&&(this.room.off("provider.update",this.onRemoteDocUpdate),this.room.presence.off("presence.joined-room")),null==(t=this.ioc)||t.client.connection.off()}startRealtime(){this.createRoom(),this.addRoomListeners()}changeState(t){this.logger.log("Changing state",t),this.emit("state",[t]),this.state=t}})}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={exports:{}};return t[r].call(s.exports,s,s.exports,n),s.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},(()=>{var t,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var s=Object.create(null);n.r(s);var o={};t=t||[null,e({}),e([]),e(e)];for(var a=2&i&&r;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>o[t]=()=>r[t]));return o.default=()=>r,n.d(s,o),s}})(),n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.f={},n.e=t=>Promise.all(Object.keys(n.f).reduce(((e,r)=>(n.f[r](t,e),e)),[])),n.u=t=>"static/js/"+t+"."+{83:"32d6b835",90:"746bf456",157:"1f5ad173",251:"dbf62486",277:"281e37d6",356:"26816656",401:"2b104c7a",410:"453b7dab",426:"e543cdfb",453:"d4294deb",513:"1989cad9",523:"e8a5c370",546:"fe90d47b",646:"1c91f534",739:"f62e80ec",801:"da77fd88",830:"f088bc45",844:"f362849f",846:"d37a530e",898:"839899fd",921:"992ddc9a",952:"ff7281ce",999:"6d1dde8c"}[t]+".chunk.js",n.miniCssF=t=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={},e="react-elden-ring-mind-map:";n.l=(r,i,s,o)=>{if(t[r])t[r].push(i);else{var a,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==r||h.getAttribute("data-webpack")==e+s){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",e+s),a.src=r),t[r]=[i];var d=(e,n)=>{a.onerror=a.onload=null,clearTimeout(p);var i=t[r];if(delete t[r],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((t=>t(n))),e)return e(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),n.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.p="/react-elden-ring-mind-map/",(()=>{var t={792:0};n.f.j=(e,r)=>{var i=n.o(t,e)?t[e]:void 0;if(0!==i)if(i)r.push(i[2]);else{var s=new Promise(((n,r)=>i=t[e]=[n,r]));r.push(i[2]=s);var o=n.p+n.u(e),a=new Error;n.l(o,(r=>{if(n.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var s=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;a.message="Loading chunk "+e+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,i[1](a)}}),"chunk-"+e,e)}};var e=(e,r)=>{var i,s,o=r[0],a=r[1],l=r[2],c=0;if(o.some((e=>0!==t[e]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)l(n)}for(e&&e(r);c<o.length;c++)s=o[c],n.o(t,s)&&t[s]&&t[s][0](),t[s]=0},r=self.webpackChunkreact_elden_ring_mind_map=self.webpackChunkreact_elden_ring_mind_map||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})(),(()=>{"use strict";var t=n(5043),e=n.t(t,2),r=n(4391);class i extends Error{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FunctionsError",n=arguments.length>2?arguments[2]:void 0;super(t),this.name=e,this.context=n}}class a extends i{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class l extends i{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class c extends i{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var u;!function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"}(u||(u={}));var h=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(jR){s(jR)}}function a(t){try{l(r.throw(t))}catch(jR){s(jR)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))};class d{constructor(t){let{headers:e={},customFetch:r,region:i=u.Any}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=t,this.headers=e,this.region=i,this.fetch=(t=>{let e;return e=t||("undefined"===typeof fetch?function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return Promise.resolve().then(n.bind(n,4630)).then((t=>{let{default:n}=t;return n(...e)}))}:fetch),function(){return e(...arguments)}})(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return h(this,void 0,void 0,(function*(){try{const{headers:r,method:i,body:s}=e;let o,u={},{region:h}=e;h||(h=this.region),h&&"any"!==h&&(u["x-region"]=h),s&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!==typeof Blob&&s instanceof Blob||s instanceof ArrayBuffer?(u["Content-Type"]="application/octet-stream",o=s):"string"===typeof s?(u["Content-Type"]="text/plain",o=s):"undefined"!==typeof FormData&&s instanceof FormData?o=s:(u["Content-Type"]="application/json",o=JSON.stringify(s)));const d=yield this.fetch(`${this.url}/${t}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},u),this.headers),r),body:o}).catch((t=>{throw new a(t)})),p=d.headers.get("x-relay-error");if(p&&"true"===p)throw new l(d);if(!d.ok)throw new c(d);let f,m=(null!==(n=d.headers.get("Content-Type"))&&void 0!==n?n:"text/plain").split(";")[0].trim();return f="application/json"===m?yield d.json():"application/octet-stream"===m?yield d.blob():"text/event-stream"===m?d:"multipart/form-data"===m?yield d.formData():yield d.text(),{data:f,error:null}}catch(r){return{data:null,error:r}}}))}}var p=n(7980);const{PostgrestClient:f,PostgrestQueryBuilder:m,PostgrestFilterBuilder:g,PostgrestTransformBuilder:y,PostgrestBuilder:_}=p,b={"X-Client-Info":"realtime-js/2.10.7"};var x,S,M,E,T,A;!function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"}(x||(x={})),function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"}(S||(S={})),function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"}(M||(M={})),function(t){t.websocket="websocket"}(E||(E={})),function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"}(T||(T={}));class C{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this._binaryDecode(t)):e("string"===typeof t?JSON.parse(t):{})}_binaryDecode(t){const e=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,e,n)}_decodeBroadcast(t,e,n){const r=e.getUint8(1),i=e.getUint8(2);let s=this.HEADER_LENGTH+2;const o=n.decode(t.slice(s,s+r));s+=r;const a=n.decode(t.slice(s,s+i));s+=i;return{ref:null,topic:o,event:a,payload:JSON.parse(n.decode(t.slice(s,t.byteLength)))}}}class P{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}!function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"}(A||(A={}));const I=function(t,e){var n;const r=null!==(n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipTypes)&&void 0!==n?n:[];return Object.keys(e).reduce(((n,i)=>(n[i]=R(i,t,e,r),n)),{})},R=(t,e,n,r)=>{const i=e.find((e=>e.name===t)),s=null===i||void 0===i?void 0:i.type,o=n[t];return s&&!r.includes(s)?L(s,o):N(o)},L=(t,e)=>{if("_"===t.charAt(0)){const n=t.slice(1,t.length);return z(e,n)}switch(t){case A.bool:return O(e);case A.float4:case A.float8:case A.int2:case A.int4:case A.int8:case A.numeric:case A.oid:return k(e);case A.json:case A.jsonb:return D(e);case A.timestamp:return U(e);case A.abstime:case A.date:case A.daterange:case A.int4range:case A.int8range:case A.money:case A.reltime:case A.text:case A.time:case A.timestamptz:case A.timetz:case A.tsrange:case A.tstzrange:default:return N(e)}},N=t=>t,O=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},k=t=>{if("string"===typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},D=t=>{if("string"===typeof t)try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},z=(t,e)=>{if("string"!==typeof t)return t;const n=t.length-1,r=t[n];if("{"===t[0]&&"}"===r){let r;const s=t.slice(1,n);try{r=JSON.parse("["+s+"]")}catch(i){r=s?s.split(","):[]}return r.map((t=>L(e,t)))}return t},U=t=>"string"===typeof t?t.replace(" ","T"):t,F=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class B{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;this.channel=t,this.event=e,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var n;return this._hasReceived(t)&&e(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},(t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive(t){let{status:e,response:n}=t;this.recHooks.filter((t=>t.status===e)).forEach((t=>t.callback(n)))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var V,H,W,G;!function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"}(V||(V={}));class q{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(null===e||void 0===e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},(t=>{const{onJoin:e,onLeave:n,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=q.syncState(this.state,t,e,n),this.pendingDiffs.forEach((t=>{this.state=q.syncDiff(this.state,t,e,n)})),this.pendingDiffs=[],r()})),this.channel._on(n.diff,{},(t=>{const{onJoin:e,onLeave:n,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=q.syncDiff(this.state,t,e,n),r())})),this.onJoin(((t,e,n)=>{this.channel._trigger("presence",{event:"join",key:t,currentPresences:e,newPresences:n})})),this.onLeave(((t,e,n)=>{this.channel._trigger("presence",{event:"leave",key:t,currentPresences:e,leftPresences:n})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(t,e,n,r){const i=this.cloneDeep(t),s=this.transformState(e),o={},a={};return this.map(i,((t,e)=>{s[t]||(a[t]=e)})),this.map(s,((t,e)=>{const n=i[t];if(n){const r=e.map((t=>t.presence_ref)),i=n.map((t=>t.presence_ref)),s=e.filter((t=>i.indexOf(t.presence_ref)<0)),l=n.filter((t=>r.indexOf(t.presence_ref)<0));s.length>0&&(o[t]=s),l.length>0&&(a[t]=l)}else o[t]=e})),this.syncDiff(i,{joins:o,leaves:a},n,r)}static syncDiff(t,e,n,r){const{joins:i,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(i,((e,r)=>{var i;const s=null!==(i=t[e])&&void 0!==i?i:[];if(t[e]=this.cloneDeep(r),s.length>0){const n=t[e].map((t=>t.presence_ref)),r=s.filter((t=>n.indexOf(t.presence_ref)<0));t[e].unshift(...r)}n(e,s,r)})),this.map(s,((e,n)=>{let i=t[e];if(!i)return;const s=n.map((t=>t.presence_ref));i=i.filter((t=>s.indexOf(t.presence_ref)<0)),t[e]=i,r(e,i,n),0===i.length&&delete t[e]})),t}static map(t,e){return Object.getOwnPropertyNames(t).map((n=>e(n,t[n])))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce(((e,n)=>{const r=t[n];return e[n]="metas"in r?r.metas.map((t=>(t.presence_ref=t.phx_ref,delete t.phx_ref,delete t.phx_ref_prev,t))):r,e}),{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"}(H||(H={})),function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"}(W||(W={})),function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"}(G||(G={}));class ${constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},n=arguments.length>2?arguments[2]:void 0;this.topic=t,this.params=e,this.socket=n,this.bindings={},this.state=S.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new B(this,M.join,this.params,this.timeout),this.rejoinTimer=new P((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=S.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((t=>t.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=S.closed,this.socket._remove(this)})),this._onError((t=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,t),this.state=S.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=S.errored,this.rejoinTimer.scheduleTimeout())})),this._on(M.reply,{},((t,e)=>{this._trigger(this._replyEventName(e),t)})),this.presence=new q(this),this.broadcastEndpointURL=F(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;var n,r;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:s,private:o}}=this.params;this._onError((e=>t&&t("CHANNEL_ERROR",e))),this._onClose((()=>t&&t("CLOSED")));const a={},l={broadcast:i,presence:s,postgres_changes:null!==(r=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map((t=>t.filter)))&&void 0!==r?r:[],private:o};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",(e=>{let{postgres_changes:n}=e;var r;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),void 0!==n){const e=this.bindings.postgres_changes,i=null!==(r=null===e||void 0===e?void 0:e.length)&&void 0!==r?r:0,s=[];for(let r=0;r<i;r++){const i=e[r],{filter:{event:o,schema:a,table:l,filter:c}}=i,u=n&&n[r];if(!u||u.event!==o||u.schema!==a||u.table!==l||u.filter!==c)return this.unsubscribe(),void(t&&t("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes")));s.push(Object.assign(Object.assign({},i),{id:u.id}))}return this.bindings.postgres_changes=s,void(t&&t("SUBSCRIBED"))}t&&t("SUBSCRIBED")})).receive("error",(e=>{t&&t("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(e).join(", ")||"error")))})).receive("timeout",(()=>{t&&t("TIMED_OUT")}))}return this}presenceState(){return this.presence.state}async track(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.send({type:"presence",event:"untrack"},t)}on(t,e,n){return this._on(t,e,n)}async send(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n,r;if(this._canPush()||"broadcast"!==t.type)return new Promise((n=>{var r,i,s;const o=this._push(t.type,t,e.timeout||this.timeout);"broadcast"!==t.type||(null===(s=null===(i=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===i?void 0:i.broadcast)||void 0===s?void 0:s.ack)||n("ok"),o.receive("ok",(()=>n("ok"))),o.receive("error",(()=>n("error"))),o.receive("timeout",(()=>n("timed out")))}));{const{event:s,payload:o}=t,a={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const t=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(n=e.timeout)&&void 0!==n?n:this.timeout);return await(null===(r=t.body)||void 0===r?void 0:r.cancel()),t.ok?"ok":"error"}catch(i){return"AbortError"===i.name?"timed out":"error"}}}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=S.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(M.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((n=>{const r=new B(this,M.leave,{},t);r.receive("ok",(()=>{e(),n("ok")})).receive("timeout",(()=>{e(),n("timed out")})).receive("error",(()=>{n("error")})),r.send(),this._canPush()||r.trigger("ok",{})}))}async _fetchWithTimeout(t,e,n){const r=new AbortController,i=setTimeout((()=>r.abort()),n),s=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:r.signal}));return clearTimeout(i),s}_push(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new B(this,t,e,n);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(t,e,n){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,n){var r,i;const s=t.toLocaleLowerCase(),{close:o,error:a,leave:l,join:c}=M;if(n&&[o,a,l,c].indexOf(s)>=0&&n!==this._joinRef())return;let u=this._onMessage(s,e,n);if(e&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter((t=>{var e,n,r;return"*"===(null===(e=t.filter)||void 0===e?void 0:e.event)||(null===(r=null===(n=t.filter)||void 0===n?void 0:n.event)||void 0===r?void 0:r.toLocaleLowerCase())===s})).map((t=>t.callback(u,n))):null===(i=this.bindings[s])||void 0===i||i.filter((t=>{var n,r,i,o,a,l;if(["broadcast","presence","postgres_changes"].includes(s)){if("id"in t){const s=t.id,o=null===(n=t.filter)||void 0===n?void 0:n.event;return s&&(null===(r=e.ids)||void 0===r?void 0:r.includes(s))&&("*"===o||(null===o||void 0===o?void 0:o.toLocaleLowerCase())===(null===(i=e.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}{const n=null===(a=null===(o=null===t||void 0===t?void 0:t.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===n||n===(null===(l=null===e||void 0===e?void 0:e.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return t.type.toLocaleLowerCase()===s})).map((t=>{if("object"===typeof u&&"ids"in u){const t=u.data,{schema:e,table:n,commit_timestamp:r,type:i,errors:s}=t,o={schema:e,table:n,commit_timestamp:r,eventType:i,new:{},old:{},errors:s};u=Object.assign(Object.assign({},o),this._getPayloadRecords(t))}t.callback(u,n)}))}_isClosed(){return this.state===S.closed}_isJoined(){return this.state===S.joined}_isJoining(){return this.state===S.joining}_isLeaving(){return this.state===S.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,n){const r=t.toLocaleLowerCase(),i={type:r,filter:e,callback:n};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(t,e){const n=t.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter((t=>{var r;return!((null===(r=t.type)||void 0===r?void 0:r.toLocaleLowerCase())===n&&$.isEqual(t.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(M.close,{},t)}_onError(t){this._on(M.error,{},(e=>t(e)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=S.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const e={new:{},old:{}};return"INSERT"!==t.type&&"UPDATE"!==t.type||(e.new=I(t.columns,t.record)),"UPDATE"!==t.type&&"DELETE"!==t.type||(e.old=I(t.columns,t.old_record)),e}}const X=()=>{},J="undefined"!==typeof WebSocket;class Y{constructor(t,e){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=b,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=X,this.conn=null,this.sendBuffer=[],this.serializer=new C,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=t=>{let e;return e=t||("undefined"===typeof fetch?function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return Promise.resolve().then(n.bind(n,4630)).then((t=>{let{default:n}=t;return n(...e)}))}:fetch),function(){return e(...arguments)}},this.endPoint=`${t}/${E.websocket}`,this.httpEndpoint=F(t),(null===e||void 0===e?void 0:e.transport)?this.transport=e.transport:this.transport=null,(null===e||void 0===e?void 0:e.params)&&(this.params=e.params),(null===e||void 0===e?void 0:e.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),(null===e||void 0===e?void 0:e.timeout)&&(this.timeout=e.timeout),(null===e||void 0===e?void 0:e.logger)&&(this.logger=e.logger),(null===e||void 0===e?void 0:e.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const i=null===(r=null===e||void 0===e?void 0:e.params)||void 0===r?void 0:r.apikey;if(i&&(this.accessToken=i,this.apiKey=i),this.reconnectAfterMs=(null===e||void 0===e?void 0:e.reconnectAfterMs)?e.reconnectAfterMs:t=>[1e3,2e3,5e3,1e4][t-1]||1e4,this.encode=(null===e||void 0===e?void 0:e.encode)?e.encode:(t,e)=>e(JSON.stringify(t)),this.decode=(null===e||void 0===e?void 0:e.decode)?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new P((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null===e||void 0===e?void 0:e.fetch),null===e||void 0===e?void 0:e.worker){if("undefined"!==typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null===e||void 0===e?void 0:e.worker)||!1,this.workerUrl=null===e||void 0===e?void 0:e.workerUrl}}connect(){if(!this.conn)if(this.transport)this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});else{if(J)return this.conn=new WebSocket(this._endPointURL()),void this.setupConnection();this.conn=new Z(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),n.e(952).then(n.t.bind(n,4952,23)).then((t=>{let{default:e}=t;this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()}))}}disconnect(t,e){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,null!==e&&void 0!==e?e:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return 0===this.channels.length&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map((t=>t.unsubscribe())));return this.disconnect(),t}log(t,e,n){this.logger(t,e,n)}connectionState(){switch(this.conn&&this.conn.readyState){case x.connecting:return T.Connecting;case x.open:return T.Open;case x.closing:return T.Closing;default:return T.Closed}}isConnected(){return this.connectionState()===T.Open}channel(t){const e=new $(`realtime:${t}`,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},this);return this.channels.push(e),e}push(t){const{topic:e,event:n,payload:r,ref:i}=t,s=()=>{this.encode(t,(t=>{var e;null===(e=this.conn)||void 0===e||e.send(t)}))};this.log("push",`${e} ${n} (${i})`,r),this.isConnected()?s():this.sendBuffer.push(s)}setAuth(t){this.accessToken=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t}),e.joinedOnce&&e._isJoined()&&e._push(M.access_token,{access_token:t})}))}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find((e=>e.topic===t&&(e._isJoined()||e._isJoining())));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter((e=>e._joinRef()!==t._joinRef()))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}_onConnMessage(t){this.decode(t.data,(t=>{let{topic:e,event:n,payload:r,ref:i}=t;(i&&i===this.pendingHeartbeatRef||n===(null===r||void 0===r?void 0:r.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${e} ${n} ${i&&"("+i+")"||""}`,r),this.channels.filter((t=>t._isMember(e))).forEach((t=>t._trigger(n,r,i))),this.stateChangeCallbacks.message.forEach((e=>e(t)))}))}async _onConnOpen(){if(this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{"keepAlive"===t.data.event&&this._sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this._sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((t=>t()))}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((e=>e(t)))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((e=>e(t)))}_triggerChanError(){this.channels.forEach((t=>t._trigger(M.error)))}_appendParams(t,e){if(0===Object.keys(e).length)return t;const n=t.match(/\?/)?"&":"?";return`${t}${n}${new URLSearchParams(e)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((t=>t())),this.sendBuffer=[])}_sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(t=this.conn)||void 0===t||t.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_workerObjectUrl(t){let e;if(t)e=t;else{const t=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});e=URL.createObjectURL(t)}return e}}class Z{constructor(t,e,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=x.connecting,this.send=()=>{},this.url=null,this.url=t,this.close=n.close}}class K extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function Q(t){return"object"===typeof t&&null!==t&&"__isStorageError"in t}class tt extends K{constructor(t,e){super(t),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class et extends K{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}}var nt=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(jR){s(jR)}}function a(t){try{l(r.throw(t))}catch(jR){s(jR)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))};const rt=t=>{let e;return e=t||("undefined"===typeof fetch?function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return Promise.resolve().then(n.bind(n,4630)).then((t=>{let{default:n}=t;return n(...e)}))}:fetch),function(){return e(...arguments)}},it=t=>{if(Array.isArray(t))return t.map((t=>it(t)));if("function"===typeof t||t!==Object(t))return t;const e={};return Object.entries(t).forEach((t=>{let[n,r]=t;const i=n.replace(/([-_][a-z])/gi,(t=>t.toUpperCase().replace(/[-_]/g,"")));e[i]=it(r)})),e};var st=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(jR){s(jR)}}function a(t){try{l(r.throw(t))}catch(jR){s(jR)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))};const ot=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),at=(t,e,r)=>st(void 0,void 0,void 0,(function*(){const i=yield nt(void 0,void 0,void 0,(function*(){return"undefined"===typeof Response?(yield Promise.resolve().then(n.bind(n,4630))).Response:Response}));t instanceof i&&!(null===r||void 0===r?void 0:r.noResolveJson)?t.json().then((n=>{e(new tt(ot(n),t.status||500))})).catch((t=>{e(new et(ot(t),t))})):e(new et(ot(t),t))}));function lt(t,e,n,r,i,s){return st(this,void 0,void 0,(function*(){return new Promise(((o,a)=>{t(n,((t,e,n,r)=>{const i={method:t,headers:(null===e||void 0===e?void 0:e.headers)||{}};return"GET"===t?i:(i.headers=Object.assign({"Content-Type":"application/json"},null===e||void 0===e?void 0:e.headers),r&&(i.body=JSON.stringify(r)),Object.assign(Object.assign({},i),n))})(e,r,i,s)).then((t=>{if(!t.ok)throw t;return(null===r||void 0===r?void 0:r.noResolveJson)?t:t.json()})).then((t=>o(t))).catch((t=>at(t,a,r)))}))}))}function ct(t,e,n,r){return st(this,void 0,void 0,(function*(){return lt(t,"GET",e,n,r)}))}function ut(t,e,n,r,i){return st(this,void 0,void 0,(function*(){return lt(t,"POST",e,r,i,n)}))}function ht(t,e,n,r,i){return st(this,void 0,void 0,(function*(){return lt(t,"DELETE",e,r,i,n)}))}var dt=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(jR){s(jR)}}function a(t){try{l(r.throw(t))}catch(jR){s(jR)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))};const pt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ft={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class mt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.url=t,this.headers=e,this.bucketId=n,this.fetch=rt(r)}uploadOrUpdate(t,e,n,r){return dt(this,void 0,void 0,(function*(){try{let i;const s=Object.assign(Object.assign({},ft),r);let o=Object.assign(Object.assign({},this.headers),"POST"===t&&{"x-upsert":String(s.upsert)});const a=s.metadata;"undefined"!==typeof Blob&&n instanceof Blob?(i=new FormData,i.append("cacheControl",s.cacheControl),a&&i.append("metadata",this.encodeMetadata(a)),i.append("",n)):"undefined"!==typeof FormData&&n instanceof FormData?(i=n,i.append("cacheControl",s.cacheControl),a&&i.append("metadata",this.encodeMetadata(a))):(i=n,o["cache-control"]=`max-age=${s.cacheControl}`,o["content-type"]=s.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null===r||void 0===r?void 0:r.headers)&&(o=Object.assign(Object.assign({},o),r.headers));const l=this._removeEmptyFolders(e),c=this._getFinalPath(l),u=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:t,body:i,headers:o},(null===s||void 0===s?void 0:s.duplex)?{duplex:s.duplex}:{})),h=yield u.json();if(u.ok)return{data:{path:l,id:h.Id,fullPath:h.Key},error:null};return{data:null,error:h}}catch(i){if(Q(i))return{data:null,error:i};throw i}}))}upload(t,e,n){return dt(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",t,e,n)}))}uploadToSignedUrl(t,e,n,r){return dt(this,void 0,void 0,(function*(){const i=this._removeEmptyFolders(t),s=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${s}`);o.searchParams.set("token",e);try{let t;const e=Object.assign({upsert:ft.upsert},r),s=Object.assign(Object.assign({},this.headers),{"x-upsert":String(e.upsert)});"undefined"!==typeof Blob&&n instanceof Blob?(t=new FormData,t.append("cacheControl",e.cacheControl),t.append("",n)):"undefined"!==typeof FormData&&n instanceof FormData?(t=n,t.append("cacheControl",e.cacheControl)):(t=n,s["cache-control"]=`max-age=${e.cacheControl}`,s["content-type"]=e.contentType);const a=yield this.fetch(o.toString(),{method:"PUT",body:t,headers:s}),l=yield a.json();if(a.ok)return{data:{path:i,fullPath:l.Key},error:null};return{data:null,error:l}}catch(a){if(Q(a))return{data:null,error:a};throw a}}))}createSignedUploadUrl(t,e){return dt(this,void 0,void 0,(function*(){try{let n=this._getFinalPath(t);const r=Object.assign({},this.headers);(null===e||void 0===e?void 0:e.upsert)&&(r["x-upsert"]="true");const i=yield ut(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:r}),s=new URL(this.url+i.url),o=s.searchParams.get("token");if(!o)throw new K("No token returned by API");return{data:{signedUrl:s.toString(),path:t,token:o},error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}))}update(t,e,n){return dt(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",t,e,n)}))}move(t,e,n){return dt(this,void 0,void 0,(function*(){try{return{data:yield ut(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}))}copy(t,e,n){return dt(this,void 0,void 0,(function*(){try{return{data:{path:(yield ut(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}))}createSignedUrl(t,e,n){return dt(this,void 0,void 0,(function*(){try{let r=this._getFinalPath(t),i=yield ut(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:e},(null===n||void 0===n?void 0:n.transform)?{transform:n.transform}:{}),{headers:this.headers});const s=(null===n||void 0===n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${s}`)},{data:i,error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}))}createSignedUrls(t,e,n){return dt(this,void 0,void 0,(function*(){try{const r=yield ut(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers}),i=(null===n||void 0===n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return{data:r.map((t=>Object.assign(Object.assign({},t),{signedUrl:t.signedURL?encodeURI(`${this.url}${t.signedURL}${i}`):null}))),error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}))}download(t,e){return dt(this,void 0,void 0,(function*(){const n="undefined"!==typeof(null===e||void 0===e?void 0:e.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null===e||void 0===e?void 0:e.transform)||{}),i=r?`?${r}`:"";try{const e=this._getFinalPath(t),r=yield ct(this.fetch,`${this.url}/${n}/${e}${i}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(s){if(Q(s))return{data:null,error:s};throw s}}))}info(t){return dt(this,void 0,void 0,(function*(){const e=this._getFinalPath(t);try{const t=yield ct(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:it(t),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}))}exists(t){return dt(this,void 0,void 0,(function*(){const e=this._getFinalPath(t);try{return yield function(t,e,n,r){return st(this,void 0,void 0,(function*(){return lt(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)}))}(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Q(n)&&n instanceof et){const t=n.originalError;if([400,404].includes(null===t||void 0===t?void 0:t.status))return{data:!1,error:n}}throw n}}))}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],i=(null===e||void 0===e?void 0:e.download)?`download=${!0===e.download?"":e.download}`:"";""!==i&&r.push(i);const s="undefined"!==typeof(null===e||void 0===e?void 0:e.transform)?"render/image":"object",o=this.transformOptsToQueryString((null===e||void 0===e?void 0:e.transform)||{});""!==o&&r.push(o);let a=r.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${s}/public/${n}${a}`)}}}remove(t){return dt(this,void 0,void 0,(function*(){try{return{data:yield ht(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(e){if(Q(e))return{data:null,error:e};throw e}}))}list(t,e,n){return dt(this,void 0,void 0,(function*(){try{const r=Object.assign(Object.assign(Object.assign({},pt),e),{prefix:t||""});return{data:yield ut(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(Q(r))return{data:null,error:r};throw r}}))}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return"undefined"!==typeof Buffer?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}}const gt={"X-Client-Info":"storage-js/2.7.1"};var vt=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(jR){s(jR)}}function a(t){try{l(r.throw(t))}catch(jR){s(jR)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))};class yt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.url=t,this.headers=Object.assign(Object.assign({},gt),e),this.fetch=rt(n)}listBuckets(){return vt(this,void 0,void 0,(function*(){try{return{data:yield ct(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(Q(t))return{data:null,error:t};throw t}}))}getBucket(t){return vt(this,void 0,void 0,(function*(){try{return{data:yield ct(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(e){if(Q(e))return{data:null,error:e};throw e}}))}createBucket(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};return vt(this,void 0,void 0,(function*(){try{return{data:yield ut(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}))}updateBucket(t,e){return vt(this,void 0,void 0,(function*(){try{const n=yield function(t,e,n,r,i){return st(this,void 0,void 0,(function*(){return lt(t,"PUT",e,r,i,n)}))}(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers});return{data:n,error:null}}catch(n){if(Q(n))return{data:null,error:n};throw n}}))}emptyBucket(t){return vt(this,void 0,void 0,(function*(){try{return{data:yield ut(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(Q(e))return{data:null,error:e};throw e}}))}deleteBucket(t){return vt(this,void 0,void 0,(function*(){try{return{data:yield ht(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(Q(e))return{data:null,error:e};throw e}}))}}class _t extends yt{constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0)}from(t){return new mt(this.url,this.headers,t,this.fetch)}}let bt="";bt="undefined"!==typeof Deno?"deno":"undefined"!==typeof document?"web":"undefined"!==typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const xt={headers:{"X-Client-Info":`supabase-js-${bt}/2.45.5`}},wt={schema:"public"},St={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Mt={};var Et=n(4630),Tt=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(jR){s(jR)}}function a(t){try{l(r.throw(t))}catch(jR){s(jR)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))};const At=t=>{let e;return e=t||("undefined"===typeof fetch?Et.default:fetch),function(){return e(...arguments)}},Ct=(t,e,n)=>{const r=At(n),i="undefined"===typeof Headers?Et.Headers:Headers;return(n,s)=>Tt(void 0,void 0,void 0,(function*(){var o;const a=null!==(o=yield e())&&void 0!==o?o:t;let l=new i(null===s||void 0===s?void 0:s.headers);return l.has("apikey")||l.set("apikey",t),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),r(n,Object.assign(Object.assign({},s),{headers:l}))}))};var Pt=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(jR){s(jR)}}function a(t){try{l(r.throw(t))}catch(jR){s(jR)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))};const It="2.65.1",Rt={"X-Client-Info":`gotrue-js/${It}`},Lt="X-Supabase-Api-Version",Nt={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"};const Ot=()=>"undefined"!==typeof document,kt={tested:!1,writable:!1},Dt=()=>{if(!Ot())return!1;try{if("object"!==typeof globalThis.localStorage)return!1}catch(jR){return!1}if(kt.tested)return kt.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),kt.tested=!0,kt.writable=!0}catch(jR){kt.tested=!0,kt.writable=!1}return kt.writable};function zt(t){const e={},n=new URL(t);if(n.hash&&"#"===n.hash[0])try{new URLSearchParams(n.hash.substring(1)).forEach(((t,n)=>{e[n]=t}))}catch(jR){}return n.searchParams.forEach(((t,n)=>{e[n]=t})),e}const Ut=t=>{let e;return e=t||("undefined"===typeof fetch?function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return Promise.resolve().then(n.bind(n,4630)).then((t=>{let{default:n}=t;return n(...e)}))}:fetch),function(){return e(...arguments)}},Ft=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},Bt=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch(r){return n}},Vt=async(t,e)=>{await t.removeItem(e)};class Ht{constructor(){this.promise=new Ht.promiseConstructor(((t,e)=>{this.resolve=t,this.reject=e}))}}function jt(t){const e=t.split(".");if(3!==e.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");const n=e[1];return JSON.parse(function(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let n,r,i,s,o,a,l,c="",u=0;for(t=t.replace("-","+").replace("_","/");u<t.length;)s=e.indexOf(t.charAt(u++)),o=e.indexOf(t.charAt(u++)),a=e.indexOf(t.charAt(u++)),l=e.indexOf(t.charAt(u++)),n=s<<2|o>>4,r=(15&o)<<4|a>>2,i=(3&a)<<6|l,c+=String.fromCharCode(n),64!=a&&0!=r&&(c+=String.fromCharCode(r)),64!=l&&0!=i&&(c+=String.fromCharCode(i));return c}(n))}function Wt(t){return("0"+t.toString(16)).substr(-2)}async function Gt(t){if(!("undefined"!==typeof crypto&&"undefined"!==typeof crypto.subtle&&"undefined"!==typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const e=await async function(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e),r=new Uint8Array(n);return Array.from(r).map((t=>String.fromCharCode(t))).join("")}(t);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function qt(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=function(){const t=new Uint32Array(56);if("undefined"===typeof crypto){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=t.length;let n="";for(let r=0;r<56;r++)n+=t.charAt(Math.floor(Math.random()*e));return n}return crypto.getRandomValues(t),Array.from(t,Wt).join("")}();let i=r;n&&(i+="/PASSWORD_RECOVERY"),await Ft(t,`${e}-code-verifier`,i);const s=await Gt(r);return[s,r===s?"plain":"s256"]}Ht.promiseConstructor=Promise;const $t=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;class Xt extends Error{constructor(t,e,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=n}}function Jt(t){return"object"===typeof t&&null!==t&&"__isAuthError"in t}class Yt extends Xt{constructor(t,e,n){super(t,e,n),this.name="AuthApiError",this.status=e,this.code=n}}class Zt extends Xt{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class Kt extends Xt{constructor(t,e,n,r){super(t,n,r),this.name=e,this.status=n}}class Qt extends Kt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class te extends Kt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ee extends Kt{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class ne extends Kt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class re extends Kt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ie extends Kt{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function se(t){return Jt(t)&&"AuthRetryableFetchError"===t.name}class oe extends Kt{constructor(t,e,n){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=n}}var ae=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};const le=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),ce=[502,503,504];async function ue(t){var e,n;if(!("object"===typeof(n=t)&&null!==n&&"status"in n&&"ok"in n&&"json"in n&&"function"===typeof n.json))throw new ie(le(t),0);if(ce.includes(t.status))throw new ie(le(t),t.status);let r,i;try{r=await t.json()}catch(jR){throw new Zt(le(jR),jR)}const s=function(t){const e=t.headers.get(Lt);if(!e)return null;if(!e.match($t))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch(jR){return null}}(t);if(s&&s.getTime()>=Nt.timestamp&&"object"===typeof r&&r&&"string"===typeof r.code?i=r.code:"object"===typeof r&&r&&"string"===typeof r.error_code&&(i=r.error_code),i){if("weak_password"===i)throw new oe(le(r),t.status,(null===(e=r.weak_password)||void 0===e?void 0:e.reasons)||[]);if("session_not_found"===i)throw new Qt}else if("object"===typeof r&&r&&"object"===typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce(((t,e)=>t&&"string"===typeof e),!0))throw new oe(le(r),t.status,r.weak_password.reasons);throw new Yt(le(r),t.status||500,i)}async function he(t,e,n,r){var i;const s=Object.assign({},null===r||void 0===r?void 0:r.headers);s[Lt]||(s[Lt]=Nt.name),(null===r||void 0===r?void 0:r.jwt)&&(s.Authorization=`Bearer ${r.jwt}`);const o=null!==(i=null===r||void 0===r?void 0:r.query)&&void 0!==i?i:{};(null===r||void 0===r?void 0:r.redirectTo)&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(t,e,n,r,i,s){const o=((t,e,n,r)=>{const i={method:t,headers:(null===e||void 0===e?void 0:e.headers)||{}};return"GET"===t?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null===e||void 0===e?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),n))})(e,r,i,s);let a;try{a=await t(n,Object.assign({},o))}catch(jR){throw console.error(jR),new ie(le(jR),0)}a.ok||await ue(a);if(null===r||void 0===r?void 0:r.noResolveJson)return a;try{return await a.json()}catch(jR){await ue(jR)}}(t,e,n+a,{headers:s,noResolveJson:null===r||void 0===r?void 0:r.noResolveJson},{},null===r||void 0===r?void 0:r.body);return(null===r||void 0===r?void 0:r.xform)?null===r||void 0===r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function de(t){var e;let n=null;var r;(function(t){return t.access_token&&t.refresh_token&&t.expires_in})(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=(r=t.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:n,user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function pe(t){const e=de(t);return!e.error&&t.weak_password&&"object"===typeof t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&"string"===typeof t.weak_password.message&&t.weak_password.reasons.reduce(((t,e)=>t&&"string"===typeof e),!0)&&(e.data.weak_password=t.weak_password),e}function fe(t){var e;return{data:{user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function me(t){return{data:t,error:null}}function ge(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:i,verification_type:s}=t,o=ae(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:e,email_otp:n,hashed_token:r,redirect_to:i,verification_type:s},user:Object.assign({},o)},error:null}}function ve(t){return t}var ye=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};class _e{constructor(t){let{url:e="",headers:n={},fetch:r}=t;this.url=e,this.headers=n,this.fetch=Ut(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"global";try{return await he(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Jt(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await he(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:fe})}catch(n){if(Jt(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:e}=t,n=ye(t,["options"]),r=Object.assign(Object.assign({},n),e);return"newEmail"in n&&(r.new_email=null===n||void 0===n?void 0:n.newEmail,delete r.newEmail),await he(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:ge,redirectTo:null===e||void 0===e?void 0:e.redirectTo})}catch(e){if(Jt(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await he(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:fe})}catch(e){if(Jt(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,n,r,i,s,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await he(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(e=null===t||void 0===t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==n?n:"",per_page:null!==(i=null===(r=null===t||void 0===t?void 0:t.perPage)||void 0===r?void 0:r.toString())&&void 0!==i?i:""},xform:ve});if(c.error)throw c.error;const u=await c.json(),h=null!==(s=c.headers.get("x-total-count"))&&void 0!==s?s:0,d=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach((t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(t.split(";")[1].split("=")[1]);l[`${n}Page`]=e})),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(Jt(l))return{data:{users:[]},error:l};throw l}}async getUserById(t){try{return await he(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:fe})}catch(e){if(Jt(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){try{return await he(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:fe})}catch(n){if(Jt(n))return{data:{user:null},error:n};throw n}}async deleteUser(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{return await he(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:fe})}catch(n){if(Jt(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){try{const{data:e,error:n}=await he(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:t=>({data:{factors:t},error:null})});return{data:e,error:n}}catch(e){if(Jt(e))return{data:null,error:e};throw e}}async _deleteFactor(t){try{return{data:await he(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(Jt(e))return{data:null,error:e};throw e}}}const be={getItem:t=>Dt()?globalThis.localStorage.getItem(t):null,setItem:(t,e)=>{Dt()&&globalThis.localStorage.setItem(t,e)},removeItem:t=>{Dt()&&globalThis.localStorage.removeItem(t)}};function xe(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const we=!!(globalThis&&Dt()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Se extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Me extends Se{}async function Ee(t,e,n){we&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout((()=>{r.abort(),we&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)}),e),await globalThis.navigator.locks.request(t,0===e?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},(async r=>{if(!r){if(0===e)throw we&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Me(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(we)try{const t=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(t,null,"  "))}catch(jR){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",jR)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}we&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,r.name);try{return await n()}finally{we&&console.log("@supabase/gotrue-js: navigatorLock: released",t,r.name)}}))}!function(){if("object"!==typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(jR){"undefined"!==typeof self&&(self.globalThis=self)}}();const Te={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Rt,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Ae=3e4;async function Ce(t,e,n){return await n()}class Pe{constructor(t){var e,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Pe.nextInstanceID,Pe.nextInstanceID+=1,this.instanceID>0&&Ot()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},Te),t);if(this.logDebugMessages=!!r.debug,"function"===typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new _e({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Ut(r.fetch),this.lock=r.lock||Ce,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:Ot()&&(null===(e=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===e?void 0:e.locks)?this.lock=Ee:this.lock=Ce,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:Dt()?this.storage=be:(this.memoryStorage={},this.storage=xe(this.memoryStorage)):(this.memoryStorage={},this.storage=xe(this.memoryStorage)),Ot()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(jR){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",jR)}null===(n=this.broadcastChannel)||void 0===n||n.addEventListener("message",(async t=>{this._debug("received broadcast notification from other tab or client",t),await this._notifyAllSubscribers(t.data.event,t.data.session,!1)}))}this.initialize()}_debug(){if(this.logDebugMessages){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logger(`GoTrueClient@${this.instanceID} (${It}) ${(new Date).toISOString()}`,...e)}return this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){try{const t=!!Ot()&&await this._isPKCEFlow();if(this._debug("#_initialize()","begin","is PKCE flow",t),t||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:e,error:n}=await this._getSessionFromURL(t);if(n)return this._debug("#_initialize()","error detecting session from URL",n),"identity_already_exists"===(null===n||void 0===n?void 0:n.code)||await this._removeSession(),{error:n};const{session:r,redirectType:i}=e;return this._debug("#_initialize()","detected session in URL",r,"redirect type",i),await this._saveSession(r),setTimeout((async()=>{"recovery"===i?await this._notifyAllSubscribers("PASSWORD_RECOVERY",r):await this._notifyAllSubscribers("SIGNED_IN",r)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Jt(t)?{error:t}:{error:new Zt("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var e,n,r;try{const i=await he(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(n=null===(e=null===t||void 0===t?void 0:t.options)||void 0===e?void 0:e.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null===(r=null===t||void 0===t?void 0:t.options)||void 0===r?void 0:r.captchaToken}},xform:de}),{data:s,error:o}=i;if(o||!s)return{data:{user:null,session:null},error:o};const a=s.session,l=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(i){if(Jt(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(t){var e,n,r;try{let i;if("email"in t){const{email:n,password:r,options:s}=t;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await qt(this.storage,this.storageKey)),i=await he(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null===s||void 0===s?void 0:s.emailRedirectTo,body:{email:n,password:r,data:null!==(e=null===s||void 0===s?void 0:s.data)&&void 0!==e?e:{},gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken},code_challenge:o,code_challenge_method:a},xform:de})}else{if(!("phone"in t))throw new ee("You must provide either an email or phone number and a password");{const{phone:e,password:s,options:o}=t;i=await he(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:e,password:s,data:null!==(n=null===o||void 0===o?void 0:o.data)&&void 0!==n?n:{},channel:null!==(r=null===o||void 0===o?void 0:o.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null===o||void 0===o?void 0:o.captchaToken}},xform:de})}}const{data:s,error:o}=i;if(o||!s)return{data:{user:null,session:null},error:o};const a=s.session,l=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(i){if(Jt(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(t){try{let e;if("email"in t){const{email:n,password:r,options:i}=t;e=await he(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:r,gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}},xform:pe})}else{if(!("phone"in t))throw new ee("You must provide either an email or phone number and a password");{const{phone:n,password:r,options:i}=t;e=await he(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:r,gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}},xform:pe})}}const{data:n,error:r}=e;return r?{data:{user:null,session:null},error:r}:n&&n.session&&n.user?(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r}):{data:{user:null,session:null},error:new te}}catch(e){if(Jt(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(t){var e,n,r,i;return await this._handleProviderSignIn(t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(n=t.options)||void 0===n?void 0:n.scopes,queryParams:null===(r=t.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(i=t.options)||void 0===i?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(t)))}async _exchangeCodeForSession(t){const e=await Bt(this.storage,`${this.storageKey}-code-verifier`),[n,r]=(null!==e&&void 0!==e?e:"").split("/");try{const{data:e,error:i}=await he(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:de});if(await Vt(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return e&&e.session&&e.user?(e.session&&(await this._saveSession(e.session),await this._notifyAllSubscribers("SIGNED_IN",e.session)),{data:Object.assign(Object.assign({},e),{redirectType:null!==r&&void 0!==r?r:null}),error:i}):{data:{user:null,session:null,redirectType:null},error:new te}}catch(i){if(Jt(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(t){try{const{options:e,provider:n,token:r,access_token:i,nonce:s}=t,o=await he(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:r,access_token:i,nonce:s,gotrue_meta_security:{captcha_token:null===e||void 0===e?void 0:e.captchaToken}},xform:de}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new te}}catch(e){if(Jt(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(t){var e,n,r,i,s;try{if("email"in t){const{email:r,options:i}=t;let s=null,o=null;"pkce"===this.flowType&&([s,o]=await qt(this.storage,this.storageKey));const{error:a}=await he(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(e=null===i||void 0===i?void 0:i.data)&&void 0!==e?e:{},create_user:null===(n=null===i||void 0===i?void 0:i.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken},code_challenge:s,code_challenge_method:o},redirectTo:null===i||void 0===i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in t){const{phone:e,options:n}=t,{data:o,error:a}=await he(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:e,data:null!==(r=null===n||void 0===n?void 0:n.data)&&void 0!==r?r:{},create_user:null===(i=null===n||void 0===n?void 0:n.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null===n||void 0===n?void 0:n.captchaToken},channel:null!==(s=null===n||void 0===n?void 0:n.channel)&&void 0!==s?s:"sms"}});return{data:{user:null,session:null,messageId:null===o||void 0===o?void 0:o.message_id},error:a}}throw new ee("You must provide either an email or phone number.")}catch(o){if(Jt(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var e,n;try{let r,i;"options"in t&&(r=null===(e=t.options)||void 0===e?void 0:e.redirectTo,i=null===(n=t.options)||void 0===n?void 0:n.captchaToken);const{data:s,error:o}=await he(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:de});if(o)throw o;if(!s)throw new Error("An error occurred on token verification.");const a=s.session,l=s.user;return(null===a||void 0===a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("recovery"==t.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(r){if(Jt(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(t){var e,n,r;try{let i=null,s=null;return"pkce"===this.flowType&&([i,s]=await qt(this.storage,this.storageKey)),await he(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(n=null===(e=t.options)||void 0===e?void 0:e.redirectTo)&&void 0!==n?n:void 0}),(null===(r=null===t||void 0===t?void 0:t.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:s}),headers:this.headers,xform:me})}catch(i){if(Jt(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async t=>{const{data:{session:e},error:n}=t;if(n)throw n;if(!e)throw new Qt;const{error:r}=await he(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:r}}))}catch(t){if(Jt(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:n,type:r,options:i}=t,{error:s}=await he(this.fetch,"POST",e,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}},redirectTo:null===i||void 0===i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:s}}if("phone"in t){const{phone:n,type:r,options:i}=t,{data:s,error:o}=await he(this.fetch,"POST",e,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:null===s||void 0===s?void 0:s.message_id},error:o}}throw new ee("You must provide either an email or phone number and a type")}catch(e){if(Jt(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,(async()=>this._useSession((async t=>t))))}async _acquireLock(t,e){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const t=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await t,await e()))();return this.pendingInLock.push((async()=>{try{await n}catch(jR){}})()),n}return await this.lock(`lock:${this.storageKey}`,t,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const t=e();for(this.pendingInLock.push((async()=>{try{await t}catch(jR){}})()),await t;this.pendingInLock.length;){const t=[...this.pendingInLock];await Promise.all(t),this.pendingInLock.splice(0,t.length)}return await t}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const e=await this.__loadSession();return await t(e)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const e=await Bt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",e),null!==e&&(this._isValidSession(e)?t=e:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=!!t.expires_at&&t.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.storage.isServer){let e=this.suppressGetSessionWarning;t=new Proxy(t,{get:(t,n,r)=>(e||"user"!==n||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e=!0,this.suppressGetSessionWarning=!0),Reflect.get(t,n,r))})}return{data:{session:t},error:null}}const{session:r,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;return await this._acquireLock(-1,(async()=>await this._getUser()))}async _getUser(t){try{return t?await he(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:fe}):await this._useSession((async t=>{var e,n,r;const{data:i,error:s}=t;if(s)throw s;return(null===(e=i.session)||void 0===e?void 0:e.access_token)||this.hasCustomAuthorizationHeader?await he(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(n=i.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0,xform:fe}):{data:{user:null},error:new Qt}}))}catch(e){if(Jt(e))return function(t){return Jt(t)&&"AuthSessionMissingError"===t.name}(e)&&(await this._removeSession(),await Vt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}}async updateUser(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(t,e)))}async _updateUser(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await this._useSession((async n=>{const{data:r,error:i}=n;if(i)throw i;if(!r.session)throw new Qt;const s=r.session;let o=null,a=null;"pkce"===this.flowType&&null!=t.email&&([o,a]=await qt(this.storage,this.storageKey));const{data:l,error:c}=await he(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null===e||void 0===e?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:a}),jwt:s.access_token,xform:fe});if(c)throw c;return s.user=l.user,await this._saveSession(s),await this._notifyAllSubscribers("USER_UPDATED",s),{data:{user:s.user},error:null}}))}catch(n){if(Jt(n))return{data:{user:null},error:n};throw n}}_decodeJWT(t){return jt(t)}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(t)))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Qt;const e=Date.now()/1e3;let n=e,r=!0,i=null;const s=jt(t.access_token);if(s.exp&&(n=s.exp,r=n<=e),r){const{session:e,error:n}=await this._callRefreshToken(t.refresh_token);if(n)return{data:{user:null,session:null},error:n};if(!e)return{data:{user:null,session:null},error:null};i=e}else{const{data:r,error:s}=await this._getUser(t.access_token);if(s)throw s;i={access_token:t.access_token,refresh_token:t.refresh_token,user:r.user,token_type:"bearer",expires_in:n-e,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(e){if(Jt(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(t)))}async _refreshSession(t){try{return await this._useSession((async e=>{var n;if(!t){const{data:r,error:i}=e;if(i)throw i;t=null!==(n=r.session)&&void 0!==n?n:void 0}if(!(null===t||void 0===t?void 0:t.refresh_token))throw new Qt;const{session:r,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}))}catch(e){if(Jt(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(t){try{if(!Ot())throw new ne("No browser detected.");if("implicit"===this.flowType&&!this._isImplicitGrantFlow())throw new ne("Not a valid implicit grant flow url.");if("pkce"==this.flowType&&!t)throw new re("Not a valid PKCE flow url.");const e=zt(window.location.href);if(t){if(!e.code)throw new re("No code detected.");const{data:t,error:n}=await this._exchangeCodeForSession(e.code);if(n)throw n;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}if(e.error||e.error_description||e.error_code)throw new ne(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});const{provider_token:n,provider_refresh_token:r,access_token:i,refresh_token:s,expires_in:o,expires_at:a,token_type:l}=e;if(!i||!o||!s||!l)throw new ne("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(o);let h=c+u;a&&(h=parseInt(a));const d=h-c;1e3*d<=Ae&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${u}s`);const p=h-u;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,h,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,h,c);const{data:f,error:m}=await this._getUser(i);if(m)throw m;const g={provider_token:n,provider_refresh_token:r,access_token:i,expires_in:u,expires_at:h,refresh_token:s,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(e){if(Jt(e))return{data:{session:null,redirectType:null},error:e};throw e}}_isImplicitGrantFlow(){const t=zt(window.location.href);return!(!Ot()||!t.access_token&&!t.error_description)}async _isPKCEFlow(){const t=zt(window.location.href),e=await Bt(this.storage,`${this.storageKey}-code-verifier`);return!(!t.code||!e)}async signOut(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(t)))}async _signOut(){let{scope:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this._useSession((async e=>{var n;const{data:r,error:i}=e;if(i)return{error:i};const s=null===(n=r.session)||void 0===n?void 0:n.access_token;if(s){const{error:e}=await this.admin.signOut(s,t);if(e&&(!function(t){return Jt(t)&&"AuthApiError"===t.name}(e)||404!==e.status&&401!==e.status&&403!==e.status))return{error:e}}return"others"!==t&&(await this._removeSession(),await Vt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))}onAuthStateChange(t){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})),n={id:e,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this._debug("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,n),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(e)}))})(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession((async e=>{var n,r;try{const{data:{session:r},error:i}=e;if(i)throw i;await(null===(n=this.stateChangeEmitters.get(t))||void 0===n?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",t,"session",r)}catch(i){await(null===(r=this.stateChangeEmitters.get(t))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}}))}async resetPasswordForEmail(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=null;"pkce"===this.flowType&&([n,r]=await qt(this.storage,this.storageKey,!0));try{return await he(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(i){if(Jt(i))return{data:null,error:i};throw i}}async getUserIdentities(){var t;try{const{data:e,error:n}=await this.getUser();if(n)throw n;return{data:{identities:null!==(t=e.user.identities)&&void 0!==t?t:[]},error:null}}catch(e){if(Jt(e))return{data:null,error:e};throw e}}async linkIdentity(t){var e;try{const{data:n,error:r}=await this._useSession((async e=>{var n,r,i,s,o;const{data:a,error:l}=e;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:null===(n=t.options)||void 0===n?void 0:n.redirectTo,scopes:null===(r=t.options)||void 0===r?void 0:r.scopes,queryParams:null===(i=t.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:!0});return await he(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==o?o:void 0})}));if(r)throw r;return Ot()&&!(null===(e=t.options)||void 0===e?void 0:e.skipBrowserRedirect)&&window.location.assign(null===n||void 0===n?void 0:n.url),{data:{provider:t.provider,url:null===n||void 0===n?void 0:n.url},error:null}}catch(n){if(Jt(n))return{data:{provider:t.provider,url:null},error:n};throw n}}async unlinkIdentity(t){try{return await this._useSession((async e=>{var n,r;const{data:i,error:s}=e;if(s)throw s;return await he(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(n=i.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0})}))}catch(e){if(Jt(e))return{data:null,error:e};throw e}}async _refreshAccessToken(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(e,"begin");try{const n=Date.now();return await function(t,e){const n=new Promise(((n,r)=>{(async()=>{for(let i=0;i<1/0;i++)try{const r=await t(i);if(!e(i,null,r))return void n(r)}catch(jR){if(!e(i,jR))return void r(jR)}})()}));return n}((async n=>(n>0&&await async function(t){return await new Promise((e=>{setTimeout((()=>e(null)),t)}))}(200*Math.pow(2,n-1)),this._debug(e,"refreshing attempt",n),await he(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:de}))),((t,e)=>{const r=200*Math.pow(2,t);return e&&se(e)&&Date.now()+r-n<Ae}))}catch(n){if(this._debug(e,"error",n),Jt(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(e,"end")}}_isValidSession(t){return"object"===typeof t&&null!==t&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,e){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",e,"url",n),Ot()&&!e.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t;const e="#_recoverAndRefresh()";this._debug(e,"begin");try{const n=await Bt(this.storage,this.storageKey);if(this._debug(e,"session from storage",n),!this._isValidSession(n))return this._debug(e,"session is not valid"),void(null!==n&&await this._removeSession());const r=Math.round(Date.now()/1e3),i=(null!==(t=n.expires_at)&&void 0!==t?t:1/0)<r+10;if(this._debug(e,`session has${i?"":" not"} expired with margin of 10s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:t}=await this._callRefreshToken(n.refresh_token);t&&(console.error(t),se(t)||(this._debug(e,"refresh failed with a non-retryable error, removing the session",t),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){return this._debug(e,"error",n),void console.error(n)}finally{this._debug(e,"end")}}async _callRefreshToken(t){var e,n;if(!t)throw new Qt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Ht;const{data:e,error:n}=await this._refreshAccessToken(t);if(n)throw n;if(!e.session)throw new Qt;await this._saveSession(e.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",e.session);const r={session:e.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(i){if(this._debug(r,"error",i),Jt(i)){const t={session:null,error:i};return se(i)||await this._removeSession(),null===(e=this.refreshingDeferred)||void 0===e||e.resolve(t),t}throw null===(n=this.refreshingDeferred)||void 0===n||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=`#_notifyAllSubscribers(${t})`;this._debug(r,"begin",e,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:e});const r=[],i=Array.from(this.stateChangeEmitters.values()).map((async n=>{try{await n.callback(t,e)}catch(jR){r.push(jR)}}));if(await Promise.all(i),r.length>0){for(let t=0;t<r.length;t+=1)console.error(r[t]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await Ft(this.storage,this.storageKey,t)}async _removeSession(){this._debug("#_removeSession()"),await Vt(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Ot()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(jR){console.error("removing visibilitychange callback failed",jR)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval((()=>this._autoRefreshTokenTick()),Ae);this.autoRefreshTicker=t,t&&"object"===typeof t&&"function"===typeof t.unref?t.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const t=Date.now();try{return await this._useSession((async e=>{const{data:{session:n}}=e;if(!n||!n.refresh_token||!n.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*n.expires_at-t)/Ae);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(n.refresh_token)}))}catch(jR){console.error("Auto refresh tick failed with error. This is likely a transient error.",jR)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(jR){if(!(jR.isAcquireTimeout||jR instanceof Se))throw jR;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ot()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const e=`#_onVisibilityChanged(${t})`;this._debug(e,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,e,n){const r=[`provider=${encodeURIComponent(e)}`];if((null===n||void 0===n?void 0:n.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),(null===n||void 0===n?void 0:n.scopes)&&r.push(`scopes=${encodeURIComponent(n.scopes)}`),"pkce"===this.flowType){const[t,e]=await qt(this.storage,this.storageKey),n=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(e)}`});r.push(n.toString())}if(null===n||void 0===n?void 0:n.queryParams){const t=new URLSearchParams(n.queryParams);r.push(t.toString())}return(null===n||void 0===n?void 0:n.skipBrowserRedirect)&&r.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${r.join("&")}`}async _unenroll(t){try{return await this._useSession((async e=>{var n;const{data:r,error:i}=e;return i?{data:null,error:i}:await he(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token})}))}catch(e){if(Jt(e))return{data:null,error:e};throw e}}async _enroll(t){try{return await this._useSession((async e=>{var n,r;const{data:i,error:s}=e;if(s)return{data:null,error:s};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},"phone"===t.factorType?{phone:t.phone}:{issuer:t.issuer}),{data:a,error:l}=await he(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(n=null===i||void 0===i?void 0:i.session)||void 0===n?void 0:n.access_token});return l?{data:null,error:l}:("totp"===t.factorType&&(null===(r=null===a||void 0===a?void 0:a.totp)||void 0===r?void 0:r.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(e){if(Jt(e))return{data:null,error:e};throw e}}async _verify(t){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async e=>{var n;const{data:r,error:i}=e;if(i)return{data:null,error:i};const{data:s,error:o}=await he(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+s.expires_in},s)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",s),{data:s,error:o})}))}catch(e){if(Jt(e))return{data:null,error:e};throw e}}))}async _challenge(t){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async e=>{var n;const{data:r,error:i}=e;return i?{data:null,error:i}:await he(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token})}))}catch(e){if(Jt(e))return{data:null,error:e};throw e}}))}async _challengeAndVerify(t){const{data:e,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:e.id,code:t.code})}async _listFactors(){const{data:{user:t},error:e}=await this.getUser();if(e)return{data:null,error:e};const n=(null===t||void 0===t?void 0:t.factors)||[],r=n.filter((t=>"totp"===t.factor_type&&"verified"===t.status)),i=n.filter((t=>"phone"===t.factor_type&&"verified"===t.status));return{data:{all:n,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async t=>{var e,n;const{data:{session:r},error:i}=t;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const s=this._decodeJWT(r.access_token);let o=null;s.aal&&(o=s.aal);let a=o;(null!==(n=null===(e=r.user.factors)||void 0===e?void 0:e.filter((t=>"verified"===t.status)))&&void 0!==n?n:[]).length>0&&(a="aal2");return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:s.amr||[]},error:null}}))))}}Pe.nextInstanceID=0;const Ie=Pe;class Re extends Ie{constructor(t){super(t)}}var Le=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(jR){s(jR)}}function a(t){try{l(r.throw(t))}catch(jR){s(jR)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))};class Ne{constructor(t,e,n){var r,i,s;if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const o=t.replace(/\/$/,"");this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const a=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l=function(t,e){const{db:n,auth:r,realtime:i,global:s}=t,{db:o,auth:a,realtime:l,global:c}=e,u={db:Object.assign(Object.assign({},o),n),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},c),s),accessToken:()=>Pt(this,void 0,void 0,(function*(){return""}))};return t.accessToken?u.accessToken=t.accessToken:delete u.accessToken,u}(null!==n&&void 0!==n?n:{},{db:wt,realtime:Mt,auth:Object.assign(Object.assign({},St),{storageKey:a}),global:xt});this.storageKey=null!==(r=l.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(i=l.global.headers)&&void 0!==i?i:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(t,e)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(e)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(s=l.auth)&&void 0!==s?s:{},this.headers,l.global.fetch),this.fetch=Ct(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},l.realtime)),this.rest=new f(`${o}/rest/v1`,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),l.accessToken||this._listenForAuthEvents()}get functions(){return new d(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new _t(this.storageUrl,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.rest.rpc(t,e,n)}channel(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,e;return Le(this,void 0,void 0,(function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return null!==(e=null===(t=n.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:null}))}_initSupabaseAuthClient(t,e,n){let{autoRefreshToken:r,persistSession:i,detectSessionInUrl:s,storage:o,storageKey:a,flowType:l,lock:c,debug:u}=t;var h;const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Re({url:this.authUrl,headers:Object.assign(Object.assign({},d),e),storageKey:a,autoRefreshToken:r,persistSession:i,detectSessionInUrl:s,storage:o,flowType:l,lock:c,debug:u,fetch:n,hasCustomAuthorizationHeader:null!==(h="Authorization"in this.headers)&&void 0!==h&&h})}_initRealtimeClient(t){return new Y(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},null===t||void 0===t?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((t,e)=>{this._handleTokenChanged(t,"CLIENT",null===e||void 0===e?void 0:e.access_token)}))}_handleTokenChanged(t,e,n){"TOKEN_REFRESHED"!==t&&"SIGNED_IN"!==t||this.changedAccessToken===n?"SIGNED_OUT"===t&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!==n&&void 0!==n?n:null),this.changedAccessToken=n)}}const Oe=((t,e,n)=>new Ne(t,e,n))("https://gbdyrurzyyfmuobeckit.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdiZHlydXJ6eXlmbXVvYmVja2l0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjkzMzAyNDcsImV4cCI6MjA0NDkwNjI0N30.s5aKdX6BdWojAewKoJwCcvBVzCHJumwbe8cok9Z0yv4");var ke=n(579);const De=(0,t.createContext)(),ze=()=>(0,t.useContext)(De),Ue=e=>{let{children:n}=e;const[r,i]=(0,t.useState)([]),[s,o]=(0,t.useState)([]),[a,l]=(0,t.useState)("");return(0,ke.jsx)(De.Provider,{value:{nodes:r,setNodes:i,edges:s,setEdges:o,saveScenario:async t=>{const e=await(async(t,e,n)=>{const r={name:t,nodes:e,edges:n},{data:i,error:s}=await Oe.from("scenarios").insert([r]);return s?(console.error("Errore durante il salvataggio dello scenario:",s),{error:s}):(console.log("Scenario salvato con successo:",i),{data:i})})(t,r,s);e.error?console.error("Errore durante il salvataggio:",e.error):console.log("Scenario saved:",e.data)},loadScenario:async t=>{const e=await(async t=>{const{data:e,error:n}=await Oe.from("scenarios").select("*").eq("name",t);return n?(console.error("Errore durante il caricamento dello scenario:",n),{error:n}):e.length>0?(console.log("Scenario caricato:",e[0]),{scenarioId:e[0].id,nodes:e[0].nodes,edges:e[0].edges}):(console.warn("Nessuno scenario trovato con quel nome."),{error:"No scenario found"})})(t);e.error?console.error("Errore durante il caricamento:",e.error):(i(e.nodes),o(e.edges),l(e.scenarioId),console.log("Scenario loaded:",e))},updateScenario:async()=>{const t=await(async(t,e,n)=>{const r={nodes:e,edges:n},{data:i,error:s}=await Oe.from("scenarios").update(r).eq("id",t);return s?(console.error("Errore durante l'aggiornamento dello scenario:",s),{error:s}):(console.log("Scenario aggiornato con successo:",i),{data:i})})(a,r,s);t.error?console.error("Errore durante l'aggiornamento:",t.error):console.log("Scenario updated:",t.data)},resetScenario:()=>{i([]),o([]),l("")}},children:n})};var Fe=n(3597),Be=n.n(Fe);const Ve=(()=>{let t=0;return()=>(t+=1,`u${`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4)}${t}`)})();function He(t){const e=[];for(let n=0,r=t.length;n<r;n++)e.push(t[n]);return e}function je(t,e){const n=(t.ownerDocument.defaultView||window).getComputedStyle(t).getPropertyValue(e);return n?parseFloat(n.replace("px","")):0}function We(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.width||function(t){const e=je(t,"border-left-width"),n=je(t,"border-right-width");return t.clientWidth+e+n}(t),r=e.height||function(t){const e=je(t,"border-top-width"),n=je(t,"border-bottom-width");return t.clientHeight+e+n}(t);return{width:n,height:r}}const Ge=16384;function qe(t){return new Promise(((e,n)=>{const r=new Image;r.decode=()=>e(r),r.onload=()=>e(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="async",r.src=t}))}async function $e(t,e,n){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),s=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${e} ${n}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),i.appendChild(s),s.appendChild(t),async function(t){return Promise.resolve().then((()=>(new XMLSerializer).serializeToString(t))).then(encodeURIComponent).then((t=>`data:image/svg+xml;charset=utf-8,${t}`))}(i)}const Xe=(t,e)=>{if(t instanceof e)return!0;const n=Object.getPrototypeOf(t);return null!==n&&(n.constructor.name===e.name||Xe(n,e))};function Je(t,e,n){const r=`.${t}:${e}`,i=n.cssText?function(t){const e=t.getPropertyValue("content");return`${t.cssText} content: '${e.replace(/'|"/g,"")}';`}(n):function(t){return He(t).map((e=>`${e}: ${t.getPropertyValue(e)}${t.getPropertyPriority(e)?" !important":""};`)).join(" ")}(n);return document.createTextNode(`${r}{${i}}`)}function Ye(t,e,n){const r=window.getComputedStyle(t,n),i=r.getPropertyValue("content");if(""===i||"none"===i)return;const s=Ve();try{e.className=`${e.className} ${s}`}catch(a){return}const o=document.createElement("style");o.appendChild(Je(s,n,r)),e.appendChild(o)}const Ze="application/font-woff",Ke="image/jpeg",Qe={woff:Ze,woff2:Ze,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Ke,jpeg:Ke,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function tn(t){const e=function(t){const e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}(t).toLowerCase();return Qe[e]||""}function en(t){return-1!==t.search(/^(data:)/)}function nn(t,e){return`data:${e};base64,${t}`}async function rn(t,e,n){const r=await fetch(t,e);if(404===r.status)throw new Error(`Resource "${r.url}" not found`);const i=await r.blob();return new Promise(((t,e)=>{const s=new FileReader;s.onerror=e,s.onloadend=()=>{try{t(n({res:r,result:s.result}))}catch(i){e(i)}},s.readAsDataURL(i)}))}const sn={};async function on(t,e,n){const r=function(t,e,n){let r=t.replace(/\?.*/,"");return n&&(r=t),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),e?`[${e}]${r}`:r}(t,e,n.includeQueryParams);if(null!=sn[r])return sn[r];let i;n.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());try{const r=await rn(t,n.fetchRequestInit,(t=>{let{res:n,result:r}=t;return e||(e=n.headers.get("Content-Type")||""),function(t){return t.split(/,/)[1]}(r)}));i=nn(r,e)}catch(s){i=n.imagePlaceholder||"";let e=`Failed to fetch resource: ${t}`;s&&(e="string"===typeof s?s:s.message),e&&console.warn(e)}return sn[r]=i,i}async function an(t,e){return Xe(t,HTMLCanvasElement)?async function(t){const e=t.toDataURL();return"data:,"===e?t.cloneNode(!1):qe(e)}(t):Xe(t,HTMLVideoElement)?async function(t,e){if(t.currentSrc){const e=document.createElement("canvas"),n=e.getContext("2d");return e.width=t.clientWidth,e.height=t.clientHeight,null===n||void 0===n||n.drawImage(t,0,0,e.width,e.height),qe(e.toDataURL())}const n=t.poster,r=tn(n);return qe(await on(n,r,e))}(t,e):Xe(t,HTMLIFrameElement)?async function(t){var e;try{if(null===(e=null===t||void 0===t?void 0:t.contentDocument)||void 0===e?void 0:e.body)return await un(t.contentDocument.body,{},!0)}catch(yS){}return t.cloneNode(!1)}(t):t.cloneNode(!1)}const ln=t=>null!=t.tagName&&"SLOT"===t.tagName.toUpperCase();function cn(t,e){return Xe(e,Element)&&(function(t,e){const n=e.style;if(!n)return;const r=window.getComputedStyle(t);r.cssText?(n.cssText=r.cssText,n.transformOrigin=r.transformOrigin):He(r).forEach((i=>{let s=r.getPropertyValue(i);if("font-size"===i&&s.endsWith("px")){const t=Math.floor(parseFloat(s.substring(0,s.length-2)))-.1;s=`${t}px`}Xe(t,HTMLIFrameElement)&&"display"===i&&"inline"===s&&(s="block"),"d"===i&&e.getAttribute("d")&&(s=`path(${e.getAttribute("d")})`),n.setProperty(i,s,r.getPropertyPriority(i))}))}(t,e),function(t,e){Ye(t,e,":before"),Ye(t,e,":after")}(t,e),function(t,e){Xe(t,HTMLTextAreaElement)&&(e.innerHTML=t.value),Xe(t,HTMLInputElement)&&e.setAttribute("value",t.value)}(t,e),function(t,e){if(Xe(t,HTMLSelectElement)){const n=e,r=Array.from(n.children).find((e=>t.value===e.getAttribute("value")));r&&r.setAttribute("selected","")}}(t,e)),e}async function un(t,e,n){return n||!e.filter||e.filter(t)?Promise.resolve(t).then((t=>an(t,e))).then((n=>async function(t,e,n){var r,i;let s=[];return s=ln(t)&&t.assignedNodes?He(t.assignedNodes()):Xe(t,HTMLIFrameElement)&&(null===(r=t.contentDocument)||void 0===r?void 0:r.body)?He(t.contentDocument.body.childNodes):He((null!==(i=t.shadowRoot)&&void 0!==i?i:t).childNodes),0===s.length||Xe(t,HTMLVideoElement)||await s.reduce(((t,r)=>t.then((()=>un(r,n))).then((t=>{t&&e.appendChild(t)}))),Promise.resolve()),e}(t,n,e))).then((e=>cn(t,e))).then((t=>async function(t,e){const n=t.querySelectorAll?t.querySelectorAll("use"):[];if(0===n.length)return t;const r={};for(let s=0;s<n.length;s++){const i=n[s].getAttribute("xlink:href");if(i){const n=t.querySelector(i),s=document.querySelector(i);n||!s||r[i]||(r[i]=await un(s,e,!0))}}const i=Object.values(r);if(i.length){const e="http://www.w3.org/1999/xhtml",n=document.createElementNS(e,"svg");n.setAttribute("xmlns",e),n.style.position="absolute",n.style.width="0",n.style.height="0",n.style.overflow="hidden",n.style.display="none";const r=document.createElementNS(e,"defs");n.appendChild(r);for(let t=0;t<i.length;t++)r.appendChild(i[t]);t.appendChild(n)}return t}(t,e))):null}const hn=/url\((['"]?)([^'"]+?)\1\)/g,dn=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,pn=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function fn(t,e,n,r,i){try{const s=n?function(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),e&&(r.href=e),i.href=t,i.href}(e,n):e,o=tn(e);let a;if(i){a=nn(await i(s),o)}else a=await on(s,o,r);return t.replace(function(t){const e=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}(e),`$1${a}$3`)}catch(s){}return t}function mn(t){return-1!==t.search(hn)}async function gn(t,e,n){if(!mn(t))return t;const r=function(t,e){let{preferredFontFormat:n}=e;return n?t.replace(pn,(t=>{for(;;){const[e,,r]=dn.exec(t)||[];if(!r)return"";if(r===n)return`src: ${e};`}})):t}(t,n),i=function(t){const e=[];return t.replace(hn,((t,n,r)=>(e.push(r),t))),e.filter((t=>!en(t)))}(r);return i.reduce(((t,r)=>t.then((t=>fn(t,r,e,n)))),Promise.resolve(r))}async function vn(t,e,n){var r;const i=null===(r=e.style)||void 0===r?void 0:r.getPropertyValue(t);if(i){const r=await gn(i,null,n);return e.style.setProperty(t,r,e.style.getPropertyPriority(t)),!0}return!1}async function yn(t,e){Xe(t,Element)&&(await async function(t,e){await vn("background",t,e)||await vn("background-image",t,e),await vn("mask",t,e)||await vn("mask-image",t,e)}(t,e),await async function(t,e){const n=Xe(t,HTMLImageElement);if((!n||en(t.src))&&(!Xe(t,SVGImageElement)||en(t.href.baseVal)))return;const r=n?t.src:t.href.baseVal,i=await on(r,tn(r),e);await new Promise(((e,r)=>{t.onload=e,t.onerror=r;const s=t;s.decode&&(s.decode=e),"lazy"===s.loading&&(s.loading="eager"),n?(t.srcset="",t.src=i):t.href.baseVal=i}))}(t,e),await async function(t,e){const n=He(t.childNodes).map((t=>yn(t,e)));await Promise.all(n).then((()=>t))}(t,e))}const _n={};async function bn(t){let e=_n[t];if(null!=e)return e;const n=await fetch(t);return e={url:t,cssText:await n.text()},_n[t]=e,e}async function xn(t,e){let n=t.cssText;const r=/url\(["']?([^"')]+)["']?\)/g,i=(n.match(/url\([^)]+\)/g)||[]).map((async i=>{let s=i.replace(r,"$1");return s.startsWith("https://")||(s=new URL(s,t.url).href),rn(s,e.fetchRequestInit,(t=>{let{result:e}=t;return n=n.replace(i,`url(${e})`),[i,e]}))}));return Promise.all(i).then((()=>n))}function wn(t){if(null==t)return[];const e=[];let n=t.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const r=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const t=r.exec(n);if(null===t)break;e.push(t[0])}n=n.replace(r,"");const i=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,s=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let t=i.exec(n);if(null===t){if(t=s.exec(n),null===t)break;i.lastIndex=s.lastIndex}else s.lastIndex=i.lastIndex;e.push(t[0])}return e}async function Sn(t,e){if(null==t.ownerDocument)throw new Error("Provided element is not within a Document");const n=He(t.ownerDocument.styleSheets),r=await async function(t,e){const n=[],r=[];return t.forEach((n=>{if("cssRules"in n)try{He(n.cssRules||[]).forEach(((t,i)=>{if(t.type===CSSRule.IMPORT_RULE){let s=i+1;const o=bn(t.href).then((t=>xn(t,e))).then((t=>wn(t).forEach((t=>{try{n.insertRule(t,t.startsWith("@import")?s+=1:n.cssRules.length)}catch(e){console.error("Error inserting rule from remote css",{rule:t,error:e})}})))).catch((t=>{console.error("Error loading remote css",t.toString())}));r.push(o)}}))}catch(jR){const s=t.find((t=>null==t.href))||document.styleSheets[0];null!=n.href&&r.push(bn(n.href).then((t=>xn(t,e))).then((t=>wn(t).forEach((t=>{s.insertRule(t,n.cssRules.length)})))).catch((t=>{console.error("Error loading remote stylesheet",t)}))),console.error("Error inlining remote css file",jR)}})),Promise.all(r).then((()=>(t.forEach((t=>{if("cssRules"in t)try{He(t.cssRules||[]).forEach((t=>{n.push(t)}))}catch(jR){console.error(`Error while reading CSS rules from ${t.href}`,jR)}})),n)))}(n,e);return function(t){return t.filter((t=>t.type===CSSRule.FONT_FACE_RULE)).filter((t=>mn(t.style.getPropertyValue("src"))))}(r)}async function Mn(t,e){const n=null!=e.fontEmbedCSS?e.fontEmbedCSS:e.skipFonts?null:await async function(t,e){const n=await Sn(t,e);return(await Promise.all(n.map((t=>{const n=t.parentStyleSheet?t.parentStyleSheet.href:null;return gn(t.cssText,n,e)})))).join("\n")}(t,e);if(n){const e=document.createElement("style"),r=document.createTextNode(n);e.appendChild(r),t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}}async function En(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{width:n,height:r}=We(t,e),i=await un(t,e,!0);await Mn(i,e),await yn(i,e),function(t,e){const{style:n}=t;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=`${e.width}px`),e.height&&(n.height=`${e.height}px`);const r=e.style;null!=r&&Object.keys(r).forEach((t=>{n[t]=r[t]}))}(i,e);return await $e(i,n,r)}async function Tn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{width:n,height:r}=We(t,e),i=await En(t,e),s=await qe(i),o=document.createElement("canvas"),a=o.getContext("2d"),l=e.pixelRatio||function(){let t,e;try{e=process}catch(jR){}const n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}(),c=e.canvasWidth||n,u=e.canvasHeight||r;return o.width=c*l,o.height=u*l,e.skipAutoScale||function(t){(t.width>Ge||t.height>Ge)&&(t.width>Ge&&t.height>Ge?t.width>t.height?(t.height*=Ge/t.width,t.width=Ge):(t.width*=Ge/t.height,t.height=Ge):t.width>Ge?(t.height*=Ge/t.width,t.width=Ge):(t.width*=Ge/t.height,t.height=Ge))}(o),o.style.width=`${c}`,o.style.height=`${u}`,e.backgroundColor&&(a.fillStyle=e.backgroundColor,a.fillRect(0,0,o.width,o.height)),a.drawImage(s,0,0,o.width,o.height),o}var An,Cn=n(4994),Pn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},In={exports:{}},Rn={};In.exports=function(){if(An)return Rn;An=1;var e=t,n=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(t,e,r){var a,l={},c=null,u=null;for(a in void 0!==r&&(c=""+r),void 0!==e.key&&(c=""+e.key),void 0!==e.ref&&(u=e.ref),e)i.call(e,a)&&!o.hasOwnProperty(a)&&(l[a]=e[a]);if(t&&t.defaultProps)for(a in e=t.defaultProps)void 0===l[a]&&(l[a]=e[a]);return{$$typeof:n,type:t,key:c,ref:u,props:l,_owner:s.current}}return Rn.Fragment=r,Rn.jsx=a,Rn.jsxs=a,Rn}();var Ln=In.exports,Nn={exports:{}};!function(t,e){(function(){var n,r="Expected a function",i="__lodash_hash_undefined__",s="__lodash_placeholder__",o=16,a=32,l=64,c=128,u=256,h=1/0,d=9007199254740991,p=NaN,f=4294967295,m=f-1,g=f>>>1,v=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",o],["flip",512],["partial",a],["partialRight",l],["rearg",u]],y="[object Arguments]",_="[object Array]",b="[object Boolean]",x="[object Date]",w="[object Error]",S="[object Function]",M="[object GeneratorFunction]",E="[object Map]",T="[object Number]",A="[object Object]",C="[object Promise]",P="[object RegExp]",I="[object Set]",R="[object String]",L="[object Symbol]",N="[object WeakMap]",O="[object ArrayBuffer]",k="[object DataView]",D="[object Float32Array]",z="[object Float64Array]",U="[object Int8Array]",F="[object Int16Array]",B="[object Int32Array]",V="[object Uint8Array]",H="[object Uint8ClampedArray]",j="[object Uint16Array]",W="[object Uint32Array]",G=/\b__p \+= '';/g,q=/\b(__p \+=) '' \+/g,$=/(__e\(.*?\)|\b__t\)) \+\n'';/g,X=/&(?:amp|lt|gt|quot|#39);/g,J=/[&<>"']/g,Y=RegExp(X.source),Z=RegExp(J.source),K=/<%-([\s\S]+?)%>/g,Q=/<%([\s\S]+?)%>/g,tt=/<%=([\s\S]+?)%>/g,et=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nt=/^\w*$/,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/[\\^$.*+?()[\]{}|]/g,st=RegExp(it.source),ot=/^\s+/,at=/\s/,lt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ct=/\{\n\/\* \[wrapped with (.+)\] \*/,ut=/,? & /,ht=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,dt=/[()=,{}\[\]\/\s]/,pt=/\\(\\)?/g,ft=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mt=/\w*$/,gt=/^[-+]0x[0-9a-f]+$/i,vt=/^0b[01]+$/i,yt=/^\[object .+?Constructor\]$/,_t=/^0o[0-7]+$/i,bt=/^(?:0|[1-9]\d*)$/,xt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,wt=/($^)/,St=/['\n\r\u2028\u2029\\]/g,Mt="\\ud800-\\udfff",Et="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Tt="\\u2700-\\u27bf",At="a-z\\xdf-\\xf6\\xf8-\\xff",Ct="A-Z\\xc0-\\xd6\\xd8-\\xde",Pt="\\ufe0e\\ufe0f",It="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Rt="['\u2019]",Lt="["+Mt+"]",Nt="["+It+"]",Ot="["+Et+"]",kt="\\d+",Dt="["+Tt+"]",zt="["+At+"]",Ut="[^"+Mt+It+kt+Tt+At+Ct+"]",Ft="\\ud83c[\\udffb-\\udfff]",Bt="[^"+Mt+"]",Vt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ht="[\\ud800-\\udbff][\\udc00-\\udfff]",jt="["+Ct+"]",Wt="\\u200d",Gt="(?:"+zt+"|"+Ut+")",qt="(?:"+jt+"|"+Ut+")",$t="(?:['\u2019](?:d|ll|m|re|s|t|ve))?",Xt="(?:['\u2019](?:D|LL|M|RE|S|T|VE))?",Jt="(?:"+Ot+"|"+Ft+")"+"?",Yt="["+Pt+"]?",Zt=Yt+Jt+("(?:"+Wt+"(?:"+[Bt,Vt,Ht].join("|")+")"+Yt+Jt+")*"),Kt="(?:"+[Dt,Vt,Ht].join("|")+")"+Zt,Qt="(?:"+[Bt+Ot+"?",Ot,Vt,Ht,Lt].join("|")+")",te=RegExp(Rt,"g"),ee=RegExp(Ot,"g"),ne=RegExp(Ft+"(?="+Ft+")|"+Qt+Zt,"g"),re=RegExp([jt+"?"+zt+"+"+$t+"(?="+[Nt,jt,"$"].join("|")+")",qt+"+"+Xt+"(?="+[Nt,jt+Gt,"$"].join("|")+")",jt+"?"+Gt+"+"+$t,jt+"+"+Xt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",kt,Kt].join("|"),"g"),ie=RegExp("["+Wt+Mt+Et+Pt+"]"),se=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,oe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ae=-1,le={};le[D]=le[z]=le[U]=le[F]=le[B]=le[V]=le[H]=le[j]=le[W]=!0,le[y]=le[_]=le[O]=le[b]=le[k]=le[x]=le[w]=le[S]=le[E]=le[T]=le[A]=le[P]=le[I]=le[R]=le[N]=!1;var ce={};ce[y]=ce[_]=ce[O]=ce[k]=ce[b]=ce[x]=ce[D]=ce[z]=ce[U]=ce[F]=ce[B]=ce[E]=ce[T]=ce[A]=ce[P]=ce[I]=ce[R]=ce[L]=ce[V]=ce[H]=ce[j]=ce[W]=!0,ce[w]=ce[S]=ce[N]=!1;var ue={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},he=parseFloat,de=parseInt,pe="object"==typeof Pn&&Pn&&Pn.Object===Object&&Pn,fe="object"==typeof self&&self&&self.Object===Object&&self,me=pe||fe||Function("return this")(),ge=e&&!e.nodeType&&e,ve=ge&&t&&!t.nodeType&&t,ye=ve&&ve.exports===ge,_e=ye&&pe.process,be=function(){try{return ve&&ve.require&&ve.require("util").types||_e&&_e.binding&&_e.binding("util")}catch{}}(),xe=be&&be.isArrayBuffer,we=be&&be.isDate,Se=be&&be.isMap,Me=be&&be.isRegExp,Ee=be&&be.isSet,Te=be&&be.isTypedArray;function Ae(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ce(t,e,n,r){for(var i=-1,s=null==t?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function Pe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Ie(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Re(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Le(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Ne(t,e){return!!(null==t?0:t.length)&&je(t,e,0)>-1}function Oe(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function ke(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function De(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function ze(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function Ue(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Fe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Be=$e("length");function Ve(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function He(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function je(t,e,n){return e===e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):He(t,Ge,n)}function We(t,e,n,r){for(var i=n-1,s=t.length;++i<s;)if(r(t[i],e))return i;return-1}function Ge(t){return t!==t}function qe(t,e){var n=null==t?0:t.length;return n?Ye(t,e)/n:p}function $e(t){return function(e){return null==e?n:e[t]}}function Xe(t){return function(e){return null==t?n:t[e]}}function Je(t,e,n,r,i){return i(t,(function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)})),n}function Ye(t,e){for(var r,i=-1,s=t.length;++i<s;){var o=e(t[i]);o!==n&&(r=r===n?o:r+o)}return r}function Ze(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ke(t){return t&&t.slice(0,mn(t)+1).replace(ot,"")}function Qe(t){return function(e){return t(e)}}function tn(t,e){return ke(e,(function(e){return t[e]}))}function en(t,e){return t.has(e)}function nn(t,e){for(var n=-1,r=t.length;++n<r&&je(e,t[n],0)>-1;);return n}function rn(t,e){for(var n=t.length;n--&&je(e,t[n],0)>-1;);return n}var sn=Xe({"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"}),on=Xe({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function an(t){return"\\"+ue[t]}function ln(t){return ie.test(t)}function cn(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function un(t,e){return function(n){return t(e(n))}}function hn(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];(a===e||a===s)&&(t[n]=s,o[i++]=n)}return o}function dn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function pn(t){return ln(t)?function(t){for(var e=ne.lastIndex=0;ne.test(t);)++e;return e}(t):Be(t)}function fn(t){return ln(t)?function(t){return t.match(ne)||[]}(t):function(t){return t.split("")}(t)}function mn(t){for(var e=t.length;e--&&at.test(t.charAt(e)););return e}var gn=Xe({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var vn=function t(e){var at=(e=null==e?me:vn.defaults(me.Object(),e,vn.pick(me,oe))).Array,Mt=e.Date,Et=e.Error,Tt=e.Function,At=e.Math,Ct=e.Object,Pt=e.RegExp,It=e.String,Rt=e.TypeError,Lt=at.prototype,Nt=Tt.prototype,Ot=Ct.prototype,kt=e["__core-js_shared__"],Dt=Nt.toString,zt=Ot.hasOwnProperty,Ut=0,Ft=function(){var t=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Bt=Ot.toString,Vt=Dt.call(Ct),Ht=me._,jt=Pt("^"+Dt.call(zt).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Wt=ye?e.Buffer:n,Gt=e.Symbol,qt=e.Uint8Array,$t=Wt?Wt.allocUnsafe:n,Xt=un(Ct.getPrototypeOf,Ct),Jt=Ct.create,Yt=Ot.propertyIsEnumerable,Zt=Lt.splice,Kt=Gt?Gt.isConcatSpreadable:n,Qt=Gt?Gt.iterator:n,ne=Gt?Gt.toStringTag:n,ie=function(){try{var t=ds(Ct,"defineProperty");return t({},"",{}),t}catch{}}(),ue=e.clearTimeout!==me.clearTimeout&&e.clearTimeout,pe=Mt&&Mt.now!==me.Date.now&&Mt.now,fe=e.setTimeout!==me.setTimeout&&e.setTimeout,ge=At.ceil,ve=At.floor,_e=Ct.getOwnPropertySymbols,be=Wt?Wt.isBuffer:n,Be=e.isFinite,Xe=Lt.join,yn=un(Ct.keys,Ct),_n=At.max,bn=At.min,xn=Mt.now,wn=e.parseInt,Sn=At.random,Mn=Lt.reverse,En=ds(e,"DataView"),Tn=ds(e,"Map"),An=ds(e,"Promise"),Cn=ds(e,"Set"),Pn=ds(e,"WeakMap"),In=ds(Ct,"create"),Rn=Pn&&new Pn,Ln={},Nn=Us(En),On=Us(Tn),kn=Us(An),Dn=Us(Cn),zn=Us(Pn),Un=Gt?Gt.prototype:n,Fn=Un?Un.valueOf:n,Bn=Un?Un.toString:n;function Vn(t){if(na(t)&&!Go(t)&&!(t instanceof Gn)){if(t instanceof Wn)return t;if(zt.call(t,"__wrapped__"))return Fs(t)}return new Wn(t)}var Hn=function(){function t(){}return function(e){if(!ea(e))return{};if(Jt)return Jt(e);t.prototype=e;var r=new t;return t.prototype=n,r}}();function jn(){}function Wn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=n}function Gn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}function qn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function $n(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Xn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Jn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Xn;++e<n;)this.add(t[e])}function Yn(t){var e=this.__data__=new $n(t);this.size=e.size}function Zn(t,e){var n=Go(t),r=!n&&Wo(t),i=!n&&!r&&Jo(t),s=!n&&!r&&!i&&ua(t),o=n||r||i||s,a=o?Ze(t.length,It):[],l=a.length;for(var c in t)(e||zt.call(t,c))&&(!o||!("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||_s(c,l)))&&a.push(c);return a}function Kn(t){var e=t.length;return e?t[Jr(0,e-1)]:n}function Qn(t,e){return ks(Ii(t),lr(e,0,t.length))}function tr(t){return ks(Ii(t))}function er(t,e,r){(r!==n&&!Vo(t[e],r)||r===n&&!(e in t))&&or(t,e,r)}function nr(t,e,r){var i=t[e];(!zt.call(t,e)||!Vo(i,r)||r===n&&!(e in t))&&or(t,e,r)}function rr(t,e){for(var n=t.length;n--;)if(Vo(t[n][0],e))return n;return-1}function ir(t,e,n,r){return pr(t,(function(t,i,s){e(r,t,n(t),s)})),r}function sr(t,e){return t&&Ri(e,La(e),t)}function or(t,e,n){"__proto__"==e&&ie?ie(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ar(t,e){for(var r=-1,i=e.length,s=at(i),o=null==t;++r<i;)s[r]=o?n:Aa(t,e[r]);return s}function lr(t,e,r){return t===t&&(r!==n&&(t=t<=r?t:r),e!==n&&(t=t>=e?t:e)),t}function cr(t,e,r,i,s,o){var a,l=1&e,c=2&e,u=4&e;if(r&&(a=s?r(t,i,s,o):r(t)),a!==n)return a;if(!ea(t))return t;var h=Go(t);if(h){if(a=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&zt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!l)return Ii(t,a)}else{var d=ms(t),p=d==S||d==M;if(Jo(t))return Mi(t,l);if(d==A||d==y||p&&!s){if(a=c||p?{}:vs(t),!l)return c?function(t,e){return Ri(t,fs(t),e)}(t,function(t,e){return t&&Ri(e,Na(e),t)}(a,t)):function(t,e){return Ri(t,ps(t),e)}(t,sr(a,t))}else{if(!ce[d])return s?t:{};a=function(t,e,n){var r=t.constructor;switch(e){case O:return Ei(t);case b:case x:return new r(+t);case k:return function(t,e){var n=e?Ei(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case D:case z:case U:case F:case B:case V:case H:case j:case W:return Ti(t,n);case E:return new r;case T:case R:return new r(t);case P:return function(t){var e=new t.constructor(t.source,mt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case I:return new r;case L:return function(t){return Fn?Ct(Fn.call(t)):{}}(t)}}(t,d,l)}}o||(o=new Yn);var f=o.get(t);if(f)return f;o.set(t,a),aa(t)?t.forEach((function(n){a.add(cr(n,e,r,n,t,o))})):ra(t)&&t.forEach((function(n,i){a.set(i,cr(n,e,r,i,t,o))}));var m=h?n:(u?c?ss:is:c?Na:La)(t);return Pe(m||t,(function(n,i){m&&(n=t[i=n]),nr(a,i,cr(n,e,r,i,t,o))})),a}function ur(t,e,r){var i=r.length;if(null==t)return!i;for(t=Ct(t);i--;){var s=r[i],o=e[s],a=t[s];if(a===n&&!(s in t)||!o(a))return!1}return!0}function hr(t,e,i){if("function"!=typeof t)throw new Rt(r);return Rs((function(){t.apply(n,i)}),e)}function dr(t,e,n,r){var i=-1,s=Ne,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;n&&(e=ke(e,Qe(n))),r?(s=Oe,o=!1):e.length>=200&&(s=en,o=!1,e=new Jn(e));t:for(;++i<a;){var u=t[i],h=null==n?u:n(u);if(u=r||0!==u?u:0,o&&h===h){for(var d=c;d--;)if(e[d]===h)continue t;l.push(u)}else s(e,h,r)||l.push(u)}return l}Vn.templateSettings={escape:K,evaluate:Q,interpolate:tt,variable:"",imports:{_:Vn}},Vn.prototype=jn.prototype,Vn.prototype.constructor=Vn,Wn.prototype=Hn(jn.prototype),Wn.prototype.constructor=Wn,Gn.prototype=Hn(jn.prototype),Gn.prototype.constructor=Gn,qn.prototype.clear=function(){this.__data__=In?In(null):{},this.size=0},qn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},qn.prototype.get=function(t){var e=this.__data__;if(In){var r=e[t];return r===i?n:r}return zt.call(e,t)?e[t]:n},qn.prototype.has=function(t){var e=this.__data__;return In?e[t]!==n:zt.call(e,t)},qn.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=In&&e===n?i:e,this},$n.prototype.clear=function(){this.__data__=[],this.size=0},$n.prototype.delete=function(t){var e=this.__data__,n=rr(e,t);return!(n<0)&&(n==e.length-1?e.pop():Zt.call(e,n,1),--this.size,!0)},$n.prototype.get=function(t){var e=this.__data__,r=rr(e,t);return r<0?n:e[r][1]},$n.prototype.has=function(t){return rr(this.__data__,t)>-1},$n.prototype.set=function(t,e){var n=this.__data__,r=rr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Xn.prototype.clear=function(){this.size=0,this.__data__={hash:new qn,map:new(Tn||$n),string:new qn}},Xn.prototype.delete=function(t){var e=us(this,t).delete(t);return this.size-=e?1:0,e},Xn.prototype.get=function(t){return us(this,t).get(t)},Xn.prototype.has=function(t){return us(this,t).has(t)},Xn.prototype.set=function(t,e){var n=us(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Jn.prototype.add=Jn.prototype.push=function(t){return this.__data__.set(t,i),this},Jn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.clear=function(){this.__data__=new $n,this.size=0},Yn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Yn.prototype.get=function(t){return this.__data__.get(t)},Yn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof $n){var r=n.__data__;if(!Tn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Xn(r)}return n.set(t,e),this.size=n.size,this};var pr=Oi(xr),fr=Oi(wr,!0);function mr(t,e){var n=!0;return pr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function gr(t,e,r){for(var i=-1,s=t.length;++i<s;){var o=t[i],a=e(o);if(null!=a&&(l===n?a===a&&!ca(a):r(a,l)))var l=a,c=o}return c}function vr(t,e){var n=[];return pr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function yr(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=ys),i||(i=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?yr(a,e-1,n,r,i):De(i,a):r||(i[i.length]=a)}return i}var _r=ki(),br=ki(!0);function xr(t,e){return t&&_r(t,e,La)}function wr(t,e){return t&&br(t,e,La)}function Sr(t,e){return Le(e,(function(e){return Ko(t[e])}))}function Mr(t,e){for(var r=0,i=(e=bi(e,t)).length;null!=t&&r<i;)t=t[zs(e[r++])];return r&&r==i?t:n}function Er(t,e,n){var r=e(t);return Go(t)?r:De(r,n(t))}function Tr(t){return null==t?t===n?"[object Undefined]":"[object Null]":ne&&ne in Ct(t)?function(t){var e=zt.call(t,ne),r=t[ne];try{t[ne]=n;var i=!0}catch{}var s=Bt.call(t);return i&&(e?t[ne]=r:delete t[ne]),s}(t):function(t){return Bt.call(t)}(t)}function Ar(t,e){return t>e}function Cr(t,e){return null!=t&&zt.call(t,e)}function Pr(t,e){return null!=t&&e in Ct(t)}function Ir(t,e,r){for(var i=r?Oe:Ne,s=t[0].length,o=t.length,a=o,l=at(o),c=1/0,u=[];a--;){var h=t[a];a&&e&&(h=ke(h,Qe(e))),c=bn(h.length,c),l[a]=!r&&(e||s>=120&&h.length>=120)?new Jn(a&&h):n}h=t[0];var d=-1,p=l[0];t:for(;++d<s&&u.length<c;){var f=h[d],m=e?e(f):f;if(f=r||0!==f?f:0,!(p?en(p,m):i(u,m,r))){for(a=o;--a;){var g=l[a];if(!(g?en(g,m):i(t[a],m,r)))continue t}p&&p.push(m),u.push(f)}}return u}function Rr(t,e,r){var i=null==(t=Cs(t,e=bi(e,t)))?t:t[zs(Ys(e))];return null==i?n:Ae(i,t,r)}function Lr(t){return na(t)&&Tr(t)==y}function Nr(t,e,r,i,s){return t===e||(null==t||null==e||!na(t)&&!na(e)?t!==t&&e!==e:function(t,e,r,i,s,o){var a=Go(t),l=Go(e),c=a?_:ms(t),u=l?_:ms(e),h=(c=c==y?A:c)==A,d=(u=u==y?A:u)==A,p=c==u;if(p&&Jo(t)){if(!Jo(e))return!1;a=!0,h=!1}if(p&&!h)return o||(o=new Yn),a||ua(t)?ns(t,e,r,i,s,o):function(t,e,n,r,i,s,o){switch(n){case k:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case O:return!(t.byteLength!=e.byteLength||!s(new qt(t),new qt(e)));case b:case x:case T:return Vo(+t,+e);case w:return t.name==e.name&&t.message==e.message;case P:case R:return t==e+"";case E:var a=cn;case I:var l=1&r;if(a||(a=dn),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;r|=2,o.set(t,e);var u=ns(a(t),a(e),r,i,s,o);return o.delete(t),u;case L:if(Fn)return Fn.call(t)==Fn.call(e)}return!1}(t,e,c,r,i,s,o);if(!(1&r)){var f=h&&zt.call(t,"__wrapped__"),m=d&&zt.call(e,"__wrapped__");if(f||m){var g=f?t.value():t,v=m?e.value():e;return o||(o=new Yn),s(g,v,r,i,o)}}return!!p&&(o||(o=new Yn),function(t,e,r,i,s,o){var a=1&r,l=is(t),c=l.length,u=is(e),h=u.length;if(c!=h&&!a)return!1;for(var d=c;d--;){var p=l[d];if(!(a?p in e:zt.call(e,p)))return!1}var f=o.get(t),m=o.get(e);if(f&&m)return f==e&&m==t;var g=!0;o.set(t,e),o.set(e,t);for(var v=a;++d<c;){var y=t[p=l[d]],_=e[p];if(i)var b=a?i(_,y,p,e,t,o):i(y,_,p,t,e,o);if(!(b===n?y===_||s(y,_,r,i,o):b)){g=!1;break}v||(v="constructor"==p)}if(g&&!v){var x=t.constructor,w=e.constructor;x!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w)&&(g=!1)}return o.delete(t),o.delete(e),g}(t,e,r,i,s,o))}(t,e,r,i,Nr,s))}function Or(t,e,r,i){var s=r.length,o=s,a=!i;if(null==t)return!o;for(t=Ct(t);s--;){var l=r[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<o;){var c=(l=r[s])[0],u=t[c],h=l[1];if(a&&l[2]){if(u===n&&!(c in t))return!1}else{var d=new Yn;if(i)var p=i(u,h,c,t,e,d);if(!(p===n?Nr(h,u,3,i,d):p))return!1}}return!0}function kr(t){return!(!ea(t)||function(t){return!!Ft&&Ft in t}(t))&&(Ko(t)?jt:yt).test(Us(t))}function Dr(t){return"function"==typeof t?t:null==t?il:"object"==typeof t?Go(t)?Hr(t[0],t[1]):Vr(t):pl(t)}function zr(t){if(!Ms(t))return yn(t);var e=[];for(var n in Ct(t))zt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Ur(t){if(!ea(t))return function(t){var e=[];if(null!=t)for(var n in Ct(t))e.push(n);return e}(t);var e=Ms(t),n=[];for(var r in t)"constructor"==r&&(e||!zt.call(t,r))||n.push(r);return n}function Fr(t,e){return t<e}function Br(t,e){var n=-1,r=$o(t)?at(t.length):[];return pr(t,(function(t,i,s){r[++n]=e(t,i,s)})),r}function Vr(t){var e=hs(t);return 1==e.length&&e[0][2]?Ts(e[0][0],e[0][1]):function(n){return n===t||Or(n,t,e)}}function Hr(t,e){return xs(t)&&Es(e)?Ts(zs(t),e):function(r){var i=Aa(r,t);return i===n&&i===e?Ca(r,t):Nr(e,i,3)}}function jr(t,e,r,i,s){t!==e&&_r(e,(function(o,a){if(s||(s=new Yn),ea(o))!function(t,e,r,i,s,o,a){var l=Ps(t,r),c=Ps(e,r),u=a.get(c);if(u)return void er(t,r,u);var h=o?o(l,c,r+"",t,e,a):n,d=h===n;if(d){var p=Go(c),f=!p&&Jo(c),m=!p&&!f&&ua(c);h=c,p||f||m?Go(l)?h=l:Xo(l)?h=Ii(l):f?(d=!1,h=Mi(c,!0)):m?(d=!1,h=Ti(c,!0)):h=[]:sa(c)||Wo(c)?(h=l,Wo(l)?h=ya(l):(!ea(l)||Ko(l))&&(h=vs(c))):d=!1}d&&(a.set(c,h),s(h,c,i,o,a),a.delete(c)),er(t,r,h)}(t,e,a,r,jr,i,s);else{var l=i?i(Ps(t,a),o,a+"",t,e,s):n;l===n&&(l=o),er(t,a,l)}}),Na)}function Wr(t,e){var r=t.length;if(r)return _s(e+=e<0?r:0,r)?t[e]:n}function Gr(t,e,n){e=e.length?ke(e,(function(t){return Go(t)?function(e){return Mr(e,1===t.length?t[0]:t)}:t})):[il];var r=-1;return e=ke(e,Qe(cs())),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(Br(t,(function(t,n,i){return{criteria:ke(e,(function(e){return e(t)})),index:++r,value:t}})),(function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,s=e.criteria,o=i.length,a=n.length;++r<o;){var l=Ai(i[r],s[r]);if(l)return r>=a?l:l*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function qr(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Mr(t,o);n(a,o)&&ti(s,bi(o,t),a)}return s}function $r(t,e,n,r){var i=r?We:je,s=-1,o=e.length,a=t;for(t===e&&(e=Ii(e)),n&&(a=ke(t,Qe(n)));++s<o;)for(var l=0,c=e[s],u=n?n(c):c;(l=i(a,u,l,r))>-1;)a!==t&&Zt.call(a,l,1),Zt.call(t,l,1);return t}function Xr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==s){var s=i;_s(i)?Zt.call(t,i,1):di(t,i)}}return t}function Jr(t,e){return t+ve(Sn()*(e-t+1))}function Yr(t,e){var n="";if(!t||e<1||e>d)return n;do{e%2&&(n+=t),(e=ve(e/2))&&(t+=t)}while(e);return n}function Zr(t,e){return Ls(As(t,e,il),t+"")}function Kr(t){return Kn(Va(t))}function Qr(t,e){var n=Va(t);return ks(n,lr(e,0,n.length))}function ti(t,e,r,i){if(!ea(t))return t;for(var s=-1,o=(e=bi(e,t)).length,a=o-1,l=t;null!=l&&++s<o;){var c=zs(e[s]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(s!=a){var h=l[c];(u=i?i(h,c,l):n)===n&&(u=ea(h)?h:_s(e[s+1])?[]:{})}nr(l,c,u),l=l[c]}return t}var ei=Rn?function(t,e){return Rn.set(t,e),t}:il,ni=ie?function(t,e){return ie(t,"toString",{configurable:!0,enumerable:!1,value:el(e),writable:!0})}:il;function ri(t){return ks(Va(t))}function ii(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=at(i);++r<i;)s[r]=t[r+e];return s}function si(t,e){var n;return pr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function oi(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e===e&&i<=g){for(;r<i;){var s=r+i>>>1,o=t[s];null!==o&&!ca(o)&&(n?o<=e:o<e)?r=s+1:i=s}return i}return ai(t,e,il,n)}function ai(t,e,r,i){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=r(e))!==e,l=null===e,c=ca(e),u=e===n;s<o;){var h=ve((s+o)/2),d=r(t[h]),p=d!==n,f=null===d,g=d===d,v=ca(d);if(a)var y=i||g;else y=u?g&&(i||p):l?g&&p&&(i||!f):c?g&&p&&!f&&(i||!v):!f&&!v&&(i?d<=e:d<e);y?s=h+1:o=h}return bn(o,m)}function li(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var o=t[n],a=e?e(o):o;if(!n||!Vo(a,l)){var l=a;s[i++]=0===o?0:o}}return s}function ci(t){return"number"==typeof t?t:ca(t)?p:+t}function ui(t){if("string"==typeof t)return t;if(Go(t))return ke(t,ui)+"";if(ca(t))return Bn?Bn.call(t):"";var e=t+"";return"0"==e&&1/t==-h?"-0":e}function hi(t,e,n){var r=-1,i=Ne,s=t.length,o=!0,a=[],l=a;if(n)o=!1,i=Oe;else if(s>=200){var c=e?null:Yi(t);if(c)return dn(c);o=!1,i=en,l=new Jn}else l=e?[]:a;t:for(;++r<s;){var u=t[r],h=e?e(u):u;if(u=n||0!==u?u:0,o&&h===h){for(var d=l.length;d--;)if(l[d]===h)continue t;e&&l.push(h),a.push(u)}else i(l,h,n)||(l!==a&&l.push(h),a.push(u))}return a}function di(t,e){return null==(t=Cs(t,e=bi(e,t)))||delete t[zs(Ys(e))]}function pi(t,e,n,r){return ti(t,e,n(Mr(t,e)),r)}function fi(t,e,n,r){for(var i=t.length,s=r?i:-1;(r?s--:++s<i)&&e(t[s],s,t););return n?ii(t,r?0:s,r?s+1:i):ii(t,r?s+1:0,r?i:s)}function mi(t,e){var n=t;return n instanceof Gn&&(n=n.value()),ze(e,(function(t,e){return e.func.apply(e.thisArg,De([t],e.args))}),n)}function gi(t,e,n){var r=t.length;if(r<2)return r?hi(t[0]):[];for(var i=-1,s=at(r);++i<r;)for(var o=t[i],a=-1;++a<r;)a!=i&&(s[i]=dr(s[i]||o,t[a],e,n));return hi(yr(s,1),e,n)}function vi(t,e,r){for(var i=-1,s=t.length,o=e.length,a={};++i<s;){var l=i<o?e[i]:n;r(a,t[i],l)}return a}function yi(t){return Xo(t)?t:[]}function _i(t){return"function"==typeof t?t:il}function bi(t,e){return Go(t)?t:xs(t,e)?[t]:Ds(_a(t))}var xi=Zr;function wi(t,e,r){var i=t.length;return r=r===n?i:r,!e&&r>=i?t:ii(t,e,r)}var Si=ue||function(t){return me.clearTimeout(t)};function Mi(t,e){if(e)return t.slice();var n=t.length,r=$t?$t(n):new t.constructor(n);return t.copy(r),r}function Ei(t){var e=new t.constructor(t.byteLength);return new qt(e).set(new qt(t)),e}function Ti(t,e){var n=e?Ei(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Ai(t,e){if(t!==e){var r=t!==n,i=null===t,s=t===t,o=ca(t),a=e!==n,l=null===e,c=e===e,u=ca(e);if(!l&&!u&&!o&&t>e||o&&a&&c&&!l&&!u||i&&a&&c||!r&&c||!s)return 1;if(!i&&!o&&!u&&t<e||u&&r&&s&&!i&&!o||l&&r&&s||!a&&s||!c)return-1}return 0}function Ci(t,e,n,r){for(var i=-1,s=t.length,o=n.length,a=-1,l=e.length,c=_n(s-o,0),u=at(l+c),h=!r;++a<l;)u[a]=e[a];for(;++i<o;)(h||i<s)&&(u[n[i]]=t[i]);for(;c--;)u[a++]=t[i++];return u}function Pi(t,e,n,r){for(var i=-1,s=t.length,o=-1,a=n.length,l=-1,c=e.length,u=_n(s-a,0),h=at(u+c),d=!r;++i<u;)h[i]=t[i];for(var p=i;++l<c;)h[p+l]=e[l];for(;++o<a;)(d||i<s)&&(h[p+n[o]]=t[i++]);return h}function Ii(t,e){var n=-1,r=t.length;for(e||(e=at(r));++n<r;)e[n]=t[n];return e}function Ri(t,e,r,i){var s=!r;r||(r={});for(var o=-1,a=e.length;++o<a;){var l=e[o],c=i?i(r[l],t[l],l,r,t):n;c===n&&(c=t[l]),s?or(r,l,c):nr(r,l,c)}return r}function Li(t,e){return function(n,r){var i=Go(n)?Ce:ir,s=e?e():{};return i(n,t,cs(r,2),s)}}function Ni(t){return Zr((function(e,r){var i=-1,s=r.length,o=s>1?r[s-1]:n,a=s>2?r[2]:n;for(o=t.length>3&&"function"==typeof o?(s--,o):n,a&&bs(r[0],r[1],a)&&(o=s<3?n:o,s=1),e=Ct(e);++i<s;){var l=r[i];l&&t(e,l,i,o)}return e}))}function Oi(t,e){return function(n,r){if(null==n)return n;if(!$o(n))return t(n,r);for(var i=n.length,s=e?i:-1,o=Ct(n);(e?s--:++s<i)&&!1!==r(o[s],s,o););return n}}function ki(t){return function(e,n,r){for(var i=-1,s=Ct(e),o=r(e),a=o.length;a--;){var l=o[t?a:++i];if(!1===n(s[l],l,s))break}return e}}function Di(t){return function(e){var r=ln(e=_a(e))?fn(e):n,i=r?r[0]:e.charAt(0),s=r?wi(r,1).join(""):e.slice(1);return i[t]()+s}}function zi(t){return function(e){return ze(Ka(Wa(e).replace(te,"")),t,"")}}function Ui(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Hn(t.prototype),r=t.apply(n,e);return ea(r)?r:n}}function Fi(t){return function(e,r,i){var s=Ct(e);if(!$o(e)){var o=cs(r,3);e=La(e),r=function(t){return o(s[t],t,s)}}var a=t(e,r,i);return a>-1?s[o?e[a]:a]:n}}function Bi(t){return rs((function(e){var i=e.length,s=i,o=Wn.prototype.thru;for(t&&e.reverse();s--;){var a=e[s];if("function"!=typeof a)throw new Rt(r);if(o&&!l&&"wrapper"==as(a))var l=new Wn([],!0)}for(s=l?s:i;++s<i;){var c=as(a=e[s]),u="wrapper"==c?os(a):n;l=u&&ws(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[as(u[0])].apply(l,u[3]):1==a.length&&ws(a)?l[c]():l.thru(a)}return function(){var t=arguments,n=t[0];if(l&&1==t.length&&Go(n))return l.plant(n).value();for(var r=0,s=i?e[r].apply(this,t):n;++r<i;)s=e[r].call(this,s);return s}}))}function Vi(t,e,r,i,s,o,a,l,u,h){var d=e&c,p=1&e,f=2&e,m=24&e,g=512&e,v=f?n:Ui(t);return function c(){for(var y=arguments.length,_=at(y),b=y;b--;)_[b]=arguments[b];if(m)var x=ls(c),w=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(_,x);if(i&&(_=Ci(_,i,s,m)),o&&(_=Pi(_,o,a,m)),y-=w,m&&y<h){var S=hn(_,x);return Xi(t,e,Vi,c.placeholder,r,_,S,l,u,h-y)}var M=p?r:this,E=f?M[t]:t;return y=_.length,l?_=function(t,e){for(var r=t.length,i=bn(e.length,r),s=Ii(t);i--;){var o=e[i];t[i]=_s(o,r)?s[o]:n}return t}(_,l):g&&y>1&&_.reverse(),d&&u<y&&(_.length=u),this&&this!==me&&this instanceof c&&(E=v||Ui(E)),E.apply(M,_)}}function Hi(t,e){return function(n,r){return function(t,e,n,r){return xr(t,(function(t,i,s){e(r,n(t),i,s)})),r}(n,t,e(r),{})}}function ji(t,e){return function(r,i){var s;if(r===n&&i===n)return e;if(r!==n&&(s=r),i!==n){if(s===n)return i;"string"==typeof r||"string"==typeof i?(r=ui(r),i=ui(i)):(r=ci(r),i=ci(i)),s=t(r,i)}return s}}function Wi(t){return rs((function(e){return e=ke(e,Qe(cs())),Zr((function(n){var r=this;return t(e,(function(t){return Ae(t,r,n)}))}))}))}function Gi(t,e){var r=(e=e===n?" ":ui(e)).length;if(r<2)return r?Yr(e,t):e;var i=Yr(e,ge(t/pn(e)));return ln(e)?wi(fn(i),0,t).join(""):i.slice(0,t)}function qi(t){return function(e,r,i){return i&&"number"!=typeof i&&bs(e,r,i)&&(r=i=n),e=fa(e),r===n?(r=e,e=0):r=fa(r),function(t,e,n,r){for(var i=-1,s=_n(ge((e-t)/(n||1)),0),o=at(s);s--;)o[r?s:++i]=t,t+=n;return o}(e,r,i=i===n?e<r?1:-1:fa(i),t)}}function $i(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=va(e),n=va(n)),t(e,n)}}function Xi(t,e,r,i,s,o,c,u,h,d){var p=8&e;e|=p?a:l,4&(e&=~(p?l:a))||(e&=-4);var f=[t,e,s,p?o:n,p?c:n,p?n:o,p?n:c,u,h,d],m=r.apply(n,f);return ws(t)&&Is(m,f),m.placeholder=i,Ns(m,t,e)}function Ji(t){var e=At[t];return function(t,n){if(t=va(t),(n=null==n?0:bn(ma(n),292))&&Be(t)){var r=(_a(t)+"e").split("e");return+((r=(_a(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Yi=Cn&&1/dn(new Cn([,-0]))[1]==h?function(t){return new Cn(t)}:cl;function Zi(t){return function(e){var n=ms(e);return n==E?cn(e):n==I?function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}(e):function(t,e){return ke(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ki(t,e,i,h,d,p,f,m){var g=2&e;if(!g&&"function"!=typeof t)throw new Rt(r);var v=h?h.length:0;if(v||(e&=-97,h=d=n),f=f===n?f:_n(ma(f),0),m=m===n?m:ma(m),v-=d?d.length:0,e&l){var y=h,_=d;h=d=n}var b=g?n:os(t),x=[t,e,i,h,d,y,_,p,f,m];if(b&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<131,a=r==c&&8==n||r==c&&n==u&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!o&&!a)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var l=e[3];if(l){var h=t[3];t[3]=h?Ci(h,l,e[4]):l,t[4]=h?hn(t[3],s):e[4]}l=e[5],l&&(h=t[5],t[5]=h?Pi(h,l,e[6]):l,t[6]=h?hn(t[5],s):e[6]),l=e[7],l&&(t[7]=l),r&c&&(t[8]=null==t[8]?e[8]:bn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i}(x,b),t=x[0],e=x[1],i=x[2],h=x[3],d=x[4],!(m=x[9]=x[9]===n?g?0:t.length:_n(x[9]-v,0))&&24&e&&(e&=-25),e&&1!=e)w=8==e||e==o?function(t,e,r){var i=Ui(t);return function s(){for(var o=arguments.length,a=at(o),l=o,c=ls(s);l--;)a[l]=arguments[l];var u=o<3&&a[0]!==c&&a[o-1]!==c?[]:hn(a,c);return(o-=u.length)<r?Xi(t,e,Vi,s.placeholder,n,a,u,n,n,r-o):Ae(this&&this!==me&&this instanceof s?i:t,this,a)}}(t,e,m):e!=a&&33!=e||d.length?Vi.apply(n,x):function(t,e,n,r){var i=1&e,s=Ui(t);return function e(){for(var o=-1,a=arguments.length,l=-1,c=r.length,u=at(c+a),h=this&&this!==me&&this instanceof e?s:t;++l<c;)u[l]=r[l];for(;a--;)u[l++]=arguments[++o];return Ae(h,i?n:this,u)}}(t,e,i,h);else var w=function(t,e,n){var r=1&e,i=Ui(t);return function e(){return(this&&this!==me&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,i);return Ns((b?ei:Is)(w,x),t,e)}function Qi(t,e,r,i){return t===n||Vo(t,Ot[r])&&!zt.call(i,r)?e:t}function ts(t,e,r,i,s,o){return ea(t)&&ea(e)&&(o.set(e,t),jr(t,e,n,ts,o),o.delete(e)),t}function es(t){return sa(t)?n:t}function ns(t,e,r,i,s,o){var a=1&r,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var u=o.get(t),h=o.get(e);if(u&&h)return u==e&&h==t;var d=-1,p=!0,f=2&r?new Jn:n;for(o.set(t,e),o.set(e,t);++d<l;){var m=t[d],g=e[d];if(i)var v=a?i(g,m,d,e,t,o):i(m,g,d,t,e,o);if(v!==n){if(v)continue;p=!1;break}if(f){if(!Fe(e,(function(t,e){if(!en(f,e)&&(m===t||s(m,t,r,i,o)))return f.push(e)}))){p=!1;break}}else if(m!==g&&!s(m,g,r,i,o)){p=!1;break}}return o.delete(t),o.delete(e),p}function rs(t){return Ls(As(t,n,Gs),t+"")}function is(t){return Er(t,La,ps)}function ss(t){return Er(t,Na,fs)}var os=Rn?function(t){return Rn.get(t)}:cl;function as(t){for(var e=t.name+"",n=Ln[e],r=zt.call(Ln,e)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==t)return i.name}return e}function ls(t){return(zt.call(Vn,"placeholder")?Vn:t).placeholder}function cs(){var t=Vn.iteratee||sl;return t=t===sl?Dr:t,arguments.length?t(arguments[0],arguments[1]):t}function us(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function hs(t){for(var e=La(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Es(i)]}return e}function ds(t,e){var r=function(t,e){return null==t?n:t[e]}(t,e);return kr(r)?r:n}var ps=_e?function(t){return null==t?[]:(t=Ct(t),Le(_e(t),(function(e){return Yt.call(t,e)})))}:gl,fs=_e?function(t){for(var e=[];t;)De(e,ps(t)),t=Xt(t);return e}:gl,ms=Tr;function gs(t,e,n){for(var r=-1,i=(e=bi(e,t)).length,s=!1;++r<i;){var o=zs(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&ta(i)&&_s(o,i)&&(Go(t)||Wo(t))}function vs(t){return"function"!=typeof t.constructor||Ms(t)?{}:Hn(Xt(t))}function ys(t){return Go(t)||Wo(t)||!!(Kt&&t&&t[Kt])}function _s(t,e){var n=typeof t;return!!(e=e??d)&&("number"==n||"symbol"!=n&&bt.test(t))&&t>-1&&t%1==0&&t<e}function bs(t,e,n){if(!ea(n))return!1;var r=typeof e;return!!("number"==r?$o(n)&&_s(e,n.length):"string"==r&&e in n)&&Vo(n[e],t)}function xs(t,e){if(Go(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ca(t))||(nt.test(t)||!et.test(t)||null!=e&&t in Ct(e))}function ws(t){var e=as(t),n=Vn[e];if("function"!=typeof n||!(e in Gn.prototype))return!1;if(t===n)return!0;var r=os(n);return!!r&&t===r[0]}(En&&ms(new En(new ArrayBuffer(1)))!=k||Tn&&ms(new Tn)!=E||An&&ms(An.resolve())!=C||Cn&&ms(new Cn)!=I||Pn&&ms(new Pn)!=N)&&(ms=function(t){var e=Tr(t),r=e==A?t.constructor:n,i=r?Us(r):"";if(i)switch(i){case Nn:return k;case On:return E;case kn:return C;case Dn:return I;case zn:return N}return e});var Ss=kt?Ko:vl;function Ms(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ot)}function Es(t){return t===t&&!ea(t)}function Ts(t,e){return function(r){return null!=r&&(r[t]===e&&(e!==n||t in Ct(r)))}}function As(t,e,r){return e=_n(e===n?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=_n(n.length-e,0),o=at(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=at(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),Ae(t,this,a)}}function Cs(t,e){return e.length<2?t:Mr(t,ii(e,0,-1))}function Ps(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Is=Os(ei),Rs=fe||function(t,e){return me.setTimeout(t,e)},Ls=Os(ni);function Ns(t,e,n){var r=e+"";return Ls(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(lt,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Pe(v,(function(n){var r="_."+n[0];e&n[1]&&!Ne(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(ct);return e?e[1].split(ut):[]}(r),n)))}function Os(t){var e=0,r=0;return function(){var i=xn(),s=16-(i-r);if(r=i,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(n,arguments)}}function ks(t,e){var r=-1,i=t.length,s=i-1;for(e=e===n?i:e;++r<e;){var o=Jr(r,s),a=t[o];t[o]=t[r],t[r]=a}return t.length=e,t}var Ds=function(t){var e=ko(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(rt,(function(t,n,r,i){e.push(r?i.replace(pt,"$1"):n||t)})),e}));function zs(t){if("string"==typeof t||ca(t))return t;var e=t+"";return"0"==e&&1/t==-h?"-0":e}function Us(t){if(null!=t){try{return Dt.call(t)}catch{}try{return t+""}catch{}}return""}function Fs(t){if(t instanceof Gn)return t.clone();var e=new Wn(t.__wrapped__,t.__chain__);return e.__actions__=Ii(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Bs=Zr((function(t,e){return Xo(t)?dr(t,yr(e,1,Xo,!0)):[]})),Vs=Zr((function(t,e){var r=Ys(e);return Xo(r)&&(r=n),Xo(t)?dr(t,yr(e,1,Xo,!0),cs(r,2)):[]})),Hs=Zr((function(t,e){var r=Ys(e);return Xo(r)&&(r=n),Xo(t)?dr(t,yr(e,1,Xo,!0),n,r):[]}));function js(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ma(n);return i<0&&(i=_n(r+i,0)),He(t,cs(e,3),i)}function Ws(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i-1;return r!==n&&(s=ma(r),s=r<0?_n(i+s,0):bn(s,i-1)),He(t,cs(e,3),s,!0)}function Gs(t){return(null==t?0:t.length)?yr(t,1):[]}function qs(t){return t&&t.length?t[0]:n}var $s=Zr((function(t){var e=ke(t,yi);return e.length&&e[0]===t[0]?Ir(e):[]})),Xs=Zr((function(t){var e=Ys(t),r=ke(t,yi);return e===Ys(r)?e=n:r.pop(),r.length&&r[0]===t[0]?Ir(r,cs(e,2)):[]})),Js=Zr((function(t){var e=Ys(t),r=ke(t,yi);return(e="function"==typeof e?e:n)&&r.pop(),r.length&&r[0]===t[0]?Ir(r,n,e):[]}));function Ys(t){var e=null==t?0:t.length;return e?t[e-1]:n}var Zs=Zr(Ks);function Ks(t,e){return t&&t.length&&e&&e.length?$r(t,e):t}var Qs=rs((function(t,e){var n=null==t?0:t.length,r=ar(t,e);return Xr(t,ke(e,(function(t){return _s(t,n)?+t:t})).sort(Ai)),r}));function to(t){return null==t?t:Mn.call(t)}var eo=Zr((function(t){return hi(yr(t,1,Xo,!0))})),no=Zr((function(t){var e=Ys(t);return Xo(e)&&(e=n),hi(yr(t,1,Xo,!0),cs(e,2))})),ro=Zr((function(t){var e=Ys(t);return e="function"==typeof e?e:n,hi(yr(t,1,Xo,!0),n,e)}));function io(t){if(!t||!t.length)return[];var e=0;return t=Le(t,(function(t){if(Xo(t))return e=_n(t.length,e),!0})),Ze(e,(function(e){return ke(t,$e(e))}))}function so(t,e){if(!t||!t.length)return[];var r=io(t);return null==e?r:ke(r,(function(t){return Ae(e,n,t)}))}var oo=Zr((function(t,e){return Xo(t)?dr(t,e):[]})),ao=Zr((function(t){return gi(Le(t,Xo))})),lo=Zr((function(t){var e=Ys(t);return Xo(e)&&(e=n),gi(Le(t,Xo),cs(e,2))})),co=Zr((function(t){var e=Ys(t);return e="function"==typeof e?e:n,gi(Le(t,Xo),n,e)})),uo=Zr(io);var ho=Zr((function(t){var e=t.length,r=e>1?t[e-1]:n;return r="function"==typeof r?(t.pop(),r):n,so(t,r)}));function po(t){var e=Vn(t);return e.__chain__=!0,e}function fo(t,e){return e(t)}var mo=rs((function(t){var e=t.length,r=e?t[0]:0,i=this.__wrapped__,s=function(e){return ar(e,t)};return!(e>1||this.__actions__.length)&&i instanceof Gn&&_s(r)?((i=i.slice(r,+r+(e?1:0))).__actions__.push({func:fo,args:[s],thisArg:n}),new Wn(i,this.__chain__).thru((function(t){return e&&!t.length&&t.push(n),t}))):this.thru(s)}));var go=Li((function(t,e,n){zt.call(t,n)?++t[n]:or(t,n,1)}));var vo=Fi(js),yo=Fi(Ws);function _o(t,e){return(Go(t)?Pe:pr)(t,cs(e,3))}function bo(t,e){return(Go(t)?Ie:fr)(t,cs(e,3))}var xo=Li((function(t,e,n){zt.call(t,n)?t[n].push(e):or(t,n,[e])}));var wo=Zr((function(t,e,n){var r=-1,i="function"==typeof e,s=$o(t)?at(t.length):[];return pr(t,(function(t){s[++r]=i?Ae(e,t,n):Rr(t,e,n)})),s})),So=Li((function(t,e,n){or(t,n,e)}));function Mo(t,e){return(Go(t)?ke:Br)(t,cs(e,3))}var Eo=Li((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var To=Zr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&bs(t,e[0],e[1])?e=[]:n>2&&bs(e[0],e[1],e[2])&&(e=[e[0]]),Gr(t,yr(e,1),[])})),Ao=pe||function(){return me.Date.now()};function Co(t,e,r){return e=r?n:e,e=t&&null==e?t.length:e,Ki(t,c,n,n,n,n,e)}function Po(t,e){var i;if("function"!=typeof e)throw new Rt(r);return t=ma(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=n),i}}var Io=Zr((function(t,e,n){var r=1;if(n.length){var i=hn(n,ls(Io));r|=a}return Ki(t,r,e,n,i)})),Ro=Zr((function(t,e,n){var r=3;if(n.length){var i=hn(n,ls(Ro));r|=a}return Ki(e,r,t,n,i)}));function Lo(t,e,i){var s,o,a,l,c,u,h=0,d=!1,p=!1,f=!0;if("function"!=typeof t)throw new Rt(r);function m(e){var r=s,i=o;return s=o=n,h=e,l=t.apply(i,r)}function g(t){var r=t-u;return u===n||r>=e||r<0||p&&t-h>=a}function v(){var t=Ao();if(g(t))return y(t);c=Rs(v,function(t){var n=e-(t-u);return p?bn(n,a-(t-h)):n}(t))}function y(t){return c=n,f&&s?m(t):(s=o=n,l)}function _(){var t=Ao(),r=g(t);if(s=arguments,o=this,u=t,r){if(c===n)return function(t){return h=t,c=Rs(v,e),d?m(t):l}(u);if(p)return Si(c),c=Rs(v,e),m(u)}return c===n&&(c=Rs(v,e)),l}return e=va(e)||0,ea(i)&&(d=!!i.leading,a=(p="maxWait"in i)?_n(va(i.maxWait)||0,e):a,f="trailing"in i?!!i.trailing:f),_.cancel=function(){c!==n&&Si(c),h=0,s=u=o=c=n},_.flush=function(){return c===n?l:y(Ao())},_}var No=Zr((function(t,e){return hr(t,1,e)})),Oo=Zr((function(t,e,n){return hr(t,va(e)||0,n)}));function ko(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Rt(r);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(ko.Cache||Xn),n}function Do(t){if("function"!=typeof t)throw new Rt(r);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}ko.Cache=Xn;var zo=xi((function(t,e){var n=(e=1==e.length&&Go(e[0])?ke(e[0],Qe(cs())):ke(yr(e,1),Qe(cs()))).length;return Zr((function(r){for(var i=-1,s=bn(r.length,n);++i<s;)r[i]=e[i].call(this,r[i]);return Ae(t,this,r)}))})),Uo=Zr((function(t,e){var r=hn(e,ls(Uo));return Ki(t,a,n,e,r)})),Fo=Zr((function(t,e){var r=hn(e,ls(Fo));return Ki(t,l,n,e,r)})),Bo=rs((function(t,e){return Ki(t,u,n,n,n,e)}));function Vo(t,e){return t===e||t!==t&&e!==e}var Ho=$i(Ar),jo=$i((function(t,e){return t>=e})),Wo=Lr(function(){return arguments}())?Lr:function(t){return na(t)&&zt.call(t,"callee")&&!Yt.call(t,"callee")},Go=at.isArray,qo=xe?Qe(xe):function(t){return na(t)&&Tr(t)==O};function $o(t){return null!=t&&ta(t.length)&&!Ko(t)}function Xo(t){return na(t)&&$o(t)}var Jo=be||vl,Yo=we?Qe(we):function(t){return na(t)&&Tr(t)==x};function Zo(t){if(!na(t))return!1;var e=Tr(t);return e==w||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!sa(t)}function Ko(t){if(!ea(t))return!1;var e=Tr(t);return e==S||e==M||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Qo(t){return"number"==typeof t&&t==ma(t)}function ta(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=d}function ea(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function na(t){return null!=t&&"object"==typeof t}var ra=Se?Qe(Se):function(t){return na(t)&&ms(t)==E};function ia(t){return"number"==typeof t||na(t)&&Tr(t)==T}function sa(t){if(!na(t)||Tr(t)!=A)return!1;var e=Xt(t);if(null===e)return!0;var n=zt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Dt.call(n)==Vt}var oa=Me?Qe(Me):function(t){return na(t)&&Tr(t)==P};var aa=Ee?Qe(Ee):function(t){return na(t)&&ms(t)==I};function la(t){return"string"==typeof t||!Go(t)&&na(t)&&Tr(t)==R}function ca(t){return"symbol"==typeof t||na(t)&&Tr(t)==L}var ua=Te?Qe(Te):function(t){return na(t)&&ta(t.length)&&!!le[Tr(t)]};var ha=$i(Fr),da=$i((function(t,e){return t<=e}));function pa(t){if(!t)return[];if($o(t))return la(t)?fn(t):Ii(t);if(Qt&&t[Qt])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[Qt]());var e=ms(t);return(e==E?cn:e==I?dn:Va)(t)}function fa(t){return t?(t=va(t))===h||t===-h?17976931348623157e292*(t<0?-1:1):t===t?t:0:0===t?t:0}function ma(t){var e=fa(t),n=e%1;return e===e?n?e-n:e:0}function ga(t){return t?lr(ma(t),0,f):0}function va(t){if("number"==typeof t)return t;if(ca(t))return p;if(ea(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=ea(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ke(t);var n=vt.test(t);return n||_t.test(t)?de(t.slice(2),n?2:8):gt.test(t)?p:+t}function ya(t){return Ri(t,Na(t))}function _a(t){return null==t?"":ui(t)}var ba=Ni((function(t,e){if(Ms(e)||$o(e))Ri(e,La(e),t);else for(var n in e)zt.call(e,n)&&nr(t,n,e[n])})),xa=Ni((function(t,e){Ri(e,Na(e),t)})),wa=Ni((function(t,e,n,r){Ri(e,Na(e),t,r)})),Sa=Ni((function(t,e,n,r){Ri(e,La(e),t,r)})),Ma=rs(ar);var Ea=Zr((function(t,e){t=Ct(t);var r=-1,i=e.length,s=i>2?e[2]:n;for(s&&bs(e[0],e[1],s)&&(i=1);++r<i;)for(var o=e[r],a=Na(o),l=-1,c=a.length;++l<c;){var u=a[l],h=t[u];(h===n||Vo(h,Ot[u])&&!zt.call(t,u))&&(t[u]=o[u])}return t})),Ta=Zr((function(t){return t.push(n,ts),Ae(ka,n,t)}));function Aa(t,e,r){var i=null==t?n:Mr(t,e);return i===n?r:i}function Ca(t,e){return null!=t&&gs(t,e,Pr)}var Pa=Hi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),t[e]=n}),el(il)),Ia=Hi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),zt.call(t,e)?t[e].push(n):t[e]=[n]}),cs),Ra=Zr(Rr);function La(t){return $o(t)?Zn(t):zr(t)}function Na(t){return $o(t)?Zn(t,!0):Ur(t)}var Oa=Ni((function(t,e,n){jr(t,e,n)})),ka=Ni((function(t,e,n,r){jr(t,e,n,r)})),Da=rs((function(t,e){var n={};if(null==t)return n;var r=!1;e=ke(e,(function(e){return e=bi(e,t),r||(r=e.length>1),e})),Ri(t,ss(t),n),r&&(n=cr(n,7,es));for(var i=e.length;i--;)di(n,e[i]);return n}));var za=rs((function(t,e){return null==t?{}:function(t,e){return qr(t,e,(function(e,n){return Ca(t,n)}))}(t,e)}));function Ua(t,e){if(null==t)return{};var n=ke(ss(t),(function(t){return[t]}));return e=cs(e),qr(t,n,(function(t,n){return e(t,n[0])}))}var Fa=Zi(La),Ba=Zi(Na);function Va(t){return null==t?[]:tn(t,La(t))}var Ha=zi((function(t,e,n){return e=e.toLowerCase(),t+(n?ja(e):e)}));function ja(t){return Za(_a(t).toLowerCase())}function Wa(t){return(t=_a(t))&&t.replace(xt,sn).replace(ee,"")}var Ga=zi((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),qa=zi((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),$a=Di("toLowerCase");var Xa=zi((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var Ja=zi((function(t,e,n){return t+(n?" ":"")+Za(e)}));var Ya=zi((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Za=Di("toUpperCase");function Ka(t,e,r){return t=_a(t),(e=r?n:e)===n?function(t){return se.test(t)}(t)?function(t){return t.match(re)||[]}(t):function(t){return t.match(ht)||[]}(t):t.match(e)||[]}var Qa=Zr((function(t,e){try{return Ae(t,n,e)}catch(r){return Zo(r)?r:new Et(r)}})),tl=rs((function(t,e){return Pe(e,(function(e){e=zs(e),or(t,e,Io(t[e],t))})),t}));function el(t){return function(){return t}}var nl=Bi(),rl=Bi(!0);function il(t){return t}function sl(t){return Dr("function"==typeof t?t:cr(t,1))}var ol=Zr((function(t,e){return function(n){return Rr(n,t,e)}})),al=Zr((function(t,e){return function(n){return Rr(t,n,e)}}));function ll(t,e,n){var r=La(e),i=Sr(e,r);null==n&&(!ea(e)||!i.length&&r.length)&&(n=e,e=t,t=this,i=Sr(e,La(e)));var s=!(ea(n)&&"chain"in n)||!!n.chain,o=Ko(t);return Pe(i,(function(n){var r=e[n];t[n]=r,o&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__);return(n.__actions__=Ii(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,De([this.value()],arguments))})})),t}function cl(){}var ul=Wi(ke),hl=Wi(Re),dl=Wi(Fe);function pl(t){return xs(t)?$e(zs(t)):function(t){return function(e){return Mr(e,t)}}(t)}var fl=qi(),ml=qi(!0);function gl(){return[]}function vl(){return!1}var yl=ji((function(t,e){return t+e}),0),_l=Ji("ceil"),bl=ji((function(t,e){return t/e}),1),xl=Ji("floor");var wl=ji((function(t,e){return t*e}),1),Sl=Ji("round"),Ml=ji((function(t,e){return t-e}),0);return Vn.after=function(t,e){if("function"!=typeof e)throw new Rt(r);return t=ma(t),function(){if(--t<1)return e.apply(this,arguments)}},Vn.ary=Co,Vn.assign=ba,Vn.assignIn=xa,Vn.assignInWith=wa,Vn.assignWith=Sa,Vn.at=Ma,Vn.before=Po,Vn.bind=Io,Vn.bindAll=tl,Vn.bindKey=Ro,Vn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Go(t)?t:[t]},Vn.chain=po,Vn.chunk=function(t,e,r){e=(r?bs(t,e,r):e===n)?1:_n(ma(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var s=0,o=0,a=at(ge(i/e));s<i;)a[o++]=ii(t,s,s+=e);return a},Vn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i},Vn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=at(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return De(Go(n)?Ii(n):[n],yr(e,1))},Vn.cond=function(t){var e=null==t?0:t.length,n=cs();return t=e?ke(t,(function(t){if("function"!=typeof t[1])throw new Rt(r);return[n(t[0]),t[1]]})):[],Zr((function(n){for(var r=-1;++r<e;){var i=t[r];if(Ae(i[0],this,n))return Ae(i[1],this,n)}}))},Vn.conforms=function(t){return function(t){var e=La(t);return function(n){return ur(n,t,e)}}(cr(t,1))},Vn.constant=el,Vn.countBy=go,Vn.create=function(t,e){var n=Hn(t);return null==e?n:sr(n,e)},Vn.curry=function t(e,r,i){var s=Ki(e,8,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Vn.curryRight=function t(e,r,i){var s=Ki(e,o,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Vn.debounce=Lo,Vn.defaults=Ea,Vn.defaultsDeep=Ta,Vn.defer=No,Vn.delay=Oo,Vn.difference=Bs,Vn.differenceBy=Vs,Vn.differenceWith=Hs,Vn.drop=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=r||e===n?1:ma(e))<0?0:e,i):[]},Vn.dropRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,0,(e=i-(e=r||e===n?1:ma(e)))<0?0:e):[]},Vn.dropRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0,!0):[]},Vn.dropWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0):[]},Vn.fill=function(t,e,r,i){var s=null==t?0:t.length;return s?(r&&"number"!=typeof r&&bs(t,e,r)&&(r=0,i=s),function(t,e,r,i){var s=t.length;for((r=ma(r))<0&&(r=-r>s?0:s+r),(i=i===n||i>s?s:ma(i))<0&&(i+=s),i=r>i?0:ga(i);r<i;)t[r++]=e;return t}(t,e,r,i)):[]},Vn.filter=function(t,e){return(Go(t)?Le:vr)(t,cs(e,3))},Vn.flatMap=function(t,e){return yr(Mo(t,e),1)},Vn.flatMapDeep=function(t,e){return yr(Mo(t,e),h)},Vn.flatMapDepth=function(t,e,r){return r=r===n?1:ma(r),yr(Mo(t,e),r)},Vn.flatten=Gs,Vn.flattenDeep=function(t){return(null==t?0:t.length)?yr(t,h):[]},Vn.flattenDepth=function(t,e){return(null==t?0:t.length)?yr(t,e=e===n?1:ma(e)):[]},Vn.flip=function(t){return Ki(t,512)},Vn.flow=nl,Vn.flowRight=rl,Vn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Vn.functions=function(t){return null==t?[]:Sr(t,La(t))},Vn.functionsIn=function(t){return null==t?[]:Sr(t,Na(t))},Vn.groupBy=xo,Vn.initial=function(t){return(null==t?0:t.length)?ii(t,0,-1):[]},Vn.intersection=$s,Vn.intersectionBy=Xs,Vn.intersectionWith=Js,Vn.invert=Pa,Vn.invertBy=Ia,Vn.invokeMap=wo,Vn.iteratee=sl,Vn.keyBy=So,Vn.keys=La,Vn.keysIn=Na,Vn.map=Mo,Vn.mapKeys=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){or(n,e(t,r,i),t)})),n},Vn.mapValues=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){or(n,r,e(t,r,i))})),n},Vn.matches=function(t){return Vr(cr(t,1))},Vn.matchesProperty=function(t,e){return Hr(t,cr(e,1))},Vn.memoize=ko,Vn.merge=Oa,Vn.mergeWith=ka,Vn.method=ol,Vn.methodOf=al,Vn.mixin=ll,Vn.negate=Do,Vn.nthArg=function(t){return t=ma(t),Zr((function(e){return Wr(e,t)}))},Vn.omit=Da,Vn.omitBy=function(t,e){return Ua(t,Do(cs(e)))},Vn.once=function(t){return Po(2,t)},Vn.orderBy=function(t,e,r,i){return null==t?[]:(Go(e)||(e=null==e?[]:[e]),Go(r=i?n:r)||(r=null==r?[]:[r]),Gr(t,e,r))},Vn.over=ul,Vn.overArgs=zo,Vn.overEvery=hl,Vn.overSome=dl,Vn.partial=Uo,Vn.partialRight=Fo,Vn.partition=Eo,Vn.pick=za,Vn.pickBy=Ua,Vn.property=pl,Vn.propertyOf=function(t){return function(e){return null==t?n:Mr(t,e)}},Vn.pull=Zs,Vn.pullAll=Ks,Vn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?$r(t,e,cs(n,2)):t},Vn.pullAllWith=function(t,e,r){return t&&t.length&&e&&e.length?$r(t,e,n,r):t},Vn.pullAt=Qs,Vn.range=fl,Vn.rangeRight=ml,Vn.rearg=Bo,Vn.reject=function(t,e){return(Go(t)?Le:vr)(t,Do(cs(e,3)))},Vn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],s=t.length;for(e=cs(e,3);++r<s;){var o=t[r];e(o,r,t)&&(n.push(o),i.push(r))}return Xr(t,i),n},Vn.rest=function(t,e){if("function"!=typeof t)throw new Rt(r);return Zr(t,e=e===n?e:ma(e))},Vn.reverse=to,Vn.sampleSize=function(t,e,r){return e=(r?bs(t,e,r):e===n)?1:ma(e),(Go(t)?Qn:Qr)(t,e)},Vn.set=function(t,e,n){return null==t?t:ti(t,e,n)},Vn.setWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:ti(t,e,r,i)},Vn.shuffle=function(t){return(Go(t)?tr:ri)(t)},Vn.slice=function(t,e,r){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&bs(t,e,r)?(e=0,r=i):(e=null==e?0:ma(e),r=r===n?i:ma(r)),ii(t,e,r)):[]},Vn.sortBy=To,Vn.sortedUniq=function(t){return t&&t.length?li(t):[]},Vn.sortedUniqBy=function(t,e){return t&&t.length?li(t,cs(e,2)):[]},Vn.split=function(t,e,r){return r&&"number"!=typeof r&&bs(t,e,r)&&(e=r=n),(r=r===n?f:r>>>0)?(t=_a(t))&&("string"==typeof e||null!=e&&!oa(e))&&(!(e=ui(e))&&ln(t))?wi(fn(t),0,r):t.split(e,r):[]},Vn.spread=function(t,e){if("function"!=typeof t)throw new Rt(r);return e=null==e?0:_n(ma(e),0),Zr((function(n){var r=n[e],i=wi(n,0,e);return r&&De(i,r),Ae(t,this,i)}))},Vn.tail=function(t){var e=null==t?0:t.length;return e?ii(t,1,e):[]},Vn.take=function(t,e,r){return t&&t.length?ii(t,0,(e=r||e===n?1:ma(e))<0?0:e):[]},Vn.takeRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=i-(e=r||e===n?1:ma(e)))<0?0:e,i):[]},Vn.takeRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!1,!0):[]},Vn.takeWhile=function(t,e){return t&&t.length?fi(t,cs(e,3)):[]},Vn.tap=function(t,e){return e(t),t},Vn.throttle=function(t,e,n){var i=!0,s=!0;if("function"!=typeof t)throw new Rt(r);return ea(n)&&(i="leading"in n?!!n.leading:i,s="trailing"in n?!!n.trailing:s),Lo(t,e,{leading:i,maxWait:e,trailing:s})},Vn.thru=fo,Vn.toArray=pa,Vn.toPairs=Fa,Vn.toPairsIn=Ba,Vn.toPath=function(t){return Go(t)?ke(t,zs):ca(t)?[t]:Ii(Ds(_a(t)))},Vn.toPlainObject=ya,Vn.transform=function(t,e,n){var r=Go(t),i=r||Jo(t)||ua(t);if(e=cs(e,4),null==n){var s=t&&t.constructor;n=i?r?new s:[]:ea(t)&&Ko(s)?Hn(Xt(t)):{}}return(i?Pe:xr)(t,(function(t,r,i){return e(n,t,r,i)})),n},Vn.unary=function(t){return Co(t,1)},Vn.union=eo,Vn.unionBy=no,Vn.unionWith=ro,Vn.uniq=function(t){return t&&t.length?hi(t):[]},Vn.uniqBy=function(t,e){return t&&t.length?hi(t,cs(e,2)):[]},Vn.uniqWith=function(t,e){return e="function"==typeof e?e:n,t&&t.length?hi(t,n,e):[]},Vn.unset=function(t,e){return null==t||di(t,e)},Vn.unzip=io,Vn.unzipWith=so,Vn.update=function(t,e,n){return null==t?t:pi(t,e,_i(n))},Vn.updateWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:pi(t,e,_i(r),i)},Vn.values=Va,Vn.valuesIn=function(t){return null==t?[]:tn(t,Na(t))},Vn.without=oo,Vn.words=Ka,Vn.wrap=function(t,e){return Uo(_i(e),t)},Vn.xor=ao,Vn.xorBy=lo,Vn.xorWith=co,Vn.zip=uo,Vn.zipObject=function(t,e){return vi(t||[],e||[],nr)},Vn.zipObjectDeep=function(t,e){return vi(t||[],e||[],ti)},Vn.zipWith=ho,Vn.entries=Fa,Vn.entriesIn=Ba,Vn.extend=xa,Vn.extendWith=wa,ll(Vn,Vn),Vn.add=yl,Vn.attempt=Qa,Vn.camelCase=Ha,Vn.capitalize=ja,Vn.ceil=_l,Vn.clamp=function(t,e,r){return r===n&&(r=e,e=n),r!==n&&(r=(r=va(r))===r?r:0),e!==n&&(e=(e=va(e))===e?e:0),lr(va(t),e,r)},Vn.clone=function(t){return cr(t,4)},Vn.cloneDeep=function(t){return cr(t,5)},Vn.cloneDeepWith=function(t,e){return cr(t,5,e="function"==typeof e?e:n)},Vn.cloneWith=function(t,e){return cr(t,4,e="function"==typeof e?e:n)},Vn.conformsTo=function(t,e){return null==e||ur(t,e,La(e))},Vn.deburr=Wa,Vn.defaultTo=function(t,e){return null==t||t!==t?e:t},Vn.divide=bl,Vn.endsWith=function(t,e,r){t=_a(t),e=ui(e);var i=t.length,s=r=r===n?i:lr(ma(r),0,i);return(r-=e.length)>=0&&t.slice(r,s)==e},Vn.eq=Vo,Vn.escape=function(t){return(t=_a(t))&&Z.test(t)?t.replace(J,on):t},Vn.escapeRegExp=function(t){return(t=_a(t))&&st.test(t)?t.replace(it,"\\$&"):t},Vn.every=function(t,e,r){var i=Go(t)?Re:mr;return r&&bs(t,e,r)&&(e=n),i(t,cs(e,3))},Vn.find=vo,Vn.findIndex=js,Vn.findKey=function(t,e){return Ve(t,cs(e,3),xr)},Vn.findLast=yo,Vn.findLastIndex=Ws,Vn.findLastKey=function(t,e){return Ve(t,cs(e,3),wr)},Vn.floor=xl,Vn.forEach=_o,Vn.forEachRight=bo,Vn.forIn=function(t,e){return null==t?t:_r(t,cs(e,3),Na)},Vn.forInRight=function(t,e){return null==t?t:br(t,cs(e,3),Na)},Vn.forOwn=function(t,e){return t&&xr(t,cs(e,3))},Vn.forOwnRight=function(t,e){return t&&wr(t,cs(e,3))},Vn.get=Aa,Vn.gt=Ho,Vn.gte=jo,Vn.has=function(t,e){return null!=t&&gs(t,e,Cr)},Vn.hasIn=Ca,Vn.head=qs,Vn.identity=il,Vn.includes=function(t,e,n,r){t=$o(t)?t:Va(t),n=n&&!r?ma(n):0;var i=t.length;return n<0&&(n=_n(i+n,0)),la(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&je(t,e,n)>-1},Vn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ma(n);return i<0&&(i=_n(r+i,0)),je(t,e,i)},Vn.inRange=function(t,e,r){return e=fa(e),r===n?(r=e,e=0):r=fa(r),function(t,e,n){return t>=bn(e,n)&&t<_n(e,n)}(t=va(t),e,r)},Vn.invoke=Ra,Vn.isArguments=Wo,Vn.isArray=Go,Vn.isArrayBuffer=qo,Vn.isArrayLike=$o,Vn.isArrayLikeObject=Xo,Vn.isBoolean=function(t){return!0===t||!1===t||na(t)&&Tr(t)==b},Vn.isBuffer=Jo,Vn.isDate=Yo,Vn.isElement=function(t){return na(t)&&1===t.nodeType&&!sa(t)},Vn.isEmpty=function(t){if(null==t)return!0;if($o(t)&&(Go(t)||"string"==typeof t||"function"==typeof t.splice||Jo(t)||ua(t)||Wo(t)))return!t.length;var e=ms(t);if(e==E||e==I)return!t.size;if(Ms(t))return!zr(t).length;for(var n in t)if(zt.call(t,n))return!1;return!0},Vn.isEqual=function(t,e){return Nr(t,e)},Vn.isEqualWith=function(t,e,r){var i=(r="function"==typeof r?r:n)?r(t,e):n;return i===n?Nr(t,e,n,r):!!i},Vn.isError=Zo,Vn.isFinite=function(t){return"number"==typeof t&&Be(t)},Vn.isFunction=Ko,Vn.isInteger=Qo,Vn.isLength=ta,Vn.isMap=ra,Vn.isMatch=function(t,e){return t===e||Or(t,e,hs(e))},Vn.isMatchWith=function(t,e,r){return r="function"==typeof r?r:n,Or(t,e,hs(e),r)},Vn.isNaN=function(t){return ia(t)&&t!=+t},Vn.isNative=function(t){if(Ss(t))throw new Et("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return kr(t)},Vn.isNil=function(t){return null==t},Vn.isNull=function(t){return null===t},Vn.isNumber=ia,Vn.isObject=ea,Vn.isObjectLike=na,Vn.isPlainObject=sa,Vn.isRegExp=oa,Vn.isSafeInteger=function(t){return Qo(t)&&t>=-d&&t<=d},Vn.isSet=aa,Vn.isString=la,Vn.isSymbol=ca,Vn.isTypedArray=ua,Vn.isUndefined=function(t){return t===n},Vn.isWeakMap=function(t){return na(t)&&ms(t)==N},Vn.isWeakSet=function(t){return na(t)&&"[object WeakSet]"==Tr(t)},Vn.join=function(t,e){return null==t?"":Xe.call(t,e)},Vn.kebabCase=Ga,Vn.last=Ys,Vn.lastIndexOf=function(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i;return r!==n&&(s=(s=ma(r))<0?_n(i+s,0):bn(s,i-1)),e===e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,s):He(t,Ge,s,!0)},Vn.lowerCase=qa,Vn.lowerFirst=$a,Vn.lt=ha,Vn.lte=da,Vn.max=function(t){return t&&t.length?gr(t,il,Ar):n},Vn.maxBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Ar):n},Vn.mean=function(t){return qe(t,il)},Vn.meanBy=function(t,e){return qe(t,cs(e,2))},Vn.min=function(t){return t&&t.length?gr(t,il,Fr):n},Vn.minBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Fr):n},Vn.stubArray=gl,Vn.stubFalse=vl,Vn.stubObject=function(){return{}},Vn.stubString=function(){return""},Vn.stubTrue=function(){return!0},Vn.multiply=wl,Vn.nth=function(t,e){return t&&t.length?Wr(t,ma(e)):n},Vn.noConflict=function(){return me._===this&&(me._=Ht),this},Vn.noop=cl,Vn.now=Ao,Vn.pad=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Gi(ve(i),n)+t+Gi(ge(i),n)},Vn.padEnd=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;return e&&r<e?t+Gi(e-r,n):t},Vn.padStart=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;return e&&r<e?Gi(e-r,n)+t:t},Vn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),wn(_a(t).replace(ot,""),e||0)},Vn.random=function(t,e,r){if(r&&"boolean"!=typeof r&&bs(t,e,r)&&(e=r=n),r===n&&("boolean"==typeof e?(r=e,e=n):"boolean"==typeof t&&(r=t,t=n)),t===n&&e===n?(t=0,e=1):(t=fa(t),e===n?(e=t,t=0):e=fa(e)),t>e){var i=t;t=e,e=i}if(r||t%1||e%1){var s=Sn();return bn(t+s*(e-t+he("1e-"+((s+"").length-1))),e)}return Jr(t,e)},Vn.reduce=function(t,e,n){var r=Go(t)?ze:Je,i=arguments.length<3;return r(t,cs(e,4),n,i,pr)},Vn.reduceRight=function(t,e,n){var r=Go(t)?Ue:Je,i=arguments.length<3;return r(t,cs(e,4),n,i,fr)},Vn.repeat=function(t,e,r){return e=(r?bs(t,e,r):e===n)?1:ma(e),Yr(_a(t),e)},Vn.replace=function(){var t=arguments,e=_a(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Vn.result=function(t,e,r){var i=-1,s=(e=bi(e,t)).length;for(s||(s=1,t=n);++i<s;){var o=null==t?n:t[zs(e[i])];o===n&&(i=s,o=r),t=Ko(o)?o.call(t):o}return t},Vn.round=Sl,Vn.runInContext=t,Vn.sample=function(t){return(Go(t)?Kn:Kr)(t)},Vn.size=function(t){if(null==t)return 0;if($o(t))return la(t)?pn(t):t.length;var e=ms(t);return e==E||e==I?t.size:zr(t).length},Vn.snakeCase=Xa,Vn.some=function(t,e,r){var i=Go(t)?Fe:si;return r&&bs(t,e,r)&&(e=n),i(t,cs(e,3))},Vn.sortedIndex=function(t,e){return oi(t,e)},Vn.sortedIndexBy=function(t,e,n){return ai(t,e,cs(n,2))},Vn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=oi(t,e);if(r<n&&Vo(t[r],e))return r}return-1},Vn.sortedLastIndex=function(t,e){return oi(t,e,!0)},Vn.sortedLastIndexBy=function(t,e,n){return ai(t,e,cs(n,2),!0)},Vn.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=oi(t,e,!0)-1;if(Vo(t[n],e))return n}return-1},Vn.startCase=Ja,Vn.startsWith=function(t,e,n){return t=_a(t),n=null==n?0:lr(ma(n),0,t.length),e=ui(e),t.slice(n,n+e.length)==e},Vn.subtract=Ml,Vn.sum=function(t){return t&&t.length?Ye(t,il):0},Vn.sumBy=function(t,e){return t&&t.length?Ye(t,cs(e,2)):0},Vn.template=function(t,e,r){var i=Vn.templateSettings;r&&bs(t,e,r)&&(e=n),t=_a(t),e=wa({},e,i,Qi);var s,o,a=wa({},e.imports,i.imports,Qi),l=La(a),c=tn(a,l),u=0,h=e.interpolate||wt,d="__p += '",p=Pt((e.escape||wt).source+"|"+h.source+"|"+(h===tt?ft:wt).source+"|"+(e.evaluate||wt).source+"|$","g"),f="//# sourceURL="+(zt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ae+"]")+"\n";t.replace(p,(function(e,n,r,i,a,l){return r||(r=i),d+=t.slice(u,l).replace(St,an),n&&(s=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+e.length,e})),d+="';\n";var m=zt.call(e,"variable")&&e.variable;if(m){if(dt.test(m))throw new Et("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(G,""):d).replace(q,"$1").replace($,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Qa((function(){return Tt(l,f+"return "+d).apply(n,c)}));if(g.source=d,Zo(g))throw g;return g},Vn.times=function(t,e){if((t=ma(t))<1||t>d)return[];var n=f,r=bn(t,f);e=cs(e),t-=f;for(var i=Ze(r,e);++n<t;)e(n);return i},Vn.toFinite=fa,Vn.toInteger=ma,Vn.toLength=ga,Vn.toLower=function(t){return _a(t).toLowerCase()},Vn.toNumber=va,Vn.toSafeInteger=function(t){return t?lr(ma(t),-d,d):0===t?t:0},Vn.toString=_a,Vn.toUpper=function(t){return _a(t).toUpperCase()},Vn.trim=function(t,e,r){if((t=_a(t))&&(r||e===n))return Ke(t);if(!t||!(e=ui(e)))return t;var i=fn(t),s=fn(e);return wi(i,nn(i,s),rn(i,s)+1).join("")},Vn.trimEnd=function(t,e,r){if((t=_a(t))&&(r||e===n))return t.slice(0,mn(t)+1);if(!t||!(e=ui(e)))return t;var i=fn(t);return wi(i,0,rn(i,fn(e))+1).join("")},Vn.trimStart=function(t,e,r){if((t=_a(t))&&(r||e===n))return t.replace(ot,"");if(!t||!(e=ui(e)))return t;var i=fn(t);return wi(i,nn(i,fn(e))).join("")},Vn.truncate=function(t,e){var r=30,i="...";if(ea(e)){var s="separator"in e?e.separator:s;r="length"in e?ma(e.length):r,i="omission"in e?ui(e.omission):i}var o=(t=_a(t)).length;if(ln(t)){var a=fn(t);o=a.length}if(r>=o)return t;var l=r-pn(i);if(l<1)return i;var c=a?wi(a,0,l).join(""):t.slice(0,l);if(s===n)return c+i;if(a&&(l+=c.length-l),oa(s)){if(t.slice(l).search(s)){var u,h=c;for(s.global||(s=Pt(s.source,_a(mt.exec(s))+"g")),s.lastIndex=0;u=s.exec(h);)var d=u.index;c=c.slice(0,d===n?l:d)}}else if(t.indexOf(ui(s),l)!=l){var p=c.lastIndexOf(s);p>-1&&(c=c.slice(0,p))}return c+i},Vn.unescape=function(t){return(t=_a(t))&&Y.test(t)?t.replace(X,gn):t},Vn.uniqueId=function(t){var e=++Ut;return _a(t)+e},Vn.upperCase=Ya,Vn.upperFirst=Za,Vn.each=_o,Vn.eachRight=bo,Vn.first=qs,ll(Vn,function(){var t={};return xr(Vn,(function(e,n){zt.call(Vn.prototype,n)||(t[n]=e)})),t}(),{chain:!1}),Vn.VERSION="4.17.21",Pe(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Vn[t].placeholder=Vn})),Pe(["drop","take"],(function(t,e){Gn.prototype[t]=function(r){r=r===n?1:_n(ma(r),0);var i=this.__filtered__&&!e?new Gn(this):this.clone();return i.__filtered__?i.__takeCount__=bn(r,i.__takeCount__):i.__views__.push({size:bn(r,f),type:t+(i.__dir__<0?"Right":"")}),i},Gn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Pe(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Gn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:cs(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),Pe(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Gn.prototype[t]=function(){return this[n](1).value()[0]}})),Pe(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Gn.prototype[t]=function(){return this.__filtered__?new Gn(this):this[n](1)}})),Gn.prototype.compact=function(){return this.filter(il)},Gn.prototype.find=function(t){return this.filter(t).head()},Gn.prototype.findLast=function(t){return this.reverse().find(t)},Gn.prototype.invokeMap=Zr((function(t,e){return"function"==typeof t?new Gn(this):this.map((function(n){return Rr(n,t,e)}))})),Gn.prototype.reject=function(t){return this.filter(Do(cs(t)))},Gn.prototype.slice=function(t,e){t=ma(t);var r=this;return r.__filtered__&&(t>0||e<0)?new Gn(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==n&&(r=(e=ma(e))<0?r.dropRight(-e):r.take(e-t)),r)},Gn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Gn.prototype.toArray=function(){return this.take(f)},xr(Gn.prototype,(function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),s=Vn[i?"take"+("last"==e?"Right":""):e],o=i||/^find/.test(e);s&&(Vn.prototype[e]=function(){var e=this.__wrapped__,a=i?[1]:arguments,l=e instanceof Gn,c=a[0],u=l||Go(e),h=function(t){var e=s.apply(Vn,De([t],a));return i&&d?e[0]:e};u&&r&&"function"==typeof c&&1!=c.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,f=o&&!d,m=l&&!p;if(!o&&u){e=m?e:new Gn(this);var g=t.apply(e,a);return g.__actions__.push({func:fo,args:[h],thisArg:n}),new Wn(g,d)}return f&&m?t.apply(this,a):(g=this.thru(h),f?i?g.value()[0]:g.value():g)})})),Pe(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Lt[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Vn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Go(i)?i:[],t)}return this[n]((function(n){return e.apply(Go(n)?n:[],t)}))}})),xr(Gn.prototype,(function(t,e){var n=Vn[e];if(n){var r=n.name+"";zt.call(Ln,r)||(Ln[r]=[]),Ln[r].push({name:e,func:n})}})),Ln[Vi(n,2).name]=[{name:"wrapper",func:n}],Gn.prototype.clone=function(){var t=new Gn(this.__wrapped__);return t.__actions__=Ii(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ii(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ii(this.__views__),t},Gn.prototype.reverse=function(){if(this.__filtered__){var t=new Gn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Gn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Go(t),r=e<0,i=n?t.length:0,s=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var s=n[r],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=bn(e,t+o);break;case"takeRight":t=_n(t,e-o)}}return{start:t,end:e}}(0,i,this.__views__),o=s.start,a=s.end,l=a-o,c=r?a:o-1,u=this.__iteratees__,h=u.length,d=0,p=bn(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return mi(t,this.__actions__);var f=[];t:for(;l--&&d<p;){for(var m=-1,g=t[c+=e];++m<h;){var v=u[m],y=v.iteratee,_=v.type,b=y(g);if(2==_)g=b;else if(!b){if(1==_)continue t;break t}}f[d++]=g}return f},Vn.prototype.at=mo,Vn.prototype.chain=function(){return po(this)},Vn.prototype.commit=function(){return new Wn(this.value(),this.__chain__)},Vn.prototype.next=function(){this.__values__===n&&(this.__values__=pa(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?n:this.__values__[this.__index__++]}},Vn.prototype.plant=function(t){for(var e,r=this;r instanceof jn;){var i=Fs(r);i.__index__=0,i.__values__=n,e?s.__wrapped__=i:e=i;var s=i;r=r.__wrapped__}return s.__wrapped__=t,e},Vn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Gn){var e=t;return this.__actions__.length&&(e=new Gn(this)),(e=e.reverse()).__actions__.push({func:fo,args:[to],thisArg:n}),new Wn(e,this.__chain__)}return this.thru(to)},Vn.prototype.toJSON=Vn.prototype.valueOf=Vn.prototype.value=function(){return mi(this.__wrapped__,this.__actions__)},Vn.prototype.first=Vn.prototype.head,Qt&&(Vn.prototype[Qt]=function(){return this}),Vn}();ve?((ve.exports=vn)._=vn,ge._=vn):me._=vn}).call(Pn)}(Nn,Nn.exports);var On=Nn.exports;const kn=t=>({[Cn.a.JOINED]:t.onParticipantJoined,[Cn.a.LEFT]:t.onParticipantLeft,[Cn.a.LIST_UPDATED]:t.onParticipantListUpdated,[Cn.a.LOCAL_JOINED]:t.onParticipantLocalJoined,[Cn.a.LOCAL_LEFT]:t.onParticipantLocalLeft,[Cn.a.LOCAL_UPDATED]:t.onParticipantLocalUpdated}),Dn=(0,t.createContext)({hasProvider:!1,room:null});function zn(e){const{hasProvider:n,...r}=(0,t.useContext)(Dn);return(0,t.useEffect)((()=>{n||console.error("[SuperViz] You need to wrap your component with SuperVizRoomProvider")}),[n]),e?{...r,component:r.activeComponents[e]}:r}function Un(e){const{roomId:n,group:r,debug:i,children:s,environment:o,participant:a,developerKey:l,customColors:c,onParticipantJoined:u,onParticipantLeft:h,onParticipantListUpdated:d,onParticipantLocalJoined:p,onParticipantLocalLeft:f,onParticipantLocalUpdated:m,stopAutoStart:g}=e,[v,y]=(0,t.useState)(!1),[_,b]=(0,t.useState)(null),[x,w]=(0,t.useState)(null),[S,M]=(0,t.useState)({}),E=(0,t.useRef)(!1);function T(t,e){const n=kn(e);Object.entries(n).forEach((n=>{let[r,i]=n;const s=e[r];(!i&&s||i!==s)&&t.unsubscribe(r),i&&t.subscribe(r,i)})),w(n)}async function A(){if(v||_)console.log("[SuperViz] Room already started");else{try{E.current=!0;const t=await(0,Cn.u)(l,{participant:a,roomId:n,group:r,environment:o,debug:i,customColors:c});T(t,e),b(t),y(!0),t.subscribe(Cn.a.LOCAL_UPDATED,R),t.subscribe(Cn.a.LOCAL_JOINED,L),t.subscribe(Cn.a.LOCAL_LEFT,N)}catch(t){E.current=!1,console.error("[SuperViz] Error starting room",t)}E.current=!1}}function C(){_?(_.destroy(),M({}),b(null),y(!1)):console.error("[SuperViz] Room not started yet, you need to start the room before stopping it")}function P(t){_&&(S[t.name]||null==_||_.addComponent(t),M((e=>({...e,[t.name]:t}))))}function I(t){_&&(S[t.name]&&(null==_||_.removeComponent(t)),M((e=>{const n={...e};return delete n[t.name],n})))}function R(t){if(m&&m(t),null==t||!t.activeComponents||null==t||!t.activeComponents.length)return;const e=[];Object.keys(S).forEach((n=>{var r;null!=(r=t.activeComponents)&&r.includes(n)||e.push(n)})),M((t=>{const n={...t};return e.forEach((t=>{delete n[t]})),n}))}function L(){y(!0)}function N(){y(!1)}(0,t.useEffect)((()=>{if(A&&!v&&!g)return E.current||A(),()=>{!C||!v||C()}}),[]),(0,t.useEffect)((()=>{const t=kn(e);!_||On.isEqual(x,t)||T(_,e)}),[u,h,d,p,f,m,_]),(0,t.useEffect)((()=>{v&&(null==_||_.unsubscribe(Cn.a.LOCAL_UPDATED),null==_||_.subscribe(Cn.a.LOCAL_UPDATED,R))}),[_,S]);const O=(0,t.useMemo)((()=>({hasProvider:!0,hasJoinedRoom:v,room:_,addComponent:P,removeComponent:I,activeComponents:S,startRoom:A,stopRoom:C})),[_,l,a,n,r,S,v]);return Ln.jsx(Dn.Provider,{value:O,children:s})}var Fn=Object.create,Bn=Object.defineProperty,Vn=Object.getOwnPropertyDescriptor,Hn=Object.getOwnPropertyNames,jn=Object.getPrototypeOf,Wn=Object.prototype.hasOwnProperty,Gn=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),qn=(t,e,n)=>(n=null!=t?Fn(jn(t)):{},((t,e,n,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of Hn(e))!Wn.call(t,i)&&i!==n&&Bn(t,i,{get:()=>e[i],enumerable:!(r=Vn(e,i))||r.enumerable});return t})(t&&t.__esModule?n:Bn(n,"default",{value:t,enumerable:!0}),t)),$n=Gn(((t,e)=>{(function(){var n,r="Expected a function",i="__lodash_hash_undefined__",s="__lodash_placeholder__",o=16,a=32,l=64,c=128,u=256,h=1/0,d=9007199254740991,p=NaN,f=4294967295,m=f-1,g=f>>>1,v=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",o],["flip",512],["partial",a],["partialRight",l],["rearg",u]],y="[object Arguments]",_="[object Array]",b="[object Boolean]",x="[object Date]",w="[object Error]",S="[object Function]",M="[object GeneratorFunction]",E="[object Map]",T="[object Number]",A="[object Object]",C="[object Promise]",P="[object RegExp]",I="[object Set]",R="[object String]",L="[object Symbol]",N="[object WeakMap]",O="[object ArrayBuffer]",k="[object DataView]",D="[object Float32Array]",z="[object Float64Array]",U="[object Int8Array]",F="[object Int16Array]",B="[object Int32Array]",V="[object Uint8Array]",H="[object Uint8ClampedArray]",j="[object Uint16Array]",W="[object Uint32Array]",G=/\b__p \+= '';/g,q=/\b(__p \+=) '' \+/g,$=/(__e\(.*?\)|\b__t\)) \+\n'';/g,X=/&(?:amp|lt|gt|quot|#39);/g,J=/[&<>"']/g,Y=RegExp(X.source),Z=RegExp(J.source),K=/<%-([\s\S]+?)%>/g,Q=/<%([\s\S]+?)%>/g,tt=/<%=([\s\S]+?)%>/g,et=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nt=/^\w*$/,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/[\\^$.*+?()[\]{}|]/g,st=RegExp(it.source),ot=/^\s+/,at=/\s/,lt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ct=/\{\n\/\* \[wrapped with (.+)\] \*/,ut=/,? & /,ht=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,dt=/[()=,{}\[\]\/\s]/,pt=/\\(\\)?/g,ft=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mt=/\w*$/,gt=/^[-+]0x[0-9a-f]+$/i,vt=/^0b[01]+$/i,yt=/^\[object .+?Constructor\]$/,_t=/^0o[0-7]+$/i,bt=/^(?:0|[1-9]\d*)$/,xt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,wt=/($^)/,St=/['\n\r\u2028\u2029\\]/g,Mt="\\ud800-\\udfff",Et="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Tt="\\u2700-\\u27bf",At="a-z\\xdf-\\xf6\\xf8-\\xff",Ct="A-Z\\xc0-\\xd6\\xd8-\\xde",Pt="\\ufe0e\\ufe0f",It="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Rt="['\u2019]",Lt="["+Mt+"]",Nt="["+It+"]",Ot="["+Et+"]",kt="\\d+",Dt="["+Tt+"]",zt="["+At+"]",Ut="[^"+Mt+It+kt+Tt+At+Ct+"]",Ft="\\ud83c[\\udffb-\\udfff]",Bt="[^"+Mt+"]",Vt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ht="[\\ud800-\\udbff][\\udc00-\\udfff]",jt="["+Ct+"]",Wt="\\u200d",Gt="(?:"+zt+"|"+Ut+")",qt="(?:"+jt+"|"+Ut+")",$t="(?:['\u2019](?:d|ll|m|re|s|t|ve))?",Xt="(?:['\u2019](?:D|LL|M|RE|S|T|VE))?",Jt="(?:"+Ot+"|"+Ft+")"+"?",Yt="["+Pt+"]?",Zt=Yt+Jt+("(?:"+Wt+"(?:"+[Bt,Vt,Ht].join("|")+")"+Yt+Jt+")*"),Kt="(?:"+[Dt,Vt,Ht].join("|")+")"+Zt,Qt="(?:"+[Bt+Ot+"?",Ot,Vt,Ht,Lt].join("|")+")",te=RegExp(Rt,"g"),ee=RegExp(Ot,"g"),ne=RegExp(Ft+"(?="+Ft+")|"+Qt+Zt,"g"),re=RegExp([jt+"?"+zt+"+"+$t+"(?="+[Nt,jt,"$"].join("|")+")",qt+"+"+Xt+"(?="+[Nt,jt+Gt,"$"].join("|")+")",jt+"?"+Gt+"+"+$t,jt+"+"+Xt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",kt,Kt].join("|"),"g"),ie=RegExp("["+Wt+Mt+Et+Pt+"]"),se=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,oe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ae=-1,le={};le[D]=le[z]=le[U]=le[F]=le[B]=le[V]=le[H]=le[j]=le[W]=!0,le[y]=le[_]=le[O]=le[b]=le[k]=le[x]=le[w]=le[S]=le[E]=le[T]=le[A]=le[P]=le[I]=le[R]=le[N]=!1;var ce={};ce[y]=ce[_]=ce[O]=ce[k]=ce[b]=ce[x]=ce[D]=ce[z]=ce[U]=ce[F]=ce[B]=ce[E]=ce[T]=ce[A]=ce[P]=ce[I]=ce[R]=ce[L]=ce[V]=ce[H]=ce[j]=ce[W]=!0,ce[w]=ce[S]=ce[N]=!1;var ue={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},he=parseFloat,de=parseInt,pe="object"==typeof window&&window&&window.Object===Object&&window,fe="object"==typeof self&&self&&self.Object===Object&&self,me=pe||fe||Function("return this")(),ge="object"==typeof t&&t&&!t.nodeType&&t,ve=ge&&"object"==typeof e&&e&&!e.nodeType&&e,ye=ve&&ve.exports===ge,_e=ye&&pe.process,be=function(){try{return ve&&ve.require&&ve.require("util").types||_e&&_e.binding&&_e.binding("util")}catch{}}(),xe=be&&be.isArrayBuffer,we=be&&be.isDate,Se=be&&be.isMap,Me=be&&be.isRegExp,Ee=be&&be.isSet,Te=be&&be.isTypedArray;function Ae(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ce(t,e,n,r){for(var i=-1,s=null==t?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function Pe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Ie(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Re(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Le(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Ne(t,e){return!!(null==t?0:t.length)&&je(t,e,0)>-1}function Oe(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function ke(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function De(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function ze(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function Ue(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Fe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Be=$e("length");function Ve(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function He(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function je(t,e,n){return e===e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):He(t,Ge,n)}function We(t,e,n,r){for(var i=n-1,s=t.length;++i<s;)if(r(t[i],e))return i;return-1}function Ge(t){return t!==t}function qe(t,e){var n=null==t?0:t.length;return n?Ye(t,e)/n:p}function $e(t){return function(e){return null==e?n:e[t]}}function Xe(t){return function(e){return null==t?n:t[e]}}function Je(t,e,n,r,i){return i(t,(function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)})),n}function Ye(t,e){for(var r,i=-1,s=t.length;++i<s;){var o=e(t[i]);o!==n&&(r=r===n?o:r+o)}return r}function Ze(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ke(t){return t&&t.slice(0,mn(t)+1).replace(ot,"")}function Qe(t){return function(e){return t(e)}}function tn(t,e){return ke(e,(function(e){return t[e]}))}function en(t,e){return t.has(e)}function nn(t,e){for(var n=-1,r=t.length;++n<r&&je(e,t[n],0)>-1;);return n}function rn(t,e){for(var n=t.length;n--&&je(e,t[n],0)>-1;);return n}var sn=Xe({"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"}),on=Xe({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function an(t){return"\\"+ue[t]}function ln(t){return ie.test(t)}function cn(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function un(t,e){return function(n){return t(e(n))}}function hn(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];(a===e||a===s)&&(t[n]=s,o[i++]=n)}return o}function dn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function pn(t){return ln(t)?function(t){for(var e=ne.lastIndex=0;ne.test(t);)++e;return e}(t):Be(t)}function fn(t){return ln(t)?function(t){return t.match(ne)||[]}(t):function(t){return t.split("")}(t)}function mn(t){for(var e=t.length;e--&&at.test(t.charAt(e)););return e}var gn=Xe({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var vn=function t(e){var at=(e=null==e?me:vn.defaults(me.Object(),e,vn.pick(me,oe))).Array,Mt=e.Date,Et=e.Error,Tt=e.Function,At=e.Math,Ct=e.Object,Pt=e.RegExp,It=e.String,Rt=e.TypeError,Lt=at.prototype,Nt=Tt.prototype,Ot=Ct.prototype,kt=e["__core-js_shared__"],Dt=Nt.toString,zt=Ot.hasOwnProperty,Ut=0,Ft=function(){var t=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Bt=Ot.toString,Vt=Dt.call(Ct),Ht=me._,jt=Pt("^"+Dt.call(zt).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Wt=ye?e.Buffer:n,Gt=e.Symbol,qt=e.Uint8Array,$t=Wt?Wt.allocUnsafe:n,Xt=un(Ct.getPrototypeOf,Ct),Jt=Ct.create,Yt=Ot.propertyIsEnumerable,Zt=Lt.splice,Kt=Gt?Gt.isConcatSpreadable:n,Qt=Gt?Gt.iterator:n,ne=Gt?Gt.toStringTag:n,ie=function(){try{var t=ds(Ct,"defineProperty");return t({},"",{}),t}catch{}}(),ue=e.clearTimeout!==me.clearTimeout&&e.clearTimeout,pe=Mt&&Mt.now!==me.Date.now&&Mt.now,fe=e.setTimeout!==me.setTimeout&&e.setTimeout,ge=At.ceil,ve=At.floor,_e=Ct.getOwnPropertySymbols,be=Wt?Wt.isBuffer:n,Be=e.isFinite,Xe=Lt.join,yn=un(Ct.keys,Ct),_n=At.max,bn=At.min,xn=Mt.now,wn=e.parseInt,Sn=At.random,Mn=Lt.reverse,En=ds(e,"DataView"),Tn=ds(e,"Map"),An=ds(e,"Promise"),Cn=ds(e,"Set"),Pn=ds(e,"WeakMap"),In=ds(Ct,"create"),Rn=Pn&&new Pn,Ln={},Nn=Us(En),On=Us(Tn),kn=Us(An),Dn=Us(Cn),zn=Us(Pn),Un=Gt?Gt.prototype:n,Fn=Un?Un.valueOf:n,Bn=Un?Un.toString:n;function Vn(t){if(na(t)&&!Go(t)&&!(t instanceof Gn)){if(t instanceof Wn)return t;if(zt.call(t,"__wrapped__"))return Fs(t)}return new Wn(t)}var Hn=function(){function t(){}return function(e){if(!ea(e))return{};if(Jt)return Jt(e);t.prototype=e;var r=new t;return t.prototype=n,r}}();function jn(){}function Wn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=n}function Gn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}function qn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function $n(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Xn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Jn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Xn;++e<n;)this.add(t[e])}function Yn(t){var e=this.__data__=new $n(t);this.size=e.size}function Zn(t,e){var n=Go(t),r=!n&&Wo(t),i=!n&&!r&&Jo(t),s=!n&&!r&&!i&&ua(t),o=n||r||i||s,a=o?Ze(t.length,It):[],l=a.length;for(var c in t)(e||zt.call(t,c))&&(!o||!("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||_s(c,l)))&&a.push(c);return a}function Kn(t){var e=t.length;return e?t[Jr(0,e-1)]:n}function Qn(t,e){return ks(Ii(t),lr(e,0,t.length))}function tr(t){return ks(Ii(t))}function er(t,e,r){(r!==n&&!Vo(t[e],r)||r===n&&!(e in t))&&or(t,e,r)}function nr(t,e,r){var i=t[e];(!zt.call(t,e)||!Vo(i,r)||r===n&&!(e in t))&&or(t,e,r)}function rr(t,e){for(var n=t.length;n--;)if(Vo(t[n][0],e))return n;return-1}function ir(t,e,n,r){return pr(t,(function(t,i,s){e(r,t,n(t),s)})),r}function sr(t,e){return t&&Ri(e,La(e),t)}function or(t,e,n){"__proto__"==e&&ie?ie(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ar(t,e){for(var r=-1,i=e.length,s=at(i),o=null==t;++r<i;)s[r]=o?n:Aa(t,e[r]);return s}function lr(t,e,r){return t===t&&(r!==n&&(t=t<=r?t:r),e!==n&&(t=t>=e?t:e)),t}function cr(t,e,r,i,s,o){var a,l=1&e,c=2&e,u=4&e;if(r&&(a=s?r(t,i,s,o):r(t)),a!==n)return a;if(!ea(t))return t;var h=Go(t);if(h){if(a=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&zt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!l)return Ii(t,a)}else{var d=ms(t),p=d==S||d==M;if(Jo(t))return Mi(t,l);if(d==A||d==y||p&&!s){if(a=c||p?{}:vs(t),!l)return c?function(t,e){return Ri(t,fs(t),e)}(t,function(t,e){return t&&Ri(e,Na(e),t)}(a,t)):function(t,e){return Ri(t,ps(t),e)}(t,sr(a,t))}else{if(!ce[d])return s?t:{};a=function(t,e,n){var r=t.constructor;switch(e){case O:return Ei(t);case b:case x:return new r(+t);case k:return function(t,e){var n=e?Ei(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case D:case z:case U:case F:case B:case V:case H:case j:case W:return Ti(t,n);case E:return new r;case T:case R:return new r(t);case P:return function(t){var e=new t.constructor(t.source,mt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case I:return new r;case L:return function(t){return Fn?Ct(Fn.call(t)):{}}(t)}}(t,d,l)}}o||(o=new Yn);var f=o.get(t);if(f)return f;o.set(t,a),aa(t)?t.forEach((function(n){a.add(cr(n,e,r,n,t,o))})):ra(t)&&t.forEach((function(n,i){a.set(i,cr(n,e,r,i,t,o))}));var m=h?n:(u?c?ss:is:c?Na:La)(t);return Pe(m||t,(function(n,i){m&&(n=t[i=n]),nr(a,i,cr(n,e,r,i,t,o))})),a}function ur(t,e,r){var i=r.length;if(null==t)return!i;for(t=Ct(t);i--;){var s=r[i],o=e[s],a=t[s];if(a===n&&!(s in t)||!o(a))return!1}return!0}function hr(t,e,i){if("function"!=typeof t)throw new Rt(r);return Rs((function(){t.apply(n,i)}),e)}function dr(t,e,n,r){var i=-1,s=Ne,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;n&&(e=ke(e,Qe(n))),r?(s=Oe,o=!1):e.length>=200&&(s=en,o=!1,e=new Jn(e));t:for(;++i<a;){var u=t[i],h=null==n?u:n(u);if(u=r||0!==u?u:0,o&&h===h){for(var d=c;d--;)if(e[d]===h)continue t;l.push(u)}else s(e,h,r)||l.push(u)}return l}Vn.templateSettings={escape:K,evaluate:Q,interpolate:tt,variable:"",imports:{_:Vn}},Vn.prototype=jn.prototype,Vn.prototype.constructor=Vn,Wn.prototype=Hn(jn.prototype),Wn.prototype.constructor=Wn,Gn.prototype=Hn(jn.prototype),Gn.prototype.constructor=Gn,qn.prototype.clear=function(){this.__data__=In?In(null):{},this.size=0},qn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},qn.prototype.get=function(t){var e=this.__data__;if(In){var r=e[t];return r===i?n:r}return zt.call(e,t)?e[t]:n},qn.prototype.has=function(t){var e=this.__data__;return In?e[t]!==n:zt.call(e,t)},qn.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=In&&e===n?i:e,this},$n.prototype.clear=function(){this.__data__=[],this.size=0},$n.prototype.delete=function(t){var e=this.__data__,n=rr(e,t);return!(n<0)&&(n==e.length-1?e.pop():Zt.call(e,n,1),--this.size,!0)},$n.prototype.get=function(t){var e=this.__data__,r=rr(e,t);return r<0?n:e[r][1]},$n.prototype.has=function(t){return rr(this.__data__,t)>-1},$n.prototype.set=function(t,e){var n=this.__data__,r=rr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Xn.prototype.clear=function(){this.size=0,this.__data__={hash:new qn,map:new(Tn||$n),string:new qn}},Xn.prototype.delete=function(t){var e=us(this,t).delete(t);return this.size-=e?1:0,e},Xn.prototype.get=function(t){return us(this,t).get(t)},Xn.prototype.has=function(t){return us(this,t).has(t)},Xn.prototype.set=function(t,e){var n=us(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Jn.prototype.add=Jn.prototype.push=function(t){return this.__data__.set(t,i),this},Jn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.clear=function(){this.__data__=new $n,this.size=0},Yn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Yn.prototype.get=function(t){return this.__data__.get(t)},Yn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof $n){var r=n.__data__;if(!Tn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Xn(r)}return n.set(t,e),this.size=n.size,this};var pr=Oi(xr),fr=Oi(wr,!0);function mr(t,e){var n=!0;return pr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function gr(t,e,r){for(var i=-1,s=t.length;++i<s;){var o=t[i],a=e(o);if(null!=a&&(l===n?a===a&&!ca(a):r(a,l)))var l=a,c=o}return c}function vr(t,e){var n=[];return pr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function yr(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=ys),i||(i=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?yr(a,e-1,n,r,i):De(i,a):r||(i[i.length]=a)}return i}var _r=ki(),br=ki(!0);function xr(t,e){return t&&_r(t,e,La)}function wr(t,e){return t&&br(t,e,La)}function Sr(t,e){return Le(e,(function(e){return Ko(t[e])}))}function Mr(t,e){for(var r=0,i=(e=bi(e,t)).length;null!=t&&r<i;)t=t[zs(e[r++])];return r&&r==i?t:n}function Er(t,e,n){var r=e(t);return Go(t)?r:De(r,n(t))}function Tr(t){return null==t?t===n?"[object Undefined]":"[object Null]":ne&&ne in Ct(t)?function(t){var e=zt.call(t,ne),r=t[ne];try{t[ne]=n;var i=!0}catch{}var s=Bt.call(t);return i&&(e?t[ne]=r:delete t[ne]),s}(t):function(t){return Bt.call(t)}(t)}function Ar(t,e){return t>e}function Cr(t,e){return null!=t&&zt.call(t,e)}function Pr(t,e){return null!=t&&e in Ct(t)}function Ir(t,e,r){for(var i=r?Oe:Ne,s=t[0].length,o=t.length,a=o,l=at(o),c=1/0,u=[];a--;){var h=t[a];a&&e&&(h=ke(h,Qe(e))),c=bn(h.length,c),l[a]=!r&&(e||s>=120&&h.length>=120)?new Jn(a&&h):n}h=t[0];var d=-1,p=l[0];t:for(;++d<s&&u.length<c;){var f=h[d],m=e?e(f):f;if(f=r||0!==f?f:0,!(p?en(p,m):i(u,m,r))){for(a=o;--a;){var g=l[a];if(!(g?en(g,m):i(t[a],m,r)))continue t}p&&p.push(m),u.push(f)}}return u}function Rr(t,e,r){var i=null==(t=Cs(t,e=bi(e,t)))?t:t[zs(Ys(e))];return null==i?n:Ae(i,t,r)}function Lr(t){return na(t)&&Tr(t)==y}function Nr(t,e,r,i,s){return t===e||(null==t||null==e||!na(t)&&!na(e)?t!==t&&e!==e:function(t,e,r,i,s,o){var a=Go(t),l=Go(e),c=a?_:ms(t),u=l?_:ms(e),h=(c=c==y?A:c)==A,d=(u=u==y?A:u)==A,p=c==u;if(p&&Jo(t)){if(!Jo(e))return!1;a=!0,h=!1}if(p&&!h)return o||(o=new Yn),a||ua(t)?ns(t,e,r,i,s,o):function(t,e,n,r,i,s,o){switch(n){case k:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case O:return!(t.byteLength!=e.byteLength||!s(new qt(t),new qt(e)));case b:case x:case T:return Vo(+t,+e);case w:return t.name==e.name&&t.message==e.message;case P:case R:return t==e+"";case E:var a=cn;case I:var l=1&r;if(a||(a=dn),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;r|=2,o.set(t,e);var u=ns(a(t),a(e),r,i,s,o);return o.delete(t),u;case L:if(Fn)return Fn.call(t)==Fn.call(e)}return!1}(t,e,c,r,i,s,o);if(!(1&r)){var f=h&&zt.call(t,"__wrapped__"),m=d&&zt.call(e,"__wrapped__");if(f||m){var g=f?t.value():t,v=m?e.value():e;return o||(o=new Yn),s(g,v,r,i,o)}}return!!p&&(o||(o=new Yn),function(t,e,r,i,s,o){var a=1&r,l=is(t),c=l.length,u=is(e),h=u.length;if(c!=h&&!a)return!1;for(var d=c;d--;){var p=l[d];if(!(a?p in e:zt.call(e,p)))return!1}var f=o.get(t),m=o.get(e);if(f&&m)return f==e&&m==t;var g=!0;o.set(t,e),o.set(e,t);for(var v=a;++d<c;){var y=t[p=l[d]],_=e[p];if(i)var b=a?i(_,y,p,e,t,o):i(y,_,p,t,e,o);if(!(b===n?y===_||s(y,_,r,i,o):b)){g=!1;break}v||(v="constructor"==p)}if(g&&!v){var x=t.constructor,w=e.constructor;x!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w)&&(g=!1)}return o.delete(t),o.delete(e),g}(t,e,r,i,s,o))}(t,e,r,i,Nr,s))}function Or(t,e,r,i){var s=r.length,o=s,a=!i;if(null==t)return!o;for(t=Ct(t);s--;){var l=r[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<o;){var c=(l=r[s])[0],u=t[c],h=l[1];if(a&&l[2]){if(u===n&&!(c in t))return!1}else{var d=new Yn;if(i)var p=i(u,h,c,t,e,d);if(!(p===n?Nr(h,u,3,i,d):p))return!1}}return!0}function kr(t){return!(!ea(t)||function(t){return!!Ft&&Ft in t}(t))&&(Ko(t)?jt:yt).test(Us(t))}function Dr(t){return"function"==typeof t?t:null==t?il:"object"==typeof t?Go(t)?Hr(t[0],t[1]):Vr(t):pl(t)}function zr(t){if(!Ms(t))return yn(t);var e=[];for(var n in Ct(t))zt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Ur(t){if(!ea(t))return function(t){var e=[];if(null!=t)for(var n in Ct(t))e.push(n);return e}(t);var e=Ms(t),n=[];for(var r in t)"constructor"==r&&(e||!zt.call(t,r))||n.push(r);return n}function Fr(t,e){return t<e}function Br(t,e){var n=-1,r=$o(t)?at(t.length):[];return pr(t,(function(t,i,s){r[++n]=e(t,i,s)})),r}function Vr(t){var e=hs(t);return 1==e.length&&e[0][2]?Ts(e[0][0],e[0][1]):function(n){return n===t||Or(n,t,e)}}function Hr(t,e){return xs(t)&&Es(e)?Ts(zs(t),e):function(r){var i=Aa(r,t);return i===n&&i===e?Ca(r,t):Nr(e,i,3)}}function jr(t,e,r,i,s){t!==e&&_r(e,(function(o,a){if(s||(s=new Yn),ea(o))!function(t,e,r,i,s,o,a){var l=Ps(t,r),c=Ps(e,r),u=a.get(c);if(u)return void er(t,r,u);var h=o?o(l,c,r+"",t,e,a):n,d=h===n;if(d){var p=Go(c),f=!p&&Jo(c),m=!p&&!f&&ua(c);h=c,p||f||m?Go(l)?h=l:Xo(l)?h=Ii(l):f?(d=!1,h=Mi(c,!0)):m?(d=!1,h=Ti(c,!0)):h=[]:sa(c)||Wo(c)?(h=l,Wo(l)?h=ya(l):(!ea(l)||Ko(l))&&(h=vs(c))):d=!1}d&&(a.set(c,h),s(h,c,i,o,a),a.delete(c)),er(t,r,h)}(t,e,a,r,jr,i,s);else{var l=i?i(Ps(t,a),o,a+"",t,e,s):n;l===n&&(l=o),er(t,a,l)}}),Na)}function Wr(t,e){var r=t.length;if(r)return _s(e+=e<0?r:0,r)?t[e]:n}function Gr(t,e,n){e=e.length?ke(e,(function(t){return Go(t)?function(e){return Mr(e,1===t.length?t[0]:t)}:t})):[il];var r=-1;e=ke(e,Qe(cs()));var i=Br(t,(function(t,n,i){return{criteria:ke(e,(function(e){return e(t)})),index:++r,value:t}}));return function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(i,(function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,s=e.criteria,o=i.length,a=n.length;++r<o;){var l=Ai(i[r],s[r]);if(l)return r>=a?l:l*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function qr(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Mr(t,o);n(a,o)&&ti(s,bi(o,t),a)}return s}function $r(t,e,n,r){var i=r?We:je,s=-1,o=e.length,a=t;for(t===e&&(e=Ii(e)),n&&(a=ke(t,Qe(n)));++s<o;)for(var l=0,c=e[s],u=n?n(c):c;(l=i(a,u,l,r))>-1;)a!==t&&Zt.call(a,l,1),Zt.call(t,l,1);return t}function Xr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==s){var s=i;_s(i)?Zt.call(t,i,1):di(t,i)}}return t}function Jr(t,e){return t+ve(Sn()*(e-t+1))}function Yr(t,e){var n="";if(!t||e<1||e>d)return n;do{e%2&&(n+=t),(e=ve(e/2))&&(t+=t)}while(e);return n}function Zr(t,e){return Ls(As(t,e,il),t+"")}function Kr(t){return Kn(Va(t))}function Qr(t,e){var n=Va(t);return ks(n,lr(e,0,n.length))}function ti(t,e,r,i){if(!ea(t))return t;for(var s=-1,o=(e=bi(e,t)).length,a=o-1,l=t;null!=l&&++s<o;){var c=zs(e[s]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(s!=a){var h=l[c];(u=i?i(h,c,l):n)===n&&(u=ea(h)?h:_s(e[s+1])?[]:{})}nr(l,c,u),l=l[c]}return t}var ei=Rn?function(t,e){return Rn.set(t,e),t}:il,ni=ie?function(t,e){return ie(t,"toString",{configurable:!0,enumerable:!1,value:el(e),writable:!0})}:il;function ri(t){return ks(Va(t))}function ii(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=at(i);++r<i;)s[r]=t[r+e];return s}function si(t,e){var n;return pr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function oi(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e===e&&i<=g){for(;r<i;){var s=r+i>>>1,o=t[s];null!==o&&!ca(o)&&(n?o<=e:o<e)?r=s+1:i=s}return i}return ai(t,e,il,n)}function ai(t,e,r,i){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=r(e))!==e,l=null===e,c=ca(e),u=e===n;s<o;){var h=ve((s+o)/2),d=r(t[h]),p=d!==n,f=null===d,g=d===d,v=ca(d);if(a)var y=i||g;else y=u?g&&(i||p):l?g&&p&&(i||!f):c?g&&p&&!f&&(i||!v):!f&&!v&&(i?d<=e:d<e);y?s=h+1:o=h}return bn(o,m)}function li(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var o=t[n],a=e?e(o):o;if(!n||!Vo(a,l)){var l=a;s[i++]=0===o?0:o}}return s}function ci(t){return"number"==typeof t?t:ca(t)?p:+t}function ui(t){if("string"==typeof t)return t;if(Go(t))return ke(t,ui)+"";if(ca(t))return Bn?Bn.call(t):"";var e=t+"";return"0"==e&&1/t==-h?"-0":e}function hi(t,e,n){var r=-1,i=Ne,s=t.length,o=!0,a=[],l=a;if(n)o=!1,i=Oe;else if(s>=200){var c=e?null:Yi(t);if(c)return dn(c);o=!1,i=en,l=new Jn}else l=e?[]:a;t:for(;++r<s;){var u=t[r],h=e?e(u):u;if(u=n||0!==u?u:0,o&&h===h){for(var d=l.length;d--;)if(l[d]===h)continue t;e&&l.push(h),a.push(u)}else i(l,h,n)||(l!==a&&l.push(h),a.push(u))}return a}function di(t,e){return null==(t=Cs(t,e=bi(e,t)))||delete t[zs(Ys(e))]}function pi(t,e,n,r){return ti(t,e,n(Mr(t,e)),r)}function fi(t,e,n,r){for(var i=t.length,s=r?i:-1;(r?s--:++s<i)&&e(t[s],s,t););return n?ii(t,r?0:s,r?s+1:i):ii(t,r?s+1:0,r?i:s)}function mi(t,e){var n=t;return n instanceof Gn&&(n=n.value()),ze(e,(function(t,e){return e.func.apply(e.thisArg,De([t],e.args))}),n)}function gi(t,e,n){var r=t.length;if(r<2)return r?hi(t[0]):[];for(var i=-1,s=at(r);++i<r;)for(var o=t[i],a=-1;++a<r;)a!=i&&(s[i]=dr(s[i]||o,t[a],e,n));return hi(yr(s,1),e,n)}function vi(t,e,r){for(var i=-1,s=t.length,o=e.length,a={};++i<s;){var l=i<o?e[i]:n;r(a,t[i],l)}return a}function yi(t){return Xo(t)?t:[]}function _i(t){return"function"==typeof t?t:il}function bi(t,e){return Go(t)?t:xs(t,e)?[t]:Ds(_a(t))}var xi=Zr;function wi(t,e,r){var i=t.length;return r=r===n?i:r,!e&&r>=i?t:ii(t,e,r)}var Si=ue||function(t){return me.clearTimeout(t)};function Mi(t,e){if(e)return t.slice();var n=t.length,r=$t?$t(n):new t.constructor(n);return t.copy(r),r}function Ei(t){var e=new t.constructor(t.byteLength);return new qt(e).set(new qt(t)),e}function Ti(t,e){var n=e?Ei(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Ai(t,e){if(t!==e){var r=t!==n,i=null===t,s=t===t,o=ca(t),a=e!==n,l=null===e,c=e===e,u=ca(e);if(!l&&!u&&!o&&t>e||o&&a&&c&&!l&&!u||i&&a&&c||!r&&c||!s)return 1;if(!i&&!o&&!u&&t<e||u&&r&&s&&!i&&!o||l&&r&&s||!a&&s||!c)return-1}return 0}function Ci(t,e,n,r){for(var i=-1,s=t.length,o=n.length,a=-1,l=e.length,c=_n(s-o,0),u=at(l+c),h=!r;++a<l;)u[a]=e[a];for(;++i<o;)(h||i<s)&&(u[n[i]]=t[i]);for(;c--;)u[a++]=t[i++];return u}function Pi(t,e,n,r){for(var i=-1,s=t.length,o=-1,a=n.length,l=-1,c=e.length,u=_n(s-a,0),h=at(u+c),d=!r;++i<u;)h[i]=t[i];for(var p=i;++l<c;)h[p+l]=e[l];for(;++o<a;)(d||i<s)&&(h[p+n[o]]=t[i++]);return h}function Ii(t,e){var n=-1,r=t.length;for(e||(e=at(r));++n<r;)e[n]=t[n];return e}function Ri(t,e,r,i){var s=!r;r||(r={});for(var o=-1,a=e.length;++o<a;){var l=e[o],c=i?i(r[l],t[l],l,r,t):n;c===n&&(c=t[l]),s?or(r,l,c):nr(r,l,c)}return r}function Li(t,e){return function(n,r){var i=Go(n)?Ce:ir,s=e?e():{};return i(n,t,cs(r,2),s)}}function Ni(t){return Zr((function(e,r){var i=-1,s=r.length,o=s>1?r[s-1]:n,a=s>2?r[2]:n;for(o=t.length>3&&"function"==typeof o?(s--,o):n,a&&bs(r[0],r[1],a)&&(o=s<3?n:o,s=1),e=Ct(e);++i<s;){var l=r[i];l&&t(e,l,i,o)}return e}))}function Oi(t,e){return function(n,r){if(null==n)return n;if(!$o(n))return t(n,r);for(var i=n.length,s=e?i:-1,o=Ct(n);(e?s--:++s<i)&&!1!==r(o[s],s,o););return n}}function ki(t){return function(e,n,r){for(var i=-1,s=Ct(e),o=r(e),a=o.length;a--;){var l=o[t?a:++i];if(!1===n(s[l],l,s))break}return e}}function Di(t){return function(e){var r=ln(e=_a(e))?fn(e):n,i=r?r[0]:e.charAt(0),s=r?wi(r,1).join(""):e.slice(1);return i[t]()+s}}function zi(t){return function(e){return ze(Ka(Wa(e).replace(te,"")),t,"")}}function Ui(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Hn(t.prototype),r=t.apply(n,e);return ea(r)?r:n}}function Fi(t){return function(e,r,i){var s=Ct(e);if(!$o(e)){var o=cs(r,3);e=La(e),r=function(t){return o(s[t],t,s)}}var a=t(e,r,i);return a>-1?s[o?e[a]:a]:n}}function Bi(t){return rs((function(e){var i=e.length,s=i,o=Wn.prototype.thru;for(t&&e.reverse();s--;){var a=e[s];if("function"!=typeof a)throw new Rt(r);if(o&&!l&&"wrapper"==as(a))var l=new Wn([],!0)}for(s=l?s:i;++s<i;){var c=as(a=e[s]),u="wrapper"==c?os(a):n;l=u&&ws(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[as(u[0])].apply(l,u[3]):1==a.length&&ws(a)?l[c]():l.thru(a)}return function(){var t=arguments,n=t[0];if(l&&1==t.length&&Go(n))return l.plant(n).value();for(var r=0,s=i?e[r].apply(this,t):n;++r<i;)s=e[r].call(this,s);return s}}))}function Vi(t,e,r,i,s,o,a,l,u,h){var d=e&c,p=1&e,f=2&e,m=24&e,g=512&e,v=f?n:Ui(t);return function c(){for(var y=arguments.length,_=at(y),b=y;b--;)_[b]=arguments[b];if(m)var x=ls(c),w=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(_,x);if(i&&(_=Ci(_,i,s,m)),o&&(_=Pi(_,o,a,m)),y-=w,m&&y<h){var S=hn(_,x);return Xi(t,e,Vi,c.placeholder,r,_,S,l,u,h-y)}var M=p?r:this,E=f?M[t]:t;return y=_.length,l?_=function(t,e){for(var r=t.length,i=bn(e.length,r),s=Ii(t);i--;){var o=e[i];t[i]=_s(o,r)?s[o]:n}return t}(_,l):g&&y>1&&_.reverse(),d&&u<y&&(_.length=u),this&&this!==me&&this instanceof c&&(E=v||Ui(E)),E.apply(M,_)}}function Hi(t,e){return function(n,r){return function(t,e,n,r){return xr(t,(function(t,i,s){e(r,n(t),i,s)})),r}(n,t,e(r),{})}}function ji(t,e){return function(r,i){var s;if(r===n&&i===n)return e;if(r!==n&&(s=r),i!==n){if(s===n)return i;"string"==typeof r||"string"==typeof i?(r=ui(r),i=ui(i)):(r=ci(r),i=ci(i)),s=t(r,i)}return s}}function Wi(t){return rs((function(e){return e=ke(e,Qe(cs())),Zr((function(n){var r=this;return t(e,(function(t){return Ae(t,r,n)}))}))}))}function Gi(t,e){var r=(e=e===n?" ":ui(e)).length;if(r<2)return r?Yr(e,t):e;var i=Yr(e,ge(t/pn(e)));return ln(e)?wi(fn(i),0,t).join(""):i.slice(0,t)}function qi(t){return function(e,r,i){return i&&"number"!=typeof i&&bs(e,r,i)&&(r=i=n),e=fa(e),r===n?(r=e,e=0):r=fa(r),function(t,e,n,r){for(var i=-1,s=_n(ge((e-t)/(n||1)),0),o=at(s);s--;)o[r?s:++i]=t,t+=n;return o}(e,r,i=i===n?e<r?1:-1:fa(i),t)}}function $i(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=va(e),n=va(n)),t(e,n)}}function Xi(t,e,r,i,s,o,c,u,h,d){var p=8&e;e|=p?a:l,4&(e&=~(p?l:a))||(e&=-4);var f=[t,e,s,p?o:n,p?c:n,p?n:o,p?n:c,u,h,d],m=r.apply(n,f);return ws(t)&&Is(m,f),m.placeholder=i,Ns(m,t,e)}function Ji(t){var e=At[t];return function(t,n){if(t=va(t),(n=null==n?0:bn(ma(n),292))&&Be(t)){var r=(_a(t)+"e").split("e");return+((r=(_a(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Yi=Cn&&1/dn(new Cn([,-0]))[1]==h?function(t){return new Cn(t)}:cl;function Zi(t){return function(e){var n=ms(e);return n==E?cn(e):n==I?function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}(e):function(t,e){return ke(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ki(t,e,i,h,d,p,f,m){var g=2&e;if(!g&&"function"!=typeof t)throw new Rt(r);var v=h?h.length:0;if(v||(e&=-97,h=d=n),f=f===n?f:_n(ma(f),0),m=m===n?m:ma(m),v-=d?d.length:0,e&l){var y=h,_=d;h=d=n}var b=g?n:os(t),x=[t,e,i,h,d,y,_,p,f,m];if(b&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<131,a=r==c&&8==n||r==c&&n==u&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!o&&!a)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var l=e[3];if(l){var h=t[3];t[3]=h?Ci(h,l,e[4]):l,t[4]=h?hn(t[3],s):e[4]}l=e[5],l&&(h=t[5],t[5]=h?Pi(h,l,e[6]):l,t[6]=h?hn(t[5],s):e[6]),l=e[7],l&&(t[7]=l),r&c&&(t[8]=null==t[8]?e[8]:bn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i}(x,b),t=x[0],e=x[1],i=x[2],h=x[3],d=x[4],!(m=x[9]=x[9]===n?g?0:t.length:_n(x[9]-v,0))&&24&e&&(e&=-25),e&&1!=e)w=8==e||e==o?function(t,e,r){var i=Ui(t);return function s(){for(var o=arguments.length,a=at(o),l=o,c=ls(s);l--;)a[l]=arguments[l];var u=o<3&&a[0]!==c&&a[o-1]!==c?[]:hn(a,c);return(o-=u.length)<r?Xi(t,e,Vi,s.placeholder,n,a,u,n,n,r-o):Ae(this&&this!==me&&this instanceof s?i:t,this,a)}}(t,e,m):e!=a&&33!=e||d.length?Vi.apply(n,x):function(t,e,n,r){var i=1&e,s=Ui(t);return function e(){for(var o=-1,a=arguments.length,l=-1,c=r.length,u=at(c+a),h=this&&this!==me&&this instanceof e?s:t;++l<c;)u[l]=r[l];for(;a--;)u[l++]=arguments[++o];return Ae(h,i?n:this,u)}}(t,e,i,h);else var w=function(t,e,n){var r=1&e,i=Ui(t);return function e(){return(this&&this!==me&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,i);return Ns((b?ei:Is)(w,x),t,e)}function Qi(t,e,r,i){return t===n||Vo(t,Ot[r])&&!zt.call(i,r)?e:t}function ts(t,e,r,i,s,o){return ea(t)&&ea(e)&&(o.set(e,t),jr(t,e,n,ts,o),o.delete(e)),t}function es(t){return sa(t)?n:t}function ns(t,e,r,i,s,o){var a=1&r,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var u=o.get(t),h=o.get(e);if(u&&h)return u==e&&h==t;var d=-1,p=!0,f=2&r?new Jn:n;for(o.set(t,e),o.set(e,t);++d<l;){var m=t[d],g=e[d];if(i)var v=a?i(g,m,d,e,t,o):i(m,g,d,t,e,o);if(v!==n){if(v)continue;p=!1;break}if(f){if(!Fe(e,(function(t,e){if(!en(f,e)&&(m===t||s(m,t,r,i,o)))return f.push(e)}))){p=!1;break}}else if(m!==g&&!s(m,g,r,i,o)){p=!1;break}}return o.delete(t),o.delete(e),p}function rs(t){return Ls(As(t,n,Gs),t+"")}function is(t){return Er(t,La,ps)}function ss(t){return Er(t,Na,fs)}var os=Rn?function(t){return Rn.get(t)}:cl;function as(t){for(var e=t.name+"",n=Ln[e],r=zt.call(Ln,e)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==t)return i.name}return e}function ls(t){return(zt.call(Vn,"placeholder")?Vn:t).placeholder}function cs(){var t=Vn.iteratee||sl;return t=t===sl?Dr:t,arguments.length?t(arguments[0],arguments[1]):t}function us(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function hs(t){for(var e=La(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Es(i)]}return e}function ds(t,e){var r=function(t,e){return null==t?n:t[e]}(t,e);return kr(r)?r:n}var ps=_e?function(t){return null==t?[]:(t=Ct(t),Le(_e(t),(function(e){return Yt.call(t,e)})))}:gl,fs=_e?function(t){for(var e=[];t;)De(e,ps(t)),t=Xt(t);return e}:gl,ms=Tr;function gs(t,e,n){for(var r=-1,i=(e=bi(e,t)).length,s=!1;++r<i;){var o=zs(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&ta(i)&&_s(o,i)&&(Go(t)||Wo(t))}function vs(t){return"function"!=typeof t.constructor||Ms(t)?{}:Hn(Xt(t))}function ys(t){return Go(t)||Wo(t)||!!(Kt&&t&&t[Kt])}function _s(t,e){var n=typeof t;return!!(e=e??d)&&("number"==n||"symbol"!=n&&bt.test(t))&&t>-1&&t%1==0&&t<e}function bs(t,e,n){if(!ea(n))return!1;var r=typeof e;return!!("number"==r?$o(n)&&_s(e,n.length):"string"==r&&e in n)&&Vo(n[e],t)}function xs(t,e){if(Go(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ca(t))||(nt.test(t)||!et.test(t)||null!=e&&t in Ct(e))}function ws(t){var e=as(t),n=Vn[e];if("function"!=typeof n||!(e in Gn.prototype))return!1;if(t===n)return!0;var r=os(n);return!!r&&t===r[0]}(En&&ms(new En(new ArrayBuffer(1)))!=k||Tn&&ms(new Tn)!=E||An&&ms(An.resolve())!=C||Cn&&ms(new Cn)!=I||Pn&&ms(new Pn)!=N)&&(ms=function(t){var e=Tr(t),r=e==A?t.constructor:n,i=r?Us(r):"";if(i)switch(i){case Nn:return k;case On:return E;case kn:return C;case Dn:return I;case zn:return N}return e});var Ss=kt?Ko:vl;function Ms(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ot)}function Es(t){return t===t&&!ea(t)}function Ts(t,e){return function(r){return null!=r&&(r[t]===e&&(e!==n||t in Ct(r)))}}function As(t,e,r){return e=_n(e===n?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=_n(n.length-e,0),o=at(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=at(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),Ae(t,this,a)}}function Cs(t,e){return e.length<2?t:Mr(t,ii(e,0,-1))}function Ps(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Is=Os(ei),Rs=fe||function(t,e){return me.setTimeout(t,e)},Ls=Os(ni);function Ns(t,e,n){var r=e+"";return Ls(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(lt,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Pe(v,(function(n){var r="_."+n[0];e&n[1]&&!Ne(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(ct);return e?e[1].split(ut):[]}(r),n)))}function Os(t){var e=0,r=0;return function(){var i=xn(),s=16-(i-r);if(r=i,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(n,arguments)}}function ks(t,e){var r=-1,i=t.length,s=i-1;for(e=e===n?i:e;++r<e;){var o=Jr(r,s),a=t[o];t[o]=t[r],t[r]=a}return t.length=e,t}var Ds=function(t){var e=ko(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(rt,(function(t,n,r,i){e.push(r?i.replace(pt,"$1"):n||t)})),e}));function zs(t){if("string"==typeof t||ca(t))return t;var e=t+"";return"0"==e&&1/t==-h?"-0":e}function Us(t){if(null!=t){try{return Dt.call(t)}catch{}try{return t+""}catch{}}return""}function Fs(t){if(t instanceof Gn)return t.clone();var e=new Wn(t.__wrapped__,t.__chain__);return e.__actions__=Ii(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Bs=Zr((function(t,e){return Xo(t)?dr(t,yr(e,1,Xo,!0)):[]})),Vs=Zr((function(t,e){var r=Ys(e);return Xo(r)&&(r=n),Xo(t)?dr(t,yr(e,1,Xo,!0),cs(r,2)):[]})),Hs=Zr((function(t,e){var r=Ys(e);return Xo(r)&&(r=n),Xo(t)?dr(t,yr(e,1,Xo,!0),n,r):[]}));function js(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ma(n);return i<0&&(i=_n(r+i,0)),He(t,cs(e,3),i)}function Ws(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i-1;return r!==n&&(s=ma(r),s=r<0?_n(i+s,0):bn(s,i-1)),He(t,cs(e,3),s,!0)}function Gs(t){return(null==t?0:t.length)?yr(t,1):[]}function qs(t){return t&&t.length?t[0]:n}var $s=Zr((function(t){var e=ke(t,yi);return e.length&&e[0]===t[0]?Ir(e):[]})),Xs=Zr((function(t){var e=Ys(t),r=ke(t,yi);return e===Ys(r)?e=n:r.pop(),r.length&&r[0]===t[0]?Ir(r,cs(e,2)):[]})),Js=Zr((function(t){var e=Ys(t),r=ke(t,yi);return(e="function"==typeof e?e:n)&&r.pop(),r.length&&r[0]===t[0]?Ir(r,n,e):[]}));function Ys(t){var e=null==t?0:t.length;return e?t[e-1]:n}var Zs=Zr(Ks);function Ks(t,e){return t&&t.length&&e&&e.length?$r(t,e):t}var Qs=rs((function(t,e){var n=null==t?0:t.length,r=ar(t,e);return Xr(t,ke(e,(function(t){return _s(t,n)?+t:t})).sort(Ai)),r}));function to(t){return null==t?t:Mn.call(t)}var eo=Zr((function(t){return hi(yr(t,1,Xo,!0))})),no=Zr((function(t){var e=Ys(t);return Xo(e)&&(e=n),hi(yr(t,1,Xo,!0),cs(e,2))})),ro=Zr((function(t){var e=Ys(t);return e="function"==typeof e?e:n,hi(yr(t,1,Xo,!0),n,e)}));function io(t){if(!t||!t.length)return[];var e=0;return t=Le(t,(function(t){if(Xo(t))return e=_n(t.length,e),!0})),Ze(e,(function(e){return ke(t,$e(e))}))}function so(t,e){if(!t||!t.length)return[];var r=io(t);return null==e?r:ke(r,(function(t){return Ae(e,n,t)}))}var oo=Zr((function(t,e){return Xo(t)?dr(t,e):[]})),ao=Zr((function(t){return gi(Le(t,Xo))})),lo=Zr((function(t){var e=Ys(t);return Xo(e)&&(e=n),gi(Le(t,Xo),cs(e,2))})),co=Zr((function(t){var e=Ys(t);return e="function"==typeof e?e:n,gi(Le(t,Xo),n,e)})),uo=Zr(io);var ho=Zr((function(t){var e=t.length,r=e>1?t[e-1]:n;return r="function"==typeof r?(t.pop(),r):n,so(t,r)}));function po(t){var e=Vn(t);return e.__chain__=!0,e}function fo(t,e){return e(t)}var mo=rs((function(t){var e=t.length,r=e?t[0]:0,i=this.__wrapped__,s=function(e){return ar(e,t)};return!(e>1||this.__actions__.length)&&i instanceof Gn&&_s(r)?((i=i.slice(r,+r+(e?1:0))).__actions__.push({func:fo,args:[s],thisArg:n}),new Wn(i,this.__chain__).thru((function(t){return e&&!t.length&&t.push(n),t}))):this.thru(s)}));var go=Li((function(t,e,n){zt.call(t,n)?++t[n]:or(t,n,1)}));var vo=Fi(js),yo=Fi(Ws);function _o(t,e){return(Go(t)?Pe:pr)(t,cs(e,3))}function bo(t,e){return(Go(t)?Ie:fr)(t,cs(e,3))}var xo=Li((function(t,e,n){zt.call(t,n)?t[n].push(e):or(t,n,[e])}));var wo=Zr((function(t,e,n){var r=-1,i="function"==typeof e,s=$o(t)?at(t.length):[];return pr(t,(function(t){s[++r]=i?Ae(e,t,n):Rr(t,e,n)})),s})),So=Li((function(t,e,n){or(t,n,e)}));function Mo(t,e){return(Go(t)?ke:Br)(t,cs(e,3))}var Eo=Li((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var To=Zr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&bs(t,e[0],e[1])?e=[]:n>2&&bs(e[0],e[1],e[2])&&(e=[e[0]]),Gr(t,yr(e,1),[])})),Ao=pe||function(){return me.Date.now()};function Co(t,e,r){return e=r?n:e,e=t&&null==e?t.length:e,Ki(t,c,n,n,n,n,e)}function Po(t,e){var i;if("function"!=typeof e)throw new Rt(r);return t=ma(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=n),i}}var Io=Zr((function(t,e,n){var r=1;if(n.length){var i=hn(n,ls(Io));r|=a}return Ki(t,r,e,n,i)})),Ro=Zr((function(t,e,n){var r=3;if(n.length){var i=hn(n,ls(Ro));r|=a}return Ki(e,r,t,n,i)}));function Lo(t,e,i){var s,o,a,l,c,u,h=0,d=!1,p=!1,f=!0;if("function"!=typeof t)throw new Rt(r);function m(e){var r=s,i=o;return s=o=n,h=e,l=t.apply(i,r)}function g(t){var r=t-u;return u===n||r>=e||r<0||p&&t-h>=a}function v(){var t=Ao();if(g(t))return y(t);c=Rs(v,function(t){var n=e-(t-u);return p?bn(n,a-(t-h)):n}(t))}function y(t){return c=n,f&&s?m(t):(s=o=n,l)}function _(){var t=Ao(),r=g(t);if(s=arguments,o=this,u=t,r){if(c===n)return function(t){return h=t,c=Rs(v,e),d?m(t):l}(u);if(p)return Si(c),c=Rs(v,e),m(u)}return c===n&&(c=Rs(v,e)),l}return e=va(e)||0,ea(i)&&(d=!!i.leading,a=(p="maxWait"in i)?_n(va(i.maxWait)||0,e):a,f="trailing"in i?!!i.trailing:f),_.cancel=function(){c!==n&&Si(c),h=0,s=u=o=c=n},_.flush=function(){return c===n?l:y(Ao())},_}var No=Zr((function(t,e){return hr(t,1,e)})),Oo=Zr((function(t,e,n){return hr(t,va(e)||0,n)}));function ko(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Rt(r);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(ko.Cache||Xn),n}function Do(t){if("function"!=typeof t)throw new Rt(r);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}ko.Cache=Xn;var zo=xi((function(t,e){var n=(e=1==e.length&&Go(e[0])?ke(e[0],Qe(cs())):ke(yr(e,1),Qe(cs()))).length;return Zr((function(r){for(var i=-1,s=bn(r.length,n);++i<s;)r[i]=e[i].call(this,r[i]);return Ae(t,this,r)}))})),Uo=Zr((function(t,e){var r=hn(e,ls(Uo));return Ki(t,a,n,e,r)})),Fo=Zr((function(t,e){var r=hn(e,ls(Fo));return Ki(t,l,n,e,r)})),Bo=rs((function(t,e){return Ki(t,u,n,n,n,e)}));function Vo(t,e){return t===e||t!==t&&e!==e}var Ho=$i(Ar),jo=$i((function(t,e){return t>=e})),Wo=Lr(function(){return arguments}())?Lr:function(t){return na(t)&&zt.call(t,"callee")&&!Yt.call(t,"callee")},Go=at.isArray,qo=xe?Qe(xe):function(t){return na(t)&&Tr(t)==O};function $o(t){return null!=t&&ta(t.length)&&!Ko(t)}function Xo(t){return na(t)&&$o(t)}var Jo=be||vl,Yo=we?Qe(we):function(t){return na(t)&&Tr(t)==x};function Zo(t){if(!na(t))return!1;var e=Tr(t);return e==w||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!sa(t)}function Ko(t){if(!ea(t))return!1;var e=Tr(t);return e==S||e==M||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Qo(t){return"number"==typeof t&&t==ma(t)}function ta(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=d}function ea(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function na(t){return null!=t&&"object"==typeof t}var ra=Se?Qe(Se):function(t){return na(t)&&ms(t)==E};function ia(t){return"number"==typeof t||na(t)&&Tr(t)==T}function sa(t){if(!na(t)||Tr(t)!=A)return!1;var e=Xt(t);if(null===e)return!0;var n=zt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Dt.call(n)==Vt}var oa=Me?Qe(Me):function(t){return na(t)&&Tr(t)==P};var aa=Ee?Qe(Ee):function(t){return na(t)&&ms(t)==I};function la(t){return"string"==typeof t||!Go(t)&&na(t)&&Tr(t)==R}function ca(t){return"symbol"==typeof t||na(t)&&Tr(t)==L}var ua=Te?Qe(Te):function(t){return na(t)&&ta(t.length)&&!!le[Tr(t)]};var ha=$i(Fr),da=$i((function(t,e){return t<=e}));function pa(t){if(!t)return[];if($o(t))return la(t)?fn(t):Ii(t);if(Qt&&t[Qt])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[Qt]());var e=ms(t);return(e==E?cn:e==I?dn:Va)(t)}function fa(t){return t?(t=va(t))===h||t===-h?17976931348623157e292*(t<0?-1:1):t===t?t:0:0===t?t:0}function ma(t){var e=fa(t),n=e%1;return e===e?n?e-n:e:0}function ga(t){return t?lr(ma(t),0,f):0}function va(t){if("number"==typeof t)return t;if(ca(t))return p;if(ea(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=ea(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ke(t);var n=vt.test(t);return n||_t.test(t)?de(t.slice(2),n?2:8):gt.test(t)?p:+t}function ya(t){return Ri(t,Na(t))}function _a(t){return null==t?"":ui(t)}var ba=Ni((function(t,e){if(Ms(e)||$o(e))Ri(e,La(e),t);else for(var n in e)zt.call(e,n)&&nr(t,n,e[n])})),xa=Ni((function(t,e){Ri(e,Na(e),t)})),wa=Ni((function(t,e,n,r){Ri(e,Na(e),t,r)})),Sa=Ni((function(t,e,n,r){Ri(e,La(e),t,r)})),Ma=rs(ar);var Ea=Zr((function(t,e){t=Ct(t);var r=-1,i=e.length,s=i>2?e[2]:n;for(s&&bs(e[0],e[1],s)&&(i=1);++r<i;)for(var o=e[r],a=Na(o),l=-1,c=a.length;++l<c;){var u=a[l],h=t[u];(h===n||Vo(h,Ot[u])&&!zt.call(t,u))&&(t[u]=o[u])}return t})),Ta=Zr((function(t){return t.push(n,ts),Ae(ka,n,t)}));function Aa(t,e,r){var i=null==t?n:Mr(t,e);return i===n?r:i}function Ca(t,e){return null!=t&&gs(t,e,Pr)}var Pa=Hi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),t[e]=n}),el(il)),Ia=Hi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),zt.call(t,e)?t[e].push(n):t[e]=[n]}),cs),Ra=Zr(Rr);function La(t){return $o(t)?Zn(t):zr(t)}function Na(t){return $o(t)?Zn(t,!0):Ur(t)}var Oa=Ni((function(t,e,n){jr(t,e,n)})),ka=Ni((function(t,e,n,r){jr(t,e,n,r)})),Da=rs((function(t,e){var n={};if(null==t)return n;var r=!1;e=ke(e,(function(e){return e=bi(e,t),r||(r=e.length>1),e})),Ri(t,ss(t),n),r&&(n=cr(n,7,es));for(var i=e.length;i--;)di(n,e[i]);return n}));var za=rs((function(t,e){return null==t?{}:function(t,e){return qr(t,e,(function(e,n){return Ca(t,n)}))}(t,e)}));function Ua(t,e){if(null==t)return{};var n=ke(ss(t),(function(t){return[t]}));return e=cs(e),qr(t,n,(function(t,n){return e(t,n[0])}))}var Fa=Zi(La),Ba=Zi(Na);function Va(t){return null==t?[]:tn(t,La(t))}var Ha=zi((function(t,e,n){return e=e.toLowerCase(),t+(n?ja(e):e)}));function ja(t){return Za(_a(t).toLowerCase())}function Wa(t){return(t=_a(t))&&t.replace(xt,sn).replace(ee,"")}var Ga=zi((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),qa=zi((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),$a=Di("toLowerCase");var Xa=zi((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var Ja=zi((function(t,e,n){return t+(n?" ":"")+Za(e)}));var Ya=zi((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Za=Di("toUpperCase");function Ka(t,e,r){return t=_a(t),(e=r?n:e)===n?function(t){return se.test(t)}(t)?function(t){return t.match(re)||[]}(t):function(t){return t.match(ht)||[]}(t):t.match(e)||[]}var Qa=Zr((function(t,e){try{return Ae(t,n,e)}catch(r){return Zo(r)?r:new Et(r)}})),tl=rs((function(t,e){return Pe(e,(function(e){e=zs(e),or(t,e,Io(t[e],t))})),t}));function el(t){return function(){return t}}var nl=Bi(),rl=Bi(!0);function il(t){return t}function sl(t){return Dr("function"==typeof t?t:cr(t,1))}var ol=Zr((function(t,e){return function(n){return Rr(n,t,e)}})),al=Zr((function(t,e){return function(n){return Rr(t,n,e)}}));function ll(t,e,n){var r=La(e),i=Sr(e,r);null==n&&(!ea(e)||!i.length&&r.length)&&(n=e,e=t,t=this,i=Sr(e,La(e)));var s=!(ea(n)&&"chain"in n)||!!n.chain,o=Ko(t);return Pe(i,(function(n){var r=e[n];t[n]=r,o&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__);return(n.__actions__=Ii(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,De([this.value()],arguments))})})),t}function cl(){}var ul=Wi(ke),hl=Wi(Re),dl=Wi(Fe);function pl(t){return xs(t)?$e(zs(t)):function(t){return function(e){return Mr(e,t)}}(t)}var fl=qi(),ml=qi(!0);function gl(){return[]}function vl(){return!1}var yl=ji((function(t,e){return t+e}),0),_l=Ji("ceil"),bl=ji((function(t,e){return t/e}),1),xl=Ji("floor");var wl=ji((function(t,e){return t*e}),1),Sl=Ji("round"),Ml=ji((function(t,e){return t-e}),0);return Vn.after=function(t,e){if("function"!=typeof e)throw new Rt(r);return t=ma(t),function(){if(--t<1)return e.apply(this,arguments)}},Vn.ary=Co,Vn.assign=ba,Vn.assignIn=xa,Vn.assignInWith=wa,Vn.assignWith=Sa,Vn.at=Ma,Vn.before=Po,Vn.bind=Io,Vn.bindAll=tl,Vn.bindKey=Ro,Vn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Go(t)?t:[t]},Vn.chain=po,Vn.chunk=function(t,e,r){e=(r?bs(t,e,r):e===n)?1:_n(ma(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var s=0,o=0,a=at(ge(i/e));s<i;)a[o++]=ii(t,s,s+=e);return a},Vn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i},Vn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=at(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return De(Go(n)?Ii(n):[n],yr(e,1))},Vn.cond=function(t){var e=null==t?0:t.length,n=cs();return t=e?ke(t,(function(t){if("function"!=typeof t[1])throw new Rt(r);return[n(t[0]),t[1]]})):[],Zr((function(n){for(var r=-1;++r<e;){var i=t[r];if(Ae(i[0],this,n))return Ae(i[1],this,n)}}))},Vn.conforms=function(t){return function(t){var e=La(t);return function(n){return ur(n,t,e)}}(cr(t,1))},Vn.constant=el,Vn.countBy=go,Vn.create=function(t,e){var n=Hn(t);return null==e?n:sr(n,e)},Vn.curry=function t(e,r,i){var s=Ki(e,8,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Vn.curryRight=function t(e,r,i){var s=Ki(e,o,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Vn.debounce=Lo,Vn.defaults=Ea,Vn.defaultsDeep=Ta,Vn.defer=No,Vn.delay=Oo,Vn.difference=Bs,Vn.differenceBy=Vs,Vn.differenceWith=Hs,Vn.drop=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=r||e===n?1:ma(e))<0?0:e,i):[]},Vn.dropRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,0,(e=i-(e=r||e===n?1:ma(e)))<0?0:e):[]},Vn.dropRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0,!0):[]},Vn.dropWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0):[]},Vn.fill=function(t,e,r,i){var s=null==t?0:t.length;return s?(r&&"number"!=typeof r&&bs(t,e,r)&&(r=0,i=s),function(t,e,r,i){var s=t.length;for((r=ma(r))<0&&(r=-r>s?0:s+r),(i=i===n||i>s?s:ma(i))<0&&(i+=s),i=r>i?0:ga(i);r<i;)t[r++]=e;return t}(t,e,r,i)):[]},Vn.filter=function(t,e){return(Go(t)?Le:vr)(t,cs(e,3))},Vn.flatMap=function(t,e){return yr(Mo(t,e),1)},Vn.flatMapDeep=function(t,e){return yr(Mo(t,e),h)},Vn.flatMapDepth=function(t,e,r){return r=r===n?1:ma(r),yr(Mo(t,e),r)},Vn.flatten=Gs,Vn.flattenDeep=function(t){return(null==t?0:t.length)?yr(t,h):[]},Vn.flattenDepth=function(t,e){return(null==t?0:t.length)?yr(t,e=e===n?1:ma(e)):[]},Vn.flip=function(t){return Ki(t,512)},Vn.flow=nl,Vn.flowRight=rl,Vn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Vn.functions=function(t){return null==t?[]:Sr(t,La(t))},Vn.functionsIn=function(t){return null==t?[]:Sr(t,Na(t))},Vn.groupBy=xo,Vn.initial=function(t){return(null==t?0:t.length)?ii(t,0,-1):[]},Vn.intersection=$s,Vn.intersectionBy=Xs,Vn.intersectionWith=Js,Vn.invert=Pa,Vn.invertBy=Ia,Vn.invokeMap=wo,Vn.iteratee=sl,Vn.keyBy=So,Vn.keys=La,Vn.keysIn=Na,Vn.map=Mo,Vn.mapKeys=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){or(n,e(t,r,i),t)})),n},Vn.mapValues=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){or(n,r,e(t,r,i))})),n},Vn.matches=function(t){return Vr(cr(t,1))},Vn.matchesProperty=function(t,e){return Hr(t,cr(e,1))},Vn.memoize=ko,Vn.merge=Oa,Vn.mergeWith=ka,Vn.method=ol,Vn.methodOf=al,Vn.mixin=ll,Vn.negate=Do,Vn.nthArg=function(t){return t=ma(t),Zr((function(e){return Wr(e,t)}))},Vn.omit=Da,Vn.omitBy=function(t,e){return Ua(t,Do(cs(e)))},Vn.once=function(t){return Po(2,t)},Vn.orderBy=function(t,e,r,i){return null==t?[]:(Go(e)||(e=null==e?[]:[e]),Go(r=i?n:r)||(r=null==r?[]:[r]),Gr(t,e,r))},Vn.over=ul,Vn.overArgs=zo,Vn.overEvery=hl,Vn.overSome=dl,Vn.partial=Uo,Vn.partialRight=Fo,Vn.partition=Eo,Vn.pick=za,Vn.pickBy=Ua,Vn.property=pl,Vn.propertyOf=function(t){return function(e){return null==t?n:Mr(t,e)}},Vn.pull=Zs,Vn.pullAll=Ks,Vn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?$r(t,e,cs(n,2)):t},Vn.pullAllWith=function(t,e,r){return t&&t.length&&e&&e.length?$r(t,e,n,r):t},Vn.pullAt=Qs,Vn.range=fl,Vn.rangeRight=ml,Vn.rearg=Bo,Vn.reject=function(t,e){return(Go(t)?Le:vr)(t,Do(cs(e,3)))},Vn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],s=t.length;for(e=cs(e,3);++r<s;){var o=t[r];e(o,r,t)&&(n.push(o),i.push(r))}return Xr(t,i),n},Vn.rest=function(t,e){if("function"!=typeof t)throw new Rt(r);return Zr(t,e=e===n?e:ma(e))},Vn.reverse=to,Vn.sampleSize=function(t,e,r){return e=(r?bs(t,e,r):e===n)?1:ma(e),(Go(t)?Qn:Qr)(t,e)},Vn.set=function(t,e,n){return null==t?t:ti(t,e,n)},Vn.setWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:ti(t,e,r,i)},Vn.shuffle=function(t){return(Go(t)?tr:ri)(t)},Vn.slice=function(t,e,r){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&bs(t,e,r)?(e=0,r=i):(e=null==e?0:ma(e),r=r===n?i:ma(r)),ii(t,e,r)):[]},Vn.sortBy=To,Vn.sortedUniq=function(t){return t&&t.length?li(t):[]},Vn.sortedUniqBy=function(t,e){return t&&t.length?li(t,cs(e,2)):[]},Vn.split=function(t,e,r){return r&&"number"!=typeof r&&bs(t,e,r)&&(e=r=n),(r=r===n?f:r>>>0)?(t=_a(t))&&("string"==typeof e||null!=e&&!oa(e))&&(!(e=ui(e))&&ln(t))?wi(fn(t),0,r):t.split(e,r):[]},Vn.spread=function(t,e){if("function"!=typeof t)throw new Rt(r);return e=null==e?0:_n(ma(e),0),Zr((function(n){var r=n[e],i=wi(n,0,e);return r&&De(i,r),Ae(t,this,i)}))},Vn.tail=function(t){var e=null==t?0:t.length;return e?ii(t,1,e):[]},Vn.take=function(t,e,r){return t&&t.length?ii(t,0,(e=r||e===n?1:ma(e))<0?0:e):[]},Vn.takeRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=i-(e=r||e===n?1:ma(e)))<0?0:e,i):[]},Vn.takeRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!1,!0):[]},Vn.takeWhile=function(t,e){return t&&t.length?fi(t,cs(e,3)):[]},Vn.tap=function(t,e){return e(t),t},Vn.throttle=function(t,e,n){var i=!0,s=!0;if("function"!=typeof t)throw new Rt(r);return ea(n)&&(i="leading"in n?!!n.leading:i,s="trailing"in n?!!n.trailing:s),Lo(t,e,{leading:i,maxWait:e,trailing:s})},Vn.thru=fo,Vn.toArray=pa,Vn.toPairs=Fa,Vn.toPairsIn=Ba,Vn.toPath=function(t){return Go(t)?ke(t,zs):ca(t)?[t]:Ii(Ds(_a(t)))},Vn.toPlainObject=ya,Vn.transform=function(t,e,n){var r=Go(t),i=r||Jo(t)||ua(t);if(e=cs(e,4),null==n){var s=t&&t.constructor;n=i?r?new s:[]:ea(t)&&Ko(s)?Hn(Xt(t)):{}}return(i?Pe:xr)(t,(function(t,r,i){return e(n,t,r,i)})),n},Vn.unary=function(t){return Co(t,1)},Vn.union=eo,Vn.unionBy=no,Vn.unionWith=ro,Vn.uniq=function(t){return t&&t.length?hi(t):[]},Vn.uniqBy=function(t,e){return t&&t.length?hi(t,cs(e,2)):[]},Vn.uniqWith=function(t,e){return e="function"==typeof e?e:n,t&&t.length?hi(t,n,e):[]},Vn.unset=function(t,e){return null==t||di(t,e)},Vn.unzip=io,Vn.unzipWith=so,Vn.update=function(t,e,n){return null==t?t:pi(t,e,_i(n))},Vn.updateWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:pi(t,e,_i(r),i)},Vn.values=Va,Vn.valuesIn=function(t){return null==t?[]:tn(t,Na(t))},Vn.without=oo,Vn.words=Ka,Vn.wrap=function(t,e){return Uo(_i(e),t)},Vn.xor=ao,Vn.xorBy=lo,Vn.xorWith=co,Vn.zip=uo,Vn.zipObject=function(t,e){return vi(t||[],e||[],nr)},Vn.zipObjectDeep=function(t,e){return vi(t||[],e||[],ti)},Vn.zipWith=ho,Vn.entries=Fa,Vn.entriesIn=Ba,Vn.extend=xa,Vn.extendWith=wa,ll(Vn,Vn),Vn.add=yl,Vn.attempt=Qa,Vn.camelCase=Ha,Vn.capitalize=ja,Vn.ceil=_l,Vn.clamp=function(t,e,r){return r===n&&(r=e,e=n),r!==n&&(r=(r=va(r))===r?r:0),e!==n&&(e=(e=va(e))===e?e:0),lr(va(t),e,r)},Vn.clone=function(t){return cr(t,4)},Vn.cloneDeep=function(t){return cr(t,5)},Vn.cloneDeepWith=function(t,e){return cr(t,5,e="function"==typeof e?e:n)},Vn.cloneWith=function(t,e){return cr(t,4,e="function"==typeof e?e:n)},Vn.conformsTo=function(t,e){return null==e||ur(t,e,La(e))},Vn.deburr=Wa,Vn.defaultTo=function(t,e){return null==t||t!==t?e:t},Vn.divide=bl,Vn.endsWith=function(t,e,r){t=_a(t),e=ui(e);var i=t.length,s=r=r===n?i:lr(ma(r),0,i);return(r-=e.length)>=0&&t.slice(r,s)==e},Vn.eq=Vo,Vn.escape=function(t){return(t=_a(t))&&Z.test(t)?t.replace(J,on):t},Vn.escapeRegExp=function(t){return(t=_a(t))&&st.test(t)?t.replace(it,"\\$&"):t},Vn.every=function(t,e,r){var i=Go(t)?Re:mr;return r&&bs(t,e,r)&&(e=n),i(t,cs(e,3))},Vn.find=vo,Vn.findIndex=js,Vn.findKey=function(t,e){return Ve(t,cs(e,3),xr)},Vn.findLast=yo,Vn.findLastIndex=Ws,Vn.findLastKey=function(t,e){return Ve(t,cs(e,3),wr)},Vn.floor=xl,Vn.forEach=_o,Vn.forEachRight=bo,Vn.forIn=function(t,e){return null==t?t:_r(t,cs(e,3),Na)},Vn.forInRight=function(t,e){return null==t?t:br(t,cs(e,3),Na)},Vn.forOwn=function(t,e){return t&&xr(t,cs(e,3))},Vn.forOwnRight=function(t,e){return t&&wr(t,cs(e,3))},Vn.get=Aa,Vn.gt=Ho,Vn.gte=jo,Vn.has=function(t,e){return null!=t&&gs(t,e,Cr)},Vn.hasIn=Ca,Vn.head=qs,Vn.identity=il,Vn.includes=function(t,e,n,r){t=$o(t)?t:Va(t),n=n&&!r?ma(n):0;var i=t.length;return n<0&&(n=_n(i+n,0)),la(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&je(t,e,n)>-1},Vn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ma(n);return i<0&&(i=_n(r+i,0)),je(t,e,i)},Vn.inRange=function(t,e,r){return e=fa(e),r===n?(r=e,e=0):r=fa(r),function(t,e,n){return t>=bn(e,n)&&t<_n(e,n)}(t=va(t),e,r)},Vn.invoke=Ra,Vn.isArguments=Wo,Vn.isArray=Go,Vn.isArrayBuffer=qo,Vn.isArrayLike=$o,Vn.isArrayLikeObject=Xo,Vn.isBoolean=function(t){return!0===t||!1===t||na(t)&&Tr(t)==b},Vn.isBuffer=Jo,Vn.isDate=Yo,Vn.isElement=function(t){return na(t)&&1===t.nodeType&&!sa(t)},Vn.isEmpty=function(t){if(null==t)return!0;if($o(t)&&(Go(t)||"string"==typeof t||"function"==typeof t.splice||Jo(t)||ua(t)||Wo(t)))return!t.length;var e=ms(t);if(e==E||e==I)return!t.size;if(Ms(t))return!zr(t).length;for(var n in t)if(zt.call(t,n))return!1;return!0},Vn.isEqual=function(t,e){return Nr(t,e)},Vn.isEqualWith=function(t,e,r){var i=(r="function"==typeof r?r:n)?r(t,e):n;return i===n?Nr(t,e,n,r):!!i},Vn.isError=Zo,Vn.isFinite=function(t){return"number"==typeof t&&Be(t)},Vn.isFunction=Ko,Vn.isInteger=Qo,Vn.isLength=ta,Vn.isMap=ra,Vn.isMatch=function(t,e){return t===e||Or(t,e,hs(e))},Vn.isMatchWith=function(t,e,r){return r="function"==typeof r?r:n,Or(t,e,hs(e),r)},Vn.isNaN=function(t){return ia(t)&&t!=+t},Vn.isNative=function(t){if(Ss(t))throw new Et("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return kr(t)},Vn.isNil=function(t){return null==t},Vn.isNull=function(t){return null===t},Vn.isNumber=ia,Vn.isObject=ea,Vn.isObjectLike=na,Vn.isPlainObject=sa,Vn.isRegExp=oa,Vn.isSafeInteger=function(t){return Qo(t)&&t>=-d&&t<=d},Vn.isSet=aa,Vn.isString=la,Vn.isSymbol=ca,Vn.isTypedArray=ua,Vn.isUndefined=function(t){return t===n},Vn.isWeakMap=function(t){return na(t)&&ms(t)==N},Vn.isWeakSet=function(t){return na(t)&&"[object WeakSet]"==Tr(t)},Vn.join=function(t,e){return null==t?"":Xe.call(t,e)},Vn.kebabCase=Ga,Vn.last=Ys,Vn.lastIndexOf=function(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i;return r!==n&&(s=(s=ma(r))<0?_n(i+s,0):bn(s,i-1)),e===e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,s):He(t,Ge,s,!0)},Vn.lowerCase=qa,Vn.lowerFirst=$a,Vn.lt=ha,Vn.lte=da,Vn.max=function(t){return t&&t.length?gr(t,il,Ar):n},Vn.maxBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Ar):n},Vn.mean=function(t){return qe(t,il)},Vn.meanBy=function(t,e){return qe(t,cs(e,2))},Vn.min=function(t){return t&&t.length?gr(t,il,Fr):n},Vn.minBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Fr):n},Vn.stubArray=gl,Vn.stubFalse=vl,Vn.stubObject=function(){return{}},Vn.stubString=function(){return""},Vn.stubTrue=function(){return!0},Vn.multiply=wl,Vn.nth=function(t,e){return t&&t.length?Wr(t,ma(e)):n},Vn.noConflict=function(){return me._===this&&(me._=Ht),this},Vn.noop=cl,Vn.now=Ao,Vn.pad=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Gi(ve(i),n)+t+Gi(ge(i),n)},Vn.padEnd=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;return e&&r<e?t+Gi(e-r,n):t},Vn.padStart=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;return e&&r<e?Gi(e-r,n)+t:t},Vn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),wn(_a(t).replace(ot,""),e||0)},Vn.random=function(t,e,r){if(r&&"boolean"!=typeof r&&bs(t,e,r)&&(e=r=n),r===n&&("boolean"==typeof e?(r=e,e=n):"boolean"==typeof t&&(r=t,t=n)),t===n&&e===n?(t=0,e=1):(t=fa(t),e===n?(e=t,t=0):e=fa(e)),t>e){var i=t;t=e,e=i}if(r||t%1||e%1){var s=Sn();return bn(t+s*(e-t+he("1e-"+((s+"").length-1))),e)}return Jr(t,e)},Vn.reduce=function(t,e,n){var r=Go(t)?ze:Je,i=arguments.length<3;return r(t,cs(e,4),n,i,pr)},Vn.reduceRight=function(t,e,n){var r=Go(t)?Ue:Je,i=arguments.length<3;return r(t,cs(e,4),n,i,fr)},Vn.repeat=function(t,e,r){return e=(r?bs(t,e,r):e===n)?1:ma(e),Yr(_a(t),e)},Vn.replace=function(){var t=arguments,e=_a(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Vn.result=function(t,e,r){var i=-1,s=(e=bi(e,t)).length;for(s||(s=1,t=n);++i<s;){var o=null==t?n:t[zs(e[i])];o===n&&(i=s,o=r),t=Ko(o)?o.call(t):o}return t},Vn.round=Sl,Vn.runInContext=t,Vn.sample=function(t){return(Go(t)?Kn:Kr)(t)},Vn.size=function(t){if(null==t)return 0;if($o(t))return la(t)?pn(t):t.length;var e=ms(t);return e==E||e==I?t.size:zr(t).length},Vn.snakeCase=Xa,Vn.some=function(t,e,r){var i=Go(t)?Fe:si;return r&&bs(t,e,r)&&(e=n),i(t,cs(e,3))},Vn.sortedIndex=function(t,e){return oi(t,e)},Vn.sortedIndexBy=function(t,e,n){return ai(t,e,cs(n,2))},Vn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=oi(t,e);if(r<n&&Vo(t[r],e))return r}return-1},Vn.sortedLastIndex=function(t,e){return oi(t,e,!0)},Vn.sortedLastIndexBy=function(t,e,n){return ai(t,e,cs(n,2),!0)},Vn.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=oi(t,e,!0)-1;if(Vo(t[n],e))return n}return-1},Vn.startCase=Ja,Vn.startsWith=function(t,e,n){return t=_a(t),n=null==n?0:lr(ma(n),0,t.length),e=ui(e),t.slice(n,n+e.length)==e},Vn.subtract=Ml,Vn.sum=function(t){return t&&t.length?Ye(t,il):0},Vn.sumBy=function(t,e){return t&&t.length?Ye(t,cs(e,2)):0},Vn.template=function(t,e,r){var i=Vn.templateSettings;r&&bs(t,e,r)&&(e=n),t=_a(t),e=wa({},e,i,Qi);var s,o,a=wa({},e.imports,i.imports,Qi),l=La(a),c=tn(a,l),u=0,h=e.interpolate||wt,d="__p += '",p=Pt((e.escape||wt).source+"|"+h.source+"|"+(h===tt?ft:wt).source+"|"+(e.evaluate||wt).source+"|$","g"),f="//# sourceURL="+(zt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ae+"]")+"\n";t.replace(p,(function(e,n,r,i,a,l){return r||(r=i),d+=t.slice(u,l).replace(St,an),n&&(s=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+e.length,e})),d+="';\n";var m=zt.call(e,"variable")&&e.variable;if(m){if(dt.test(m))throw new Et("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(G,""):d).replace(q,"$1").replace($,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Qa((function(){return Tt(l,f+"return "+d).apply(n,c)}));if(g.source=d,Zo(g))throw g;return g},Vn.times=function(t,e){if((t=ma(t))<1||t>d)return[];var n=f,r=bn(t,f);e=cs(e),t-=f;for(var i=Ze(r,e);++n<t;)e(n);return i},Vn.toFinite=fa,Vn.toInteger=ma,Vn.toLength=ga,Vn.toLower=function(t){return _a(t).toLowerCase()},Vn.toNumber=va,Vn.toSafeInteger=function(t){return t?lr(ma(t),-d,d):0===t?t:0},Vn.toString=_a,Vn.toUpper=function(t){return _a(t).toUpperCase()},Vn.trim=function(t,e,r){if((t=_a(t))&&(r||e===n))return Ke(t);if(!t||!(e=ui(e)))return t;var i=fn(t),s=fn(e);return wi(i,nn(i,s),rn(i,s)+1).join("")},Vn.trimEnd=function(t,e,r){if((t=_a(t))&&(r||e===n))return t.slice(0,mn(t)+1);if(!t||!(e=ui(e)))return t;var i=fn(t);return wi(i,0,rn(i,fn(e))+1).join("")},Vn.trimStart=function(t,e,r){if((t=_a(t))&&(r||e===n))return t.replace(ot,"");if(!t||!(e=ui(e)))return t;var i=fn(t);return wi(i,nn(i,fn(e))).join("")},Vn.truncate=function(t,e){var r=30,i="...";if(ea(e)){var s="separator"in e?e.separator:s;r="length"in e?ma(e.length):r,i="omission"in e?ui(e.omission):i}var o=(t=_a(t)).length;if(ln(t)){var a=fn(t);o=a.length}if(r>=o)return t;var l=r-pn(i);if(l<1)return i;var c=a?wi(a,0,l).join(""):t.slice(0,l);if(s===n)return c+i;if(a&&(l+=c.length-l),oa(s)){if(t.slice(l).search(s)){var u,h=c;for(s.global||(s=Pt(s.source,_a(mt.exec(s))+"g")),s.lastIndex=0;u=s.exec(h);)var d=u.index;c=c.slice(0,d===n?l:d)}}else if(t.indexOf(ui(s),l)!=l){var p=c.lastIndexOf(s);p>-1&&(c=c.slice(0,p))}return c+i},Vn.unescape=function(t){return(t=_a(t))&&Y.test(t)?t.replace(X,gn):t},Vn.uniqueId=function(t){var e=++Ut;return _a(t)+e},Vn.upperCase=Ya,Vn.upperFirst=Za,Vn.each=_o,Vn.eachRight=bo,Vn.first=qs,ll(Vn,function(){var t={};return xr(Vn,(function(e,n){zt.call(Vn.prototype,n)||(t[n]=e)})),t}(),{chain:!1}),Vn.VERSION="4.17.21",Pe(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Vn[t].placeholder=Vn})),Pe(["drop","take"],(function(t,e){Gn.prototype[t]=function(r){r=r===n?1:_n(ma(r),0);var i=this.__filtered__&&!e?new Gn(this):this.clone();return i.__filtered__?i.__takeCount__=bn(r,i.__takeCount__):i.__views__.push({size:bn(r,f),type:t+(i.__dir__<0?"Right":"")}),i},Gn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Pe(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Gn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:cs(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),Pe(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Gn.prototype[t]=function(){return this[n](1).value()[0]}})),Pe(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Gn.prototype[t]=function(){return this.__filtered__?new Gn(this):this[n](1)}})),Gn.prototype.compact=function(){return this.filter(il)},Gn.prototype.find=function(t){return this.filter(t).head()},Gn.prototype.findLast=function(t){return this.reverse().find(t)},Gn.prototype.invokeMap=Zr((function(t,e){return"function"==typeof t?new Gn(this):this.map((function(n){return Rr(n,t,e)}))})),Gn.prototype.reject=function(t){return this.filter(Do(cs(t)))},Gn.prototype.slice=function(t,e){t=ma(t);var r=this;return r.__filtered__&&(t>0||e<0)?new Gn(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==n&&(r=(e=ma(e))<0?r.dropRight(-e):r.take(e-t)),r)},Gn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Gn.prototype.toArray=function(){return this.take(f)},xr(Gn.prototype,(function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),s=Vn[i?"take"+("last"==e?"Right":""):e],o=i||/^find/.test(e);s&&(Vn.prototype[e]=function(){var e=this.__wrapped__,a=i?[1]:arguments,l=e instanceof Gn,c=a[0],u=l||Go(e),h=function(t){var e=s.apply(Vn,De([t],a));return i&&d?e[0]:e};u&&r&&"function"==typeof c&&1!=c.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,f=o&&!d,m=l&&!p;if(!o&&u){e=m?e:new Gn(this);var g=t.apply(e,a);return g.__actions__.push({func:fo,args:[h],thisArg:n}),new Wn(g,d)}return f&&m?t.apply(this,a):(g=this.thru(h),f?i?g.value()[0]:g.value():g)})})),Pe(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Lt[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Vn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Go(i)?i:[],t)}return this[n]((function(n){return e.apply(Go(n)?n:[],t)}))}})),xr(Gn.prototype,(function(t,e){var n=Vn[e];if(n){var r=n.name+"";zt.call(Ln,r)||(Ln[r]=[]),Ln[r].push({name:e,func:n})}})),Ln[Vi(n,2).name]=[{name:"wrapper",func:n}],Gn.prototype.clone=function(){var t=new Gn(this.__wrapped__);return t.__actions__=Ii(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ii(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ii(this.__views__),t},Gn.prototype.reverse=function(){if(this.__filtered__){var t=new Gn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Gn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Go(t),r=e<0,i=n?t.length:0,s=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var s=n[r],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=bn(e,t+o);break;case"takeRight":t=_n(t,e-o)}}return{start:t,end:e}}(0,i,this.__views__),o=s.start,a=s.end,l=a-o,c=r?a:o-1,u=this.__iteratees__,h=u.length,d=0,p=bn(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return mi(t,this.__actions__);var f=[];t:for(;l--&&d<p;){for(var m=-1,g=t[c+=e];++m<h;){var v=u[m],y=v.iteratee,_=v.type,b=y(g);if(2==_)g=b;else if(!b){if(1==_)continue t;break t}}f[d++]=g}return f},Vn.prototype.at=mo,Vn.prototype.chain=function(){return po(this)},Vn.prototype.commit=function(){return new Wn(this.value(),this.__chain__)},Vn.prototype.next=function(){this.__values__===n&&(this.__values__=pa(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?n:this.__values__[this.__index__++]}},Vn.prototype.plant=function(t){for(var e,r=this;r instanceof jn;){var i=Fs(r);i.__index__=0,i.__values__=n,e?s.__wrapped__=i:e=i;var s=i;r=r.__wrapped__}return s.__wrapped__=t,e},Vn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Gn){var e=t;return this.__actions__.length&&(e=new Gn(this)),(e=e.reverse()).__actions__.push({func:fo,args:[to],thisArg:n}),new Wn(e,this.__chain__)}return this.thru(to)},Vn.prototype.toJSON=Vn.prototype.valueOf=Vn.prototype.value=function(){return mi(this.__wrapped__,this.__actions__)},Vn.prototype.first=Vn.prototype.head,Qt&&(Vn.prototype[Qt]=function(){return this}),Vn}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(me._=vn,define((function(){return vn}))):ve?((ve.exports=vn)._=vn,ge._=vn):me._=vn}).call(t)})),Xn=Gn(((t,e)=>{var n=1e3,r=60*n,i=60*r,s=24*i,o=7*s,a=365.25*s;function l(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}e.exports=function(t,e){e=e||{};var c=typeof t;if("string"===c&&t.length>0)return function(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var l=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*a;case"weeks":case"week":case"w":return l*o;case"days":case"day":case"d":return l*s;case"hours":case"hour":case"hrs":case"hr":case"h":return l*i;case"minutes":case"minute":case"mins":case"min":case"m":return l*r;case"seconds":case"second":case"secs":case"sec":case"s":return l*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}(t);if("number"===c&&isFinite(t))return e.long?function(t){var e=Math.abs(t);return e>=s?l(t,e,s,"day"):e>=i?l(t,e,i,"hour"):e>=r?l(t,e,r,"minute"):e>=n?l(t,e,n,"second"):t+" ms"}(t):function(t){var e=Math.abs(t);return e>=s?Math.round(t/s)+"d":e>=i?Math.round(t/i)+"h":e>=r?Math.round(t/r)+"m":e>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}})),Jn=Gn(((t,e)=>{e.exports=function(t){function e(t){let r,i,s,o=null;function a(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!a.enabled)return;let s=a,o=Number(new Date),l=o-(r||o);s.diff=l,s.prev=r,s.curr=o,r=o,n[0]=e.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");let c=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,((t,r)=>{if("%%"===t)return"%";c++;let i=e.formatters[r];if("function"==typeof i){let e=n[c];t=i.call(s,e),n.splice(c,1),c--}return t})),e.formatArgs.call(s,n),(s.log||e.log).apply(s,n)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=n,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function n(t,n){let r=e(this.namespace+(typeof n>"u"?":":n)+t);return r.log=this.log,r}function r(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){let t=[...e.names.map(r),...e.skips.map(r).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){e.save(t),e.namespaces=t,e.names=[],e.skips=[];let n,r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=Xn(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e}})),Yn=Gn(((t,e)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch{}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:"/react-elden-ring-mind-map",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUPA_ANON:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdiZHlydXJ6eXlmbXVvYmVja2l0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjkzMzAyNDcsImV4cCI6MjA0NDkwNjI0N30.s5aKdX6BdWojAewKoJwCcvBVzCHJumwbe8cok9Z0yv4",REACT_APP_SUPA_URL:"https://gbdyrurzyyfmuobeckit.supabase.co",REACT_APP_SUPVIZ:"96ai280e79vr8qgpw42kk8gj7gixre"}.DEBUG),e},t.useColors=function(){if(typeof window<"u"&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch{}}(),t.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=Jn()(t);var{formatters:n}=e.exports;n.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),Zn=Gn(((t,e)=>{e.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}})),Kn=Gn(((t,e)=>{var n="object"==typeof window&&window&&window.Object===Object&&window;e.exports=n})),Qn=Gn(((t,e)=>{var n=Kn(),r="object"==typeof self&&self&&self.Object===Object&&self,i=n||r||Function("return this")();e.exports=i})),tr=Gn(((t,e)=>{var n=Qn();e.exports=function(){return n.Date.now()}})),er=Gn(((t,e)=>{var n=/\s/;e.exports=function(t){for(var e=t.length;e--&&n.test(t.charAt(e)););return e}})),nr=Gn(((t,e)=>{var n=er(),r=/^\s+/;e.exports=function(t){return t&&t.slice(0,n(t)+1).replace(r,"")}})),rr=Gn(((t,e)=>{var n=Qn().Symbol;e.exports=n})),ir=Gn(((t,e)=>{var n=rr(),r=Object.prototype,i=r.hasOwnProperty,s=r.toString,o=n?n.toStringTag:void 0;e.exports=function(t){var e=i.call(t,o),n=t[o];try{t[o]=void 0;var r=!0}catch{}var a=s.call(t);return r&&(e?t[o]=n:delete t[o]),a}})),sr=Gn(((t,e)=>{var n=Object.prototype.toString;e.exports=function(t){return n.call(t)}})),or=Gn(((t,e)=>{var n=rr(),r=ir(),i=sr(),s=n?n.toStringTag:void 0;e.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":s&&s in Object(t)?r(t):i(t)}})),ar=Gn(((t,e)=>{e.exports=function(t){return null!=t&&"object"==typeof t}})),lr=Gn(((t,e)=>{var n=or(),r=ar();e.exports=function(t){return"symbol"==typeof t||r(t)&&"[object Symbol]"==n(t)}})),cr=Gn(((t,e)=>{var n=nr(),r=Zn(),i=lr(),s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,a=/^0o[0-7]+$/i,l=parseInt;e.exports=function(t){if("number"==typeof t)return t;if(i(t))return NaN;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=n(t);var c=o.test(t);return c||a.test(t)?l(t.slice(2),c?2:8):s.test(t)?NaN:+t}})),ur=Gn(((t,e)=>{var n=Zn(),r=tr(),i=cr(),s=Math.max,o=Math.min;e.exports=function(t,e,a){var l,c,u,h,d,p,f=0,m=!1,g=!1,v=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var n=l,r=c;return l=c=void 0,f=e,h=t.apply(r,n)}function _(t){var n=t-p;return void 0===p||n>=e||n<0||g&&t-f>=u}function b(){var t=r();if(_(t))return x(t);d=setTimeout(b,function(t){var n=e-(t-p);return g?o(n,u-(t-f)):n}(t))}function x(t){return d=void 0,v&&l?y(t):(l=c=void 0,h)}function w(){var t=r(),n=_(t);if(l=arguments,c=this,p=t,n){if(void 0===d)return function(t){return f=t,d=setTimeout(b,e),m?y(t):h}(p);if(g)return clearTimeout(d),d=setTimeout(b,e),y(p)}return void 0===d&&(d=setTimeout(b,e)),h}return e=i(e)||0,n(a)&&(m=!!a.leading,u=(g="maxWait"in a)?s(i(a.maxWait)||0,e):u,v="trailing"in a?!!a.trailing:v),w.cancel=function(){void 0!==d&&clearTimeout(d),f=0,l=p=c=d=void 0},w.flush=function(){return void 0===d?h:x(r())},w}})),hr=Gn(((t,e)=>{var n=ur(),r=Zn();e.exports=function(t,e,i){var s=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return r(i)&&(s="leading"in i?!!i.leading:s,o="trailing"in i?!!i.trailing:o),n(t,e,{leading:s,maxWait:e,trailing:o})}})),dr=qn($n()),pr="139",fr=100,mr=101,gr=102,vr=200,yr=201,_r=202,br=203,xr=204,wr=205,Sr=206,Mr=207,Er=208,Tr=209,Ar=210,Cr=301,Pr=302,Ir=306,Rr=1e3,Lr=1001,Nr=1002,Or=1003,kr=1004,Dr=1005,zr=1006,Ur=1007,Fr=1008,Br=1009,Vr=1012,Hr=1014,jr=1015,Wr=1016,Gr=1020,qr=1023,$r=1026,Xr=1027,Jr=33776,Yr=33777,Zr=33778,Kr=33779,Qr=2300,ti=2301,ei=2302,ni=2400,ri=2401,ii=2402,si=2500,oi=3e3,ai=3001,li="srgb",ci="srgb-linear",ui=7680,hi=35044,di=35048,pi="300 es",fi=1035,mi=class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});let n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;let n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;let n=this._listeners[t];if(void 0!==n){let t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;let e=this._listeners[t.type];if(void 0!==e){t.target=this;let n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t);t.target=null}}},gi=[];for(let n=0;n<256;n++)gi[n]=(n<16?"0":"")+n.toString(16);var vi=Math.PI/180,yi=180/Math.PI;function _i(){let t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(gi[255&t]+gi[t>>8&255]+gi[t>>16&255]+gi[t>>24&255]+"-"+gi[255&e]+gi[e>>8&255]+"-"+gi[e>>16&15|64]+gi[e>>24&255]+"-"+gi[63&n|128]+gi[n>>8&255]+"-"+gi[n>>16&255]+gi[n>>24&255]+gi[255&r]+gi[r>>8&255]+gi[r>>16&255]+gi[r>>24&255]).toLowerCase()}function bi(t,e,n){return Math.max(e,Math.min(n,t))}function xi(t,e,n){return(1-n)*t+n*e}function wi(t){return 0===(t&t-1)&&0!==t}function Si(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Mi=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};Mi.prototype.isVector2=!0;var Ei=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,s,o,a,l){let c=this.elements;return c[0]=t,c[1]=r,c[2]=o,c[3]=e,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],_=r[7],b=r[2],x=r[5],w=r[8];return i[0]=s*f+o*v+a*b,i[3]=s*m+o*y+a*x,i[6]=s*g+o*_+a*w,i[1]=l*f+c*v+u*b,i[4]=l*m+c*y+u*x,i[7]=l*g+c*_+u*w,i[2]=h*f+d*v+p*b,i[5]=h*m+d*y+p*x,i[8]=h*g+d*_+p*w,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*i*c+n*o*a+r*i*l-r*s*a}invert(){let t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=c*s-o*l,h=o*a-c*i,d=l*i-s*a,p=e*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return t[0]=u*f,t[1]=(r*l-c*n)*f,t[2]=(o*n-r*s)*f,t[3]=h*f,t[4]=(c*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){let a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){let n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){let e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],s=r[3],o=r[6],a=r[1],l=r[4],c=r[7];return r[0]=e*i+n*a,r[3]=e*s+n*l,r[6]=e*o+n*c,r[1]=-n*i+e*a,r[4]=-n*s+e*l,r[7]=-n*o+e*c,this}translate(t,e){let n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){let e=this.elements,n=t.elements;for(let r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}};function Ti(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}function Ai(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Ci(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Pi(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}Ei.prototype.isMatrix3=!0;var Ii={[li]:{[ci]:Ci},[ci]:{[li]:Pi}},Ri={legacyMode:!0,get workingColorSpace(){return ci},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,n){if(this.legacyMode||e===n||!e||!n)return t;if(Ii[e]&&void 0!==Ii[e][n]){let r=Ii[e][n];return t.r=r(t.r),t.g=r(t.g),t.b=r(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},Li={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ni={r:0,g:0,b:0},Oi={h:0,s:0,l:0},ki={h:0,s:0,l:0};function Di(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function zi(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}var Ui=class{constructor(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:li;return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Ri.toWorkingColorSpace(this,e),this}setRGB(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ci;return this.r=t,this.g=e,this.b=n,Ri.toWorkingColorSpace(this,r),this}setHSL(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ci;if(t=function(t,e){return(t%e+e)%e}(t,1),e=bi(e,0,1),n=bi(n,0,1),0===e)this.r=this.g=this.b=n;else{let r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=Di(i,r,t+1/3),this.g=Di(i,r,t),this.b=Di(i,r,t-1/3)}return Ri.toWorkingColorSpace(this,r),this}setStyle(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:li;function r(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(e=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t,i=e[1],s=e[2];switch(i){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,Ri.toWorkingColorSpace(this,n),r(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,Ri.toWorkingColorSpace(this,n),r(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){let e=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,s=parseInt(t[3],10)/100;return r(t[4]),this.setHSL(e,i,s,n)}}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(t)){let t=e[1],r=t.length;if(3===r)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,Ri.toWorkingColorSpace(this,n),this;if(6===r)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,Ri.toWorkingColorSpace(this,n),this}return t&&t.length>0?this.setColorName(t,n):this}setColorName(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:li,n=Li[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ci(t.r),this.g=Ci(t.g),this.b=Ci(t.b),this}copyLinearToSRGB(t){return this.r=Pi(t.r),this.g=Pi(t.g),this.b=Pi(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:li;return Ri.fromWorkingColorSpace(zi(this,Ni),t),bi(255*Ni.r,0,255)<<16^bi(255*Ni.g,0,255)<<8^bi(255*Ni.b,0,255)}getHexString(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:li;return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ci;Ri.fromWorkingColorSpace(zi(this,Ni),e);let n,r,i=Ni.r,s=Ni.g,o=Ni.b,a=Math.max(i,s,o),l=Math.min(i,s,o),c=(l+a)/2;if(l===a)n=0,r=0;else{let t=a-l;switch(r=c<=.5?t/(a+l):t/(2-a-l),a){case i:n=(s-o)/t+(s<o?6:0);break;case s:n=(o-i)/t+2;break;case o:n=(i-s)/t+4}n/=6}return t.h=n,t.s=r,t.l=c,t}getRGB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ci;return Ri.fromWorkingColorSpace(zi(this,Ni),e),t.r=Ni.r,t.g=Ni.g,t.b=Ni.b,t}getStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:li;return Ri.fromWorkingColorSpace(zi(this,Ni),t),t!==li?`color(${t} ${Ni.r} ${Ni.g} ${Ni.b})`:`rgb(${255*Ni.r|0},${255*Ni.g|0},${255*Ni.b|0})`}offsetHSL(t,e,n){return this.getHSL(Oi),Oi.h+=t,Oi.s+=e,Oi.l+=n,this.setHSL(Oi.h,Oi.s,Oi.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Oi),t.getHSL(ki);let n=xi(Oi.h,ki.h,e),r=xi(Oi.s,ki.s,e),i=xi(Oi.l,ki.l,e);return this.setHSL(n,r,i),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};Ui.NAMES=Li,Ui.prototype.isColor=!0,Ui.prototype.r=1,Ui.prototype.g=1,Ui.prototype.b=1;var Fi,Bi=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Fi&&(Fi=Ai("canvas")),Fi.width=t.width,Fi.height=t.height;let n=Fi.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Fi}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let e=Ai("canvas");e.width=t.width,e.height=t.height;let n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);let r=n.getImageData(0,0,t.width,t.height),i=r.data;for(let t=0;t<i.length;t++)i[t]=255*Ci(i[t]/255);return n.putImageData(r,0,0),e}if(t.data){let e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Ci(e[t]/255)):e[t]=Ci(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},Vi=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.uuid=_i(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){let e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];let n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(Hi(r[e].image)):t.push(Hi(r[e]))}else t=Hi(r);n.url=t}return e||(t.images[this.uuid]=n),n}};function Hi(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?Bi.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Vi.prototype.isSource=!0;var ji=0,Wi=class t extends mi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.DEFAULT_IMAGE,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.DEFAULT_MAPPING,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Lr,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Lr,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:zr,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Fr,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:qr,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Br,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:oi;super(),Object.defineProperty(this,"id",{value:ji++}),this.uuid=_i(),this.name="",this.source=new Vi(e),this.mipmaps=[],this.mapping=n,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Mi(0,0),this.repeat=new Mi(1,1),this.center=new Mi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ei,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];let n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Rr:t.x=t.x-Math.floor(t.x);break;case Lr:t.x=t.x<0?0:1;break;case Nr:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Rr:t.y=t.y-Math.floor(t.y);break;case Lr:t.y=t.y<0?0:1;break;case Nr:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}};Wi.DEFAULT_IMAGE=null,Wi.DEFAULT_MAPPING=300,Wi.prototype.isTexture=!0;var Gi=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i,s=t.elements,o=s[0],a=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(o+u+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let t=(o+1)/2,s=(u+1)/2,m=(f+1)/2,g=(a+c)/4,v=(l+d)/4,y=(h+p)/4;return t>s&&t>m?t<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=g/n,i=v/n):s>m?s<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=g/r,i=y/r):m<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(m),n=v/i,r=y/i),this.set(n,r,i,e),this}let m=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(m)<.001&&(m=1),this.x=(p-h)/m,this.y=(l-d)/m,this.z=(c-a)/m,this.w=Math.acos((o+u+f-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};Gi.prototype.isVector4=!0;var qi=class extends mi{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Gi(0,0,t,e),this.scissorTest=!1,this.viewport=new Gi(0,0,t,e);let r={width:t,height:e,depth:1};this.texture=new Wi(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:zr,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;(this.width!==t||this.height!==e||this.depth!==n)&&(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},t.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}};qi.prototype.isWebGLRenderTarget=!0;var $i=class extends Wi{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=Or,this.minFilter=Or,this.wrapR=Lr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};$i.prototype.isDataArrayTexture=!0;(class extends qi{constructor(t,e,n){super(t,e),this.depth=n,this.texture=new $i(null,t,e,n),this.texture.isRenderTargetTexture=!0}}).prototype.isWebGLArrayRenderTarget=!0;var Xi=class extends Wi{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.image={data:t,width:e,height:n,depth:r},this.magFilter=Or,this.minFilter=Or,this.wrapR=Lr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};Xi.prototype.isData3DTexture=!0;(class extends qi{constructor(t,e,n){super(t,e),this.depth=n,this.texture=new Xi(null,t,e,n),this.texture.isRenderTargetTexture=!0}}).prototype.isWebGL3DRenderTarget=!0;(class extends qi{constructor(t,e,n){super(t,e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{});let r=this.texture;this.texture=[];for(let i=0;i<n;i++)this.texture[i]=r.clone(),this.texture[i].isRenderTargetTexture=!0}setSize(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=t,this.texture[r].image.height=e,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone();return this}}).prototype.isWebGLMultipleRenderTargets=!0;var Ji=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,r)}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],h=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===o)return t[e+0]=h,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(u!==f||a!==h||l!==d||c!==p){let t=1-o,e=a*h+l*d+c*p+u*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){let i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}let i=o*n;if(a=a*t+h*i,l=l*t+d*i,c=c*t+p*i,u=u*t+f*i,t===1-o){let t=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=t,l*=t,c*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,r,i,s){let o=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[s],h=i[s+1],d=i[s+2],p=i[s+3];return t[e]=o*p+c*u+a*d-l*h,t[e+1]=a*p+c*h+l*u-o*d,t[e+2]=l*p+c*d+o*h-a*u,t[e+3]=c*p-o*u-a*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){let t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>u){let t=2*Math.sqrt(1+n-o-u);this._w=(c-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>u){let t=2*Math.sqrt(1+o-n-u);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+c)/t}else{let t=2*Math.sqrt(1+u-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(bi(this.dot(t),-1,1)))}rotateTowards(t,e){let n=this.angleTo(t);if(0===n)return this;let r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+r*l-i*a,this._y=r*c+s*a+i*o-n*l,this._z=i*c+s*l+n*a-r*o,this._w=s*c-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);let n=this._x,r=this._y,i=this._z,s=this._w,o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;let a=1-o*o;if(a<=Number.EPSILON){let t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){let t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(e*Math.cos(r),n*Math.sin(i),n*Math.cos(i),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}};Ji.prototype.isQuaternion=!0;var Yi=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Ki.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Ki.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){let e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*r-o*n,c=a*n+o*e-i*r,u=a*r+i*n-s*e,h=-i*e-s*n-o*r;return this.x=l*a+h*-i+c*-o-u*-s,this.y=c*a+h*-s+u*-i-l*-o,this.z=u*a+h*-o+l*-s-c*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){let n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){let e=t.lengthSq();if(0===e)return this.set(0,0,0);let n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Zi.copy(this).projectOnVector(t),this.sub(Zi)}reflect(t){return this.sub(Zi.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(bi(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){let r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};Yi.prototype.isVector3=!0;var Zi=new Yi,Ki=new Ji,Qi=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yi(1/0,1/0,1/0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yi(-1/0,-1/0,-1/0);this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){let l=t[a],c=t[a+1],u=t[a+2];l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this}setFromBufferAttribute(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){let l=t.getX(a),c=t.getY(a),u=t.getZ(a);l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let n=es.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.updateWorldMatrix(!1,!1);let n=t.geometry;if(void 0!==n)if(e&&null!=n.attributes&&void 0!==n.attributes.position){let e=n.attributes.position;for(let n=0,r=e.count;n<r;n++)es.fromBufferAttribute(e,n).applyMatrix4(t.matrixWorld),this.expandByPoint(es)}else null===n.boundingBox&&n.computeBoundingBox(),ns.copy(n.boundingBox),ns.applyMatrix4(t.matrixWorld),this.union(ns);let r=t.children;for(let i=0,s=r.length;i<s;i++)this.expandByObject(r[i],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,es),es.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(cs),us.subVectors(this.max,cs),rs.subVectors(t.a,cs),is.subVectors(t.b,cs),ss.subVectors(t.c,cs),os.subVectors(is,rs),as.subVectors(ss,is),ls.subVectors(rs,ss);let e=[0,-os.z,os.y,0,-as.z,as.y,0,-ls.z,ls.y,os.z,0,-os.x,as.z,0,-as.x,ls.z,0,-ls.x,-os.y,os.x,0,-as.y,as.x,0,-ls.y,ls.x,0];return!(!ps(e,rs,is,ss,us)||(e=[1,0,0,0,1,0,0,0,1],!ps(e,rs,is,ss,us)))&&(hs.crossVectors(os,as),e=[hs.x,hs.y,hs.z],ps(e,rs,is,ss,us))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return es.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(es).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(ts[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ts[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ts[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ts[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ts[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ts[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ts[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ts[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ts)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}};Qi.prototype.isBox3=!0;var ts=[new Yi,new Yi,new Yi,new Yi,new Yi,new Yi,new Yi,new Yi],es=new Yi,ns=new Qi,rs=new Yi,is=new Yi,ss=new Yi,os=new Yi,as=new Yi,ls=new Yi,cs=new Yi,us=new Yi,hs=new Yi,ds=new Yi;function ps(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){ds.fromArray(t,s);let o=i.x*Math.abs(ds.x)+i.y*Math.abs(ds.y)+i.z*Math.abs(ds.z),a=e.dot(ds),l=n.dot(ds),c=r.dot(ds);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}var fs=new Qi,ms=new Yi,gs=new Yi,vs=new Yi,ys=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yi,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let n=this.center;void 0!==e?n.copy(e):fs.setFromPoints(t).getCenter(n);let r=0;for(let i=0,s=t.length;i<s;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){vs.subVectors(t,this.center);let e=vs.lengthSq();if(e>this.radius*this.radius){let t=Math.sqrt(e),n=.5*(t-this.radius);this.center.add(vs.multiplyScalar(n/t)),this.radius+=n}return this}union(t){return!0===this.center.equals(t.center)?gs.set(0,0,1).multiplyScalar(t.radius):gs.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(ms.copy(t.center).add(gs)),this.expandByPoint(ms.copy(t.center).sub(gs)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}},_s=new Yi,bs=new Yi,xs=new Yi,ws=new Yi,Ss=new Yi,Ms=new Yi,Es=new Yi,Ts=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yi,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yi(0,0,-1);this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,_s)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);let n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){let e=_s.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(_s.copy(this.direction).multiplyScalar(e).add(this.origin),_s.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){bs.copy(t).add(e).multiplyScalar(.5),xs.copy(e).sub(t).normalize(),ws.copy(this.origin).sub(bs);let i,s,o,a,l=.5*t.distanceTo(e),c=-this.direction.dot(xs),u=ws.dot(this.direction),h=-ws.dot(xs),d=ws.lengthSq(),p=Math.abs(1-c*c);if(p>0)if(i=c*h-u,s=c*u-h,a=l*p,i>=0)if(s>=-a)if(s<=a){let t=1/p;i*=t,s*=t,o=i*(i+c*s+2*u)+s*(c*i+s+2*h)+d}else s=l,i=Math.max(0,-(c*s+u)),o=-i*i+s*(s+2*h)+d;else s=-l,i=Math.max(0,-(c*s+u)),o=-i*i+s*(s+2*h)+d;else s<=-a?(i=Math.max(0,-(-c*l+u)),s=i>0?-l:Math.min(Math.max(-l,-h),l),o=-i*i+s*(s+2*h)+d):s<=a?(i=0,s=Math.min(Math.max(-l,-h),l),o=s*(s+2*h)+d):(i=Math.max(0,-(c*l+u)),s=i>0?l:Math.min(Math.max(-l,-h),l),o=-i*i+s*(s+2*h)+d);else s=c>0?-l:l,i=Math.max(0,-(c*s+u)),o=-i*i+s*(s+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(xs).multiplyScalar(s).add(bs),o}intersectSphere(t,e){_s.subVectors(t.center,this.origin);let n=_s.dot(this.direction),r=_s.dot(_s)-n*n,i=t.radius*t.radius;if(r>i)return null;let s=Math.sqrt(i-r),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){let e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;let n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){let n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){let e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,s,o,a,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),n>s||i>r||((i>n||n!==n)&&(n=i),(s<r||r!==r)&&(r=s),u>=0?(o=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||o>r)||((o>n||n!==n)&&(n=o),(a<r||r!==r)&&(r=a),r<0)?null:this.at(n>=0?n:r,e)}intersectsBox(t){return null!==this.intersectBox(t,_s)}intersectTriangle(t,e,n,r,i){Ss.subVectors(e,t),Ms.subVectors(n,t),Es.crossVectors(Ss,Ms);let s,o=this.direction.dot(Es);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}ws.subVectors(this.origin,t);let a=s*this.direction.dot(Ms.crossVectors(ws,Ms));if(a<0)return null;let l=s*this.direction.dot(Ss.cross(ws));if(l<0||a+l>o)return null;let c=-s*ws.dot(Es);return c<0?null:this.at(c/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},As=class t{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,s,o,a,l,c,u,h,d,p,f,m){let g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new t).fromArray(this.elements)}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){let e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,n=t.elements,r=1/Cs.setFromMatrixColumn(t,0).length(),i=1/Cs.setFromMatrixColumn(t,1).length(),s=1/Cs.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){let t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){let t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){let t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t-i*o,e[4]=-s*u,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*c,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){let t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*u,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){let t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=i-t*u,e[8]=r*u+n,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*u+r,e[10]=t-i*u}else if("XZY"===t.order){let t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=t*u+i,e[5]=s*c,e[9]=n*u-r,e[2]=r*u-n,e[6]=o*c,e[10]=i*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Is,t,Rs)}lookAt(t,e,n){let r=this.elements;return Os.subVectors(t,e),0===Os.lengthSq()&&(Os.z=1),Os.normalize(),Ls.crossVectors(n,Os),0===Ls.lengthSq()&&(1===Math.abs(n.z)?Os.x+=1e-4:Os.z+=1e-4,Os.normalize(),Ls.crossVectors(n,Os)),Ls.normalize(),Ns.crossVectors(Os,Ls),r[0]=Ls.x,r[4]=Ns.x,r[8]=Os.x,r[1]=Ls.y,r[5]=Ns.y,r[9]=Os.y,r[2]=Ls.z,r[6]=Ns.z,r[10]=Os.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],b=n[15],x=r[0],w=r[4],S=r[8],M=r[12],E=r[1],T=r[5],A=r[9],C=r[13],P=r[2],I=r[6],R=r[10],L=r[14],N=r[3],O=r[7],k=r[11],D=r[15];return i[0]=s*x+o*E+a*P+l*N,i[4]=s*w+o*T+a*I+l*O,i[8]=s*S+o*A+a*R+l*k,i[12]=s*M+o*C+a*L+l*D,i[1]=c*x+u*E+h*P+d*N,i[5]=c*w+u*T+h*I+d*O,i[9]=c*S+u*A+h*R+d*k,i[13]=c*M+u*C+h*L+d*D,i[2]=p*x+f*E+m*P+g*N,i[6]=p*w+f*T+m*I+g*O,i[10]=p*S+f*A+m*R+g*k,i[14]=p*M+f*C+m*L+g*D,i[3]=v*x+y*E+_*P+b*N,i[7]=v*w+y*T+_*I+b*O,i[11]=v*S+y*A+_*R+b*k,i[15]=v*M+y*C+_*L+b*D,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*a*u-r*l*u-i*o*h+n*l*h+r*o*d-n*a*d)+t[7]*(+e*a*d-e*l*h+i*s*h-r*s*d+r*l*c-i*a*c)+t[11]*(+e*l*u-e*o*d-i*s*u+n*s*d+i*o*c-n*l*c)+t[15]*(-r*o*c-e*a*u+e*o*h+r*s*u-n*s*h+n*a*c)}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(t,e,n){let r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){let t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=u*m*l-f*h*l+f*a*d-o*m*d-u*a*g+o*h*g,y=p*h*l-c*m*l-p*a*d+s*m*d+c*a*g-s*h*g,_=c*f*l-p*u*l+p*o*d-s*f*d-c*o*g+s*u*g,b=p*u*a-c*f*a-p*o*h+s*f*h+c*o*m-s*u*m,x=e*v+n*y+r*_+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/x;return t[0]=v*w,t[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*w,t[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*g+n*a*g)*w,t[3]=(u*a*i-o*h*i-u*r*l+n*h*l+o*r*d-n*a*d)*w,t[4]=y*w,t[5]=(c*m*i-p*h*i+p*r*d-e*m*d-c*r*g+e*h*g)*w,t[6]=(p*a*i-s*m*i-p*r*l+e*m*l+s*r*g-e*a*g)*w,t[7]=(s*h*i-c*a*i+c*r*l-e*h*l-s*r*d+e*a*d)*w,t[8]=_*w,t[9]=(p*u*i-c*f*i-p*n*d+e*f*d+c*n*g-e*u*g)*w,t[10]=(s*f*i-p*o*i+p*n*l-e*f*l-s*n*g+e*o*g)*w,t[11]=(c*o*i-s*u*i-c*n*l+e*u*l+s*n*d-e*o*d)*w,t[12]=b*w,t[13]=(c*f*r-p*u*r+p*n*h-e*f*h-c*n*m+e*u*m)*w,t[14]=(p*o*r-s*f*r-p*n*a+e*f*a+s*n*m-e*o*m)*w,t[15]=(s*u*r-c*o*r+c*n*a-e*u*a-s*n*h+e*o*h)*w,this}scale(t){let e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,c=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+n,c*a-r*s,0,l*a-r*o,c*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,s){return this.set(1,n,i,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){let r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,c=s+s,u=o+o,h=i*l,d=i*c,p=i*u,f=s*c,m=s*u,g=o*u,v=a*l,y=a*c,_=a*u,b=n.x,x=n.y,w=n.z;return r[0]=(1-(f+g))*b,r[1]=(d+_)*b,r[2]=(p-y)*b,r[3]=0,r[4]=(d-_)*x,r[5]=(1-(h+g))*x,r[6]=(m+v)*x,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){let r=this.elements,i=Cs.set(r[0],r[1],r[2]).length(),s=Cs.set(r[4],r[5],r[6]).length(),o=Cs.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Ps.copy(this);let a=1/i,l=1/s,c=1/o;return Ps.elements[0]*=a,Ps.elements[1]*=a,Ps.elements[2]*=a,Ps.elements[4]*=l,Ps.elements[5]*=l,Ps.elements[6]*=l,Ps.elements[8]*=c,Ps.elements[9]*=c,Ps.elements[10]*=c,e.setFromRotationMatrix(Ps),n.x=i,n.y=s,n.z=o,this}makePerspective(t,e,n,r,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let o=this.elements,a=2*i/(e-t),l=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),h=-(s+i)/(s-i),d=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,r,i,s){let o=this.elements,a=1/(e-t),l=1/(n-r),c=1/(s-i),u=(e+t)*a,h=(n+r)*l,d=(s+i)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){let e=this.elements,n=t.elements;for(let r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}};As.prototype.isMatrix4=!0;var Cs=new Yi,Ps=new As,Is=new Yi(0,0,0),Rs=new Yi(1,1,1),Ls=new Yi,Ns=new Yi,Os=new Yi,ks=new As,Ds=new Ji,zs=class t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;this._x=e,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.elements,i=r[0],s=r[4],o=r[8],a=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(bi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-bi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(bi(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-bi(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(bi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-bi(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return ks.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ks,e,n)}setFromVector3(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(t.x,t.y,t.z,e)}reorder(t){return Ds.setFromEuler(this),this.setFromQuaternion(Ds,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}};zs.prototype.isEuler=!0,zs.DefaultOrder="XYZ",zs.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Us=class{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}isEnabled(t){return 0!==(this.mask&1<<t)}},Fs=0,Bs=new Yi,Vs=new Ji,Hs=new As,js=new Yi,Ws=new Yi,Gs=new Yi,qs=new Ji,$s=new Yi(1,0,0),Xs=new Yi(0,1,0),Js=new Yi(0,0,1),Ys={type:"added"},Zs={type:"removed"},Ks=class t extends mi{constructor(){super(),Object.defineProperty(this,"id",{value:Fs++}),this.uuid=_i(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=t.DefaultUp.clone();let e=new Yi,n=new zs,r=new Ji,i=new Yi(1,1,1);n._onChange((function(){r.setFromEuler(n,!1)})),r._onChange((function(){n.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new As},normalMatrix:{value:new Ei}}),this.matrix=new As,this.matrixWorld=new As,this.matrixAutoUpdate=t.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Us,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Vs.setFromAxisAngle(t,e),this.quaternion.multiply(Vs),this}rotateOnWorldAxis(t,e){return Vs.setFromAxisAngle(t,e),this.quaternion.premultiply(Vs),this}rotateX(t){return this.rotateOnAxis($s,t)}rotateY(t){return this.rotateOnAxis(Xs,t)}rotateZ(t){return this.rotateOnAxis(Js,t)}translateOnAxis(t,e){return Bs.copy(t).applyQuaternion(this.quaternion),this.position.add(Bs.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis($s,t)}translateY(t){return this.translateOnAxis(Xs,t)}translateZ(t){return this.translateOnAxis(Js,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Hs.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?js.copy(t):js.set(t,e,n);let r=this.parent;this.updateWorldMatrix(!0,!1),Ws.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Hs.lookAt(Ws,js,this.up):Hs.lookAt(js,Ws,this.up),this.quaternion.setFromRotationMatrix(Hs),r&&(Hs.extractRotation(r.matrixWorld),Vs.setFromRotationMatrix(Hs),this.quaternion.premultiply(Vs.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Ys)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}let e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Zs)),this}removeFromParent(){let t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){let e=this.children[t];e.parent=null,e.dispatchEvent(Zs)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Hs.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Hs.multiply(t.parent.matrixWorld)),t.applyMatrix4(Hs),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){let r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ws,t,Gs),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ws,qs,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);let e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){let e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){let n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){let t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){let e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);let e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){let n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){let r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){let n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){let e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations),u=s(t.nodes);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function s(t){let e=[];for(let n in t){let r=t[n];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let n=0;n<t.children.length;n++){let e=t.children[n];this.add(e.clone())}return this}};Ks.DefaultUp=new Yi(0,1,0),Ks.DefaultMatrixAutoUpdate=!0,Ks.prototype.isObject3D=!0;var Qs=new Yi,to=new Yi,eo=new Yi,no=new Yi,ro=new Yi,io=new Yi,so=new Yi,oo=new Yi,ao=new Yi,lo=new Yi,co=class t{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yi,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yi,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Yi;this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),Qs.subVectors(t,e),r.cross(Qs);let i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){Qs.subVectors(r,e),to.subVectors(n,e),eo.subVectors(t,e);let s=Qs.dot(Qs),o=Qs.dot(to),a=Qs.dot(eo),l=to.dot(to),c=to.dot(eo),u=s*l-o*o;if(0===u)return i.set(-2,-1,-1);let h=1/u,d=(l*a-o*c)*h,p=(s*c-o*a)*h;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return this.getBarycoord(t,e,n,r,no),no.x>=0&&no.y>=0&&no.x+no.y<=1}static getUV(t,e,n,r,i,s,o,a){return this.getBarycoord(t,e,n,r,no),a.set(0,0),a.addScaledVector(i,no.x),a.addScaledVector(s,no.y),a.addScaledVector(o,no.z),a}static isFrontFacing(t,e,n,r){return Qs.subVectors(n,e),to.subVectors(t,e),Qs.cross(to).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Qs.subVectors(this.c,this.b),to.subVectors(this.a,this.b),.5*Qs.cross(to).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return t.getNormal(this.a,this.b,this.c,e)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return t.getBarycoord(e,this.a,this.b,this.c,n)}getUV(e,n,r,i,s){return t.getUV(e,this.a,this.b,this.c,n,r,i,s)}containsPoint(e){return t.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return t.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let n,r,i=this.a,s=this.b,o=this.c;ro.subVectors(s,i),io.subVectors(o,i),oo.subVectors(t,i);let a=ro.dot(oo),l=io.dot(oo);if(a<=0&&l<=0)return e.copy(i);ao.subVectors(t,s);let c=ro.dot(ao),u=io.dot(ao);if(c>=0&&u<=c)return e.copy(s);let h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return n=a/(a-c),e.copy(i).addScaledVector(ro,n);lo.subVectors(t,o);let d=ro.dot(lo),p=io.dot(lo);if(p>=0&&d<=p)return e.copy(o);let f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return r=l/(l-p),e.copy(i).addScaledVector(io,r);let m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return so.subVectors(o,s),r=(u-c)/(u-c+(d-p)),e.copy(s).addScaledVector(so,r);let g=1/(m+f+h);return n=f*g,r=h*g,e.copy(i).addScaledVector(ro,n).addScaledVector(io,r)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},uo=0,ho=class extends mi{constructor(){super(),Object.defineProperty(this,"id",{value:uo++}),this.uuid=_i(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=fr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ui,this.stencilZFail=ui,this.stencilZPass=ui,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(let e in t){let n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}let r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){let e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});let n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){let e=[];for(let n in t){let r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){let e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;let e=t.clippingPlanes,n=null;if(null!==e){let t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}};ho.prototype.isMaterial=!0,ho.fromType=function(){return null};var po=class extends ho{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new Ui(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}};po.prototype.isMeshBasicMaterial=!0;var fo=new Yi,mo=new Mi,go=class{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=hi,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){let e=this.array,n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new Ui),e[n++]=i.r,e[n++]=i.g,e[n++]=i.b}return this}copyVector2sArray(t){let e=this.array,n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new Mi),e[n++]=i.x,e[n++]=i.y}return this}copyVector3sArray(t){let e=this.array,n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new Yi),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z}return this}copyVector4sArray(t){let e=this.array,n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new Gi),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z,e[n++]=i.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)mo.fromBufferAttribute(this,e),mo.applyMatrix3(t),this.setXY(e,mo.x,mo.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)fo.fromBufferAttribute(this,e),fo.applyMatrix3(t),this.setXYZ(e,fo.x,fo.y,fo.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)fo.fromBufferAttribute(this,e),fo.applyMatrix4(t),this.setXYZ(e,fo.x,fo.y,fo.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)fo.fromBufferAttribute(this,e),fo.applyNormalMatrix(t),this.setXYZ(e,fo.x,fo.y,fo.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)fo.fromBufferAttribute(this,e),fo.transformDirection(t),this.setXYZ(e,fo.x,fo.y,fo.z);return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==hi&&(t.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(t.updateRange=this.updateRange),t}};go.prototype.isBufferAttribute=!0;var vo=class extends go{constructor(t,e,n){super(new Uint16Array(t),e,n)}},yo=class extends go{constructor(t,e,n){super(new Uint32Array(t),e,n)}};(class extends go{constructor(t,e,n){super(new Uint16Array(t),e,n)}}).prototype.isFloat16BufferAttribute=!0;var _o=class extends go{constructor(t,e,n){super(new Float32Array(t),e,n)}},bo=0,xo=new As,wo=new Ks,So=new Yi,Mo=new Qi,Eo=new Qi,To=new Yi,Ao=class t extends mi{constructor(){super(),Object.defineProperty(this,"id",{value:bo++}),this.uuid=_i(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Ti(t)?yo:vo)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);let n=this.attributes.normal;if(void 0!==n){let e=(new Ei).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}let r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return xo.makeRotationFromQuaternion(t),this.applyMatrix4(xo),this}rotateX(t){return xo.makeRotationX(t),this.applyMatrix4(xo),this}rotateY(t){return xo.makeRotationY(t),this.applyMatrix4(xo),this}rotateZ(t){return xo.makeRotationZ(t),this.applyMatrix4(xo),this}translate(t,e,n){return xo.makeTranslation(t,e,n),this.applyMatrix4(xo),this}scale(t,e,n){return xo.makeScale(t,e,n),this.applyMatrix4(xo),this}lookAt(t){return wo.lookAt(t),wo.updateMatrix(),this.applyMatrix4(wo.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(So).negate(),this.translate(So.x,So.y,So.z),this}setFromPoints(t){let e=[];for(let n=0,r=t.length;n<r;n++){let r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new _o(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Qi);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Yi(-1/0,-1/0,-1/0),new Yi(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,r=e.length;n<r;n++){let t=e[n];Mo.setFromBufferAttribute(t),this.morphTargetsRelative?(To.addVectors(this.boundingBox.min,Mo.min),this.boundingBox.expandByPoint(To),To.addVectors(this.boundingBox.max,Mo.max),this.boundingBox.expandByPoint(To)):(this.boundingBox.expandByPoint(Mo.min),this.boundingBox.expandByPoint(Mo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ys);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Yi,1/0);if(t){let n=this.boundingSphere.center;if(Mo.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){let n=e[t];Eo.setFromBufferAttribute(n),this.morphTargetsRelative?(To.addVectors(Mo.min,Eo.min),Mo.expandByPoint(To),To.addVectors(Mo.max,Eo.max),Mo.expandByPoint(To)):(Mo.expandByPoint(Eo.min),Mo.expandByPoint(Eo.max))}Mo.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)To.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(To));if(e)for(let i=0,s=e.length;i<s;i++){let s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)To.fromBufferAttribute(s,e),o&&(So.fromBufferAttribute(t,e),To.add(So)),r=Math.max(r,n.distanceToSquared(To))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let n=t.array,r=e.position.array,i=e.normal.array,s=e.uv.array,o=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new go(new Float32Array(4*o),4));let a=this.getAttribute("tangent").array,l=[],c=[];for(let E=0;E<o;E++)l[E]=new Yi,c[E]=new Yi;let u=new Yi,h=new Yi,d=new Yi,p=new Mi,f=new Mi,m=new Mi,g=new Yi,v=new Yi;function y(t,e,n){u.fromArray(r,3*t),h.fromArray(r,3*e),d.fromArray(r,3*n),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);let i=1/(f.x*m.y-m.x*f.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(i),v.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(i),l[t].add(g),l[e].add(g),l[n].add(g),c[t].add(v),c[e].add(v),c[n].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(let E=0,T=_.length;E<T;++E){let t=_[E],e=t.start;for(let r=e,i=e+t.count;r<i;r+=3)y(n[r+0],n[r+1],n[r+2])}let b=new Yi,x=new Yi,w=new Yi,S=new Yi;function M(t){w.fromArray(i,3*t),S.copy(w);let e=l[t];b.copy(e),b.sub(w.multiplyScalar(w.dot(e))).normalize(),x.crossVectors(S,e);let n=x.dot(c[t])<0?-1:1;a[4*t]=b.x,a[4*t+1]=b.y,a[4*t+2]=b.z,a[4*t+3]=n}for(let E=0,T=_.length;E<T;++E){let t=_[E],e=t.start;for(let r=e,i=e+t.count;r<i;r+=3)M(n[r+0]),M(n[r+1]),M(n[r+2])}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new go(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);let r=new Yi,i=new Yi,s=new Yi,o=new Yi,a=new Yi,l=new Yi,c=new Yi,u=new Yi;if(t)for(let h=0,d=t.count;h<d;h+=3){let d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,h=e.count;t<h;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let n=this.attributes;for(let r in n){if(void 0===t.attributes[r])continue;let i=n[r].array,s=t.attributes[r],o=s.array,a=s.itemSize*e,l=Math.min(o.length,i.length-a);for(let t=0,e=a;t<l;t++,e++)i[e]=o[t]}return this}normalizeNormals(){let t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)To.fromBufferAttribute(t,e),To.normalize(),t.setXYZ(e,To.x,To.y,To.z)}toNonIndexed(){function e(t,e){let n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r),o=0,a=0;for(let l=0,c=e.length;l<c;l++){o=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new go(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let n=new t,r=this.index.array,i=this.attributes;for(let t in i){let s=e(i[t],r);n.setAttribute(t,s)}let s=this.morphAttributes;for(let t in s){let i=[],o=s[t];for(let t=0,n=o.length;t<n;t++){let n=e(o[t],r);i.push(n)}n.morphAttributes[t]=i}n.morphTargetsRelative=this.morphTargetsRelative;let o=this.groups;for(let t=0,a=o.length;t<a;t++){let e=o[t];n.addGroup(e.start,e.count,e.materialIndex)}return n}toJSON(){let t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){let e=this.parameters;for(let n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};let e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let n=this.attributes;for(let a in n){let e=n[a];t.data.attributes[a]=e.toJSON(t.data)}let r={},i=!1;for(let a in this.morphAttributes){let e=this.morphAttributes[a],n=[];for(let r=0,i=e.length;r<i;r++){let i=e[r];n.push(i.toJSON(t.data))}n.length>0&&(r[a]=n,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));let o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let n=t.index;null!==n&&this.setIndex(n.clone(e));let r=t.attributes;for(let l in r){let t=r[l];this.setAttribute(l,t.clone(e))}let i=t.morphAttributes;for(let l in i){let t=[],n=i[l];for(let r=0,i=n.length;r<i;r++)t.push(n[r].clone(e));this.morphAttributes[l]=t}this.morphTargetsRelative=t.morphTargetsRelative;let s=t.groups;for(let l=0,c=s.length;l<c;l++){let t=s[l];this.addGroup(t.start,t.count,t.materialIndex)}let o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());let a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}};Ao.prototype.isBufferGeometry=!0;var Co=new As,Po=new Ts,Io=new ys,Ro=new Yi,Lo=new Yi,No=new Yi,Oo=new Yi,ko=new Yi,Do=new Yi,zo=new Yi,Uo=new Yi,Fo=new Yi,Bo=new Mi,Vo=new Mi,Ho=new Mi,jo=new Yi,Wo=new Yi,Go=class extends Ks{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ao,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new po;super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){let t=this.geometry;if(t.isBufferGeometry){let e=t.morphAttributes,n=Object.keys(e);if(n.length>0){let t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){let n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{let e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){let n,r=this.geometry,i=this.material,s=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),Io.copy(r.boundingSphere),Io.applyMatrix4(s),!1!==t.ray.intersectsSphere(Io))&&(Co.copy(s).invert(),Po.copy(t.ray).applyMatrix4(Co),null===r.boundingBox||!1!==Po.intersectsBox(r.boundingBox)))if(r.isBufferGeometry){let s=r.index,o=r.attributes.position,a=r.morphAttributes.position,l=r.morphTargetsRelative,c=r.attributes.uv,u=r.attributes.uv2,h=r.groups,d=r.drawRange;if(null!==s)if(Array.isArray(i))for(let r=0,p=h.length;r<p;r++){let p=h[r],f=i[p.materialIndex];for(let r=Math.max(p.start,d.start),i=Math.min(s.count,Math.min(p.start+p.count,d.start+d.count));r<i;r+=3){let i=s.getX(r),h=s.getX(r+1),d=s.getX(r+2);n=qo(this,f,t,Po,o,a,l,c,u,i,h,d),n&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=p.materialIndex,e.push(n))}}else{for(let r=Math.max(0,d.start),h=Math.min(s.count,d.start+d.count);r<h;r+=3){let h=s.getX(r),d=s.getX(r+1),p=s.getX(r+2);n=qo(this,i,t,Po,o,a,l,c,u,h,d,p),n&&(n.faceIndex=Math.floor(r/3),e.push(n))}}else if(void 0!==o)if(Array.isArray(i))for(let r=0,p=h.length;r<p;r++){let s=h[r],p=i[s.materialIndex];for(let r=Math.max(s.start,d.start),i=Math.min(o.count,Math.min(s.start+s.count,d.start+d.count));r<i;r+=3){n=qo(this,p,t,Po,o,a,l,c,u,r,r+1,r+2),n&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=s.materialIndex,e.push(n))}}else{for(let r=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);r<s;r+=3){n=qo(this,i,t,Po,o,a,l,c,u,r,r+1,r+2),n&&(n.faceIndex=Math.floor(r/3),e.push(n))}}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};function qo(t,e,n,r,i,s,o,a,l,c,u,h){Ro.fromBufferAttribute(i,c),Lo.fromBufferAttribute(i,u),No.fromBufferAttribute(i,h);let d=t.morphTargetInfluences;if(s&&d){zo.set(0,0,0),Uo.set(0,0,0),Fo.set(0,0,0);for(let t=0,e=s.length;t<e;t++){let e=d[t],n=s[t];0!==e&&(Oo.fromBufferAttribute(n,c),ko.fromBufferAttribute(n,u),Do.fromBufferAttribute(n,h),o?(zo.addScaledVector(Oo,e),Uo.addScaledVector(ko,e),Fo.addScaledVector(Do,e)):(zo.addScaledVector(Oo.sub(Ro),e),Uo.addScaledVector(ko.sub(Lo),e),Fo.addScaledVector(Do.sub(No),e)))}Ro.add(zo),Lo.add(Uo),No.add(Fo)}t.isSkinnedMesh&&(t.boneTransform(c,Ro),t.boneTransform(u,Lo),t.boneTransform(h,No));let p=function(t,e,n,r,i,s,o,a){let l;if(l=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,2!==e.side,a),null===l)return null;Wo.copy(a),Wo.applyMatrix4(t.matrixWorld);let c=n.ray.origin.distanceTo(Wo);return c<n.near||c>n.far?null:{distance:c,point:Wo.clone(),object:t}}(t,e,n,r,Ro,Lo,No,jo);if(p){a&&(Bo.fromBufferAttribute(a,c),Vo.fromBufferAttribute(a,u),Ho.fromBufferAttribute(a,h),p.uv=co.getUV(jo,Ro,Lo,No,Bo,Vo,Ho,new Mi)),l&&(Bo.fromBufferAttribute(l,c),Vo.fromBufferAttribute(l,u),Ho.fromBufferAttribute(l,h),p.uv2=co.getUV(jo,Ro,Lo,No,Bo,Vo,Ho,new Mi));let t={a:c,b:u,c:h,normal:new Yi,materialIndex:0};co.getNormal(Ro,Lo,No,t.normal),p.face=t}return p}Go.prototype.isMesh=!0;var $o=class t extends Ao{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};let o=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);let a=[],l=[],c=[],u=[],h=0,d=0;function p(t,e,n,r,i,s,p,f,m,g,v){let y=s/m,_=p/g,b=s/2,x=p/2,w=f/2,S=m+1,M=g+1,E=0,T=0,A=new Yi;for(let o=0;o<M;o++){let s=o*_-x;for(let a=0;a<S;a++){let h=a*y-b;A[t]=h*r,A[e]=s*i,A[n]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,c.push(A.x,A.y,A.z),u.push(a/m),u.push(1-o/g),E+=1}}for(let o=0;o<g;o++)for(let t=0;t<m;t++){let e=h+t+S*o,n=h+t+S*(o+1),r=h+(t+1)+S*(o+1),i=h+(t+1)+S*o;a.push(e,n,i),a.push(n,r,i),T+=6}o.addGroup(d,T,v),d+=T,h+=E}p("z","y","x",-1,-1,n,e,t,s,i,0),p("z","y","x",1,-1,n,e,-t,s,i,1),p("x","z","y",1,1,t,n,e,r,s,2),p("x","z","y",1,-1,t,n,-e,r,s,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new _o(l,3)),this.setAttribute("normal",new _o(c,3)),this.setAttribute("uv",new _o(u,2))}static fromJSON(e){return new t(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Xo(t){let e={};for(let n in t){e[n]={};for(let r in t[n]){let i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function Jo(t){let e={};for(let n=0;n<t.length;n++){let r=Xo(t[n]);for(let t in r)e[t]=r[t]}return e}var Yo={clone:Xo,merge:Jo},Zo=class extends ho{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Xo(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){let e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?e.uniforms[r]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[r]={type:"m4",value:n.toArray()}:e.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;let n={};for(let r in this.extensions)!0===this.extensions[r]&&(n[r]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}};Zo.prototype.isShaderMaterial=!0;var Ko=class extends Ks{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new As,this.projectionMatrix=new As,this.projectionMatrixInverse=new As}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}};Ko.prototype.isCamera=!0;var Qo=class extends Ko{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=2*yi*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(.5*vi*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*yi*Math.atan(Math.tan(.5*vi*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,r,i,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(.5*vi*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,s=this.view;if(null!==this.view&&this.view.enabled){let t=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/t,e-=s.offsetY*n/o,r*=s.width/t,n*=s.height/o}let o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};Qo.prototype.isPerspectiveCamera=!0;var ta=90,ea=class extends Ks{constructor(t,e,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;let r=new Qo(ta,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Yi(1,0,0)),this.add(r);let i=new Qo(ta,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Yi(-1,0,0)),this.add(i);let s=new Qo(ta,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Yi(0,1,0)),this.add(s);let o=new Qo(ta,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Yi(0,-1,0)),this.add(o);let a=new Qo(ta,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Yi(0,0,1)),this.add(a);let l=new Qo(ta,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Yi(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();let n=this.renderTarget,[r,i,s,o,a,l]=this.children,c=t.getRenderTarget(),u=t.outputEncoding,h=t.toneMapping,d=t.xr.enabled;t.outputEncoding=oi,t.toneMapping=0,t.xr.enabled=!1;let p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,i),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=p,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(c),t.outputEncoding=u,t.toneMapping=h,t.xr.enabled=d,n.texture.needsPMREMUpdate=!0}},na=class extends Wi{constructor(t,e,n,r,i,s,o,a,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:Cr,n,r,i,s,o,a,l,c),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}};na.prototype.isCubeTexture=!0;var ra=class extends qi{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,t,e);let n={width:t,height:t,depth:1},r=[n,n,n,n,n,n];this.texture=new na(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:zr}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new $o(5,5,5),i=new Zo({name:"CubemapFromEquirect",uniforms:Xo(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=e;let s=new Go(r,i),o=e.minFilter;return e.minFilter===Fr&&(e.minFilter=zr),new ea(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,r){let i=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,n,r);t.setRenderTarget(i)}};ra.prototype.isWebGLCubeRenderTarget=!0;var ia=new Yi,sa=new Yi,oa=new Ei,aa=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yi(1,0,0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){let r=ia.subVectors(n,e).cross(sa.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){let n=t.delta(ia),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;let i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(n).multiplyScalar(i).add(t.start)}intersectsLine(t){let e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let n=e||oa.getNormalMatrix(t),r=this.coplanarPoint(ia).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}};aa.prototype.isPlane=!0;var la=new ys,ca=new Yi,ua=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new aa,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new aa,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new aa,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new aa,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new aa,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new aa;this.planes=[t,e,n,r,i,s]}set(t,e,n,r,i,s){let o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this}copy(t){let e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){let e=this.planes,n=t.elements,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(o-r,u-a,f-h,y-m).normalize(),e[1].setComponents(o+r,u+a,f+h,y+m).normalize(),e[2].setComponents(o+i,u+l,f+d,y+g).normalize(),e[3].setComponents(o-i,u-l,f-d,y-g).normalize(),e[4].setComponents(o-s,u-c,f-p,y-v).normalize(),e[5].setComponents(o+s,u+c,f+p,y+v).normalize(),this}intersectsObject(t){let e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),la.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(la)}intersectsSprite(t){return la.center.set(0,0,0),la.radius=.7071067811865476,la.applyMatrix4(t.matrixWorld),this.intersectsSphere(la)}intersectsSphere(t){let e=this.planes,n=t.center,r=-t.radius;for(let i=0;i<6;i++)if(e[i].distanceToPoint(n)<r)return!1;return!0}intersectsBox(t){let e=this.planes;for(let n=0;n<6;n++){let r=e[n];if(ca.x=r.normal.x>0?t.max.x:t.min.x,ca.y=r.normal.y>0?t.max.y:t.min.y,ca.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(ca)<0)return!1}return!0}containsPoint(t){let e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}};function ha(){let t=null,e=!1,n=null,r=null;function i(e,s){n(e,s),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function da(t,e){let n=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);let n=r.get(e);n&&(t.deleteBuffer(n.buffer),r.delete(e))},update:function(e,i){if(e.isGLBufferAttribute){let t=r.get(e);return void((!t||t.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);let s=r.get(e);void 0===s?r.set(e,function(e,r){let i,s=e.array,o=e.usage,a=t.createBuffer();if(t.bindBuffer(r,a),t.bufferData(r,s,o),e.onUploadCallback(),s instanceof Float32Array)i=5126;else if(s instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");i=5131}else i=5123;else if(s instanceof Int16Array)i=5122;else if(s instanceof Uint32Array)i=5125;else if(s instanceof Int32Array)i=5124;else if(s instanceof Int8Array)i=5120;else if(s instanceof Uint8Array)i=5121;else{if(!(s instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+s);i=5121}return{buffer:a,type:i,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version}}(e,i)):s.version<e.version&&(function(e,r,i){let s=r.array,o=r.updateRange;t.bindBuffer(i,e),-1===o.count?t.bufferSubData(i,0,s):(n?t.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(i,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,e,i),s.version=e.version)}}}var pa=class t extends Ao{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};let i=t/2,s=e/2,o=Math.floor(n),a=Math.floor(r),l=o+1,c=a+1,u=t/o,h=e/a,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){let t=g*h-s;for(let e=0;e<l;e++){let n=e*u-i;p.push(n,-t,0),f.push(0,0,1),m.push(e/o),m.push(1-g/a)}}for(let g=0;g<a;g++)for(let t=0;t<o;t++){let e=t+l*g,n=t+l*(g+1),r=t+1+l*(g+1),i=t+1+l*g;d.push(e,n,i),d.push(n,r,i)}this.setIndex(d),this.setAttribute("position",new _o(p,3)),this.setAttribute("normal",new _o(f,3)),this.setAttribute("uv",new _o(m,2))}static fromJSON(e){return new t(e.width,e.height,e.widthSegments,e.heightSegments)}},fa={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},ma={common:{diffuse:{value:new Ui(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ei},uv2Transform:{value:new Ei},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Mi(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ui(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ui(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ei}},sprite:{diffuse:{value:new Ui(16777215)},opacity:{value:1},center:{value:new Mi(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ei}}},ga={basic:{uniforms:Jo([ma.common,ma.specularmap,ma.envmap,ma.aomap,ma.lightmap,ma.fog]),vertexShader:fa.meshbasic_vert,fragmentShader:fa.meshbasic_frag},lambert:{uniforms:Jo([ma.common,ma.specularmap,ma.envmap,ma.aomap,ma.lightmap,ma.emissivemap,ma.fog,ma.lights,{emissive:{value:new Ui(0)}}]),vertexShader:fa.meshlambert_vert,fragmentShader:fa.meshlambert_frag},phong:{uniforms:Jo([ma.common,ma.specularmap,ma.envmap,ma.aomap,ma.lightmap,ma.emissivemap,ma.bumpmap,ma.normalmap,ma.displacementmap,ma.fog,ma.lights,{emissive:{value:new Ui(0)},specular:{value:new Ui(1118481)},shininess:{value:30}}]),vertexShader:fa.meshphong_vert,fragmentShader:fa.meshphong_frag},standard:{uniforms:Jo([ma.common,ma.envmap,ma.aomap,ma.lightmap,ma.emissivemap,ma.bumpmap,ma.normalmap,ma.displacementmap,ma.roughnessmap,ma.metalnessmap,ma.fog,ma.lights,{emissive:{value:new Ui(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:fa.meshphysical_vert,fragmentShader:fa.meshphysical_frag},toon:{uniforms:Jo([ma.common,ma.aomap,ma.lightmap,ma.emissivemap,ma.bumpmap,ma.normalmap,ma.displacementmap,ma.gradientmap,ma.fog,ma.lights,{emissive:{value:new Ui(0)}}]),vertexShader:fa.meshtoon_vert,fragmentShader:fa.meshtoon_frag},matcap:{uniforms:Jo([ma.common,ma.bumpmap,ma.normalmap,ma.displacementmap,ma.fog,{matcap:{value:null}}]),vertexShader:fa.meshmatcap_vert,fragmentShader:fa.meshmatcap_frag},points:{uniforms:Jo([ma.points,ma.fog]),vertexShader:fa.points_vert,fragmentShader:fa.points_frag},dashed:{uniforms:Jo([ma.common,ma.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:fa.linedashed_vert,fragmentShader:fa.linedashed_frag},depth:{uniforms:Jo([ma.common,ma.displacementmap]),vertexShader:fa.depth_vert,fragmentShader:fa.depth_frag},normal:{uniforms:Jo([ma.common,ma.bumpmap,ma.normalmap,ma.displacementmap,{opacity:{value:1}}]),vertexShader:fa.meshnormal_vert,fragmentShader:fa.meshnormal_frag},sprite:{uniforms:Jo([ma.sprite,ma.fog]),vertexShader:fa.sprite_vert,fragmentShader:fa.sprite_frag},background:{uniforms:{uvTransform:{value:new Ei},t2D:{value:null}},vertexShader:fa.background_vert,fragmentShader:fa.background_frag},cube:{uniforms:Jo([ma.envmap,{opacity:{value:1}}]),vertexShader:fa.cube_vert,fragmentShader:fa.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:fa.equirect_vert,fragmentShader:fa.equirect_frag},distanceRGBA:{uniforms:Jo([ma.common,ma.displacementmap,{referencePosition:{value:new Yi},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:fa.distanceRGBA_vert,fragmentShader:fa.distanceRGBA_frag},shadow:{uniforms:Jo([ma.lights,ma.fog,{color:{value:new Ui(0)},opacity:{value:1}}]),vertexShader:fa.shadow_vert,fragmentShader:fa.shadow_frag}};function va(t,e,n,r,i,s){let o,a,l=new Ui(0),c=!0===i?0:1,u=null,h=0,d=null;function p(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,s)}return{getClearColor:function(){return l},setClearColor:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;l.set(t),c=e,p(l,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,p(l,c)},render:function(n,i){let s=!1,f=!0===i.isScene?i.background:null;f&&f.isTexture&&(f=e.get(f));let m=t.xr,g=m.getSession&&m.getSession();g&&"additive"===g.environmentBlendMode&&(f=null),null===f?p(l,c):f&&f.isColor&&(p(f,1),s=!0),(t.autoClear||s)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),f&&(f.isCubeTexture||f.mapping===Ir)?(void 0===a&&(a=new Go(new $o(1,1,1),new Zo({name:"BackgroundCubeMaterial",uniforms:Xo(ga.cube.uniforms),vertexShader:ga.cube.vertexShader,fragmentShader:ga.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),a.material.uniforms.envMap.value=f,a.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,(u!==f||h!==f.version||d!==t.toneMapping)&&(a.material.needsUpdate=!0,u=f,h=f.version,d=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):f&&f.isTexture&&(void 0===o&&(o=new Go(new pa(2,2),new Zo({name:"BackgroundMaterial",uniforms:Xo(ga.background.uniforms),vertexShader:ga.background.vertexShader,fragmentShader:ga.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),o.material.uniforms.uvTransform.value.copy(f.matrix),(u!==f||h!==f.version||d!==t.toneMapping)&&(o.material.needsUpdate=!0,u=f,h=f.version,d=t.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function ya(t,e,n,r){let i=t.getParameter(34921),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),o=r.isWebGL2||null!==s,a={},l=p(null),c=l,u=!1;function h(e){return r.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return r.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){let e=[],n=[],r=[];for(let s=0;s<i;s++)e[s]=0,n[s]=0,r[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{},index:null}}function f(){let t=c.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function m(t){g(t,0)}function g(n,i){let s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),a[n]!==i&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i)}function v(){let e=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function y(e,n,i,s,o,a){!0!==r.isWebGL2||5124!==i&&5125!==i?t.vertexAttribPointer(e,n,i,s,o,a):t.vertexAttribIPointer(e,n,i,o,a)}function _(){b(),u=!0,c!==l&&(c=l,h(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,d,_,b){let x=!1;if(o){let e=function(e,n,i){let o=!0===i.wireframe,l=a[e.id];void 0===l&&(l={},a[e.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[o];return void 0===u&&(u=p(r.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[o]=u),u}(_,d,l);c!==e&&(c=e,h(c.object)),x=function(t,e){let n=c.attributes,r=t.attributes,i=0;for(let s in r){let t=n[s],e=r[s];if(void 0===t||t.attribute!==e||t.data!==e.data)return!0;i++}return c.attributesNum!==i||c.index!==e}(_,b),x&&function(t,e){let n={},r=t.attributes,i=0;for(let s in r){let t=r[s],e={};e.attribute=t,t.data&&(e.data=t.data),n[s]=e,i++}c.attributes=n,c.attributesNum=i,c.index=e}(_,b)}else{let t=!0===l.wireframe;(c.geometry!==_.id||c.program!==d.id||c.wireframe!==t)&&(c.geometry=_.id,c.program=d.id,c.wireframe=t,x=!0)}!0===i.isInstancedMesh&&(x=!0),null!==b&&n.update(b,34963),(x||u)&&(u=!1,function(i,s,o,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();let l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(let e in c){let r=c[e];if(r.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&i.instanceMatrix&&(s=i.instanceMatrix),"instanceColor"===e&&i.instanceColor&&(s=i.instanceColor)),void 0!==s){let e=s.normalized,o=s.itemSize,l=n.get(s);if(void 0===l)continue;let c=l.buffer,u=l.type,h=l.bytesPerElement;if(s.isInterleavedBufferAttribute){let n=s.data,l=n.stride,d=s.offset;if(n.isInstancedInterleavedBuffer){for(let t=0;t<r.locationSize;t++)g(r.location+t,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let t=0;t<r.locationSize;t++)m(r.location+t);t.bindBuffer(34962,c);for(let t=0;t<r.locationSize;t++)y(r.location+t,o/r.locationSize,u,e,l*h,(d+o/r.locationSize*t)*h)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<r.locationSize;t++)g(r.location+t,s.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<r.locationSize;t++)m(r.location+t);t.bindBuffer(34962,c);for(let t=0;t<r.locationSize;t++)y(r.location+t,o/r.locationSize,u,e,o*h,o/r.locationSize*t*h)}}else if(void 0!==u){let n=u[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(r.location,n);break;case 3:t.vertexAttrib3fv(r.location,n);break;case 4:t.vertexAttrib4fv(r.location,n);break;default:t.vertexAttrib1fv(r.location,n)}}}}v()}(i,l,d,_),null!==b&&t.bindBuffer(34963,n.get(b).buffer))},reset:_,resetDefaultState:b,dispose:function(){_();for(let t in a){let e=a[t];for(let t in e){let n=e[t];for(let t in n)d(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;let e=a[t.id];for(let n in e){let t=e[n];for(let e in t)d(t[e].object),delete t[e];delete e[n]}delete a[t.id]},releaseStatesOfProgram:function(t){for(let e in a){let n=a[e];if(void 0===n[t.id])continue;let r=n[t.id];for(let t in r)d(r[t].object),delete r[t];delete n[t.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function _a(t,e,n,r){let i,s=r.isWebGL2;this.setMode=function(t){i=t},this.render=function(e,r){t.drawArrays(i,e,r),n.update(r,i,1)},this.renderInstances=function(r,o,a){if(0===a)return;let l,c;if(s)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](i,r,o,a),n.update(o,i,a)}}function ba(t,e,n){let r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let s=typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&t instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",a=i(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);let l=s||e.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=t.getParameter(34930),h=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),y=h>0,_=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){let n=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:s?t.getParameter(36183):0}}function xa(t){let e=this,n=null,r=0,i=!1,s=!1,o=new aa,a=new Ei,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(t,n,r,i){let s=null!==t?t.length:0,c=null;if(0!==s){if(c=l.value,!0!==i||null===c){let e=r+4*s,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===c||c.length<e)&&(c=new Float32Array(e));for(let n=0,l=r;n!==s;++n,l+=4)o.copy(t[n]).applyMatrix4(i,a),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){let o=0!==t.length||e||0!==r||i;return i=e,n=u(t,s,0),r=t.length,o},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,o,a){let h=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!i||null===h||0===h.length||s&&!p)s?u(null):c();else{let t=s?0:r,e=4*t,i=f.clippingState||null;l.value=i,i=u(h,o,e,a);for(let r=0;r!==e;++r)i[r]=n[r];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function wa(t){let e=new WeakMap;function n(t,e){return 303===e?t.mapping=Cr:304===e&&(t.mapping=Pr),t}function r(t){let n=t.target;n.removeEventListener("dispose",r);let i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){let s=i.mapping;if(303===s||304===s){if(e.has(i)){return n(e.get(i).texture,i.mapping)}{let s=i.image;if(s&&s.height>0){let o=new ra(s.height/2);return o.fromEquirectangularTexture(t,i),e.set(i,o),i.addEventListener("dispose",r),n(o.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}ga.physical={uniforms:Jo([ga.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Mi(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Ui(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Mi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ui(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ui(1,1,1)},specularColorMap:{value:null}}]),vertexShader:fa.meshphysical_vert,fragmentShader:fa.meshphysical_frag};var Sa=class extends Ko{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t,s=n+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){let t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,s=i+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}};Sa.prototype.isOrthographicCamera=!0;var Ma=[.125,.215,.35,.446,.526,.582],Ea=20,Ta=new Sa,Aa=new Ui,Ca=null,Pa=(1+Math.sqrt(5))/2,Ia=1/Pa,Ra=[new Yi(1,1,1),new Yi(-1,1,1),new Yi(1,1,-1),new Yi(-1,1,-1),new Yi(0,Pa,Ia),new Yi(0,Pa,-Ia),new Yi(Ia,0,Pa),new Yi(-Ia,0,Pa),new Yi(Pa,Ia,0),new Yi(-Pa,Ia,0)],La=class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Ca=this._renderer.getRenderTarget(),this._setSize(256);let i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(t,e)}fromCubemap(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Da(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=ka(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Ca),t.scissorTest=!1,Oa(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===Cr||t.mapping===Pr?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Ca=this._renderer.getRenderTarget();let n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){let t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize-32,n={magFilter:zr,minFilter:zr,generateMipmaps:!1,type:Wr,format:qr,encoding:oi,depthBuffer:!1},r=Na(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Na(t,e,n);let{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){let e=[],n=[],r=[],i=t,s=t-4+1+Ma.length;for(let o=0;o<s;o++){let s=Math.pow(2,i);n.push(s);let a=1/s;o>t-4?a=Ma[o-t+4-1]:0===o&&(a=0),r.push(a);let l=1/(s-1),c=-l/2,u=1+l/2,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),_=new Float32Array(g*p*d);for(let t=0;t<d;t++){let e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];v.set(r,f*p*t),y.set(h,m*p*t);let i=[t,t,t,t,t,t];_.set(i,g*p*t)}let b=new Ao;b.setAttribute("position",new go(v,f)),b.setAttribute("uv",new go(y,m)),b.setAttribute("faceIndex",new go(_,g)),e.push(b),i>4&&i--}return{lodPlanes:e,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(t,e,n){let r=new Float32Array(Ea),i=new Yi(0,1,0);return new Zo({name:"SphericalGaussianBlur",defines:{n:Ea,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:za(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(r,t,e)}return r}_compileMaterial(t){let e=new Go(this._lodPlanes[0],t);this._renderer.compile(e,Ta)}_sceneToCubeUV(t,e,n,r){let i=new Qo(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(Aa),a.toneMapping=0,a.autoClear=!1;let u=new po({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new Go(new $o,u),d=!1,p=t.background;p?p.isColor&&(u.color.copy(p),t.background=null,d=!0):(u.color.copy(Aa),d=!0);for(let f=0;f<6;f++){let e=f%3;0===e?(i.up.set(0,s[f],0),i.lookAt(o[f],0,0)):1===e?(i.up.set(0,0,s[f]),i.lookAt(0,o[f],0)):(i.up.set(0,s[f],0),i.lookAt(0,0,o[f]));let n=this._cubeSize;Oa(r,e*n,f>2?n:0,n,n),a.setRenderTarget(r),d&&a.render(h,i),a.render(t,i)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=c,a.autoClear=l,t.background=p}_textureToCubeUV(t,e){let n=this._renderer,r=t.mapping===Cr||t.mapping===Pr;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Da()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=ka());let i=r?this._cubemapMaterial:this._equirectMaterial,s=new Go(this._lodPlanes[0],i);i.uniforms.envMap.value=t;let o=this._cubeSize;Oa(e,0,0,3*o,2*o),n.setRenderTarget(e),n.render(s,Ta)}_applyPMREM(t){let e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let e=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=Ra[(r-1)%Ra.length];this._blur(t,r-1,r,e,n)}e.autoClear=n}_blur(t,e,n,r,i){let s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,r,"latitudinal",i),this._halfBlur(s,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,s,o){let a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");let c=new Go(this._lodPlanes[r],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):Ea;f>Ea&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);let m=[],g=0;for(let _=0;_<Ea;++_){let t=_/p,e=Math.exp(-t*t/2);m.push(e),0===_?g+=e:_<f&&(g+=2*e)}for(let _=0;_<m.length;_++)m[_]=m[_]/g;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o);let{_lodMax:v}=this;u.dTheta.value=d,u.mipInt.value=v-n;let y=this._sizeLods[r];Oa(e,3*y*(r>v-4?r-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(e),a.render(c,Ta)}};function Na(t,e,n){let r=new qi(t,e,n);return r.texture.mapping=Ir,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Oa(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function ka(){return new Zo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:za(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Da(){return new Zo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:za(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function za(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Ua(t){let e=new WeakMap,n=null;function r(t){let n=t.target;n.removeEventListener("dispose",r);let i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){let s=i.mapping,o=303===s||304===s,a=s===Cr||s===Pr;if(o||a){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;let r=e.get(i);return null===n&&(n=new La(t)),r=o?n.fromEquirectangular(i,r):n.fromCubemap(i,r),e.set(i,r),r.texture}if(e.has(i))return e.get(i).texture;{let s=i.image;if(o&&s&&s.height>0||a&&s&&function(t){let e=0,n=6;for(let r=0;r<n;r++)void 0!==t[r]&&e++;return e===n}(s)){null===n&&(n=new La(t));let s=o?n.fromEquirectangular(i):n.fromCubemap(i);return e.set(i,s),i.addEventListener("dispose",r),s.texture}return null}}}return i},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Fa(t){let e={};function n(n){if(void 0!==e[n])return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(t){let e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Ba(t,e,n,r){let i={},s=new WeakMap;function o(t){let a=t.target;null!==a.index&&e.remove(a.index);for(let n in a.attributes)e.remove(a.attributes[n]);a.removeEventListener("dispose",o),delete i[a.id];let l=s.get(a);l&&(e.remove(l),s.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){let n=[],r=t.index,i=t.attributes.position,o=0;if(null!==r){let t=r.array;o=r.version;for(let e=0,r=t.length;e<r;e+=3){let r=t[e+0],i=t[e+1],s=t[e+2];n.push(r,i,i,s,s,r)}}else{let t=i.array;o=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){let t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}let a=new(Ti(n)?yo:vo)(n,1);a.version=o;let l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===i[e.id]||(e.addEventListener("dispose",o),i[e.id]=!0,n.memory.geometries++),e},update:function(t){let n=t.attributes;for(let i in n)e.update(n[i],34962);let r=t.morphAttributes;for(let i in r){let t=r[i];for(let n=0,r=t.length;n<r;n++)e.update(t[n],34962)}},getWireframeAttribute:function(t){let e=s.get(t);if(e){let n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function Va(t,e,n,r){let i,s,o,a=r.isWebGL2;this.setMode=function(t){i=t},this.setIndex=function(t){s=t.type,o=t.bytesPerElement},this.render=function(e,r){t.drawElements(i,r,s,e*o),n.update(r,i,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(a)u=t,h="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](i,l,s,r*o,c),n.update(l,i,c)}}function Ha(t){let e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(e.calls++,n){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function ja(t,e){return t[0]-e[0]}function Wa(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Ga(t,e){let n=1,r=e.isInterleavedBufferAttribute?e.data.array:e.array;r instanceof Int8Array?n=127:r instanceof Int16Array?n=32767:r instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),t.divideScalar(n)}function qa(t,e,n){let r={},i=new Float32Array(8),s=new WeakMap,o=new Gi,a=[];for(let l=0;l<8;l++)a[l]=[l,0];return{update:function(l,c,u,h){let d=l.morphTargetInfluences;if(!0===e.isWebGL2){let r=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,i=void 0!==r?r.length:0,a=s.get(c);if(void 0===a||a.count!==i){let t=function(){v.dispose(),s.delete(c),c.removeEventListener("dispose",t)};void 0!==a&&a.texture.dispose();let n=void 0!==c.morphAttributes.position,r=void 0!==c.morphAttributes.normal,l=void 0!==c.morphAttributes.color,u=c.morphAttributes.position||[],h=c.morphAttributes.normal||[],d=c.morphAttributes.color||[],p=0;!0===n&&(p=1),!0===r&&(p=2),!0===l&&(p=3);let f=c.attributes.position.count*p,m=1;f>e.maxTextureSize&&(m=Math.ceil(f/e.maxTextureSize),f=e.maxTextureSize);let g=new Float32Array(f*m*4*i),v=new $i(g,f,m,i);v.type=jr,v.needsUpdate=!0;let y=4*p;for(let e=0;e<i;e++){let t=u[e],i=h[e],s=d[e],a=f*m*4*e;for(let e=0;e<t.count;e++){let c=e*y;!0===n&&(o.fromBufferAttribute(t,e),!0===t.normalized&&Ga(o,t),g[a+c+0]=o.x,g[a+c+1]=o.y,g[a+c+2]=o.z,g[a+c+3]=0),!0===r&&(o.fromBufferAttribute(i,e),!0===i.normalized&&Ga(o,i),g[a+c+4]=o.x,g[a+c+5]=o.y,g[a+c+6]=o.z,g[a+c+7]=0),!0===l&&(o.fromBufferAttribute(s,e),!0===s.normalized&&Ga(o,s),g[a+c+8]=o.x,g[a+c+9]=o.y,g[a+c+10]=o.z,g[a+c+11]=4===s.itemSize?o.w:1)}}a={count:i,texture:v,size:new Mi(f,m)},s.set(c,a),c.addEventListener("dispose",t)}let l=0;for(let t=0;t<d.length;t++)l+=d[t];let u=c.morphTargetsRelative?1:1-l;h.getUniforms().setValue(t,"morphTargetBaseInfluence",u),h.getUniforms().setValue(t,"morphTargetInfluences",d),h.getUniforms().setValue(t,"morphTargetsTexture",a.texture,n),h.getUniforms().setValue(t,"morphTargetsTextureSize",a.size)}else{let e=void 0===d?0:d.length,n=r[c.id];if(void 0===n||n.length!==e){n=[];for(let t=0;t<e;t++)n[t]=[t,0];r[c.id]=n}for(let t=0;t<e;t++){let e=n[t];e[0]=t,e[1]=d[t]}n.sort(Wa);for(let t=0;t<8;t++)t<e&&n[t][1]?(a[t][0]=n[t][0],a[t][1]=n[t][1]):(a[t][0]=Number.MAX_SAFE_INTEGER,a[t][1]=0);a.sort(ja);let s=c.morphAttributes.position,o=c.morphAttributes.normal,l=0;for(let t=0;t<8;t++){let e=a[t],n=e[0],r=e[1];n!==Number.MAX_SAFE_INTEGER&&r?(s&&c.getAttribute("morphTarget"+t)!==s[n]&&c.setAttribute("morphTarget"+t,s[n]),o&&c.getAttribute("morphNormal"+t)!==o[n]&&c.setAttribute("morphNormal"+t,o[n]),i[t]=r,l+=r):(s&&!0===c.hasAttribute("morphTarget"+t)&&c.deleteAttribute("morphTarget"+t),o&&!0===c.hasAttribute("morphNormal"+t)&&c.deleteAttribute("morphNormal"+t),i[t]=0)}let u=c.morphTargetsRelative?1:1-l;h.getUniforms().setValue(t,"morphTargetBaseInfluence",u),h.getUniforms().setValue(t,"morphTargetInfluences",i)}}}}function $a(t,e,n,r){let i=new WeakMap;function s(t){let e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){let o=r.render.frame,a=t.geometry,l=e.get(t,a);return i.get(l)!==o&&(e.update(l),i.set(l,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}var Xa=new Wi,Ja=new $i,Ya=new Xi,Za=new na,Ka=[],Qa=[],tl=new Float32Array(16),el=new Float32Array(9),nl=new Float32Array(4);function rl(t,e,n){let r=t[0];if(r<=0||r>0)return t;let i=e*n,s=Ka[i];if(void 0===s&&(s=new Float32Array(i),Ka[i]=s),0!==e){r.toArray(s,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(s,i)}return s}function il(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function sl(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function ol(t,e){let n=Qa[e];void 0===n&&(n=new Int32Array(e),Qa[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function al(t,e){let n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function ll(t,e){let n=this.cache;if(void 0!==e.x)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(il(n,e))return;t.uniform2fv(this.addr,e),sl(n,e)}}function cl(t,e){let n=this.cache;if(void 0!==e.x)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(il(n,e))return;t.uniform3fv(this.addr,e),sl(n,e)}}function ul(t,e){let n=this.cache;if(void 0!==e.x)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(il(n,e))return;t.uniform4fv(this.addr,e),sl(n,e)}}function hl(t,e){let n=this.cache,r=e.elements;if(void 0===r){if(il(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),sl(n,e)}else{if(il(n,r))return;nl.set(r),t.uniformMatrix2fv(this.addr,!1,nl),sl(n,r)}}function dl(t,e){let n=this.cache,r=e.elements;if(void 0===r){if(il(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),sl(n,e)}else{if(il(n,r))return;el.set(r),t.uniformMatrix3fv(this.addr,!1,el),sl(n,r)}}function pl(t,e){let n=this.cache,r=e.elements;if(void 0===r){if(il(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),sl(n,e)}else{if(il(n,r))return;tl.set(r),t.uniformMatrix4fv(this.addr,!1,tl),sl(n,r)}}function fl(t,e){let n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function ml(t,e){let n=this.cache;il(n,e)||(t.uniform2iv(this.addr,e),sl(n,e))}function gl(t,e){let n=this.cache;il(n,e)||(t.uniform3iv(this.addr,e),sl(n,e))}function vl(t,e){let n=this.cache;il(n,e)||(t.uniform4iv(this.addr,e),sl(n,e))}function yl(t,e){let n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function _l(t,e){let n=this.cache;il(n,e)||(t.uniform2uiv(this.addr,e),sl(n,e))}function bl(t,e){let n=this.cache;il(n,e)||(t.uniform3uiv(this.addr,e),sl(n,e))}function xl(t,e){let n=this.cache;il(n,e)||(t.uniform4uiv(this.addr,e),sl(n,e))}function wl(t,e,n){let r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(e||Xa,i)}function Sl(t,e,n){let r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||Ya,i)}function Ml(t,e,n){let r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(e||Za,i)}function El(t,e,n){let r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||Ja,i)}function Tl(t,e){t.uniform1fv(this.addr,e)}function Al(t,e){let n=rl(e,this.size,2);t.uniform2fv(this.addr,n)}function Cl(t,e){let n=rl(e,this.size,3);t.uniform3fv(this.addr,n)}function Pl(t,e){let n=rl(e,this.size,4);t.uniform4fv(this.addr,n)}function Il(t,e){let n=rl(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Rl(t,e){let n=rl(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Ll(t,e){let n=rl(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Nl(t,e){t.uniform1iv(this.addr,e)}function Ol(t,e){t.uniform2iv(this.addr,e)}function kl(t,e){t.uniform3iv(this.addr,e)}function Dl(t,e){t.uniform4iv(this.addr,e)}function zl(t,e){t.uniform1uiv(this.addr,e)}function Ul(t,e){t.uniform2uiv(this.addr,e)}function Fl(t,e){t.uniform3uiv(this.addr,e)}function Bl(t,e){t.uniform4uiv(this.addr,e)}function Vl(t,e,n){let r=e.length,i=ol(n,r);t.uniform1iv(this.addr,i);for(let s=0;s!==r;++s)n.setTexture2D(e[s]||Xa,i[s])}function Hl(t,e,n){let r=e.length,i=ol(n,r);t.uniform1iv(this.addr,i);for(let s=0;s!==r;++s)n.setTexture3D(e[s]||Ya,i[s])}function jl(t,e,n){let r=e.length,i=ol(n,r);t.uniform1iv(this.addr,i);for(let s=0;s!==r;++s)n.setTextureCube(e[s]||Za,i[s])}function Wl(t,e,n){let r=e.length,i=ol(n,r);t.uniform1iv(this.addr,i);for(let s=0;s!==r;++s)n.setTexture2DArray(e[s]||Ja,i[s])}function Gl(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return al;case 35664:return ll;case 35665:return cl;case 35666:return ul;case 35674:return hl;case 35675:return dl;case 35676:return pl;case 5124:case 35670:return fl;case 35667:case 35671:return ml;case 35668:case 35672:return gl;case 35669:case 35673:return vl;case 5125:return yl;case 36294:return _l;case 36295:return bl;case 36296:return xl;case 35678:case 36198:case 36298:case 36306:case 35682:return wl;case 35679:case 36299:case 36307:return Sl;case 35680:case 36300:case 36308:case 36293:return Ml;case 36289:case 36303:case 36311:case 36292:return El}}(e.type)}function ql(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Tl;case 35664:return Al;case 35665:return Cl;case 35666:return Pl;case 35674:return Il;case 35675:return Rl;case 35676:return Ll;case 5124:case 35670:return Nl;case 35667:case 35671:return Ol;case 35668:case 35672:return kl;case 35669:case 35673:return Dl;case 5125:return zl;case 36294:return Ul;case 36295:return Fl;case 36296:return Bl;case 35678:case 36198:case 36298:case 36306:case 35682:return Vl;case 35679:case 36299:case 36307:return Hl;case 35680:case 36300:case 36308:case 36293:return jl;case 36289:case 36303:case 36311:case 36292:return Wl}}(e.type)}function $l(t){this.id=t,this.seq=[],this.map={}}ql.prototype.updateCache=function(t){let e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),sl(e,t)},$l.prototype.setValue=function(t,e,n){let r=this.seq;for(let i=0,s=r.length;i!==s;++i){let s=r[i];s.setValue(t,e[s.id],n)}};var Xl=/(\w+)(\])?(\[|\.)?/g;function Jl(t,e){t.seq.push(e),t.map[e.id]=e}function Yl(t,e,n){let r=t.name,i=r.length;for(Xl.lastIndex=0;;){let s=Xl.exec(r),o=Xl.lastIndex,a=s[1],l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===i){Jl(n,void 0===c?new Gl(a,t,e):new ql(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new $l(a),Jl(n,t)),n=t}}}function Zl(t,e){this.seq=[],this.map={};let n=t.getProgramParameter(e,35718);for(let r=0;r<n;++r){let n=t.getActiveUniform(e,r);Yl(n,t.getUniformLocation(e,n.name),this)}}function Kl(t,e,n){let r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}Zl.prototype.setValue=function(t,e,n,r){let i=this.map[e];void 0!==i&&i.setValue(t,n,r)},Zl.prototype.setOptional=function(t,e,n){let r=e[n];void 0!==r&&this.setValue(t,n,r)},Zl.upload=function(t,e,n,r){for(let i=0,s=e.length;i!==s;++i){let s=e[i],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,r)}},Zl.seqWithValue=function(t,e){let n=[];for(let r=0,i=t.length;r!==i;++r){let i=t[r];i.id in e&&n.push(i)}return n};var Ql=0;function tc(t,e,n){let r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";let s=parseInt(/ERROR: 0:(\d+)/.exec(i)[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(t,e){let n=t.split("\n"),r=[],i=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let o=i;o<s;o++)r.push(o+1+": "+n[o]);return r.join("\n")}(t.getShaderSource(e),s)}function ec(t,e){let n=function(t){switch(t){case oi:return["Linear","( value )"];case ai:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function nc(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function rc(t){return""!==t}function ic(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function sc(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var oc=/^[ \t]*#include +<([\w\d./]+)>/gm;function ac(t){return t.replace(oc,lc)}function lc(t,e){let n=fa[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return ac(n)}var cc=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,uc=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function hc(t){return t.replace(uc,pc).replace(cc,dc)}function dc(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),pc(t,e,n,r)}function pc(t,e,n,r){let i="";for(let s=parseInt(e);s<parseInt(n);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function fc(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function mc(t,e,n,r){let i,s,o=t.getContext(),a=n.defines,l=n.vertexShader,c=n.fragmentShader,u=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),h=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Cr:case Pr:e="ENVMAP_TYPE_CUBE";break;case Ir:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),d=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===Pr&&(e="ENVMAP_MODE_REFRACTION");return e}(n),p=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),f=function(t){let e=t.envMapCubeUVHeight;if(null===e)return null;let n=Math.log2(e/32+1)+3,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),m=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(rc).join("\n")}(n),g=function(t){let e=[];for(let n in t){let r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(a),v=o.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(i=[g].filter(rc).join("\n"),i.length>0&&(i+="\n"),s=[m,g].filter(rc).join("\n"),s.length>0&&(s+="\n")):(i=[fc(n),"#define SHADER_NAME "+n.shaderName,g,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(rc).join("\n"),s=[m,fc(n),"#define SHADER_NAME "+n.shaderName,g,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+d:"",n.envMap?"#define "+p:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?fa.tonemapping_pars_fragment:"",0!==n.toneMapping?nc("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",fa.encodings_pars_fragment,ec("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(rc).join("\n")),l=ac(l),l=ic(l,n),l=sc(l,n),c=ac(c),c=ic(c,n),c=sc(c,n),l=hc(l),c=hc(c),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",i=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,s=["#define varying in",n.glslVersion===pi?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===pi?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s);let _,b,x=y+s+c,w=Kl(o,35633,y+i+l),S=Kl(o,35632,x);if(o.attachShader(v,w),o.attachShader(v,S),void 0!==n.index0AttributeName?o.bindAttribLocation(v,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(v,0,"position"),o.linkProgram(v),t.debug.checkShaderErrors){let t=o.getProgramInfoLog(v).trim(),e=o.getShaderInfoLog(w).trim(),n=o.getShaderInfoLog(S).trim(),r=!0,a=!0;if(!1===o.getProgramParameter(v,35714)){r=!1;let e=tc(o,w,"vertex"),n=tc(o,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(v,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):(""===e||""===n)&&(a=!1);a&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:e,prefix:i},fragmentShader:{log:n,prefix:s}})}return o.deleteShader(w),o.deleteShader(S),this.getUniforms=function(){return void 0===_&&(_=new Zl(o,v)),_},this.getAttributes=function(){return void 0===b&&(b=function(t,e){let n={},r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){let r=t.getActiveAttrib(e,i),s=r.name,o=1;35674===r.type&&(o=2),35675===r.type&&(o=3),35676===r.type&&(o=4),n[s]={type:r.type,location:t.getAttribLocation(e,s),locationSize:o}}return n}(o,v)),b},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(v),this.program=void 0},this.name=n.shaderName,this.id=Ql++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=S,this}var gc=0,vc=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){let e=t.vertexShader,n=t.fragmentShader,r=this._getShaderStage(e),i=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(r)&&(s.add(r),r.usedTimes++),!1===s.has(i)&&(s.add(i),i.usedTimes++),this}remove(t){let e=this.materialCache.get(t);for(let n of e)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){let e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){let e=this.shaderCache;if(!1===e.has(t)){let n=new yc(t);e.set(t,n)}return e.get(t)}},yc=class{constructor(t){this.id=gc++,this.code=t,this.usedTimes=0}};function _c(t,e,n,r,i,s,o){let a=new Us,l=new vc,c=[],u=i.isWebGL2,h=i.logarithmicDepthBuffer,d=i.floatVertexTextures,p=i.maxVertexUniforms,f=i.vertexTextures,m=i.precision,g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,a,c,v,y){let _=v.fog,b=y.geometry,x=s.isMeshStandardMaterial?v.environment:null,w=(s.isMeshStandardMaterial?n:e).get(s.envMap||x),S=w&&w.mapping===Ir?w.image.height:null,M=g[s.type],E=y.isSkinnedMesh?function(t){let e=t.skeleton.bones;if(d)return 1024;{let t=Math.floor((p-20)/4),n=Math.min(t,e.length);return n<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+n+"."),0):n}}(y):0;null!==s.precision&&(m=i.getMaxPrecision(s.precision),m!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",m,"instead."));let T,A,C,P,I=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,R=void 0!==I?I.length:0,L=0;if(void 0!==b.morphAttributes.position&&(L=1),void 0!==b.morphAttributes.normal&&(L=2),void 0!==b.morphAttributes.color&&(L=3),M){let t=ga[M];T=t.vertexShader,A=t.fragmentShader}else T=s.vertexShader,A=s.fragmentShader,l.update(s),C=l.getVertexShaderID(s),P=l.getFragmentShaderID(s);let N=t.getRenderTarget(),O=s.alphaTest>0,k=s.clearcoat>0;return{isWebGL2:u,shaderID:M,shaderName:s.type,vertexShader:T,fragmentShader:A,defines:s.defines,customVertexShaderID:C,customFragmentShaderID:P,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:m,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:f,outputEncoding:null===N?t.outputEncoding:!0===N.isXRRenderTarget?N.texture.encoding:oi,map:!!s.map,matcap:!!s.matcap,envMap:!!w,envMapMode:w&&w.mapping,envMapCubeUVHeight:S,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===ai,clearcoat:k,clearcoatMap:k&&!!s.clearcoatMap,clearcoatRoughnessMap:k&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:k&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:O,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!b.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUvs:!!s.map||!!s.bumpMap||!!s.normalMap||!!s.specularMap||!!s.alphaMap||!!s.emissiveMap||!!s.roughnessMap||!!s.metalnessMap||!!s.clearcoatMap||!!s.clearcoatRoughnessMap||!!s.clearcoatNormalMap||!!s.displacementMap||!!s.transmissionMap||!!s.thicknessMap||!!s.specularIntensityMap||!!s.specularColorMap||!!s.sheenColorMap||!!s.sheenRoughnessMap,uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap)&&!!s.displacementMap,fog:!!_,useFog:s.fog,fogExp2:_&&_.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===y.isSkinnedMesh&&E>0,maxBones:E,useVertexTexture:d,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:R,morphTextureStride:L,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){let n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(let t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.maxBones),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection)}(n,e),function(t,e){a.disableAll(),e.isWebGL2&&a.enable(0),e.supportsVertexTextures&&a.enable(1),e.instancing&&a.enable(2),e.instancingColor&&a.enable(3),e.map&&a.enable(4),e.matcap&&a.enable(5),e.envMap&&a.enable(6),e.lightMap&&a.enable(7),e.aoMap&&a.enable(8),e.emissiveMap&&a.enable(9),e.bumpMap&&a.enable(10),e.normalMap&&a.enable(11),e.objectSpaceNormalMap&&a.enable(12),e.tangentSpaceNormalMap&&a.enable(13),e.clearcoat&&a.enable(14),e.clearcoatMap&&a.enable(15),e.clearcoatRoughnessMap&&a.enable(16),e.clearcoatNormalMap&&a.enable(17),e.displacementMap&&a.enable(18),e.specularMap&&a.enable(19),e.roughnessMap&&a.enable(20),e.metalnessMap&&a.enable(21),e.gradientMap&&a.enable(22),e.alphaMap&&a.enable(23),e.alphaTest&&a.enable(24),e.vertexColors&&a.enable(25),e.vertexAlphas&&a.enable(26),e.vertexUvs&&a.enable(27),e.vertexTangents&&a.enable(28),e.uvsVertexOnly&&a.enable(29),e.fog&&a.enable(30),t.push(a.mask),a.disableAll(),e.useFog&&a.enable(0),e.flatShading&&a.enable(1),e.logarithmicDepthBuffer&&a.enable(2),e.skinning&&a.enable(3),e.useVertexTexture&&a.enable(4),e.morphTargets&&a.enable(5),e.morphNormals&&a.enable(6),e.morphColors&&a.enable(7),e.premultipliedAlpha&&a.enable(8),e.shadowMapEnabled&&a.enable(9),e.physicallyCorrectLights&&a.enable(10),e.doubleSided&&a.enable(11),e.flipSided&&a.enable(12),e.depthPacking&&a.enable(13),e.dithering&&a.enable(14),e.specularIntensityMap&&a.enable(15),e.specularColorMap&&a.enable(16),e.transmission&&a.enable(17),e.transmissionMap&&a.enable(18),e.thicknessMap&&a.enable(19),e.sheen&&a.enable(20),e.sheenColorMap&&a.enable(21),e.sheenRoughnessMap&&a.enable(22),e.decodeVideoTexture&&a.enable(23),e.opaque&&a.enable(24),t.push(a.mask)}(n,e),n.push(t.outputEncoding)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){let e,n=g[t.type];if(n){let t=ga[n];e=Yo.clone(t.uniforms)}else e=t.uniforms;return e},acquireProgram:function(e,n){let r;for(let t=0,i=c.length;t<i;t++){let e=c[t];if(e.cacheKey===n){r=e,++r.usedTimes;break}}return void 0===r&&(r=new mc(t,n,e,s),c.push(r)),r},releaseProgram:function(t){if(0===--t.usedTimes){let e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:c,dispose:function(){l.dispose()}}}function bc(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function xc(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function wc(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Sc(){let t=[],e=0,n=[],r=[],i=[];function s(n,r,i,s,o,a){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},t[e]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=o,l.group=a),e++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){e=0,n.length=0,r.length=0,i.length=0},push:function(t,e,o,a,l,c){let u=s(t,e,o,a,l,c);o.transmission>0?r.push(u):!0===o.transparent?i.push(u):n.push(u)},unshift:function(t,e,o,a,l,c){let u=s(t,e,o,a,l,c);o.transmission>0?r.unshift(u):!0===o.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=e,r=t.length;n<r;n++){let e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||xc),r.length>1&&r.sort(e||wc),i.length>1&&i.sort(e||wc)}}}function Mc(){let t=new WeakMap;return{get:function(e,n){let r;return!1===t.has(e)?(r=new Sc,t.set(e,[r])):n>=t.get(e).length?(r=new Sc,t.get(e).push(r)):r=t.get(e)[n],r},dispose:function(){t=new WeakMap}}}function Ec(){let t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Yi,color:new Ui};break;case"SpotLight":n={position:new Yi,direction:new Yi,color:new Ui,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Yi,color:new Ui,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Yi,skyColor:new Ui,groundColor:new Ui};break;case"RectAreaLight":n={color:new Ui,position:new Yi,halfWidth:new Yi,halfHeight:new Yi}}return t[e.id]=n,n}}}var Tc=0;function Ac(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Cc(t,e){let n=new Ec,r=function(){let t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mi};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mi,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let l=0;l<9;l++)i.probe.push(new Yi);let s=new Yi,o=new As,a=new As;return{setup:function(s,o){let a=0,l=0,c=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let u=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0;s.sort(Ac);let y=!0!==o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){let e=s[t],o=e.color,_=e.intensity,b=e.distance,x=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*_*y,l+=o.g*_*y,c+=o.b*_*y;else if(e.isLightProbe)for(let t=0;t<9;t++)i.probe[t].addScaledVector(e.sh.coefficients[t],_);else if(e.isDirectionalLight){let t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){let t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.directionalShadow[u]=n,i.directionalShadowMap[u]=x,i.directionalShadowMatrix[u]=e.shadow.matrix,m++}i.directional[u]=t,u++}else if(e.isSpotLight){let t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(_*y),t.distance=b,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){let t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,i.spotShadow[d]=n,i.spotShadowMap[d]=x,i.spotShadowMatrix[d]=e.shadow.matrix,v++}i.spot[d]=t,d++}else if(e.isRectAreaLight){let t=n.get(e);t.color.copy(o).multiplyScalar(_),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),i.rectArea[p]=t,p++}else if(e.isPointLight){let t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){let t=e.shadow,n=r.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,i.pointShadow[h]=n,i.pointShadowMap[h]=x,i.pointShadowMatrix[h]=e.shadow.matrix,g++}i.point[h]=t,h++}else if(e.isHemisphereLight){let t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(_*y),t.groundColor.copy(e.groundColor).multiplyScalar(_*y),i.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=ma.LTC_FLOAT_1,i.rectAreaLTC2=ma.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=ma.LTC_HALF_1,i.rectAreaLTC2=ma.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=a,i.ambient[1]=l,i.ambient[2]=c;let _=i.hash;(_.directionalLength!==u||_.pointLength!==h||_.spotLength!==d||_.rectAreaLength!==p||_.hemiLength!==f||_.numDirectionalShadows!==m||_.numPointShadows!==g||_.numSpotShadows!==v)&&(i.directional.length=u,i.spot.length=d,i.rectArea.length=p,i.point.length=h,i.hemi.length=f,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=v,i.spotShadowMap.length=v,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotShadowMatrix.length=v,_.directionalLength=u,_.pointLength=h,_.spotLength=d,_.rectAreaLength=p,_.hemiLength=f,_.numDirectionalShadows=m,_.numPointShadows=g,_.numSpotShadows=v,i.version=Tc++)},setupView:function(t,e){let n=0,r=0,l=0,c=0,u=0,h=e.matrixWorldInverse;for(let d=0,p=t.length;d<p;d++){let e=t[d];if(e.isDirectionalLight){let t=i.directional[n];t.direction.setFromMatrixPosition(e.matrixWorld),s.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),n++}else if(e.isSpotLight){let t=i.spot[l];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(e.matrixWorld),s.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(h),l++}else if(e.isRectAreaLight){let t=i.rectArea[c];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),a.identity(),o.copy(e.matrixWorld),o.premultiply(h),a.extractRotation(o),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(e.isPointLight){let t=i.point[r];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),r++}else if(e.isHemisphereLight){let t=i.hemi[u];t.direction.setFromMatrixPosition(e.matrixWorld),t.direction.transformDirection(h),t.direction.normalize(),u++}}},state:i}}function Pc(t,e){let n=new Cc(t,e),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(t){n.setup(r,t)},setupLightsView:function(t){n.setupView(r,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){i.push(t)}}}function Ic(t,e){let n=new WeakMap;return{get:function(r){let i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(r)?(i=new Pc(t,e),n.set(r,[i])):s>=n.get(r).length?(i=new Pc(t,e),n.get(r).push(i)):i=n.get(r)[s],i},dispose:function(){n=new WeakMap}}}var Rc=class extends ho{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}};Rc.prototype.isMeshDepthMaterial=!0;var Lc=class extends ho{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Yi,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}};Lc.prototype.isMeshDistanceMaterial=!0;function Nc(t,e,n){let r=new ua,i=new Mi,s=new Mi,o=new Gi,a=new Rc({depthPacking:3201}),l=new Lc,c={},u=n.maxTextureSize,h={0:1,1:0,2:2},d=new Zo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Mi},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new Ao;f.setAttribute("position",new go(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new Go(f,d),g=this;function v(n,r){let i=e.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,p,m,null)}function y(e,n,r,i,s,o){let u=null,d=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(u=void 0!==d?d:!0===r.isPointLight?l:a,t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){let t=u.uuid,e=n.uuid,r=c[t];void 0===r&&(r={},c[t]=r);let i=r[e];void 0===i&&(i=u.clone(),r[e]=i),u=i}return u.visible=n.visible,u.wireframe=n.wireframe,u.side=3===o?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],u.alphaMap=n.alphaMap,u.alphaTest=n.alphaTest,u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.displacementMap=n.displacementMap,u.displacementScale=n.displacementScale,u.displacementBias=n.displacementBias,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,!0===r.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(r.matrixWorld),u.nearDistance=i,u.farDistance=s),u}function _(n,i,s,o,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);let r=e.update(n),i=n.material;if(Array.isArray(i)){let e=r.groups;for(let l=0,c=e.length;l<c;l++){let c=e[l],u=i[c.materialIndex];if(u&&u.visible){let e=y(n,u,o,s.near,s.far,a);t.renderBufferDirect(s,null,r,e,n,c)}}}else if(i.visible){let e=y(n,i,o,s.near,s.far,a);t.renderBufferDirect(s,null,r,e,n,null)}}let l=n.children;for(let t=0,e=l.length;t<e;t++)_(l[t],i,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,n,a){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===e.length)return;let l=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let p=0,f=e.length;p<f;p++){let l=e[p],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;i.copy(c.mapSize);let h=c.getFrameExtents();if(i.multiply(h),s.copy(c.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/h.x),i.x=s.x*h.x,c.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/h.y),i.y=s.y*h.y,c.mapSize.y=s.y)),null===c.map&&!c.isPointLightShadow&&3===this.type&&(c.map=new qi(i.x,i.y),c.map.texture.name=l.name+".shadowMap",c.mapPass=new qi(i.x,i.y),c.camera.updateProjectionMatrix()),null===c.map){let t={minFilter:Or,magFilter:Or,format:qr};c.map=new qi(i.x,i.y,t),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}t.setRenderTarget(c.map),t.clear();let f=c.getViewportCount();for(let t=0;t<f;t++){let e=c.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),c.updateMatrices(l,t),r=c.getFrustum(),_(n,a,c.camera,l,this.type)}!c.isPointLightShadow&&3===this.type&&v(c,a),c.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(l,c,h)}}function Oc(t,e,n){let r=n.isWebGL2;let i=new function(){let e=!1,n=new Gi,r=null,i=new Gi(0,0,0,0);return{setMask:function(n){r!==n&&!e&&(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,s,o,a){!0===a&&(e*=o,r*=o,s*=o),n.set(e,r,s,o),!1===i.equals(n)&&(t.clearColor(e,r,s,o),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){let e=!1,n=null,r=null,i=null;return{setTest:function(t){t?U(2929):F(2929)},setMask:function(r){n!==r&&!e&&(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},o=new function(){let e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(t){e||(t?U(2960):F(2960))},setMask:function(r){n!==r&&!e&&(t.stencilMask(r),n=r)},setFunc:function(e,n,o){(r!==e||i!==n||s!==o)&&(t.stencilFunc(e,n,o),r=e,i=n,s=o)},setOp:function(e,n,r){(o!==e||a!==n||l!==r)&&(t.stencilOp(e,n,r),o=e,a=n,l=r)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,c=null}}},a={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,v=null,y=null,_=null,b=!1,x=null,w=null,S=null,M=null,E=null,T=t.getParameter(35661),A=!1,C=0,P=t.getParameter(7938);-1!==P.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(P)[1]),A=C>=1):-1!==P.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),A=C>=2);let I=null,R={},L=t.getParameter(3088),N=t.getParameter(2978),O=(new Gi).fromArray(L),k=(new Gi).fromArray(N);function D(e,n,r){let i=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let o=0;o<r;o++)t.texImage2D(n+o,0,6408,1,1,0,6408,5121,i);return s}let z={};function U(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function F(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}z[3553]=D(3553,3553,1),z[34067]=D(34067,34069,6),i.setClear(0,0,0,1),s.setClear(1),o.setClear(0),U(2929),s.setFunc(3),j(!1),W(1),U(2884),H(0);let B={[fr]:32774,[mr]:32778,[gr]:32779};if(r)B[103]=32775,B[104]=32776;else{let t=e.get("EXT_blend_minmax");null!==t&&(B[103]=t.MIN_EXT,B[104]=t.MAX_EXT)}let V={[vr]:0,[yr]:1,[_r]:768,[xr]:770,[Ar]:776,[Er]:774,[Sr]:772,[br]:769,[wr]:771,[Tr]:775,[Mr]:773};function H(e,n,r,i,s,o,a,l){if(0!==e){if(!1===d&&(U(3042),d=!0),5===e)s=s||n,o=o||r,a=a||i,(n!==f||s!==v)&&(t.blendEquationSeparate(B[n],B[s]),f=n,v=s),(r!==m||i!==g||o!==y||a!==_)&&(t.blendFuncSeparate(V[r],V[i],V[o],V[a]),m=r,g=i,y=o,_=a),p=e,b=null;else if(e!==p||l!==b){if((f!==fr||v!==fr)&&(t.blendEquation(32774),f=fr,v=fr),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}m=null,g=null,y=null,_=null,p=e,b=l}}else!0===d&&(F(3042),d=!1)}function j(e){x!==e&&(e?t.frontFace(2304):t.frontFace(2305),x=e)}function W(e){0!==e?(U(2884),e!==w&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):F(2884),w=e}function G(e,n,r){e?(U(32823),(M!==n||E!==r)&&(t.polygonOffset(n,r),M=n,E=r)):F(32823)}function q(e){void 0===e&&(e=33984+T-1),I!==e&&(t.activeTexture(e),I=e)}return{buffers:{color:i,depth:s,stencil:o},enable:U,disable:F,bindFramebuffer:function(e,n){return l[e]!==n&&(t.bindFramebuffer(e,n),l[e]=n,r&&(36009===e&&(l[36160]=n),36160===e&&(l[36009]=n)),!0)},drawBuffers:function(r,i){let s=u,o=!1;if(r)if(s=c.get(i),void 0===s&&(s=[],c.set(i,s)),r.isWebGLMultipleRenderTargets){let t=r.texture;if(s.length!==t.length||36064!==s[0]){for(let e=0,n=t.length;e<n;e++)s[e]=36064+e;s.length=t.length,o=!0}}else 36064!==s[0]&&(s[0]=36064,o=!0);else 1029!==s[0]&&(s[0]=1029,o=!0);o&&(n.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return h!==e&&(t.useProgram(e),h=e,!0)},setBlending:H,setMaterial:function(t,e){2===t.side?F(2884):U(2884);let n=1===t.side;e&&(n=!n),j(n),1===t.blending&&!1===t.transparent?H(0):H(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),i.setMask(t.colorWrite);let r=t.stencilWrite;o.setTest(r),r&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),G(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?U(32926):F(32926)},setFlipSided:j,setCullFace:W,setLineWidth:function(e){e!==S&&(A&&t.lineWidth(e),S=e)},setPolygonOffset:G,setScissorTest:function(t){t?U(3089):F(3089)},activeTexture:q,bindTexture:function(e,n){null===I&&q();let r=R[I];void 0===r&&(r={type:void 0,texture:void 0},R[I]=r),(r.type!==e||r.texture!==n)&&(t.bindTexture(e,n||z[e]),r.type=e,r.texture=n)},unbindTexture:function(){let e=R[I];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===O.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),O.copy(e))},viewport:function(e){!1===k.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),k.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===r&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},I=null,R={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,v=null,y=null,_=null,b=!1,x=null,w=null,S=null,M=null,E=null,O.set(0,0,t.canvas.width,t.canvas.height),k.set(0,0,t.canvas.width,t.canvas.height),i.reset(),s.reset(),o.reset()}}}function kc(t,e,n,r,i,s,o){let a,l=i.isWebGL2,c=i.maxTextures,u=i.maxCubemapSize,h=i.maxTextureSize,d=i.maxSamples,p=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function y(t,e){return v?new OffscreenCanvas(t,e):Ai("canvas")}function _(t,e,n,r){let i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),i<1||!0===e){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let r=e?Si:Math.floor,s=r(i*t.width),o=r(i*t.height);void 0===a&&(a=y(s,o));let l=n?y(s,o):a;return l.width=s,l.height=o,l.getContext("2d").drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),l}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function b(t){return wi(t.width)&&wi(t.height)}function x(t,e){return t.generateMipmaps&&e&&t.minFilter!==Or&&t.minFilter!==zr}function w(e){t.generateMipmap(e)}function S(n,r,i,s){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===l)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let a=r;return 6403===r&&(5126===i&&(a=33326),5131===i&&(a=33325),5121===i&&(a=33321)),33319===r&&(5126===i&&(a=33328),5131===i&&(a=33327),5121===i&&(a=33323)),6408===r&&(5126===i&&(a=34836),5131===i&&(a=34842),5121===i&&(a=s===ai&&!1===o?35907:32856),32819===i&&(a=32854),32820===i&&(a=32855)),(33325===a||33326===a||33327===a||33328===a||34842===a||34836===a)&&e.get("EXT_color_buffer_float"),a}function M(t,e,n){return!0===x(t,n)||t.isFramebufferTexture&&t.minFilter!==Or&&t.minFilter!==zr?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function E(t){return t===Or||1004===t||1005===t?9728:9729}function T(t){let e=t.target;e.removeEventListener("dispose",T),function(t){let e=r.get(t);if(void 0===e.__webglInit)return;let n=t.source,i=g.get(n);if(i){let r=i[e.__cacheKey];r.usedTimes--,0===r.usedTimes&&C(t),0===Object.keys(i).length&&g.delete(n)}r.remove(t)}(e),e.isVideoTexture&&m.delete(e)}function A(e){let n=e.target;n.removeEventListener("dispose",A),function(e){let n=e.texture,i=r.get(e),s=r.get(n);if(void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let r=0;r<6;r++)t.deleteFramebuffer(i.__webglFramebuffer[r]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[r]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&t.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let a=0,l=n.length;a<l;a++){let e=r.get(n[a]);e.__webglTexture&&(t.deleteTexture(e.__webglTexture),o.memory.textures--),r.remove(n[a])}r.remove(n),r.remove(e)}(n)}function C(e){let n=r.get(e);t.deleteTexture(n.__webglTexture);let i=e.source;delete g.get(i)[n.__cacheKey],o.memory.textures--}let P=0;function I(t,e){let i=r.get(t);if(t.isVideoTexture&&function(t){let e=o.render.frame;m.get(t)!==e&&(m.set(t,e),t.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&i.__version!==t.version){let n=t.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void k(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,i.__webglTexture)}let R={[Rr]:10497,[Lr]:33071,[Nr]:33648},L={[Or]:9728,[kr]:9984,[Dr]:9986,[zr]:9729,[Ur]:9985,[Fr]:9987};function N(n,s,o){if(o?(t.texParameteri(n,10242,R[s.wrapS]),t.texParameteri(n,10243,R[s.wrapT]),(32879===n||35866===n)&&t.texParameteri(n,32882,R[s.wrapR]),t.texParameteri(n,10240,L[s.magFilter]),t.texParameteri(n,10241,L[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),(32879===n||35866===n)&&t.texParameteri(n,32882,33071),(s.wrapS!==Lr||s.wrapT!==Lr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,E(s.magFilter)),t.texParameteri(n,10241,E(s.minFilter)),s.minFilter!==Or&&s.minFilter!==zr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){let o=e.get("EXT_texture_filter_anisotropic");if(s.type===jr&&!1===e.has("OES_texture_float_linear")||!1===l&&s.type===Wr&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||r.get(s).__currentAnisotropy)&&(t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function O(e,n){let r=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",T));let i=n.source,s=g.get(i);void 0===s&&(s={},g.set(i,s));let a=function(t){let e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(n);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,r=!0),s[a].usedTimes++;let i=s[e.__cacheKey];void 0!==i&&(s[e.__cacheKey].usedTimes--,0===i.usedTimes&&C(n)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return r}function k(e,r,i){let o=3553;r.isDataArrayTexture&&(o=35866),r.isData3DTexture&&(o=32879);let a=O(e,r),c=r.source;if(n.activeTexture(33984+i),n.bindTexture(o,e.__webglTexture),c.version!==c.__currentVersion||!0===a){t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);let i=function(t){return!l&&(t.wrapS!==Lr||t.wrapT!==Lr||t.minFilter!==Or&&t.minFilter!==zr)}(r)&&!1===b(r.image),a=_(r.image,i,!1,h);a=V(r,a);let u=b(a)||l,d=s.convert(r.format,r.encoding),p=s.convert(r.type),f=S(r.internalFormat,d,p,r.encoding,r.isVideoTexture);N(o,r,u);let m,g=r.mipmaps,v=l&&!0!==r.isVideoTexture,y=void 0===e.__version,E=M(r,a,u);if(r.isDepthTexture)f=6402,l?f=r.type===jr?36012:r.type===Hr?33190:r.type===Gr?35056:33189:r.type===jr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===$r&&6402===f&&r.type!==Vr&&r.type!==Hr&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Vr,p=s.convert(r.type)),r.format===Xr&&6402===f&&(f=34041,r.type!==Gr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Gr,p=s.convert(r.type))),v&&y?n.texStorage2D(3553,1,f,a.width,a.height):n.texImage2D(3553,0,f,a.width,a.height,0,d,p,null);else if(r.isDataTexture)if(g.length>0&&u){v&&y&&n.texStorage2D(3553,E,f,g[0].width,g[0].height);for(let t=0,e=g.length;t<e;t++)m=g[t],v?n.texSubImage2D(3553,t,0,0,m.width,m.height,d,p,m.data):n.texImage2D(3553,t,f,m.width,m.height,0,d,p,m.data);r.generateMipmaps=!1}else v?(y&&n.texStorage2D(3553,E,f,a.width,a.height),n.texSubImage2D(3553,0,0,0,a.width,a.height,d,p,a.data)):n.texImage2D(3553,0,f,a.width,a.height,0,d,p,a.data);else if(r.isCompressedTexture){v&&y&&n.texStorage2D(3553,E,f,g[0].width,g[0].height);for(let t=0,e=g.length;t<e;t++)m=g[t],r.format!==qr?null!==d?v?n.compressedTexSubImage2D(3553,t,0,0,m.width,m.height,d,m.data):n.compressedTexImage2D(3553,t,f,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):v?n.texSubImage2D(3553,t,0,0,m.width,m.height,d,p,m.data):n.texImage2D(3553,t,f,m.width,m.height,0,d,p,m.data)}else if(r.isDataArrayTexture)v?(y&&n.texStorage3D(35866,E,f,a.width,a.height,a.depth),n.texSubImage3D(35866,0,0,0,0,a.width,a.height,a.depth,d,p,a.data)):n.texImage3D(35866,0,f,a.width,a.height,a.depth,0,d,p,a.data);else if(r.isData3DTexture)v?(y&&n.texStorage3D(32879,E,f,a.width,a.height,a.depth),n.texSubImage3D(32879,0,0,0,0,a.width,a.height,a.depth,d,p,a.data)):n.texImage3D(32879,0,f,a.width,a.height,a.depth,0,d,p,a.data);else if(r.isFramebufferTexture)v&&y?n.texStorage2D(3553,E,f,a.width,a.height):n.texImage2D(3553,0,f,a.width,a.height,0,d,p,null);else if(g.length>0&&u){v&&y&&n.texStorage2D(3553,E,f,g[0].width,g[0].height);for(let t=0,e=g.length;t<e;t++)m=g[t],v?n.texSubImage2D(3553,t,0,0,d,p,m):n.texImage2D(3553,t,f,d,p,m);r.generateMipmaps=!1}else v?(y&&n.texStorage2D(3553,E,f,a.width,a.height),n.texSubImage2D(3553,0,0,0,d,p,a)):n.texImage2D(3553,0,f,d,p,a);x(r,u)&&w(o),c.__currentVersion=c.version,r.onUpdate&&r.onUpdate(r)}e.__version=r.version}function D(e,i,o,a,l){let c=s.convert(o.format,o.encoding),u=s.convert(o.type),h=S(o.internalFormat,c,u,o.encoding);r.get(i).__hasExternalTextures||(32879===l||35866===l?n.texImage3D(l,0,h,i.width,i.height,i.depth,0,c,u,null):n.texImage2D(l,0,h,i.width,i.height,0,c,u,null)),n.bindFramebuffer(36160,e),B(i)?p.framebufferTexture2DMultisampleEXT(36160,a,l,r.get(o).__webglTexture,0,F(i)):t.framebufferTexture2D(36160,a,l,r.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function z(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r||B(n)){let e=n.depthTexture;e&&e.isDepthTexture&&(e.type===jr?i=36012:e.type===Hr&&(i=33190));let r=F(n);B(n)?p.renderbufferStorageMultisampleEXT(36161,r,i,n.width,n.height):t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else t.renderbufferStorage(36161,i,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){let i=F(n);r&&!1===B(n)?t.renderbufferStorageMultisample(36161,i,35056,n.width,n.height):B(n)?p.renderbufferStorageMultisampleEXT(36161,i,35056,n.width,n.height):t.renderbufferStorage(36161,34041,n.width,n.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{let e=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,i=s.convert(e.format,e.encoding),o=s.convert(e.type),a=S(e.internalFormat,i,o,e.encoding),l=F(n);r&&!1===B(n)?t.renderbufferStorageMultisample(36161,l,a,n.width,n.height):B(n)?p.renderbufferStorageMultisampleEXT(36161,l,a,n.width,n.height):t.renderbufferStorage(36161,a,n.width,n.height)}t.bindRenderbuffer(36161,null)}function U(e){let i=r.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!i.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(i.depthTexture).__webglTexture||i.depthTexture.image.width!==i.width||i.depthTexture.image.height!==i.height)&&(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),I(i.depthTexture,0);let s=r.get(i.depthTexture).__webglTexture,o=F(i);if(i.depthTexture.format===$r)B(i)?p.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,o):t.framebufferTexture2D(36160,36096,3553,s,0);else{if(i.depthTexture.format!==Xr)throw new Error("Unknown depthTexture format");B(i)?p.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,o):t.framebufferTexture2D(36160,33306,3553,s,0)}}(i.__webglFramebuffer,e)}else if(s){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(36160,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=t.createRenderbuffer(),z(i.__webglDepthbuffer[r],e,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),z(i.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}function F(t){return Math.min(d,t.samples)}function B(t){let n=r.get(t);return l&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function V(t,n){let r=t.encoding,i=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===fi||r!==oi&&(r===ai?!1===l?!0===e.has("EXT_sRGB")&&i===qr?(t.format=fi,t.minFilter=zr,t.generateMipmaps=!1):n=Bi.sRGBToLinear(n):(i!==qr||s!==Br)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)),n}this.allocateTextureUnit=function(){let t=P;return t>=c&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+c),P+=1,t},this.resetTextureUnits=function(){P=0},this.setTexture2D=I,this.setTexture2DArray=function(t,e){let i=r.get(t);t.version>0&&i.__version!==t.version?k(i,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){let i=r.get(t);t.version>0&&i.__version!==t.version?k(i,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=function(e,i){let o=r.get(e);e.version>0&&o.__version!==e.version?function(e,r,i){if(6!==r.image.length)return;let o=O(e,r),a=r.source;if(n.activeTexture(33984+i),n.bindTexture(34067,e.__webglTexture),a.version!==a.__currentVersion||!0===o){t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),t.pixelStorei(37443,0);let i=r.isCompressedTexture||r.image[0].isCompressedTexture,o=r.image[0]&&r.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=i||o?o?r.image[t].image:r.image[t]:_(r.image[t],!1,!0,u),c[t]=V(r,c[t]);let h,d=c[0],p=b(d)||l,f=s.convert(r.format,r.encoding),m=s.convert(r.type),g=S(r.internalFormat,f,m,r.encoding),v=l&&!0!==r.isVideoTexture,y=void 0===e.__version,E=M(r,d,p);if(N(34067,r,p),i){v&&y&&n.texStorage2D(34067,E,g,d.width,d.height);for(let t=0;t<6;t++){h=c[t].mipmaps;for(let e=0;e<h.length;e++){let i=h[e];r.format!==qr?null!==f?v?n.compressedTexSubImage2D(34069+t,e,0,0,i.width,i.height,f,i.data):n.compressedTexImage2D(34069+t,e,g,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):v?n.texSubImage2D(34069+t,e,0,0,i.width,i.height,f,m,i.data):n.texImage2D(34069+t,e,g,i.width,i.height,0,f,m,i.data)}}}else{h=r.mipmaps,v&&y&&(h.length>0&&E++,n.texStorage2D(34067,E,g,c[0].width,c[0].height));for(let t=0;t<6;t++)if(o){v?n.texSubImage2D(34069+t,0,0,0,c[t].width,c[t].height,f,m,c[t].data):n.texImage2D(34069+t,0,g,c[t].width,c[t].height,0,f,m,c[t].data);for(let e=0;e<h.length;e++){let r=h[e].image[t].image;v?n.texSubImage2D(34069+t,e+1,0,0,r.width,r.height,f,m,r.data):n.texImage2D(34069+t,e+1,g,r.width,r.height,0,f,m,r.data)}}else{v?n.texSubImage2D(34069+t,0,0,0,f,m,c[t]):n.texImage2D(34069+t,0,g,f,m,c[t]);for(let e=0;e<h.length;e++){let r=h[e];v?n.texSubImage2D(34069+t,e+1,0,0,f,m,r.image[t]):n.texImage2D(34069+t,e+1,g,f,m,r.image[t])}}}x(r,p)&&w(34067),a.__currentVersion=a.version,r.onUpdate&&r.onUpdate(r)}e.__version=r.version}(o,e,i):(n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture))},this.rebindTextures=function(t,e,n){let i=r.get(t);void 0!==e&&D(i.__webglFramebuffer,t,t.texture,36064,3553),void 0!==n&&U(t)},this.setupRenderTarget=function(e){let a=e.texture,c=r.get(e),u=r.get(a);e.addEventListener("dispose",A),!0!==e.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=t.createTexture()),u.__version=a.version,o.memory.textures++);let h=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=b(e)||l;if(h){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else if(c.__webglFramebuffer=t.createFramebuffer(),d)if(i.drawBuffers){let n=e.texture;for(let e=0,i=n.length;e<i;e++){let i=r.get(n[e]);void 0===i.__webglTexture&&(i.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(l&&e.samples>0&&!1===B(e)){c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer);let r=s.convert(a.format,a.encoding),i=s.convert(a.type),o=S(a.internalFormat,r,i,a.encoding),l=F(e);t.renderbufferStorageMultisample(36161,l,o,e.width,e.height),n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),z(c.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}if(h){n.bindTexture(34067,u.__webglTexture),N(34067,a,p);for(let t=0;t<6;t++)D(c.__webglFramebuffer[t],e,a,36064,34069+t);x(a,p)&&w(34067),n.unbindTexture()}else if(d){let t=e.texture;for(let i=0,s=t.length;i<s;i++){let s=t[i],o=r.get(s);n.bindTexture(3553,o.__webglTexture),N(3553,s,p),D(c.__webglFramebuffer,e,s,36064+i,3553),x(s,p)&&w(3553)}n.unbindTexture()}else{let t=3553;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(l?t=e.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(t,u.__webglTexture),N(t,a,p),D(c.__webglFramebuffer,e,a,36064,t),x(a,p)&&w(t),n.unbindTexture()}e.depthBuffer&&U(e)},this.updateRenderTargetMipmap=function(t){let e=b(t)||l,i=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=i.length;s<o;s++){let o=i[s];if(x(o,e)){let e=t.isWebGLCubeRenderTarget?34067:3553,i=r.get(o).__webglTexture;n.bindTexture(e,i),w(e),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(l&&e.samples>0&&!1===B(e)){let i=e.width,s=e.height,o=16384,a=[36064],l=e.stencilBuffer?33306:36096;e.depthBuffer&&a.push(l);let c=r.get(e),u=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;!1===u&&(e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024)),n.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,c.__webglFramebuffer),!0===u&&(t.invalidateFramebuffer(36008,[l]),t.invalidateFramebuffer(36009,[l])),t.blitFramebuffer(0,0,i,s,0,0,i,s,o,9728),f&&t.invalidateFramebuffer(36008,a),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=U,this.setupFrameBufferTexture=D,this.useMultisampledRTT=B}function Dc(t,e,n){let r=n.isWebGL2;return{convert:function(t){let n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t===Br)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1010===t)return 5120;if(1011===t)return 5122;if(t===Vr)return 5123;if(1013===t)return 5124;if(t===Hr)return 5125;if(t===jr)return 5126;if(t===Wr)return r?5131:(n=e.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(1021===t)return 6406;if(t===qr)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===$r)return 6402;if(t===Xr)return 34041;if(1028===t)return 6403;if(1022===t)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(t===fi)return n=e.get("EXT_sRGB"),null!==n?n.SRGB_ALPHA_EXT:null;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1033===t)return 36249;if(t===Jr||t===Yr||t===Zr||t===Kr)if(i===ai){if(n=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===n)return null;if(t===Jr)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===Yr)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===Zr)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===Kr)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(t===Jr)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Yr)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Zr)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Kr)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(35840===t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===t||37496===t){if(n=e.get("WEBGL_compressed_texture_etc"),null===n)return null;if(37492===t)return i===ai?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(37496===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}if(37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t){if(n=e.get("WEBGL_compressed_texture_astc"),null===n)return null;if(37808===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===t)return i===ai?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===t){if(n=e.get("EXT_texture_compression_bptc"),null===n)return null;if(36492===t)return i===ai?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT}return t===Gr?r?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}var zc=class extends Qo{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.cameras=t}};zc.prototype.isArrayCamera=!0;var Uc=class extends Ks{constructor(){super(),this.type="Group"}};Uc.prototype.isGroup=!0;var Fc={type:"move"},Bc=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Uc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Uc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Yi,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Yi),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Uc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Yi,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Yi),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let r=null,i=null,s=null,o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==o&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Fc))),l&&t.hand){s=!0;for(let s of t.hand.values()){let t=e.getJointPose(s,n);if(void 0===l.joints[s.jointName]){let t=new Uc;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[s.jointName]=t,l.add(t)}let r=l.joints[s.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}let r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=r.position.distanceTo(i.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==s),this}},Vc=class extends Wi{constructor(t,e,n,r,i,s,o,a,l,c){if((c=void 0!==c?c:$r)!==$r&&c!==Xr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===$r&&(n=Vr),void 0===n&&c===Xr&&(n=Gr),super(null,r,i,s,o,a,c,n,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:Or,this.minFilter=void 0!==a?a:Or,this.flipY=!1,this.generateMipmaps=!1}};Vc.prototype.isDepthTexture=!0;var Hc=class extends mi{constructor(t,e){super();let n=this,r=null,i=1,s=null,o="local-floor",a=null,l=null,c=null,u=null,h=null,d=e.getContextAttributes(),p=null,f=null,m=[],g=new Map,v=new Qo;v.layers.enable(1),v.viewport=new Gi;let y=new Qo;y.layers.enable(2),y.viewport=new Gi;let _=[v,y],b=new zc;b.layers.enable(1),b.layers.enable(2);let x=null,w=null;function S(t){let e=g.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function M(){g.forEach((function(t,e){t.disconnect(e)})),g.clear(),x=null,w=null,t.setRenderTarget(p),u=null,c=null,l=null,r=null,f=null,I.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function E(t){let e=r.inputSources;for(let n=0;n<m.length;n++)g.set(e[n],m[n]);for(let n=0;n<t.removed.length;n++){let e=t.removed[n],r=g.get(e);r&&(r.dispatchEvent({type:"disconnected",data:e}),g.delete(e))}for(let n=0;n<t.added.length;n++){let e=t.added[n],r=g.get(e);r&&r.dispatchEvent({type:"connected",data:e})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=m[t];return void 0===e&&(e=new Bc,m[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=m[t];return void 0===e&&(e=new Bc,m[t]=e),e.getGripSpace()},this.getHand=function(t){let e=m[t];return void 0===e&&(e=new Bc,m[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getBaseLayer=function(){return null!==c?c:u},this.getBinding=function(){return l},this.getFrame=function(){return h},this.getSession=function(){return r},this.setSession=async function(a){if(r=a,null!==r){if(p=t.getRenderTarget(),r.addEventListener("select",S),r.addEventListener("selectstart",S),r.addEventListener("selectend",S),r.addEventListener("squeeze",S),r.addEventListener("squeezestart",S),r.addEventListener("squeezeend",S),r.addEventListener("end",M),r.addEventListener("inputsourceschange",E),!0!==d.xrCompatible&&await e.makeXRCompatible(),void 0===r.renderState.layers||!1===t.capabilities.isWebGL2){let n={antialias:void 0!==r.renderState.layers||d.antialias,alpha:d.alpha,depth:d.depth,stencil:d.stencil,framebufferScaleFactor:i};u=new XRWebGLLayer(r,e,n),r.updateRenderState({baseLayer:u}),f=new qi(u.framebufferWidth,u.framebufferHeight,{format:qr,type:Br,encoding:t.outputEncoding})}else{let n=null,s=null,o=null;d.depth&&(o=d.stencil?35056:33190,n=d.stencil?Xr:$r,s=d.stencil?Gr:Vr);let a={colorFormat:t.outputEncoding===ai?35907:32856,depthFormat:o,scaleFactor:i};l=new XRWebGLBinding(r,e),c=l.createProjectionLayer(a),r.updateRenderState({layers:[c]}),f=new qi(c.textureWidth,c.textureHeight,{format:qr,type:Br,depthTexture:new Vc(c.textureWidth,c.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:d.stencil,encoding:t.outputEncoding,samples:d.antialias?4:0}),t.properties.get(f).__ignoreDepthValues=c.ignoreDepthValues}f.isXRRenderTarget=!0,this.setFoveation(1),s=await r.requestReferenceSpace(o),I.setContext(r),I.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};let T=new Yi,A=new Yi;function C(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===r)return;b.near=y.near=v.near=t.near,b.far=y.far=v.far=t.far,(x!==b.near||w!==b.far)&&(r.updateRenderState({depthNear:b.near,depthFar:b.far}),x=b.near,w=b.far);let e=t.parent,n=b.cameras;C(b,e);for(let r=0;r<n.length;r++)C(n[r],e);b.matrixWorld.decompose(b.position,b.quaternion,b.scale),t.position.copy(b.position),t.quaternion.copy(b.quaternion),t.scale.copy(b.scale),t.matrix.copy(b.matrix),t.matrixWorld.copy(b.matrixWorld);let i=t.children;for(let r=0,s=i.length;r<s;r++)i[r].updateMatrixWorld(!0);2===n.length?function(t,e,n){T.setFromMatrixPosition(e.matrixWorld),A.setFromMatrixPosition(n.matrixWorld);let r=T.distanceTo(A),i=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(s[8]+1)/s[0],d=o*u,p=o*h,f=r/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();let g=o+f,v=a+f,y=d-m,_=p+(r-m),b=l*a/v*g,x=c*a/v*g;t.projectionMatrix.makePerspective(y,_,b,x,g,v)}(b,v,y):b.projectionMatrix.copy(v.projectionMatrix)},this.getCamera=function(){return b},this.getFoveation=function(){return null!==c?c.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(t){null!==c&&(c.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)};let P=null;let I=new ha;I.setAnimationLoop((function(e,n){if(a=n.getViewerPose(s),h=n,null!==a){let e=a.views;null!==u&&(t.setRenderTargetFramebuffer(f,u.framebuffer),t.setRenderTarget(f));let n=!1;e.length!==b.cameras.length&&(b.cameras.length=0,n=!0);for(let r=0;r<e.length;r++){let i=e[r],s=null;if(null!==u)s=u.getViewport(i);else{let e=l.getViewSubImage(c,i);s=e.viewport,0===r&&(t.setRenderTargetTextures(f,e.colorTexture,c.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(f))}let o=_[r];o.matrix.fromArray(i.transform.matrix),o.projectionMatrix.fromArray(i.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===r&&b.matrix.copy(o.matrix),!0===n&&b.cameras.push(o)}}let i=r.inputSources;for(let t=0;t<m.length;t++){let e=m[t],r=i[t];e.update(r,n,s)}P&&P(e,n),h=null})),this.setAnimationLoop=function(t){P=t},this.dispose=function(){}}};function jc(t,e){function n(n,r){n.opacity.value=r.opacity,r.color&&n.diffuse.value.copy(r.color),r.emissive&&n.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(n.map.value=r.map),r.alphaMap&&(n.alphaMap.value=r.alphaMap),r.bumpMap&&(n.bumpMap.value=r.bumpMap,n.bumpScale.value=r.bumpScale,1===r.side&&(n.bumpScale.value*=-1)),r.displacementMap&&(n.displacementMap.value=r.displacementMap,n.displacementScale.value=r.displacementScale,n.displacementBias.value=r.displacementBias),r.emissiveMap&&(n.emissiveMap.value=r.emissiveMap),r.normalMap&&(n.normalMap.value=r.normalMap,n.normalScale.value.copy(r.normalScale),1===r.side&&n.normalScale.value.negate()),r.specularMap&&(n.specularMap.value=r.specularMap),r.alphaTest>0&&(n.alphaTest.value=r.alphaTest);let i,s,o=e.get(r).envMap;if(o&&(n.envMap.value=o,n.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,n.reflectivity.value=r.reflectivity,n.ior.value=r.ior,n.refractionRatio.value=r.refractionRatio),r.lightMap){n.lightMap.value=r.lightMap;let e=!0!==t.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=r.lightMapIntensity*e}r.aoMap&&(n.aoMap.value=r.aoMap,n.aoMapIntensity.value=r.aoMapIntensity),r.map?i=r.map:r.specularMap?i=r.specularMap:r.displacementMap?i=r.displacementMap:r.normalMap?i=r.normalMap:r.bumpMap?i=r.bumpMap:r.roughnessMap?i=r.roughnessMap:r.metalnessMap?i=r.metalnessMap:r.alphaMap?i=r.alphaMap:r.emissiveMap?i=r.emissiveMap:r.clearcoatMap?i=r.clearcoatMap:r.clearcoatNormalMap?i=r.clearcoatNormalMap:r.clearcoatRoughnessMap?i=r.clearcoatRoughnessMap:r.specularIntensityMap?i=r.specularIntensityMap:r.specularColorMap?i=r.specularColorMap:r.transmissionMap?i=r.transmissionMap:r.thicknessMap?i=r.thicknessMap:r.sheenColorMap?i=r.sheenColorMap:r.sheenRoughnessMap&&(i=r.sheenRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),n.uvTransform.value.copy(i.matrix)),r.aoMap?s=r.aoMap:r.lightMap&&(s=r.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),n.uv2Transform.value.copy(s.matrix))}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,s,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?n(t,r):r.isMeshToonMaterial?(n(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,r)):r.isMeshPhongMaterial?(n(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,r)):r.isMeshStandardMaterial?(n(t,r),function(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}(t,r),r.isMeshPhysicalMaterial&&function(t,e,n){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap)),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate())),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,r,o)):r.isMeshMatcapMaterial?(n(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,r)):r.isMeshDepthMaterial?n(t,r):r.isMeshDistanceMaterial?(n(t,r),function(t,e){t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,r)):r.isMeshNormalMaterial?n(t,r):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,r,i,s):r.isSpriteMaterial?function(t,e){let n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Wc(){let t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=void 0!==e.canvas?e.canvas:function(){let t=Ai("canvas");return t.style.display="block",t}(),r=void 0!==e.context?e.context:null,i=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;t=void 0!==e.context?r.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let h=null,d=null,p=[],f=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=oi,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,_=null,b=-1,x=null,w=new Gi,S=new Gi,M=null,E=n.width,T=n.height,A=1,C=null,P=null,I=new Gi(0,0,E,T),R=new Gi(0,0,E,T),L=!1,N=new ua,O=!1,k=!1,D=null,z=new As,U=new Mi,F=new Yi,B={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function V(){return null===_?A:1}let H,j,W,G,q,$,X,J,Y,Z,K,Q,tt,et,nt,rt,it,st,ot,at,lt,ct,ut,ht=r;function dt(t,e){for(let r=0;r<t.length;r++){let i=t[r],s=n.getContext(i,e);if(null!==s)return s}return null}try{let t={alpha:!0,depth:i,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${pr}`),n.addEventListener("webglcontextlost",mt,!1),n.addEventListener("webglcontextrestored",gt,!1),null===ht){let e=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&e.shift(),ht=dt(e,t),null===ht)throw dt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ht.getShaderPrecisionFormat&&(ht.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ct){throw console.error("THREE.WebGLRenderer: "+Ct.message),Ct}function pt(){H=new Fa(ht),j=new ba(ht,H,e),H.init(j),ct=new Dc(ht,H,j),W=new Oc(ht,H,j),G=new Ha,q=new bc,$=new kc(ht,H,W,q,j,ct,G),X=new wa(m),J=new Ua(m),Y=new da(ht,j),ut=new ya(ht,H,Y,j),Z=new Ba(ht,Y,G,ut),K=new $a(ht,Z,Y,G),ot=new qa(ht,j,$),rt=new xa(q),Q=new _c(m,X,J,H,j,ut,rt),tt=new jc(m,q),et=new Mc,nt=new Ic(H,j),st=new va(m,X,W,K,t,a),it=new Nc(m,K,j),at=new _a(ht,H,G,j),lt=new Va(ht,H,G,j),G.programs=Q.programs,m.capabilities=j,m.extensions=H,m.properties=q,m.renderLists=et,m.shadowMap=it,m.state=W,m.info=G}pt();let ft=new Hc(m,ht);function mt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function gt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let t=G.autoReset,e=it.enabled,n=it.autoUpdate,r=it.needsUpdate,i=it.type;pt(),G.autoReset=t,it.enabled=e,it.autoUpdate=n,it.needsUpdate=r,it.type=i}function vt(t){let e=t.target;e.removeEventListener("dispose",vt),function(t){(function(t){let e=q.get(t).programs;void 0!==e&&(e.forEach((function(t){Q.releaseProgram(t)})),t.isShaderMaterial&&Q.releaseShaderCache(t))})(t),q.remove(t)}(e)}this.xr=ft,this.getContext=function(){return ht},this.getContextAttributes=function(){return ht.getContextAttributes()},this.forceContextLoss=function(){let t=H.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){let t=H.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(t){void 0!==t&&(A=t,this.setSize(E,T,!1))},this.getSize=function(t){return t.set(E,T)},this.setSize=function(t,e,r){ft.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=t,T=e,n.width=Math.floor(t*A),n.height=Math.floor(e*A),!1!==r&&(n.style.width=t+"px",n.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return t.set(E*A,T*A).floor()},this.setDrawingBufferSize=function(t,e,r){E=t,T=e,A=r,n.width=Math.floor(t*r),n.height=Math.floor(e*r),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return t.copy(w)},this.getViewport=function(t){return t.copy(I)},this.setViewport=function(t,e,n,r){t.isVector4?I.set(t.x,t.y,t.z,t.w):I.set(t,e,n,r),W.viewport(w.copy(I).multiplyScalar(A).floor())},this.getScissor=function(t){return t.copy(R)},this.setScissor=function(t,e,n,r){t.isVector4?R.set(t.x,t.y,t.z,t.w):R.set(t,e,n,r),W.scissor(S.copy(R).multiplyScalar(A).floor())},this.getScissorTest=function(){return L},this.setScissorTest=function(t){W.setScissorTest(L=t)},this.setOpaqueSort=function(t){C=t},this.setTransparentSort=function(t){P=t},this.getClearColor=function(t){return t.copy(st.getClearColor())},this.setClearColor=function(){st.setClearColor.apply(st,arguments)},this.getClearAlpha=function(){return st.getClearAlpha()},this.setClearAlpha=function(){st.setClearAlpha.apply(st,arguments)},this.clear=function(){let t=0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(t|=16384),(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(t|=256),(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(t|=1024),ht.clear(t)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",mt,!1),n.removeEventListener("webglcontextrestored",gt,!1),et.dispose(),nt.dispose(),q.dispose(),X.dispose(),J.dispose(),K.dispose(),ut.dispose(),Q.dispose(),ft.dispose(),ft.removeEventListener("sessionstart",_t),ft.removeEventListener("sessionend",bt),D&&(D.dispose(),D=null),xt.stop()},this.renderBufferDirect=function(t,e,n,r,i,s){null===e&&(e=B);let o=i.isMesh&&i.matrixWorld.determinant()<0,a=function(t,e,n,r,i){!0!==e.isScene&&(e=B),$.resetTextureUnits();let s=e.fog,o=r.isMeshStandardMaterial?e.environment:null,a=null===_?m.outputEncoding:!0===_.isXRRenderTarget?_.texture.encoding:oi,l=(r.isMeshStandardMaterial?J:X).get(r.envMap||o),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!r.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,p=!!n.morphAttributes.normal,f=!!n.morphAttributes.color,g=r.toneMapped?m.toneMapping:0,v=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==v?v.length:0,w=q.get(r),S=d.state.lights;if(!0===O&&(!0===k||t!==x)){let e=t===x&&r.id===b;rt.setState(r,t,e)}let M=!1;r.version===w.__version?(w.needsLights&&w.lightsStateVersion!==S.state.version||w.outputEncoding!==a||i.isInstancedMesh&&!1===w.instancing||!i.isInstancedMesh&&!0===w.instancing||i.isSkinnedMesh&&!1===w.skinning||!i.isSkinnedMesh&&!0===w.skinning||w.envMap!==l||r.fog&&w.fog!==s||void 0!==w.numClippingPlanes&&(w.numClippingPlanes!==rt.numPlanes||w.numIntersection!==rt.numIntersection)||w.vertexAlphas!==c||w.vertexTangents!==u||w.morphTargets!==h||w.morphNormals!==p||w.morphColors!==f||w.toneMapping!==g||!0===j.isWebGL2&&w.morphTargetsCount!==y)&&(M=!0):(M=!0,w.__version=r.version);let E=w.currentProgram;!0===M&&(E=Tt(r,e,i));let C=!1,P=!1,I=!1,R=E.getUniforms(),L=w.uniforms;if(W.useProgram(E.program)&&(C=!0,P=!0,I=!0),r.id!==b&&(b=r.id,P=!0),C||x!==t){if(R.setValue(ht,"projectionMatrix",t.projectionMatrix),j.logarithmicDepthBuffer&&R.setValue(ht,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),x!==t&&(x=t,P=!0,I=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){let e=R.map.cameraPosition;void 0!==e&&e.setValue(ht,F.setFromMatrixPosition(t.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&R.setValue(ht,"isOrthographic",!0===t.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh)&&R.setValue(ht,"viewMatrix",t.matrixWorldInverse)}if(i.isSkinnedMesh){R.setOptional(ht,i,"bindMatrix"),R.setOptional(ht,i,"bindMatrixInverse");let t=i.skeleton;t&&(j.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),R.setValue(ht,"boneTexture",t.boneTexture,$),R.setValue(ht,"boneTextureSize",t.boneTextureSize)):R.setOptional(ht,t,"boneMatrices"))}let N=n.morphAttributes;return(void 0!==N.position||void 0!==N.normal||void 0!==N.color&&!0===j.isWebGL2)&&ot.update(i,n,r,E),(P||w.receiveShadow!==i.receiveShadow)&&(w.receiveShadow=i.receiveShadow,R.setValue(ht,"receiveShadow",i.receiveShadow)),P&&(R.setValue(ht,"toneMappingExposure",m.toneMappingExposure),w.needsLights&&function(t,e){t.ambientLightColor.needsUpdate=e,t.lightProbe.needsUpdate=e,t.directionalLights.needsUpdate=e,t.directionalLightShadows.needsUpdate=e,t.pointLights.needsUpdate=e,t.pointLightShadows.needsUpdate=e,t.spotLights.needsUpdate=e,t.spotLightShadows.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}(L,I),s&&r.fog&&tt.refreshFogUniforms(L,s),tt.refreshMaterialUniforms(L,r,A,T,D),Zl.upload(ht,w.uniformsList,L,$)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Zl.upload(ht,w.uniformsList,L,$),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&R.setValue(ht,"center",i.center),R.setValue(ht,"modelViewMatrix",i.modelViewMatrix),R.setValue(ht,"normalMatrix",i.normalMatrix),R.setValue(ht,"modelMatrix",i.matrixWorld),E}(t,e,n,r,i);W.setMaterial(r,o);let l=n.index,c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u=1;!0===r.wireframe&&(l=Z.getWireframeAttribute(n),u=2),ut.setup(i,r,a,n,l);let h,p=at;null!==l&&(h=Y.get(l),p=lt,p.setIndex(h));let f=null!==l?l.count:c.count,g=n.drawRange.start*u,v=n.drawRange.count*u,y=null!==s?s.start*u:0,w=null!==s?s.count*u:1/0,S=Math.max(g,y),M=Math.min(f,g+v,y+w)-1,E=Math.max(0,M-S+1);if(0!==E){if(i.isMesh)!0===r.wireframe?(W.setLineWidth(r.wireframeLinewidth*V()),p.setMode(1)):p.setMode(4);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),W.setLineWidth(t*V()),i.isLineSegments?p.setMode(1):i.isLineLoop?p.setMode(2):p.setMode(3)}else i.isPoints?p.setMode(0):i.isSprite&&p.setMode(4);if(i.isInstancedMesh)p.renderInstances(S,E,i.count);else if(n.isInstancedBufferGeometry){let t=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(S,E,t)}else p.render(S,E)}},this.compile=function(t,e){d=nt.get(t),d.init(),f.push(d),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(m.physicallyCorrectLights),t.traverse((function(e){let n=e.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){Tt(n[r],t,e)}else Tt(n,t,e)})),f.pop(),d=null};let yt=null;function _t(){xt.stop()}function bt(){xt.start()}let xt=new ha;function wt(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||N.intersectsSprite(t)){r&&F.setFromMatrixPosition(t.matrixWorld).applyMatrix4(z);let e=K.update(t),i=t.material;i.visible&&h.push(t,e,i,n,F.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==G.render.frame&&(t.skeleton.update(),t.skeleton.frame=G.render.frame),!t.frustumCulled||N.intersectsObject(t))){r&&F.setFromMatrixPosition(t.matrixWorld).applyMatrix4(z);let e=K.update(t),i=t.material;if(Array.isArray(i)){let r=e.groups;for(let s=0,o=r.length;s<o;s++){let o=r[s],a=i[o.materialIndex];a&&a.visible&&h.push(t,e,a,n,F.z,o)}}else i.visible&&h.push(t,e,i,n,F.z,null)}let i=t.children;for(let s=0,o=i.length;s<o;s++)wt(i[s],e,n,r)}function St(t,e,n,r){let i=t.opaque,s=t.transmissive,a=t.transparent;d.setupLightsView(n),s.length>0&&function(t,e,n){let r=j.isWebGL2;null===D&&(D=new qi(1,1,{generateMipmaps:!0,type:null!==ct.convert(Wr)?Wr:Br,minFilter:Fr,samples:r&&!0===o?4:0})),m.getDrawingBufferSize(U),r?D.setSize(U.x,U.y):D.setSize(Si(U.x),Si(U.y));let i=m.getRenderTarget();m.setRenderTarget(D),m.clear();let s=m.toneMapping;m.toneMapping=0,Mt(t,e,n),m.toneMapping=s,$.updateMultisampleRenderTarget(D),$.updateRenderTargetMipmap(D),m.setRenderTarget(i)}(i,e,n),r&&W.viewport(w.copy(r)),i.length>0&&Mt(i,e,n),s.length>0&&Mt(s,e,n),a.length>0&&Mt(a,e,n),W.buffers.depth.setTest(!0),W.buffers.depth.setMask(!0),W.buffers.color.setMask(!0),W.setPolygonOffset(!1)}function Mt(t,e,n){let r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,s=t.length;i<s;i++){let s=t[i],o=s.object,a=s.geometry,l=null===r?s.material:r,c=s.group;o.layers.test(n.layers)&&Et(o,e,n,a,l,c)}}function Et(t,e,n,r,i,s){t.onBeforeRender(m,e,n,r,i,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),i.onBeforeRender(m,e,n,r,t,s),!0===i.transparent&&2===i.side?(i.side=1,i.needsUpdate=!0,m.renderBufferDirect(n,e,r,i,t,s),i.side=0,i.needsUpdate=!0,m.renderBufferDirect(n,e,r,i,t,s),i.side=2):m.renderBufferDirect(n,e,r,i,t,s),t.onAfterRender(m,e,n,r,i,s)}function Tt(t,e,n){!0!==e.isScene&&(e=B);let r=q.get(t),i=d.state.lights,s=d.state.shadowsArray,o=i.state.version,a=Q.getParameters(t,i.state,s,e,n),l=Q.getProgramCacheKey(a),c=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=(t.isMeshStandardMaterial?J:X).get(t.envMap||r.environment),void 0===c&&(t.addEventListener("dispose",vt),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===o)return At(t,a),u}else a.uniforms=Q.getUniforms(t),t.onBuild(n,a,m),t.onBeforeCompile(a,m),u=Q.acquireProgram(a,l),c.set(l,u),r.uniforms=a.uniforms;let h=r.uniforms;(!t.isShaderMaterial&&!t.isRawShaderMaterial||!0===t.clipping)&&(h.clippingPlanes=rt.uniform),At(t,a),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);let p=u.getUniforms(),f=Zl.seqWithValue(p.seq,h);return r.currentProgram=u,r.uniformsList=f,u}function At(t,e){let n=q.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}xt.setAnimationLoop((function(t){yt&&yt(t)})),typeof self<"u"&&xt.setContext(self),this.setAnimationLoop=function(t){yt=t,ft.setAnimationLoop(t),null===t?xt.stop():xt.start()},ft.addEventListener("sessionstart",_t),ft.addEventListener("sessionend",bt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ft.enabled&&!0===ft.isPresenting&&(!0===ft.cameraAutoUpdate&&ft.updateCamera(e),e=ft.getCamera()),!0===t.isScene&&t.onBeforeRender(m,t,e,_),d=nt.get(t,f.length),d.init(),f.push(d),z.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),N.setFromProjectionMatrix(z),k=this.localClippingEnabled,O=rt.init(this.clippingPlanes,k,e),h=et.get(t,p.length),h.init(),p.push(h),wt(t,e,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(C,P),!0===O&&rt.beginShadows();let n=d.state.shadowsArray;if(it.render(n,t,e),!0===O&&rt.endShadows(),!0===this.info.autoReset&&this.info.reset(),st.render(h,t),d.setupLights(m.physicallyCorrectLights),e.isArrayCamera){let n=e.cameras;for(let e=0,r=n.length;e<r;e++){let r=n[e];St(h,t,r,r.viewport)}}else St(h,t,e);null!==_&&($.updateMultisampleRenderTarget(_),$.updateRenderTargetMipmap(_)),!0===t.isScene&&t.onAfterRender(m,t,e),ut.resetDefaultState(),b=-1,x=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(t,e,n){q.get(t.texture).__webglTexture=e,q.get(t.depthTexture).__webglTexture=n;let r=q.get(t);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===H.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){let n=q.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_=t,v=e,y=n;let r=!0;if(t){let e=q.get(t);void 0!==e.__useDefaultFramebuffer?(W.bindFramebuffer(36160,null),r=!1):void 0===e.__webglFramebuffer?$.setupRenderTarget(t):e.__hasExternalTextures&&$.rebindTextures(t,q.get(t.texture).__webglTexture,q.get(t.depthTexture).__webglTexture)}let i=null,s=!1,o=!1;if(t){let n=t.texture;(n.isData3DTexture||n.isDataArrayTexture)&&(o=!0);let r=q.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=r[e],s=!0):i=j.isWebGL2&&t.samples>0&&!1===$.useMultisampledRTT(t)?q.get(t).__webglMultisampledFramebuffer:r,w.copy(t.viewport),S.copy(t.scissor),M=t.scissorTest}else w.copy(I).multiplyScalar(A).floor(),S.copy(R).multiplyScalar(A).floor(),M=L;if(W.bindFramebuffer(36160,i)&&j.drawBuffers&&r&&W.drawBuffers(t,i),W.viewport(w),W.scissor(S),W.setScissorTest(M),s){let r=q.get(t.texture);ht.framebufferTexture2D(36160,36064,34069+e,r.__webglTexture,n)}else if(o){let r=q.get(t.texture),i=e||0;ht.framebufferTextureLayer(36160,36064,r.__webglTexture,n||0,i)}b=-1},this.readRenderTargetPixels=function(t,e,n,r,i,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){W.bindFramebuffer(36160,a);try{let o=t.texture,a=o.format,l=o.type;if(a!==qr&&ct.convert(a)!==ht.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");let c=l===Wr&&(H.has("EXT_color_buffer_half_float")||j.isWebGL2&&H.has("EXT_color_buffer_float"));if(l!==Br&&ct.convert(l)!==ht.getParameter(35738)&&(l!==jr||!(j.isWebGL2||H.has("OES_texture_float")||H.has("WEBGL_color_buffer_float")))&&!c)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&ht.readPixels(e,n,r,i,ct.convert(a),ct.convert(l),s)}finally{let t=null!==_?q.get(_).__webglFramebuffer:null;W.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!0!==e.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");let r=Math.pow(2,-n),i=Math.floor(e.image.width*r),s=Math.floor(e.image.height*r);$.setTexture2D(e,0),ht.copyTexSubImage2D(3553,n,0,0,t.x,t.y,i,s),W.unbindTexture()},this.copyTextureToTexture=function(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=e.image.width,s=e.image.height,o=ct.convert(n.format),a=ct.convert(n.type);$.setTexture2D(n,0),ht.pixelStorei(37440,n.flipY),ht.pixelStorei(37441,n.premultiplyAlpha),ht.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?ht.texSubImage2D(3553,r,t.x,t.y,i,s,o,a,e.image.data):e.isCompressedTexture?ht.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):ht.texSubImage2D(3553,r,t.x,t.y,o,a,e.image),0===r&&n.generateMipmaps&&ht.generateMipmap(3553),W.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");let s,o=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,l=t.max.z-t.min.z+1,c=ct.convert(r.format),u=ct.convert(r.type);if(r.isData3DTexture)$.setTexture3D(r,0),s=32879;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");$.setTexture2DArray(r,0),s=35866}ht.pixelStorei(37440,r.flipY),ht.pixelStorei(37441,r.premultiplyAlpha),ht.pixelStorei(3317,r.unpackAlignment);let h=ht.getParameter(3314),d=ht.getParameter(32878),p=ht.getParameter(3316),f=ht.getParameter(3315),g=ht.getParameter(32877),v=n.isCompressedTexture?n.mipmaps[0]:n.image;ht.pixelStorei(3314,v.width),ht.pixelStorei(32878,v.height),ht.pixelStorei(3316,t.min.x),ht.pixelStorei(3315,t.min.y),ht.pixelStorei(32877,t.min.z),n.isDataTexture||n.isData3DTexture?ht.texSubImage3D(s,i,e.x,e.y,e.z,o,a,l,c,u,v.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ht.compressedTexSubImage3D(s,i,e.x,e.y,e.z,o,a,l,c,v.data)):ht.texSubImage3D(s,i,e.x,e.y,e.z,o,a,l,c,u,v),ht.pixelStorei(3314,h),ht.pixelStorei(32878,d),ht.pixelStorei(3316,p),ht.pixelStorei(3315,f),ht.pixelStorei(32877,g),0===i&&r.generateMipmaps&&ht.generateMipmap(s),W.unbindTexture()},this.initTexture=function(t){$.setTexture2D(t,0),W.unbindTexture()},this.resetState=function(){v=0,y=0,_=null,W.reset(),ut.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Wc.prototype.isWebGLRenderer=!0;(class extends Wc{}).prototype.isWebGL1Renderer=!0;var Gc=class extends Ks{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){let e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}};Gc.prototype.isScene=!0;var qc=class{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=hi,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=_i()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=_i()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=_i()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};qc.prototype.isInterleavedBuffer=!0;var $c=new Yi,Xc=class t{constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)$c.fromBufferAttribute(this,e),$c.applyMatrix4(t),this.setXYZ(e,$c.x,$c.y,$c.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)$c.fromBufferAttribute(this,e),$c.applyNormalMatrix(t),this.setXYZ(e,$c.x,$c.y,$c.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)$c.fromBufferAttribute(this,e),$c.transformDirection(t),this.setXYZ(e,$c.x,$c.y,$c.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let e=0;e<this.count;e++){let n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new go(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new t(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let e=0;e<this.count;e++){let n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};Xc.prototype.isInterleavedBufferAttribute=!0;var Jc=class extends ho{constructor(t){super(),this.type="SpriteMaterial",this.color=new Ui(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}};Jc.prototype.isSpriteMaterial=!0;var Yc,Zc=new Yi,Kc=new Yi,Qc=new Yi,tu=new Mi,eu=new Mi,nu=new As,ru=new Yi,iu=new Yi,su=new Yi,ou=new Mi,au=new Mi,lu=new Mi;function cu(t,e,n,r,i,s){tu.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(eu.x=s*tu.x-i*tu.y,eu.y=i*tu.x+s*tu.y):eu.copy(tu),t.copy(e),t.x+=eu.x,t.y+=eu.y,t.applyMatrix4(nu)}(class extends Ks{constructor(t){if(super(),this.type="Sprite",void 0===Yc){Yc=new Ao;let t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new qc(t,5);Yc.setIndex([0,1,2,0,2,3]),Yc.setAttribute("position",new Xc(e,3,0,!1)),Yc.setAttribute("uv",new Xc(e,2,3,!1))}this.geometry=Yc,this.material=void 0!==t?t:new Jc,this.center=new Mi(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Kc.setFromMatrixScale(this.matrixWorld),nu.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Qc.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Kc.multiplyScalar(-Qc.z);let n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));let s=this.center;cu(ru.set(-.5,-.5,0),Qc,s,Kc,n,r),cu(iu.set(.5,-.5,0),Qc,s,Kc,n,r),cu(su.set(.5,.5,0),Qc,s,Kc,n,r),ou.set(0,0),au.set(1,0),lu.set(1,1);let o=t.ray.intersectTriangle(ru,iu,su,!1,Zc);if(null===o&&(cu(iu.set(-.5,.5,0),Qc,s,Kc,n,r),au.set(0,1),o=t.ray.intersectTriangle(ru,su,iu,!1,Zc),null===o))return;let a=t.ray.origin.distanceTo(Zc);a<t.near||a>t.far||e.push({distance:a,point:Zc.clone(),uv:co.getUV(Zc,ru,iu,su,ou,au,lu,new Mi),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}).prototype.isSprite=!0;var uu=new Yi,hu=new Gi,du=new Gi,pu=new Yi,fu=new As,mu=class extends Go{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new As,this.bindMatrixInverse=new As}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let t=new Gi,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.fromBufferAttribute(e,n);let r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){let n=this.skeleton,r=this.geometry;hu.fromBufferAttribute(r.attributes.skinIndex,t),du.fromBufferAttribute(r.attributes.skinWeight,t),uu.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let i=0;i<4;i++){let t=du.getComponent(i);if(0!==t){let r=hu.getComponent(i);fu.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(pu.copy(uu).applyMatrix4(fu),t)}}return e.applyMatrix4(this.bindMatrixInverse)}};mu.prototype.isSkinnedMesh=!0;(class extends Ks{constructor(){super(),this.type="Bone"}}).prototype.isBone=!0;(class extends Wi{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:Or,arguments.length>9&&void 0!==arguments[9]?arguments[9]:Or,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}).prototype.isDataTexture=!0;var gu=class extends go{constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,n),this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){let t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}};gu.prototype.isInstancedBufferAttribute=!0;var vu=new As,yu=new As,_u=[],bu=new Go;(class extends Go{constructor(t,e,n){super(t,e),this.instanceMatrix=new gu(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){let n=this.matrixWorld,r=this.count;if(bu.geometry=this.geometry,bu.material=this.material,void 0!==bu.material)for(let i=0;i<r;i++){this.getMatrixAt(i,vu),yu.multiplyMatrices(n,vu),bu.matrixWorld=yu,bu.raycast(t,_u);for(let t=0,n=_u.length;t<n;t++){let n=_u[t];n.instanceId=i,n.object=this,e.push(n)}_u.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new gu(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;var xu=class extends ho{constructor(t){super(),this.type="LineBasicMaterial",this.color=new Ui(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}};xu.prototype.isLineBasicMaterial=!0;var wu=new Yi,Su=new Yi,Mu=new As,Eu=new Ts,Tu=new ys,Au=class extends Ks{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ao,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xu;super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){let t=this.geometry;if(t.isBufferGeometry)if(null===t.index){let e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)wu.fromBufferAttribute(e,t-1),Su.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=wu.distanceTo(Su);t.setAttribute("lineDistance",new _o(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){let n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Tu.copy(n.boundingSphere),Tu.applyMatrix4(r),Tu.radius+=i,!1===t.ray.intersectsSphere(Tu))return;Mu.copy(r).invert(),Eu.copy(t.ray).applyMatrix4(Mu);let o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new Yi,c=new Yi,u=new Yi,h=new Yi,d=this.isLineSegments?2:1;if(n.isBufferGeometry){let r=n.index,i=n.attributes.position;if(null!==r){for(let n=Math.max(0,s.start),o=Math.min(r.count,s.start+s.count)-1;n<o;n+=d){let s=r.getX(n),o=r.getX(n+1);if(l.fromBufferAttribute(i,s),c.fromBufferAttribute(i,o),Eu.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);let d=t.ray.origin.distanceTo(h);d<t.near||d>t.far||e.push({distance:d,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,s.start),r=Math.min(i.count,s.start+s.count)-1;n<r;n+=d){if(l.fromBufferAttribute(i,n),c.fromBufferAttribute(i,n+1),Eu.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);let r=t.ray.origin.distanceTo(h);r<t.near||r>t.far||e.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let t=this.geometry;if(t.isBufferGeometry){let e=t.morphAttributes,n=Object.keys(e);if(n.length>0){let t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){let n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{let e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};Au.prototype.isLine=!0;var Cu=new Yi,Pu=new Yi,Iu=class extends Au{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){let t=this.geometry;if(t.isBufferGeometry)if(null===t.index){let e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)Cu.fromBufferAttribute(e,t),Pu.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Cu.distanceTo(Pu);t.setAttribute("lineDistance",new _o(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};Iu.prototype.isLineSegments=!0;(class extends Au{constructor(t,e){super(t,e),this.type="LineLoop"}}).prototype.isLineLoop=!0;var Ru=class extends ho{constructor(t){super(),this.type="PointsMaterial",this.color=new Ui(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}};Ru.prototype.isPointsMaterial=!0;var Lu=new As,Nu=new Ts,Ou=new ys,ku=new Yi;function Du(t,e,n,r,i,s,o){let a=Nu.distanceSqToPoint(t);if(a<n){let n=new Yi;Nu.closestPointToPoint(t,n),n.applyMatrix4(r);let l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}(class extends Ks{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ao,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ru;super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){let n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ou.copy(n.boundingSphere),Ou.applyMatrix4(r),Ou.radius+=i,!1===t.ray.intersectsSphere(Ou))return;Lu.copy(r).invert(),Nu.copy(t.ray).applyMatrix4(Lu);let o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){let i=n.index,o=n.attributes.position;if(null!==i){for(let n=Math.max(0,s.start),l=Math.min(i.count,s.start+s.count);n<l;n++){let s=i.getX(n);ku.fromBufferAttribute(o,s),Du(ku,s,a,r,t,e,this)}}else{for(let n=Math.max(0,s.start),i=Math.min(o.count,s.start+s.count);n<i;n++)ku.fromBufferAttribute(o,n),Du(ku,n,a,r,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let t=this.geometry;if(t.isBufferGeometry){let e=t.morphAttributes,n=Object.keys(e);if(n.length>0){let t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){let n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{let e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}).prototype.isPoints=!0;(class extends Wi{constructor(t,e,n,r,i,s,o,a,l){super(t,e,n,r,i,s,o,a,l),this.minFilter=void 0!==s?s:zr,this.magFilter=void 0!==i?i:zr,this.generateMipmaps=!1;let c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){let t=this.image;!("requestVideoFrameCallback"in t)&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}).prototype.isVideoTexture=!0;(class extends Wi{constructor(t,e,n){super({width:t,height:e}),this.format=n,this.magFilter=Or,this.minFilter=Or,this.generateMipmaps=!1,this.needsUpdate=!0}}).prototype.isFramebufferTexture=!0;(class extends Wi{constructor(t,e,n,r,i,s,o,a,l,c,u,h){super(null,s,o,a,l,c,r,i,u,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0;(class extends Wi{constructor(t,e,n,r,i,s,o,a,l){super(t,e,n,r,i,s,o,a,l),this.needsUpdate=!0}}).prototype.isCanvasTexture=!0;var zu=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){let n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){let t=this.getLengths();return t[t.length-1]}getLengths(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let e,n=[],r=this.getPoint(0),i=0;n.push(0);for(let s=1;s<=t;s++)e=this.getPoint(s/t),i+=e.distanceTo(r),n.push(i),r=e;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){let n,r=this.getLengths(),i=0,s=r.length;n=e||t*r[s-1];let o,a=0,l=s-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),o=r[i]-n,o<0)a=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,r[i]===n)return i/(s-1);let c=r[i];return(i+(n-c)/(r[i+1]-c))/(s-1)}getTangent(t,e){let n=t-1e-4,r=t+1e-4;n<0&&(n=0),r>1&&(r=1);let i=this.getPoint(n),s=this.getPoint(r),o=e||(i.isVector2?new Mi:new Yi);return o.copy(s).sub(i).normalize(),o}getTangentAt(t,e){let n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){let n=new Yi,r=[],i=[],s=[],o=new Yi,a=new As;for(let d=0;d<=t;d++){let e=d/t;r[d]=this.getTangentAt(e,new Yi)}i[0]=new Yi,s[0]=new Yi;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]);for(let d=1;d<=t;d++){if(i[d]=i[d-1].clone(),s[d]=s[d-1].clone(),o.crossVectors(r[d-1],r[d]),o.length()>Number.EPSILON){o.normalize();let t=Math.acos(bi(r[d-1].dot(r[d]),-1,1));i[d].applyMatrix4(a.makeRotationAxis(o,t))}s[d].crossVectors(r[d],i[d])}if(!0===e){let e=Math.acos(bi(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(o.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){let t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},Uu=class extends zu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){let n=e||new Mi,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0===this.aClockwise&&!s&&(i===r?i=-r:i-=r);let o=this.aStartAngle+t*i,a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){let t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*t-r*e+this.aX,l=n*e+r*t+this.aY}return n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){let t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}};Uu.prototype.isEllipseCurve=!0;var Fu=class extends Uu{constructor(t,e,n,r,i,s){super(t,e,n,n,r,i,s),this.type="ArcCurve"}};function Bu(){let t=0,e=0,n=0,r=0;function i(i,s,o,a){t=i,e=o,n=-3*i+3*s-2*o-a,r=2*i-2*s+o+a}return{initCatmullRom:function(t,e,n,r,s){i(e,n,s*(n-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,c=(n-e)/o-(r-e)/(o+a)+(r-n)/a;l*=o,c*=o,i(e,n,l,c)},calc:function(i){let s=i*i;return t+e*i+n*s+r*(s*i)}}}Fu.prototype.isArcCurve=!0;var Vu=new Yi,Hu=new Bu,ju=new Bu,Wu=new Bu,Gu=class extends zu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}getPoint(t){let e,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yi,i=this.points,s=i.length,o=(s-(this.closed?0:1))*t,a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:0===l&&a===s-1&&(a=s-2,l=1),this.closed||a>0?e=i[(a-1)%s]:(Vu.subVectors(i[0],i[1]).add(i[0]),e=Vu);let c=i[a%s],u=i[(a+1)%s];if(this.closed||a+2<s?n=i[(a+2)%s]:(Vu.subVectors(i[s-1],i[s-2]).add(i[s-1]),n=Vu),"centripetal"===this.curveType||"chordal"===this.curveType){let t="chordal"===this.curveType?.5:.25,r=Math.pow(e.distanceToSquared(c),t),i=Math.pow(c.distanceToSquared(u),t),s=Math.pow(u.distanceToSquared(n),t);i<1e-4&&(i=1),r<1e-4&&(r=i),s<1e-4&&(s=i),Hu.initNonuniformCatmullRom(e.x,c.x,u.x,n.x,r,i,s),ju.initNonuniformCatmullRom(e.y,c.y,u.y,n.y,r,i,s),Wu.initNonuniformCatmullRom(e.z,c.z,u.z,n.z,r,i,s)}else"catmullrom"===this.curveType&&(Hu.initCatmullRom(e.x,c.x,u.x,n.x,this.tension),ju.initCatmullRom(e.y,c.y,u.y,n.y,this.tension),Wu.initCatmullRom(e.z,c.z,u.z,n.z,this.tension));return r.set(Hu.calc(l),ju.calc(l),Wu.calc(l)),r}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){let n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){let n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){let n=t.points[e];this.points.push((new Yi).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}};function qu(t,e,n,r,i){let s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function $u(t,e,n,r){return function(t,e){let n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function Xu(t,e,n,r,i){return function(t,e){let n=1-t;return n*n*n*e}(t,e)+function(t,e){let n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}Gu.prototype.isCatmullRomCurve3=!0;var Ju=class extends zu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Mi,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Mi,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Mi,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Mi;super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Mi,n=this.v0,r=this.v1,i=this.v2,s=this.v3;return e.set(Xu(t,n.x,r.x,i.x,s.x),Xu(t,n.y,r.y,i.y,s.y)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}};Ju.prototype.isCubicBezierCurve=!0;var Yu=class extends zu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yi,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yi,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Yi,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Yi;super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yi,n=this.v0,r=this.v1,i=this.v2,s=this.v3;return e.set(Xu(t,n.x,r.x,i.x,s.x),Xu(t,n.y,r.y,i.y,s.y),Xu(t,n.z,r.z,i.z,s.z)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}};Yu.prototype.isCubicBezierCurve3=!0;var Zu=class extends zu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Mi,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Mi;super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Mi;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){let n=e||new Mi;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}};Zu.prototype.isLineCurve=!0;var Ku=class extends zu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Mi,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Mi,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Mi;super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Mi,n=this.v0,r=this.v1,i=this.v2;return e.set($u(t,n.x,r.x,i.x),$u(t,n.y,r.y,i.y)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}};Ku.prototype.isQuadraticBezierCurve=!0;var Qu=class extends zu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yi,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yi,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Yi;super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yi,n=this.v0,r=this.v1,i=this.v2;return e.set($u(t,n.x,r.x,i.x),$u(t,n.y,r.y,i.y),$u(t,n.z,r.z,i.z)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}};Qu.prototype.isQuadraticBezierCurve3=!0;var th=class extends zu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.type="SplineCurve",this.points=t}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Mi,n=this.points,r=(n.length-1)*t,i=Math.floor(r),s=r-i,o=n[0===i?i:i-1],a=n[i],l=n[i>n.length-2?n.length-1:i+1],c=n[i>n.length-3?n.length-1:i+2];return e.set(qu(s,o.x,a.x,l.x,c.x),qu(s,o.y,a.y,l.y,c.y)),e}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){let n=t.points[e];this.points.push(n.clone())}return this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){let n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){let n=t.points[e];this.points.push((new Mi).fromArray(n))}return this}};th.prototype.isSplineCurve=!0;var eh=Object.freeze({__proto__:null,ArcCurve:Fu,CatmullRomCurve3:Gu,CubicBezierCurve:Ju,CubicBezierCurve3:Yu,EllipseCurve:Uu,LineCurve:Zu,LineCurve3:class extends zu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yi,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yi;super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yi;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:Ku,QuadraticBezierCurve3:Qu,SplineCurve:th}),nh=class extends zu{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){let t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Zu(e,t))}getPoint(t,e){let n=t*this.getLength(),r=this.getCurveLengths(),i=0;for(;i<r.length;){if(r[i]>=n){let t=r[i]-n,s=this.curves[i],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}i++}return null}getLength(){let t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let t=[],e=0;for(let n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(){let t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[];for(let r=0,i=this.curves;r<i.length;r++){let s=i[r],o=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,a=s.getPoints(o);for(let e=0;e<a.length;e++){let r=a[e];t&&t.equals(r)||(n.push(r),t=r)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){let n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){let t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){let n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){let n=t.curves[e];this.curves.push((new eh[n.type]).fromJSON(n))}return this}},rh=class extends nh{constructor(t){super(),this.type="Path",this.currentPoint=new Mi,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){let n=new Zu(this.currentPoint.clone(),new Mi(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,r){let i=new Ku(this.currentPoint.clone(),new Mi(t,e),new Mi(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(t,e,n,r,i,s){let o=new Ju(this.currentPoint.clone(),new Mi(t,e),new Mi(n,r),new Mi(i,s));return this.curves.push(o),this.currentPoint.set(i,s),this}splineThru(t){let e=[this.currentPoint.clone()].concat(t),n=new th(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,r,i,s){let o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,r,i,s),this}absarc(t,e,n,r,i,s){return this.absellipse(t,e,n,n,r,i,s),this}ellipse(t,e,n,r,i,s,o,a){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,r,i,s,o,a),this}absellipse(t,e,n,r,i,s,o,a){let l=new Uu(t,e,n,r,i,s,o,a);if(this.curves.length>0){let t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){let t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}},ih=class extends rh{constructor(t){super(t),this.uuid=_i(),this.type="Shape",this.holes=[]}getPointsHoles(t){let e=[];for(let n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){let n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){let t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){let n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){let n=t.holes[e];this.holes.push((new rh).fromJSON(n))}return this}},sh=function(t,e){let n,r,i,s,o,a,l,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,u=e&&e.length,h=u?e[0]*c:t.length,d=oh(t,0,h,c,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,n,r){let i,s,o,a,l,c=[];for(i=0,s=e.length;i<s;i++)o=e[i]*r,a=i<s-1?e[i+1]*r:t.length,l=oh(t,o,a,r,!1),l===l.next&&(l.steiner=!0),c.push(vh(l));for(c.sort(ph),i=0;i<c.length;i++)fh(c[i],n),n=ah(n,n.next);return n}(t,e,d,c)),t.length>80*c){n=i=t[0],r=s=t[1];for(let e=c;e<h;e+=c)o=t[e],a=t[e+1],o<n&&(n=o),a<r&&(r=a),o>i&&(i=o),a>s&&(s=a);l=Math.max(i-n,s-r),l=0!==l?1/l:0}return lh(d,p,c,n,r,l),p};function oh(t,e,n,r,i){let s,o;if(i===function(t,e,n,r){let i=0;for(let s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}(t,e,n,r)>0)for(s=e;s<n;s+=r)o=Ah(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=Ah(s,t[s],t[s+1],o);return o&&xh(o,o.next)&&(Ch(o),o=o.next),o}function ah(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!xh(r,r.next)&&0!==bh(r.prev,r,r.next))r=r.next;else{if(Ch(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function lh(t,e,n,r,i,s,o){if(!t)return;!o&&s&&function(t,e,n,r){let i=t;do{null===i.z&&(i.z=gh(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,n,r,i,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ,r);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1)}(i)}(t,r,i,s);let a,l,c=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?uh(t,r,i,s):ch(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),Ch(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?lh(t=hh(ah(t),e,n),e,n,r,i,s,2):2===o&&dh(t,e,n,r,i,s):lh(ah(t),e,n,r,i,s,1);break}}function ch(t){let e=t.prev,n=t,r=t.next;if(bh(e,n,r)>=0)return!1;let i=t.next.next;for(;i!==t.prev;){if(yh(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&bh(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function uh(t,e,n,r){let i=t.prev,s=t,o=t.next;if(bh(i,s,o)>=0)return!1;let a=i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,l=i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,c=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,u=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,h=gh(a,l,e,n,r),d=gh(c,u,e,n,r),p=t.prevZ,f=t.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&yh(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&bh(p.prev,p,p.next)>=0||(p=p.prevZ,f!==t.prev&&f!==t.next&&yh(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&bh(f.prev,f,f.next)>=0))return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&yh(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&bh(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&yh(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&bh(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function hh(t,e,n){let r=t;do{let i=r.prev,s=r.next.next;!xh(i,s)&&wh(i,r,r.next,s)&&Eh(i,s)&&Eh(s,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(s.i/n),Ch(r),Ch(r.next),r=t=s),r=r.next}while(r!==t);return ah(r)}function dh(t,e,n,r,i,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&_h(o,t)){let a=Th(o,t);return o=ah(o,o.next),a=ah(a,a.next),lh(o,e,n,r,i,s),void lh(a,e,n,r,i,s)}t=t.next}o=o.next}while(o!==t)}function ph(t,e){return t.x-e.x}function fh(t,e){if(e=function(t,e){let n,r=e,i=t.x,s=t.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){let t=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(t<=i&&t>o){if(o=t,t===i){if(s===r.y)return r;if(s===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===o)return n;let a,l=n,c=n.x,u=n.y,h=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&yh(s<u?i:o,s,c,u,s<u?o:i,s,r.x,r.y)&&(a=Math.abs(s-r.y)/(i-r.x),Eh(r,t)&&(a<h||a===h&&(r.x>n.x||r.x===n.x&&mh(n,r)))&&(n=r,h=a)),r=r.next}while(r!==l);return n}(t,e),e){let n=Th(e,t);ah(e,e.next),ah(n,n.next)}}function mh(t,e){return bh(t.prev,t,e.prev)<0&&bh(e.next,t,t.next)<0}function gh(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vh(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function yh(t,e,n,r,i,s,o,a){return(i-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(r-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(i-o)*(r-a)>=0}function _h(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&wh(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Eh(t,e)&&Eh(e,t)&&function(t,e){let n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(bh(t.prev,t,e.prev)||bh(t,e.prev,e))||xh(t,e)&&bh(t.prev,t,t.next)>0&&bh(e.prev,e,e.next)>0)}function bh(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function xh(t,e){return t.x===e.x&&t.y===e.y}function wh(t,e,n,r){let i=Mh(bh(t,e,n)),s=Mh(bh(t,e,r)),o=Mh(bh(n,r,t)),a=Mh(bh(n,r,e));return!!(i!==s&&o!==a||0===i&&Sh(t,n,e)||0===s&&Sh(t,r,e)||0===o&&Sh(n,t,r)||0===a&&Sh(n,e,r))}function Sh(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Mh(t){return t>0?1:t<0?-1:0}function Eh(t,e){return bh(t.prev,t,t.next)<0?bh(t,e,t.next)>=0&&bh(t,t.prev,e)>=0:bh(t,e,t.prev)<0||bh(t,t.next,e)<0}function Th(t,e){let n=new Ph(t.i,t.x,t.y),r=new Ph(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function Ah(t,e,n,r){let i=new Ph(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Ch(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ph(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Ih=class t{static area(t){let e=t.length,n=0;for(let r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n}static isClockWise(e){return t.area(e)<0}static triangulateShape(t,e){let n=[],r=[],i=[];Rh(t),Lh(n,t);let s=t.length;e.forEach(Rh);for(let a=0;a<e.length;a++)r.push(s),s+=e[a].length,Lh(n,e[a]);let o=sh(n,r);for(let a=0;a<o.length;a+=3)i.push(o.slice(a,a+3));return i}};function Rh(t){let e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Lh(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}var Nh=class t extends Ao{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ih([new Mi(.5,.5),new Mi(-.5,.5),new Mi(-.5,-.5),new Mi(.5,-.5)]),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];let n=this,r=[],i=[];for(let o=0,a=t.length;o<a;o++){s(t[o])}function s(t){let s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1,c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:.2,h=void 0!==e.bevelSize?e.bevelSize:u-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3,f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:Oh;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,v,y,_,b,x=!1;f&&(g=f.getSpacedPoints(a),x=!0,c=!1,v=f.computeFrenetFrames(a,!1),y=new Yi,_=new Yi,b=new Yi),c||(p=0,u=0,h=0,d=0);let w=t.extractPoints(o),S=w.shape,M=w.holes;if(!Ih.isClockWise(S)){S=S.reverse();for(let t=0,e=M.length;t<e;t++){let e=M[t];Ih.isClockWise(e)&&(M[t]=e.reverse())}}let E=Ih.triangulateShape(S,M),T=S;for(let e=0,n=M.length;e<n;e++){let t=M[e];S=S.concat(t)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}let C=S.length,P=E.length;function I(t,e,n){let r,i,s,o=t.x-e.x,a=t.y-e.y,l=n.x-t.x,c=n.y-t.y,u=o*o+a*a,h=o*c-a*l;if(Math.abs(h)>Number.EPSILON){let h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=e.x-a/h,f=e.y+o/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(o*c-a*l);r=p+o*m-t.x,i=f+a*m-t.y;let g=r*r+i*i;if(g<=2)return new Mi(r,i);s=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(c)&&(t=!0),t?(r=-a,i=o,s=Math.sqrt(u)):(r=o,i=a,s=Math.sqrt(u/2))}return new Mi(r/s,i/s)}let R=[];for(let e=0,n=T.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),R[e]=I(T[e],T[r],T[i]);let L,N=[],O=R.concat();for(let e=0,n=M.length;e<n;e++){let t=M[e];L=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),L[e]=I(t[e],t[r],t[i]);N.push(L),O=O.concat(L)}for(let e=0;e<p;e++){let t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,i=T.length;e<i;e++){let t=A(T[e],R[e],r);z(t.x,t.y,-n)}for(let e=0,i=M.length;e<i;e++){let t=M[e];L=N[e];for(let e=0,i=t.length;e<i;e++){let i=A(t[e],L[e],r);z(i.x,i.y,-n)}}}let k=h+d;for(let e=0;e<C;e++){let t=c?A(S[e],O[e],k):S[e];x?(_.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),b.copy(g[0]).add(_).add(y),z(b.x,b.y,b.z)):z(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<C;t++){let n=c?A(S[t],O[t],k):S[t];x?(_.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),b.copy(g[e]).add(_).add(y),z(b.x,b.y,b.z)):z(n.x,n.y,l/a*e)}for(let e=p-1;e>=0;e--){let t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,i=T.length;e<i;e++){let t=A(T[e],R[e],r);z(t.x,t.y,l+n)}for(let e=0,i=M.length;e<i;e++){let t=M[e];L=N[e];for(let e=0,i=t.length;e<i;e++){let i=A(t[e],L[e],r);x?z(i.x,i.y+g[a-1].y,g[a-1].x+n):z(i.x,i.y,l+n)}}}function D(t,e){let n=t.length;for(;--n>=0;){let r=n,i=n-1;i<0&&(i=t.length-1);for(let t=0,n=a+2*p;t<n;t++){let n=C*t,s=C*(t+1);F(e+r+n,e+i+n,e+i+s,e+r+s)}}}function z(t,e,n){s.push(t),s.push(e),s.push(n)}function U(t,e,i){B(t),B(e),B(i);let s=r.length/3,o=m.generateTopUV(n,r,s-3,s-2,s-1);V(o[0]),V(o[1]),V(o[2])}function F(t,e,i,s){B(t),B(e),B(s),B(e),B(i),B(s);let o=r.length/3,a=m.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);V(a[0]),V(a[1]),V(a[3]),V(a[1]),V(a[2]),V(a[3])}function B(t){r.push(s[3*t+0]),r.push(s[3*t+1]),r.push(s[3*t+2])}function V(t){i.push(t.x),i.push(t.y)}(function(){let t=r.length/3;if(c){let t=0,e=C*t;for(let n=0;n<P;n++){let t=E[n];U(t[2]+e,t[1]+e,t[0]+e)}t=a+2*p,e=C*t;for(let n=0;n<P;n++){let t=E[n];U(t[0]+e,t[1]+e,t[2]+e)}}else{for(let t=0;t<P;t++){let e=E[t];U(e[2],e[1],e[0])}for(let t=0;t<P;t++){let e=E[t];U(e[0]+C*a,e[1]+C*a,e[2]+C*a)}}n.addGroup(t,r.length/3-t,0)})(),function(){let t=r.length/3,e=0;D(T,e),e+=T.length;for(let n=0,r=M.length;n<r;n++){let t=M[n];D(t,e),e+=t.length}n.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new _o(r,3)),this.setAttribute("uv",new _o(i,2)),this.computeVertexNormals()}toJSON(){let t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let r=0,i=t.length;r<i;r++){let e=t[r];n.shapes.push(e.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(e,n){let r=[];for(let t=0,s=e.shapes.length;t<s;t++){let i=n[e.shapes[t]];r.push(i)}let i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new eh[i.type]).fromJSON(i)),new t(r,e.options)}},Oh={generateTopUV:function(t,e,n,r,i){let s=e[3*n],o=e[3*n+1],a=e[3*r],l=e[3*r+1],c=e[3*i],u=e[3*i+1];return[new Mi(s,o),new Mi(a,l),new Mi(c,u)]},generateSideWallUV:function(t,e,n,r,i,s){let o=e[3*n],a=e[3*n+1],l=e[3*n+2],c=e[3*r],u=e[3*r+1],h=e[3*r+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(a-u)<Math.abs(o-c)?[new Mi(o,1-l),new Mi(c,1-h),new Mi(d,1-f),new Mi(m,1-v)]:[new Mi(a,1-l),new Mi(u,1-h),new Mi(p,1-f),new Mi(g,1-v)]}};var kh=class t extends Ao{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ih([new Mi(0,.5),new Mi(-.5,-.5),new Mi(.5,-.5)]),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};let n=[],r=[],i=[],s=[],o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let c=0;c<t.length;c++)l(t[c]),this.addGroup(o,a,c),o+=a,a=0;function l(t){let o=r.length/3,l=t.extractPoints(e),c=l.shape,u=l.holes;!1===Ih.isClockWise(c)&&(c=c.reverse());for(let e=0,n=u.length;e<n;e++){let t=u[e];!0===Ih.isClockWise(t)&&(u[e]=t.reverse())}let h=Ih.triangulateShape(c,u);for(let e=0,n=u.length;e<n;e++){let t=u[e];c=c.concat(t)}for(let e=0,n=c.length;e<n;e++){let t=c[e];r.push(t.x,t.y,0),i.push(0,0,1),s.push(t.x,t.y)}for(let e=0,r=h.length;e<r;e++){let t=h[e],r=t[0]+o,i=t[1]+o,s=t[2]+o;n.push(r,i,s),a+=3}}this.setIndex(n),this.setAttribute("position",new _o(r,3)),this.setAttribute("normal",new _o(i,3)),this.setAttribute("uv",new _o(s,2))}toJSON(){let t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){let r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(e,n){let r=[];for(let t=0,i=e.shapes.length;t<i;t++){let i=n[e.shapes[t]];r.push(i)}return new t(r,e.curveSegments)}};var Dh=class extends ho{constructor(t){super(),this.type="ShadowMaterial",this.color=new Ui(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}};Dh.prototype.isShadowMaterial=!0;var zh=class extends Zo{constructor(t){super(t),this.type="RawShaderMaterial"}};zh.prototype.isRawShaderMaterial=!0;var Uh=class extends ho{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ui(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ui(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Mi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}};Uh.prototype.isMeshStandardMaterial=!0;var Fh=class extends Uh{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Mi(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return bi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new Ui(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Ui(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ui(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}};Fh.prototype.isMeshPhysicalMaterial=!0;var Bh=class extends ho{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new Ui(16777215),this.specular=new Ui(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ui(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Mi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}};Bh.prototype.isMeshPhongMaterial=!0;var Vh=class extends ho{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ui(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ui(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Mi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}};Vh.prototype.isMeshToonMaterial=!0;var Hh=class extends ho{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Mi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}};Hh.prototype.isMeshNormalMaterial=!0;var jh=class extends ho{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new Ui(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ui(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}};jh.prototype.isMeshLambertMaterial=!0;var Wh=class extends ho{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ui(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Mi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}};Wh.prototype.isMeshMatcapMaterial=!0;var Gh=class extends xu{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}};Gh.prototype.isLineDashedMaterial=!0;var qh={ShadowMaterial:Dh,SpriteMaterial:Jc,RawShaderMaterial:zh,ShaderMaterial:Zo,PointsMaterial:Ru,MeshPhysicalMaterial:Fh,MeshStandardMaterial:Uh,MeshPhongMaterial:Bh,MeshToonMaterial:Vh,MeshNormalMaterial:Hh,MeshLambertMaterial:jh,MeshDepthMaterial:Rc,MeshDistanceMaterial:Lc,MeshBasicMaterial:po,MeshMatcapMaterial:Wh,LineDashedMaterial:Gh,LineBasicMaterial:xu,Material:ho};ho.fromType=function(t){return new qh[t]};var $h={arraySlice:function(t,e,n){return $h.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){let e=t.length,n=new Array(e);for(let r=0;r!==e;++r)n[r]=r;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){let r=t.length,i=new t.constructor(r);for(let s=0,o=0;o!==r;++s){let r=n[s]*e;for(let n=0;n!==e;++n)i[o++]=t[r+n]}return i},flattenJSON:function(t,e,n,r){let i=1,s=t[0];for(;void 0!==s&&void 0===s[r];)s=t[i++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[i++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),n.push(o)),s=t[i++]}while(void 0!==s)},subclip:function(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,s=t.clone();s.name=e;let o=[];for(let l=0;l<s.tracks.length;++l){let t=s.tracks[l],e=t.getValueSize(),a=[],c=[];for(let s=0;s<t.times.length;++s){let o=t.times[s]*i;if(!(o<n||o>=r)){a.push(t.times[s]);for(let n=0;n<e;++n)c.push(t.values[s*e+n])}}0!==a.length&&(t.times=$h.convertArray(a,t.times.constructor),t.values=$h.convertArray(c,t.values.constructor),o.push(t))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);let i=n.tracks.length,s=e/r;for(let o=0;o<i;++o){let e=n.tracks[o],r=e.ValueTypeName;if("bool"===r||"string"===r)continue;let i=t.tracks.find((function(t){return t.name===e.name&&t.ValueTypeName===r}));if(void 0===i)continue;let a=0,l=e.getValueSize();e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0,u=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);let h,d=e.times.length-1;if(s<=e.times[0]){let t=a,n=l-a;h=$h.arraySlice(e.values,t,n)}else if(s>=e.times[d]){let t=d*l+a,n=t+l-a;h=$h.arraySlice(e.values,t,n)}else{let t=e.createInterpolant(),n=a,r=l-a;t.evaluate(s),h=$h.arraySlice(t.resultBuffer,n,r)}"quaternion"===r&&(new Ji).fromArray(h).normalize().conjugate().toArray(h);let p=i.times.length;for(let t=0;t<p;++t){let e=t*u+c;if("quaternion"===r)Ji.multiplyQuaternionsFlat(i.values,e,h,0,i.values,e);else{let t=u-2*c;for(let n=0;n<t;++n)i.values[e+n]-=h[n]}}}return t.blendMode=2501,t}},Xh=class{constructor(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let s;n:{r:if(!(t<r)){for(let s=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===s)break;if(i=r,r=e[++n],t<r)break e}s=e.length;break n}if(t>=i)break t;{let o=e[1];t<o&&(n=2,i=o);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===s)break;if(r=i,i=e[--n-1],t>=i)break e}s=n,n=0}}for(;n<s;){let r=n+s>>>1;t<e[r]?s=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let s=0;s!==r;++s)e[s]=n[i+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}};Xh.prototype.beforeStart_=Xh.prototype.copySampleValue_,Xh.prototype.afterEnd_=Xh.prototype.copySampleValue_;var Jh=class extends Xh{constructor(t,e,n,r){super(t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ni,endingEnd:ni}}intervalChanged_(t,e,n){let r=this.parameterPositions,i=t-2,s=t+1,o=r[i],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case ri:i=t,o=2*e-n;break;case ii:i=r.length-2,o=e+r[i]-r[i+1];break;default:i=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case ri:s=t,a=2*n-e;break;case ii:s=1,a=n+r[1]-r[0];break;default:s=t-1,a=e}let l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=s*c}interpolate_(t,e,n,r){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let b=0;b!==o;++b)i[b]=g*s[c+b]+v*s[l+b]+y*s[a+b]+_*s[u+b];return i}},Yh=class extends Xh{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(r-e),u=1-c;for(let h=0;h!==o;++h)i[h]=s[l+h]*u+s[a+h]*c;return i}},Zh=class extends Xh{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t){return this.copySampleValue_(t-1)}},Kh=class{constructor(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=$h.convertArray(e,this.TimeBufferType),this.values=$h.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){let e,n=t.constructor;if(n.toJSON!==this.toJSON)e=n.toJSON(t);else{e={name:t.name,times:$h.convertArray(t.times,Array),values:$h.convertArray(t.values,Array)};let n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e}InterpolantFactoryMethodDiscrete(t){return new Zh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Yh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Jh(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Qr:e=this.InterpolantFactoryMethodDiscrete;break;case ti:e=this.InterpolantFactoryMethodLinear;break;case ei:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){let e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Qr;case this.InterpolantFactoryMethodLinear:return ti;case this.InterpolantFactoryMethodSmooth:return ei}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){let e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this}scale(t){if(1!==t){let e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this}trim(t,e){let n=this.times,r=n.length,i=0,s=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);let t=this.getValueSize();this.times=$h.arraySlice(n,i,s),this.values=$h.arraySlice(this.values,i*t,s*t)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let o=0;o!==i;o++){let e=n[o];if("number"==typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,e),t=!1;break}if(null!==s&&s>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,e,s),t=!1;break}s=e}if(void 0!==r&&$h.isTypedArray(r))for(let o=0,a=r.length;o!==a;++o){let e=r[o];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,e),t=!1;break}}return t}optimize(){let t=$h.arraySlice(this.times),e=$h.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===ei,i=t.length-1,s=1;for(let o=1;o<i;++o){let i=!1,a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(r)i=!0;else{let t=o*n,r=t-n,s=t+n;for(let o=0;o!==n;++o){let n=e[t+o];if(n!==e[r+o]||n!==e[s+o]){i=!0;break}}}if(i){if(o!==s){t[s]=t[o];let r=o*n,i=s*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++s}}if(i>0){t[s]=t[i];for(let t=i*n,r=s*n,o=0;o!==n;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=$h.arraySlice(t,0,s),this.values=$h.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this}clone(){let t=$h.arraySlice(this.times,0),e=$h.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}};Kh.prototype.TimeBufferType=Float32Array,Kh.prototype.ValueBufferType=Float32Array,Kh.prototype.DefaultInterpolation=ti;var Qh=class extends Kh{};Qh.prototype.ValueTypeName="bool",Qh.prototype.ValueBufferType=Array,Qh.prototype.DefaultInterpolation=Qr,Qh.prototype.InterpolantFactoryMethodLinear=void 0,Qh.prototype.InterpolantFactoryMethodSmooth=void 0;var td=class extends Kh{};td.prototype.ValueTypeName="color";var ed=class extends Kh{};ed.prototype.ValueTypeName="number";var nd=class extends Xh{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(r-e),l=t*o;for(let c=l+o;l!==c;l+=4)Ji.slerpFlat(i,0,s,l-o,s,l,a);return i}},rd=class extends Kh{InterpolantFactoryMethodLinear(t){return new nd(this.times,this.values,this.getValueSize(),t)}};rd.prototype.ValueTypeName="quaternion",rd.prototype.DefaultInterpolation=ti,rd.prototype.InterpolantFactoryMethodSmooth=void 0;var id=class extends Kh{};id.prototype.ValueTypeName="string",id.prototype.ValueBufferType=Array,id.prototype.DefaultInterpolation=Qr,id.prototype.InterpolantFactoryMethodLinear=void 0,id.prototype.InterpolantFactoryMethodSmooth=void 0;var sd=class extends Kh{};sd.prototype.ValueTypeName="vector";var od=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:si;this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=_i(),this.duration<0&&this.resetDuration()}static parse(t){let e=[],n=t.tracks,r=1/(t.fps||1);for(let s=0,o=n.length;s!==o;++s)e.push(ad(n[s]).scale(r));let i=new this(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i}static toJSON(t){let e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let i=0,s=n.length;i!==s;++i)e.push(Kh.toJSON(n[i]));return r}static CreateFromMorphTargetSequence(t,e,n,r){let i=e.length,s=[];for(let o=0;o<i;o++){let t=[],a=[];t.push((o+i-1)%i,o,(o+1)%i),a.push(0,1,0);let l=$h.getKeyframeOrder(t);t=$h.sortedArray(t,1,l),a=$h.sortedArray(a,1,l),!r&&0===t[0]&&(t.push(i),a.push(a[0])),s.push(new ed(".morphTargetInfluences["+e[o].name+"]",t,a).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){let e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let r=0;r<n.length;r++)if(n[r].name===e)return n[r];return null}static CreateClipsFromMorphTargetSequences(t,e,n){let r={},i=/^([\w-]*?)([\d]+)$/;for(let o=0,a=t.length;o<a;o++){let e=t[o],n=e.name.match(i);if(n&&n.length>1){let t=n[1],i=r[t];i||(r[t]=i=[]),i.push(e)}}let s=[];for(let o in r)s.push(this.CreateFromMorphTargetSequence(o,r[o],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(t,e,n,r,i){if(0!==n.length){let s=[],o=[];$h.flattenJSON(n,s,o,r),0!==s.length&&i.push(new t(e,s,o))}},r=[],i=t.name||"default",s=t.fps||30,o=t.blendMode,a=t.length||-1,l=t.hierarchy||[];for(let c=0;c<l.length;c++){let t=l[c].keys;if(t&&0!==t.length)if(t[0].morphTargets){let e,n={};for(e=0;e<t.length;e++)if(t[e].morphTargets)for(let r=0;r<t[e].morphTargets.length;r++)n[t[e].morphTargets[r]]=-1;for(let i in n){let n=[],s=[];for(let r=0;r!==t[e].morphTargets.length;++r){let r=t[e];n.push(r.time),s.push(r.morphTarget===i?1:0)}r.push(new ed(".morphTargetInfluence["+i+"]",n,s))}a=n.length*s}else{let i=".bones["+e[c].name+"]";n(sd,i+".position",t,"pos",r),n(rd,i+".quaternion",t,"rot",r),n(sd,i+".scale",t,"scl",r)}}return 0===r.length?null:new this(i,a,r,o)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){let n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){let t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function ad(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ed;case"vector":case"vector2":case"vector3":case"vector4":return sd;case"color":return td;case"quaternion":return rd;case"bool":case"boolean":return Qh;case"string":return id}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){let e=[],n=[];$h.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}var ld={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},cd=new class{constructor(t,e,n){let r,i=this,s=!1,o=0,a=0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==i.onStart&&i.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){let e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){let n=l[e],r=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}},ud=class{constructor(t){this.manager=void 0!==t?t:cd,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){let n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}},hd={},dd=class extends ud{constructor(t){super(t)}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let i=ld.get(t);if(void 0!==i)return this.manager.itemStart(t),setTimeout((()=>{e&&e(i),this.manager.itemEnd(t)}),0),i;if(void 0!==hd[t])return void hd[t].push({onLoad:e,onProgress:n,onError:r});hd[t]=[],hd[t].push({onLoad:e,onProgress:n,onError:r});let s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===e.body||void 0===e.body.getReader)return e;let n=hd[t],r=e.body.getReader(),i=e.headers.get("Content-Length"),s=i?parseInt(i):0,o=0!==s,a=0,l=new ReadableStream({start(t){!function e(){r.read().then((r=>{let{done:i,value:l}=r;if(i)t.close();else{a+=l.byteLength;let r=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=n.length;t<e;t++){let e=n[t];e.onProgress&&e.onProgress(r)}t.enqueue(l),e()}}))}()}});return new Response(l)}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{let e=/charset="?([^;"\s]*)"?/i.exec(o),n=e&&e[1]?e[1].toLowerCase():void 0,r=new TextDecoder(n);return t.arrayBuffer().then((t=>r.decode(t)))}}})).then((e=>{ld.add(t,e);let n=hd[t];delete hd[t];for(let t=0,r=n.length;t<r;t++){let r=n[t];r.onLoad&&r.onLoad(e)}})).catch((e=>{let n=hd[t];if(void 0===n)throw this.manager.itemError(t),e;delete hd[t];for(let t=0,r=n.length;t<r;t++){let r=n[t];r.onError&&r.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}},pd=class extends ud{constructor(t){super(t)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let i=this,s=ld.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;let o=Ai("img");function a(){c(),ld.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){c(),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}},fd=class extends ud{constructor(t){super(t)}load(t,e,n,r){let i=new na,s=new pd(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(n){s.load(t[n],(function(t){i.images[n]=t,o++,6===o&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(let l=0;l<t.length;++l)a(l);return i}},md=class extends ud{constructor(t){super(t)}load(t,e,n,r){let i=new Wi,s=new pd(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){i.image=t,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}},gd=class extends Ks{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.type="Light",this.color=new Ui(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){let e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}};gd.prototype.isLight=!0;(class extends gd{constructor(t,e,n){super(t,n),this.type="HemisphereLight",this.position.copy(Ks.DefaultUp),this.updateMatrix(),this.groundColor=new Ui(e)}copy(t){return gd.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}).prototype.isHemisphereLight=!0;var vd=new As,yd=new Yi,_d=new Yi,bd=class{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Mi(512,512),this.map=null,this.mapPass=null,this.matrix=new As,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ua,this._frameExtents=new Mi(1,1),this._viewportCount=1,this._viewports=[new Gi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){let e=this.camera,n=this.matrix;yd.setFromMatrixPosition(t.matrixWorld),e.position.copy(yd),_d.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(_d),e.updateMatrixWorld(),vd.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(vd),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}},xd=class extends bd{constructor(){super(new Qo(50,1,.5,500)),this.focus=1}updateMatrices(t){let e=this.camera,n=2*yi*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;(n!==e.fov||r!==e.aspect||i!==e.far)&&(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}};xd.prototype.isSpotLightShadow=!0;(class extends gd{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(t,e),this.type="SpotLight",this.position.copy(Ks.DefaultUp),this.updateMatrix(),this.target=new Ks,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.shadow=new xd}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}).prototype.isSpotLight=!0;var wd=new As,Sd=new Yi,Md=new Yi,Ed=class extends bd{constructor(){super(new Qo(90,1,.5,500)),this._frameExtents=new Mi(4,2),this._viewportCount=6,this._viewports=[new Gi(2,1,1,1),new Gi(0,1,1,1),new Gi(3,1,1,1),new Gi(1,1,1,1),new Gi(3,0,1,1),new Gi(1,0,1,1)],this._cubeDirections=[new Yi(1,0,0),new Yi(-1,0,0),new Yi(0,0,1),new Yi(0,0,-1),new Yi(0,1,0),new Yi(0,-1,0)],this._cubeUps=[new Yi(0,1,0),new Yi(0,1,0),new Yi(0,1,0),new Yi(0,1,0),new Yi(0,0,1),new Yi(0,0,-1)]}updateMatrices(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Sd.setFromMatrixPosition(t.matrixWorld),n.position.copy(Sd),Md.copy(n.position),Md.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Md),n.updateMatrixWorld(),r.makeTranslation(-Sd.x,-Sd.y,-Sd.z),wd.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(wd)}};Ed.prototype.isPointLightShadow=!0;(class extends gd{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(t,e),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Ed}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}).prototype.isPointLight=!0;var Td=class extends bd{constructor(){super(new Sa(-5,5,5,-5,.5,500))}};Td.prototype.isDirectionalLightShadow=!0;(class extends gd{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Ks.DefaultUp),this.updateMatrix(),this.target=new Ks,this.shadow=new Td}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}).prototype.isDirectionalLight=!0;(class extends gd{constructor(t,e){super(t,e),this.type="AmbientLight"}}).prototype.isAmbientLight=!0;(class extends gd{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(t,e),this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){let e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}).prototype.isRectAreaLight=!0;var Ad=class{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Yi)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){let n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*r),e.addScaledVector(s[2],.488603*i),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*r*1.092548),e.addScaledVector(s[5],r*i*1.092548),e.addScaledVector(s[6],.315392*(3*i*i-1)),e.addScaledVector(s[7],n*i*1.092548),e.addScaledVector(s[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){let n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*r),e.addScaledVector(s[2],1.023328*i),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*r),e.addScaledVector(s[5],.858086*r*i),e.addScaledVector(s[6],.743125*i*i-.247708),e.addScaledVector(s[7],.858086*n*i),e.addScaledVector(s[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){let n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}};Ad.prototype.isSphericalHarmonics3=!0;var Cd=class extends gd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ad;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){let e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}};Cd.prototype.isLightProbe=!0;var Pd=class{static decodeText(t){if(typeof TextDecoder<"u")return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){let e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}};(class extends Ao{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){let t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}).prototype.isInstancedBufferGeometry=!0;(class extends ud{constructor(t){super(t),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let i=this,s=ld.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;let o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){ld.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}).prototype.isImageBitmapLoader=!0;var Id,Rd=function(){return void 0===Id&&(Id=new(window.AudioContext||window.webkitAudioContext)),Id},Ld=class extends ud{constructor(t){super(t)}load(t,e,n,r){let i=this,s=new dd(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{let t=n.slice(0);Rd().decodeAudioData(t,(function(t){e(t)}))}catch(s){r?r(s):console.error(s),i.manager.itemError(t)}}),n,r)}};(class extends Cd{constructor(t,e){super(void 0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);let n=(new Ui).set(t),r=(new Ui).set(e),i=new Yi(n.r,n.g,n.b),s=new Yi(r.r,r.g,r.b),o=Math.sqrt(Math.PI),a=o*Math.sqrt(.75);this.sh.coefficients[0].copy(i).add(s).multiplyScalar(o),this.sh.coefficients[1].copy(i).sub(s).multiplyScalar(a)}}).prototype.isHemisphereLightProbe=!0;(class extends Cd{constructor(t){super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);let e=(new Ui).set(t);this.sh.coefficients[0].set(e.r,e.g,e.b).multiplyScalar(2*Math.sqrt(Math.PI))}}).prototype.isAmbientLightProbe=!0;var Nd=class{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Od(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let e=Od();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}};function Od(){return(typeof performance>"u"?Date:performance).now()}var kd=class{constructor(t,e,n){let r,i,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){let n=this.buffer,r=this.valueSize,i=t*r+r,s=this.cumulativeWeight;if(0===s){for(let t=0;t!==r;++t)n[i+t]=n[t];s=e}else{s+=e;let t=e/s;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=s}accumulateAdditive(t){let e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){let e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){let t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-i,e)}s>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let a=e,l=e+e;a!==l;++a)if(n[a]!==n[a+e]){o.setValue(n,r);break}}saveOriginalState(){let t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let i=n,s=r;i!==s;++i)e[i]=e[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){let t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,r,i){if(r>=.5)for(let s=0;s!==i;++s)t[e+s]=t[n+s]}_slerp(t,e,n,r){Ji.slerpFlat(t,e,t,e,t,n,r)}_slerpAdditive(t,e,n,r,i){let s=this._workIndex*i;Ji.multiplyQuaternionsFlat(t,s,t,e,t,n),Ji.slerpFlat(t,e,t,e,t,s,r)}_lerp(t,e,n,r,i){let s=1-r;for(let o=0;o!==i;++o){let i=e+o;t[i]=t[i]*s+t[n+o]*r}}_lerpAdditive(t,e,n,r,i){for(let s=0;s!==i;++s){let i=e+s;t[i]=t[i]+t[n+s]*r}}},Dd="\\[\\]\\.:\\/",zd=new RegExp("["+Dd+"]","g"),Ud="[^"+Dd+"]",Fd="[^"+Dd.replace("\\.","")+"]",Bd=/((?:WC+[\/:])*)/.source.replace("WC",Ud),Vd=/(WCOD+)?/.source.replace("WCOD",Fd),Hd=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ud),jd=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ud),Wd=new RegExp("^"+Bd+Vd+Hd+jd+"$"),Gd=["material","materials","bones"],qd=class t{constructor(e,n,r){this.path=n,this.parsedPath=r||t.parseTrackName(n),this.node=t.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,r){return e&&e.isAnimationObjectGroup?new t.Composite(e,n,r):new t(e,n,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(zd,"")}static parseTrackName(t){let e=Wd.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){let t=n.nodeName.substring(r+1);-1!==Gd.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){let n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){let n=function(t){for(let r=0;r<t.length;r++){let i=t[r];if(i.name===e||i.uuid===e)return i;let s=n(i.children);if(s)return s}return null},r=n(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let e=this.node,n=this.parsedPath,r=n.objectName,i=n.propertyName,s=n.propertyIndex;if(e||(e=t.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let t=n.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let n=0;n<e.length;n++)if(e[n].name===t){t=n;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==t){if(void 0===e[t])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[t]}}let o=e[i];if(void 0===o){let t=n.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+t+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else void 0!==o.fromArray&&void 0!==o.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};qd.Composite=class{constructor(t,e,n){let r=n||qd.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();let n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)}setValue(t,e){let n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},qd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},qd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},qd.prototype.GetterByBindingType=[qd.prototype._getValue_direct,qd.prototype._getValue_array,qd.prototype._getValue_arrayElement,qd.prototype._getValue_toArray],qd.prototype.SetterByBindingTypeAndVersioning=[[qd.prototype._setValue_direct,qd.prototype._setValue_direct_setNeedsUpdate,qd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[qd.prototype._setValue_array,qd.prototype._setValue_array_setNeedsUpdate,qd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[qd.prototype._setValue_arrayElement,qd.prototype._setValue_arrayElement_setNeedsUpdate,qd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[qd.prototype._setValue_fromArray,qd.prototype._setValue_fromArray_setNeedsUpdate,qd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var $d=class{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.blendMode;this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;let i=e.tracks,s=i.length,o=new Array(s),a={endingStart:ni,endingEnd:ni};for(let l=0;l!==s;++l){let t=i[l].createInterpolant(null);o[l]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){let n=this._clip.duration,r=t._clip.duration,i=r/n,s=n/r;t.warp(1,i,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){let t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){let r=this._mixer,i=r.time,s=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);let a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){let t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,r){if(!this.enabled)return void this._updateWeight(t);let i=this._startTime;if(null!==i){let r=(t-i)*n;if(r<0||0===n)return;this._startTime=null,e=n*r}e*=this._updateTimeScale(t);let s=this._updateTime(e),o=this._updateWeight(t);if(o>0){let t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulateAdditive(o);else for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulate(r,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;let n=this._weightInterpolant;if(null!==n){let r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;let n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){let e=this._clip.duration,n=this.loop,r=this.time+t,i=this._loopCount,s=2202===n;if(0===t)return-1===i?r:s&&1===(1&i)?e-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=e||r<0){let n=Math.floor(r/e);r-=e*n,i+=Math.abs(n);let o=this.repetitions-i;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){let e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(s&&1===(1&i))return e-r}return r}_setEndings(t,e,n){let r=this._interpolantSettings;n?(r.endingStart=ri,r.endingEnd=ri):(r.endingStart=t?this.zeroSlopeAtStart?ri:ni:ii,r.endingEnd=e?this.zeroSlopeAtEnd?ri:ni:ii)}_scheduleFading(t,e,n){let r=this._mixer,i=r.time,s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let o=s.parameterPositions,a=s.sampleValues;return o[0]=i,a[0]=e,o[1]=i+t,a[1]=n,this}};(class extends mi{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){let n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName,c=l[a];void 0===c&&(c={},l[a]=c);for(let u=0;u!==i;++u){let t=r[u],i=t.name,l=c[i];if(void 0!==l)++l.referenceCount,s[u]=l;else{if(l=s[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,i));continue}let r=e&&e._propertyBindings[u].binding.parsedPath;l=new kd(qd.create(n,i,r),t.ValueTypeName,t.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,i),s[u]=l}o[u].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){let e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}let e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){let n=e[t];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){let e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){let n=e[t];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){let e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){let r=this._actions,i=this._actionsByClip,s=i[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=s;else{let e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){let e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;let i=t._clip.uuid,s=this._actionsByClip,o=s[i],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[i],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){let e=t._propertyBindings;for(let n=0,r=e.length;n!==r;++n){let t=e[n];0===--t.referenceCount&&this._removeInactiveBinding(t)}}_lendAction(t){let e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackAction(t){let e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_addInactiveBinding(t,e,n){let r=this._bindingsByRootAndName,i=this._bindings,s=r[e];void 0===s&&(s={},r[e]=s),s[n]=t,t._cacheIndex=i.length,i.push(t)}_removeInactiveBinding(t){let e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,s=this._bindingsByRootAndName,o=s[r],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[i],0===Object.keys(o).length&&delete s[r]}_lendBinding(t){let e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackBinding(t){let e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_lendControlInterpolant(){let t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&(n=new Yh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){let e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i}clipAction(t,e,n){let r=e||this._root,i=r.uuid,s="string"==typeof t?od.findByName(r,t):t,o=null!==s?s.uuid:t,a=this._actionsByClip[o],l=null;if(void 0===n&&(n=null!==s?s.blendMode:si),void 0!==a){let t=a.actionByRoot[i];if(void 0!==t&&t.blendMode===n)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;let c=new $d(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,o,i),c}existingAction(t,e){let n=e||this._root,r=n.uuid,i="string"==typeof t?od.findByName(n,t):t,s=i?i.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[r]||null}stopAllAction(){let t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;let e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),s=this._accuIndex^=1;for(let l=0;l!==n;++l)e[l]._update(r,t,i,s);let o=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)o[l].apply(s);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){let e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){let t=i.knownActions;for(let n=0,r=t.length;n!==r;++n){let r=t[n];this._deactivateAction(r);let i=r._cacheIndex,s=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,s._cacheIndex=i,e[i]=s,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(t){let e=t.uuid,n=this._actionsByClip;for(let i in n){let t=n[i].actionByRoot[e];void 0!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}let r=this._bindingsByRootAndName[e];if(void 0!==r)for(let i in r){let t=r[i];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(t,e){let n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);(class extends qc{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(t,e),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){let e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){let e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}).prototype.isInstancedInterleavedBuffer=!0;var Xd=new Yi,Jd=new As,Yd=new As;function Zd(t){let e=[];!0===t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,Zd(t.children[n]));return e}var Kd=new Uint32Array(512),Qd=new Uint32Array(512);for(let n=0;n<256;++n){let t=n-127;t<-27?(Kd[n]=0,Kd[256|n]=32768,Qd[n]=24,Qd[256|n]=24):t<-14?(Kd[n]=1024>>-t-14,Kd[256|n]=1024>>-t-14|32768,Qd[n]=-t-1,Qd[256|n]=-t-1):t<=15?(Kd[n]=t+15<<10,Kd[256|n]=t+15<<10|32768,Qd[n]=13,Qd[256|n]=13):t<128?(Kd[n]=31744,Kd[256|n]=64512,Qd[n]=24,Qd[256|n]=24):(Kd[n]=31744,Kd[256|n]=64512,Qd[n]=13,Qd[256|n]=13)}var tp=new Uint32Array(2048),ep=new Uint32Array(64),np=new Uint32Array(64);for(let n=1;n<1024;++n){let t=n<<13,e=0;for(;!(8388608&t);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,tp[n]=t|e}for(let n=1024;n<2048;++n)tp[n]=939524096+(n-1024<<13);for(let n=1;n<31;++n)ep[n]=n<<23;ep[31]=1199570944,ep[32]=2147483648;for(let n=33;n<63;++n)ep[n]=2147483648+(n-32<<23);ep[63]=3347054592;for(let n=1;n<64;++n)32!==n&&(np[n]=1024);zu.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(zu.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},rh.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},class extends Iu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;n=new Ui(n),r=new Ui(r);let i=e/2,s=t/e,o=t/2,a=[],l=[];for(let u=0,h=0,d=-o;u<=e;u++,d+=s){a.push(-o,0,d,o,0,d),a.push(d,0,-o,d,0,o);let t=u===i?n:r;t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3}let c=new Ao;c.setAttribute("position",new _o(a,3)),c.setAttribute("color",new _o(l,3)),super(c,new xu({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends Iu{constructor(t){let e=Zd(t),n=new Ao,r=[],i=[],s=new Ui(0,0,1),o=new Ui(0,1,0);for(let a=0;a<e.length;a++){let t=e[a];t.parent&&t.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(s.r,s.g,s.b),i.push(o.r,o.g,o.b))}n.setAttribute("position",new _o(r,3)),n.setAttribute("color",new _o(i,3)),super(n,new xu({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){let e=this.bones,n=this.geometry,r=n.getAttribute("position");Yd.copy(this.root.matrixWorld).invert();for(let i=0,s=0;i<e.length;i++){let t=e[i];t.parent&&t.parent.isBone&&(Jd.multiplyMatrices(Yd,t.matrixWorld),Xd.setFromMatrixPosition(Jd),r.setXYZ(s,Xd.x,Xd.y,Xd.z),Jd.multiplyMatrices(Yd,t.parent.matrixWorld),Xd.setFromMatrixPosition(Jd),r.setXYZ(s+1,Xd.x,Xd.y,Xd.z),s+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},ud.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Pd.extractUrlBase(t)},ud.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Qi.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Qi.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Qi.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Qi.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Qi.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},zs.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},ys.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ua.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Ei.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Ei.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Ei.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Ei.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Ei.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Ei.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},As.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},As.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},As.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Yi).setFromMatrixColumn(this,3)},As.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},As.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},As.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},As.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},As.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},As.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},As.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},As.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},As.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},As.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},As.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},As.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},As.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},As.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},As.prototype.makeFrustum=function(t,e,n,r,i,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,s)},As.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},aa.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Ji.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Ji.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Ts.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Ts.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},Ts.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},co.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},co.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},co.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},co.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},co.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},co.barycoordFromPoint=function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),co.getBarycoord(t,e,n,r,i)},co.normal=function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),co.getNormal(t,e,n,r)},ih.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},ih.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Nh(this,t)},ih.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new kh(this,t)},Mi.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Mi.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Mi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Yi.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Yi.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Yi.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},Yi.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},Yi.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},Yi.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},Yi.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Yi.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Yi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Gi.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Gi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ks.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},Ks.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Ks.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},Ks.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Ks.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Ks.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Go.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Go.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),mu.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Qo.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(gd.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(go.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===di},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(di)}}}),go.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?di:hi),this},go.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},go.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Ao.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},Ao.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new go(arguments[1],arguments[2])))},Ao.prototype.addDrawCall=function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},Ao.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Ao.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Ao.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},Ao.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Ao.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),qc.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?di:hi),this},qc.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Nh.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Nh.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Nh.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Gc.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(ho.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ui}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Zo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Wc.prototype.clearTarget=function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},Wc.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},Wc.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Wc.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Wc.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Wc.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Wc.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Wc.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Wc.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Wc.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Wc.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Wc.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Wc.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Wc.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Wc.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},Wc.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Wc.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Wc.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Wc.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Wc.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Wc.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Wc.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Wc.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Wc.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Wc.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Wc.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?ai:oi}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(Nc.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(qi.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),class extends Ks{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;let e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let e=this;return(new Ld).load(t,(function(t){e.setBuffer(t)})),this},ea.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},ea.prototype.clear=function(t,e,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,r)},Bi.crossOrigin=void 0,Bi.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let i=new md;i.setCrossOrigin(this.crossOrigin);let s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s},Bi.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let i=new fd;i.setCrossOrigin(this.crossOrigin);let s=i.load(t,n,void 0,r);return e&&(s.mapping=e),s},Bi.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Bi.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:pr}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=pr);var rp=1e3,ip=1001,sp=1002,op=1003,ap=1006,lp=1008,cp=2300,up=2301,hp=2302,dp=3001,pp="srgb",fp="srgb-linear",mp=7680,gp=35044,vp=class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});let n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;let n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;let n=this._listeners[t];if(void 0!==n){let t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;let e=this._listeners[t.type];if(void 0!==e){t.target=this;let n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t);t.target=null}}},yp={};((t,e)=>{for(var n in e)Bn(t,n,{get:e[n],enumerable:!0})})(yp,{DEG2RAD:()=>xp,RAD2DEG:()=>wp,ceilPowerOfTwo:()=>Bp,clamp:()=>Mp,damp:()=>Pp,degToRad:()=>zp,denormalize:()=>jp,euclideanModulo:()=>Ep,floorPowerOfTwo:()=>Vp,generateUUID:()=>Sp,inverseLerp:()=>Ap,isPowerOfTwo:()=>Fp,lerp:()=>Cp,mapLinear:()=>Tp,normalize:()=>Wp,pingpong:()=>Ip,radToDeg:()=>Up,randFloat:()=>Op,randFloatSpread:()=>kp,randInt:()=>Np,seededRandom:()=>Dp,setQuaternionFromProperEuler:()=>Hp,smootherstep:()=>Lp,smoothstep:()=>Rp});var _p=[];for(let n=0;n<256;n++)_p[n]=(n<16?"0":"")+n.toString(16);var bp=1234567,xp=Math.PI/180,wp=180/Math.PI;function Sp(){let t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(_p[255&t]+_p[t>>8&255]+_p[t>>16&255]+_p[t>>24&255]+"-"+_p[255&e]+_p[e>>8&255]+"-"+_p[e>>16&15|64]+_p[e>>24&255]+"-"+_p[63&n|128]+_p[n>>8&255]+"-"+_p[n>>16&255]+_p[n>>24&255]+_p[255&r]+_p[r>>8&255]+_p[r>>16&255]+_p[r>>24&255]).toLowerCase()}function Mp(t,e,n){return Math.max(e,Math.min(n,t))}function Ep(t,e){return(t%e+e)%e}function Tp(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)}function Ap(t,e,n){return t!==e?(n-t)/(e-t):0}function Cp(t,e,n){return(1-n)*t+n*e}function Pp(t,e,n,r){return Cp(t,e,1-Math.exp(-n*r))}function Ip(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e-Math.abs(Ep(t,2*e)-e)}function Rp(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)}function Lp(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)}function Np(t,e){return t+Math.floor(Math.random()*(e-t+1))}function Op(t,e){return t+Math.random()*(e-t)}function kp(t){return t*(.5-Math.random())}function Dp(t){void 0!==t&&(bp=t);let e=bp+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}function zp(t){return t*xp}function Up(t){return t*wp}function Fp(t){return 0===(t&t-1)&&0!==t}function Bp(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Vp(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Hp(t,e,n,r,i){let s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),d=o((e-r)/2),p=s((r-e)/2),f=o((r-e)/2);switch(i){case"XYX":t.set(a*u,l*h,l*d,a*c);break;case"YZY":t.set(l*d,a*u,l*h,a*c);break;case"ZXZ":t.set(l*h,l*d,a*u,a*c);break;case"XZX":t.set(a*u,l*f,l*p,a*c);break;case"YXY":t.set(l*p,a*u,l*f,a*c);break;case"ZYZ":t.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function jp(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Wp(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}var Gp=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};Gp.prototype.isVector2=!0;var qp=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,s,o,a,l){let c=this.elements;return c[0]=t,c[1]=r,c[2]=o,c[3]=e,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],_=r[7],b=r[2],x=r[5],w=r[8];return i[0]=s*f+o*v+a*b,i[3]=s*m+o*y+a*x,i[6]=s*g+o*_+a*w,i[1]=l*f+c*v+u*b,i[4]=l*m+c*y+u*x,i[7]=l*g+c*_+u*w,i[2]=h*f+d*v+p*b,i[5]=h*m+d*y+p*x,i[8]=h*g+d*_+p*w,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*i*c+n*o*a+r*i*l-r*s*a}invert(){let t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=c*s-o*l,h=o*a-c*i,d=l*i-s*a,p=e*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return t[0]=u*f,t[1]=(r*l-c*n)*f,t[2]=(o*n-r*s)*f,t[3]=h*f,t[4]=(c*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){let a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){let n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){let e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],s=r[3],o=r[6],a=r[1],l=r[4],c=r[7];return r[0]=e*i+n*a,r[3]=e*s+n*l,r[6]=e*o+n*c,r[1]=-n*i+e*a,r[4]=-n*s+e*l,r[7]=-n*o+e*c,this}translate(t,e){let n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){let e=this.elements,n=t.elements;for(let r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}};function $p(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Xp(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Jp(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}qp.prototype.isMatrix3=!0;var Yp={[pp]:{[fp]:Xp},[fp]:{[pp]:Jp}},Zp={legacyMode:!0,get workingColorSpace(){return fp},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,n){if(this.legacyMode||e===n||!e||!n)return t;if(Yp[e]&&void 0!==Yp[e][n]){let r=Yp[e][n];return t.r=r(t.r),t.g=r(t.g),t.b=r(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},Kp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Qp={r:0,g:0,b:0},tf={h:0,s:0,l:0},ef={h:0,s:0,l:0};function nf(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function rf(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}var sf=class{constructor(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pp;return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Zp.toWorkingColorSpace(this,e),this}setRGB(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fp;return this.r=t,this.g=e,this.b=n,Zp.toWorkingColorSpace(this,r),this}setHSL(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fp;if(t=Ep(t,1),e=Mp(e,0,1),n=Mp(n,0,1),0===e)this.r=this.g=this.b=n;else{let r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=nf(i,r,t+1/3),this.g=nf(i,r,t),this.b=nf(i,r,t-1/3)}return Zp.toWorkingColorSpace(this,r),this}setStyle(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pp;function r(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(e=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t,i=e[1],s=e[2];switch(i){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,Zp.toWorkingColorSpace(this,n),r(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,Zp.toWorkingColorSpace(this,n),r(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){let e=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,s=parseInt(t[3],10)/100;return r(t[4]),this.setHSL(e,i,s,n)}}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(t)){let t=e[1],r=t.length;if(3===r)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,Zp.toWorkingColorSpace(this,n),this;if(6===r)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,Zp.toWorkingColorSpace(this,n),this}return t&&t.length>0?this.setColorName(t,n):this}setColorName(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pp,n=Kp[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Xp(t.r),this.g=Xp(t.g),this.b=Xp(t.b),this}copyLinearToSRGB(t){return this.r=Jp(t.r),this.g=Jp(t.g),this.b=Jp(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pp;return Zp.fromWorkingColorSpace(rf(this,Qp),t),Mp(255*Qp.r,0,255)<<16^Mp(255*Qp.g,0,255)<<8^Mp(255*Qp.b,0,255)}getHexString(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pp;return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fp;Zp.fromWorkingColorSpace(rf(this,Qp),e);let n,r,i=Qp.r,s=Qp.g,o=Qp.b,a=Math.max(i,s,o),l=Math.min(i,s,o),c=(l+a)/2;if(l===a)n=0,r=0;else{let t=a-l;switch(r=c<=.5?t/(a+l):t/(2-a-l),a){case i:n=(s-o)/t+(s<o?6:0);break;case s:n=(o-i)/t+2;break;case o:n=(i-s)/t+4}n/=6}return t.h=n,t.s=r,t.l=c,t}getRGB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fp;return Zp.fromWorkingColorSpace(rf(this,Qp),e),t.r=Qp.r,t.g=Qp.g,t.b=Qp.b,t}getStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pp;return Zp.fromWorkingColorSpace(rf(this,Qp),t),t!==pp?`color(${t} ${Qp.r} ${Qp.g} ${Qp.b})`:`rgb(${255*Qp.r|0},${255*Qp.g|0},${255*Qp.b|0})`}offsetHSL(t,e,n){return this.getHSL(tf),tf.h+=t,tf.s+=e,tf.l+=n,this.setHSL(tf.h,tf.s,tf.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(tf),t.getHSL(ef);let n=Cp(tf.h,ef.h,e),r=Cp(tf.s,ef.s,e),i=Cp(tf.l,ef.l,e);return this.setHSL(n,r,i),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};sf.NAMES=Kp,sf.prototype.isColor=!0,sf.prototype.r=1,sf.prototype.g=1,sf.prototype.b=1;var of,af=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===of&&(of=$p("canvas")),of.width=t.width,of.height=t.height;let n=of.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=of}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let e=$p("canvas");e.width=t.width,e.height=t.height;let n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);let r=n.getImageData(0,0,t.width,t.height),i=r.data;for(let t=0;t<i.length;t++)i[t]=255*Xp(i[t]/255);return n.putImageData(r,0,0),e}if(t.data){let e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Xp(e[t]/255)):e[t]=Xp(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},lf=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.uuid=Sp(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){let e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];let n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(cf(r[e].image)):t.push(cf(r[e]))}else t=cf(r);n.url=t}return e||(t.images[this.uuid]=n),n}};function cf(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?af.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}lf.prototype.isSource=!0;var uf=0,hf=class t extends vp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.DEFAULT_IMAGE,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.DEFAULT_MAPPING,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ip,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ip,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ap,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:lp,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1023,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1009,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:3e3;super(),Object.defineProperty(this,"id",{value:uf++}),this.uuid=Sp(),this.name="",this.source=new lf(e),this.mipmaps=[],this.mapping=n,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Gp(0,0),this.repeat=new Gp(1,1),this.center=new Gp(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new qp,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];let n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case rp:t.x=t.x-Math.floor(t.x);break;case ip:t.x=t.x<0?0:1;break;case sp:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case rp:t.y=t.y-Math.floor(t.y);break;case ip:t.y=t.y<0?0:1;break;case sp:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}};hf.DEFAULT_IMAGE=null,hf.DEFAULT_MAPPING=300,hf.prototype.isTexture=!0;var df=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i,s=t.elements,o=s[0],a=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(o+u+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let t=(o+1)/2,s=(u+1)/2,m=(f+1)/2,g=(a+c)/4,v=(l+d)/4,y=(h+p)/4;return t>s&&t>m?t<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=g/n,i=v/n):s>m?s<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=g/r,i=y/r):m<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(m),n=v/i,r=y/i),this.set(n,r,i,e),this}let m=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(m)<.001&&(m=1),this.x=(p-h)/m,this.y=(l-d)/m,this.z=(c-a)/m,this.w=Math.acos((o+u+f-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};df.prototype.isVector4=!0;var pf=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,r)}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],h=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===o)return t[e+0]=h,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(u!==f||a!==h||l!==d||c!==p){let t=1-o,e=a*h+l*d+c*p+u*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){let i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}let i=o*n;if(a=a*t+h*i,l=l*t+d*i,c=c*t+p*i,u=u*t+f*i,t===1-o){let t=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=t,l*=t,c*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,r,i,s){let o=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[s],h=i[s+1],d=i[s+2],p=i[s+3];return t[e]=o*p+c*u+a*d-l*h,t[e+1]=a*p+c*h+l*u-o*d,t[e+2]=l*p+c*d+o*h-a*u,t[e+3]=c*p-o*u-a*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){let t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>u){let t=2*Math.sqrt(1+n-o-u);this._w=(c-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>u){let t=2*Math.sqrt(1+o-n-u);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+c)/t}else{let t=2*Math.sqrt(1+u-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Mp(this.dot(t),-1,1)))}rotateTowards(t,e){let n=this.angleTo(t);if(0===n)return this;let r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+r*l-i*a,this._y=r*c+s*a+i*o-n*l,this._z=i*c+s*l+n*a-r*o,this._w=s*c-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);let n=this._x,r=this._y,i=this._z,s=this._w,o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;let a=1-o*o;if(a<=Number.EPSILON){let t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){let t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(e*Math.cos(r),n*Math.sin(i),n*Math.cos(i),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}};pf.prototype.isQuaternion=!0;var ff=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(gf.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(gf.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){let e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*r-o*n,c=a*n+o*e-i*r,u=a*r+i*n-s*e,h=-i*e-s*n-o*r;return this.x=l*a+h*-i+c*-o-u*-s,this.y=c*a+h*-s+u*-i-l*-o,this.z=u*a+h*-o+l*-s-c*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){let n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){let e=t.lengthSq();if(0===e)return this.set(0,0,0);let n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return mf.copy(this).projectOnVector(t),this.sub(mf)}reflect(t){return this.sub(mf.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(Mp(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){let r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};ff.prototype.isVector3=!0;var mf=new ff,gf=new pf,vf=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ff(1/0,1/0,1/0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ff(-1/0,-1/0,-1/0);this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){let l=t[a],c=t[a+1],u=t[a+2];l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this}setFromBufferAttribute(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){let l=t.getX(a),c=t.getY(a),u=t.getZ(a);l<e&&(e=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(e,n,r),this.max.set(i,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let n=_f.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.updateWorldMatrix(!1,!1);let n=t.geometry;if(void 0!==n)if(e&&null!=n.attributes&&void 0!==n.attributes.position){let e=n.attributes.position;for(let n=0,r=e.count;n<r;n++)_f.fromBufferAttribute(e,n).applyMatrix4(t.matrixWorld),this.expandByPoint(_f)}else null===n.boundingBox&&n.computeBoundingBox(),bf.copy(n.boundingBox),bf.applyMatrix4(t.matrixWorld),this.union(bf);let r=t.children;for(let i=0,s=r.length;i<s;i++)this.expandByObject(r[i],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,_f),_f.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Af),Cf.subVectors(this.max,Af),xf.subVectors(t.a,Af),wf.subVectors(t.b,Af),Sf.subVectors(t.c,Af),Mf.subVectors(wf,xf),Ef.subVectors(Sf,wf),Tf.subVectors(xf,Sf);let e=[0,-Mf.z,Mf.y,0,-Ef.z,Ef.y,0,-Tf.z,Tf.y,Mf.z,0,-Mf.x,Ef.z,0,-Ef.x,Tf.z,0,-Tf.x,-Mf.y,Mf.x,0,-Ef.y,Ef.x,0,-Tf.y,Tf.x,0];return!(!Rf(e,xf,wf,Sf,Cf)||(e=[1,0,0,0,1,0,0,0,1],!Rf(e,xf,wf,Sf,Cf)))&&(Pf.crossVectors(Mf,Ef),e=[Pf.x,Pf.y,Pf.z],Rf(e,xf,wf,Sf,Cf))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return _f.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(_f).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(yf[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),yf[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),yf[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),yf[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),yf[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),yf[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),yf[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),yf[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(yf)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}};vf.prototype.isBox3=!0;var yf=[new ff,new ff,new ff,new ff,new ff,new ff,new ff,new ff],_f=new ff,bf=new vf,xf=new ff,wf=new ff,Sf=new ff,Mf=new ff,Ef=new ff,Tf=new ff,Af=new ff,Cf=new ff,Pf=new ff,If=new ff;function Rf(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){If.fromArray(t,s);let o=i.x*Math.abs(If.x)+i.y*Math.abs(If.y)+i.z*Math.abs(If.z),a=e.dot(If),l=n.dot(If),c=r.dot(If);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}var Lf=new vf,Nf=new ff,Of=new ff,kf=new ff,Df=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ff,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let n=this.center;void 0!==e?n.copy(e):Lf.setFromPoints(t).getCenter(n);let r=0;for(let i=0,s=t.length;i<s;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){kf.subVectors(t,this.center);let e=kf.lengthSq();if(e>this.radius*this.radius){let t=Math.sqrt(e),n=.5*(t-this.radius);this.center.add(kf.multiplyScalar(n/t)),this.radius+=n}return this}union(t){return!0===this.center.equals(t.center)?Of.set(0,0,1).multiplyScalar(t.radius):Of.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Nf.copy(t.center).add(Of)),this.expandByPoint(Nf.copy(t.center).sub(Of)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}},zf=new ff,Uf=new ff,Ff=new ff,Bf=new ff,Vf=new ff,Hf=new ff,jf=new ff,Wf=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ff,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ff(0,0,-1);this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,zf)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);let n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){let e=zf.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(zf.copy(this.direction).multiplyScalar(e).add(this.origin),zf.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){Uf.copy(t).add(e).multiplyScalar(.5),Ff.copy(e).sub(t).normalize(),Bf.copy(this.origin).sub(Uf);let i,s,o,a,l=.5*t.distanceTo(e),c=-this.direction.dot(Ff),u=Bf.dot(this.direction),h=-Bf.dot(Ff),d=Bf.lengthSq(),p=Math.abs(1-c*c);if(p>0)if(i=c*h-u,s=c*u-h,a=l*p,i>=0)if(s>=-a)if(s<=a){let t=1/p;i*=t,s*=t,o=i*(i+c*s+2*u)+s*(c*i+s+2*h)+d}else s=l,i=Math.max(0,-(c*s+u)),o=-i*i+s*(s+2*h)+d;else s=-l,i=Math.max(0,-(c*s+u)),o=-i*i+s*(s+2*h)+d;else s<=-a?(i=Math.max(0,-(-c*l+u)),s=i>0?-l:Math.min(Math.max(-l,-h),l),o=-i*i+s*(s+2*h)+d):s<=a?(i=0,s=Math.min(Math.max(-l,-h),l),o=s*(s+2*h)+d):(i=Math.max(0,-(c*l+u)),s=i>0?l:Math.min(Math.max(-l,-h),l),o=-i*i+s*(s+2*h)+d);else s=c>0?-l:l,i=Math.max(0,-(c*s+u)),o=-i*i+s*(s+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Ff).multiplyScalar(s).add(Uf),o}intersectSphere(t,e){zf.subVectors(t.center,this.origin);let n=zf.dot(this.direction),r=zf.dot(zf)-n*n,i=t.radius*t.radius;if(r>i)return null;let s=Math.sqrt(i-r),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){let e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;let n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){let n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){let e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,s,o,a,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),n>s||i>r||((i>n||n!==n)&&(n=i),(s<r||r!==r)&&(r=s),u>=0?(o=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||o>r)||((o>n||n!==n)&&(n=o),(a<r||r!==r)&&(r=a),r<0)?null:this.at(n>=0?n:r,e)}intersectsBox(t){return null!==this.intersectBox(t,zf)}intersectTriangle(t,e,n,r,i){Vf.subVectors(e,t),Hf.subVectors(n,t),jf.crossVectors(Vf,Hf);let s,o=this.direction.dot(jf);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Bf.subVectors(this.origin,t);let a=s*this.direction.dot(Hf.crossVectors(Bf,Hf));if(a<0)return null;let l=s*this.direction.dot(Vf.cross(Bf));if(l<0||a+l>o)return null;let c=-s*Bf.dot(jf);return c<0?null:this.at(c/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},Gf=class t{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,i,s,o,a,l,c,u,h,d,p,f,m){let g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new t).fromArray(this.elements)}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){let e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,n=t.elements,r=1/qf.setFromMatrixColumn(t,0).length(),i=1/qf.setFromMatrixColumn(t,1).length(),s=1/qf.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){let t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){let t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){let t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t-i*o,e[4]=-s*u,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*c,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){let t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*u,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){let t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=i-t*u,e[8]=r*u+n,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*u+r,e[10]=t-i*u}else if("XZY"===t.order){let t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=t*u+i,e[5]=s*c,e[9]=n*u-r,e[2]=r*u-n,e[6]=o*c,e[10]=i*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Xf,t,Jf)}lookAt(t,e,n){let r=this.elements;return Kf.subVectors(t,e),0===Kf.lengthSq()&&(Kf.z=1),Kf.normalize(),Yf.crossVectors(n,Kf),0===Yf.lengthSq()&&(1===Math.abs(n.z)?Kf.x+=1e-4:Kf.z+=1e-4,Kf.normalize(),Yf.crossVectors(n,Kf)),Yf.normalize(),Zf.crossVectors(Kf,Yf),r[0]=Yf.x,r[4]=Zf.x,r[8]=Kf.x,r[1]=Yf.y,r[5]=Zf.y,r[9]=Kf.y,r[2]=Yf.z,r[6]=Zf.z,r[10]=Kf.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],b=n[15],x=r[0],w=r[4],S=r[8],M=r[12],E=r[1],T=r[5],A=r[9],C=r[13],P=r[2],I=r[6],R=r[10],L=r[14],N=r[3],O=r[7],k=r[11],D=r[15];return i[0]=s*x+o*E+a*P+l*N,i[4]=s*w+o*T+a*I+l*O,i[8]=s*S+o*A+a*R+l*k,i[12]=s*M+o*C+a*L+l*D,i[1]=c*x+u*E+h*P+d*N,i[5]=c*w+u*T+h*I+d*O,i[9]=c*S+u*A+h*R+d*k,i[13]=c*M+u*C+h*L+d*D,i[2]=p*x+f*E+m*P+g*N,i[6]=p*w+f*T+m*I+g*O,i[10]=p*S+f*A+m*R+g*k,i[14]=p*M+f*C+m*L+g*D,i[3]=v*x+y*E+_*P+b*N,i[7]=v*w+y*T+_*I+b*O,i[11]=v*S+y*A+_*R+b*k,i[15]=v*M+y*C+_*L+b*D,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*a*u-r*l*u-i*o*h+n*l*h+r*o*d-n*a*d)+t[7]*(+e*a*d-e*l*h+i*s*h-r*s*d+r*l*c-i*a*c)+t[11]*(+e*l*u-e*o*d-i*s*u+n*s*d+i*o*c-n*l*c)+t[15]*(-r*o*c-e*a*u+e*o*h+r*s*u-n*s*h+n*a*c)}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(t,e,n){let r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){let t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=u*m*l-f*h*l+f*a*d-o*m*d-u*a*g+o*h*g,y=p*h*l-c*m*l-p*a*d+s*m*d+c*a*g-s*h*g,_=c*f*l-p*u*l+p*o*d-s*f*d-c*o*g+s*u*g,b=p*u*a-c*f*a-p*o*h+s*f*h+c*o*m-s*u*m,x=e*v+n*y+r*_+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/x;return t[0]=v*w,t[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*w,t[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*g+n*a*g)*w,t[3]=(u*a*i-o*h*i-u*r*l+n*h*l+o*r*d-n*a*d)*w,t[4]=y*w,t[5]=(c*m*i-p*h*i+p*r*d-e*m*d-c*r*g+e*h*g)*w,t[6]=(p*a*i-s*m*i-p*r*l+e*m*l+s*r*g-e*a*g)*w,t[7]=(s*h*i-c*a*i+c*r*l-e*h*l-s*r*d+e*a*d)*w,t[8]=_*w,t[9]=(p*u*i-c*f*i-p*n*d+e*f*d+c*n*g-e*u*g)*w,t[10]=(s*f*i-p*o*i+p*n*l-e*f*l-s*n*g+e*o*g)*w,t[11]=(c*o*i-s*u*i-c*n*l+e*u*l+s*n*d-e*o*d)*w,t[12]=b*w,t[13]=(c*f*r-p*u*r+p*n*h-e*f*h-c*n*m+e*u*m)*w,t[14]=(p*o*r-s*f*r-p*n*a+e*f*a+s*n*m-e*o*m)*w,t[15]=(s*u*r-c*o*r+c*n*a-e*u*a-s*n*h+e*o*h)*w,this}scale(t){let e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,c=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+n,c*a-r*s,0,l*a-r*o,c*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,s){return this.set(1,n,i,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){let r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,c=s+s,u=o+o,h=i*l,d=i*c,p=i*u,f=s*c,m=s*u,g=o*u,v=a*l,y=a*c,_=a*u,b=n.x,x=n.y,w=n.z;return r[0]=(1-(f+g))*b,r[1]=(d+_)*b,r[2]=(p-y)*b,r[3]=0,r[4]=(d-_)*x,r[5]=(1-(h+g))*x,r[6]=(m+v)*x,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){let r=this.elements,i=qf.set(r[0],r[1],r[2]).length(),s=qf.set(r[4],r[5],r[6]).length(),o=qf.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],$f.copy(this);let a=1/i,l=1/s,c=1/o;return $f.elements[0]*=a,$f.elements[1]*=a,$f.elements[2]*=a,$f.elements[4]*=l,$f.elements[5]*=l,$f.elements[6]*=l,$f.elements[8]*=c,$f.elements[9]*=c,$f.elements[10]*=c,e.setFromRotationMatrix($f),n.x=i,n.y=s,n.z=o,this}makePerspective(t,e,n,r,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let o=this.elements,a=2*i/(e-t),l=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),h=-(s+i)/(s-i),d=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,r,i,s){let o=this.elements,a=1/(e-t),l=1/(n-r),c=1/(s-i),u=(e+t)*a,h=(n+r)*l,d=(s+i)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){let e=this.elements,n=t.elements;for(let r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}};Gf.prototype.isMatrix4=!0;var qf=new ff,$f=new Gf,Xf=new ff(0,0,0),Jf=new ff(1,1,1),Yf=new ff,Zf=new ff,Kf=new ff,Qf=new Gf,tm=new pf,em=class t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;this._x=e,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.elements,i=r[0],s=r[4],o=r[8],a=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(Mp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Mp(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(Mp(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-Mp(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Mp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Mp(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Qf.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Qf,e,n)}setFromVector3(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(t.x,t.y,t.z,e)}reorder(t){return tm.setFromEuler(this),this.setFromQuaternion(tm,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}};em.prototype.isEuler=!0,em.DefaultOrder="XYZ",em.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var nm=class{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}isEnabled(t){return 0!==(this.mask&1<<t)}},rm=0,im=new ff,sm=new pf,om=new Gf,am=new ff,lm=new ff,cm=new ff,um=new pf,hm=new ff(1,0,0),dm=new ff(0,1,0),pm=new ff(0,0,1),fm={type:"added"},mm={type:"removed"},gm=class t extends vp{constructor(){super(),Object.defineProperty(this,"id",{value:rm++}),this.uuid=Sp(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=t.DefaultUp.clone();let e=new ff,n=new em,r=new pf,i=new ff(1,1,1);n._onChange((function(){r.setFromEuler(n,!1)})),r._onChange((function(){n.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Gf},normalMatrix:{value:new qp}}),this.matrix=new Gf,this.matrixWorld=new Gf,this.matrixAutoUpdate=t.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new nm,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return sm.setFromAxisAngle(t,e),this.quaternion.multiply(sm),this}rotateOnWorldAxis(t,e){return sm.setFromAxisAngle(t,e),this.quaternion.premultiply(sm),this}rotateX(t){return this.rotateOnAxis(hm,t)}rotateY(t){return this.rotateOnAxis(dm,t)}rotateZ(t){return this.rotateOnAxis(pm,t)}translateOnAxis(t,e){return im.copy(t).applyQuaternion(this.quaternion),this.position.add(im.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(hm,t)}translateY(t){return this.translateOnAxis(dm,t)}translateZ(t){return this.translateOnAxis(pm,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(om.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?am.copy(t):am.set(t,e,n);let r=this.parent;this.updateWorldMatrix(!0,!1),lm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?om.lookAt(lm,am,this.up):om.lookAt(am,lm,this.up),this.quaternion.setFromRotationMatrix(om),r&&(om.extractRotation(r.matrixWorld),sm.setFromRotationMatrix(om),this.quaternion.premultiply(sm.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(fm)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}let e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(mm)),this}removeFromParent(){let t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){let e=this.children[t];e.parent=null,e.dispatchEvent(mm)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),om.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),om.multiply(t.parent.matrixWorld)),t.applyMatrix4(om),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){let r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lm,t,cm),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lm,um,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);let e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){let e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){let n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){let t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){let e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);let e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){let n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){let r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){let n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){let e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations),u=s(t.nodes);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function s(t){let e=[];for(let n in t){let r=t[n];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let n=0;n<t.children.length;n++){let e=t.children[n];this.add(e.clone())}return this}};gm.DefaultUp=new ff(0,1,0),gm.DefaultMatrixAutoUpdate=!0,gm.prototype.isObject3D=!0;var vm=new ff,ym=new ff,_m=new ff,bm=new ff,xm=new ff,wm=new ff,Sm=new ff,Mm=new ff,Em=new ff,Tm=new ff,Am=class t{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ff,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ff,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ff;this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),vm.subVectors(t,e),r.cross(vm);let i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){vm.subVectors(r,e),ym.subVectors(n,e),_m.subVectors(t,e);let s=vm.dot(vm),o=vm.dot(ym),a=vm.dot(_m),l=ym.dot(ym),c=ym.dot(_m),u=s*l-o*o;if(0===u)return i.set(-2,-1,-1);let h=1/u,d=(l*a-o*c)*h,p=(s*c-o*a)*h;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return this.getBarycoord(t,e,n,r,bm),bm.x>=0&&bm.y>=0&&bm.x+bm.y<=1}static getUV(t,e,n,r,i,s,o,a){return this.getBarycoord(t,e,n,r,bm),a.set(0,0),a.addScaledVector(i,bm.x),a.addScaledVector(s,bm.y),a.addScaledVector(o,bm.z),a}static isFrontFacing(t,e,n,r){return vm.subVectors(n,e),ym.subVectors(t,e),vm.cross(ym).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return vm.subVectors(this.c,this.b),ym.subVectors(this.a,this.b),.5*vm.cross(ym).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return t.getNormal(this.a,this.b,this.c,e)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return t.getBarycoord(e,this.a,this.b,this.c,n)}getUV(e,n,r,i,s){return t.getUV(e,this.a,this.b,this.c,n,r,i,s)}containsPoint(e){return t.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return t.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let n,r,i=this.a,s=this.b,o=this.c;xm.subVectors(s,i),wm.subVectors(o,i),Mm.subVectors(t,i);let a=xm.dot(Mm),l=wm.dot(Mm);if(a<=0&&l<=0)return e.copy(i);Em.subVectors(t,s);let c=xm.dot(Em),u=wm.dot(Em);if(c>=0&&u<=c)return e.copy(s);let h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return n=a/(a-c),e.copy(i).addScaledVector(xm,n);Tm.subVectors(t,o);let d=xm.dot(Tm),p=wm.dot(Tm);if(p>=0&&d<=p)return e.copy(o);let f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return r=l/(l-p),e.copy(i).addScaledVector(wm,r);let m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Sm.subVectors(o,s),r=(u-c)/(u-c+(d-p)),e.copy(s).addScaledVector(Sm,r);let g=1/(m+f+h);return n=f*g,r=h*g,e.copy(i).addScaledVector(xm,n).addScaledVector(wm,r)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},Cm=0,Pm=class extends vp{constructor(){super(),Object.defineProperty(this,"id",{value:Cm++}),this.uuid=Sp(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=mp,this.stencilZFail=mp,this.stencilZPass=mp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(let e in t){let n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}let r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){let e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});let n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){let e=[];for(let n in t){let r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){let e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;let e=t.clippingPlanes,n=null;if(null!==e){let t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}};Pm.prototype.isMaterial=!0,Pm.fromType=function(){return null};var Im=class extends Pm{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new sf(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}};Im.prototype.isMeshBasicMaterial=!0;var Rm=new ff,Lm=new Gp,Nm=class{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=gp,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){let e=this.array,n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new sf),e[n++]=i.r,e[n++]=i.g,e[n++]=i.b}return this}copyVector2sArray(t){let e=this.array,n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new Gp),e[n++]=i.x,e[n++]=i.y}return this}copyVector3sArray(t){let e=this.array,n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new ff),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z}return this}copyVector4sArray(t){let e=this.array,n=0;for(let r=0,i=t.length;r<i;r++){let i=t[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new df),e[n++]=i.x,e[n++]=i.y,e[n++]=i.z,e[n++]=i.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Lm.fromBufferAttribute(this,e),Lm.applyMatrix3(t),this.setXY(e,Lm.x,Lm.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Rm.fromBufferAttribute(this,e),Rm.applyMatrix3(t),this.setXYZ(e,Rm.x,Rm.y,Rm.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Rm.fromBufferAttribute(this,e),Rm.applyMatrix4(t),this.setXYZ(e,Rm.x,Rm.y,Rm.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Rm.fromBufferAttribute(this,e),Rm.applyNormalMatrix(t),this.setXYZ(e,Rm.x,Rm.y,Rm.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Rm.fromBufferAttribute(this,e),Rm.transformDirection(t),this.setXYZ(e,Rm.x,Rm.y,Rm.z);return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==gp&&(t.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(t.updateRange=this.updateRange),t}};Nm.prototype.isBufferAttribute=!0;var Om=class extends Nm{constructor(t,e,n){super(new Uint16Array(t),e,n)}},km=class extends Nm{constructor(t,e,n){super(new Uint32Array(t),e,n)}};(class extends Nm{constructor(t,e,n){super(new Uint16Array(t),e,n)}}).prototype.isFloat16BufferAttribute=!0;var Dm=class extends Nm{constructor(t,e,n){super(new Float32Array(t),e,n)}},zm=0,Um=new Gf,Fm=new gm,Bm=new ff,Vm=new vf,Hm=new vf,jm=new ff,Wm=class t extends vp{constructor(){super(),Object.defineProperty(this,"id",{value:zm++}),this.uuid=Sp(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(function(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}(t)?km:Om)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);let n=this.attributes.normal;if(void 0!==n){let e=(new qp).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}let r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Um.makeRotationFromQuaternion(t),this.applyMatrix4(Um),this}rotateX(t){return Um.makeRotationX(t),this.applyMatrix4(Um),this}rotateY(t){return Um.makeRotationY(t),this.applyMatrix4(Um),this}rotateZ(t){return Um.makeRotationZ(t),this.applyMatrix4(Um),this}translate(t,e,n){return Um.makeTranslation(t,e,n),this.applyMatrix4(Um),this}scale(t,e,n){return Um.makeScale(t,e,n),this.applyMatrix4(Um),this}lookAt(t){return Fm.lookAt(t),Fm.updateMatrix(),this.applyMatrix4(Fm.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Bm).negate(),this.translate(Bm.x,Bm.y,Bm.z),this}setFromPoints(t){let e=[];for(let n=0,r=t.length;n<r;n++){let r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Dm(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new vf);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ff(-1/0,-1/0,-1/0),new ff(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,r=e.length;n<r;n++){let t=e[n];Vm.setFromBufferAttribute(t),this.morphTargetsRelative?(jm.addVectors(this.boundingBox.min,Vm.min),this.boundingBox.expandByPoint(jm),jm.addVectors(this.boundingBox.max,Vm.max),this.boundingBox.expandByPoint(jm)):(this.boundingBox.expandByPoint(Vm.min),this.boundingBox.expandByPoint(Vm.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Df);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ff,1/0);if(t){let n=this.boundingSphere.center;if(Vm.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){let n=e[t];Hm.setFromBufferAttribute(n),this.morphTargetsRelative?(jm.addVectors(Vm.min,Hm.min),Vm.expandByPoint(jm),jm.addVectors(Vm.max,Hm.max),Vm.expandByPoint(jm)):(Vm.expandByPoint(Hm.min),Vm.expandByPoint(Hm.max))}Vm.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)jm.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(jm));if(e)for(let i=0,s=e.length;i<s;i++){let s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)jm.fromBufferAttribute(s,e),o&&(Bm.fromBufferAttribute(t,e),jm.add(Bm)),r=Math.max(r,n.distanceToSquared(jm))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let n=t.array,r=e.position.array,i=e.normal.array,s=e.uv.array,o=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Nm(new Float32Array(4*o),4));let a=this.getAttribute("tangent").array,l=[],c=[];for(let E=0;E<o;E++)l[E]=new ff,c[E]=new ff;let u=new ff,h=new ff,d=new ff,p=new Gp,f=new Gp,m=new Gp,g=new ff,v=new ff;function y(t,e,n){u.fromArray(r,3*t),h.fromArray(r,3*e),d.fromArray(r,3*n),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);let i=1/(f.x*m.y-m.x*f.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(i),v.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(i),l[t].add(g),l[e].add(g),l[n].add(g),c[t].add(v),c[e].add(v),c[n].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(let E=0,T=_.length;E<T;++E){let t=_[E],e=t.start;for(let r=e,i=e+t.count;r<i;r+=3)y(n[r+0],n[r+1],n[r+2])}let b=new ff,x=new ff,w=new ff,S=new ff;function M(t){w.fromArray(i,3*t),S.copy(w);let e=l[t];b.copy(e),b.sub(w.multiplyScalar(w.dot(e))).normalize(),x.crossVectors(S,e);let n=x.dot(c[t])<0?-1:1;a[4*t]=b.x,a[4*t+1]=b.y,a[4*t+2]=b.z,a[4*t+3]=n}for(let E=0,T=_.length;E<T;++E){let t=_[E],e=t.start;for(let r=e,i=e+t.count;r<i;r+=3)M(n[r+0]),M(n[r+1]),M(n[r+2])}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Nm(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);let r=new ff,i=new ff,s=new ff,o=new ff,a=new ff,l=new ff,c=new ff,u=new ff;if(t)for(let h=0,d=t.count;h<d;h+=3){let d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,h=e.count;t<h;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let n=this.attributes;for(let r in n){if(void 0===t.attributes[r])continue;let i=n[r].array,s=t.attributes[r],o=s.array,a=s.itemSize*e,l=Math.min(o.length,i.length-a);for(let t=0,e=a;t<l;t++,e++)i[e]=o[t]}return this}normalizeNormals(){let t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)jm.fromBufferAttribute(t,e),jm.normalize(),t.setXYZ(e,jm.x,jm.y,jm.z)}toNonIndexed(){function e(t,e){let n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r),o=0,a=0;for(let l=0,c=e.length;l<c;l++){o=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new Nm(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let n=new t,r=this.index.array,i=this.attributes;for(let t in i){let s=e(i[t],r);n.setAttribute(t,s)}let s=this.morphAttributes;for(let t in s){let i=[],o=s[t];for(let t=0,n=o.length;t<n;t++){let n=e(o[t],r);i.push(n)}n.morphAttributes[t]=i}n.morphTargetsRelative=this.morphTargetsRelative;let o=this.groups;for(let t=0,a=o.length;t<a;t++){let e=o[t];n.addGroup(e.start,e.count,e.materialIndex)}return n}toJSON(){let t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){let e=this.parameters;for(let n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};let e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let n=this.attributes;for(let a in n){let e=n[a];t.data.attributes[a]=e.toJSON(t.data)}let r={},i=!1;for(let a in this.morphAttributes){let e=this.morphAttributes[a],n=[];for(let r=0,i=e.length;r<i;r++){let i=e[r];n.push(i.toJSON(t.data))}n.length>0&&(r[a]=n,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));let o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let n=t.index;null!==n&&this.setIndex(n.clone(e));let r=t.attributes;for(let l in r){let t=r[l];this.setAttribute(l,t.clone(e))}let i=t.morphAttributes;for(let l in i){let t=[],n=i[l];for(let r=0,i=n.length;r<i;r++)t.push(n[r].clone(e));this.morphAttributes[l]=t}this.morphTargetsRelative=t.morphTargetsRelative;let s=t.groups;for(let l=0,c=s.length;l<c;l++){let t=s[l];this.addGroup(t.start,t.count,t.materialIndex)}let o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());let a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}};Wm.prototype.isBufferGeometry=!0;var Gm=new Gf,qm=new Wf,$m=new Df,Xm=new ff,Jm=new ff,Ym=new ff,Zm=new ff,Km=new ff,Qm=new ff,tg=new ff,eg=new ff,ng=new ff,rg=new Gp,ig=new Gp,sg=new Gp,og=new ff,ag=new ff,lg=class extends gm{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wm,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Im;super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){let t=this.geometry;if(t.isBufferGeometry){let e=t.morphAttributes,n=Object.keys(e);if(n.length>0){let t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){let n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{let e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){let n,r=this.geometry,i=this.material,s=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),$m.copy(r.boundingSphere),$m.applyMatrix4(s),!1!==t.ray.intersectsSphere($m))&&(Gm.copy(s).invert(),qm.copy(t.ray).applyMatrix4(Gm),null===r.boundingBox||!1!==qm.intersectsBox(r.boundingBox)))if(r.isBufferGeometry){let s=r.index,o=r.attributes.position,a=r.morphAttributes.position,l=r.morphTargetsRelative,c=r.attributes.uv,u=r.attributes.uv2,h=r.groups,d=r.drawRange;if(null!==s)if(Array.isArray(i))for(let r=0,p=h.length;r<p;r++){let p=h[r],f=i[p.materialIndex];for(let r=Math.max(p.start,d.start),i=Math.min(s.count,Math.min(p.start+p.count,d.start+d.count));r<i;r+=3){let i=s.getX(r),h=s.getX(r+1),d=s.getX(r+2);n=cg(this,f,t,qm,o,a,l,c,u,i,h,d),n&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=p.materialIndex,e.push(n))}}else{for(let r=Math.max(0,d.start),h=Math.min(s.count,d.start+d.count);r<h;r+=3){let h=s.getX(r),d=s.getX(r+1),p=s.getX(r+2);n=cg(this,i,t,qm,o,a,l,c,u,h,d,p),n&&(n.faceIndex=Math.floor(r/3),e.push(n))}}else if(void 0!==o)if(Array.isArray(i))for(let r=0,p=h.length;r<p;r++){let s=h[r],p=i[s.materialIndex];for(let r=Math.max(s.start,d.start),i=Math.min(o.count,Math.min(s.start+s.count,d.start+d.count));r<i;r+=3){n=cg(this,p,t,qm,o,a,l,c,u,r,r+1,r+2),n&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=s.materialIndex,e.push(n))}}else{for(let r=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);r<s;r+=3){n=cg(this,i,t,qm,o,a,l,c,u,r,r+1,r+2),n&&(n.faceIndex=Math.floor(r/3),e.push(n))}}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};function cg(t,e,n,r,i,s,o,a,l,c,u,h){Xm.fromBufferAttribute(i,c),Jm.fromBufferAttribute(i,u),Ym.fromBufferAttribute(i,h);let d=t.morphTargetInfluences;if(s&&d){tg.set(0,0,0),eg.set(0,0,0),ng.set(0,0,0);for(let t=0,e=s.length;t<e;t++){let e=d[t],n=s[t];0!==e&&(Zm.fromBufferAttribute(n,c),Km.fromBufferAttribute(n,u),Qm.fromBufferAttribute(n,h),o?(tg.addScaledVector(Zm,e),eg.addScaledVector(Km,e),ng.addScaledVector(Qm,e)):(tg.addScaledVector(Zm.sub(Xm),e),eg.addScaledVector(Km.sub(Jm),e),ng.addScaledVector(Qm.sub(Ym),e)))}Xm.add(tg),Jm.add(eg),Ym.add(ng)}t.isSkinnedMesh&&(t.boneTransform(c,Xm),t.boneTransform(u,Jm),t.boneTransform(h,Ym));let p=function(t,e,n,r,i,s,o,a){let l;if(l=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,2!==e.side,a),null===l)return null;ag.copy(a),ag.applyMatrix4(t.matrixWorld);let c=n.ray.origin.distanceTo(ag);return c<n.near||c>n.far?null:{distance:c,point:ag.clone(),object:t}}(t,e,n,r,Xm,Jm,Ym,og);if(p){a&&(rg.fromBufferAttribute(a,c),ig.fromBufferAttribute(a,u),sg.fromBufferAttribute(a,h),p.uv=Am.getUV(og,Xm,Jm,Ym,rg,ig,sg,new Gp)),l&&(rg.fromBufferAttribute(l,c),ig.fromBufferAttribute(l,u),sg.fromBufferAttribute(l,h),p.uv2=Am.getUV(og,Xm,Jm,Ym,rg,ig,sg,new Gp));let t={a:c,b:u,c:h,normal:new ff,materialIndex:0};Am.getNormal(Xm,Jm,Ym,t.normal),p.face=t}return p}lg.prototype.isMesh=!0;var ug=class extends Pm{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",this.fragmentShader="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=function(t){let e={};for(let n in t){e[n]={};for(let r in t[n]){let i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){let e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?e.uniforms[r]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[r]={type:"m4",value:n.toArray()}:e.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;let n={};for(let r in this.extensions)!0===this.extensions[r]&&(n[r]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}};ug.prototype.isShaderMaterial=!0;var hg=class extends gm{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Gf,this.projectionMatrix=new Gf,this.projectionMatrixInverse=new Gf}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}};hg.prototype.isCamera=!0;var dg=class extends hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=2*wp*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(.5*xp*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*wp*Math.atan(Math.tan(.5*xp*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,r,i,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(.5*xp*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,s=this.view;if(null!==this.view&&this.view.enabled){let t=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/t,e-=s.offsetY*n/o,r*=s.width/t,n*=s.height/o}let o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};dg.prototype.isPerspectiveCamera=!0;var pg=new ff,fg=new ff,mg=new qp,gg=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ff(1,0,0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){let r=pg.subVectors(n,e).cross(fg.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){let n=t.delta(pg),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;let i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(n).multiplyScalar(i).add(t.start)}intersectsLine(t){let e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let n=e||mg.getNormalMatrix(t),r=this.coplanarPoint(pg).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}};gg.prototype.isPlane=!0;var vg=new Df,yg=new ff,_g=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gg,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gg,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new gg,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new gg,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new gg,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new gg;this.planes=[t,e,n,r,i,s]}set(t,e,n,r,i,s){let o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this}copy(t){let e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){let e=this.planes,n=t.elements,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(o-r,u-a,f-h,y-m).normalize(),e[1].setComponents(o+r,u+a,f+h,y+m).normalize(),e[2].setComponents(o+i,u+l,f+d,y+g).normalize(),e[3].setComponents(o-i,u-l,f-d,y-g).normalize(),e[4].setComponents(o-s,u-c,f-p,y-v).normalize(),e[5].setComponents(o+s,u+c,f+p,y+v).normalize(),this}intersectsObject(t){let e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),vg.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(vg)}intersectsSprite(t){return vg.center.set(0,0,0),vg.radius=.7071067811865476,vg.applyMatrix4(t.matrixWorld),this.intersectsSphere(vg)}intersectsSphere(t){let e=this.planes,n=t.center,r=-t.radius;for(let i=0;i<6;i++)if(e[i].distanceToPoint(n)<r)return!1;return!0}intersectsBox(t){let e=this.planes;for(let n=0;n<6;n++){let r=e[n];if(yg.x=r.normal.x>0?t.max.x:t.min.x,yg.y=r.normal.y>0?t.max.y:t.min.y,yg.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(yg)<0)return!1}return!0}containsPoint(t){let e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}},bg=class extends hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t,s=n+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){let t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,s=i+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}};bg.prototype.isOrthographicCamera=!0;var xg=class extends Pm{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}};xg.prototype.isMeshDepthMaterial=!0;var wg=class extends Pm{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new ff,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}};wg.prototype.isMeshDistanceMaterial=!0;var Sg=class extends gm{constructor(){super(),this.type="Group"}};Sg.prototype.isGroup=!0;var Mg=class{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=gp,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Sp()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Sp()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Sp()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};Mg.prototype.isInterleavedBuffer=!0;var Eg=new ff,Tg=class t{constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Eg.fromBufferAttribute(this,e),Eg.applyMatrix4(t),this.setXYZ(e,Eg.x,Eg.y,Eg.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Eg.fromBufferAttribute(this,e),Eg.applyNormalMatrix(t),this.setXYZ(e,Eg.x,Eg.y,Eg.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Eg.fromBufferAttribute(this,e),Eg.transformDirection(t),this.setXYZ(e,Eg.x,Eg.y,Eg.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let e=0;e<this.count;e++){let n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new Nm(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new t(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let e=0;e<this.count;e++){let n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};Tg.prototype.isInterleavedBufferAttribute=!0;var Ag=class extends Pm{constructor(t){super(),this.type="SpriteMaterial",this.color=new sf(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}};Ag.prototype.isSpriteMaterial=!0;var Cg=new ff,Pg=new df,Ig=new df,Rg=new ff,Lg=new Gf,Ng=class extends lg{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Gf,this.bindMatrixInverse=new Gf}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let t=new df,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.fromBufferAttribute(e,n);let r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){let n=this.skeleton,r=this.geometry;Pg.fromBufferAttribute(r.attributes.skinIndex,t),Ig.fromBufferAttribute(r.attributes.skinWeight,t),Cg.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let i=0;i<4;i++){let t=Ig.getComponent(i);if(0!==t){let r=Pg.getComponent(i);Lg.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(Rg.copy(Cg).applyMatrix4(Lg),t)}}return e.applyMatrix4(this.bindMatrixInverse)}};Ng.prototype.isSkinnedMesh=!0;var Og=class extends gm{constructor(){super(),this.type="Bone"}};Og.prototype.isBone=!0;var kg=class extends hf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:op,arguments.length>9&&void 0!==arguments[9]?arguments[9]:op,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};kg.prototype.isDataTexture=!0;var Dg=new Gf,zg=new Gf,Ug=class t{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=Sp(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Gf)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){let e=new Gf;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){let e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){let e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){let t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let i=0,s=t.length;i<s;i++){let r=t[i]?t[i].matrixWorld:zg;Dg.multiplyMatrices(r,e[i]),Dg.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)}clone(){return new t(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=Bp(t),t=Math.max(t,4);let e=new Float32Array(t*t*4);e.set(this.boneMatrices);let n=new kg(e,t,t,1023,1015);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){let n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,r=t.bones.length;n<r;n++){let r=t.bones[n],i=e[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new Og),this.bones.push(i),this.boneInverses.push((new Gf).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){let t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;let e=this.bones,n=this.boneInverses;for(let r=0,i=e.length;r<i;r++){let i=e[r];t.bones.push(i.uuid);let s=n[r];t.boneInverses.push(s.toArray())}return t}},Fg=class extends Nm{constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,n),this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){let t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}};Fg.prototype.isInstancedBufferAttribute=!0;var Bg=new Gf,Vg=new Gf,Hg=[],jg=new lg,Wg=class extends lg{constructor(t,e,n){super(t,e),this.instanceMatrix=new Fg(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){let n=this.matrixWorld,r=this.count;if(jg.geometry=this.geometry,jg.material=this.material,void 0!==jg.material)for(let i=0;i<r;i++){this.getMatrixAt(i,Bg),Vg.multiplyMatrices(n,Bg),jg.matrixWorld=Vg,jg.raycast(t,Hg);for(let t=0,n=Hg.length;t<n;t++){let n=Hg[t];n.instanceId=i,n.object=this,e.push(n)}Hg.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Fg(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};Wg.prototype.isInstancedMesh=!0;var Gg=class extends Pm{constructor(t){super(),this.type="LineBasicMaterial",this.color=new sf(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}};Gg.prototype.isLineBasicMaterial=!0;var qg=new ff,$g=new ff,Xg=new Gf,Jg=new Wf,Yg=new Df,Zg=class extends gm{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wm,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gg;super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){let t=this.geometry;if(t.isBufferGeometry)if(null===t.index){let e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)qg.fromBufferAttribute(e,t-1),$g.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=qg.distanceTo($g);t.setAttribute("lineDistance",new Dm(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){let n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Yg.copy(n.boundingSphere),Yg.applyMatrix4(r),Yg.radius+=i,!1===t.ray.intersectsSphere(Yg))return;Xg.copy(r).invert(),Jg.copy(t.ray).applyMatrix4(Xg);let o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new ff,c=new ff,u=new ff,h=new ff,d=this.isLineSegments?2:1;if(n.isBufferGeometry){let r=n.index,i=n.attributes.position;if(null!==r){for(let n=Math.max(0,s.start),o=Math.min(r.count,s.start+s.count)-1;n<o;n+=d){let s=r.getX(n),o=r.getX(n+1);if(l.fromBufferAttribute(i,s),c.fromBufferAttribute(i,o),Jg.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);let d=t.ray.origin.distanceTo(h);d<t.near||d>t.far||e.push({distance:d,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,s.start),r=Math.min(i.count,s.start+s.count)-1;n<r;n+=d){if(l.fromBufferAttribute(i,n),c.fromBufferAttribute(i,n+1),Jg.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);let r=t.ray.origin.distanceTo(h);r<t.near||r>t.far||e.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let t=this.geometry;if(t.isBufferGeometry){let e=t.morphAttributes,n=Object.keys(e);if(n.length>0){let t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){let n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{let e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};Zg.prototype.isLine=!0;var Kg=new ff,Qg=new ff,tv=class extends Zg{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){let t=this.geometry;if(t.isBufferGeometry)if(null===t.index){let e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)Kg.fromBufferAttribute(e,t),Qg.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Kg.distanceTo(Qg);t.setAttribute("lineDistance",new Dm(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};tv.prototype.isLineSegments=!0;var ev=class extends Zg{constructor(t,e){super(t,e),this.type="LineLoop"}};ev.prototype.isLineLoop=!0;var nv=class extends Pm{constructor(t){super(),this.type="PointsMaterial",this.color=new sf(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}};nv.prototype.isPointsMaterial=!0;var rv=new Gf,iv=new Wf,sv=new Df,ov=new ff,av=class extends gm{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wm,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new nv;super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){let n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),sv.copy(n.boundingSphere),sv.applyMatrix4(r),sv.radius+=i,!1===t.ray.intersectsSphere(sv))return;rv.copy(r).invert(),iv.copy(t.ray).applyMatrix4(rv);let o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){let i=n.index,o=n.attributes.position;if(null!==i){for(let n=Math.max(0,s.start),l=Math.min(i.count,s.start+s.count);n<l;n++){let s=i.getX(n);ov.fromBufferAttribute(o,s),lv(ov,s,a,r,t,e,this)}}else{for(let n=Math.max(0,s.start),i=Math.min(o.count,s.start+s.count);n<i;n++)ov.fromBufferAttribute(o,n),lv(ov,n,a,r,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let t=this.geometry;if(t.isBufferGeometry){let e=t.morphAttributes,n=Object.keys(e);if(n.length>0){let t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){let n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{let e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};function lv(t,e,n,r,i,s,o){let a=iv.distanceSqToPoint(t);if(a<n){let n=new ff;iv.closestPointToPoint(t,n),n.applyMatrix4(r);let l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}av.prototype.isPoints=!0;var cv=class extends Pm{constructor(t){super(),this.type="ShadowMaterial",this.color=new sf(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}};cv.prototype.isShadowMaterial=!0;var uv=class extends ug{constructor(t){super(t),this.type="RawShaderMaterial"}};uv.prototype.isRawShaderMaterial=!0;var hv=class extends Pm{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new sf(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new sf(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Gp(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}};hv.prototype.isMeshStandardMaterial=!0;var dv=class extends hv{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Gp(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Mp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new sf(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new sf(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new sf(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}};dv.prototype.isMeshPhysicalMaterial=!0;var pv=class extends Pm{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new sf(16777215),this.specular=new sf(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new sf(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Gp(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}};pv.prototype.isMeshPhongMaterial=!0;var fv=class extends Pm{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new sf(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new sf(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Gp(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}};fv.prototype.isMeshToonMaterial=!0;var mv=class extends Pm{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Gp(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}};mv.prototype.isMeshNormalMaterial=!0;var gv=class extends Pm{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new sf(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new sf(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}};gv.prototype.isMeshLambertMaterial=!0;var vv=class extends Pm{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new sf(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Gp(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}};vv.prototype.isMeshMatcapMaterial=!0;var yv=class extends Gg{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}};yv.prototype.isLineDashedMaterial=!0;var _v={ShadowMaterial:cv,SpriteMaterial:Ag,RawShaderMaterial:uv,ShaderMaterial:ug,PointsMaterial:nv,MeshPhysicalMaterial:dv,MeshStandardMaterial:hv,MeshPhongMaterial:pv,MeshToonMaterial:fv,MeshNormalMaterial:mv,MeshLambertMaterial:gv,MeshDepthMaterial:xg,MeshDistanceMaterial:wg,MeshBasicMaterial:Im,MeshMatcapMaterial:vv,LineDashedMaterial:yv,LineBasicMaterial:Gg,Material:Pm};Pm.fromType=function(t){return new _v[t]};var bv={arraySlice:function(t,e,n){return bv.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){let e=t.length,n=new Array(e);for(let r=0;r!==e;++r)n[r]=r;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){let r=t.length,i=new t.constructor(r);for(let s=0,o=0;o!==r;++s){let r=n[s]*e;for(let n=0;n!==e;++n)i[o++]=t[r+n]}return i},flattenJSON:function(t,e,n,r){let i=1,s=t[0];for(;void 0!==s&&void 0===s[r];)s=t[i++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[i++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),n.push(o)),s=t[i++]}while(void 0!==s)},subclip:function(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,s=t.clone();s.name=e;let o=[];for(let l=0;l<s.tracks.length;++l){let t=s.tracks[l],e=t.getValueSize(),a=[],c=[];for(let s=0;s<t.times.length;++s){let o=t.times[s]*i;if(!(o<n||o>=r)){a.push(t.times[s]);for(let n=0;n<e;++n)c.push(t.values[s*e+n])}}0!==a.length&&(t.times=bv.convertArray(a,t.times.constructor),t.values=bv.convertArray(c,t.values.constructor),o.push(t))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);let i=n.tracks.length,s=e/r;for(let o=0;o<i;++o){let e=n.tracks[o],r=e.ValueTypeName;if("bool"===r||"string"===r)continue;let i=t.tracks.find((function(t){return t.name===e.name&&t.ValueTypeName===r}));if(void 0===i)continue;let a=0,l=e.getValueSize();e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0,u=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);let h,d=e.times.length-1;if(s<=e.times[0]){let t=a,n=l-a;h=bv.arraySlice(e.values,t,n)}else if(s>=e.times[d]){let t=d*l+a,n=t+l-a;h=bv.arraySlice(e.values,t,n)}else{let t=e.createInterpolant(),n=a,r=l-a;t.evaluate(s),h=bv.arraySlice(t.resultBuffer,n,r)}"quaternion"===r&&(new pf).fromArray(h).normalize().conjugate().toArray(h);let p=i.times.length;for(let t=0;t<p;++t){let e=t*u+c;if("quaternion"===r)pf.multiplyQuaternionsFlat(i.values,e,h,0,i.values,e);else{let t=u-2*c;for(let n=0;n<t;++n)i.values[e+n]-=h[n]}}}return t.blendMode=2501,t}},xv=class{constructor(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let s;n:{r:if(!(t<r)){for(let s=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===s)break;if(i=r,r=e[++n],t<r)break e}s=e.length;break n}if(t>=i)break t;{let o=e[1];t<o&&(n=2,i=o);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===s)break;if(r=i,i=e[--n-1],t>=i)break e}s=n,n=0}}for(;n<s;){let r=n+s>>>1;t<e[r]?s=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let s=0;s!==r;++s)e[s]=n[i+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}};xv.prototype.beforeStart_=xv.prototype.copySampleValue_,xv.prototype.afterEnd_=xv.prototype.copySampleValue_;var wv=class extends xv{constructor(t,e,n,r){super(t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(t,e,n){let r=this.parameterPositions,i=t-2,s=t+1,o=r[i],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:i=t,o=2*e-n;break;case 2402:i=r.length-2,o=e+r[i]-r[i+1];break;default:i=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:s=t,a=2*n-e;break;case 2402:s=1,a=n+r[1]-r[0];break;default:s=t-1,a=e}let l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=s*c}interpolate_(t,e,n,r){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let b=0;b!==o;++b)i[b]=g*s[c+b]+v*s[l+b]+y*s[a+b]+_*s[u+b];return i}},Sv=class extends xv{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(r-e),u=1-c;for(let h=0;h!==o;++h)i[h]=s[l+h]*u+s[a+h]*c;return i}},Mv=class extends xv{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t){return this.copySampleValue_(t-1)}},Ev=class{constructor(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=bv.convertArray(e,this.TimeBufferType),this.values=bv.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){let e,n=t.constructor;if(n.toJSON!==this.toJSON)e=n.toJSON(t);else{e={name:t.name,times:bv.convertArray(t.times,Array),values:bv.convertArray(t.values,Array)};let n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e}InterpolantFactoryMethodDiscrete(t){return new Mv(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Sv(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new wv(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case cp:e=this.InterpolantFactoryMethodDiscrete;break;case up:e=this.InterpolantFactoryMethodLinear;break;case hp:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){let e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return cp;case this.InterpolantFactoryMethodLinear:return up;case this.InterpolantFactoryMethodSmooth:return hp}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){let e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this}scale(t){if(1!==t){let e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this}trim(t,e){let n=this.times,r=n.length,i=0,s=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);let t=this.getValueSize();this.times=bv.arraySlice(n,i,s),this.values=bv.arraySlice(this.values,i*t,s*t)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let o=0;o!==i;o++){let e=n[o];if("number"==typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,e),t=!1;break}if(null!==s&&s>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,e,s),t=!1;break}s=e}if(void 0!==r&&bv.isTypedArray(r))for(let o=0,a=r.length;o!==a;++o){let e=r[o];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,e),t=!1;break}}return t}optimize(){let t=bv.arraySlice(this.times),e=bv.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===hp,i=t.length-1,s=1;for(let o=1;o<i;++o){let i=!1,a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(r)i=!0;else{let t=o*n,r=t-n,s=t+n;for(let o=0;o!==n;++o){let n=e[t+o];if(n!==e[r+o]||n!==e[s+o]){i=!0;break}}}if(i){if(o!==s){t[s]=t[o];let r=o*n,i=s*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++s}}if(i>0){t[s]=t[i];for(let t=i*n,r=s*n,o=0;o!==n;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=bv.arraySlice(t,0,s),this.values=bv.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this}clone(){let t=bv.arraySlice(this.times,0),e=bv.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}};Ev.prototype.TimeBufferType=Float32Array,Ev.prototype.ValueBufferType=Float32Array,Ev.prototype.DefaultInterpolation=up;var Tv=class extends Ev{};Tv.prototype.ValueTypeName="bool",Tv.prototype.ValueBufferType=Array,Tv.prototype.DefaultInterpolation=cp,Tv.prototype.InterpolantFactoryMethodLinear=void 0,Tv.prototype.InterpolantFactoryMethodSmooth=void 0;var Av=class extends Ev{};Av.prototype.ValueTypeName="color";var Cv=class extends Ev{};Cv.prototype.ValueTypeName="number";var Pv=class extends xv{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(r-e),l=t*o;for(let c=l+o;l!==c;l+=4)pf.slerpFlat(i,0,s,l-o,s,l,a);return i}},Iv=class extends Ev{InterpolantFactoryMethodLinear(t){return new Pv(this.times,this.values,this.getValueSize(),t)}};Iv.prototype.ValueTypeName="quaternion",Iv.prototype.DefaultInterpolation=up,Iv.prototype.InterpolantFactoryMethodSmooth=void 0;var Rv=class extends Ev{};Rv.prototype.ValueTypeName="string",Rv.prototype.ValueBufferType=Array,Rv.prototype.DefaultInterpolation=cp,Rv.prototype.InterpolantFactoryMethodLinear=void 0,Rv.prototype.InterpolantFactoryMethodSmooth=void 0;var Lv=class extends Ev{};Lv.prototype.ValueTypeName="vector";var Nv=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2500;this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=Sp(),this.duration<0&&this.resetDuration()}static parse(t){let e=[],n=t.tracks,r=1/(t.fps||1);for(let s=0,o=n.length;s!==o;++s)e.push(Ov(n[s]).scale(r));let i=new this(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i}static toJSON(t){let e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let i=0,s=n.length;i!==s;++i)e.push(Ev.toJSON(n[i]));return r}static CreateFromMorphTargetSequence(t,e,n,r){let i=e.length,s=[];for(let o=0;o<i;o++){let t=[],a=[];t.push((o+i-1)%i,o,(o+1)%i),a.push(0,1,0);let l=bv.getKeyframeOrder(t);t=bv.sortedArray(t,1,l),a=bv.sortedArray(a,1,l),!r&&0===t[0]&&(t.push(i),a.push(a[0])),s.push(new Cv(".morphTargetInfluences["+e[o].name+"]",t,a).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){let e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let r=0;r<n.length;r++)if(n[r].name===e)return n[r];return null}static CreateClipsFromMorphTargetSequences(t,e,n){let r={},i=/^([\w-]*?)([\d]+)$/;for(let o=0,a=t.length;o<a;o++){let e=t[o],n=e.name.match(i);if(n&&n.length>1){let t=n[1],i=r[t];i||(r[t]=i=[]),i.push(e)}}let s=[];for(let o in r)s.push(this.CreateFromMorphTargetSequence(o,r[o],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(t,e,n,r,i){if(0!==n.length){let s=[],o=[];bv.flattenJSON(n,s,o,r),0!==s.length&&i.push(new t(e,s,o))}},r=[],i=t.name||"default",s=t.fps||30,o=t.blendMode,a=t.length||-1,l=t.hierarchy||[];for(let c=0;c<l.length;c++){let t=l[c].keys;if(t&&0!==t.length)if(t[0].morphTargets){let e,n={};for(e=0;e<t.length;e++)if(t[e].morphTargets)for(let r=0;r<t[e].morphTargets.length;r++)n[t[e].morphTargets[r]]=-1;for(let i in n){let n=[],s=[];for(let r=0;r!==t[e].morphTargets.length;++r){let r=t[e];n.push(r.time),s.push(r.morphTarget===i?1:0)}r.push(new Cv(".morphTargetInfluence["+i+"]",n,s))}a=n.length*s}else{let i=".bones["+e[c].name+"]";n(Lv,i+".position",t,"pos",r),n(Iv,i+".quaternion",t,"rot",r),n(Lv,i+".scale",t,"scl",r)}}return 0===r.length?null:new this(i,a,r,o)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){let n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){let t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function Ov(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Cv;case"vector":case"vector2":case"vector3":case"vector4":return Lv;case"color":return Av;case"quaternion":return Iv;case"bool":case"boolean":return Tv;case"string":return Rv}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){let e=[],n=[];bv.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}var kv={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},Dv=new class{constructor(t,e,n){let r,i=this,s=!1,o=0,a=0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==i.onStart&&i.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){let e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){let n=l[e],r=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}},zv=class{constructor(t){this.manager=void 0!==t?t:Dv,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){let n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}},Uv={},Fv=class extends zv{constructor(t){super(t)}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let i=kv.get(t);if(void 0!==i)return this.manager.itemStart(t),setTimeout((()=>{e&&e(i),this.manager.itemEnd(t)}),0),i;if(void 0!==Uv[t])return void Uv[t].push({onLoad:e,onProgress:n,onError:r});Uv[t]=[],Uv[t].push({onLoad:e,onProgress:n,onError:r});let s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===e.body||void 0===e.body.getReader)return e;let n=Uv[t],r=e.body.getReader(),i=e.headers.get("Content-Length"),s=i?parseInt(i):0,o=0!==s,a=0,l=new ReadableStream({start(t){!function e(){r.read().then((r=>{let{done:i,value:l}=r;if(i)t.close();else{a+=l.byteLength;let r=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=n.length;t<e;t++){let e=n[t];e.onProgress&&e.onProgress(r)}t.enqueue(l),e()}}))}()}});return new Response(l)}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{let e=/charset="?([^;"\s]*)"?/i.exec(o),n=e&&e[1]?e[1].toLowerCase():void 0,r=new TextDecoder(n);return t.arrayBuffer().then((t=>r.decode(t)))}}})).then((e=>{kv.add(t,e);let n=Uv[t];delete Uv[t];for(let t=0,r=n.length;t<r;t++){let r=n[t];r.onLoad&&r.onLoad(e)}})).catch((e=>{let n=Uv[t];if(void 0===n)throw this.manager.itemError(t),e;delete Uv[t];for(let t=0,r=n.length;t<r;t++){let r=n[t];r.onError&&r.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}},Bv=class extends zv{constructor(t){super(t)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let i=this,s=kv.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;let o=$p("img");function a(){c(),kv.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){c(),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}},Vv=class extends zv{constructor(t){super(t)}load(t,e,n,r){let i=new hf,s=new Bv(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){i.image=t,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}},Hv=class extends gm{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.type="Light",this.color=new sf(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){let e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}};Hv.prototype.isLight=!0;var jv=new Gf,Wv=new ff,Gv=new ff,qv=class{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Gp(512,512),this.map=null,this.mapPass=null,this.matrix=new Gf,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new _g,this._frameExtents=new Gp(1,1),this._viewportCount=1,this._viewports=[new df(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){let e=this.camera,n=this.matrix;Wv.setFromMatrixPosition(t.matrixWorld),e.position.copy(Wv),Gv.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Gv),e.updateMatrixWorld(),jv.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(jv),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}},$v=class extends qv{constructor(){super(new dg(50,1,.5,500)),this.focus=1}updateMatrices(t){let e=this.camera,n=2*wp*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;(n!==e.fov||r!==e.aspect||i!==e.far)&&(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}};$v.prototype.isSpotLightShadow=!0;var Xv=class extends Hv{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(t,e),this.type="SpotLight",this.position.copy(gm.DefaultUp),this.updateMatrix(),this.target=new gm,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.shadow=new $v}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}};Xv.prototype.isSpotLight=!0;var Jv=new Gf,Yv=new ff,Zv=new ff,Kv=class extends qv{constructor(){super(new dg(90,1,.5,500)),this._frameExtents=new Gp(4,2),this._viewportCount=6,this._viewports=[new df(2,1,1,1),new df(0,1,1,1),new df(3,1,1,1),new df(1,1,1,1),new df(3,0,1,1),new df(1,0,1,1)],this._cubeDirections=[new ff(1,0,0),new ff(-1,0,0),new ff(0,0,1),new ff(0,0,-1),new ff(0,1,0),new ff(0,-1,0)],this._cubeUps=[new ff(0,1,0),new ff(0,1,0),new ff(0,1,0),new ff(0,1,0),new ff(0,0,1),new ff(0,0,-1)]}updateMatrices(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Yv.setFromMatrixPosition(t.matrixWorld),n.position.copy(Yv),Zv.copy(n.position),Zv.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Zv),n.updateMatrixWorld(),r.makeTranslation(-Yv.x,-Yv.y,-Yv.z),Jv.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jv)}};Kv.prototype.isPointLightShadow=!0;var Qv=class extends Hv{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(t,e),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Kv}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}};Qv.prototype.isPointLight=!0;var ty=class extends qv{constructor(){super(new bg(-5,5,5,-5,.5,500))}};ty.prototype.isDirectionalLightShadow=!0;var ey=class extends Hv{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(gm.DefaultUp),this.updateMatrix(),this.target=new gm,this.shadow=new ty}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}};ey.prototype.isDirectionalLight=!0;var ny=class{static decodeText(t){if(typeof TextDecoder<"u")return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){let e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}},ry=class extends zv{constructor(t){super(t),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let i=this,s=kv.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;let o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){kv.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}};ry.prototype.isImageBitmapLoader=!0;var iy="\\[\\]\\.:\\/",sy=new RegExp("["+iy+"]","g"),oy="[^"+iy+"]",ay="[^"+iy.replace("\\.","")+"]",ly=/((?:WC+[\/:])*)/.source.replace("WC",oy),cy=/(WCOD+)?/.source.replace("WCOD",ay),uy=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",oy),hy=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",oy),dy=new RegExp("^"+ly+cy+uy+hy+"$"),py=["material","materials","bones"],fy=class t{constructor(e,n,r){this.path=n,this.parsedPath=r||t.parseTrackName(n),this.node=t.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,r){return e&&e.isAnimationObjectGroup?new t.Composite(e,n,r):new t(e,n,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(sy,"")}static parseTrackName(t){let e=dy.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){let t=n.nodeName.substring(r+1);-1!==py.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){let n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){let n=function(t){for(let r=0;r<t.length;r++){let i=t[r];if(i.name===e||i.uuid===e)return i;let s=n(i.children);if(s)return s}return null},r=n(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let e=this.node,n=this.parsedPath,r=n.objectName,i=n.propertyName,s=n.propertyIndex;if(e||(e=t.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let t=n.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let n=0;n<e.length;n++)if(e[n].name===t){t=n;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==t){if(void 0===e[t])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[t]}}let o=e[i];if(void 0===o){let t=n.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+t+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else void 0!==o.fromArray&&void 0!==o.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};function my(t,e){if(0===e)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(2===e||1===e){let n=t.getIndex();if(null===n){let e=[],r=t.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<r.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}let r=n.count-2,i=[];if(2===e)for(let t=1;t<=r;t++)i.push(n.getX(0)),i.push(n.getX(t)),i.push(n.getX(t+1));else for(let t=0;t<r;t++)t%2===0?(i.push(n.getX(t)),i.push(n.getX(t+1)),i.push(n.getX(t+2))):(i.push(n.getX(t+2)),i.push(n.getX(t+1)),i.push(n.getX(t)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let s=t.clone();return s.setIndex(i),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}fy.Composite=class{constructor(t,e,n){let r=n||fy.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();let n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)}setValue(t,e){let n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},fy.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},fy.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},fy.prototype.GetterByBindingType=[fy.prototype._getValue_direct,fy.prototype._getValue_array,fy.prototype._getValue_arrayElement,fy.prototype._getValue_toArray],fy.prototype.SetterByBindingTypeAndVersioning=[[fy.prototype._setValue_direct,fy.prototype._setValue_direct_setNeedsUpdate,fy.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[fy.prototype._setValue_array,fy.prototype._setValue_array_setNeedsUpdate,fy.prototype._setValue_array_setMatrixWorldNeedsUpdate],[fy.prototype._setValue_arrayElement,fy.prototype._setValue_arrayElement_setNeedsUpdate,fy.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[fy.prototype._setValue_fromArray,fy.prototype._setValue_fromArray_setNeedsUpdate,fy.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"139"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="139");var gy=class extends zv{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new wy(t)})),this.register((function(t){return new Py(t)})),this.register((function(t){return new Iy(t)})),this.register((function(t){return new Ry(t)})),this.register((function(t){return new My(t)})),this.register((function(t){return new Ey(t)})),this.register((function(t){return new Ty(t)})),this.register((function(t){return new Ay(t)})),this.register((function(t){return new xy(t)})),this.register((function(t){return new Cy(t)})),this.register((function(t){return new Sy(t)})),this.register((function(t){return new _y(t)})),this.register((function(t){return new Ly(t)})),this.register((function(t){return new Ny(t)}))}load(t,e,n,r){let i,s=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:ny.extractUrlBase(t),this.manager.itemStart(t);let o=function(e){r?r(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},a=new Fv(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){try{s.parse(n,i,(function(n){e(n),s.manager.itemEnd(t)}),o)}catch(r){o(r)}}),n,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,r){let i,s={},o={},a=new TextDecoder;if("string"==typeof t)i=JSON.parse(t);else if(t instanceof ArrayBuffer)if(a.decode(new Uint8Array(t,0,4))===Oy){try{s[yy.KHR_BINARY_GLTF]=new zy(t)}catch(c){return void(r&&r(c))}i=JSON.parse(s[yy.KHR_BINARY_GLTF].content)}else i=JSON.parse(a.decode(t));else i=t;if(void 0===i.asset||i.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));let l=new c_(i,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){let t=this.pluginCallbacks[u](l);o[t.name]=t,s[t.name]=!0}if(i.extensionsUsed)for(let u=0;u<i.extensionsUsed.length;++u){let t=i.extensionsUsed[u],e=i.extensionsRequired||[];switch(t){case yy.KHR_MATERIALS_UNLIT:s[t]=new by;break;case yy.KHR_DRACO_MESH_COMPRESSION:s[t]=new Uy(i,this.dracoLoader);break;case yy.KHR_TEXTURE_TRANSFORM:s[t]=new Fy;break;case yy.KHR_MESH_QUANTIZATION:s[t]=new By;break;default:e.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(s),l.setPlugins(o),l.parse(n,r)}parseAsync(t,e){let n=this;return new Promise((function(r,i){n.parse(t,e,r,i)}))}};function vy(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}var yy={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},_y=class{constructor(t){this.parser=t,this.name=yy.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let t=this.parser,e=this.parser.json.nodes||[];for(let n=0,r=e.length;n<r;n++){let r=e[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&t._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(t){let e=this.parser,n="light:"+t,r=e.cache.get(n);if(r)return r;let i,s=e.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t],a=new sf(16777215);void 0!==o.color&&a.fromArray(o.color);let l=void 0!==o.range?o.range:0;switch(o.type){case"directional":i=new ey(a),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new Qv(a),i.distance=l;break;case"spot":i=new Xv(a),i.distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,i.angle=o.spot.outerConeAngle,i.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return i.position.set(0,0,0),i.decay=2,r_(i,o),void 0!==o.intensity&&(i.intensity=o.intensity),i.name=e.createUniqueName(o.name||"light_"+t),r=Promise.resolve(i),e.cache.add(n,r),r}getDependency(t,e){if("light"===t)return this._loadLight(e)}createNodeAttachment(t){let e=this,n=this.parser,r=n.json.nodes[t],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(t){return n._getNodeRef(e.cache,i,t)}))}},by=class{constructor(){this.name=yy.KHR_MATERIALS_UNLIT}getMaterialType(){return Im}extendParams(t,e,n){let r=[];t.color=new sf(1,1,1),t.opacity=1;let i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){let e=i.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(t,"map",i.baseColorTexture,dp))}return Promise.all(r)}},xy=class{constructor(t){this.parser=t,this.name=yy.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){let n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(e.emissiveIntensity=r),Promise.resolve()}},wy=class{constructor(t){this.parser=t,this.name=yy.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?dv:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];if(void 0!==s.clearcoatFactor&&(e.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&i.push(n.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&i.push(n.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(i.push(n.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){let t=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Gp(t,t)}return Promise.all(i)}},Sy=class{constructor(t){this.parser=t,this.name=yy.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?dv:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return void 0!==s.iridescenceFactor&&(e.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&i.push(n.assignTexture(e,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(e.iridescenceIOR=s.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&i.push(n.assignTexture(e,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}},My=class{constructor(t){this.parser=t,this.name=yy.KHR_MATERIALS_SHEEN}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?dv:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[];e.sheenColor=new sf(0,0,0),e.sheenRoughness=0,e.sheen=1;let s=r.extensions[this.name];return void 0!==s.sheenColorFactor&&e.sheenColor.fromArray(s.sheenColorFactor),void 0!==s.sheenRoughnessFactor&&(e.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&i.push(n.assignTexture(e,"sheenColorMap",s.sheenColorTexture,dp)),void 0!==s.sheenRoughnessTexture&&i.push(n.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}},Ey=class{constructor(t){this.parser=t,this.name=yy.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?dv:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&i.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(i)}},Ty=class{constructor(t){this.parser=t,this.name=yy.KHR_MATERIALS_VOLUME}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?dv:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];e.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&i.push(n.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||1/0;let o=s.attenuationColor||[1,1,1];return e.attenuationColor=new sf(o[0],o[1],o[2]),Promise.all(i)}},Ay=class{constructor(t){this.parser=t,this.name=yy.KHR_MATERIALS_IOR}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?dv:null}extendMaterialParams(t,e){let n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=n.extensions[this.name];return e.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}},Cy=class{constructor(t){this.parser=t,this.name=yy.KHR_MATERIALS_SPECULAR}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?dv:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];e.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&i.push(n.assignTexture(e,"specularIntensityMap",s.specularTexture));let o=s.specularColorFactor||[1,1,1];return e.specularColor=new sf(o[0],o[1],o[2]),void 0!==s.specularColorTexture&&i.push(n.assignTexture(e,"specularColorMap",s.specularColorTexture,dp)),Promise.all(i)}},Py=class{constructor(t){this.parser=t,this.name=yy.KHR_TEXTURE_BASISU}loadTexture(t){let e=this.parser,n=e.json,r=n.textures[t];if(!r.extensions||!r.extensions[this.name])return null;let i=r.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,i.source,s)}},Iy=class{constructor(t){this.parser=t,this.name=yy.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let e=this.name,n=this.parser,r=n.json,i=r.textures[t];if(!i.extensions||!i.extensions[e])return null;let s=i.extensions[e],o=r.images[s.source],a=n.textureLoader;if(o.uri){let t=n.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(t,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}},Ry=class{constructor(t){this.parser=t,this.name=yy.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){let e=this.name,n=this.parser,r=n.json,i=r.textures[t];if(!i.extensions||!i.extensions[e])return null;let s=i.extensions[e],o=r.images[s.source],a=n.textureLoader;if(o.uri){let t=n.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(t,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){let e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}},Ly=class{constructor(t){this.name=yy.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){let e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){let t=n.extensions[this.name],r=this.parser.getDependency("buffer",t.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then((function(e){let n=t.byteOffset||0,r=t.byteLength||0,s=t.count,o=t.byteStride,a=new Uint8Array(e,n,r);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(s,o,a,t.mode,t.filter).then((function(t){return t.buffer})):i.ready.then((function(){let e=new ArrayBuffer(s*o);return i.decodeGltfBuffer(new Uint8Array(e),s,o,a,t.mode,t.filter),e}))}))}return null}},Ny=class{constructor(t){this.name=yy.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){let e=this.parser.json,n=e.nodes[t];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;let r=e.meshes[n.mesh];for(let a of r.primitives)if(a.mode!==Wy.TRIANGLES&&a.mode!==Wy.TRIANGLE_STRIP&&a.mode!==Wy.TRIANGLE_FAN&&void 0!==a.mode)return null;let i=n.extensions[this.name].attributes,s=[],o={};for(let a in i)s.push(this.parser.getDependency("accessor",i[a]).then((t=>(o[a]=t,o[a]))));return s.length<1?null:(s.push(this.parser.createNodeMesh(t)),Promise.all(s).then((t=>{let e=t.pop(),n=e.isGroup?e.children:[e],r=t[0].count,i=[];for(let s of n){let t=new Gf,e=new ff,n=new pf,a=new ff(1,1,1),l=new Wg(s.geometry,s.material,r);for(let i=0;i<r;i++)o.TRANSLATION&&e.fromBufferAttribute(o.TRANSLATION,i),o.ROTATION&&n.fromBufferAttribute(o.ROTATION,i),o.SCALE&&a.fromBufferAttribute(o.SCALE,i),l.setMatrixAt(i,t.compose(e,n,a));for(let r in o)"TRANSLATION"!==r&&"ROTATION"!==r&&"SCALE"!==r&&s.geometry.setAttribute(r,o[r]);gm.prototype.copy.call(l,s),this.parser.assignFinalMaterial(l),i.push(l)}return e.isGroup?(e.clear(),e.add(...i),e):i[0]})))}},Oy="glTF",ky=1313821514,Dy=5130562,zy=class{constructor(t){this.name=yy.KHR_BINARY_GLTF,this.content=null,this.body=null;let e=new DataView(t,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Oy)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-12,i=new DataView(t,12),s=0;for(;s<r;){let e=i.getUint32(s,!0);s+=4;let r=i.getUint32(s,!0);if(s+=4,r===ky){let r=new Uint8Array(t,12+s,e);this.content=n.decode(r)}else if(r===Dy){let n=12+s;this.body=t.slice(n,n+e)}s+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}},Uy=class{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=yy.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){let n=this.json,r=this.dracoLoader,i=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,o={},a={},l={};for(let c in s){let t=Jy[c]||c.toLowerCase();o[t]=s[c]}for(let c in t.attributes){let e=Jy[c]||c.toLowerCase();if(void 0!==s[c]){let r=n.accessors[t.attributes[c]],i=Gy[r.componentType];l[e]=i.name,a[e]=!0===r.normalized}}return e.getDependency("bufferView",i).then((function(t){return new Promise((function(e){r.decodeDracoFile(t,(function(t){for(let e in t.attributes){let n=t.attributes[e],r=a[e];void 0!==r&&(n.normalized=r)}e(t)}),o,l)}))}))}},Fy=class{constructor(){this.name=yy.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}},By=class{constructor(){this.name=yy.KHR_MESH_QUANTIZATION}},Vy=class extends xv{constructor(t,e,n,r){super(t,e,n,r)}copySampleValue_(t){let e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r*3+r;for(let s=0;s!==r;s++)e[s]=n[i+s];return e}interpolate_(t,e,n,r){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=r-e,u=(n-e)/c,h=u*u,d=h*u,p=t*l,f=p-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u;for(let _=0;_!==o;_++){let t=s[f+_+o],e=s[f+_+a]*c,n=s[p+_+o],r=s[p+_]*c;i[_]=v*t+y*e+m*n+g*r}return i}},Hy=new pf,jy=class extends Vy{interpolate_(t,e,n,r){let i=super.interpolate_(t,e,n,r);return Hy.fromArray(i).normalize().toArray(i),i}},Wy={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Gy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},qy={9728:op,9729:ap,9984:1004,9985:1007,9986:1005,9987:lp},$y={33071:ip,33648:sp,10497:rp},Xy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Jy={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Yy={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Zy={CUBICSPLINE:void 0,LINEAR:up,STEP:cp},Ky="OPAQUE",Qy="MASK",t_="BLEND";function e_(t){return void 0===t.DefaultMaterial&&(t.DefaultMaterial=new hv({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),t.DefaultMaterial}function n_(t,e,n){for(let r in n.extensions)void 0===t[r]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function r_(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function i_(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let n=0,r=e.weights.length;n<r;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){let n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let e=0,r=n.length;e<r;e++)t.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function s_(t){let e,n=t.extensions&&t.extensions[yy.KHR_DRACO_MESH_COMPRESSION];return e=n?"draco:"+n.bufferView+":"+n.indices+":"+o_(n.attributes):t.indices+":"+o_(t.attributes)+":"+t.mode,e}function o_(t){let e="",n=Object.keys(t).sort();for(let r=0,i=n.length;r<i;r++)e+=n[r]+":"+t[n[r]]+";";return e}function a_(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var l_=new Gf,c_=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new vy,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,i=-1;typeof navigator<"u"&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,i=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&i<98?this.textureLoader=new Vv(this.options.manager):this.textureLoader=new ry(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Fv(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){let n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(e){let s={scene:e[0][r.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:r.asset,parser:n,userData:{}};n_(i,s,r),r_(s,r),Promise.all(n._invokeAll((function(t){return t.afterRoot&&t.afterRoot(s)}))).then((function(){t(s)}))})).catch(e)}_markDefs(){let t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let r=0,i=e.length;r<i;r++){let n=e[r].joints;for(let e=0,r=n.length;e<r;e++)t[n[e]].isBone=!0}for(let r=0,i=t.length;r<i;r++){let e=t[r];void 0!==e.mesh&&(this._addNodeRef(this.meshCache,e.mesh),void 0!==e.skin&&(n[e.mesh].isSkinnedMesh=!0)),void 0!==e.camera&&this._addNodeRef(this.cameraCache,e.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;let r=n.clone(),i=(t,e)=>{let n=this.associations.get(t);null!=n&&this.associations.set(e,n);for(let[r,s]of t.children.entries())i(s,e.children[r])};return i(n,r),r.name+="_instance_"+t.uses[e]++,r}_invokeOne(t){let e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){let r=t(e[n]);if(r)return r}return null}_invokeAll(t){let e=Object.values(this.plugins);e.unshift(this);let n=[];for(let r=0;r<e.length;r++){let i=t(e[r]);i&&n.push(i)}return n}getDependency(t,e){let n=t+":"+e,r=this.cache.get(n);if(!r){switch(t){case"scene":r=this.loadScene(e);break;case"node":r=this._invokeOne((function(t){return t.loadNode&&t.loadNode(e)}));break;case"mesh":r=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":r=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":r=this.loadSkin(e);break;case"animation":r=this._invokeOne((function(t){return t.loadAnimation&&t.loadAnimation(e)}));break;case"camera":r=this.loadCamera(e);break;default:if(r=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(t,e)})),!r)throw new Error("Unknown type: "+t)}this.cache.add(n,r)}return r}getDependencies(t){let e=this.cache.get(t);if(!e){let n=this,r=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(r.map((function(e,r){return n.getDependency(t,r)}))),this.cache.add(t,e)}return e}loadBuffer(t){let e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[yy.KHR_BINARY_GLTF].body);let r=this.options;return new Promise((function(t,i){n.load(ny.resolveURL(e.uri,r.path),t,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){let e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){let n=e.byteLength||0,r=e.byteOffset||0;return t.slice(r,r+n)}))}loadAccessor(t){let e=this,n=this.json,r=this.json.accessors[t];if(void 0===r.bufferView&&void 0===r.sparse){let t=Xy[r.type],e=Gy[r.componentType],n=!0===r.normalized,i=new e(r.count*t);return Promise.resolve(new Nm(i,t,n))}let i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(t){let i,s,o=t[0],a=Xy[r.type],l=Gy[r.componentType],c=l.BYTES_PER_ELEMENT,u=c*a,h=r.byteOffset||0,d=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,p=!0===r.normalized;if(d&&d!==u){let t=Math.floor(h/d),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+t+":"+r.count,u=e.cache.get(n);u||(i=new l(o,t*d,r.count*d/c),u=new Mg(i,d/c),e.cache.add(n,u)),s=new Tg(u,a,h%d/c,p)}else i=null===o?new l(r.count*a):new l(o,h,r.count*a),s=new Nm(i,a,p);if(void 0!==r.sparse){let e=Xy.SCALAR,n=Gy[r.sparse.indices.componentType],i=r.sparse.indices.byteOffset||0,c=r.sparse.values.byteOffset||0,u=new n(t[1],i,r.sparse.count*e),h=new l(t[2],c,r.sparse.count*a);null!==o&&(s=new Nm(s.array.slice(),s.itemSize,s.normalized));for(let t=0,r=u.length;t<r;t++){let e=u[t];if(s.setX(e,h[t*a]),a>=2&&s.setY(e,h[t*a+1]),a>=3&&s.setZ(e,h[t*a+2]),a>=4&&s.setW(e,h[t*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return s}))}loadTexture(t){let e=this.json,n=this.options,r=e.textures[t].source,i=e.images[r],s=this.textureLoader;if(i.uri){let t=n.manager.getHandler(i.uri);null!==t&&(s=t)}return this.loadTextureImage(t,r,s)}loadTextureImage(t,e,n){let r=this,i=this.json,s=i.textures[t],o=i.images[e],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];let l=this.loadImageSource(e,n).then((function(e){e.flipY=!1,e.name=s.name||o.name||"",""===e.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(e.name=o.uri);let n=(i.samplers||{})[s.sampler]||{};return e.magFilter=qy[n.magFilter]||ap,e.minFilter=qy[n.minFilter]||lp,e.wrapS=$y[n.wrapS]||rp,e.wrapT=$y[n.wrapT]||rp,r.associations.set(e,{textures:t}),e})).catch((function(){return null}));return this.textureCache[a]=l,l}loadImageSource(t,e){let n=this.json,r=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((t=>t.clone()));let i=n.images[t],s=self.URL||self.webkitURL,o=i.uri||"",a=!1;if(void 0!==i.bufferView)o=this.getDependency("bufferView",i.bufferView).then((function(t){a=!0;let e=new Blob([t],{type:i.mimeType});return o=s.createObjectURL(e),o}));else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");let l=Promise.resolve(o).then((function(t){return new Promise((function(n,i){let s=n;!0===e.isImageBitmapLoader&&(s=function(t){let e=new hf(t);e.needsUpdate=!0,n(e)}),e.load(ny.resolveURL(t,r.path),s,void 0,i)}))})).then((function(t){return!0===a&&s.revokeObjectURL(o),t.userData.mimeType=i.mimeType||function(t){return t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"}(i.uri),t})).catch((function(t){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),t}));return this.sourceCache[t]=l,l}assignTexture(t,e,n,r){let i=this;return this.getDependency("texture",n.index).then((function(s){if(!s)return null;if(void 0!==n.texCoord&&0!=n.texCoord&&!("aoMap"===e&&1==n.texCoord)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+e+" not yet supported."),i.extensions[yy.KHR_TEXTURE_TRANSFORM]){let t=void 0!==n.extensions?n.extensions[yy.KHR_TEXTURE_TRANSFORM]:void 0;if(t){let e=i.associations.get(s);s=i.extensions[yy.KHR_TEXTURE_TRANSFORM].extendTexture(s,t),i.associations.set(s,e)}}return void 0!==r&&(s.encoding=r),t[e]=s,s}))}assignFinalMaterial(t){let e=t.geometry,n=t.material,r=void 0===e.attributes.tangent,i=void 0!==e.attributes.color,s=void 0===e.attributes.normal;if(t.isPoints){let t="PointsMaterial:"+n.uuid,e=this.cache.get(t);e||(e=new nv,Pm.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,e.sizeAttenuation=!1,this.cache.add(t,e)),n=e}else if(t.isLine){let t="LineBasicMaterial:"+n.uuid,e=this.cache.get(t);e||(e=new Gg,Pm.prototype.copy.call(e,n),e.color.copy(n.color),this.cache.add(t,e)),n=e}if(r||i||s){let t="ClonedMaterial:"+n.uuid+":";r&&(t+="derivative-tangents:"),i&&(t+="vertex-colors:"),s&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=n.clone(),i&&(e.vertexColors=!0),s&&(e.flatShading=!0),r&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=n}getMaterialType(){return hv}loadMaterial(t){let e,n=this,r=this.json,i=this.extensions,s=r.materials[t],o={},a=[];if((s.extensions||{})[yy.KHR_MATERIALS_UNLIT]){let t=i[yy.KHR_MATERIALS_UNLIT];e=t.getMaterialType(),a.push(t.extendParams(o,s,n))}else{let r=s.pbrMetallicRoughness||{};if(o.color=new sf(1,1,1),o.opacity=1,Array.isArray(r.baseColorFactor)){let t=r.baseColorFactor;o.color.fromArray(t),o.opacity=t[3]}void 0!==r.baseColorTexture&&a.push(n.assignTexture(o,"map",r.baseColorTexture,dp)),o.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,o.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(a.push(n.assignTexture(o,"metalnessMap",r.metallicRoughnessTexture)),a.push(n.assignTexture(o,"roughnessMap",r.metallicRoughnessTexture))),e=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),a.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)}))))}!0===s.doubleSided&&(o.side=2);let l=s.alphaMode||Ky;if(l===t_?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===Qy&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&e!==Im&&(a.push(n.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new Gp(1,1),void 0!==s.normalTexture.scale)){let t=s.normalTexture.scale;o.normalScale.set(t,t)}return void 0!==s.occlusionTexture&&e!==Im&&(a.push(n.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(o.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&e!==Im&&(o.emissive=(new sf).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&e!==Im&&a.push(n.assignTexture(o,"emissiveMap",s.emissiveTexture,dp)),Promise.all(a).then((function(){let r=new e(o);return s.name&&(r.name=s.name),r_(r,s),n.associations.set(r,{materials:t}),s.extensions&&n_(i,r,s),r}))}createUniqueName(t){let e=fy.sanitizeNodeName(t||""),n=e;for(let r=1;this.nodeNamesUsed[n];++r)n=e+"_"+r;return this.nodeNamesUsed[n]=!0,n}loadGeometries(t){let e=this,n=this.extensions,r=this.primitiveCache;function i(t){return n[yy.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return u_(n,t,e)}))}let s=[];for(let o=0,a=t.length;o<a;o++){let n=t[o],a=s_(n),l=r[a];if(l)s.push(l.promise);else{let t;t=n.extensions&&n.extensions[yy.KHR_DRACO_MESH_COMPRESSION]?i(n):u_(new Wm,n,e),r[a]={primitive:n,promise:t},s.push(t)}}return Promise.all(s)}loadMesh(t){let e=this,n=this.json,r=this.extensions,i=n.meshes[t],s=i.primitives,o=[];for(let a=0,l=s.length;a<l;a++){let t=void 0===s[a].material?e_(this.cache):this.getDependency("material",s[a].material);o.push(t)}return o.push(e.loadGeometries(s)),Promise.all(o).then((function(n){let o=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let u=0,h=a.length;u<h;u++){let n,c=a[u],h=s[u],d=o[u];if(h.mode===Wy.TRIANGLES||h.mode===Wy.TRIANGLE_STRIP||h.mode===Wy.TRIANGLE_FAN||void 0===h.mode)n=!0===i.isSkinnedMesh?new Ng(c,d):new lg(c,d),!0===n.isSkinnedMesh&&n.normalizeSkinWeights(),h.mode===Wy.TRIANGLE_STRIP?n.geometry=my(n.geometry,1):h.mode===Wy.TRIANGLE_FAN&&(n.geometry=my(n.geometry,2));else if(h.mode===Wy.LINES)n=new tv(c,d);else if(h.mode===Wy.LINE_STRIP)n=new Zg(c,d);else if(h.mode===Wy.LINE_LOOP)n=new ev(c,d);else{if(h.mode!==Wy.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);n=new av(c,d)}Object.keys(n.geometry.morphAttributes).length>0&&i_(n,i),n.name=e.createUniqueName(i.name||"mesh_"+t),r_(n,i),h.extensions&&n_(r,n,h),e.assignFinalMaterial(n),l.push(n)}for(let r=0,i=l.length;r<i;r++)e.associations.set(l[r],{meshes:t,primitives:r});if(1===l.length)return l[0];let c=new Sg;e.associations.set(c,{meshes:t});for(let t=0,e=l.length;t<e;t++)c.add(l[t]);return c}))}loadCamera(t){let e,n=this.json.cameras[t],r=n[n.type];if(r)return"perspective"===n.type?e=new dg(yp.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(e=new bg(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),r_(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){let e=this.json.skins[t],n=[];for(let r=0,i=e.joints.length;r<i;r++)n.push(this._loadNodeShallow(e.joints[r]));return void 0!==e.inverseBindMatrices?n.push(this.getDependency("accessor",e.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(t){let n=t.pop(),r=t,i=[],s=[];for(let o=0,a=r.length;o<a;o++){let t=r[o];if(t){i.push(t);let e=new Gf;null!==n&&e.fromArray(n.array,16*o),s.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[o])}return new Ug(i,s)}))}loadAnimation(t){let e=this.json.animations[t],n=[],r=[],i=[],s=[],o=[];for(let a=0,l=e.channels.length;a<l;a++){let t=e.channels[a],l=e.samplers[t.sampler],c=t.target,u=c.node,h=void 0!==e.parameters?e.parameters[l.input]:l.input,d=void 0!==e.parameters?e.parameters[l.output]:l.output;n.push(this.getDependency("node",u)),r.push(this.getDependency("accessor",h)),i.push(this.getDependency("accessor",d)),s.push(l),o.push(c)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(s),Promise.all(o)]).then((function(n){let r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],l=[];for(let t=0,e=r.length;t<e;t++){let e,n=r[t],c=i[t],u=s[t],h=o[t],d=a[t];if(void 0===n)continue;switch(n.updateMatrix(),Yy[d.path]){case Yy.weights:e=Cv;break;case Yy.rotation:e=Iv;break;default:e=Lv}let p=n.name?n.name:n.uuid,f=void 0!==h.interpolation?Zy[h.interpolation]:up,m=[];Yy[d.path]===Yy.weights?n.traverse((function(t){t.morphTargetInfluences&&m.push(t.name?t.name:t.uuid)})):m.push(p);let g=u.array;if(u.normalized){let t=a_(g.constructor),e=new Float32Array(g.length);for(let n=0,r=g.length;n<r;n++)e[n]=g[n]*t;g=e}for(let t=0,r=m.length;t<r;t++){let n=new e(m[t]+"."+Yy[d.path],c.array,g,f);"CUBICSPLINE"===h.interpolation&&(n.createInterpolant=function(t){return new(this instanceof Iv?jy:Vy)(this.times,this.values,this.getValueSize()/3,t)},n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(n)}}let c=e.name?e.name:"animation_"+t;return new Nv(c,void 0,l)}))}createNodeMesh(t){let e=this.json,n=this,r=e.nodes[t];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(t){let e=n._getNodeRef(n.meshCache,r.mesh,t);return void 0!==r.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,n=r.weights.length;e<n;e++)t.morphTargetInfluences[e]=r.weights[e]})),e}))}loadNode(t){let e=this,n=this.json.nodes[t],r=e._loadNodeShallow(t),i=[],s=n.children||[];for(let a=0,l=s.length;a<l;a++)i.push(e.getDependency("node",s[a]));let o=void 0===n.skin?Promise.resolve(null):e.getDependency("skin",n.skin);return Promise.all([r,Promise.all(i),o]).then((function(t){let e=t[0],n=t[1],r=t[2];null!==r&&e.traverse((function(t){t.isSkinnedMesh&&t.bind(r,l_)}));for(let i=0,s=n.length;i<s;i++)e.add(n[i]);return e}))}_loadNodeShallow(t){let e=this.json,n=this.extensions,r=this;if(void 0!==this.nodeCache[t])return this.nodeCache[t];let i=e.nodes[t],s=i.name?r.createUniqueName(i.name):"",o=[],a=r._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return a&&o.push(a),void 0!==i.camera&&o.push(r.getDependency("camera",i.camera).then((function(t){return r._getNodeRef(r.cameraCache,i.camera,t)}))),r._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){o.push(t)})),this.nodeCache[t]=Promise.all(o).then((function(e){let o;if(o=!0===i.isBone?new Og:e.length>1?new Sg:1===e.length?e[0]:new gm,o!==e[0])for(let t=0,n=e.length;t<n;t++)o.add(e[t]);if(i.name&&(o.userData.name=i.name,o.name=s),r_(o,i),i.extensions&&n_(n,o,i),void 0!==i.matrix){let t=new Gf;t.fromArray(i.matrix),o.applyMatrix4(t)}else void 0!==i.translation&&o.position.fromArray(i.translation),void 0!==i.rotation&&o.quaternion.fromArray(i.rotation),void 0!==i.scale&&o.scale.fromArray(i.scale);return r.associations.has(o)||r.associations.set(o,{}),r.associations.get(o).nodes=t,o})),this.nodeCache[t]}loadScene(t){let e=this.extensions,n=this.json.scenes[t],r=this,i=new Sg;n.name&&(i.name=r.createUniqueName(n.name)),r_(i,n),n.extensions&&n_(e,i,n);let s=n.nodes||[],o=[];for(let a=0,l=s.length;a<l;a++)o.push(r.getDependency("node",s[a]));return Promise.all(o).then((function(t){for(let e=0,n=t.length;e<n;e++)i.add(t[e]);return r.associations=(t=>{let e=new Map;for(let[n,i]of r.associations)(n instanceof Pm||n instanceof hf)&&e.set(n,i);return t.traverse((t=>{let n=r.associations.get(t);null!=n&&e.set(t,n)})),e})(i),i}))}};function u_(t,e,n){let r=e.attributes,i=[];function s(e,r){return n.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(let o in r){let e=Jy[o]||o.toLowerCase();e in t.attributes||i.push(s(r[o],e))}if(void 0!==e.indices&&!t.index){let r=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));i.push(r)}return r_(t,e),function(t,e,n){let r=e.attributes,i=new vf;if(void 0===r.POSITION)return;{let t=n.json.accessors[r.POSITION],e=t.min,s=t.max;if(void 0===e||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new ff(e[0],e[1],e[2]),new ff(s[0],s[1],s[2])),t.normalized){let e=a_(Gy[t.componentType]);i.min.multiplyScalar(e),i.max.multiplyScalar(e)}}let s=e.targets;if(void 0!==s){let t=new ff,e=new ff;for(let r=0,i=s.length;r<i;r++){let i=s[r];if(void 0!==i.POSITION){let r=n.json.accessors[i.POSITION],s=r.min,o=r.max;if(void 0!==s&&void 0!==o){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),r.normalized){let t=a_(Gy[r.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(t)}t.boundingBox=i;let o=new Df;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,t.boundingSphere=o}(t,e,n),Promise.all(i).then((function(){return void 0!==e.targets?function(t,e,n){let r=!1,i=!1,s=!1;for(let c=0,u=e.length;c<u;c++){let t=e[c];if(void 0!==t.POSITION&&(r=!0),void 0!==t.NORMAL&&(i=!0),void 0!==t.COLOR_0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(t);let o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){let u=e[c];if(r){let e=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):t.attributes.position;o.push(e)}if(i){let e=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):t.attributes.normal;a.push(e)}if(s){let e=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):t.attributes.color;l.push(e)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(e){let n=e[0],o=e[1],a=e[2];return r&&(t.morphAttributes.position=n),i&&(t.morphAttributes.normal=o),s&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}var h_=class{parse(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n=Object.assign({version:"1.4.1",author:null,textureDirectory:"",upAxis:"Y_UP",unitName:null,unitMeter:null},n),null===n.upAxis.match(/^[XYZ]_UP$/))return console.error("ColladaExporter: Invalid upAxis: valid values are X_UP, Y_UP or Z_UP."),null;if(null!==n.unitName&&null===n.unitMeter)return console.error("ColladaExporter: unitMeter needs to be specified if unitName is specified."),null;if(null!==n.unitMeter&&null===n.unitName)return console.error("ColladaExporter: unitName needs to be specified if unitMeter is specified."),null;""!==n.textureDirectory&&(n.textureDirectory=`${n.textureDirectory}/`.replace(/\\/g,"/").replace(/\/+/g,"/"));let r,i,s=n.version;if("1.4.1"!==s&&"1.5.0"!==s)return console.warn(`ColladaExporter : Version ${s} not supported for export. Only 1.4.1 and 1.5.0.`),null;function o(t,e){return r=r||document.createElement("canvas"),i=i||r.getContext("2d"),r.width=t.width,r.height=t.height,i.drawImage(t,0,0),function(t){let e=atob(t),n=new Uint8Array(e.length);for(let r=0,i=n.length;r<i;r++)n[r]=e.charCodeAt(r);return n}(r.toDataURL(`image/${e}`,1).replace(/^data:image\/(png|jpg);base64,/,""))}let a,l=["getX","getY","getZ","getW"],c=new sf;function u(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){let e=new Float32Array(3*t.count);for(let n=0,r=t.count;n<r;n++)c.fromBufferAttribute(t,n).convertLinearToSRGB(),e[3*n+0]=c.r,e[3*n+1]=c.g,e[3*n+2]=c.b;return e}if(t.isInterleavedBufferAttribute){let e=new t.array.constructor(t.count*t.itemSize),n=t.itemSize;for(let r=0,i=t.count;r<i;r++)for(let s=0;s<n;s++)e[r*n+s]=t[l[s]](r);return e}return t.array}function h(t,e,n){return Array.isArray(t)?t.slice(e,e+n):new t.constructor(t.buffer,e*t.BYTES_PER_ELEMENT,n)}function d(t,e,n,r){let i=u(t,arguments.length>4&&void 0!==arguments[4]&&arguments[4]);return`<source id="${e}"><float_array id="${e}-array" count="${i.length}">`+i.join(" ")+`</float_array><technique_common><accessor source="#${e}-array" count="${Math.floor(i.length/t.itemSize)}" stride="${t.itemSize}">`+n.map((t=>`<param name="${t}" type="${r}" />`)).join("")+"</accessor></technique_common></source>"}function p(t){let e=g.get(t);if(null==e){e=`image-${y.length+1}`;let r="png",i=t.name||e,a=`<image id="${e}" name="${i}">`;a+="1.5.0"===s?`<init_from><ref>${n.textureDirectory}${i}.${r}</ref></init_from>`:`<init_from>${n.textureDirectory}${i}.${r}</init_from>`,a+="</image>",y.push(a),g.set(t,e),v.push({directory:n.textureDirectory,name:i,ext:r,data:o(t.image,r),original:t})}return e}let f=new WeakMap,m=new WeakMap,g=new WeakMap,v=[],y=[],_=[],b=[],x=[],w=function t(e){let n=`<node name="${e.name}">`;if(n+=function(t){return t.updateMatrix(),a=a||new Gf,a.copy(t.matrix),a.transpose(),`<matrix>${a.toArray().join(" ")}</matrix>`}(e),!0===e.isMesh&&null!==e.geometry){let t,r=function(t){let e=f.get(t);if(!e){let n=t;if(!0!==n.isBufferGeometry)throw new Error("THREE.ColladaExporter: Geometry is not of type THREE.BufferGeometry.");let r=`Mesh${_.length+1}`,i=n.index?n.index.count*n.index.itemSize:n.attributes.position.count,s=null!=n.groups&&0!==n.groups.length?n.groups:[{start:0,count:i,materialIndex:0}],o=`<geometry id="${r}"${t.name?` name="${t.name}"`:""}><mesh>`,a=`${r}-position`,l=`${r}-vertices`;o+=d(n.attributes.position,a,["X","Y","Z"],"float"),o+=`<vertices id="${l}"><input semantic="POSITION" source="#${a}" /></vertices>`;let c=`<input semantic="VERTEX" source="#${l}" offset="0" />`;if("normal"in n.attributes){let t=`${r}-normal`;o+=d(n.attributes.normal,t,["X","Y","Z"],"float"),c+=`<input semantic="NORMAL" source="#${t}" offset="0" />`}if("uv"in n.attributes){let t=`${r}-texcoord`;o+=d(n.attributes.uv,t,["S","T"],"float"),c+=`<input semantic="TEXCOORD" source="#${t}" offset="0" set="0" />`}if("uv2"in n.attributes){let t=`${r}-texcoord2`;o+=d(n.attributes.uv2,t,["S","T"],"float"),c+=`<input semantic="TEXCOORD" source="#${t}" offset="0" set="1" />`}if("color"in n.attributes){let t=`${r}-color`;o+=d(n.attributes.color,t,["R","G","B"],"float",!0),c+=`<input semantic="COLOR" source="#${t}" offset="0" />`}let p=null;if(n.index)p=u(n.index);else{p=new Array(i);for(let t=0,e=p.length;t<e;t++)p[t]=t}for(let t=0,e=s.length;t<e;t++){let e=s[t],n=h(p,e.start,e.count),r=n.length/3;o+=`<triangles material="MESH_MATERIAL_${e.materialIndex}" count="${r}">`,o+=c,o+=`<p>${n.join(" ")}</p>`,o+="</triangles>"}o+="</mesh></geometry>",_.push(o),e={meshid:r,bufferGeometry:n},f.set(t,e)}return e}(e.geometry),i=r.meshid,s=r.bufferGeometry,o=null,a=e.material||new Im,l=Array.isArray(a)?a:[a];t=s.groups.length>l.length?new Array(s.groups.length):new Array(l.length),o=t.fill().map(((t,e)=>function(t){let e=m.get(t);if(null==e){e=`Mat${b.length+1}`;let n="phong";!0===t.isMeshLambertMaterial?n="lambert":!0===t.isMeshBasicMaterial&&(n="constant",null!==t.map&&console.warn("ColladaExporter: Texture maps not supported with MeshBasicMaterial."));let r=t.emissive?t.emissive:new sf(0,0,0),i=t.color?t.color:new sf(0,0,0),s=t.specular?t.specular:new sf(1,1,1),o=t.shininess||0,a=t.reflectivity||0;r.convertLinearToSRGB(),s.convertLinearToSRGB(),i.convertLinearToSRGB();let l="";!0===t.transparent&&(l+="<transparent>"+(t.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>")+"</transparent>",t.opacity<1&&(l+=`<transparency><float>${t.opacity}</float></transparency>`));let c=`<technique sid="common"><${n}><emission>`+(t.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':`<color sid="emission">${r.r} ${r.g} ${r.b} 1</color>`)+"</emission>"+("constant"!==n?"<diffuse>"+(t.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':`<color sid="diffuse">${i.r} ${i.g} ${i.b} 1</color>`)+"</diffuse>":"")+("constant"!==n?"<bump>"+(t.normalMap?'<texture texture="bump-sampler" texcoord="TEXCOORD" />':"")+"</bump>":"")+("phong"===n?`<specular><color sid="specular">${s.r} ${s.g} ${s.b} 1</color></specular><shininess>`+(t.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':`<float sid="shininess">${o}</float>`)+"</shininess>":"")+`<reflective><color>${i.r} ${i.g} ${i.b} 1</color></reflective><reflectivity><float>${a}</float></reflectivity>`+l+`</${n}></technique>`,u=`<effect id="${e}-effect"><profile_COMMON>`+(t.map?`<newparam sid="diffuse-surface"><surface type="2D"><init_from>${p(t.map)}</init_from></surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>`:"")+(t.specularMap?`<newparam sid="specular-surface"><surface type="2D"><init_from>${p(t.specularMap)}</init_from></surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>`:"")+(t.emissiveMap?`<newparam sid="emissive-surface"><surface type="2D"><init_from>${p(t.emissiveMap)}</init_from></surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>`:"")+(t.normalMap?`<newparam sid="bump-surface"><surface type="2D"><init_from>${p(t.normalMap)}</init_from></surface></newparam><newparam sid="bump-sampler"><sampler2D><source>bump-surface</source></sampler2D></newparam>`:"")+c+(2===t.side?'<extra><technique profile="THREEJS"><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':"")+"</profile_COMMON></effect>",h=`<material id="${e}"${t.name?` name="${t.name}"`:""}><instance_effect url="#${e}-effect" /></material>`;x.push(h),b.push(u),m.set(t,e)}return e}(l[e%l.length]))),n+=`<instance_geometry url="#${i}">`+(o.length>0?"<bind_material><technique_common>"+o.map(((t,e)=>`<instance_material symbol="MESH_MATERIAL_${e}" target="#${t}" ><bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>`)).join("")+"</technique_common></bind_material>":"")+"</instance_geometry>"}return e.children.forEach((e=>n+=t(e))),n+="</node>",n}(t),S=`<?xml version="1.0" encoding="UTF-8" standalone="no" ?><COLLADA xmlns="${"1.4.1"===s?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/"}" version="${s}"><asset><contributor><authoring_tool>three.js Collada Exporter</authoring_tool>`+(null!==n.author?`<author>${n.author}</author>`:"")+`</contributor><created>${(new Date).toISOString()}</created><modified>${(new Date).toISOString()}</modified>`+(null!==n.unitName?`<unit name="${n.unitName}" meter="${n.unitMeter}" />`:"")+`<up_axis>${n.upAxis}</up_axis></asset>`;S+=`<library_images>${y.join("")}</library_images>`,S+=`<library_effects>${b.join("")}</library_effects>`,S+=`<library_materials>${x.join("")}</library_materials>`,S+=`<library_geometries>${_.join("")}</library_geometries>`,S+=`<library_visual_scenes><visual_scene id="Scene" name="scene">${w}</visual_scene></library_visual_scenes>`,S+='<scene><instance_visual_scene url="#Scene"/></scene>',S+="</COLLADA>";let M={data:function(t){let e=/^<\//,n=/(\?>$)|(\/>$)/,r=/<[^>]+>[^<]*<\/[^<]+>/,i=(t,e)=>e>0?t+i(t,e-1):"",s=0;return t.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g).map((t=>{!r.test(t)&&!n.test(t)&&e.test(t)&&s--;let o=`${i("  ",s)}${t}`;return!r.test(t)&&!n.test(t)&&!e.test(t)&&s++,o})).join("\n")}(S),textures:v};return"function"==typeof e&&requestAnimationFrame((()=>e(M))),M}},d_=function(){var t,e,n,r,i,a,l,c,u,h=null,d=null,p=null,f={},m={},g={},y={},_={},b={},x={},S={},M={},E=THREE.SmoothShading,T={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},A=1;function C(s,o,f){if(h=s,o=o||p,void 0!==f){var v=f.split("/");v.pop(),l=(v.length<1?".":v.join("/"))+"/"}(function(){var t=h.querySelectorAll("asset"),e=t[0];if(e&&e.childNodes)for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];switch(r.nodeName){case"unit":var i=r.getAttribute("meter");i&&(A=parseFloat(i));break;case"up_axis":r.textContent.charAt(0)}}})(),m=P("library_images image",B,"image"),b=P("library_materials material",at,"material"),x=P("library_effects effect",dt,"effect"),_=P("library_geometries geometry",Z,"geometry"),S=P("library_cameras camera",yt,"camera"),M=P("library_lights light",bt,"light"),y=P("library_controllers controller",V,"controller"),g=P("library_animations animation",ft,"animation"),i=P("library_visual_scenes visual_scene",G,"visual_scene"),a=P("library_kinematics_models kinematics_model",wt,"kinematics_model"),c=[],u=[],t=function(){var t=h.querySelectorAll("scene instance_visual_scene")[0];if(t){var e=t.getAttribute("url").replace(/^#/,"");return i[e.length>0?e:"visual_scene0"]}return null}(),d=new THREE.Group;for(var w=0;w<t.nodes.length;w++)d.add(k(t.nodes[w]));d.scale.multiplyScalar(A),n=[],I(d),e=function(){var t=h.querySelectorAll("instance_kinematics_model")[0];if(t){var e=t.getAttribute("url").replace(/^#/,"");return a[e.length>0?e:"kinematics_model0"]}return null}(),function(){if(e&&0===e.joints.length)return void(r=void 0);var n={},i=function(r,i){var s=i.getAttribute("id"),o=t.getChildById(s,!0),a=e.joints[r];d.traverse((function(t){t.colladaId==s&&(n[r]={node:t,transforms:o.transforms,joint:a,position:a.zeroPosition})}))};r={joints:e&&e.joints,getJointValue:function(t){var e=n[t];if(e)return e.position;console.log("getJointValue: joint "+t+" doesn't exist")},setJointValue:function(t,e){var r=n[t];if(r){var i=r.joint;if(e>i.limits.max||e<i.limits.min)console.log("setJointValue: joint "+t+" value "+e+" outside of limits (min: "+i.limits.min+", max: "+i.limits.max+")");else if(i.static)console.log("setJointValue: joint "+t+" is static");else{var s=r.node,a=i.axis,l=r.transforms,c=new THREE.Matrix4;for(o=0;o<l.length;o++){var u=l[o];if(u.sid&&-1!==u.sid.indexOf("joint"+t))switch(i.type){case"revolute":c.multiply(h.makeRotationAxis(a,THREE.Math.degToRad(e)));break;case"prismatic":c.multiply(h.makeTranslation(a.x*e,a.y*e,a.z*e));break;default:console.warn("setJointValue: unknown joint type: "+i.type)}else{var h=new THREE.Matrix4;switch(u.type){case"matrix":c.multiply(u.obj);break;case"translate":c.multiply(h.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"rotate":c.multiply(h.makeRotationAxis(u.obj,u.angle))}}}var d=c.elements,p=Array.prototype.slice.call(d),f=[p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]];s.matrix.set.apply(s.matrix,f),s.matrix.decompose(s.position,s.quaternion,s.scale)}}else console.log("setJointValue: joint "+t+" doesn't exist")}};var s=h.querySelector("scene instance_kinematics_scene");if(s)for(var o=0;o<s.childNodes.length;o++){var a=s.childNodes[o];if(1==a.nodeType&&"bind_joint_axis"===a.nodeName){var l=a.getAttribute("target").split("/").pop(),c=a.querySelector("axis param").textContent,u=parseInt(c.split("joint").pop().split(".")[0]),p=h.querySelector('[sid="'+l+'"]');p&&i(u,p.parentElement)}}}();var E={scene:d,morphs:c,skins:u,animations:n,kinematics:r,dae:{images:m,materials:b,cameras:S,lights:M,effects:x,geometries:_,controllers:y,animations:g,visualScenes:i,visualScene:t,scene:t,kinematicsModels:a,kinematicsModel:e}};return o&&o(E),E}function P(t,e,n){for(var r=h.querySelectorAll(t),i={},s=0,o=r.length,a=0;a<o;a++){var l=r[a],c=(new e).parse(l);(!c.id||0===c.id.length)&&(c.id=n+s++),i[c.id]=c}return i}function I(e){var r=t.getChildById(e.colladaId,!0),i=null;if(r&&r.keys){i={fps:60,hierarchy:[{node:r,keys:r.keys,sids:r.sids}],node:e,name:"animation_"+e.name,length:0},n.push(i);for(var s=0,o=r.keys.length;s<o;s++)i.length=Math.max(i.length,r.keys[s].time)}else i={hierarchy:[{keys:[],sids:[]}]};for(s=0,o=e.children.length;s<o;s++)for(var a=0,l=I(e.children[s]).hierarchy.length;a<l;a++)i.hierarchy.push({keys:[],sids:[]});return i}function R(t,e){var n=e instanceof X?y[e.url]:e;if(n&&n.morph){for(var r=n.morph,i=0;i<r.targets.length;i++){var s=r.targets[i],o=_[s];if(o.mesh&&o.mesh.primitives&&o.mesh.primitives.length){var a=o.mesh.primitives[0].geometry;a.vertices.length===t.vertices.length&&t.morphTargets.push({name:"target_1",vertices:a.vertices})}}t.morphTargets.push({name:"target_Z",vertices:t.vertices})}else console.log("could not find morph controller!")}function L(t,e,n,r){if(t.world=t.world||new THREE.Matrix4,t.localworld=t.localworld||new THREE.Matrix4,t.world.copy(t.matrix),t.localworld.copy(t.matrix),t.channels&&t.channels.length){var i=t.channels[0].sampler.output[n];i instanceof THREE.Matrix4&&(t.world.copy(i),t.localworld.copy(i),0===n&&t.matrix.copy(i))}r&&t.world.multiplyMatrices(r,t.world),e.push(t);for(var s=0;s<t.nodes.length;s++)L(t.nodes[s],e,n,t.world)}function N(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=-1;if("JOINT"==r.type){for(var s=0;s<e.joints.length;s++)if(r.sid===e.joints[s]){i=s;break}if(i>=0){var o=e.invBindMatrices[i];r.invBindMatrix=o,r.skinningMatrix=new THREE.Matrix4,r.skinningMatrix.multiplyMatrices(r.world,o),r.animatrix=new THREE.Matrix4,r.animatrix.copy(r.localworld),r.weights=[];for(s=0;s<e.weights.length;s++)for(var a=0;a<e.weights[s].length;a++){var l=e.weights[s][a];l.joint===i&&r.weights.push(l)}}else console.warn("ColladaLoader: Could not find joint '"+r.sid+"'."),r.skinningMatrix=new THREE.Matrix4,r.weights=[]}}}function O(e,n,r){var i=y[n.url];if(r=void 0!==r?r:40,i&&i.skin)if(n.skeleton&&n.skeleton.length){for(var a=function(){var t,e=1e6,n=-e,r=0;for(var i in g){var s=g[i];t=t||s.id;for(var o=0;o<s.sampler.length;o++){var a=s.sampler[o];a.create(),e=Math.min(e,a.startTime),n=Math.max(n,a.endTime),r=Math.max(r,a.input.length)}}return{start:e,end:n,frames:r,ID:t}}(),l=t.getChildById(n.skeleton[0],!0)||t.getChildBySid(n.skeleton[0],!0),c=function(t){var e=[],n=function(t,e,r){var i={};i.name=e.sid,i.parent=t,i.matrix=e.matrix;var s=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];for(var o in i.matrix.decompose(s[0],s[1],s[2]),i.pos=[s[0].x,s[0].y,s[0].z],i.scl=[s[2].x,s[2].y,s[2].z],i.rotq=[s[1].x,s[1].y,s[1].z,s[1].w],r.push(i),e.nodes)n(e.sid,e.nodes[o],r)};return n(-1,t,e),e}(l),u=i.skin.joints,h=[],d=0;d<u.length;d++)for(var p=0;p<c.length;p++)c[p].name===u[d]&&(h[d]=c[p]);for(d=0;d<h.length;d++)for(p=0;p<h.length;p++)h[d].parent===h[p].name&&(h[d].parent=p);for(new THREE.Vector3,d=0;d<e.vertices.length;d++)e.vertices[d].applyMatrix4(i.skin.bindShapeMatrix);var f=[],m=[],_=i.skin.weights;for(d=0;d<_.length;d++){var b=new THREE.Vector4(_[d][0]?_[d][0].joint:0,_[d][1]?_[d][1].joint:0,_[d][2]?_[d][2].joint:0,_[d][3]?_[d][3].joint:0),x=new THREE.Vector4(_[d][0]?_[d][0].weight:0,_[d][1]?_[d][1].weight:0,_[d][2]?_[d][2].weight:0,_[d][3]?_[d][3].weight:0);f.push(b),m.push(x)}e.skinIndices=f,e.skinWeights=m,e.bones=h;var S={name:a.ID,fps:30,length:a.frames/30,hierarchy:[]};for(p=0;p<h.length;p++)S.hierarchy.push({parent:h[p].parent,name:h[p].name,keys:[]});for(console.log("ColladaLoader:",a.ID+" has "+h.length+" bones."),function(t,e,n){var r=[];L(e,r,-1),N(r,n.skin),v=new THREE.Vector3;for(var i=[],a=0;a<t.vertices.length;a++)i.push(new THREE.Vector3);for(a=0;a<r.length;a++)if("JOINT"==r[a].type)for(j=0;j<r[a].weights.length;j++)w=r[a].weights[j],vidx=w.index,weight=w.weight,o=t.vertices[vidx],s=i[vidx],v.x=o.x,v.y=o.y,v.z=o.z,v.applyMatrix4(r[a].skinningMatrix),s.x+=v.x*weight,s.y+=v.y*weight,s.z+=v.z*weight;for(a=0;a<t.vertices.length;a++)t.vertices[a]=i[a]}(e,l,i),r=0;r<a.frames;r++){var M=[];L(l,M,r),N(M,i.skin);for(d=0;d<M.length;d++)for(p=0;p<S.hierarchy.length;p++)if(S.hierarchy[p].name===M[d].sid){var E={};E.time=r/30,E.matrix=M[d].animatrix,0===r&&(M[d].matrix=E.matrix);var T=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];E.matrix.decompose(T[0],T[1],T[2]),E.pos=[T[0].x,T[0].y,T[0].z],E.scl=[T[2].x,T[2].y,T[2].z],E.rot=T[1],S.hierarchy[p].keys.push(E)}e.animation=S}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");else console.log("ColladaLoader: Could not find skin controller.")}function k(t,e){var n,r,i,s,o=new THREE.Object3D;for(i=0;i<t.controllers.length;i++){var a=y[t.controllers[i].url];switch(a.type){case"skin":if(_[a.skin.source])(h=new Y).url=a.skin.source,h.instance_material=t.controllers[i].instance_material,t.geometries.push(h),n=t.controllers[i];else if(y[a.skin.source]){var l=y[a.skin.source];if(r=l,l.morph&&_[l.morph.source])(h=new Y).url=l.morph.source,h.instance_material=t.controllers[i].instance_material,t.geometries.push(h)}break;case"morph":var h;if(_[a.morph.source])(h=new Y).url=a.morph.source,h.instance_material=t.controllers[i].instance_material,t.geometries.push(h),r=t.controllers[i];console.log("ColladaLoader: Morph-controller partially supported.")}}var d={};for(i=0;i<t.geometries.length;i++){var p,f=t.geometries[i],m=f.instance_material,g=_[f.url],v={},w=[],E=0;if(g){if(!g.mesh||!g.mesh.primitives)continue;if(0===o.name.length&&(o.name=g.id),m)for(s=0;s<m.length;s++){var T=m[s],A=b[T.target],C=A.instance_effect.url,P=x[C].shader.material;if(g.doubleSided){if(!(T.symbol in d)){var I=P.clone();I.side=THREE.DoubleSide,d[T.symbol]=I}P=d[T.symbol]}P.opacity=P.opacity?P.opacity:1,v[T.symbol]=E,w.push(P),(p=P).name=null===A.name||""===A.name?A.id:A.name,E++}var L,N=p||new THREE.MeshLambertMaterial({color:14540253,side:g.doubleSided?THREE.DoubleSide:THREE.FrontSide}),D=g.mesh.geometry3js;if(E>1)for(N=new THREE.MeshFaceMaterial(w),s=0;s<D.faces.length;s++){var z=D.faces[s];z.materialIndex=v[z.daeMaterial]}void 0!==n?(O(D,n),D.morphTargets.length>0?(N.morphTargets=!0,N.skinning=!1):(N.morphTargets=!1,N.skinning=!0),(L=new THREE.SkinnedMesh(D,N,!1)).name="skin_"+u.length,u.push(L)):void 0!==r?(R(D,r),N.morphTargets=!0,(L=new THREE.Mesh(D,N)).name="morph_"+c.length,c.push(L)):L=!0===D.isLineStrip?new THREE.Line(D):new THREE.Mesh(D,N),o.add(L)}}for(i=0;i<t.cameras.length;i++){var U=t.cameras[i],F=S[U.url],B=new THREE.PerspectiveCamera(F.yfov,parseFloat(F.aspect_ratio),parseFloat(F.znear),parseFloat(F.zfar));o.add(B)}for(i=0;i<t.lights.length;i++){var V=null,H=t.lights[i],j=M[H.url];if(j&&j.technique){var W=j.color.getHex(),G=j.intensity,q=j.distance,$=j.falloff_angle;switch(j.technique){case"directional":(V=new THREE.DirectionalLight(W,G,q)).position.set(0,0,1);break;case"point":V=new THREE.PointLight(W,G,q);break;case"spot":(V=new THREE.SpotLight(W,G,q,$,undefined)).position.set(0,0,1);break;case"ambient":V=new THREE.AmbientLight(W)}}V&&o.add(V)}for(o.name=t.name||t.id||"",o.colladaId=t.id||"",o.layer=t.layer||"",o.matrix=t.matrix,o.matrix.decompose(o.position,o.quaternion,o.scale),i=0;i<t.nodes.length;i++)o.add(k(t.nodes[i]));return o}function D(t){for(var e=h.querySelectorAll("library_nodes node"),n=0;n<e.length;n++){var r=e[n].attributes.getNamedItem("id");if(r&&r.value===t)return e[n]}}function z(t,e){for(var n=null,r=0,i=t.length;r<i&&null===n;r++){var s=t[r];if(s.time===e)n=s;else if(s.time>e)break}return n}function U(t,e){for(var n=-1,r=0,i=t.length;r<i&&-1===n;r++){t[r].time>=e&&(n=r)}return n}function F(t,e,n,r){var i=function(t,e,n){for(n=n>=0?n:n+t.length;n>=0;n--){var r=t[n];if(r.hasTarget(e))return r}return null}(t,r,n?n-1:0),s=function(t,e,n){for(;n<t.length;n++){var r=t[n];if(r.hasTarget(e))return r}return null}(t,r,n+1);if(i&&s){var o,a=(e.time-i.time)/(s.time-i.time),l=i.getTarget(r),c=s.getTarget(r).data,u=l.data;if("matrix"===l.type)o=u;else if(u.length){o=[];for(var h=0;h<u.length;++h)o[h]=u[h]+(c[h]-u[h])*a}else o=u+(c-u)*a;e.addTarget(r,l.transform,l.member,o)}}function B(){this.id="",this.init_from=""}function V(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function H(){this.method=null,this.source=null,this.targets=null,this.weights=null}function W(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function G(){this.id="",this.name="",this.nodes=[],this.scene=new THREE.Group}function q(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function $(){this.sid="",this.type="",this.data=[],this.obj=null}function X(){this.url="",this.skeleton=[],this.instance_material=[]}function J(){this.symbol="",this.target=""}function Y(){this.url="",this.instance_material=[]}function Z(){this.id="",this.mesh=null}function K(t){this.geometry=t.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function Q(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function tt(){Q.call(this),this.vcount=[]}function et(){Q.call(this),this.vcount=1}function nt(){Q.call(this),this.vcount=3}function rt(){this.source="",this.count=0,this.stride=0,this.params=[]}function it(){this.input={}}function st(){this.semantic="",this.offset=0,this.source="",this.set=0}function ot(t){this.id=t,this.type=null}function at(){this.id="",this.name="",this.instance_effect=null}function lt(){this.color=new THREE.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function ct(t,e){this.type=t,this.effect=e,this.material=null}function ut(t){this.effect=t,this.init_from=null,this.format=null}function ht(t){this.effect=t,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function dt(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function pt(){this.url=""}function ft(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function mt(t){this.animation=t,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function gt(t){this.id="",this.animation=t,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function vt(t){this.targets=[],this.time=t}function yt(){this.id="",this.name="",this.technique=""}function _t(){this.url=""}function bt(){this.id="",this.name="",this.technique=""}function xt(){this.url=""}function wt(){this.id="",this.name="",this.joints=[],this.links=[]}function St(){this.sid="",this.name="",this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function Mt(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function Et(){this.joint="",this.transforms=[],this.links=[]}function Tt(t){var e=t.getAttribute("id");return null!=f[e]||(f[e]=new ot(e).parse(t)),f[e]}function At(t){for(var e=It(t),n=[],r=0,i=e.length;r<i;r++)n.push("true"===e[r]||"1"===e[r]);return n}function Ct(t){for(var e=It(t),n=[],r=0,i=e.length;r<i;r++)n.push(parseFloat(e[r]));return n}function Pt(t){for(var e=It(t),n=[],r=0,i=e.length;r<i;r++)n.push(parseInt(e[r],10));return n}function It(t){return t.length>0?function(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}(t).split(/\s+/):[]}function Rt(t,e,n){return t.hasAttribute(e)?parseInt(t.getAttribute(e),10):n}function Lt(t,e){(new THREE.ImageLoader).load(e,(function(e){t.image=e,t.needsUpdate=!0}))}function Nt(t,e){t.doubleSided=!1;var n=e.querySelectorAll("extra double_sided")[0];n&&n&&1===parseInt(n.textContent,10)&&(t.doubleSided=!0)}function Ot(t,e){var n=[t[e],t[e+1],t[e+2]];return new THREE.Vector3(n[0],n[1],n[2])}function kt(t){return(new THREE.Matrix4).set(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Dt(t){if(t>-1&&t<3){t={X:0,Y:1,Z:2}[t=["X","Y","Z"][t]]}return t}return B.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];"init_from"===n.nodeName&&(this.init_from=n.textContent)}return this},V.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.type="none";for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"skin":this.skin=(new W).parse(n),this.type=n.nodeName;break;case"morph":this.morph=(new H).parse(n),this.type=n.nodeName}}return this},H.prototype.parse=function(t){var e,n={},r=[];for(this.method=t.getAttribute("method"),this.source=t.getAttribute("source").replace(/^#/,""),e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if(1==i.nodeType)switch(i.nodeName){case"source":n[(o=(new ot).parse(i)).id]=o;break;case"targets":r=this.parseInputs(i);break;default:console.log(i.nodeName)}}for(e=0;e<r.length;e++){var s=r[e],o=n[s.source];switch(s.semantic){case"MORPH_TARGET":this.targets=o.read();break;case"MORPH_WEIGHT":this.weights=o.read()}}return this},H.prototype.parseInputs=function(t){for(var e=[],n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1==r.nodeType&&"input"===r.nodeName)e.push((new st).parse(r))}return e},W.prototype.parse=function(t){var e,n,r={};this.source=t.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"bind_shape_matrix":var o=Ct(s.textContent);this.bindShapeMatrix=kt(o);break;case"source":var a=(new ot).parse(s);r[a.id]=a;break;case"joints":e=s;break;case"vertex_weights":n=s;break;default:console.log(s.nodeName)}}return this.parseJoints(e,r),this.parseWeights(n,r),this},W.prototype.parseJoints=function(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1==r.nodeType&&"input"===r.nodeName){var i=(new st).parse(r),s=e[i.source];"JOINT"===i.semantic?this.joints=s.read():"INV_BIND_MATRIX"===i.semantic&&(this.invBindMatrices=s.read())}}},W.prototype.parseWeights=function(t,e){for(var n,r,i=[],s=0;s<t.childNodes.length;s++){var o=t.childNodes[s];if(1==o.nodeType)switch(o.nodeName){case"input":i.push((new st).parse(o));break;case"v":n=Pt(o.textContent);break;case"vcount":r=Pt(o.textContent)}}var a=0;for(s=0;s<r.length;s++){for(var l=r[s],c=[],u=0;u<l;u++){for(var h={},d=0;d<i.length;d++){var p=i[d],f=n[a+p.offset];switch(p.semantic){case"JOINT":h.joint=f;break;case"WEIGHT":h.weight=e[p.source].data[f]}}c.push(h),a+=i.length}for(u=0;u<c.length;u++)c[u].index=s;this.weights.push(c)}},G.prototype.getChildById=function(t,e){for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildById(t,e);if(r)return r}return null},G.prototype.getChildBySid=function(t,e){for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildBySid(t,e);if(r)return r}return null},G.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.nodes=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType&&"node"===n.nodeName)this.nodes.push((new q).parse(n))}return this},q.prototype.getChannelForTransform=function(t){for(var e=0;e<this.channels.length;e++){var n=this.channels[e],r=n.target.split("/");r.shift();var i,s=r.shift(),o=s.indexOf(".")>=0,a=s.indexOf("(")>=0;if(o)r=s.split("."),s=r.shift(),r.shift();else if(a){i=s.split("("),s=i.shift();for(var l=0;l<i.length;l++)i[l]=parseInt(i[l].replace(/\)/,""))}if(s===t)return n.info={sid:s,dotSyntax:o,arrSyntax:a,arrIndices:i},n}return null},q.prototype.getChildById=function(t,e){if(this.id===t)return this;if(e)for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildById(t,e);if(r)return r}return null},q.prototype.getChildBySid=function(t,e){if(this.sid===t)return this;if(e)for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n].getChildBySid(t,e);if(r)return r}return null},q.prototype.getTransformBySid=function(t){for(var e=0;e<this.transforms.length;e++)if(this.transforms[e].sid===t)return this.transforms[e];return null},q.prototype.parse=function(t){this.id=t.getAttribute("id"),this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.type=t.getAttribute("type"),this.layer=t.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"node":this.nodes.push((new q).parse(n));break;case"instance_camera":this.cameras.push((new _t).parse(n));break;case"instance_controller":this.controllers.push((new X).parse(n));break;case"instance_geometry":this.geometries.push((new Y).parse(n));break;case"instance_light":this.lights.push((new xt).parse(n));break;case"instance_node":var r=D(n.getAttribute("url").replace(/^#/,""));r&&this.nodes.push((new q).parse(r));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new $).parse(n));break;case"extra":break;default:console.log(n.nodeName)}}return this.channels=function(t){var e=[],n=1e6,r=-1e6;for(var i in g)for(var s=g[i],o=0;o<s.channel.length;o++){var a=s.channel[o],l=s.sampler[o];(i=a.target.split("/")[0])==t.id&&(l.create(),a.sampler=l,n=Math.min(n,l.startTime),r=Math.max(r,l.endTime),e.push(a))}return e.length&&(t.startTime=n,t.endTime=r),e}(this),function(t){if(t.channels&&t.channels.length){for(var e=[],n=[],r=0,i=t.channels.length;r<i;r++){var s,o=t.channels[r],a=o.fullSid,l=o.sampler,c=l.input,u=t.getTransformBySid(o.sid);if(o.arrIndices){s=[];for(var h=0,d=o.arrIndices.length;h<d;h++)s[h]=Dt(o.arrIndices[h])}else s=o.member;if(u)for(-1===n.indexOf(a)&&n.push(a),h=0,d=c.length;h<d;h++){var p=c[h],f=l.getData(u.type,h,s);if(!(v=z(e,p))){v=new vt(p);var m=U(e,p);e.splice(-1===m?e.length:m,0,v)}v.addTarget(a,u,s,f)}else console.log('Could not find transform "'+o.sid+'" in node '+t.id)}for(r=0;r<n.length;r++){var g=n[r];for(h=0;h<e.length;h++){var v;(v=e[h]).hasTarget(g)||F(e,v,h,g)}}t.keys=e,t.sids=n}}(this),this.updateMatrix(),this},q.prototype.updateMatrix=function(){this.matrix.identity();for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(this.matrix)},$.prototype.parse=function(t){return this.sid=t.getAttribute("sid"),this.type=t.nodeName,this.data=Ct(t.textContent),this.convert(),this},$.prototype.convert=function(){switch(this.type){case"matrix":this.obj=kt(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":case"scale":this.data,this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},$.prototype.apply=function(){var t=new THREE.Matrix4;return function(e){switch(this.type){case"matrix":e.multiply(this.obj);break;case"translate":e.multiply(t.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":e.multiply(t.makeRotationAxis(this.obj,this.angle));break;case"scale":e.scale(this.obj)}}}(),$.prototype.update=function(t,e){var n=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(e)if(1===e.length)switch(e[0]){case 0:this.obj.n11=t[0],this.obj.n21=t[1],this.obj.n31=t[2],this.obj.n41=t[3];break;case 1:this.obj.n12=t[0],this.obj.n22=t[1],this.obj.n32=t[2],this.obj.n42=t[3];break;case 2:this.obj.n13=t[0],this.obj.n23=t[1],this.obj.n33=t[2],this.obj.n43=t[3];break;case 3:this.obj.n14=t[0],this.obj.n24=t[1],this.obj.n34=t[2],this.obj.n44=t[3]}else if(2===e.length){var r="n"+(e[0]+1)+(e[1]+1);this.obj[r]=t}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(t);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=n[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=n[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;case"ANGLE":this.angle=THREE.Math.degToRad(t);break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2],this.angle=THREE.Math.degToRad(t[3])}}},X.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1===n.nodeType)switch(n.nodeName){case"skeleton":this.skeleton.push(n.textContent.replace(/^#/,""));break;case"bind_material":for(var r=n.querySelectorAll("instance_material"),i=0;i<r.length;i++){var s=r[i];this.instance_material.push((new J).parse(s))}}}return this},J.prototype.parse=function(t){return this.symbol=t.getAttribute("symbol"),this.target=t.getAttribute("target").replace(/^#/,""),this},Y.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType&&"bind_material"===n.nodeName){for(var r=n.querySelectorAll("instance_material"),i=0;i<r.length;i++){var s=r[i];this.instance_material.push((new J).parse(s))}break}}return this},Z.prototype.parse=function(t){this.id=t.getAttribute("id"),Nt(this,t);for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if("mesh"===n.nodeName)this.mesh=new K(this).parse(n)}return this},K.prototype.parse=function(t){this.primitives=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"source":Tt(n);break;case"vertices":this.vertices=(new it).parse(n);break;case"linestrips":this.primitives.push((new et).parse(n));break;case"triangles":this.primitives.push((new nt).parse(n));break;case"polygons":this.primitives.push((new Q).parse(n));break;case"polylist":this.primitives.push((new tt).parse(n))}}if(this.geometry3js=new THREE.Geometry,null===this.vertices)return this;var r=f[this.vertices.input.POSITION.source].data;for(e=0;e<r.length;e+=3)this.geometry3js.vertices.push(Ot(r,e).clone());for(e=0;e<this.primitives.length;e++){var i=this.primitives[e];i.setVertices(this.vertices),this.handlePrimitive(i,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},K.prototype.handlePrimitive=function(t,e){if(t instanceof et)e.isLineStrip=!0;else{var n,r,i,s,o,a,l,c=t.p,u=t.inputs,h=0,d=3,p=0,m=[];for(n=0;n<u.length;n++){var g=(i=u[n]).offset+1;if("TEXCOORD"===(p=p<g?g:p,i.semantic))m.push(i.set)}for(var v=0;v<c.length;++v)for(var y=c[v],_=0;_<y.length;){var b=[],x=[],w=null,S=[];for(d=t.vcount?t.vcount.length?t.vcount[h++]:t.vcount:y.length/p,n=0;n<d;n++)for(r=0;r<u.length;r++)switch(i=u[r],a=f[i.source],s=y[_+n*p+i.offset],l=a.accessor.params.length,o=s*l,i.semantic){case"VERTEX":b.push(s);break;case"NORMAL":x.push(Ot(a.data,o));break;case"TEXCOORD":void 0===(w=w||{})[i.set]&&(w[i.set]=[]),w[i.set].push(new THREE.Vector2(a.data[o],a.data[o+1]));break;case"COLOR":S.push((new THREE.Color).setRGB(a.data[o],a.data[o+1],a.data[o+2]))}if(0===x.length)if(i=this.vertices.input.NORMAL){l=(a=f[i.source]).accessor.params.length;for(var M=0,E=b.length;M<E;M++)x.push(Ot(a.data,b[M]*l))}else e.calcNormals=!0;if(!w&&(w={},i=this.vertices.input.TEXCOORD)){m.push(i.set),l=(a=f[i.source]).accessor.params.length;for(M=0,E=b.length;M<E;M++)o=b[M]*l,void 0===w[i.set]&&(w[i.set]=[]),w[i.set].push(new THREE.Vector2(a.data[o],1-a.data[o+1]))}if(0===S.length&&(i=this.vertices.input.COLOR)){l=(a=f[i.source]).accessor.params.length;for(M=0,E=b.length;M<E;M++)o=b[M]*l,S.push((new THREE.Color).setRGB(a.data[o],a.data[o+1],a.data[o+2]))}var A,C,P=null,I=[];if(3===d)I.push(new THREE.Face3(b[0],b[1],b[2],x,S.length?S:new THREE.Color));else if(4===d)I.push(new THREE.Face3(b[0],b[1],b[3],[x[0].clone(),x[1].clone(),x[3].clone()],S.length?[S[0],S[1],S[3]]:new THREE.Color)),I.push(new THREE.Face3(b[1],b[2],b[3],[x[1].clone(),x[2].clone(),x[3].clone()],S.length?[S[1],S[2],S[3]]:new THREE.Color));else if(d>4&&T.subdivideFaces){var R=S.length?S:new THREE.Color;for(r=1;r<d-1;)I.push(new THREE.Face3(b[0],b[r],b[r+1],[x[0].clone(),x[r++].clone(),x[r].clone()],R))}if(I.length)for(M=0,E=I.length;M<E;M++)for((P=I[M]).daeMaterial=t.material,e.faces.push(P),r=0;r<m.length;r++)A=w[m[r]],C=d>4?[A[0],A[M+1],A[M+2]]:4===d?0===M?[A[0],A[1],A[3]]:[A[1].clone(),A[2],A[3].clone()]:[A[0],A[1],A[2]],void 0===e.faceVertexUvs[r]&&(e.faceVertexUvs[r]=[]),e.faceVertexUvs[r].push(C);else console.log("dropped face with vcount "+d+" for geometry with id: "+e.id);_+=p*d}}},Q.prototype.setVertices=function(t){for(var e=0;e<this.inputs.length;e++)this.inputs[e].source===t.id&&(this.inputs[e].source=t.input.POSITION.source)},Q.prototype.parse=function(t){this.material=t.getAttribute("material"),this.count=Rt(t,"count",0);for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"input":this.inputs.push((new st).parse(t.childNodes[e]));break;case"vcount":this.vcount=Pt(n.textContent);break;case"p":this.p.push(Pt(n.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},tt.prototype=Object.create(Q.prototype),tt.prototype.constructor=tt,et.prototype=Object.create(Q.prototype),et.prototype.constructor=et,nt.prototype=Object.create(Q.prototype),nt.prototype.constructor=nt,rt.prototype.parse=function(t){this.params=[],this.source=t.getAttribute("source"),this.count=Rt(t,"count",0),this.stride=Rt(t,"stride",0);for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if("param"===n.nodeName){var r={};r.name=n.getAttribute("name"),r.type=n.getAttribute("type"),this.params.push(r)}}return this},it.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++)if("input"===t.childNodes[e].nodeName){var n=(new st).parse(t.childNodes[e]);this.input[n.semantic]=n}return this},st.prototype.parse=function(t){return this.semantic=t.getAttribute("semantic"),this.source=t.getAttribute("source").replace(/^#/,""),this.set=Rt(t,"set",-1),this.offset=Rt(t,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},ot.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"bool_array":this.data=At(n.textContent),this.type=n.nodeName;break;case"float_array":this.data=Ct(n.textContent),this.type=n.nodeName;break;case"int_array":this.data=Pt(n.textContent),this.type=n.nodeName;break;case"IDREF_array":case"Name_array":this.data=It(n.textContent),this.type=n.nodeName;break;case"technique_common":for(var r=0;r<n.childNodes.length;r++)if("accessor"===n.childNodes[r].nodeName){this.accessor=(new rt).parse(n.childNodes[r]);break}}}return this},ot.prototype.read=function(){var t=[],e=this.accessor.params[0];switch(e.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var n=0;n<this.data.length;n+=16){var r=kt(this.data.slice(n,n+16));t.push(r)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+e.type+".")}return t},at.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++)if("instance_effect"===t.childNodes[e].nodeName){this.instance_effect=(new pt).parse(t.childNodes[e]);break}return this},lt.prototype.isColor=function(){return null===this.texture},lt.prototype.isTexture=function(){return null!=this.texture},lt.prototype.parse=function(t){"transparent"===t.nodeName&&(this.opaque=t.getAttribute("opaque"));for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"color":var r=Ct(n.textContent);this.color=new THREE.Color,this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=n.getAttribute("texture"),this.texcoord=n.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(n)}}return this},lt.prototype.parseTexture=function(t){if(!t.childNodes)return this;t.childNodes[1]&&"extra"===t.childNodes[1].nodeName&&((t=t.childNodes[1]).childNodes[1]&&"technique"===t.childNodes[1].nodeName&&(t=t.childNodes[1]));for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?this.texOpts[n.nodeName]=1:this.texOpts[n.nodeName]=parseInt(n.textContent);break;default:this.texOpts[n.nodeName]=n.textContent}}return this},ct.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[n.nodeName]=(new lt).parse(n);break;case"bump":var r=n.getAttribute("bumptype");r?"heightfield"===r.toLowerCase()?this.bump=(new lt).parse(n):"normalmap"===r.toLowerCase()?this.normal=(new lt).parse(n):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+r+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new lt).parse(n)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new lt).parse(n));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var i=n.querySelectorAll("float");i.length>0&&(this[n.nodeName]=parseFloat(i[0].textContent))}}return this.create(),this},ct.prototype.create=function(){var t={},e=!1;if(void 0!==this.transparency&&void 0!==this.transparent){this.transparent;var n=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;n>0&&(e=!0,t.transparent=!0,t.opacity=1-n)}var r={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var i in this)switch(i){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var s=this[i];if(s instanceof lt)if(s.isTexture()){var o=s.texture,a=this.effect.sampler[o];if(void 0!==a&&void 0!==a.source){var c=this.effect.surface[a.source];if(void 0!==c){var u=m[c.init_from];if(u){var h,d=l+u.init_from,p=THREE.Loader.Handlers.get(d);null!==p?h=p.load(d):Lt(h=new THREE.Texture,d),h.wrapS=s.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,h.wrapT=s.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,h.offset.x=s.texOpts.offsetU,h.offset.y=s.texOpts.offsetV,h.repeat.x=s.texOpts.repeatU,h.repeat.y=s.texOpts.repeatV,t[r[i]]=h,"emission"===i&&(t.emissive=16777215)}}}}else("diffuse"===i||!e)&&("emission"===i?t.emissive=s.color.getHex():t[i]=s.color.getHex());break;case"shininess":t[i]=this[i];break;case"reflectivity":t[i]=this[i],t[i]>0&&(t.envMap=T.defaultEnvMap),t.combine=THREE.MixOperation;break;case"index_of_refraction":t.refractionRatio=this[i],1!==this[i]&&(t.envMap=T.defaultEnvMap)}switch(t.shading=E,t.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide,this.type){case"constant":null!=t.emissive&&(t.color=t.emissive),this.material=new THREE.MeshBasicMaterial(t);break;case"phong":case"blinn":null!=t.diffuse&&(t.color=t.diffuse),this.material=new THREE.MeshPhongMaterial(t);break;default:null!=t.diffuse&&(t.color=t.diffuse),this.material=new THREE.MeshLambertMaterial(t)}return this.material},ut.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"init_from":this.init_from=n.textContent;break;case"format":this.format=n.textContent;break;default:console.log("unhandled Surface prop: "+n.nodeName)}}return this},ht.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"source":this.source=n.textContent;break;case"minfilter":this.minfilter=n.textContent;break;case"magfilter":this.magfilter=n.textContent;break;case"mipfilter":this.mipfilter=n.textContent;break;case"wrap_s":this.wrap_s=n.textContent;break;case"wrap_t":this.wrap_t=n.textContent;break;default:console.log("unhandled Sampler2D prop: "+n.nodeName)}}return this},dt.prototype.create=function(){if(null===this.shader)return null},dt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),Nt(this,t),this.shader=null;for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType&&"profile_COMMON"===n.nodeName)this.parseTechnique(this.parseProfileCOMMON(n))}return this},dt.prototype.parseNewparam=function(t){for(var e=t.getAttribute("sid"),n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1==r.nodeType)switch(r.nodeName){case"surface":this.surface[e]=new ut(this).parse(r);break;case"sampler2D":this.sampler[e]=new ht(this).parse(r);break;case"extra":break;default:console.log(r.nodeName)}}},dt.prototype.parseProfileCOMMON=function(t){for(var e,n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":e=r;break;case"newparam":this.parseNewparam(r);break;case"image":var i=(new B).parse(r);m[i.id]=i;break;case"extra":break;default:console.log(r.nodeName)}}return e},dt.prototype.parseTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new ct(n.nodeName,this).parse(n);break;case"extra":this.parseExtra(n)}}},dt.prototype.parseExtra=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType&&"technique"===n.nodeName)this.parseExtraTechnique(n)}},dt.prototype.parseExtraTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType&&"bump"===n.nodeName)this.shader.parse(t)}},pt.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},ft.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.source={};for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"animation":var r=(new ft).parse(n);for(var i in r.source)this.source[i]=r.source[i];for(var s=0;s<r.channel.length;s++)this.channel.push(r.channel[s]),this.sampler.push(r.sampler[s]);break;case"source":i=(new ot).parse(n);this.source[i.id]=i;break;case"sampler":this.sampler.push(new gt(this).parse(n));break;case"channel":this.channel.push(new mt(this).parse(n))}}return this},mt.prototype.parse=function(t){this.source=t.getAttribute("source").replace(/^#/,""),this.target=t.getAttribute("target");var e=this.target.split("/");e.shift();var n=e.shift(),r=n.indexOf(".")>=0,i=n.indexOf("(")>=0;if(r)e=n.split("."),this.sid=e.shift(),this.member=e.shift();else if(i){var s=n.split("(");this.sid=s.shift();for(var o=0;o<s.length;o++)s[o]=parseInt(s[o].replace(/\)/,""));this.arrIndices=s}else this.sid=n;return this.fullSid=n,this.dotSyntax=r,this.arrSyntax=i,this},gt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.inputs=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType&&"input"===n.nodeName)this.inputs.push((new st).parse(n))}return this},gt.prototype.create=function(){for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],n=this.animation.source[e.source];switch(e.semantic){case"INPUT":this.input=n.read();break;case"OUTPUT":this.output=n.read(),this.strideOut=n.accessor.stride;break;case"INTERPOLATION":this.interpolation=n.read();break;case"IN_TANGENT":case"OUT_TANGENT":break;default:console.log(e.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(t=0;t<this.input.length;t++)this.startTime=Math.min(this.startTime,this.input[t]),this.endTime=Math.max(this.endTime,this.input[t]);this.duration=this.endTime-this.startTime}},gt.prototype.getData=function(t,e,n){var r;if("matrix"===t&&16===this.strideOut)r=this.output[e];else if(this.strideOut>1){r=[],e*=this.strideOut;for(var i=0;i<this.strideOut;++i)r[i]=this.output[e+i];3===this.strideOut||this.strideOut}else r=this.output[e],n&&"translate"===t&&(r=function(t,e){return e}(0,r));return r},vt.prototype.addTarget=function(t,e,n,r){this.targets.push({sid:t,member:n,transform:e,data:r})},vt.prototype.apply=function(t){for(var e=0;e<this.targets.length;++e){var n=this.targets[e];(!t||n.sid===t)&&n.transform.update(n.data,n.member)}},vt.prototype.getTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return this.targets[e];return null},vt.prototype.hasTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return!0;return!1},vt.prototype.interpolate=function(t,e){for(var n=0,r=this.targets.length;n<r;n++){var i,s=this.targets[n],o=t.getTarget(s.sid);if("matrix"!==s.transform.type&&o){var a=(e-this.time)/(t.time-this.time),l=o.data,c=s.data;if(a<0&&(a=0),a>1&&(a=1),c.length){i=[];for(var u=0;u<c.length;++u)i[u]=c[u]+(l[u]-c[u])*a}else i=c+(l-c)*a}else i=s.data;s.transform.update(i,s.member)}},yt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType&&"optics"===n.nodeName)this.parseOptics(n)}return this},yt.prototype.parseOptics=function(t){for(var e=0;e<t.childNodes.length;e++)if("technique_common"===t.childNodes[e].nodeName)for(var n=t.childNodes[e],r=0;r<n.childNodes.length;r++)if(this.technique=n.childNodes[r].nodeName,"perspective"===this.technique)for(var i=n.childNodes[r],s=0;s<i.childNodes.length;s++){switch((a=i.childNodes[s]).nodeName){case"yfov":this.yfov=a.textContent;break;case"xfov":this.xfov=a.textContent;break;case"znear":this.znear=a.textContent;break;case"zfar":this.zfar=a.textContent;break;case"aspect_ratio":this.aspect_ratio=a.textContent}}else if("orthographic"===this.technique){var o=n.childNodes[r];for(s=0;s<o.childNodes.length;s++){var a;switch((a=o.childNodes[s]).nodeName){case"xmag":this.xmag=a.textContent;break;case"ymag":this.ymag=a.textContent;break;case"znear":this.znear=a.textContent;break;case"zfar":this.zfar=a.textContent;break;case"aspect_ratio":this.aspect_ratio=a.textContent}}}return this},_t.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},bt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"technique_common":this.parseCommon(n);break;case"technique":this.parseTechnique(n)}}return this},bt.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++)switch(t.childNodes[e].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=t.childNodes[e].nodeName;for(var n=t.childNodes[e],r=0;r<n.childNodes.length;r++){var i=n.childNodes[r];switch(i.nodeName){case"color":var s=Ct(i.textContent);this.color=new THREE.Color(0),this.color.setRGB(s[0],s[1],s[2]),this.color.a=s[3];break;case"falloff_angle":this.falloff_angle=parseFloat(i.textContent);break;case"quadratic_attenuation":var o=parseFloat(i.textContent);this.distance=o?Math.sqrt(1/o):0}}}return this},bt.prototype.parseTechnique=function(t){this.profile=t.getAttribute("profile");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if("intensity"===n.nodeName)this.intensity=parseFloat(n.textContent)}return this},xt.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},wt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.joints=[],this.links=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType&&"technique_common"===n.nodeName)this.parseCommon(n)}return this},wt.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(t.childNodes[e].nodeName){case"joint":this.joints.push((new St).parse(n));break;case"link":this.links.push((new Mt).parse(n))}}return this},St.prototype.parse=function(t){this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var e=Ct(t.querySelector("axis").textContent);this.axis=Ot(e,0);var n=t.querySelector("limits min")?parseFloat(t.querySelector("limits min").textContent):-360,r=t.querySelector("limits max")?parseFloat(t.querySelector("limits max").textContent):360;this.limits={min:n,max:r};for(var i=["prismatic","revolute"],s=0;s<i.length;s++){var o=i[s];t.querySelector(o)&&(this.type=o)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},Mt.prototype.parse=function(t){this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.transforms=[],this.attachments=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"attachment_full":this.attachments.push((new Et).parse(n));break;case"rotate":case"translate":case"matrix":this.transforms.push((new $).parse(n))}}return this},Et.prototype.parse=function(t){this.joint=t.getAttribute("joint").split("/").pop(),this.links=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"link":this.links.push((new Mt).parse(n));break;case"rotate":case"translate":case"matrix":this.transforms.push((new $).parse(n))}}return this},{load:function(t,e,n,r){p=e,C((new DOMParser).parseFromString(t,"application/xml"),void 0,t)},parse:C,setPreferredShading:function(t){E=t},applySkin:O,geometries:_,options:T}},p_=class{constructor(t,e,n){this.target=new Yi(0,0,0),this.position=new Yi(0,0,0),this.curPosition=new Yi(0,0,0),this.quaternion=new Ji(0,0,0,0),this.load=async function(){let t=new gy;return new Promise(((e,n)=>{t.load(this.url,(async t=>{if(this.model=await((t,e,n,r)=>new Promise(((i,s)=>{let o=new t.Object3D,a=new t.Group;(new h_).parse(e,(e=>{let s=e.textures[0].data,l=new t.Texture,c=new Blob([s],{type:"image/png"});createImageBitmap(c).then((function(t){l.image=t,l.needsUpdate=!0})),(new d_).load(e.data,(t=>{var e,s,c,u;let h=null==(s=null==(e=t.scene.children[0].children[0])?void 0:e.children[1])?void 0:s.children[0];h&&(h.rotation.set(0,3.14,0),h.material.map=l);let d=null==(u=null==(c=t.scene.children[0].children[0])?void 0:c.children[2])?void 0:u.children[0];if(d){d.rotation.set(0,3.14,0);let t=d.material;if(!t)return;t.map=l,t.transparent=!0}a.add(t.scene),a.scale.set(n,n,n),a.position.set(0,r,0),o.add(a),i(o)}))}),{upAxis:"Y_UP",unitName:"meter",unitMeter:1})})))(THREE,t.scene,this.scale,this.height),!this.model)throw new Error("error creating avatar in forge");e(this.model)}),void 0,(t=>{console.error("An error happened loading the avatar",t),n(t)}))}))},this.url=t,this.scale=e,this.height=n,this.clock=new Nd,this.clock.start(),this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this))}setPosition(t){!t||0===t.x&&0===t.y&&0===t.z||this.position.set(t.x,t.y,t.z)}setQuaternion(t){t&&this.quaternion.set(t._x,t._y,t._z,t._w)}destroy(){cancelAnimationFrame(this.lerpAnimationFrame),this.model.parent.remove(this.model)}animate(){if(this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this)),!this.model||!this.position||!this.quaternion)return;let t=2*this.clock.getDelta();this.curPosition.lerp(this.position,t),this.model.position.set(this.curPosition.x,this.curPosition.y,this.curPosition.z);let e=this.model.quaternion.clone();e.slerp(this.quaternion,t),this.model.quaternion.set(e.x,e.y,e.z,e.w)}},f_=class{constructor(t,e,n,r){if(this.load=async()=>new Promise((t=>{let e=document.createElement("script");window._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},e.setAttribute("src","https://production.storage.superviz.com/static/fonts/OpenSans.js"),e.onload=async()=>{let e=await this.createTextGeometry(this.name,this.textColor);e.position.set(0,this.height,0),this.mesh=e,this.renderFrame=requestAnimationFrame(this.render.bind(this)),t(e)},document.body.appendChild(e)})),this.createTextGeometry=async(t,e)=>{let n=new THREE.TextGeometry(t,{font:"open sans",size:.08,height:0,curveSegments:3});n.computeBoundingBox();let r=new THREE.MeshBasicMaterial({color:e}),i=new THREE.Mesh(n,r);return i.geometry.center(),this.createBackground(i,this.backgroundColor),i},this.createBackground=async(t,e)=>{let n=(new THREE.Box3).setFromObject(t),r=new THREE.Vector3(0,0,0);n.getSize(r);let{x:i,y:s}=r,o=-(i/2+.06),a=-(s/2+.03)-.002,l=i+.12,c=s+.06,u=.078,h=new ih;h.moveTo(o,a+u),h.lineTo(o,a+c-u),h.quadraticCurveTo(o,a+c,o+u,a+c),h.lineTo(o+l-u,a+c),h.quadraticCurveTo(o+l,a+c,o+l,a+c-u),h.lineTo(o+l,a+u),h.quadraticCurveTo(o+l,a,o+l-u,a),h.lineTo(o+u,a),h.quadraticCurveTo(o,a,o,a+u);let d=new THREE.ShapeGeometry(h),p=new THREE.MeshBasicMaterial({color:e,side:THREE.DoubleSide}),f=new THREE.Mesh(d,p);t.add(f),f.position.set(0,0,-.01)},this.name=t,this.viewer=r,e)this.backgroundColor=e.color,this.textColor=e.textColor;else{let t="#878291";this.textColor="#fff",this.backgroundColor=t}this.height=n,this.slot=e}render(){if(this.renderFrame=requestAnimationFrame(this.render.bind(this)),this.viewer&&this.mesh){let t=this.viewer.getCamera();this.curQuaternion=this.mesh.parent.quaternion.clone().invert().multiply(t.quaternion.clone()),this.mesh.setRotationFromQuaternion(this.curQuaternion)}}destroy(){cancelAnimationFrame(this.renderFrame)}},m_=class{constructor(t,e,n){this.position=new THREE.Vector3(0,0,0),this.quaternion=new THREE.Quaternion(0,0,0,0),this.mousePosition=new THREE.Vector3(0,0,0),this.lerpedMousePosition=new THREE.Vector3(0,0,0),this.slot=null,this.material=new THREE.MeshBasicMaterial,this.viewer=t,this.laserOrigin=n,this.clock=new Nd,this.clock.start(),this.isDestroyed=!1,this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this)),this.generateMaterial(e)}destroy(){this.isDestroyed=!0,cancelAnimationFrame(this.lerpAnimationFrame),this.mesh&&(this.viewer.overlays.removeMesh(this.mesh,"avatars-scene"),this.mesh.geometry.dispose(),this.mesh=null)}setAvatar(t){t&&(this.avatar=t)}setMousePosition(t){t&&this.mousePosition.set(t.x,t.y,t.z)}setColorIndex(t){t!==this.slot&&void 0!==t&&(this.generateMaterial(t),this.slot=t)}animate(){let t=this.clock.getDelta();if(setTimeout((()=>{this.isDestroyed||(this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this)))}),50),!this.avatar||(this.mesh&&(this.mesh.geometry.dispose(),this.viewer.overlays.removeMesh(this.mesh,"avatars-scene")),this.position=this.avatar.model.position,this.quaternion=this.avatar.model.quaternion,!this.position||!this.mousePosition||!this.quaternion||!this.material))return;let e=new THREE.Vector3(this.position.x,this.position.y,this.position.z),n=new THREE.Vector3(this.laserOrigin.x,this.laserOrigin.y,this.laserOrigin.z).applyQuaternion(new THREE.Quaternion(this.quaternion.x,this.quaternion.y,this.quaternion.z,this.quaternion.w));e.add(n.multiplyScalar(1)),this.lerpedMousePosition.lerp(this.mousePosition,t/1e3*1e3);let r=new THREE.LineCurve3(e,new THREE.Vector3(this.lerpedMousePosition.x,this.lerpedMousePosition.y,this.lerpedMousePosition.z)),i=new THREE.TubeGeometry(r,3,.005,4,!1);this.mesh=new THREE.Mesh(i,this.material),this.viewer.overlays.hasScene("avatars-scene")&&this.viewer.overlays.addMesh(this.mesh,"avatars-scene")}createTextureCanvas(){let t=document.createElement("canvas"),e=t.getContext("2d");t.width=1,t.height=64;let n=e.createLinearGradient(0,0,t.width,t.height);return n.addColorStop(0,"rgba(  0,  0,  0,0.2)"),n.addColorStop(.1,"rgba(160,160,160,0.5)"),n.addColorStop(.5,"rgba(255,255,255,0.8)"),n.addColorStop(.9,"rgba(160,160,160,0.5)"),n.addColorStop(1,"rgba(  0,  0,  0,0.2)"),e.fillStyle=n,e.fillRect(0,0,t.width,t.height),t}generateMaterial(t){let e=(null==t?void 0:t.color)??"#878291",n=this.createTextureCanvas(),r=new THREE.Texture(n);r.needsUpdate=!0,this.material=new THREE.MeshBasicMaterial({map:r,blending:THREE.AdditiveBlending,color:e,side:THREE.DoubleSide,depthWrite:!1,transparent:!1})}},g_=(t,e)=>{let n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return Math.sqrt(n*n+r*r+i*i)},v_=class{constructor(t,e){this.destPos=new THREE.Vector3(0,0,0),this.curScreenPos=new THREE.Vector2(0,0),this.slot=null,this.update=(t,e)=>{void 0!==e&&(this.slot=e),t&&(0!==t.x||0!==t.y||0!==t.z)&&(this.destPos.x=t.x,this.destPos.y=t.y,this.destPos.z=t.z)},this.clock=new Nd,this.viewer=t,this.userId=e,this.renderFrame=requestAnimationFrame(this.render.bind(this)),this.renderDivWrapper()}async load(t,e){if(t&&void 0!==e)return new Promise((()=>{let n=`https://production.cdn.superviz.com/static/mouse-pointers/${e.colorName}.svg`,r=document.createElement("div");r.setAttribute("id",`mouse_${this.userId}`),r.setAttribute("style",`background-image:url('${n}')`),r.style.position="absolute",r.style.zIndex="3",r.style.width="15px",r.style.height="15px",r.style.pointerEvents="none",r.style.transition="all 75ms ease",r.style.top="-100px",r.style.left="-100px",this.mousesWrapper.appendChild(r);let i=document.createElement("div");if(!t.trim().length)return;let s=(null==e?void 0:e.color)??"#878291";i.setAttribute("style",`background-color:${s}`),i.style.borderRadius="30px",i.style.fontSize="14px",i.style.fontWeight="700",i.style.zIndex="3",i.style.fontWeight="600",i.style.fontFamily="Open Sans",i.style.width="fit-content",i.style.whiteSpace="nowrap",i.innerHTML+=t,i.style.marginLeft="12px",i.style.marginTop="9px",i.style.pointerEvents="none",i.style.color=(null==e?void 0:e.textColor)??"#fff",i.style.padding="2px 8px 2px 8px",r.appendChild(i)}))}destroy(){cancelAnimationFrame(this.renderFrame),document.getElementById(`mouse_${this.userId}`).remove()}async render(){if(this.renderDivWrapper(),this.renderFrame=requestAnimationFrame(this.render.bind(this)),0===this.destPos.x&&0===this.destPos.y)return;let t=this.clock.getDelta(),e=this.viewer.worldToClient(this.destPos),n=1,r=this.viewer.utilities.getHitPoint(e.x/this.mousesWrapper.clientWidth,e.y/this.mousesWrapper.clientHeight);if(r){let t=this.viewer.navigation.getPosition(),e=g_(r,t),i=g_(this.destPos,t);Math.abs(i-e)>1&&(n=.2)}if(e){this.curScreenPos.lerp(e,t/100*2e3);let r=this.curScreenPos.y,i=this.curScreenPos.x;0===r&&0===i&&(n=0);let s=document.getElementById(`mouse_${this.userId}`);s?(s.style.top=`${r}px`,s.style.left=`${i}px`,s.style.opacity=`${n}`):console.warn("no mouse element")}}renderDivWrapper(){let t=this.viewer.canvas.getBoundingClientRect(),e=document.getElementById("superviz-autodesk-mouse-wrapper");e||(e=document.createElement("div"),e.id="superviz-autodesk-mouse-wrapper"),e.style.position="absolute",e.style.top=`${this.viewer.canvas.offsetTop}px`,e.style.left=`${this.viewer.canvas.offsetLeft}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden","static"===this.viewer.canvas.parentElement.style.position&&(this.viewer.canvas.parentElement.style.position="relative"),document.getElementById("superviz-autodesk-mouse-wrapper")||this.viewer.canvas.parentElement.appendChild(e),this.mousesWrapper=e}},y_=qn(Yn()),__=class{constructor(t){this.debug=(0,y_.default)(t)}log(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.debug(t,...n)}},b_=qn(hr()),x_=class{constructor(){var t=this;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.subscribe=t=>{this.callbacks.push(t)},this.unsubscribe=t=>{this.callbacks=this.callbacks.filter((e=>e!==t))},this.publish=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.callbacks&&t.callbacks.forEach((e=>{t.callListener(e,n).catch((r=>{t.logger.log("superviz-sdk:observer-helper:publish:error",`\n            Failed to execute callback on publish value.\n            Callback: ${e}\n            Event: ${JSON.stringify(n)}\n            Error: ${r}\n          `)}))}))},this.reset=()=>{this.callbacks=[]},this.destroy=()=>{delete this.logger,delete this.callbacks},this.callListener=(t,e)=>new Promise(((n,r)=>{try{n(t(...e))}catch(i){r(i)}}));let{logger:n,throttleTime:r}=e;this.logger=n??new __("@superviz/sdk/observer-helper"),this.throttle=r,this.callbacks=[],this.throttle&&(this.publish=(0,b_.default)(this.publish,this.throttle))}},w_=qn(Yn()),S_=class{constructor(t){this.debug=(0,w_.default)(t)}log(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.debug(t,...n)}},M_="https://production.storage.superviz.com/readyplayerme/1.glb",E_="global-store",T_="presence-3d-store";function A_(e){let{pin:n,children:r,onPinActive:i,onPinInactive:s,onMount:o,onUnmount:a,...l}=e;const{room:c,component:u,addComponent:h}=zn("comments"),[d,p]=(0,t.useState)(null),f={"pin-mode.active":i,"pin-mode.inactive":s,mount:o,unmount:a};return(0,t.useEffect)((()=>{u&&Object.entries(f).forEach((t=>{let[e,n]=t;u.unsubscribe(e,n),n&&u.subscribe(e,n)}))}),[u,c,i,s,o,a]),(0,t.useEffect)((()=>{if(!c||d||!n)return;const t=new Cn.M(n,{...l});h(t),p(Date.now())}),[c,n]),(0,t.useEffect)((()=>{!u&&d&&p(null)}),[u]),r??Ln.jsx(Ln.Fragment,{})}typeof window<"u"&&(window.Presence3D=class{constructor(t,e){if(this.participants=[],this.isAttached=!1,this.avatars={},this.lasers={},this.names={},this.mouses={},this.positionInfos={},this.renderSilentInterval=null,this.lastSyncedData={},this.unsubscribeFrom=[],this.roomParticipants={},this.hasJoinedRoom=!1,this.hasJoined3D=!1,this.attach=t=>{if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){let t="autodesk-viewer component @ attach - params are required";throw this.logger.log(t),new Error(t)}this.logger.log("attached");let{eventBus:e,useStore:n,ioc:r,Presence3DManagerService:i}=t;this.useStore=n.bind(this),this.room=r.createRoom(this.name),this.presence3DManager=new i(this.room,this.useStore);let{localParticipant:s,hasJoinedRoom:o}=this.useStore(E_);s.subscribe(),o.subscribe();let{hasJoined3D:a,participants:l}=this.useStore(T_);a.subscribe(),l.subscribe(this.onParticipantsUpdated),this.isAttached=!0,this.eventBus=e,this.start()},this.detach=()=>{this.isAttached?(this.logger.log("detached"),this.destroy(),this.unsubscribeFrom.forEach((t=>t(this))),this.localParticipant=void 0,this.isAttached=!1):this.logger.log("autodesk-viewer component @ detach - component is not attached}")},this.destroy=()=>{this.unsubscribeToRealtimeEvents(),this.unsubscribeToEventBusEvents(),this.room.disconnect(),this.room=void 0,this.participants.forEach((t=>{this.presence3DManager.unsubscribeFromUpdates(t.id,this.onParticipantUpdated)})),this.presence3DManager=void 0,this.useStore(T_).destroy(),this.useStore=void 0,this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this.viewer.canvas.removeEventListener("mousemove",this.onMouseMove),clearInterval(this.renderSilentInterval),this.participants.forEach((t=>{this.removeParticipant(t,!0)})),this.avatars={},this.lasers={},this.mouses={},this.positionInfos={},this.viewer.overlays.clearScene("avatars-scene"),this.viewer.overlays.removeScene("avatars-scene")},this.start=()=>{if(!this.hasJoinedRoom||!this.hasJoined3D)return this.logger.log("matterport component @ start - not joined yet"),void setTimeout((()=>{this.logger.log("matterport component @ start - retrying"),this.start()}),1e3);this.subscribeToRealtimeEvents(),this.subscribeToEventBusEvents(),this.createParticipantList(),this.renderSilentInterval=setInterval(this.renderSilent,1),this.sync()},this.subscribeToRealtimeEvents=()=>{this.logger.log("autodesk-viewer component @ subscribeToRealtimeEvents"),this.room.on("participant-joined",this.onParticipantJoined),this.room.presence.on("presence.leave",this.onParticipantLeave),this.room.on("gather",this.onGatherUpdate),this.room.on("follow-me",this.onFollowParticipantUpdate)},this.unsubscribeToRealtimeEvents=()=>{this.logger.log("autodesk-viewer component @ unsubscribeToRealtimeEvents"),this.room.presence.off("presence.leave"),this.room.off("participant-joined",this.onParticipantJoined),this.room.off("gather",this.onGatherUpdate),this.room.off("follow-me",this.onFollowParticipantUpdate)},this.subscribeToEventBusEvents=()=>{this.logger.log("autodesk-viewer component @ subscribeToEventBusEvents"),this.eventBus.subscribe("realtime.go-to-participant",this.goTo),this.eventBus.subscribe("realtime.local-follow-participant",this.localFollow),this.eventBus.subscribe("realtime.follow-participant",this.follow),this.eventBus.subscribe("realtime.private-mode",this.setPrivate)},this.unsubscribeToEventBusEvents=()=>{this.logger.log("autodesk-viewer component @ unsubscribeToEventBusEvents"),this.eventBus.unsubscribe("realtime.go-to-participant",this.goTo),this.eventBus.unsubscribe("realtime.local-follow-participant",this.localFollow),this.eventBus.unsubscribe("realtime.follow-participant",this.follow),this.eventBus.unsubscribe("realtime.private-mode",this.setPrivate)},this.onParticipantJoined=t=>{if(!t.data)return;this.logger.log("autodesk-viewer component @ onParticipantJoined",t);let{id:e,name:n,avatar:r,avatarConfig:i,type:s,slot:o}=t.data;e!==this.localFollowParticipantId?this.addParticipant({id:e,name:n,avatar:r,avatarConfig:i,type:s,slot:o,isPrivate:!1}):this.onLocalParticipantJoined(t.data)},this.onLocalParticipantJoined=t=>{var e,n,r,i;this.config.avatarConfig&&this.presence3DManager.setParticipantData({avatarConfig:this.config.avatarConfig}),null!=(e=t.avatar)&&e.model3DUrl&&this.presence3DManager.setParticipantData({avatar:{model3DUrl:null==t?void 0:t.avatar.model3DUrl,imageUrl:null==(n=null==t?void 0:t.avatar)?void 0:n.imageUrl}}),null!=(r=t.avatar)&&r.model3DUrl||this.presence3DManager.setParticipantData({avatar:{model3DUrl:M_,imageUrl:null==(i=null==t?void 0:t.avatar)?void 0:i.imageUrl}})},this.onParticipantLeave=t=>{this.logger.log("autodesk-viewer component @ onParticipantLeave",t);let e=this.participants.find((e=>e.id===t.id));delete this.roomParticipants[t.id],e&&this.removeParticipant(e,!0)},this.onParticipantUpdated=t=>{this.logger.log("autodesk-viewer component @ onParticipantUpdated",t);let{id:e,name:n,avatar:r,avatarConfig:i,position:s,rotation:o,type:a,slot:l}=t;this.updateParticipant({position:s,rotation:o,id:e,name:n,avatar:r,avatarConfig:i,type:a,slot:l}),(this.localFollowParticipantId||this.followParticipantId)&&this.moveToAnotherParticipant(this.localFollowParticipantId??this.followParticipantId)},this.updateParticipant=t=>{var e,n;if(!this.participants||0===this.participants.length||!t||!t.id)return;let r=this.participants.find((e=>e.id===t.id));if(r){if((null==(e=r.avatar)?void 0:e.model3DUrl)===(null==(n=t.avatar)?void 0:n.model3DUrl)&&(0,dr.isEqual)(r.avatarConfig,t.avatarConfig)&&r.name===t.name){let e=this.participants.findIndex((e=>e.id===t.id));-1!==e&&(this.participants[e]=t)}else this.removeParticipant(t,!0),this.addParticipant(t);this.logger.log("autodesk-viewer component @ updateParticipant",{participant:t,participants:this.participants})}else this.addParticipant(t)},this.onFollowParticipantUpdate=t=>{t.data.id!==this.localParticipantId&&(this.logger.log("three js component @ onFollowParticipantUpdate",t.data.id),this.followParticipantId=t.data.id,this.moveToAnotherParticipant(t.data.id))},this.onGatherUpdate=t=>{this.logger.log("three js component @ onGatherUpdate",t.data.id),t.data.id!==this.localParticipantId&&this.eventBus.publish("realtime.go-to-participant",t.data.id)},this.createParticipantList=()=>{let t=this.useStore(T_).participants.value;Object.values(t).forEach((t=>{t.isPrivate||this.addParticipant(t)})),this.logger.log("autodesk-viewer component @ createParticipantList",this.participants)},this.createParticipantOn3D=t=>{let{id:e,name:n,avatar:r,avatarConfig:i,type:s,isPrivate:o,slot:a}=t,l={id:e,name:n,avatar:r,isPrivate:o,isAudience:"audience"===s,avatarConfig:e===this.localParticipantId?this.config.avatarConfig:i,position:{x:0,y:0,z:0},rotation:{x:0,y:0},slot:a};return this.logger.log("autodesk-viewer component @ createParticipantOn3D",l),l},this.removeParticipant=(t,e)=>{var n;this.logger.log("autodesk-viewer component @ removeParticipant",{participant:t,unsubscribe:e}),this.participants=this.participants.filter((e=>e.id!==t.id)),this.destroyAvatar(t),this.destroyLaser(t),this.destroyMouse(t),e&&(null==(n=this.presence3DManager)||n.unsubscribeFromUpdates(t.id,this.onParticipantUpdated))},this.addParticipant=async t=>{if(!t||!t.id||"audience"===t.type)return;let e=this.createParticipantOn3D(t);if(this.participants.find((t=>t.id===e.id)))return this.logger.log("autodesk-viewer component @ addParticipant - participant already exists"),void this.onParticipantUpdated(t);this.roomParticipants[t.id]=t,this.participants.push(e),this.logger.log("autodesk-viewer component @ addParticipant",{participant:t,participantOn3D:e,participants:this.participants}),this.presence3DManager.subscribeToUpdates(e.id,this.onParticipantUpdated),this.create3dPresence(e)},this.goTo=t=>{this.logger.log("autodesk-viewer component @ goTo",t),this.moveToAnotherParticipant(t)},this.gather=()=>{this.logger.log("autodesk-viewer component @ gather"),this.room.emit("gather",{id:this.localParticipant.id})},this.setPrivate=t=>{this.logger.log("autodesk-viewer component @ private mode"),this.presence3DManager.updatePresence3D({id:this.localParticipantId,isPrivate:!!t}),this.isPrivate=!!t},this.follow=t=>{this.logger.log("autodesk-viewer component @ follow"),this.room.emit("follow-me",{id:t})},this.localFollow=t=>{this.localFollowParticipantId=t},this.onCameraChanged=()=>{this.isAttached&&(this.viewer.impl.overlayScenes["avatars-scene"]&&this.viewer.impl.requestSilentRender(),this.sync())},this.renderSilent=()=>{if(this.viewer.impl.overlayScenes["avatars-scene"]){this.viewer.impl.requestSilentRender();let t=!1,e=[];Object.values(this.avatars).forEach((n=>{null!=n&&n.model&&this.lastSyncedData.position.distanceTo(n.model.position)<1&&(t=!0,e.push(n))})),t?e.forEach((t=>{null!=t&&t.model&&(t.model.visible=!1)})):Object.values(this.avatars).forEach((t=>{null!=t&&t.model&&(t.model.visible=!0)}))}},this.onParticipantsUpdated=t=>{Object.values(t).forEach((e=>{if(!this.isAttached||e.id===this.localParticipantId)return;this.roomParticipants={},t.forEach((t=>{this.roomParticipants[t.id]=t}));let n=e.id,r=this.avatars[n],i=this.lasers[n],s=this.mouses[n],{slot:o}=e,{position:a,quaternion:l,target:c,mouse:u,isPrivate:h}=e;this.positionInfos[e.id]={position:a,quaternion:l,target:c},h&&this.avatars[n]&&this.removeParticipant(e,!0),!h&&!this.avatars[n]&&this.addParticipant(e),r&&(r.setPosition(a),r.setQuaternion(l),r.target=c),i&&(i.setAvatar(r),i.setMousePosition(u),i.setColorIndex(o)),s&&this.mouses[n].update(u,o)}))},this.onMouseMove=t=>{var e;if(!this.viewer||!THREE)return;let n=this.viewer.clientToWorld(t.offsetX,t.offsetY,!1);null!==n&&(this.lastSyncedData.mouse=n.point,null==(e=this.presence3DManager)||e.updatePresence3D({id:this.localParticipantId,...this.lastSyncedData}))},typeof window>"u")throw new Error("[SuperViz] Presence3D cannot be initialized in a non-browser environment. Window is not defined");if(!t)throw new Error("autodesk viewer instance is required");this.name="presence3dAutodesk",this.logger=new S_("@superviz/sdk/autodesk-viewer-component"),this.logger.log("autodesk-viewer component @ constructor",{viewer:t,options:e}),this.config={isAvatarsEnabled:(null==e?void 0:e.isAvatarsEnabled)??!0,isLaserEnabled:(null==e?void 0:e.isLaserEnabled)??!0,isNameEnabled:(null==e?void 0:e.isNameEnabled)??!0,isMouseEnabled:(null==e?void 0:e.isMouseEnabled)??!0,avatarConfig:null==e?void 0:e.avatarConfig},this.logger.log("autodesk-viewer component @ constructor - config",this.config),this.viewer=t,this.viewer.canvas.addEventListener("mousemove",this.onMouseMove),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged)}get localParticipantId(){var t;return null==(t=this.localParticipant)?void 0:t.id}async create3dPresence(t){if(t.id!==this.localParticipantId){if(this.config.isAvatarsEnabled){let e=await this.createAvatar(t);this.config.isNameEnabled&&this.createName(t,e)}this.config.isMouseEnabled&&this.createMouse(t),this.config.isLaserEnabled&&this.createLaser(t)}}async createAvatar(t){var e,n,r;if(this.logger.log("autodesk-viewer component @ createAvatar",t),!this.isAttached||t.id===this.localParticipantId)return;this.avatars[t.id]&&this.avatars[t.id].destroy();let i=(null==(e=t.avatarConfig)?void 0:e.scale)||1,s=(null==(n=t.avatarConfig)?void 0:n.height)||0,o=(null==(r=t.avatar)?void 0:r.model3DUrl)??M_,a=new p_(o,i,s),l=await a.load();return this.viewer.overlays.hasScene("avatars-scene")||this.viewer.overlays.addScene("avatars-scene"),this.viewer.overlays.addMesh(l,"avatars-scene"),this.avatars[t.id]=a,l}async destroyAvatar(t){this.avatars[t.id]&&(this.names[t.id]&&(this.names[t.id].destroy(),this.names[t.id]=null),this.avatars[t.id].destroy(),delete this.avatars[t.id],this.avatars[t.id]=null)}createLaser(t){var e;if(!this.isAttached)return;let n=new Yi(0,0,0);null!=(e=t.avatarConfig)&&e.laserOrigin&&(n=new Yi(t.avatarConfig.laserOrigin.x,t.avatarConfig.laserOrigin.y,t.avatarConfig.laserOrigin.z));let{slot:r}=this.roomParticipants[t.id];this.lasers[t.id]=new m_(this.viewer,r,n)}async destroyLaser(t){this.lasers[t.id]&&(this.lasers[t.id].destroy(),delete this.lasers[t.id],this.lasers[t.id]=null)}async createName(t,e){if(this.logger.log("autodesk-viewer component @ createName",t),!t.name.trim().length)return;let n=(new THREE.Box3).setFromObject(e),r=new Yi(0,0,0);n.getSize(r);let i=t.slot??this.roomParticipants[t.id].slot,s=n.min.y+1.25*r.y,o=new f_(t.name,i,s,this.viewer),a=await o.load();e.add(a),this.names[t.id]=o}async createMouse(t){if(!this.isAttached)return;let{slot:e}=this.roomParticipants[t.id],n=new v_(this.viewer,t.id);this.mouses[t.id]=n,n.load(t.name,e)}async destroyMouse(t){this.mouses[t.id]&&(this.mouses[t.id].destroy(),delete this.mouses[t.id])}moveToAnotherParticipant(t){if(!this.positionInfos[t]||!this.isAttached)return;let{position:e,target:n}=this.positionInfos[t];if(!n||!e)return;let r=new Yi(e.x,e.y,e.z),i=new Yi(n.x,n.y,n.z),s=this.viewer.navigation.getCamera();this.viewer.navigation.setRequestTransition(!0,r,i,s.fov,!0,s.pivot)}sync(){var t,e,n,r,i,s;if(!this.viewer||!this.isAttached)return;let o=null==(e=null==(t=this.viewer)?void 0:t.navigation)?void 0:e.getPosition(),a=null==(r=null==(n=this.viewer)?void 0:n.navigation)?void 0:r.getTarget(),l=null==(s=null==(i=this.viewer)?void 0:i.navigation)?void 0:s.getCamera(),{quaternion:c}=l;if(this.lastSyncedData.position=o,this.lastSyncedData.target=a,this.lastSyncedData.quaternion=c,this.isPrivate)return;let u=this.participants.find((t=>t.id===this.localParticipantId));if(null!=u&&u.position){let t=Math.abs(u.position.x-o.x)<.1,e=Math.abs(u.position.y-o.y)<.1,n=Math.abs(u.position.z-o.z)<.1;if(t&&e&&n)return}this.presence3DManager.updatePresence3D({id:this.localParticipantId,...this.lastSyncedData})}},window.AutodeskPin=class{constructor(t){this.isPinsVisible=!0,this.commentsSide="left",this.localParticipant={},this.isDragging=!1,this.hasLayerSelected=!1,this.animate=()=>{this.positionWrapper(),this.renderFrame=requestAnimationFrame(this.animate)},this.setCommentsMetadata=t=>{this.commentsSide=t},this.onAggregateSelectionChanged=t=>{this.hasLayerSelected=!!t.selections.length,this.renderAnnotationsPins()},this.onCameraMove=()=>{!this.isActive&&!this.isPinsVisible||this.renderAnnotationsPins()},this.annotationSelected=t=>{let{detail:e}=t;var n;let{uuid:r,haltGoToPin:i,newPin:s}=e;if(!r)return;s&&this.pins.get(r).setAttribute("newPin","");let o=JSON.parse((null==(n=this.selectedPin)?void 0:n.getAttribute("annotation"))??"{}");if(this.resetPins(),(null==o?void 0:o.uuid)===r)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let a=this.pins.get(r);if(!a)return;a.setAttribute("active",""),this.selectedPin=a;let{position:l}=this.annotations.find((t=>t.uuid===r));if(l&&!i){let t=JSON.parse(l);this.onClickedPin(t)}},this.hideTemporaryPin=t=>{var e;let n=t.target;this.viewer.canvas.contains(n)||null!=(e=this.pins.get("temporary-pin"))&&e.contains(n)||this.removeAnnotationPin("temporary-pin")},this.resetPins=t=>{t&&"Escape"!==(null==t?void 0:t.key)||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)},this.renderDivWrapper=()=>{let t=this.viewer.canvas.getBoundingClientRect(),e=this.divWrapper;e||(e=document.createElement("div"),e.id="superviz-autodesk-pins-wrapper"),e.style.position="fixed",e.style.top=`${this.viewer.canvas.offsetTop}px`,e.style.left=`${this.viewer.canvas.offsetLeft}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden",e.style.zIndex="1",document.getElementById("superviz-autodesk-pins-wrapper")||document.body.appendChild(e),this.divWrapper=e},this.distanceBetween=(t,e)=>{let n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return Math.sqrt(n*n+r*r+i*i)},this.onMouseUp=t=>{if(this.isDragging)return;let e=this.viewer.clientToWorld(t.offsetX,t.offsetY,!1).point;if(e){let t={x:e.x,y:e.y,z:e.z,type:"autodesk"},n=this.viewer.navigation.getCamera();n.updateMatrixWorld();let r=new Yi(0,0,0);n.getWorldPosition(r);let i={position:t,camera:r};this.resetSelectedPin(),this.onPinFixedObserver.publish(i),this.createTemporaryPin(t)}},this.onMouseDown=t=>{this.isDragging=!1},this.onMouseMove=t=>{this.isDragging=!0;let{x:e,y:n}=t;this.mouseElement||(this.mouseElement=this.createMouseElement());let r=n-this.pinHeight;this.mouseElement.setAttribute("position",JSON.stringify({x:e,y:r}))},this.onMouseLeave=()=>{this.mouseElement&&(this.mouseElement.remove(),this.mouseElement=null),this.viewer.canvas.style.cursor="default"},this.onMouseEnter=()=>{this.mouseElement||(this.mouseElement=this.createMouseElement())},this.onToggleAnnotationSidebar=t=>{let{detail:e}=t,{open:n}=e;n||(this.pins.forEach((t=>{t.removeAttribute("active")})),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))},this.viewer=t,this.logger=new __("@superviz/sdk/comments-component/autodesk-adapter"),this.isActive=!1,this.pins=new Map,this.pinHeight=32,this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraMove),this.viewer.addEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChanged),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.style.position="relative",this.onPinFixedObserver=new x_,this.annotations=[],this.renderAnnotationsPins(),this.showcaseSides=this.viewer.canvas.getBoundingClientRect(),this.renderDivWrapper(),this.renderFrame=requestAnimationFrame(this.animate)}destroy(){this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraMove),this.viewer.removeEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChanged),document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),this.removeAnnotationsPins(),this.removeListeners(),cancelAnimationFrame(this.renderFrame),this.mouseElement=null}setActive(t){this.isActive=t,this.isActive?this.addListeners():this.removeListeners()}setPinsVisibility(t){this.isPinsVisible=t,this.isPinsVisible?this.renderAnnotationsPins():this.removeAnnotationsPins()}positionWrapper(){let t=this.viewer.canvas.getBoundingClientRect();this.divWrapper.style.position="fixed",this.divWrapper.style.top=`${t.top}px`,this.divWrapper.style.left=`${t.left}px`,this.divWrapper.style.width=`${t.width}px`,this.divWrapper.style.height=`${t.height}px`}updateAnnotations(t){this.logger.log("updateAnnotations",t),this.annotations=t,(this.isActive||this.isPinsVisible)&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}removeAnnotationPin(t){let e=this.pins.get(t);e&&(e.remove(),this.pins.delete(t),this.annotations=this.annotations.filter((e=>e.uuid!==t)))}createTemporaryPin(t){let e=document.getElementById("superviz-temporary-pin");this.temporaryPinCoordinates=t,e||(e=document.createElement("superviz-comments-annotation-pin"),e.id="superviz-temporary-pin",e.setAttribute("type","add"),e.setAttribute("showInput",""),e.setAttribute("containerSides",JSON.stringify(this.showcaseSides)),e.setAttribute("commentsSide",this.commentsSide),e.setAttribute("localAvatar",this.localParticipant.avatar??""),e.setAttribute("participantsList",JSON.stringify(this.participants)),e.setAttribute("localName",this.localParticipant.name??""),e.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),e.setAttribute("annotation",JSON.stringify({})),e.setAttributeNode(document.createAttribute("active")),e.style.pointerEvents="auto");let n=this.position3DToScreen(t,0,this.pinHeight),r={x:n.left,y:n.top,type:t.type};e.setAttribute("position",JSON.stringify(r)),this.divWrapper.appendChild(e),this.pins.set("temporary-pin",e),this.renderAnnotationsPins()}addListeners(){this.viewer.canvas.addEventListener("mouseup",this.onMouseUp),this.viewer.canvas.addEventListener("mousedown",this.onMouseDown),this.viewer.canvas.addEventListener("mousemove",this.onMouseMove),this.viewer.canvas.addEventListener("mouseout",this.onMouseLeave),this.viewer.canvas.addEventListener("mouseenter",this.onMouseEnter),document.body.addEventListener("keyup",this.resetPins),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.viewer.canvas.removeEventListener("mouseup",this.onMouseUp),this.viewer.canvas.removeEventListener("mousedown",this.onMouseDown),this.viewer.canvas.removeEventListener("mousemove",this.onMouseMove),this.viewer.canvas.removeEventListener("mouseout",this.onMouseLeave),this.viewer.canvas.removeEventListener("mouseenter",this.onMouseEnter),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("click",this.hideTemporaryPin)}async renderAnnotationsPins(){if(this.annotations.forEach((async t=>{let e=JSON.parse(t.position).position;if("autodesk"!==(null==e?void 0:e.type)||t.resolved)return;if(!this.pins.has(t.uuid))return void this.createPin(t,e);let n=this.position3DToScreen(e,0,this.pinHeight),r=await this.checkIsVisible(n,e),i=this.pins.get(t.uuid);r?(i.setAttribute("style","opacity: 1"),this.pins.get(t.uuid).setAttribute("position",JSON.stringify({x:n.left,y:n.top}))):i.setAttribute("style","opacity: 0")})),this.pins.get("temporary-pin")){let t=this.position3DToScreen(this.temporaryPinCoordinates,0,this.pinHeight),e=await this.checkIsVisible(t,this.temporaryPinCoordinates),n=this.pins.get("temporary-pin");e?(n.setAttribute("style","opacity: 1"),n.setAttribute("position",JSON.stringify({x:t.left,y:t.top}))):n.setAttribute("style","opacity: 0")}}createPin(t,e){let n=this.position3DToScreen(e,0,this.pinHeight),r=document.createElement("superviz-comments-annotation-pin");this.divWrapper.appendChild(r),r.setAttribute("type","show"),r.setAttribute("annotation",JSON.stringify(t)),r.setAttribute("position",JSON.stringify({x:n.left,y:n.top})),r.setAttribute("participantsList",JSON.stringify(this.participants)),r.style.pointerEvents="auto",this.pins.set(t.uuid,r)}onClickedPin(t){let e=t.position,n=this.viewer.navigation.getCamera();n.updateMatrixWorld();let r,i=new Yi(t.camera.x,t.camera.y,t.camera.z),s=new THREE.Vector3(e.x,e.y,e.z);r=s.distanceTo(i)>5?i.lerp(s,.6):i,this.onPinFixedObserver.publish({x:t.position.x,y:t.position.y,z:t.position.z,type:"autodesk"}),this.viewer.utilities.setPivotPoint(s,!1,!1),this.viewer.utilities.transitionView(r,s,n.fov,n.up,n.worldup,!0,s)}removeAnnotationsPins(){this.pins.forEach((t=>{t.remove()})),this.pins.clear()}resetSelectedPin(){this.selectedPin&&(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}set participantsList(t){this.participants=t}position3DToScreen(t,e,n){let r=this.viewer.worldToClient(t);return{top:r.y-n,left:r.x-e}}async checkIsVisible(t,e){let n=!0,r=this.viewer.clientToWorld(t.left,t.top+this.pinHeight,!1);if(r){let t=r.point,i=this.distanceBetween(t,e);Math.abs(i)>(this.hasLayerSelected?8:3)&&(n=!1)}return n}createMouseElement(){let t=document.createElement("superviz-comments-annotation-pin");return t.setAttribute("type","add"),t.setAttribute("annotation",JSON.stringify({})),t.setAttribute("position",JSON.stringify({x:0,y:0})),document.body.appendChild(t),this.viewer.canvas.style.cursor="none",t}});var C_=Object.create,P_=Object.defineProperty,I_=Object.getOwnPropertyDescriptor,R_=Object.getOwnPropertyNames,L_=Object.getPrototypeOf,N_=Object.prototype.hasOwnProperty,O_=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),k_=(t,e,n)=>(n=null!=t?C_(L_(t)):{},((t,e,n,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of R_(e))!N_.call(t,i)&&i!==n&&P_(t,i,{get:()=>e[i],enumerable:!(r=I_(e,i))||r.enumerable});return t})(t&&t.__esModule?n:P_(n,"default",{value:t,enumerable:!0}),t)),D_=O_(((t,e)=>{(function(){var n,r="Expected a function",i="__lodash_hash_undefined__",s="__lodash_placeholder__",o=16,a=32,l=64,c=128,u=256,h=1/0,d=9007199254740991,p=NaN,f=4294967295,m=f-1,g=f>>>1,v=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",o],["flip",512],["partial",a],["partialRight",l],["rearg",u]],y="[object Arguments]",_="[object Array]",b="[object Boolean]",x="[object Date]",w="[object Error]",S="[object Function]",M="[object GeneratorFunction]",E="[object Map]",T="[object Number]",A="[object Object]",C="[object Promise]",P="[object RegExp]",I="[object Set]",R="[object String]",L="[object Symbol]",N="[object WeakMap]",O="[object ArrayBuffer]",k="[object DataView]",D="[object Float32Array]",z="[object Float64Array]",U="[object Int8Array]",F="[object Int16Array]",B="[object Int32Array]",V="[object Uint8Array]",H="[object Uint8ClampedArray]",j="[object Uint16Array]",W="[object Uint32Array]",G=/\b__p \+= '';/g,q=/\b(__p \+=) '' \+/g,$=/(__e\(.*?\)|\b__t\)) \+\n'';/g,X=/&(?:amp|lt|gt|quot|#39);/g,J=/[&<>"']/g,Y=RegExp(X.source),Z=RegExp(J.source),K=/<%-([\s\S]+?)%>/g,Q=/<%([\s\S]+?)%>/g,tt=/<%=([\s\S]+?)%>/g,et=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nt=/^\w*$/,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/[\\^$.*+?()[\]{}|]/g,st=RegExp(it.source),ot=/^\s+/,at=/\s/,lt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ct=/\{\n\/\* \[wrapped with (.+)\] \*/,ut=/,? & /,ht=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,dt=/[()=,{}\[\]\/\s]/,pt=/\\(\\)?/g,ft=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mt=/\w*$/,gt=/^[-+]0x[0-9a-f]+$/i,vt=/^0b[01]+$/i,yt=/^\[object .+?Constructor\]$/,_t=/^0o[0-7]+$/i,bt=/^(?:0|[1-9]\d*)$/,xt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,wt=/($^)/,St=/['\n\r\u2028\u2029\\]/g,Mt="\\ud800-\\udfff",Et="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Tt="\\u2700-\\u27bf",At="a-z\\xdf-\\xf6\\xf8-\\xff",Ct="A-Z\\xc0-\\xd6\\xd8-\\xde",Pt="\\ufe0e\\ufe0f",It="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Rt="['\u2019]",Lt="["+Mt+"]",Nt="["+It+"]",Ot="["+Et+"]",kt="\\d+",Dt="["+Tt+"]",zt="["+At+"]",Ut="[^"+Mt+It+kt+Tt+At+Ct+"]",Ft="\\ud83c[\\udffb-\\udfff]",Bt="[^"+Mt+"]",Vt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ht="[\\ud800-\\udbff][\\udc00-\\udfff]",jt="["+Ct+"]",Wt="\\u200d",Gt="(?:"+zt+"|"+Ut+")",qt="(?:"+jt+"|"+Ut+")",$t="(?:['\u2019](?:d|ll|m|re|s|t|ve))?",Xt="(?:['\u2019](?:D|LL|M|RE|S|T|VE))?",Jt="(?:"+Ot+"|"+Ft+")"+"?",Yt="["+Pt+"]?",Zt=Yt+Jt+("(?:"+Wt+"(?:"+[Bt,Vt,Ht].join("|")+")"+Yt+Jt+")*"),Kt="(?:"+[Dt,Vt,Ht].join("|")+")"+Zt,Qt="(?:"+[Bt+Ot+"?",Ot,Vt,Ht,Lt].join("|")+")",te=RegExp(Rt,"g"),ee=RegExp(Ot,"g"),ne=RegExp(Ft+"(?="+Ft+")|"+Qt+Zt,"g"),re=RegExp([jt+"?"+zt+"+"+$t+"(?="+[Nt,jt,"$"].join("|")+")",qt+"+"+Xt+"(?="+[Nt,jt+Gt,"$"].join("|")+")",jt+"?"+Gt+"+"+$t,jt+"+"+Xt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",kt,Kt].join("|"),"g"),ie=RegExp("["+Wt+Mt+Et+Pt+"]"),se=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,oe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ae=-1,le={};le[D]=le[z]=le[U]=le[F]=le[B]=le[V]=le[H]=le[j]=le[W]=!0,le[y]=le[_]=le[O]=le[b]=le[k]=le[x]=le[w]=le[S]=le[E]=le[T]=le[A]=le[P]=le[I]=le[R]=le[N]=!1;var ce={};ce[y]=ce[_]=ce[O]=ce[k]=ce[b]=ce[x]=ce[D]=ce[z]=ce[U]=ce[F]=ce[B]=ce[E]=ce[T]=ce[A]=ce[P]=ce[I]=ce[R]=ce[L]=ce[V]=ce[H]=ce[j]=ce[W]=!0,ce[w]=ce[S]=ce[N]=!1;var ue={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},he=parseFloat,de=parseInt,pe="object"==typeof window&&window&&window.Object===Object&&window,fe="object"==typeof self&&self&&self.Object===Object&&self,me=pe||fe||Function("return this")(),ge="object"==typeof t&&t&&!t.nodeType&&t,ve=ge&&"object"==typeof e&&e&&!e.nodeType&&e,ye=ve&&ve.exports===ge,_e=ye&&pe.process,be=function(){try{return ve&&ve.require&&ve.require("util").types||_e&&_e.binding&&_e.binding("util")}catch{}}(),xe=be&&be.isArrayBuffer,we=be&&be.isDate,Se=be&&be.isMap,Me=be&&be.isRegExp,Ee=be&&be.isSet,Te=be&&be.isTypedArray;function Ae(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ce(t,e,n,r){for(var i=-1,s=null==t?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function Pe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Ie(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Re(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Le(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Ne(t,e){return!!(null==t?0:t.length)&&je(t,e,0)>-1}function Oe(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function ke(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function De(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function ze(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function Ue(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Fe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Be=$e("length");function Ve(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function He(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function je(t,e,n){return e===e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):He(t,Ge,n)}function We(t,e,n,r){for(var i=n-1,s=t.length;++i<s;)if(r(t[i],e))return i;return-1}function Ge(t){return t!==t}function qe(t,e){var n=null==t?0:t.length;return n?Ye(t,e)/n:p}function $e(t){return function(e){return null==e?n:e[t]}}function Xe(t){return function(e){return null==t?n:t[e]}}function Je(t,e,n,r,i){return i(t,(function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)})),n}function Ye(t,e){for(var r,i=-1,s=t.length;++i<s;){var o=e(t[i]);o!==n&&(r=r===n?o:r+o)}return r}function Ze(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ke(t){return t&&t.slice(0,mn(t)+1).replace(ot,"")}function Qe(t){return function(e){return t(e)}}function tn(t,e){return ke(e,(function(e){return t[e]}))}function en(t,e){return t.has(e)}function nn(t,e){for(var n=-1,r=t.length;++n<r&&je(e,t[n],0)>-1;);return n}function rn(t,e){for(var n=t.length;n--&&je(e,t[n],0)>-1;);return n}var sn=Xe({"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"}),on=Xe({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function an(t){return"\\"+ue[t]}function ln(t){return ie.test(t)}function cn(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function un(t,e){return function(n){return t(e(n))}}function hn(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];(a===e||a===s)&&(t[n]=s,o[i++]=n)}return o}function dn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function pn(t){return ln(t)?function(t){for(var e=ne.lastIndex=0;ne.test(t);)++e;return e}(t):Be(t)}function fn(t){return ln(t)?function(t){return t.match(ne)||[]}(t):function(t){return t.split("")}(t)}function mn(t){for(var e=t.length;e--&&at.test(t.charAt(e)););return e}var gn=Xe({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var vn=function t(e){var at=(e=null==e?me:vn.defaults(me.Object(),e,vn.pick(me,oe))).Array,Mt=e.Date,Et=e.Error,Tt=e.Function,At=e.Math,Ct=e.Object,Pt=e.RegExp,It=e.String,Rt=e.TypeError,Lt=at.prototype,Nt=Tt.prototype,Ot=Ct.prototype,kt=e["__core-js_shared__"],Dt=Nt.toString,zt=Ot.hasOwnProperty,Ut=0,Ft=function(){var t=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Bt=Ot.toString,Vt=Dt.call(Ct),Ht=me._,jt=Pt("^"+Dt.call(zt).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Wt=ye?e.Buffer:n,Gt=e.Symbol,qt=e.Uint8Array,$t=Wt?Wt.allocUnsafe:n,Xt=un(Ct.getPrototypeOf,Ct),Jt=Ct.create,Yt=Ot.propertyIsEnumerable,Zt=Lt.splice,Kt=Gt?Gt.isConcatSpreadable:n,Qt=Gt?Gt.iterator:n,ne=Gt?Gt.toStringTag:n,ie=function(){try{var t=ds(Ct,"defineProperty");return t({},"",{}),t}catch{}}(),ue=e.clearTimeout!==me.clearTimeout&&e.clearTimeout,pe=Mt&&Mt.now!==me.Date.now&&Mt.now,fe=e.setTimeout!==me.setTimeout&&e.setTimeout,ge=At.ceil,ve=At.floor,_e=Ct.getOwnPropertySymbols,be=Wt?Wt.isBuffer:n,Be=e.isFinite,Xe=Lt.join,yn=un(Ct.keys,Ct),_n=At.max,bn=At.min,xn=Mt.now,wn=e.parseInt,Sn=At.random,Mn=Lt.reverse,En=ds(e,"DataView"),Tn=ds(e,"Map"),An=ds(e,"Promise"),Cn=ds(e,"Set"),Pn=ds(e,"WeakMap"),In=ds(Ct,"create"),Rn=Pn&&new Pn,Ln={},Nn=Us(En),On=Us(Tn),kn=Us(An),Dn=Us(Cn),zn=Us(Pn),Un=Gt?Gt.prototype:n,Fn=Un?Un.valueOf:n,Bn=Un?Un.toString:n;function Vn(t){if(na(t)&&!Go(t)&&!(t instanceof Gn)){if(t instanceof Wn)return t;if(zt.call(t,"__wrapped__"))return Fs(t)}return new Wn(t)}var Hn=function(){function t(){}return function(e){if(!ea(e))return{};if(Jt)return Jt(e);t.prototype=e;var r=new t;return t.prototype=n,r}}();function jn(){}function Wn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=n}function Gn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}function qn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function $n(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Xn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Jn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Xn;++e<n;)this.add(t[e])}function Yn(t){var e=this.__data__=new $n(t);this.size=e.size}function Zn(t,e){var n=Go(t),r=!n&&Wo(t),i=!n&&!r&&Jo(t),s=!n&&!r&&!i&&ua(t),o=n||r||i||s,a=o?Ze(t.length,It):[],l=a.length;for(var c in t)(e||zt.call(t,c))&&(!o||!("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||_s(c,l)))&&a.push(c);return a}function Kn(t){var e=t.length;return e?t[Jr(0,e-1)]:n}function Qn(t,e){return ks(Ii(t),lr(e,0,t.length))}function tr(t){return ks(Ii(t))}function er(t,e,r){(r!==n&&!Vo(t[e],r)||r===n&&!(e in t))&&or(t,e,r)}function nr(t,e,r){var i=t[e];(!zt.call(t,e)||!Vo(i,r)||r===n&&!(e in t))&&or(t,e,r)}function rr(t,e){for(var n=t.length;n--;)if(Vo(t[n][0],e))return n;return-1}function ir(t,e,n,r){return pr(t,(function(t,i,s){e(r,t,n(t),s)})),r}function sr(t,e){return t&&Ri(e,La(e),t)}function or(t,e,n){"__proto__"==e&&ie?ie(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ar(t,e){for(var r=-1,i=e.length,s=at(i),o=null==t;++r<i;)s[r]=o?n:Aa(t,e[r]);return s}function lr(t,e,r){return t===t&&(r!==n&&(t=t<=r?t:r),e!==n&&(t=t>=e?t:e)),t}function cr(t,e,r,i,s,o){var a,l=1&e,c=2&e,u=4&e;if(r&&(a=s?r(t,i,s,o):r(t)),a!==n)return a;if(!ea(t))return t;var h=Go(t);if(h){if(a=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&zt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!l)return Ii(t,a)}else{var d=ms(t),p=d==S||d==M;if(Jo(t))return Mi(t,l);if(d==A||d==y||p&&!s){if(a=c||p?{}:vs(t),!l)return c?function(t,e){return Ri(t,fs(t),e)}(t,function(t,e){return t&&Ri(e,Na(e),t)}(a,t)):function(t,e){return Ri(t,ps(t),e)}(t,sr(a,t))}else{if(!ce[d])return s?t:{};a=function(t,e,n){var r=t.constructor;switch(e){case O:return Ei(t);case b:case x:return new r(+t);case k:return function(t,e){var n=e?Ei(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case D:case z:case U:case F:case B:case V:case H:case j:case W:return Ti(t,n);case E:return new r;case T:case R:return new r(t);case P:return function(t){var e=new t.constructor(t.source,mt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case I:return new r;case L:return function(t){return Fn?Ct(Fn.call(t)):{}}(t)}}(t,d,l)}}o||(o=new Yn);var f=o.get(t);if(f)return f;o.set(t,a),aa(t)?t.forEach((function(n){a.add(cr(n,e,r,n,t,o))})):ra(t)&&t.forEach((function(n,i){a.set(i,cr(n,e,r,i,t,o))}));var m=h?n:(u?c?ss:is:c?Na:La)(t);return Pe(m||t,(function(n,i){m&&(n=t[i=n]),nr(a,i,cr(n,e,r,i,t,o))})),a}function ur(t,e,r){var i=r.length;if(null==t)return!i;for(t=Ct(t);i--;){var s=r[i],o=e[s],a=t[s];if(a===n&&!(s in t)||!o(a))return!1}return!0}function hr(t,e,i){if("function"!=typeof t)throw new Rt(r);return Rs((function(){t.apply(n,i)}),e)}function dr(t,e,n,r){var i=-1,s=Ne,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;n&&(e=ke(e,Qe(n))),r?(s=Oe,o=!1):e.length>=200&&(s=en,o=!1,e=new Jn(e));t:for(;++i<a;){var u=t[i],h=null==n?u:n(u);if(u=r||0!==u?u:0,o&&h===h){for(var d=c;d--;)if(e[d]===h)continue t;l.push(u)}else s(e,h,r)||l.push(u)}return l}Vn.templateSettings={escape:K,evaluate:Q,interpolate:tt,variable:"",imports:{_:Vn}},Vn.prototype=jn.prototype,Vn.prototype.constructor=Vn,Wn.prototype=Hn(jn.prototype),Wn.prototype.constructor=Wn,Gn.prototype=Hn(jn.prototype),Gn.prototype.constructor=Gn,qn.prototype.clear=function(){this.__data__=In?In(null):{},this.size=0},qn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},qn.prototype.get=function(t){var e=this.__data__;if(In){var r=e[t];return r===i?n:r}return zt.call(e,t)?e[t]:n},qn.prototype.has=function(t){var e=this.__data__;return In?e[t]!==n:zt.call(e,t)},qn.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=In&&e===n?i:e,this},$n.prototype.clear=function(){this.__data__=[],this.size=0},$n.prototype.delete=function(t){var e=this.__data__,n=rr(e,t);return!(n<0)&&(n==e.length-1?e.pop():Zt.call(e,n,1),--this.size,!0)},$n.prototype.get=function(t){var e=this.__data__,r=rr(e,t);return r<0?n:e[r][1]},$n.prototype.has=function(t){return rr(this.__data__,t)>-1},$n.prototype.set=function(t,e){var n=this.__data__,r=rr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Xn.prototype.clear=function(){this.size=0,this.__data__={hash:new qn,map:new(Tn||$n),string:new qn}},Xn.prototype.delete=function(t){var e=us(this,t).delete(t);return this.size-=e?1:0,e},Xn.prototype.get=function(t){return us(this,t).get(t)},Xn.prototype.has=function(t){return us(this,t).has(t)},Xn.prototype.set=function(t,e){var n=us(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Jn.prototype.add=Jn.prototype.push=function(t){return this.__data__.set(t,i),this},Jn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.clear=function(){this.__data__=new $n,this.size=0},Yn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Yn.prototype.get=function(t){return this.__data__.get(t)},Yn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof $n){var r=n.__data__;if(!Tn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Xn(r)}return n.set(t,e),this.size=n.size,this};var pr=Oi(xr),fr=Oi(wr,!0);function mr(t,e){var n=!0;return pr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function gr(t,e,r){for(var i=-1,s=t.length;++i<s;){var o=t[i],a=e(o);if(null!=a&&(l===n?a===a&&!ca(a):r(a,l)))var l=a,c=o}return c}function vr(t,e){var n=[];return pr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function yr(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=ys),i||(i=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?yr(a,e-1,n,r,i):De(i,a):r||(i[i.length]=a)}return i}var _r=ki(),br=ki(!0);function xr(t,e){return t&&_r(t,e,La)}function wr(t,e){return t&&br(t,e,La)}function Sr(t,e){return Le(e,(function(e){return Ko(t[e])}))}function Mr(t,e){for(var r=0,i=(e=bi(e,t)).length;null!=t&&r<i;)t=t[zs(e[r++])];return r&&r==i?t:n}function Er(t,e,n){var r=e(t);return Go(t)?r:De(r,n(t))}function Tr(t){return null==t?t===n?"[object Undefined]":"[object Null]":ne&&ne in Ct(t)?function(t){var e=zt.call(t,ne),r=t[ne];try{t[ne]=n;var i=!0}catch{}var s=Bt.call(t);return i&&(e?t[ne]=r:delete t[ne]),s}(t):function(t){return Bt.call(t)}(t)}function Ar(t,e){return t>e}function Cr(t,e){return null!=t&&zt.call(t,e)}function Pr(t,e){return null!=t&&e in Ct(t)}function Ir(t,e,r){for(var i=r?Oe:Ne,s=t[0].length,o=t.length,a=o,l=at(o),c=1/0,u=[];a--;){var h=t[a];a&&e&&(h=ke(h,Qe(e))),c=bn(h.length,c),l[a]=!r&&(e||s>=120&&h.length>=120)?new Jn(a&&h):n}h=t[0];var d=-1,p=l[0];t:for(;++d<s&&u.length<c;){var f=h[d],m=e?e(f):f;if(f=r||0!==f?f:0,!(p?en(p,m):i(u,m,r))){for(a=o;--a;){var g=l[a];if(!(g?en(g,m):i(t[a],m,r)))continue t}p&&p.push(m),u.push(f)}}return u}function Rr(t,e,r){var i=null==(t=Cs(t,e=bi(e,t)))?t:t[zs(Ys(e))];return null==i?n:Ae(i,t,r)}function Lr(t){return na(t)&&Tr(t)==y}function Nr(t,e,r,i,s){return t===e||(null==t||null==e||!na(t)&&!na(e)?t!==t&&e!==e:function(t,e,r,i,s,o){var a=Go(t),l=Go(e),c=a?_:ms(t),u=l?_:ms(e),h=(c=c==y?A:c)==A,d=(u=u==y?A:u)==A,p=c==u;if(p&&Jo(t)){if(!Jo(e))return!1;a=!0,h=!1}if(p&&!h)return o||(o=new Yn),a||ua(t)?ns(t,e,r,i,s,o):function(t,e,n,r,i,s,o){switch(n){case k:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case O:return!(t.byteLength!=e.byteLength||!s(new qt(t),new qt(e)));case b:case x:case T:return Vo(+t,+e);case w:return t.name==e.name&&t.message==e.message;case P:case R:return t==e+"";case E:var a=cn;case I:var l=1&r;if(a||(a=dn),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;r|=2,o.set(t,e);var u=ns(a(t),a(e),r,i,s,o);return o.delete(t),u;case L:if(Fn)return Fn.call(t)==Fn.call(e)}return!1}(t,e,c,r,i,s,o);if(!(1&r)){var f=h&&zt.call(t,"__wrapped__"),m=d&&zt.call(e,"__wrapped__");if(f||m){var g=f?t.value():t,v=m?e.value():e;return o||(o=new Yn),s(g,v,r,i,o)}}return!!p&&(o||(o=new Yn),function(t,e,r,i,s,o){var a=1&r,l=is(t),c=l.length,u=is(e),h=u.length;if(c!=h&&!a)return!1;for(var d=c;d--;){var p=l[d];if(!(a?p in e:zt.call(e,p)))return!1}var f=o.get(t),m=o.get(e);if(f&&m)return f==e&&m==t;var g=!0;o.set(t,e),o.set(e,t);for(var v=a;++d<c;){var y=t[p=l[d]],_=e[p];if(i)var b=a?i(_,y,p,e,t,o):i(y,_,p,t,e,o);if(!(b===n?y===_||s(y,_,r,i,o):b)){g=!1;break}v||(v="constructor"==p)}if(g&&!v){var x=t.constructor,w=e.constructor;x!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w)&&(g=!1)}return o.delete(t),o.delete(e),g}(t,e,r,i,s,o))}(t,e,r,i,Nr,s))}function Or(t,e,r,i){var s=r.length,o=s,a=!i;if(null==t)return!o;for(t=Ct(t);s--;){var l=r[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<o;){var c=(l=r[s])[0],u=t[c],h=l[1];if(a&&l[2]){if(u===n&&!(c in t))return!1}else{var d=new Yn;if(i)var p=i(u,h,c,t,e,d);if(!(p===n?Nr(h,u,3,i,d):p))return!1}}return!0}function kr(t){return!(!ea(t)||function(t){return!!Ft&&Ft in t}(t))&&(Ko(t)?jt:yt).test(Us(t))}function Dr(t){return"function"==typeof t?t:null==t?il:"object"==typeof t?Go(t)?Hr(t[0],t[1]):Vr(t):pl(t)}function zr(t){if(!Ms(t))return yn(t);var e=[];for(var n in Ct(t))zt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Ur(t){if(!ea(t))return function(t){var e=[];if(null!=t)for(var n in Ct(t))e.push(n);return e}(t);var e=Ms(t),n=[];for(var r in t)"constructor"==r&&(e||!zt.call(t,r))||n.push(r);return n}function Fr(t,e){return t<e}function Br(t,e){var n=-1,r=$o(t)?at(t.length):[];return pr(t,(function(t,i,s){r[++n]=e(t,i,s)})),r}function Vr(t){var e=hs(t);return 1==e.length&&e[0][2]?Ts(e[0][0],e[0][1]):function(n){return n===t||Or(n,t,e)}}function Hr(t,e){return xs(t)&&Es(e)?Ts(zs(t),e):function(r){var i=Aa(r,t);return i===n&&i===e?Ca(r,t):Nr(e,i,3)}}function jr(t,e,r,i,s){t!==e&&_r(e,(function(o,a){if(s||(s=new Yn),ea(o))!function(t,e,r,i,s,o,a){var l=Ps(t,r),c=Ps(e,r),u=a.get(c);if(u)return void er(t,r,u);var h=o?o(l,c,r+"",t,e,a):n,d=h===n;if(d){var p=Go(c),f=!p&&Jo(c),m=!p&&!f&&ua(c);h=c,p||f||m?Go(l)?h=l:Xo(l)?h=Ii(l):f?(d=!1,h=Mi(c,!0)):m?(d=!1,h=Ti(c,!0)):h=[]:sa(c)||Wo(c)?(h=l,Wo(l)?h=ya(l):(!ea(l)||Ko(l))&&(h=vs(c))):d=!1}d&&(a.set(c,h),s(h,c,i,o,a),a.delete(c)),er(t,r,h)}(t,e,a,r,jr,i,s);else{var l=i?i(Ps(t,a),o,a+"",t,e,s):n;l===n&&(l=o),er(t,a,l)}}),Na)}function Wr(t,e){var r=t.length;if(r)return _s(e+=e<0?r:0,r)?t[e]:n}function Gr(t,e,n){e=e.length?ke(e,(function(t){return Go(t)?function(e){return Mr(e,1===t.length?t[0]:t)}:t})):[il];var r=-1;return e=ke(e,Qe(cs())),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(Br(t,(function(t,n,i){return{criteria:ke(e,(function(e){return e(t)})),index:++r,value:t}})),(function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,s=e.criteria,o=i.length,a=n.length;++r<o;){var l=Ai(i[r],s[r]);if(l)return r>=a?l:l*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function qr(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Mr(t,o);n(a,o)&&ti(s,bi(o,t),a)}return s}function $r(t,e,n,r){var i=r?We:je,s=-1,o=e.length,a=t;for(t===e&&(e=Ii(e)),n&&(a=ke(t,Qe(n)));++s<o;)for(var l=0,c=e[s],u=n?n(c):c;(l=i(a,u,l,r))>-1;)a!==t&&Zt.call(a,l,1),Zt.call(t,l,1);return t}function Xr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==s){var s=i;_s(i)?Zt.call(t,i,1):di(t,i)}}return t}function Jr(t,e){return t+ve(Sn()*(e-t+1))}function Yr(t,e){var n="";if(!t||e<1||e>d)return n;do{e%2&&(n+=t),(e=ve(e/2))&&(t+=t)}while(e);return n}function Zr(t,e){return Ls(As(t,e,il),t+"")}function Kr(t){return Kn(Va(t))}function Qr(t,e){var n=Va(t);return ks(n,lr(e,0,n.length))}function ti(t,e,r,i){if(!ea(t))return t;for(var s=-1,o=(e=bi(e,t)).length,a=o-1,l=t;null!=l&&++s<o;){var c=zs(e[s]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(s!=a){var h=l[c];(u=i?i(h,c,l):n)===n&&(u=ea(h)?h:_s(e[s+1])?[]:{})}nr(l,c,u),l=l[c]}return t}var ei=Rn?function(t,e){return Rn.set(t,e),t}:il,ni=ie?function(t,e){return ie(t,"toString",{configurable:!0,enumerable:!1,value:el(e),writable:!0})}:il;function ri(t){return ks(Va(t))}function ii(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=at(i);++r<i;)s[r]=t[r+e];return s}function si(t,e){var n;return pr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function oi(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e===e&&i<=g){for(;r<i;){var s=r+i>>>1,o=t[s];null!==o&&!ca(o)&&(n?o<=e:o<e)?r=s+1:i=s}return i}return ai(t,e,il,n)}function ai(t,e,r,i){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=r(e))!==e,l=null===e,c=ca(e),u=e===n;s<o;){var h=ve((s+o)/2),d=r(t[h]),p=d!==n,f=null===d,g=d===d,v=ca(d);if(a)var y=i||g;else y=u?g&&(i||p):l?g&&p&&(i||!f):c?g&&p&&!f&&(i||!v):!f&&!v&&(i?d<=e:d<e);y?s=h+1:o=h}return bn(o,m)}function li(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var o=t[n],a=e?e(o):o;if(!n||!Vo(a,l)){var l=a;s[i++]=0===o?0:o}}return s}function ci(t){return"number"==typeof t?t:ca(t)?p:+t}function ui(t){if("string"==typeof t)return t;if(Go(t))return ke(t,ui)+"";if(ca(t))return Bn?Bn.call(t):"";var e=t+"";return"0"==e&&1/t==-h?"-0":e}function hi(t,e,n){var r=-1,i=Ne,s=t.length,o=!0,a=[],l=a;if(n)o=!1,i=Oe;else if(s>=200){var c=e?null:Yi(t);if(c)return dn(c);o=!1,i=en,l=new Jn}else l=e?[]:a;t:for(;++r<s;){var u=t[r],h=e?e(u):u;if(u=n||0!==u?u:0,o&&h===h){for(var d=l.length;d--;)if(l[d]===h)continue t;e&&l.push(h),a.push(u)}else i(l,h,n)||(l!==a&&l.push(h),a.push(u))}return a}function di(t,e){return null==(t=Cs(t,e=bi(e,t)))||delete t[zs(Ys(e))]}function pi(t,e,n,r){return ti(t,e,n(Mr(t,e)),r)}function fi(t,e,n,r){for(var i=t.length,s=r?i:-1;(r?s--:++s<i)&&e(t[s],s,t););return n?ii(t,r?0:s,r?s+1:i):ii(t,r?s+1:0,r?i:s)}function mi(t,e){var n=t;return n instanceof Gn&&(n=n.value()),ze(e,(function(t,e){return e.func.apply(e.thisArg,De([t],e.args))}),n)}function gi(t,e,n){var r=t.length;if(r<2)return r?hi(t[0]):[];for(var i=-1,s=at(r);++i<r;)for(var o=t[i],a=-1;++a<r;)a!=i&&(s[i]=dr(s[i]||o,t[a],e,n));return hi(yr(s,1),e,n)}function vi(t,e,r){for(var i=-1,s=t.length,o=e.length,a={};++i<s;){var l=i<o?e[i]:n;r(a,t[i],l)}return a}function yi(t){return Xo(t)?t:[]}function _i(t){return"function"==typeof t?t:il}function bi(t,e){return Go(t)?t:xs(t,e)?[t]:Ds(_a(t))}var xi=Zr;function wi(t,e,r){var i=t.length;return r=r===n?i:r,!e&&r>=i?t:ii(t,e,r)}var Si=ue||function(t){return me.clearTimeout(t)};function Mi(t,e){if(e)return t.slice();var n=t.length,r=$t?$t(n):new t.constructor(n);return t.copy(r),r}function Ei(t){var e=new t.constructor(t.byteLength);return new qt(e).set(new qt(t)),e}function Ti(t,e){var n=e?Ei(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Ai(t,e){if(t!==e){var r=t!==n,i=null===t,s=t===t,o=ca(t),a=e!==n,l=null===e,c=e===e,u=ca(e);if(!l&&!u&&!o&&t>e||o&&a&&c&&!l&&!u||i&&a&&c||!r&&c||!s)return 1;if(!i&&!o&&!u&&t<e||u&&r&&s&&!i&&!o||l&&r&&s||!a&&s||!c)return-1}return 0}function Ci(t,e,n,r){for(var i=-1,s=t.length,o=n.length,a=-1,l=e.length,c=_n(s-o,0),u=at(l+c),h=!r;++a<l;)u[a]=e[a];for(;++i<o;)(h||i<s)&&(u[n[i]]=t[i]);for(;c--;)u[a++]=t[i++];return u}function Pi(t,e,n,r){for(var i=-1,s=t.length,o=-1,a=n.length,l=-1,c=e.length,u=_n(s-a,0),h=at(u+c),d=!r;++i<u;)h[i]=t[i];for(var p=i;++l<c;)h[p+l]=e[l];for(;++o<a;)(d||i<s)&&(h[p+n[o]]=t[i++]);return h}function Ii(t,e){var n=-1,r=t.length;for(e||(e=at(r));++n<r;)e[n]=t[n];return e}function Ri(t,e,r,i){var s=!r;r||(r={});for(var o=-1,a=e.length;++o<a;){var l=e[o],c=i?i(r[l],t[l],l,r,t):n;c===n&&(c=t[l]),s?or(r,l,c):nr(r,l,c)}return r}function Li(t,e){return function(n,r){var i=Go(n)?Ce:ir,s=e?e():{};return i(n,t,cs(r,2),s)}}function Ni(t){return Zr((function(e,r){var i=-1,s=r.length,o=s>1?r[s-1]:n,a=s>2?r[2]:n;for(o=t.length>3&&"function"==typeof o?(s--,o):n,a&&bs(r[0],r[1],a)&&(o=s<3?n:o,s=1),e=Ct(e);++i<s;){var l=r[i];l&&t(e,l,i,o)}return e}))}function Oi(t,e){return function(n,r){if(null==n)return n;if(!$o(n))return t(n,r);for(var i=n.length,s=e?i:-1,o=Ct(n);(e?s--:++s<i)&&!1!==r(o[s],s,o););return n}}function ki(t){return function(e,n,r){for(var i=-1,s=Ct(e),o=r(e),a=o.length;a--;){var l=o[t?a:++i];if(!1===n(s[l],l,s))break}return e}}function Di(t){return function(e){var r=ln(e=_a(e))?fn(e):n,i=r?r[0]:e.charAt(0),s=r?wi(r,1).join(""):e.slice(1);return i[t]()+s}}function zi(t){return function(e){return ze(Ka(Wa(e).replace(te,"")),t,"")}}function Ui(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Hn(t.prototype),r=t.apply(n,e);return ea(r)?r:n}}function Fi(t){return function(e,r,i){var s=Ct(e);if(!$o(e)){var o=cs(r,3);e=La(e),r=function(t){return o(s[t],t,s)}}var a=t(e,r,i);return a>-1?s[o?e[a]:a]:n}}function Bi(t){return rs((function(e){var i=e.length,s=i,o=Wn.prototype.thru;for(t&&e.reverse();s--;){var a=e[s];if("function"!=typeof a)throw new Rt(r);if(o&&!l&&"wrapper"==as(a))var l=new Wn([],!0)}for(s=l?s:i;++s<i;){var c=as(a=e[s]),u="wrapper"==c?os(a):n;l=u&&ws(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[as(u[0])].apply(l,u[3]):1==a.length&&ws(a)?l[c]():l.thru(a)}return function(){var t=arguments,n=t[0];if(l&&1==t.length&&Go(n))return l.plant(n).value();for(var r=0,s=i?e[r].apply(this,t):n;++r<i;)s=e[r].call(this,s);return s}}))}function Vi(t,e,r,i,s,o,a,l,u,h){var d=e&c,p=1&e,f=2&e,m=24&e,g=512&e,v=f?n:Ui(t);return function c(){for(var y=arguments.length,_=at(y),b=y;b--;)_[b]=arguments[b];if(m)var x=ls(c),w=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(_,x);if(i&&(_=Ci(_,i,s,m)),o&&(_=Pi(_,o,a,m)),y-=w,m&&y<h){var S=hn(_,x);return Xi(t,e,Vi,c.placeholder,r,_,S,l,u,h-y)}var M=p?r:this,E=f?M[t]:t;return y=_.length,l?_=function(t,e){for(var r=t.length,i=bn(e.length,r),s=Ii(t);i--;){var o=e[i];t[i]=_s(o,r)?s[o]:n}return t}(_,l):g&&y>1&&_.reverse(),d&&u<y&&(_.length=u),this&&this!==me&&this instanceof c&&(E=v||Ui(E)),E.apply(M,_)}}function Hi(t,e){return function(n,r){return function(t,e,n,r){return xr(t,(function(t,i,s){e(r,n(t),i,s)})),r}(n,t,e(r),{})}}function ji(t,e){return function(r,i){var s;if(r===n&&i===n)return e;if(r!==n&&(s=r),i!==n){if(s===n)return i;"string"==typeof r||"string"==typeof i?(r=ui(r),i=ui(i)):(r=ci(r),i=ci(i)),s=t(r,i)}return s}}function Wi(t){return rs((function(e){return e=ke(e,Qe(cs())),Zr((function(n){var r=this;return t(e,(function(t){return Ae(t,r,n)}))}))}))}function Gi(t,e){var r=(e=e===n?" ":ui(e)).length;if(r<2)return r?Yr(e,t):e;var i=Yr(e,ge(t/pn(e)));return ln(e)?wi(fn(i),0,t).join(""):i.slice(0,t)}function qi(t){return function(e,r,i){return i&&"number"!=typeof i&&bs(e,r,i)&&(r=i=n),e=fa(e),r===n?(r=e,e=0):r=fa(r),function(t,e,n,r){for(var i=-1,s=_n(ge((e-t)/(n||1)),0),o=at(s);s--;)o[r?s:++i]=t,t+=n;return o}(e,r,i=i===n?e<r?1:-1:fa(i),t)}}function $i(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=va(e),n=va(n)),t(e,n)}}function Xi(t,e,r,i,s,o,c,u,h,d){var p=8&e;e|=p?a:l,4&(e&=~(p?l:a))||(e&=-4);var f=[t,e,s,p?o:n,p?c:n,p?n:o,p?n:c,u,h,d],m=r.apply(n,f);return ws(t)&&Is(m,f),m.placeholder=i,Ns(m,t,e)}function Ji(t){var e=At[t];return function(t,n){if(t=va(t),(n=null==n?0:bn(ma(n),292))&&Be(t)){var r=(_a(t)+"e").split("e");return+((r=(_a(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Yi=Cn&&1/dn(new Cn([,-0]))[1]==h?function(t){return new Cn(t)}:cl;function Zi(t){return function(e){var n=ms(e);return n==E?cn(e):n==I?function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}(e):function(t,e){return ke(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ki(t,e,i,h,d,p,f,m){var g=2&e;if(!g&&"function"!=typeof t)throw new Rt(r);var v=h?h.length:0;if(v||(e&=-97,h=d=n),f=f===n?f:_n(ma(f),0),m=m===n?m:ma(m),v-=d?d.length:0,e&l){var y=h,_=d;h=d=n}var b=g?n:os(t),x=[t,e,i,h,d,y,_,p,f,m];if(b&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<131,a=r==c&&8==n||r==c&&n==u&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!o&&!a)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var l=e[3];if(l){var h=t[3];t[3]=h?Ci(h,l,e[4]):l,t[4]=h?hn(t[3],s):e[4]}l=e[5],l&&(h=t[5],t[5]=h?Pi(h,l,e[6]):l,t[6]=h?hn(t[5],s):e[6]),l=e[7],l&&(t[7]=l),r&c&&(t[8]=null==t[8]?e[8]:bn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i}(x,b),t=x[0],e=x[1],i=x[2],h=x[3],d=x[4],!(m=x[9]=x[9]===n?g?0:t.length:_n(x[9]-v,0))&&24&e&&(e&=-25),e&&1!=e)w=8==e||e==o?function(t,e,r){var i=Ui(t);return function s(){for(var o=arguments.length,a=at(o),l=o,c=ls(s);l--;)a[l]=arguments[l];var u=o<3&&a[0]!==c&&a[o-1]!==c?[]:hn(a,c);return(o-=u.length)<r?Xi(t,e,Vi,s.placeholder,n,a,u,n,n,r-o):Ae(this&&this!==me&&this instanceof s?i:t,this,a)}}(t,e,m):e!=a&&33!=e||d.length?Vi.apply(n,x):function(t,e,n,r){var i=1&e,s=Ui(t);return function e(){for(var o=-1,a=arguments.length,l=-1,c=r.length,u=at(c+a),h=this&&this!==me&&this instanceof e?s:t;++l<c;)u[l]=r[l];for(;a--;)u[l++]=arguments[++o];return Ae(h,i?n:this,u)}}(t,e,i,h);else var w=function(t,e,n){var r=1&e,i=Ui(t);return function e(){return(this&&this!==me&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,i);return Ns((b?ei:Is)(w,x),t,e)}function Qi(t,e,r,i){return t===n||Vo(t,Ot[r])&&!zt.call(i,r)?e:t}function ts(t,e,r,i,s,o){return ea(t)&&ea(e)&&(o.set(e,t),jr(t,e,n,ts,o),o.delete(e)),t}function es(t){return sa(t)?n:t}function ns(t,e,r,i,s,o){var a=1&r,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var u=o.get(t),h=o.get(e);if(u&&h)return u==e&&h==t;var d=-1,p=!0,f=2&r?new Jn:n;for(o.set(t,e),o.set(e,t);++d<l;){var m=t[d],g=e[d];if(i)var v=a?i(g,m,d,e,t,o):i(m,g,d,t,e,o);if(v!==n){if(v)continue;p=!1;break}if(f){if(!Fe(e,(function(t,e){if(!en(f,e)&&(m===t||s(m,t,r,i,o)))return f.push(e)}))){p=!1;break}}else if(m!==g&&!s(m,g,r,i,o)){p=!1;break}}return o.delete(t),o.delete(e),p}function rs(t){return Ls(As(t,n,Gs),t+"")}function is(t){return Er(t,La,ps)}function ss(t){return Er(t,Na,fs)}var os=Rn?function(t){return Rn.get(t)}:cl;function as(t){for(var e=t.name+"",n=Ln[e],r=zt.call(Ln,e)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==t)return i.name}return e}function ls(t){return(zt.call(Vn,"placeholder")?Vn:t).placeholder}function cs(){var t=Vn.iteratee||sl;return t=t===sl?Dr:t,arguments.length?t(arguments[0],arguments[1]):t}function us(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function hs(t){for(var e=La(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Es(i)]}return e}function ds(t,e){var r=function(t,e){return null==t?n:t[e]}(t,e);return kr(r)?r:n}var ps=_e?function(t){return null==t?[]:(t=Ct(t),Le(_e(t),(function(e){return Yt.call(t,e)})))}:gl,fs=_e?function(t){for(var e=[];t;)De(e,ps(t)),t=Xt(t);return e}:gl,ms=Tr;function gs(t,e,n){for(var r=-1,i=(e=bi(e,t)).length,s=!1;++r<i;){var o=zs(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&ta(i)&&_s(o,i)&&(Go(t)||Wo(t))}function vs(t){return"function"!=typeof t.constructor||Ms(t)?{}:Hn(Xt(t))}function ys(t){return Go(t)||Wo(t)||!!(Kt&&t&&t[Kt])}function _s(t,e){var n=typeof t;return!!(e=e??d)&&("number"==n||"symbol"!=n&&bt.test(t))&&t>-1&&t%1==0&&t<e}function bs(t,e,n){if(!ea(n))return!1;var r=typeof e;return!!("number"==r?$o(n)&&_s(e,n.length):"string"==r&&e in n)&&Vo(n[e],t)}function xs(t,e){if(Go(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ca(t))||(nt.test(t)||!et.test(t)||null!=e&&t in Ct(e))}function ws(t){var e=as(t),n=Vn[e];if("function"!=typeof n||!(e in Gn.prototype))return!1;if(t===n)return!0;var r=os(n);return!!r&&t===r[0]}(En&&ms(new En(new ArrayBuffer(1)))!=k||Tn&&ms(new Tn)!=E||An&&ms(An.resolve())!=C||Cn&&ms(new Cn)!=I||Pn&&ms(new Pn)!=N)&&(ms=function(t){var e=Tr(t),r=e==A?t.constructor:n,i=r?Us(r):"";if(i)switch(i){case Nn:return k;case On:return E;case kn:return C;case Dn:return I;case zn:return N}return e});var Ss=kt?Ko:vl;function Ms(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ot)}function Es(t){return t===t&&!ea(t)}function Ts(t,e){return function(r){return null!=r&&(r[t]===e&&(e!==n||t in Ct(r)))}}function As(t,e,r){return e=_n(e===n?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=_n(n.length-e,0),o=at(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=at(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),Ae(t,this,a)}}function Cs(t,e){return e.length<2?t:Mr(t,ii(e,0,-1))}function Ps(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Is=Os(ei),Rs=fe||function(t,e){return me.setTimeout(t,e)},Ls=Os(ni);function Ns(t,e,n){var r=e+"";return Ls(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(lt,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Pe(v,(function(n){var r="_."+n[0];e&n[1]&&!Ne(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(ct);return e?e[1].split(ut):[]}(r),n)))}function Os(t){var e=0,r=0;return function(){var i=xn(),s=16-(i-r);if(r=i,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(n,arguments)}}function ks(t,e){var r=-1,i=t.length,s=i-1;for(e=e===n?i:e;++r<e;){var o=Jr(r,s),a=t[o];t[o]=t[r],t[r]=a}return t.length=e,t}var Ds=function(t){var e=ko(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(rt,(function(t,n,r,i){e.push(r?i.replace(pt,"$1"):n||t)})),e}));function zs(t){if("string"==typeof t||ca(t))return t;var e=t+"";return"0"==e&&1/t==-h?"-0":e}function Us(t){if(null!=t){try{return Dt.call(t)}catch{}try{return t+""}catch{}}return""}function Fs(t){if(t instanceof Gn)return t.clone();var e=new Wn(t.__wrapped__,t.__chain__);return e.__actions__=Ii(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Bs=Zr((function(t,e){return Xo(t)?dr(t,yr(e,1,Xo,!0)):[]})),Vs=Zr((function(t,e){var r=Ys(e);return Xo(r)&&(r=n),Xo(t)?dr(t,yr(e,1,Xo,!0),cs(r,2)):[]})),Hs=Zr((function(t,e){var r=Ys(e);return Xo(r)&&(r=n),Xo(t)?dr(t,yr(e,1,Xo,!0),n,r):[]}));function js(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ma(n);return i<0&&(i=_n(r+i,0)),He(t,cs(e,3),i)}function Ws(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i-1;return r!==n&&(s=ma(r),s=r<0?_n(i+s,0):bn(s,i-1)),He(t,cs(e,3),s,!0)}function Gs(t){return(null==t?0:t.length)?yr(t,1):[]}function qs(t){return t&&t.length?t[0]:n}var $s=Zr((function(t){var e=ke(t,yi);return e.length&&e[0]===t[0]?Ir(e):[]})),Xs=Zr((function(t){var e=Ys(t),r=ke(t,yi);return e===Ys(r)?e=n:r.pop(),r.length&&r[0]===t[0]?Ir(r,cs(e,2)):[]})),Js=Zr((function(t){var e=Ys(t),r=ke(t,yi);return(e="function"==typeof e?e:n)&&r.pop(),r.length&&r[0]===t[0]?Ir(r,n,e):[]}));function Ys(t){var e=null==t?0:t.length;return e?t[e-1]:n}var Zs=Zr(Ks);function Ks(t,e){return t&&t.length&&e&&e.length?$r(t,e):t}var Qs=rs((function(t,e){var n=null==t?0:t.length,r=ar(t,e);return Xr(t,ke(e,(function(t){return _s(t,n)?+t:t})).sort(Ai)),r}));function to(t){return null==t?t:Mn.call(t)}var eo=Zr((function(t){return hi(yr(t,1,Xo,!0))})),no=Zr((function(t){var e=Ys(t);return Xo(e)&&(e=n),hi(yr(t,1,Xo,!0),cs(e,2))})),ro=Zr((function(t){var e=Ys(t);return e="function"==typeof e?e:n,hi(yr(t,1,Xo,!0),n,e)}));function io(t){if(!t||!t.length)return[];var e=0;return t=Le(t,(function(t){if(Xo(t))return e=_n(t.length,e),!0})),Ze(e,(function(e){return ke(t,$e(e))}))}function so(t,e){if(!t||!t.length)return[];var r=io(t);return null==e?r:ke(r,(function(t){return Ae(e,n,t)}))}var oo=Zr((function(t,e){return Xo(t)?dr(t,e):[]})),ao=Zr((function(t){return gi(Le(t,Xo))})),lo=Zr((function(t){var e=Ys(t);return Xo(e)&&(e=n),gi(Le(t,Xo),cs(e,2))})),co=Zr((function(t){var e=Ys(t);return e="function"==typeof e?e:n,gi(Le(t,Xo),n,e)})),uo=Zr(io);var ho=Zr((function(t){var e=t.length,r=e>1?t[e-1]:n;return r="function"==typeof r?(t.pop(),r):n,so(t,r)}));function po(t){var e=Vn(t);return e.__chain__=!0,e}function fo(t,e){return e(t)}var mo=rs((function(t){var e=t.length,r=e?t[0]:0,i=this.__wrapped__,s=function(e){return ar(e,t)};return!(e>1||this.__actions__.length)&&i instanceof Gn&&_s(r)?((i=i.slice(r,+r+(e?1:0))).__actions__.push({func:fo,args:[s],thisArg:n}),new Wn(i,this.__chain__).thru((function(t){return e&&!t.length&&t.push(n),t}))):this.thru(s)}));var go=Li((function(t,e,n){zt.call(t,n)?++t[n]:or(t,n,1)}));var vo=Fi(js),yo=Fi(Ws);function _o(t,e){return(Go(t)?Pe:pr)(t,cs(e,3))}function bo(t,e){return(Go(t)?Ie:fr)(t,cs(e,3))}var xo=Li((function(t,e,n){zt.call(t,n)?t[n].push(e):or(t,n,[e])}));var wo=Zr((function(t,e,n){var r=-1,i="function"==typeof e,s=$o(t)?at(t.length):[];return pr(t,(function(t){s[++r]=i?Ae(e,t,n):Rr(t,e,n)})),s})),So=Li((function(t,e,n){or(t,n,e)}));function Mo(t,e){return(Go(t)?ke:Br)(t,cs(e,3))}var Eo=Li((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var To=Zr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&bs(t,e[0],e[1])?e=[]:n>2&&bs(e[0],e[1],e[2])&&(e=[e[0]]),Gr(t,yr(e,1),[])})),Ao=pe||function(){return me.Date.now()};function Co(t,e,r){return e=r?n:e,e=t&&null==e?t.length:e,Ki(t,c,n,n,n,n,e)}function Po(t,e){var i;if("function"!=typeof e)throw new Rt(r);return t=ma(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=n),i}}var Io=Zr((function(t,e,n){var r=1;if(n.length){var i=hn(n,ls(Io));r|=a}return Ki(t,r,e,n,i)})),Ro=Zr((function(t,e,n){var r=3;if(n.length){var i=hn(n,ls(Ro));r|=a}return Ki(e,r,t,n,i)}));function Lo(t,e,i){var s,o,a,l,c,u,h=0,d=!1,p=!1,f=!0;if("function"!=typeof t)throw new Rt(r);function m(e){var r=s,i=o;return s=o=n,h=e,l=t.apply(i,r)}function g(t){var r=t-u;return u===n||r>=e||r<0||p&&t-h>=a}function v(){var t=Ao();if(g(t))return y(t);c=Rs(v,function(t){var n=e-(t-u);return p?bn(n,a-(t-h)):n}(t))}function y(t){return c=n,f&&s?m(t):(s=o=n,l)}function _(){var t=Ao(),r=g(t);if(s=arguments,o=this,u=t,r){if(c===n)return function(t){return h=t,c=Rs(v,e),d?m(t):l}(u);if(p)return Si(c),c=Rs(v,e),m(u)}return c===n&&(c=Rs(v,e)),l}return e=va(e)||0,ea(i)&&(d=!!i.leading,a=(p="maxWait"in i)?_n(va(i.maxWait)||0,e):a,f="trailing"in i?!!i.trailing:f),_.cancel=function(){c!==n&&Si(c),h=0,s=u=o=c=n},_.flush=function(){return c===n?l:y(Ao())},_}var No=Zr((function(t,e){return hr(t,1,e)})),Oo=Zr((function(t,e,n){return hr(t,va(e)||0,n)}));function ko(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Rt(r);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(ko.Cache||Xn),n}function Do(t){if("function"!=typeof t)throw new Rt(r);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}ko.Cache=Xn;var zo=xi((function(t,e){var n=(e=1==e.length&&Go(e[0])?ke(e[0],Qe(cs())):ke(yr(e,1),Qe(cs()))).length;return Zr((function(r){for(var i=-1,s=bn(r.length,n);++i<s;)r[i]=e[i].call(this,r[i]);return Ae(t,this,r)}))})),Uo=Zr((function(t,e){var r=hn(e,ls(Uo));return Ki(t,a,n,e,r)})),Fo=Zr((function(t,e){var r=hn(e,ls(Fo));return Ki(t,l,n,e,r)})),Bo=rs((function(t,e){return Ki(t,u,n,n,n,e)}));function Vo(t,e){return t===e||t!==t&&e!==e}var Ho=$i(Ar),jo=$i((function(t,e){return t>=e})),Wo=Lr(function(){return arguments}())?Lr:function(t){return na(t)&&zt.call(t,"callee")&&!Yt.call(t,"callee")},Go=at.isArray,qo=xe?Qe(xe):function(t){return na(t)&&Tr(t)==O};function $o(t){return null!=t&&ta(t.length)&&!Ko(t)}function Xo(t){return na(t)&&$o(t)}var Jo=be||vl,Yo=we?Qe(we):function(t){return na(t)&&Tr(t)==x};function Zo(t){if(!na(t))return!1;var e=Tr(t);return e==w||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!sa(t)}function Ko(t){if(!ea(t))return!1;var e=Tr(t);return e==S||e==M||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Qo(t){return"number"==typeof t&&t==ma(t)}function ta(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=d}function ea(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function na(t){return null!=t&&"object"==typeof t}var ra=Se?Qe(Se):function(t){return na(t)&&ms(t)==E};function ia(t){return"number"==typeof t||na(t)&&Tr(t)==T}function sa(t){if(!na(t)||Tr(t)!=A)return!1;var e=Xt(t);if(null===e)return!0;var n=zt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Dt.call(n)==Vt}var oa=Me?Qe(Me):function(t){return na(t)&&Tr(t)==P};var aa=Ee?Qe(Ee):function(t){return na(t)&&ms(t)==I};function la(t){return"string"==typeof t||!Go(t)&&na(t)&&Tr(t)==R}function ca(t){return"symbol"==typeof t||na(t)&&Tr(t)==L}var ua=Te?Qe(Te):function(t){return na(t)&&ta(t.length)&&!!le[Tr(t)]};var ha=$i(Fr),da=$i((function(t,e){return t<=e}));function pa(t){if(!t)return[];if($o(t))return la(t)?fn(t):Ii(t);if(Qt&&t[Qt])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[Qt]());var e=ms(t);return(e==E?cn:e==I?dn:Va)(t)}function fa(t){return t?(t=va(t))===h||t===-h?17976931348623157e292*(t<0?-1:1):t===t?t:0:0===t?t:0}function ma(t){var e=fa(t),n=e%1;return e===e?n?e-n:e:0}function ga(t){return t?lr(ma(t),0,f):0}function va(t){if("number"==typeof t)return t;if(ca(t))return p;if(ea(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=ea(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ke(t);var n=vt.test(t);return n||_t.test(t)?de(t.slice(2),n?2:8):gt.test(t)?p:+t}function ya(t){return Ri(t,Na(t))}function _a(t){return null==t?"":ui(t)}var ba=Ni((function(t,e){if(Ms(e)||$o(e))Ri(e,La(e),t);else for(var n in e)zt.call(e,n)&&nr(t,n,e[n])})),xa=Ni((function(t,e){Ri(e,Na(e),t)})),wa=Ni((function(t,e,n,r){Ri(e,Na(e),t,r)})),Sa=Ni((function(t,e,n,r){Ri(e,La(e),t,r)})),Ma=rs(ar);var Ea=Zr((function(t,e){t=Ct(t);var r=-1,i=e.length,s=i>2?e[2]:n;for(s&&bs(e[0],e[1],s)&&(i=1);++r<i;)for(var o=e[r],a=Na(o),l=-1,c=a.length;++l<c;){var u=a[l],h=t[u];(h===n||Vo(h,Ot[u])&&!zt.call(t,u))&&(t[u]=o[u])}return t})),Ta=Zr((function(t){return t.push(n,ts),Ae(ka,n,t)}));function Aa(t,e,r){var i=null==t?n:Mr(t,e);return i===n?r:i}function Ca(t,e){return null!=t&&gs(t,e,Pr)}var Pa=Hi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),t[e]=n}),el(il)),Ia=Hi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),zt.call(t,e)?t[e].push(n):t[e]=[n]}),cs),Ra=Zr(Rr);function La(t){return $o(t)?Zn(t):zr(t)}function Na(t){return $o(t)?Zn(t,!0):Ur(t)}var Oa=Ni((function(t,e,n){jr(t,e,n)})),ka=Ni((function(t,e,n,r){jr(t,e,n,r)})),Da=rs((function(t,e){var n={};if(null==t)return n;var r=!1;e=ke(e,(function(e){return e=bi(e,t),r||(r=e.length>1),e})),Ri(t,ss(t),n),r&&(n=cr(n,7,es));for(var i=e.length;i--;)di(n,e[i]);return n}));var za=rs((function(t,e){return null==t?{}:function(t,e){return qr(t,e,(function(e,n){return Ca(t,n)}))}(t,e)}));function Ua(t,e){if(null==t)return{};var n=ke(ss(t),(function(t){return[t]}));return e=cs(e),qr(t,n,(function(t,n){return e(t,n[0])}))}var Fa=Zi(La),Ba=Zi(Na);function Va(t){return null==t?[]:tn(t,La(t))}var Ha=zi((function(t,e,n){return e=e.toLowerCase(),t+(n?ja(e):e)}));function ja(t){return Za(_a(t).toLowerCase())}function Wa(t){return(t=_a(t))&&t.replace(xt,sn).replace(ee,"")}var Ga=zi((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),qa=zi((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),$a=Di("toLowerCase");var Xa=zi((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var Ja=zi((function(t,e,n){return t+(n?" ":"")+Za(e)}));var Ya=zi((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Za=Di("toUpperCase");function Ka(t,e,r){return t=_a(t),(e=r?n:e)===n?function(t){return se.test(t)}(t)?function(t){return t.match(re)||[]}(t):function(t){return t.match(ht)||[]}(t):t.match(e)||[]}var Qa=Zr((function(t,e){try{return Ae(t,n,e)}catch(r){return Zo(r)?r:new Et(r)}})),tl=rs((function(t,e){return Pe(e,(function(e){e=zs(e),or(t,e,Io(t[e],t))})),t}));function el(t){return function(){return t}}var nl=Bi(),rl=Bi(!0);function il(t){return t}function sl(t){return Dr("function"==typeof t?t:cr(t,1))}var ol=Zr((function(t,e){return function(n){return Rr(n,t,e)}})),al=Zr((function(t,e){return function(n){return Rr(t,n,e)}}));function ll(t,e,n){var r=La(e),i=Sr(e,r);null==n&&(!ea(e)||!i.length&&r.length)&&(n=e,e=t,t=this,i=Sr(e,La(e)));var s=!(ea(n)&&"chain"in n)||!!n.chain,o=Ko(t);return Pe(i,(function(n){var r=e[n];t[n]=r,o&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__);return(n.__actions__=Ii(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,De([this.value()],arguments))})})),t}function cl(){}var ul=Wi(ke),hl=Wi(Re),dl=Wi(Fe);function pl(t){return xs(t)?$e(zs(t)):function(t){return function(e){return Mr(e,t)}}(t)}var fl=qi(),ml=qi(!0);function gl(){return[]}function vl(){return!1}var yl=ji((function(t,e){return t+e}),0),_l=Ji("ceil"),bl=ji((function(t,e){return t/e}),1),xl=Ji("floor");var wl=ji((function(t,e){return t*e}),1),Sl=Ji("round"),Ml=ji((function(t,e){return t-e}),0);return Vn.after=function(t,e){if("function"!=typeof e)throw new Rt(r);return t=ma(t),function(){if(--t<1)return e.apply(this,arguments)}},Vn.ary=Co,Vn.assign=ba,Vn.assignIn=xa,Vn.assignInWith=wa,Vn.assignWith=Sa,Vn.at=Ma,Vn.before=Po,Vn.bind=Io,Vn.bindAll=tl,Vn.bindKey=Ro,Vn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Go(t)?t:[t]},Vn.chain=po,Vn.chunk=function(t,e,r){e=(r?bs(t,e,r):e===n)?1:_n(ma(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var s=0,o=0,a=at(ge(i/e));s<i;)a[o++]=ii(t,s,s+=e);return a},Vn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i},Vn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=at(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return De(Go(n)?Ii(n):[n],yr(e,1))},Vn.cond=function(t){var e=null==t?0:t.length,n=cs();return t=e?ke(t,(function(t){if("function"!=typeof t[1])throw new Rt(r);return[n(t[0]),t[1]]})):[],Zr((function(n){for(var r=-1;++r<e;){var i=t[r];if(Ae(i[0],this,n))return Ae(i[1],this,n)}}))},Vn.conforms=function(t){return function(t){var e=La(t);return function(n){return ur(n,t,e)}}(cr(t,1))},Vn.constant=el,Vn.countBy=go,Vn.create=function(t,e){var n=Hn(t);return null==e?n:sr(n,e)},Vn.curry=function t(e,r,i){var s=Ki(e,8,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Vn.curryRight=function t(e,r,i){var s=Ki(e,o,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Vn.debounce=Lo,Vn.defaults=Ea,Vn.defaultsDeep=Ta,Vn.defer=No,Vn.delay=Oo,Vn.difference=Bs,Vn.differenceBy=Vs,Vn.differenceWith=Hs,Vn.drop=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=r||e===n?1:ma(e))<0?0:e,i):[]},Vn.dropRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,0,(e=i-(e=r||e===n?1:ma(e)))<0?0:e):[]},Vn.dropRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0,!0):[]},Vn.dropWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0):[]},Vn.fill=function(t,e,r,i){var s=null==t?0:t.length;return s?(r&&"number"!=typeof r&&bs(t,e,r)&&(r=0,i=s),function(t,e,r,i){var s=t.length;for((r=ma(r))<0&&(r=-r>s?0:s+r),(i=i===n||i>s?s:ma(i))<0&&(i+=s),i=r>i?0:ga(i);r<i;)t[r++]=e;return t}(t,e,r,i)):[]},Vn.filter=function(t,e){return(Go(t)?Le:vr)(t,cs(e,3))},Vn.flatMap=function(t,e){return yr(Mo(t,e),1)},Vn.flatMapDeep=function(t,e){return yr(Mo(t,e),h)},Vn.flatMapDepth=function(t,e,r){return r=r===n?1:ma(r),yr(Mo(t,e),r)},Vn.flatten=Gs,Vn.flattenDeep=function(t){return(null==t?0:t.length)?yr(t,h):[]},Vn.flattenDepth=function(t,e){return(null==t?0:t.length)?yr(t,e=e===n?1:ma(e)):[]},Vn.flip=function(t){return Ki(t,512)},Vn.flow=nl,Vn.flowRight=rl,Vn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Vn.functions=function(t){return null==t?[]:Sr(t,La(t))},Vn.functionsIn=function(t){return null==t?[]:Sr(t,Na(t))},Vn.groupBy=xo,Vn.initial=function(t){return(null==t?0:t.length)?ii(t,0,-1):[]},Vn.intersection=$s,Vn.intersectionBy=Xs,Vn.intersectionWith=Js,Vn.invert=Pa,Vn.invertBy=Ia,Vn.invokeMap=wo,Vn.iteratee=sl,Vn.keyBy=So,Vn.keys=La,Vn.keysIn=Na,Vn.map=Mo,Vn.mapKeys=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){or(n,e(t,r,i),t)})),n},Vn.mapValues=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){or(n,r,e(t,r,i))})),n},Vn.matches=function(t){return Vr(cr(t,1))},Vn.matchesProperty=function(t,e){return Hr(t,cr(e,1))},Vn.memoize=ko,Vn.merge=Oa,Vn.mergeWith=ka,Vn.method=ol,Vn.methodOf=al,Vn.mixin=ll,Vn.negate=Do,Vn.nthArg=function(t){return t=ma(t),Zr((function(e){return Wr(e,t)}))},Vn.omit=Da,Vn.omitBy=function(t,e){return Ua(t,Do(cs(e)))},Vn.once=function(t){return Po(2,t)},Vn.orderBy=function(t,e,r,i){return null==t?[]:(Go(e)||(e=null==e?[]:[e]),Go(r=i?n:r)||(r=null==r?[]:[r]),Gr(t,e,r))},Vn.over=ul,Vn.overArgs=zo,Vn.overEvery=hl,Vn.overSome=dl,Vn.partial=Uo,Vn.partialRight=Fo,Vn.partition=Eo,Vn.pick=za,Vn.pickBy=Ua,Vn.property=pl,Vn.propertyOf=function(t){return function(e){return null==t?n:Mr(t,e)}},Vn.pull=Zs,Vn.pullAll=Ks,Vn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?$r(t,e,cs(n,2)):t},Vn.pullAllWith=function(t,e,r){return t&&t.length&&e&&e.length?$r(t,e,n,r):t},Vn.pullAt=Qs,Vn.range=fl,Vn.rangeRight=ml,Vn.rearg=Bo,Vn.reject=function(t,e){return(Go(t)?Le:vr)(t,Do(cs(e,3)))},Vn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],s=t.length;for(e=cs(e,3);++r<s;){var o=t[r];e(o,r,t)&&(n.push(o),i.push(r))}return Xr(t,i),n},Vn.rest=function(t,e){if("function"!=typeof t)throw new Rt(r);return Zr(t,e=e===n?e:ma(e))},Vn.reverse=to,Vn.sampleSize=function(t,e,r){return e=(r?bs(t,e,r):e===n)?1:ma(e),(Go(t)?Qn:Qr)(t,e)},Vn.set=function(t,e,n){return null==t?t:ti(t,e,n)},Vn.setWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:ti(t,e,r,i)},Vn.shuffle=function(t){return(Go(t)?tr:ri)(t)},Vn.slice=function(t,e,r){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&bs(t,e,r)?(e=0,r=i):(e=null==e?0:ma(e),r=r===n?i:ma(r)),ii(t,e,r)):[]},Vn.sortBy=To,Vn.sortedUniq=function(t){return t&&t.length?li(t):[]},Vn.sortedUniqBy=function(t,e){return t&&t.length?li(t,cs(e,2)):[]},Vn.split=function(t,e,r){return r&&"number"!=typeof r&&bs(t,e,r)&&(e=r=n),(r=r===n?f:r>>>0)?(t=_a(t))&&("string"==typeof e||null!=e&&!oa(e))&&(!(e=ui(e))&&ln(t))?wi(fn(t),0,r):t.split(e,r):[]},Vn.spread=function(t,e){if("function"!=typeof t)throw new Rt(r);return e=null==e?0:_n(ma(e),0),Zr((function(n){var r=n[e],i=wi(n,0,e);return r&&De(i,r),Ae(t,this,i)}))},Vn.tail=function(t){var e=null==t?0:t.length;return e?ii(t,1,e):[]},Vn.take=function(t,e,r){return t&&t.length?ii(t,0,(e=r||e===n?1:ma(e))<0?0:e):[]},Vn.takeRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=i-(e=r||e===n?1:ma(e)))<0?0:e,i):[]},Vn.takeRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!1,!0):[]},Vn.takeWhile=function(t,e){return t&&t.length?fi(t,cs(e,3)):[]},Vn.tap=function(t,e){return e(t),t},Vn.throttle=function(t,e,n){var i=!0,s=!0;if("function"!=typeof t)throw new Rt(r);return ea(n)&&(i="leading"in n?!!n.leading:i,s="trailing"in n?!!n.trailing:s),Lo(t,e,{leading:i,maxWait:e,trailing:s})},Vn.thru=fo,Vn.toArray=pa,Vn.toPairs=Fa,Vn.toPairsIn=Ba,Vn.toPath=function(t){return Go(t)?ke(t,zs):ca(t)?[t]:Ii(Ds(_a(t)))},Vn.toPlainObject=ya,Vn.transform=function(t,e,n){var r=Go(t),i=r||Jo(t)||ua(t);if(e=cs(e,4),null==n){var s=t&&t.constructor;n=i?r?new s:[]:ea(t)&&Ko(s)?Hn(Xt(t)):{}}return(i?Pe:xr)(t,(function(t,r,i){return e(n,t,r,i)})),n},Vn.unary=function(t){return Co(t,1)},Vn.union=eo,Vn.unionBy=no,Vn.unionWith=ro,Vn.uniq=function(t){return t&&t.length?hi(t):[]},Vn.uniqBy=function(t,e){return t&&t.length?hi(t,cs(e,2)):[]},Vn.uniqWith=function(t,e){return e="function"==typeof e?e:n,t&&t.length?hi(t,n,e):[]},Vn.unset=function(t,e){return null==t||di(t,e)},Vn.unzip=io,Vn.unzipWith=so,Vn.update=function(t,e,n){return null==t?t:pi(t,e,_i(n))},Vn.updateWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:pi(t,e,_i(r),i)},Vn.values=Va,Vn.valuesIn=function(t){return null==t?[]:tn(t,Na(t))},Vn.without=oo,Vn.words=Ka,Vn.wrap=function(t,e){return Uo(_i(e),t)},Vn.xor=ao,Vn.xorBy=lo,Vn.xorWith=co,Vn.zip=uo,Vn.zipObject=function(t,e){return vi(t||[],e||[],nr)},Vn.zipObjectDeep=function(t,e){return vi(t||[],e||[],ti)},Vn.zipWith=ho,Vn.entries=Fa,Vn.entriesIn=Ba,Vn.extend=xa,Vn.extendWith=wa,ll(Vn,Vn),Vn.add=yl,Vn.attempt=Qa,Vn.camelCase=Ha,Vn.capitalize=ja,Vn.ceil=_l,Vn.clamp=function(t,e,r){return r===n&&(r=e,e=n),r!==n&&(r=(r=va(r))===r?r:0),e!==n&&(e=(e=va(e))===e?e:0),lr(va(t),e,r)},Vn.clone=function(t){return cr(t,4)},Vn.cloneDeep=function(t){return cr(t,5)},Vn.cloneDeepWith=function(t,e){return cr(t,5,e="function"==typeof e?e:n)},Vn.cloneWith=function(t,e){return cr(t,4,e="function"==typeof e?e:n)},Vn.conformsTo=function(t,e){return null==e||ur(t,e,La(e))},Vn.deburr=Wa,Vn.defaultTo=function(t,e){return null==t||t!==t?e:t},Vn.divide=bl,Vn.endsWith=function(t,e,r){t=_a(t),e=ui(e);var i=t.length,s=r=r===n?i:lr(ma(r),0,i);return(r-=e.length)>=0&&t.slice(r,s)==e},Vn.eq=Vo,Vn.escape=function(t){return(t=_a(t))&&Z.test(t)?t.replace(J,on):t},Vn.escapeRegExp=function(t){return(t=_a(t))&&st.test(t)?t.replace(it,"\\$&"):t},Vn.every=function(t,e,r){var i=Go(t)?Re:mr;return r&&bs(t,e,r)&&(e=n),i(t,cs(e,3))},Vn.find=vo,Vn.findIndex=js,Vn.findKey=function(t,e){return Ve(t,cs(e,3),xr)},Vn.findLast=yo,Vn.findLastIndex=Ws,Vn.findLastKey=function(t,e){return Ve(t,cs(e,3),wr)},Vn.floor=xl,Vn.forEach=_o,Vn.forEachRight=bo,Vn.forIn=function(t,e){return null==t?t:_r(t,cs(e,3),Na)},Vn.forInRight=function(t,e){return null==t?t:br(t,cs(e,3),Na)},Vn.forOwn=function(t,e){return t&&xr(t,cs(e,3))},Vn.forOwnRight=function(t,e){return t&&wr(t,cs(e,3))},Vn.get=Aa,Vn.gt=Ho,Vn.gte=jo,Vn.has=function(t,e){return null!=t&&gs(t,e,Cr)},Vn.hasIn=Ca,Vn.head=qs,Vn.identity=il,Vn.includes=function(t,e,n,r){t=$o(t)?t:Va(t),n=n&&!r?ma(n):0;var i=t.length;return n<0&&(n=_n(i+n,0)),la(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&je(t,e,n)>-1},Vn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ma(n);return i<0&&(i=_n(r+i,0)),je(t,e,i)},Vn.inRange=function(t,e,r){return e=fa(e),r===n?(r=e,e=0):r=fa(r),function(t,e,n){return t>=bn(e,n)&&t<_n(e,n)}(t=va(t),e,r)},Vn.invoke=Ra,Vn.isArguments=Wo,Vn.isArray=Go,Vn.isArrayBuffer=qo,Vn.isArrayLike=$o,Vn.isArrayLikeObject=Xo,Vn.isBoolean=function(t){return!0===t||!1===t||na(t)&&Tr(t)==b},Vn.isBuffer=Jo,Vn.isDate=Yo,Vn.isElement=function(t){return na(t)&&1===t.nodeType&&!sa(t)},Vn.isEmpty=function(t){if(null==t)return!0;if($o(t)&&(Go(t)||"string"==typeof t||"function"==typeof t.splice||Jo(t)||ua(t)||Wo(t)))return!t.length;var e=ms(t);if(e==E||e==I)return!t.size;if(Ms(t))return!zr(t).length;for(var n in t)if(zt.call(t,n))return!1;return!0},Vn.isEqual=function(t,e){return Nr(t,e)},Vn.isEqualWith=function(t,e,r){var i=(r="function"==typeof r?r:n)?r(t,e):n;return i===n?Nr(t,e,n,r):!!i},Vn.isError=Zo,Vn.isFinite=function(t){return"number"==typeof t&&Be(t)},Vn.isFunction=Ko,Vn.isInteger=Qo,Vn.isLength=ta,Vn.isMap=ra,Vn.isMatch=function(t,e){return t===e||Or(t,e,hs(e))},Vn.isMatchWith=function(t,e,r){return r="function"==typeof r?r:n,Or(t,e,hs(e),r)},Vn.isNaN=function(t){return ia(t)&&t!=+t},Vn.isNative=function(t){if(Ss(t))throw new Et("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return kr(t)},Vn.isNil=function(t){return null==t},Vn.isNull=function(t){return null===t},Vn.isNumber=ia,Vn.isObject=ea,Vn.isObjectLike=na,Vn.isPlainObject=sa,Vn.isRegExp=oa,Vn.isSafeInteger=function(t){return Qo(t)&&t>=-d&&t<=d},Vn.isSet=aa,Vn.isString=la,Vn.isSymbol=ca,Vn.isTypedArray=ua,Vn.isUndefined=function(t){return t===n},Vn.isWeakMap=function(t){return na(t)&&ms(t)==N},Vn.isWeakSet=function(t){return na(t)&&"[object WeakSet]"==Tr(t)},Vn.join=function(t,e){return null==t?"":Xe.call(t,e)},Vn.kebabCase=Ga,Vn.last=Ys,Vn.lastIndexOf=function(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i;return r!==n&&(s=(s=ma(r))<0?_n(i+s,0):bn(s,i-1)),e===e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,s):He(t,Ge,s,!0)},Vn.lowerCase=qa,Vn.lowerFirst=$a,Vn.lt=ha,Vn.lte=da,Vn.max=function(t){return t&&t.length?gr(t,il,Ar):n},Vn.maxBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Ar):n},Vn.mean=function(t){return qe(t,il)},Vn.meanBy=function(t,e){return qe(t,cs(e,2))},Vn.min=function(t){return t&&t.length?gr(t,il,Fr):n},Vn.minBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Fr):n},Vn.stubArray=gl,Vn.stubFalse=vl,Vn.stubObject=function(){return{}},Vn.stubString=function(){return""},Vn.stubTrue=function(){return!0},Vn.multiply=wl,Vn.nth=function(t,e){return t&&t.length?Wr(t,ma(e)):n},Vn.noConflict=function(){return me._===this&&(me._=Ht),this},Vn.noop=cl,Vn.now=Ao,Vn.pad=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Gi(ve(i),n)+t+Gi(ge(i),n)},Vn.padEnd=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;return e&&r<e?t+Gi(e-r,n):t},Vn.padStart=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;return e&&r<e?Gi(e-r,n)+t:t},Vn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),wn(_a(t).replace(ot,""),e||0)},Vn.random=function(t,e,r){if(r&&"boolean"!=typeof r&&bs(t,e,r)&&(e=r=n),r===n&&("boolean"==typeof e?(r=e,e=n):"boolean"==typeof t&&(r=t,t=n)),t===n&&e===n?(t=0,e=1):(t=fa(t),e===n?(e=t,t=0):e=fa(e)),t>e){var i=t;t=e,e=i}if(r||t%1||e%1){var s=Sn();return bn(t+s*(e-t+he("1e-"+((s+"").length-1))),e)}return Jr(t,e)},Vn.reduce=function(t,e,n){var r=Go(t)?ze:Je,i=arguments.length<3;return r(t,cs(e,4),n,i,pr)},Vn.reduceRight=function(t,e,n){var r=Go(t)?Ue:Je,i=arguments.length<3;return r(t,cs(e,4),n,i,fr)},Vn.repeat=function(t,e,r){return e=(r?bs(t,e,r):e===n)?1:ma(e),Yr(_a(t),e)},Vn.replace=function(){var t=arguments,e=_a(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Vn.result=function(t,e,r){var i=-1,s=(e=bi(e,t)).length;for(s||(s=1,t=n);++i<s;){var o=null==t?n:t[zs(e[i])];o===n&&(i=s,o=r),t=Ko(o)?o.call(t):o}return t},Vn.round=Sl,Vn.runInContext=t,Vn.sample=function(t){return(Go(t)?Kn:Kr)(t)},Vn.size=function(t){if(null==t)return 0;if($o(t))return la(t)?pn(t):t.length;var e=ms(t);return e==E||e==I?t.size:zr(t).length},Vn.snakeCase=Xa,Vn.some=function(t,e,r){var i=Go(t)?Fe:si;return r&&bs(t,e,r)&&(e=n),i(t,cs(e,3))},Vn.sortedIndex=function(t,e){return oi(t,e)},Vn.sortedIndexBy=function(t,e,n){return ai(t,e,cs(n,2))},Vn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=oi(t,e);if(r<n&&Vo(t[r],e))return r}return-1},Vn.sortedLastIndex=function(t,e){return oi(t,e,!0)},Vn.sortedLastIndexBy=function(t,e,n){return ai(t,e,cs(n,2),!0)},Vn.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=oi(t,e,!0)-1;if(Vo(t[n],e))return n}return-1},Vn.startCase=Ja,Vn.startsWith=function(t,e,n){return t=_a(t),n=null==n?0:lr(ma(n),0,t.length),e=ui(e),t.slice(n,n+e.length)==e},Vn.subtract=Ml,Vn.sum=function(t){return t&&t.length?Ye(t,il):0},Vn.sumBy=function(t,e){return t&&t.length?Ye(t,cs(e,2)):0},Vn.template=function(t,e,r){var i=Vn.templateSettings;r&&bs(t,e,r)&&(e=n),t=_a(t),e=wa({},e,i,Qi);var s,o,a=wa({},e.imports,i.imports,Qi),l=La(a),c=tn(a,l),u=0,h=e.interpolate||wt,d="__p += '",p=Pt((e.escape||wt).source+"|"+h.source+"|"+(h===tt?ft:wt).source+"|"+(e.evaluate||wt).source+"|$","g"),f="//# sourceURL="+(zt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ae+"]")+"\n";t.replace(p,(function(e,n,r,i,a,l){return r||(r=i),d+=t.slice(u,l).replace(St,an),n&&(s=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+e.length,e})),d+="';\n";var m=zt.call(e,"variable")&&e.variable;if(m){if(dt.test(m))throw new Et("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(G,""):d).replace(q,"$1").replace($,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Qa((function(){return Tt(l,f+"return "+d).apply(n,c)}));if(g.source=d,Zo(g))throw g;return g},Vn.times=function(t,e){if((t=ma(t))<1||t>d)return[];var n=f,r=bn(t,f);e=cs(e),t-=f;for(var i=Ze(r,e);++n<t;)e(n);return i},Vn.toFinite=fa,Vn.toInteger=ma,Vn.toLength=ga,Vn.toLower=function(t){return _a(t).toLowerCase()},Vn.toNumber=va,Vn.toSafeInteger=function(t){return t?lr(ma(t),-d,d):0===t?t:0},Vn.toString=_a,Vn.toUpper=function(t){return _a(t).toUpperCase()},Vn.trim=function(t,e,r){if((t=_a(t))&&(r||e===n))return Ke(t);if(!t||!(e=ui(e)))return t;var i=fn(t),s=fn(e);return wi(i,nn(i,s),rn(i,s)+1).join("")},Vn.trimEnd=function(t,e,r){if((t=_a(t))&&(r||e===n))return t.slice(0,mn(t)+1);if(!t||!(e=ui(e)))return t;var i=fn(t);return wi(i,0,rn(i,fn(e))+1).join("")},Vn.trimStart=function(t,e,r){if((t=_a(t))&&(r||e===n))return t.replace(ot,"");if(!t||!(e=ui(e)))return t;var i=fn(t);return wi(i,nn(i,fn(e))).join("")},Vn.truncate=function(t,e){var r=30,i="...";if(ea(e)){var s="separator"in e?e.separator:s;r="length"in e?ma(e.length):r,i="omission"in e?ui(e.omission):i}var o=(t=_a(t)).length;if(ln(t)){var a=fn(t);o=a.length}if(r>=o)return t;var l=r-pn(i);if(l<1)return i;var c=a?wi(a,0,l).join(""):t.slice(0,l);if(s===n)return c+i;if(a&&(l+=c.length-l),oa(s)){if(t.slice(l).search(s)){var u,h=c;for(s.global||(s=Pt(s.source,_a(mt.exec(s))+"g")),s.lastIndex=0;u=s.exec(h);)var d=u.index;c=c.slice(0,d===n?l:d)}}else if(t.indexOf(ui(s),l)!=l){var p=c.lastIndexOf(s);p>-1&&(c=c.slice(0,p))}return c+i},Vn.unescape=function(t){return(t=_a(t))&&Y.test(t)?t.replace(X,gn):t},Vn.uniqueId=function(t){var e=++Ut;return _a(t)+e},Vn.upperCase=Ya,Vn.upperFirst=Za,Vn.each=_o,Vn.eachRight=bo,Vn.first=qs,ll(Vn,function(){var t={};return xr(Vn,(function(e,n){zt.call(Vn.prototype,n)||(t[n]=e)})),t}(),{chain:!1}),Vn.VERSION="4.17.21",Pe(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Vn[t].placeholder=Vn})),Pe(["drop","take"],(function(t,e){Gn.prototype[t]=function(r){r=r===n?1:_n(ma(r),0);var i=this.__filtered__&&!e?new Gn(this):this.clone();return i.__filtered__?i.__takeCount__=bn(r,i.__takeCount__):i.__views__.push({size:bn(r,f),type:t+(i.__dir__<0?"Right":"")}),i},Gn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Pe(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Gn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:cs(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),Pe(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Gn.prototype[t]=function(){return this[n](1).value()[0]}})),Pe(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Gn.prototype[t]=function(){return this.__filtered__?new Gn(this):this[n](1)}})),Gn.prototype.compact=function(){return this.filter(il)},Gn.prototype.find=function(t){return this.filter(t).head()},Gn.prototype.findLast=function(t){return this.reverse().find(t)},Gn.prototype.invokeMap=Zr((function(t,e){return"function"==typeof t?new Gn(this):this.map((function(n){return Rr(n,t,e)}))})),Gn.prototype.reject=function(t){return this.filter(Do(cs(t)))},Gn.prototype.slice=function(t,e){t=ma(t);var r=this;return r.__filtered__&&(t>0||e<0)?new Gn(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==n&&(r=(e=ma(e))<0?r.dropRight(-e):r.take(e-t)),r)},Gn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Gn.prototype.toArray=function(){return this.take(f)},xr(Gn.prototype,(function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),s=Vn[i?"take"+("last"==e?"Right":""):e],o=i||/^find/.test(e);s&&(Vn.prototype[e]=function(){var e=this.__wrapped__,a=i?[1]:arguments,l=e instanceof Gn,c=a[0],u=l||Go(e),h=function(t){var e=s.apply(Vn,De([t],a));return i&&d?e[0]:e};u&&r&&"function"==typeof c&&1!=c.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,f=o&&!d,m=l&&!p;if(!o&&u){e=m?e:new Gn(this);var g=t.apply(e,a);return g.__actions__.push({func:fo,args:[h],thisArg:n}),new Wn(g,d)}return f&&m?t.apply(this,a):(g=this.thru(h),f?i?g.value()[0]:g.value():g)})})),Pe(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Lt[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Vn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Go(i)?i:[],t)}return this[n]((function(n){return e.apply(Go(n)?n:[],t)}))}})),xr(Gn.prototype,(function(t,e){var n=Vn[e];if(n){var r=n.name+"";zt.call(Ln,r)||(Ln[r]=[]),Ln[r].push({name:e,func:n})}})),Ln[Vi(n,2).name]=[{name:"wrapper",func:n}],Gn.prototype.clone=function(){var t=new Gn(this.__wrapped__);return t.__actions__=Ii(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ii(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ii(this.__views__),t},Gn.prototype.reverse=function(){if(this.__filtered__){var t=new Gn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Gn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Go(t),r=e<0,i=n?t.length:0,s=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var s=n[r],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=bn(e,t+o);break;case"takeRight":t=_n(t,e-o)}}return{start:t,end:e}}(0,i,this.__views__),o=s.start,a=s.end,l=a-o,c=r?a:o-1,u=this.__iteratees__,h=u.length,d=0,p=bn(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return mi(t,this.__actions__);var f=[];t:for(;l--&&d<p;){for(var m=-1,g=t[c+=e];++m<h;){var v=u[m],y=v.iteratee,_=v.type,b=y(g);if(2==_)g=b;else if(!b){if(1==_)continue t;break t}}f[d++]=g}return f},Vn.prototype.at=mo,Vn.prototype.chain=function(){return po(this)},Vn.prototype.commit=function(){return new Wn(this.value(),this.__chain__)},Vn.prototype.next=function(){this.__values__===n&&(this.__values__=pa(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?n:this.__values__[this.__index__++]}},Vn.prototype.plant=function(t){for(var e,r=this;r instanceof jn;){var i=Fs(r);i.__index__=0,i.__values__=n,e?s.__wrapped__=i:e=i;var s=i;r=r.__wrapped__}return s.__wrapped__=t,e},Vn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Gn){var e=t;return this.__actions__.length&&(e=new Gn(this)),(e=e.reverse()).__actions__.push({func:fo,args:[to],thisArg:n}),new Wn(e,this.__chain__)}return this.thru(to)},Vn.prototype.toJSON=Vn.prototype.valueOf=Vn.prototype.value=function(){return mi(this.__wrapped__,this.__actions__)},Vn.prototype.first=Vn.prototype.head,Qt&&(Vn.prototype[Qt]=function(){return this}),Vn}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(me._=vn,define((function(){return vn}))):ve?((ve.exports=vn)._=vn,ge._=vn):me._=vn}).call(t)})),z_=O_(((t,e)=>{var n=1e3,r=60*n,i=60*r,s=24*i,o=7*s,a=365.25*s;function l(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}e.exports=function(t,e){e=e||{};var c=typeof t;if("string"===c&&t.length>0)return function(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var l=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*a;case"weeks":case"week":case"w":return l*o;case"days":case"day":case"d":return l*s;case"hours":case"hour":case"hrs":case"hr":case"h":return l*i;case"minutes":case"minute":case"mins":case"min":case"m":return l*r;case"seconds":case"second":case"secs":case"sec":case"s":return l*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}(t);if("number"===c&&isFinite(t))return e.long?function(t){var e=Math.abs(t);return e>=s?l(t,e,s,"day"):e>=i?l(t,e,i,"hour"):e>=r?l(t,e,r,"minute"):e>=n?l(t,e,n,"second"):t+" ms"}(t):function(t){var e=Math.abs(t);return e>=s?Math.round(t/s)+"d":e>=i?Math.round(t/i)+"h":e>=r?Math.round(t/r)+"m":e>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}})),U_=O_(((t,e)=>{e.exports=function(t){function e(t){let r,i,s,o=null;function a(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!a.enabled)return;let s=a,o=Number(new Date),l=o-(r||o);s.diff=l,s.prev=r,s.curr=o,r=o,n[0]=e.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");let c=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,((t,r)=>{if("%%"===t)return"%";c++;let i=e.formatters[r];if("function"==typeof i){let e=n[c];t=i.call(s,e),n.splice(c,1),c--}return t})),e.formatArgs.call(s,n),(s.log||e.log).apply(s,n)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=n,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function n(t,n){let r=e(this.namespace+(typeof n>"u"?":":n)+t);return r.log=this.log,r}function r(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){let t=[...e.names.map(r),...e.skips.map(r).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){e.save(t),e.namespaces=t,e.names=[],e.skips=[];let n,r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=z_(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e}})),F_=O_(((t,e)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch{}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:"/react-elden-ring-mind-map",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUPA_ANON:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdiZHlydXJ6eXlmbXVvYmVja2l0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjkzMzAyNDcsImV4cCI6MjA0NDkwNjI0N30.s5aKdX6BdWojAewKoJwCcvBVzCHJumwbe8cok9Z0yv4",REACT_APP_SUPA_URL:"https://gbdyrurzyyfmuobeckit.supabase.co",REACT_APP_SUPVIZ:"96ai280e79vr8qgpw42kk8gj7gixre"}.DEBUG),e},t.useColors=function(){if(typeof window<"u"&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch{}}(),t.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=U_()(t);var{formatters:n}=e.exports;n.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),B_=O_(((t,e)=>{e.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}})),V_=O_(((t,e)=>{var n="object"==typeof window&&window&&window.Object===Object&&window;e.exports=n})),H_=O_(((t,e)=>{var n=V_(),r="object"==typeof self&&self&&self.Object===Object&&self,i=n||r||Function("return this")();e.exports=i})),j_=O_(((t,e)=>{var n=H_();e.exports=function(){return n.Date.now()}})),W_=O_(((t,e)=>{var n=/\s/;e.exports=function(t){for(var e=t.length;e--&&n.test(t.charAt(e)););return e}})),G_=O_(((t,e)=>{var n=W_(),r=/^\s+/;e.exports=function(t){return t&&t.slice(0,n(t)+1).replace(r,"")}})),q_=O_(((t,e)=>{var n=H_().Symbol;e.exports=n})),$_=O_(((t,e)=>{var n=q_(),r=Object.prototype,i=r.hasOwnProperty,s=r.toString,o=n?n.toStringTag:void 0;e.exports=function(t){var e=i.call(t,o),n=t[o];try{t[o]=void 0;var r=!0}catch{}var a=s.call(t);return r&&(e?t[o]=n:delete t[o]),a}})),X_=O_(((t,e)=>{var n=Object.prototype.toString;e.exports=function(t){return n.call(t)}})),J_=O_(((t,e)=>{var n=q_(),r=$_(),i=X_(),s=n?n.toStringTag:void 0;e.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":s&&s in Object(t)?r(t):i(t)}})),Y_=O_(((t,e)=>{e.exports=function(t){return null!=t&&"object"==typeof t}})),Z_=O_(((t,e)=>{var n=J_(),r=Y_();e.exports=function(t){return"symbol"==typeof t||r(t)&&"[object Symbol]"==n(t)}})),K_=O_(((t,e)=>{var n=G_(),r=B_(),i=Z_(),s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,a=/^0o[0-7]+$/i,l=parseInt;e.exports=function(t){if("number"==typeof t)return t;if(i(t))return NaN;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=n(t);var c=o.test(t);return c||a.test(t)?l(t.slice(2),c?2:8):s.test(t)?NaN:+t}})),Q_=O_(((t,e)=>{var n=B_(),r=j_(),i=K_(),s=Math.max,o=Math.min;e.exports=function(t,e,a){var l,c,u,h,d,p,f=0,m=!1,g=!1,v=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var n=l,r=c;return l=c=void 0,f=e,h=t.apply(r,n)}function _(t){var n=t-p;return void 0===p||n>=e||n<0||g&&t-f>=u}function b(){var t=r();if(_(t))return x(t);d=setTimeout(b,function(t){var n=e-(t-p);return g?o(n,u-(t-f)):n}(t))}function x(t){return d=void 0,v&&l?y(t):(l=c=void 0,h)}function w(){var t=r(),n=_(t);if(l=arguments,c=this,p=t,n){if(void 0===d)return function(t){return f=t,d=setTimeout(b,e),m?y(t):h}(p);if(g)return clearTimeout(d),d=setTimeout(b,e),y(p)}return void 0===d&&(d=setTimeout(b,e)),h}return e=i(e)||0,n(a)&&(m=!!a.leading,u=(g="maxWait"in a)?s(i(a.maxWait)||0,e):u,v="trailing"in a?!!a.trailing:v),w.cancel=function(){void 0!==d&&clearTimeout(d),f=0,l=p=c=d=void 0},w.flush=function(){return void 0===d?h:x(r())},w}})),tb=O_(((t,e)=>{var n=Q_(),r=B_();e.exports=function(t,e,i){var s=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return r(i)&&(s="leading"in i?!!i.leading:s,o="trailing"in i?!!i.trailing:o),n(t,e,{leading:s,maxWait:e,trailing:o})}})),eb=k_(D_()),nb="srgb",rb="srgb-linear",ib="display-p3",sb="display-p3-linear",ob="linear",ab="srgb",lb="rec709";function cb(t,e,n){return Math.max(e,Math.min(n,t))}function ub(t,e,n){return(1-n)*t+n*e}var hb=class t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(cb(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},db=class t{constructor(e,n,r,i,s,o,a,l,c){t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,n,r,i,s,o,a,l,c)}set(t,e,n,r,i,s,o,a,l){let c=this.elements;return c[0]=t,c[1]=r,c[2]=o,c[3]=e,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],_=r[7],b=r[2],x=r[5],w=r[8];return i[0]=s*f+o*v+a*b,i[3]=s*m+o*y+a*x,i[6]=s*g+o*_+a*w,i[1]=l*f+c*v+u*b,i[4]=l*m+c*y+u*x,i[7]=l*g+c*_+u*w,i[2]=h*f+d*v+p*b,i[5]=h*m+d*y+p*x,i[8]=h*g+d*_+p*w,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*i*c+n*o*a+r*i*l-r*s*a}invert(){let t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=c*s-o*l,h=o*a-c*i,d=l*i-s*a,p=e*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return t[0]=u*f,t[1]=(r*l-c*n)*f,t[2]=(o*n-r*s)*f,t[3]=h*f,t[4]=(c*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){let a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(pb.makeScale(t,e)),this}rotate(t){return this.premultiply(pb.makeRotation(-t)),this}translate(t,e){return this.premultiply(pb.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){let e=this.elements,n=t.elements;for(let r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}},pb=new db,fb=(new db).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),mb=(new db).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),gb={[rb]:{transfer:ob,primaries:lb,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t,fromReference:t=>t},[nb]:{transfer:ab,primaries:lb,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[sb]:{transfer:ob,primaries:"p3",luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.applyMatrix3(mb),fromReference:t=>t.applyMatrix3(fb)},[ib]:{transfer:ab,primaries:"p3",luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.convertSRGBToLinear().applyMatrix3(mb),fromReference:t=>t.applyMatrix3(fb).convertLinearToSRGB()}},vb=new Set([rb,sb]),yb={enabled:!0,_workingColorSpace:rb,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!vb.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(!1===this.enabled||e===n||!e||!n)return t;let r=gb[e].toReference;return(0,gb[n].fromReference)(r(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return gb[t].primaries},getTransfer:function(t){return""===t?ob:gb[t].transfer},getLuminanceCoefficients:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._workingColorSpace;return t.fromArray(gb[e].luminanceCoefficients)}};function _b(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function bb(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}var xb=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=r}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],h=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===o)return t[e+0]=h,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(u!==f||a!==h||l!==d||c!==p){let t=1-o,e=a*h+l*d+c*p+u*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){let i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}let i=o*n;if(a=a*t+h*i,l=l*t+d*i,c=c*t+p*i,u=u*t+f*i,t===1-o){let t=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=t,l*=t,c*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,r,i,s){let o=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[s],h=i[s+1],d=i[s+2],p=i[s+3];return t[e]=o*p+c*u+a*d-l*h,t[e+1]=a*p+c*h+l*u-o*d,t[e+2]=l*p+c*d+o*h-a*u,t[e+3]=c*p-o*u-a*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){let t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>u){let t=2*Math.sqrt(1+n-o-u);this._w=(c-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>u){let t=2*Math.sqrt(1+o-n-u);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+c)/t}else{let t=2*Math.sqrt(1+u-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(cb(this.dot(t),-1,1)))}rotateTowards(t,e){let n=this.angleTo(t);if(0===n)return this;let r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+r*l-i*a,this._y=r*c+s*a+i*o-n*l,this._z=i*c+s*l+n*a-r*o,this._w=s*c-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);let n=this._x,r=this._y,i=this._z,s=this._w,o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;let a=1-o*o;if(a<=Number.EPSILON){let t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this}let l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){let t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(t),r*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},wb=class t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Mb.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Mb.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){let e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=2*(s*r-o*n),c=2*(o*e-i*r),u=2*(i*n-s*e);return this.x=e+a*l+s*u-o*c,this.y=n+a*c+o*l-i*u,this.z=r+a*u+i*c-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){let e=t.lengthSq();if(0===e)return this.set(0,0,0);let n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Sb.copy(this).projectOnVector(t),this.sub(Sb)}reflect(t){return this.sub(Sb.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(cb(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){let r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},Sb=new wb,Mb=new xb;new wb,new wb(0,0,0),new wb(1,1,1),new wb,new wb,new wb,new wb,new wb,new wb,new wb,new wb(1,0,0),new wb(0,1,0),new wb(0,0,1),new wb(0,1,0);var Eb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Tb={h:0,s:0,l:0},Ab={h:0,s:0,l:0};function Cb(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}var Pb=class{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){let e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nb;return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,yb.toWorkingColorSpace(this,e),this}setRGB(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:yb.workingColorSpace;return this.r=t,this.g=e,this.b=n,yb.toWorkingColorSpace(this,r),this}setHSL(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:yb.workingColorSpace;if(t=function(t,e){return(t%e+e)%e}(t,1),e=cb(e,0,1),n=cb(n,0,1),0===e)this.r=this.g=this.b=n;else{let r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=Cb(i,r,t+1/3),this.g=Cb(i,r,t),this.b=Cb(i,r,t-1/3)}return yb.toWorkingColorSpace(this,r),this}setStyle(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nb;function r(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(e=/^(\w+)\(([^\)]*)\)/.exec(t)){let i,s=e[1],o=e[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,n);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,n);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(t)){let r=e[1],i=r.length;if(3===i)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,n);if(6===i)return this.setHex(parseInt(r,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nb,n=Eb[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=_b(t.r),this.g=_b(t.g),this.b=_b(t.b),this}copyLinearToSRGB(t){return this.r=bb(t.r),this.g=bb(t.g),this.b=bb(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nb;return yb.fromWorkingColorSpace(Ib.copy(this),t),65536*Math.round(cb(255*Ib.r,0,255))+256*Math.round(cb(255*Ib.g,0,255))+Math.round(cb(255*Ib.b,0,255))}getHexString(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nb;return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yb.workingColorSpace;yb.fromWorkingColorSpace(Ib.copy(this),e);let n,r,i=Ib.r,s=Ib.g,o=Ib.b,a=Math.max(i,s,o),l=Math.min(i,s,o),c=(l+a)/2;if(l===a)n=0,r=0;else{let t=a-l;switch(r=c<=.5?t/(a+l):t/(2-a-l),a){case i:n=(s-o)/t+(s<o?6:0);break;case s:n=(o-i)/t+2;break;case o:n=(i-s)/t+4}n/=6}return t.h=n,t.s=r,t.l=c,t}getRGB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yb.workingColorSpace;return yb.fromWorkingColorSpace(Ib.copy(this),e),t.r=Ib.r,t.g=Ib.g,t.b=Ib.b,t}getStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nb;yb.fromWorkingColorSpace(Ib.copy(this),t);let e=Ib.r,n=Ib.g,r=Ib.b;return t!==nb?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(t,e,n){return this.getHSL(Tb),this.setHSL(Tb.h+t,Tb.s+e,Tb.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Tb),t.getHSL(Ab);let n=ub(Tb.h,Ab.h,e),r=ub(Tb.s,Ab.s,e),i=ub(Tb.l,Ab.l,e);return this.setHSL(n,r,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){let e=this.r,n=this.g,r=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*r,this.g=i[1]*e+i[4]*n+i[7]*r,this.b=i[2]*e+i[5]*n+i[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},Ib=new Pb;function Rb(t){let e={};for(let n in t){e[n]={};for(let r in t[n]){let i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function Lb(t){let e={};for(let n=0;n<t.length;n++){let r=Rb(t[n]);for(let t in r)e[t]=r[t]}return e}Pb.NAMES=Eb;var Nb={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Ob={common:{diffuse:{value:new Pb(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new db},alphaMap:{value:null},alphaMapTransform:{value:new db},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new db}},envmap:{envMap:{value:null},envMapRotation:{value:new db},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new db}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new db}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new db},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new db},normalScale:{value:new hb(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new db},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new db}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new db}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new db}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Pb(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Pb(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new db},alphaTest:{value:0},uvTransform:{value:new db}},sprite:{diffuse:{value:new Pb(16777215)},opacity:{value:1},center:{value:new hb(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new db},alphaMap:{value:null},alphaMapTransform:{value:new db},alphaTest:{value:0}}},kb={basic:{uniforms:Lb([Ob.common,Ob.specularmap,Ob.envmap,Ob.aomap,Ob.lightmap,Ob.fog]),vertexShader:Nb.meshbasic_vert,fragmentShader:Nb.meshbasic_frag},lambert:{uniforms:Lb([Ob.common,Ob.specularmap,Ob.envmap,Ob.aomap,Ob.lightmap,Ob.emissivemap,Ob.bumpmap,Ob.normalmap,Ob.displacementmap,Ob.fog,Ob.lights,{emissive:{value:new Pb(0)}}]),vertexShader:Nb.meshlambert_vert,fragmentShader:Nb.meshlambert_frag},phong:{uniforms:Lb([Ob.common,Ob.specularmap,Ob.envmap,Ob.aomap,Ob.lightmap,Ob.emissivemap,Ob.bumpmap,Ob.normalmap,Ob.displacementmap,Ob.fog,Ob.lights,{emissive:{value:new Pb(0)},specular:{value:new Pb(1118481)},shininess:{value:30}}]),vertexShader:Nb.meshphong_vert,fragmentShader:Nb.meshphong_frag},standard:{uniforms:Lb([Ob.common,Ob.envmap,Ob.aomap,Ob.lightmap,Ob.emissivemap,Ob.bumpmap,Ob.normalmap,Ob.displacementmap,Ob.roughnessmap,Ob.metalnessmap,Ob.fog,Ob.lights,{emissive:{value:new Pb(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Nb.meshphysical_vert,fragmentShader:Nb.meshphysical_frag},toon:{uniforms:Lb([Ob.common,Ob.aomap,Ob.lightmap,Ob.emissivemap,Ob.bumpmap,Ob.normalmap,Ob.displacementmap,Ob.gradientmap,Ob.fog,Ob.lights,{emissive:{value:new Pb(0)}}]),vertexShader:Nb.meshtoon_vert,fragmentShader:Nb.meshtoon_frag},matcap:{uniforms:Lb([Ob.common,Ob.bumpmap,Ob.normalmap,Ob.displacementmap,Ob.fog,{matcap:{value:null}}]),vertexShader:Nb.meshmatcap_vert,fragmentShader:Nb.meshmatcap_frag},points:{uniforms:Lb([Ob.points,Ob.fog]),vertexShader:Nb.points_vert,fragmentShader:Nb.points_frag},dashed:{uniforms:Lb([Ob.common,Ob.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Nb.linedashed_vert,fragmentShader:Nb.linedashed_frag},depth:{uniforms:Lb([Ob.common,Ob.displacementmap]),vertexShader:Nb.depth_vert,fragmentShader:Nb.depth_frag},normal:{uniforms:Lb([Ob.common,Ob.bumpmap,Ob.normalmap,Ob.displacementmap,{opacity:{value:1}}]),vertexShader:Nb.meshnormal_vert,fragmentShader:Nb.meshnormal_frag},sprite:{uniforms:Lb([Ob.sprite,Ob.fog]),vertexShader:Nb.sprite_vert,fragmentShader:Nb.sprite_frag},background:{uniforms:{uvTransform:{value:new db},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Nb.background_vert,fragmentShader:Nb.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new db}},vertexShader:Nb.backgroundCube_vert,fragmentShader:Nb.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Nb.cube_vert,fragmentShader:Nb.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Nb.equirect_vert,fragmentShader:Nb.equirect_frag},distanceRGBA:{uniforms:Lb([Ob.common,Ob.displacementmap,{referencePosition:{value:new wb},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Nb.distanceRGBA_vert,fragmentShader:Nb.distanceRGBA_frag},shadow:{uniforms:Lb([Ob.lights,Ob.fog,{color:{value:new Pb(0)},opacity:{value:1}}]),vertexShader:Nb.shadow_vert,fragmentShader:Nb.shadow_frag}};kb.physical={uniforms:Lb([kb.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new db},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new db},clearcoatNormalScale:{value:new hb(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new db},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new db},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new db},sheen:{value:0},sheenColor:{value:new Pb(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new db},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new db},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new db},transmissionSamplerSize:{value:new hb},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new db},attenuationDistance:{value:0},attenuationColor:{value:new Pb(0)},specularColor:{value:new Pb(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new db},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new db},anisotropyVector:{value:new hb},anisotropyMap:{value:null},anisotropyMapTransform:{value:new db}}]),vertexShader:Nb.meshphysical_vert,fragmentShader:Nb.meshphysical_frag};var Db=(1+Math.sqrt(5))/2,zb=1/Db;new wb(-Db,zb,0),new wb(Db,zb,0),new wb(-zb,0,Db),new wb(zb,0,Db),new wb(0,Db,-zb),new wb(0,Db,zb),new wb(-1,1,-1),new wb(1,1,-1),new wb(-1,1,1),new wb(1,1,1);var Ub="\\[\\]\\.:\\/",Fb="[^"+Ub+"]",Bb="[^"+Ub.replace("\\.","")+"]";/((?:WC+[\/:])*)/.source.replace("WC",Fb),/(WCOD+)?/.source.replace("WCOD",Bb),/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Fb),/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Fb),typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"167"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="167");var Vb,Hb=(t=>(t[t.x=0]="x",t[t.y=0]="y",t[t.z=0]="z",t))(Hb||{}),jb=k_(F_()),Wb=class{constructor(t){this.debug=(0,jb.default)(t)}log(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.debug(t,...n)}},Gb=function(){this.onInit=function(){this.THREE=this.context.three,this.curVector=new this.THREE.Vector3(0,0,0),this.destVector=new this.THREE.Vector3(0,0,0),this.curQuaternion=new this.THREE.Quaternion(0,0,0,0),this.destQuaternion=new this.THREE.Quaternion(0,0,0,0),this.vectorToSet=null,this.quatToSet=null,this.vectorCounter=0,this.quatCounter=0,this.speed=1.25},this.onTick=function(t){if(this.vectorToSet){if(this.vectorToSet.equals(this.destVector)&&this.vectorCounter>120)return;this.vectorCounter++,this.curVector.lerp(this.destVector,t/1e3*this.speed),this.vectorToSet.set(this.curVector.x,this.curVector.y,this.curVector.z)}if(this.quatToSet){if(this.quatToSet.equals(this.destQuaternion)&&this.quatCounter>120)return;this.quatCounter++,this.curQuaternion.slerp(this.destQuaternion,t/1e3*this.speed),this.quatToSet.set(this.curQuaternion.x,this.curQuaternion.y,this.curQuaternion.z,this.curQuaternion.w)}},this.animateVector=function(t,e){this.vectorCounter=0,this.destVector=e,this.vectorToSet=t},this.animateQuaternion=function(t,e){this.quatCounter=0,this.destQuaternion=e,this.quatToSet=t},this.onEvent=function(){},this.onInputsUpdated=function(){},this.onDestroy=function(){}},qb=()=>new Gb,$b=function(){this.onInit=function(){this.THREE=this.context.three},this.onTick=function(t){},this.onEvent=function(){},this.onInputsUpdated=function(){},this.onDestroy=function(){},this.createName=async(t,e,n,r)=>{let i=t,s=r,o=(null==n?void 0:n.color)??"#878291",a=(null==n?void 0:n.textColor)??"#fff",l=new FontFace("OpenSans-SemiBold","url(https://superviz2homologmediaserver.s3.amazonaws.com/static/fonts/OpenSans-SemiBold.woff)");await l.load(),document.fonts.add(l);let c=this.createText(e,a,o);return c.position.set(0,s,0),i.add(c),c},this.createText=(t,e,n)=>{let r=document.createElement("canvas"),i=r.getContext("2d"),s=1e3,o=.03,a=100*i.measureText(t).width*1.12;r.width=a,r.height=s,i.font="1000px OpenSans-SemiBold",i.textBaseline="middle",i.fillStyle=e,i.fillText(t,0,500);let l=new this.THREE.Texture(r);l.needsUpdate=!0;let c=new this.THREE.SpriteMaterial({map:l,useScreenCoordinates:!1,opacity:1,alphaTest:.5,depthTest:!0,transparent:!0}),u=new this.THREE.Sprite(c);u.raycast=()=>null;let h=new this.THREE.Object3D;h.textHeight=o,h.textWidth=a/s*h.textHeight,u.scale.set(a/s*o,o,1);let d=document.createElement("canvas");d.width=a+10,d.height=1010;let p=d.getContext("2d"),f=this.addAlpha(n.split("#")[1],.99);p.fillStyle=`#${f}`,p.beginPath(),p.roundRect(-15,0,d.width,.9*d.height,d.width),p.fill();let m=new this.THREE.Texture(d);m.needsUpdate=!0;let g=new this.THREE.SpriteMaterial({opacity:.99,transparent:!1,useScreenCoordinates:!1,alphaTest:.1,color:new this.THREE.Color(n),map:m}),v=new this.THREE.Sprite(g);return v.scale.set(1.18,1.25,1.1),u.add(v),h.add(u),h},this.addAlpha=(t,e)=>t+Math.round(255*Math.min(Math.max(e||1,0),1)).toString(16).toUpperCase()},Xb=()=>new $b,Jb=function(){var t=this;this.inputs={origin:{x:0,y:0,z:0}},this.onInit=function(){this.THREE=this.context.three,this.destPos=new this.THREE.Vector3(0,0,0),this.curPos=new this.THREE.Vector3(0,0,0),this.startPos=new this.THREE.Vector3(0,0,0),this.counter=0,this.slot=null,this.lastIndex=-1,this.lastDestPos=new this.THREE.Vector3(1e3,1e3,1e3),this.lastStartPos=new this.THREE.Vector3(1e3,1e3,1e3),this.speed=.95,this.tempStartPos=new this.THREE.Vector3(0,0,0),this.quat=new this.THREE.Quaternion(0,0,0,0)},this.onTick=function(t){var e,n;this.createdMaterial&&(this.counter>60&&this.lastDestPos.equals(this.destPos)&&this.lastStartPos.distanceTo(this.startPos)<.2||(this.counter++,this.lastIndex!==(null==(e=this.slot)?void 0:e.index)&&this.material&&(this.material.color.set(""),this.lastIndex=null==(n=this.slot)?void 0:n.index),this.curPos.lerp(this.destPos,t/1e3*this.speed),this.lastDestPos.x=this.destPos.x,this.lastDestPos.y=this.destPos.y,this.lastDestPos.z=this.destPos.z,this.lastStartPos.x=this.startPos.x,this.lastStartPos.y=this.startPos.y,this.lastStartPos.z=this.startPos.z,this._updateMesh(this.startPos,this.curPos),this.outputs.objectRoot.visible=this.isOn&&this.shouldRenderAvatars))},this.onDestroy=function(){this.material&&this.material.dispose()},this.createMaterial=t=>{var e;this.createdMaterial=!0;let n=this.createTextureCanvas(),r=new this.THREE.Texture(n);r.needsUpdate=!0;let i=(null==(e=this.slot)?void 0:e.color)??t??"#878291";this.material=new this.THREE.MeshBasicMaterial({map:r,blending:this.THREE.AdditiveBlending,color:i,side:this.THREE.DoubleSide,depthWrite:!0,transparent:!0})},this._updateMesh=(t,e)=>{this.tempStartPos.copy(this.inputs.origin),this.tempStartPos.applyQuaternion(this.quat),this.tempStartPos.add(t);let n=new this.THREE.LineCurve3(this.tempStartPos,e);this.outputs.objectRoot&&this.outputs.objectRoot.geometry&&this.outputs.objectRoot.geometry.dispose();let r=new this.THREE.TubeGeometry(n,1,.003,4,!1);this.material&&(this.outputs.objectRoot=new this.THREE.Mesh(r,this.material))},this._doUpdateGeometry=function(e,n,r,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{x:0,y:0,z:0};t.slot=r,t.createdMaterial||t.createMaterial(t.slot),t.destPos.x=o.x,t.destPos.y=o.y,t.destPos.z=o.z,t.startPos.x=s.x,t.startPos.y=s.y,t.startPos.z=s.z,t.quat.set(i.x,i.y,i.z,i.w),t.counter=0,t.isOn=e,t.shouldRenderAvatars=n},this.updateGeometry=(t,e,n,r,i,s)=>{this._doUpdateGeometry(n,r,i,s,t,e)},this.createTextureCanvas=()=>{let t=document.createElement("canvas"),e=t.getContext("2d");t.width=1,t.height=64;let n=e.createLinearGradient(0,0,t.width,t.height);return n.addColorStop(0,"rgba(  0,  0,  0,0.1)"),n.addColorStop(.1,"rgba(160,160,160,0.3)"),n.addColorStop(.5,"rgba(255,255,255,0.5)"),n.addColorStop(.9,"rgba(160,160,160,0.3)"),n.addColorStop(1,"rgba(  0,  0,  0,0.1)"),e.fillStyle=n,e.fillRect(0,0,t.width,t.height),t},this.onEvent=function(t,e){},this.onInputsUpdated=function(t){}},Yb=()=>new Jb,Zb="https://production.storage.superviz.com/readyplayerme/1.glb",Kb="global-store",Qb="presence-3d-store",tx=k_(tb()),ex=class{constructor(){var t=this;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.subscribe=t=>{this.callbacks.push(t)},this.unsubscribe=t=>{this.callbacks=this.callbacks.filter((e=>e!==t))},this.publish=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.callbacks&&t.callbacks.forEach((e=>{t.callListener(e,n).catch((r=>{t.logger.log("superviz-sdk:observer-helper:publish:error",`\n            Failed to execute callback on publish value.\n            Callback: ${e}\n            Event: ${JSON.stringify(n)}\n            Error: ${r}\n          `)}))}))},this.reset=()=>{this.callbacks=[]},this.destroy=()=>{delete this.logger,delete this.callbacks},this.callListener=(t,e)=>new Promise(((n,r)=>{try{n(t(...e))}catch(i){r(i)}}));let{logger:n,throttleTime:r}=e;this.logger=n??new Wb("@superviz/sdk/observer-helper"),this.throttle=r,this.callbacks=[],this.throttle&&(this.publish=(0,tx.default)(this.publish,this.throttle))}},nx=class{constructor(){this.eventType="INTERACTION.CLICK"}onEvent(){Vb.onClick()}};function rx(e){let{children:n,elementId:r,onMount:i,onUnmount:s,...o}=e;var a;const[l,c]=(0,t.useState)(null),{room:u,component:h,addComponent:d}=zn("presence"),p={mount:i,unmount:s},f=(0,t.useCallback)((t=>{var e,n;null!=(e=o.callbacks)&&e.onGoToPresence&&(null==(n=o.callbacks)||n.onGoToPresence(t))}),[null==(a=o.callbacks)?void 0:a.onGoToPresence]);return(0,t.useEffect)((()=>{h&&Object.entries(p).forEach((t=>{let[e,n]=t;h.unsubscribe(e,n),n&&h.subscribe(e,n)}))}),[h,u,i,s]),(0,t.useEffect)((()=>{if(!u||l||!document.getElementById(r))return;const t=new Cn.F(r,{callbacks:{onGoToPresence:f}});d(t),c(Date.now())}),[u,r]),(0,t.useEffect)((()=>{!h&&l&&c(null)}),[h]),n??Ln.jsx(Ln.Fragment,{})}function ix(e){let{onStateChange:n,onMount:r,onUnmount:i}=e;const{room:s,component:o,addComponent:a}=zn("realtime"),[l,c]=(0,t.useState)(null);return(0,t.useEffect)((()=>{if(!s||l)return;const t=new Cn.B;a(t),c(Date.now()),n&&t.subscribe(Cn.b.REALTIME_STATE_CHANGED,n),r&&r()}),[s]),(0,t.useEffect)((()=>{!o&&l&&(c(null),i&&i())}),[o]),Ln.jsx(Ln.Fragment,{})}typeof window<"u"&&(window.Presence3D=class{constructor(t,e){var n,r,i;this.participants=[],this.roomParticipants={},this.isAttached=!1,this.localSlot=-1,this.currentCirclePosition=Hb,this.currentLocalPosition=Hb,this.currentLocalRotation=Hb,this.currentLocalLaserDest=Hb,this.circlePositions=[],this.avatars={},this.lasers={},this.laserUpdateIntervals={},this.positionInfos={},this.tempQuaternion=new xb(0,0,0,0),this.isSweeping=!1,this.unsubscribeFrom=[],this.hasJoinedRoom=!1,this.hasJoined3D=!1,this.attach=t=>{if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){let t=`${this.name} @ attach - params are required`;throw this.logger.log(t),new Error(t)}this.logger.log("attached");let{eventBus:e,useStore:n,ioc:r,Presence3DManagerService:i}=t;this.useStore=n.bind(this),this.room=r.createRoom(this.name),this.presence3DManager=new i(this.room,this.useStore);let{localParticipant:s,hasJoinedRoom:o}=this.useStore(Kb);s.subscribe(),o.subscribe();let{hasJoined3D:a,participants:l}=this.useStore(Qb);a.subscribe(),l.subscribe(this.onParticipantsUpdated),this.isAttached=!0,this.eventBus=e,this.start()},this.detach=()=>{this.isAttached?(this.logger.log("detached"),this.destroy(),this.unsubscribeFrom.forEach((t=>t(this))),this.localParticipant=void 0,this.isAttached=!1):this.logger.log(`${this.name} @ detach - component is not attached}`)},this.destroy=()=>{this.unsubscribeToRealtimeEvents(),this.unsubscribeToEventBusEvents(),this.room.disconnect(),this.room=void 0,this.participants.forEach((t=>{this.presence3DManager.unsubscribeFromUpdates(t.id,this.onParticipantUpdated)})),this.presence3DManager=void 0,this.useStore(Qb).destroy(),this.useStore=void 0,this.isAttached=!1,this.ambientLight.stop(),this.directionalLight.stop(),this.participants.forEach((t=>{this.removeParticipant(t,!0)})),Object.keys(this.laserUpdateIntervals).forEach((t=>{clearInterval(this.laserUpdateIntervals[t])})),this.participants=[],this.laserUpdateIntervals={},this.avatars={},this.lasers={}},this.start=()=>{if(!this.hasJoinedRoom||!this.hasJoined3D)return this.logger.log("matterport component @ start - not joined yet"),void setTimeout((()=>{this.logger.log("matterport component @ start - retrying"),this.start()}),1e3);this.subscribeToRealtimeEvents(),this.subscribeToEventBusEvents(),this.createParticipantList()},this.subscribeToRealtimeEvents=()=>{this.logger.log("matterport component @ subscribeToRealtimeEvents"),this.room.on("participant-joined",this.onParticipantJoined),this.room.presence.on("presence.leave",this.onParticipantLeave),this.room.on("gather",this.onGatherUpdate),this.room.on("follow-me",this.onFollowParticipantUpdate)},this.unsubscribeToRealtimeEvents=()=>{this.logger.log("matterport component @ unsubscribeToRealtimeEvents"),this.room.presence.off("presence.leave"),this.room.off("participant-joined",this.onParticipantJoined),this.room.off("gather",this.onGatherUpdate),this.room.off("follow-me",this.onFollowParticipantUpdate)},this.subscribeToEventBusEvents=()=>{this.logger.log("matterport component @ subscribeToEventBusEvents"),this.eventBus.subscribe("realtime.go-to-participant",this.goTo),this.eventBus.subscribe("realtime.local-follow-participant",this.localFollow),this.eventBus.subscribe("realtime.follow-participant",this.follow),this.eventBus.subscribe("realtime.private-mode",this.setPrivate)},this.unsubscribeToEventBusEvents=()=>{this.logger.log("matterport component @ unsubscribeToEventBusEvents"),this.eventBus.unsubscribe("realtime.go-to-participant",this.goTo),this.eventBus.unsubscribe("realtime.local-follow-participant",this.localFollow),this.eventBus.unsubscribe("realtime.private-mode",this.setPrivate),this.eventBus.unsubscribe("realtime.follow-participant",this.follow)},this.onParticipantJoined=t=>{if(!t.data)return;this.logger.log("matterport component @ onParticipantJoined",t);let{id:e,name:n,avatar:r,avatarConfig:i,type:s,slot:o}=t.data;e!==this.localParticipantId?this.addParticipant({id:e,name:n,avatar:r,avatarConfig:i,type:s,slot:o}):this.onLocalParticipantJoined(t.data)},this.onLocalParticipantJoined=t=>{var e,n,r,i;this.createParticipantList(),this.config.avatarConfig&&this.presence3DManager.setParticipantData({avatarConfig:this.config.avatarConfig}),null!=(e=t.avatar)&&e.model3DUrl&&this.presence3DManager.setParticipantData({avatar:{model3DUrl:null==t?void 0:t.avatar.model3DUrl,imageUrl:null==(n=null==t?void 0:t.avatar)?void 0:n.imageUrl}}),null!=(r=t.avatar)&&r.model3DUrl||this.presence3DManager.setParticipantData({avatar:{model3DUrl:Zb,imageUrl:null==(i=null==t?void 0:t.avatar)?void 0:i.imageUrl}})},this.onParticipantLeave=t=>{this.logger.log("matterport component @ onParticipantLeave",t.data);let e=this.participants.find((e=>e.id===t.id));e&&this.removeParticipant(e,!0)},this.onParticipantUpdated=t=>{this.logger.log("matterport component @ onParticipantUpdated",t);let{id:e,name:n,avatar:r,avatarConfig:i,position:s,rotation:o,type:a,slot:l}=t.data??t;this.updateParticipant({position:s,rotation:o,id:e,name:n,avatar:r,avatarConfig:i,type:a,slot:l}),(this.localFollowParticipantId||this.followParticipantId)&&this.moveToAnotherParticipant(this.localFollowParticipantId??this.followParticipantId)},this.updateParticipant=async t=>{var e,n;if(!this.participants||0===this.participants.length||!t||!t.id||t.id===this.localParticipantId)return;let r=this.participants.find((e=>e.id===t.id));if(r){if((null==(e=r.avatar)?void 0:e.model3DUrl)===(null==(n=t.avatar)?void 0:n.model3DUrl)&&(0,eb.isEqual)(r.avatarConfig,t.avatarConfig)&&r.name===t.name){let e=this.participants.findIndex((e=>e.id===t.id));-1!==e&&(this.participants[e]=t)}else{this.removeParticipant(t,!1);let e=this.createParticipantOn3D(t);this.participants.push(e),this.config.isAvatarsEnabled&&await this.createAvatar(e),this.config.isLaserEnabled&&this.createLaser(e),this.config.isNameEnabled&&this.createName(e,this.avatars[t.id])}this.logger.log("matterport component @ updateParticipant",{participant:t,participants:this.participants})}else this.addParticipant(t)},this.onFollowParticipantUpdate=t=>{t.data.id!==this.localParticipantId&&(this.logger.log("three js component @ onFollowParticipantUpdate",t.data.id),this.followParticipantId=t.data.id,this.moveToAnotherParticipant(t.data.id))},this.onGatherUpdate=t=>{this.logger.log("three js component @ onGatherUpdate",t.data.id),t.data.id!==this.localParticipantId&&this.eventBus.publish("realtime.go-to-participant",t.data.id)},this.createParticipantList=()=>{let t=this.useStore(Qb).participants.value;Object.values(t).forEach((t=>{t.isPrivate||this.addParticipant(t)})),this.logger.log("matterport component @ createParticipantList",this.participants)},this.createParticipantOn3D=t=>{let{id:e,name:n,avatar:r,avatarConfig:i,type:s,slot:o}=t,a={id:e,name:n,avatar:r,isAudience:"audience"===s,avatarConfig:e===this.localParticipantId?this.config.avatarConfig:i,position:{x:0,y:0,z:0},rotation:{x:0,y:0},slot:o};return this.logger.log("matterport component @ createParticipantOn3D",a),a},this.removeParticipant=(t,e)=>{var n;this.logger.log("matterport component @ removeParticipant",{participant:t,unsubscribe:e}),this.participants=this.participants.filter((e=>e.id!==t.id)),delete this.roomParticipants[t.id],this.destroyAvatar(t),this.destroyLaser(t),e&&(null==(n=this.presence3DManager)||n.unsubscribeFromUpdates(t.id,this.onParticipantUpdated))},this.addParticipant=async t=>{if(!t||!t.id||"audience"===t.type)return;let e=this.createParticipantOn3D(t);if(this.participants.find((t=>t.id===e.id)))return this.logger.log("matterport component @ addParticipant - participant already exists"),void this.onParticipantUpdated(t);this.participants.push(e),this.logger.log("matterport component @ addParticipant",{participant:t,participantOn3D:e,participants:this.participants}),this.roomParticipants[t.id]=t,this.presence3DManager.subscribeToUpdates(e.id,this.onParticipantUpdated),this.localParticipantId!==e.id&&(this.config.isAvatarsEnabled&&await this.createAvatar(e),this.config.isLaserEnabled&&this.createLaser(e),this.config.isNameEnabled&&this.createName(e,this.avatars[t.id]))},this.goTo=t=>{this.logger.log("matterport component @ goTo",t),this.moveToAnotherParticipant(t)},this.gather=()=>{this.logger.log("matterport component @ gather"),this.room.emit("gather",{id:this.localParticipant.id})},this.setPrivate=t=>{this.logger.log("matterport component @ private mode"),this.presence3DManager.updatePresence3D({id:this.localParticipantId,isPrivate:!!t}),this.isPrivate=!!t},this.follow=t=>{this.logger.log("matterport component @ follow"),this.room.emit("follow-me",{id:t})},this.localFollow=t=>{this.localFollowParticipantId=t},this.moveToAnotherParticipant=t=>{if(!this.positionInfos[t]||!this.isAttached||t===this.localParticipantId)return;let{mode:e}=this.positionInfos[t];if("mode.inside"===e){let{sweep:e}=this.positionInfos[t];if(e){let n=this.positionInfos[t].rotation||{x:0,y:0};this.moveToSweep(e,n)}}if("mode.dollhouse"===e||"mode.floorplan"===e){let n=this.matterportSdk.Mode.TransitionType.FLY,{position:r,rotation:i,floor:s}=this.positionInfos[t];this.matterportSdk.Mode.moveTo(e,{position:r,rotation:i,transition:n,zoom:25}).then((t=>{this.currentLocalMode=t})),"mode.floorplan"===e&&this.currentLocalFloorId!==s&&(-1===s?this.matterportSdk.Floor.showAll():this.matterportSdk.Floor.moveTo(s).then((()=>{this.currentLocalFloorId=s})))}},this._onLocalSweepChangeObserver=t=>{this.presence3DManager&&(this.currentSweepId=t.id,!this.isPrivate&&this.presence3DManager.updatePresence3D({id:this.localParticipantId,sweep:this.currentSweepId}))},this._onLocalFloorChangeObserver=t=>{this.presence3DManager&&(""!==t.id&&(this.currentLocalFloorId=parseFloat(t.id)),"all"===t.name&&(this.currentLocalFloorId=-1),!this.isPrivate&&this.presence3DManager.updatePresence3D({id:this.localParticipantId,floor:this.currentLocalFloorId}))},this._onLocalModeChangeObserver=t=>{this.presence3DManager&&(this.currentLocalMode=t,!this.isPrivate&&this.presence3DManager.updatePresence3D({id:this.localParticipantId,mode:this.currentLocalMode}))},this._onLocalCameraMoveObserver=t=>{let{position:e,rotation:n,sweep:r}=t;this.presence3DManager&&(this.currentLocalPosition=this.adjustMyPositionToCircle(e),this.currentLocalRotation=n,this.currentSweepId=r,!this.isPrivate&&this.presence3DManager.updatePresence3D({id:this.localParticipantId,position:this.currentLocalPosition,rotation:this.currentLocalRotation,laser:this.currentLocalLaserDest,sweep:this.currentSweepId,mode:this.currentLocalMode,floor:this.currentLocalFloorId}))},this._onLocalMouseMoveObserver=t=>{!this.presence3DManager||this.isPrivate||(this.currentLocalLaserDest=t.position,!this.isPrivate&&this.presence3DManager.updatePresence3D({id:this.localParticipantId,position:this.currentLocalPosition,rotation:this.currentLocalRotation,laser:this.currentLocalLaserDest,mode:this.currentLocalMode,sweep:this.currentSweepId}))},this.addInputComponent=async()=>{let[t]=await this.matterportSdk.Scene.createObjects(1),e=t.addNode();this.mpInputComponent=e.addComponent("mp.input",{eventsEnabled:!1,userNavigationEnabled:!0}),e.start()},this.addSceneLight=async()=>{this.directionalLight=await this.createDirectionLight(),this.ambientLight=await this.createAmbientLight()},this.createDirectionLight=async()=>{let[t]=await this.matterportSdk.Scene.createObjects(1),e=t.addNode(),n=e.addComponent("mp.directionalLight",{enabled:!0,color:{r:1,g:1,b:1},intensity:1,position:{x:.2,y:1,z:0},target:{x:.5,y:0,z:0},debug:!1});return this.THREE=n.context.three,e.start(),e},this.createAmbientLight=async()=>{let[t]=await this.matterportSdk.Scene.createObjects(1),e=t.addNode();return e.addComponent("mp.ambientLight",{enabled:!0,color:{r:1,g:1,b:1},intensity:1}),e.start(),e},this.adjustMyPositionToCircle=t=>{var e,n;if(!this.presence3DManager||(this.localSlot=(null==(e=this.localParticipant.slot)?void 0:e.index)??-1,!this.THREE||-1===this.localSlot))return t;let r=new this.THREE.Vector3(null==t?void 0:t.x,null==t?void 0:t.y,null==t?void 0:t.z);return this.circlePositions[this.localSlot]?(null!=(n=this.currentCirclePosition)&&n.isVector3||(this.currentCirclePosition=new this.THREE.Vector3(this.circlePositions[this.localSlot].x,t.y,this.circlePositions[this.localSlot].z)),this.currentCirclePosition.set(this.circlePositions[this.localSlot].x,t.y,this.circlePositions[this.localSlot].z),r.add(this.currentCirclePosition.multiplyScalar(.13)),{x:r.x,y:t.y,z:r.z}):t},this.onParticipantsUpdated=t=>{this.isAttached&&(this.logger.log("matterport component @ onParticipantsUpdated",t),this.roomParticipants={},t.forEach((t=>{this.roomParticipants[t.id]=t})),Object.values(t).forEach((t=>{if(t.id===this.localParticipantId)return;let e=t.id,{position:n,rotation:r,sweep:i,floor:s,mode:o,isPrivate:a}=t;if(this.positionInfos[e]={position:n,rotation:r,mode:o,sweep:i,floor:s},a&&this.avatars[e]&&this.removeParticipant(t,!0),!a&&!this.avatars[e]&&this.addParticipant(t),this.avatars[e]){let i=this.avatars[e],s=this.lasers[e],o=t.laser;n&&r&&this.updateAvatar(i,n,r),s&&(this.laserUpdateIntervals[e]&&clearInterval(this.laserUpdateIntervals[e]),this.laserUpdateIntervals[e]=setInterval((()=>{this.updateLaser(e,i,s,o)}),30))}})))},this.name="presence3dMatterport",this.logger=new Wb("@superviz/sdk/matterport-component"),this.logger.log("matterport component @ constructor",{matterportSdk:t,options:e}),this.config={isAvatarsEnabled:(null==e?void 0:e.isAvatarsEnabled)??!0,isLaserEnabled:(null==e?void 0:e.isLaserEnabled)??!0,isNameEnabled:(null==e?void 0:e.isNameEnabled)??!0,avatarConfig:{height:(null==(n=null==e?void 0:e.avatarConfig)?void 0:n.height)||.25,scale:(null==(r=null==e?void 0:e.avatarConfig)?void 0:r.scale)||.55,laserOrigin:(null==(i=null==e?void 0:e.avatarConfig)?void 0:i.laserOrigin)??{x:0,y:-.2,z:.07}}},this.logger.log("matterport component @ constructor - config",this.config),this.matterportSdk=t,this.matterportSdk.Scene.register("lerper",qb),this.matterportSdk.Scene.register("name",Xb),this.matterportSdk.Scene.register("laser",Yb),this.addInputComponent(),this.addSceneLight(),this.createCircleOfPositions(),this.subscribeToMatterportEvents()}get localParticipantId(){var t;return null==(t=this.localParticipant)?void 0:t.id}async destroyAvatar(t){this.logger.log("matterport component @ destroyAvatar",t),this.avatars[t.id]&&(this.avatars[t.id].stop(),delete this.avatars[t.id])}async destroyLaser(t){this.logger.log("matterport component @ destroyLaser",t),this.lasers[t.id]&&(this.lasers[t.id].stop(),delete this.lasers[t.id])}async createAvatar(t){var e,n,r;if(this.logger.log("matterport component @ createAvatar",t),!this.isAttached)return;let i=(null==(e=null==t?void 0:t.avatarConfig)?void 0:e.scale)||.55,s=(null==(n=null==t?void 0:t.avatarConfig)?void 0:n.height)||.25,[o]=await this.matterportSdk.Scene.createObjects(1),a=o.addNode(),l=Hb;a.obj3D.rotation.set(l.x,l.y,l.z),a.obj3D.name="avatar",a.obj3D.userData={uuid:t.id,name:t.name,height:s};let c=(null==(r=t.avatar)?void 0:r.model3DUrl)??"https://production.storage.superviz.com/readyplayerme/1.glb",u={x:i,y:i,z:i};return a.lerper=a.addComponent("lerper"),a.avatarName=a.addComponent("name"),this.avatars[t.id]=a,new Promise((t=>{a.addComponent("mp.gltfLoader",{url:c,localScale:u,onLoaded:()=>{this.matterportSdk.Camera.getPose().then((e=>{this._onLocalCameraMoveObserver({position:e.position,rotation:e.rotation,sweep:e.sweep}),t(a)}))}}),a.start()}))}async createName(t,e){var n,r,i;if(this.logger.log("createName",t,e),!e)return;let s,o=Number(this.THREE.REVISION),a=null==(r=(null==(n=t.avatar)?void 0:n.model3DUrl)??"https://production.storage.superviz.com/readyplayerme/1.glb")?void 0:r.includes("readyplayerme"),l=e.avatarName,c=t.slot??(null==(i=this.roomParticipants[t.id])?void 0:i.slot),u=(new this.THREE.Box3).setFromObject(e.obj3D),h=new wb(0,0,0);u.getSize(h),o<=146?s=u.min.y-e.position.y+1.1*h.y:(s=1.2*h.y,a&&(s=4.1*h.y)),l.createName(e.obj3D,t.name,c,s)}async createLaser(t){var e;if(this.logger.log("matterport component @ createLaser",t),!this.isAttached)return;let n=new wb(0,-.2,.07);null!=(e=t.avatarConfig)&&e.laserOrigin&&(n=new wb(t.avatarConfig.laserOrigin.x,t.avatarConfig.laserOrigin.y,t.avatarConfig.laserOrigin.z));let[r]=await this.matterportSdk.Scene.createObjects(1),i=r.addNode();i.laserPointer=i.addComponent("laser",{origin:n}),i.start(),i.obj3D.userData={uuid:t.id},this.lasers[t.id]=i}subscribeToMatterportEvents(){this.matterportSdk.Camera.pose.subscribe(this._onLocalCameraMoveObserver),this.matterportSdk.Pointer.intersection.subscribe(this._onLocalMouseMoveObserver),this.matterportSdk.Floor.current.subscribe(this._onLocalFloorChangeObserver),this.matterportSdk.Mode.current.subscribe(this._onLocalModeChangeObserver),this.matterportSdk.Sweep.current.subscribe(this._onLocalSweepChangeObserver)}createCircleOfPositions(){let t=0;for(let e=0;e<50;e++){t=7.2*e;let n=t*(Math.PI/180),r=15*Math.cos(n),i=0,s=15*Math.sin(n);if(0!==e){let t={x:r,y:i,z:s};e%2===0?this.circlePositions.push(t):this.circlePositions.unshift(t)}}}moveToSweep(t,e){this.isSweeping||!this.isAttached||(this.mpInputComponent&&(this.mpInputComponent.inputs.userNavigationEnabled=!1),this.isSweeping=!0,this.matterportSdk.Sweep.moveTo(t,{transitionTime:500,transition:this.matterportSdk.Sweep.Transition.FLY,rotation:e||this.currentLocalRotation}).finally((()=>{this.isSweeping=!1,this.mpInputComponent&&(this.mpInputComponent.inputs.userNavigationEnabled=!0)})))}updateAvatar(t,e,n){var r,i;if(!this.isAttached)return;let s=new this.THREE.Vector3(1,0,0),o=new this.THREE.Vector3(0,1,0),a=(new this.THREE.Quaternion).setFromAxisAngle(s,this.THREE.MathUtils.degToRad(-n.x)),l=(new this.THREE.Quaternion).setFromAxisAngle(o,this.THREE.MathUtils.degToRad(null==n?void 0:n.y)+Math.PI),{lerper:c}=t;c.animateQuaternion(t.obj3D.quaternion,l.multiply(a));let u=parseFloat((null==(i=null==(r=null==t?void 0:t.obj3D)?void 0:r.userData)?void 0:i.height)??0)-.62,h=new this.THREE.Vector3(this.currentCirclePosition.x,0,this.currentCirclePosition.z),d=new this.THREE.Vector3(null==e?void 0:e.x,0,null==e?void 0:e.z).sub(h);d.y=e.y+u,c.animateVector(t.obj3D.position,d)}updateLaser(t,e,n,r){let i=this.roomParticipants[t];if(!e||!n||!r||!this.isAttached||!i)return;let s=n.laserPointer,{x:o,y:a,z:l}=e.obj3D.position,c={x:o,y:a+.35,z:l};if(e.obj3D.getWorldQuaternion(this.tempQuaternion),s){let{slot:t}=i;s.updateGeometry(c,r,!0,!0,t,this.tempQuaternion)}}},window.MatterportPin=class{constructor(t,e){if(this.isPinsVisible=!0,this.divWrapperReplacementInterval=null,this.isSweeping=!1,this.commentsSide="left",this.selectedPin=null,this.setCommentsMetadata=t=>{this.commentsSide=t},this.hideTemporaryPin=t=>{var e;let n=t.target;this.showcaseDiv.contains(n)||null!=(e=this.pins.get("temporary-pin"))&&e.contains(n)||this.removeAnnotationPin("temporary-pin")},this.resetPins=t=>{t&&"Escape"!==(null==t?void 0:t.key)||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)},this.annotationSelected=t=>{let{detail:e}=t;var n;let{uuid:r,haltGoToPin:i,newPin:s}=e;if(!r)return;s&&this.pins.get(r).setAttribute("newPin","");let o=JSON.parse((null==(n=this.selectedPin)?void 0:n.getAttribute("annotation"))??"{}");if(this.resetPins(),(null==o?void 0:o.uuid)===r)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let a=this.pins.get(r);if(!a)return;a.setAttribute("active",""),this.selectedPin=a;let l=this.annotations.find((t=>t.uuid===r));if(l){let t=JSON.parse(l.position);if(t&&!i){let e=t.camera;this.moveToSweep(e.sweep,e.rotation)}}},this.onClick=()=>{if(!this.isActive)return;let t={x:this.intersection.position.x,y:this.intersection.position.y,z:this.intersection.position.z,type:"matterport"},e={position:t,camera:this.cameraPose};this.resetSelectedPin(),this.onPinFixedObserver.publish(e),this.createTemporaryPin(t)},this.onToggleAnnotationSidebar=t=>{let{detail:e}=t,{open:n}=e;n||(this.pins.forEach((t=>{t.removeAttribute("active")})),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))},typeof window>"u")throw new Error("[SuperViz] MatterportPin cannot be initialized in a non-browser environment. Window is not defined");Vb=this,this.showcaseDiv=e,this.matterportSdk=t,this.logger=new Wb("@superviz/sdk/comments-component/matterport-adapter"),this.isActive=!1,this.pins=new Map,this.divWrapper=this.createDivWrapper(),this.matterportSdk.Asset.registerTexture("pointer","https://production.cdn.superviz.com/static/pin-add.png"),this.createInputListener(),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.style.position="relative",this.onPinFixedObserver=new ex,this.annotations=[],this.renderAnnotationsPins(),this.matterportSdk.Camera.pose.subscribe((t=>{this.cameraPose=t,(this.isActive||this.isPinsVisible)&&this.renderAnnotationsPins()})),this.showcaseSides=this.showcaseDiv.getBoundingClientRect()}destroy(){this.removeAnnotationsPins(),this.removeListeners()}setActive(t){if(this.isActive=t,this.isActive)return this.addListeners(),void this.matterportSdk.Pointer.editTexture("pointer");this.matterportSdk.Pointer.resetTexture()}setPinsVisibility(t){this.isPinsVisible=t,this.isPinsVisible?this.renderAnnotationsPins():this.removeAnnotationsPins()}updateAnnotations(t){this.logger.log("updateAnnotations",t),this.annotations=t,(this.isActive||this.isPinsVisible)&&this.renderAnnotationsPins()}removeAnnotationPin(t){let e=this.pins.get(t);e&&(e.remove(),this.pins.delete(t),this.annotations=this.annotations.filter((e=>e.uuid!==t)))}createTemporaryPin(t){let e=document.getElementById("superviz-temporary-pin");this.temporaryPinCoordinates=t,e||(e=document.createElement("superviz-comments-annotation-pin"),e.id="superviz-temporary-pin",e.setAttribute("type","add"),e.setAttribute("showInput",""),e.setAttribute("containerSides",JSON.stringify(this.showcaseSides)),e.setAttribute("commentsSide",this.commentsSide),e.setAttribute("participantsList",JSON.stringify(this.participants)),e.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),e.setAttribute("annotation",JSON.stringify({})),e.setAttributeNode(document.createAttribute("active")));let n=this.showcaseDiv,{width:r,height:i}=n.getBoundingClientRect(),s=this.position3DToScreen(t,r,i,0,-32),o={x:s.left,y:s.top,type:t.type};e.setAttribute("position",JSON.stringify(o)),this.divWrapper.appendChild(e),this.pins.set("temporary-pin",e)}addListeners(){this.intersectionObserver=this.matterportSdk.Pointer.intersection.subscribe((t=>{this.intersection=t})),this.inputComponent.inputs.eventsEnabled=!0,this.inputComponent.inputs.userNavigationEnabled=!1,document.body.addEventListener("keyup",this.resetPins),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){var t;document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),null==(t=this.intersectionObserver)||t.cancel(),this.inputComponent.inputs.eventsEnabled=!1,this.inputComponent.inputs.userNavigationEnabled=!0,document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("click",this.hideTemporaryPin)}async renderAnnotationsPins(){this.annotations.forEach((async t=>{let e=JSON.parse(t.position).position;if("matterport"!==(null==e?void 0:e.type)||t.resolved)return;this.pins.has(t.uuid)||this.createPin(t,e);let{width:n,height:r}=this.showcaseDiv.getBoundingClientRect(),i=this.position3DToScreen(e,n,r,0,-32),s=await this.checkIsVisible(i,e),o=this.pins.get(t.uuid);s?(o.setAttribute("style","opacity: 1"),this.pins.get(t.uuid).setAttribute("position",JSON.stringify({x:i.left,y:i.top}))):o.setAttribute("style","opacity: 0")}));let t=this.pins.get("temporary-pin");if(t){let{width:e,height:n}=this.showcaseDiv.getBoundingClientRect(),r=this.position3DToScreen(this.temporaryPinCoordinates,e,n,0,-32);await this.checkIsVisible(r,this.temporaryPinCoordinates)?(t.setAttribute("style","opacity: 1"),t.setAttribute("position",JSON.stringify({x:r.left,y:r.top}))):t.setAttribute("style","opacity: 0")}}createPin(t,e){let{width:n,height:r}=this.showcaseDiv.getBoundingClientRect(),i=this.position3DToScreen(e,n,r,0,-32),s=document.createElement("superviz-comments-annotation-pin");this.divWrapper.appendChild(s),s.setAttribute("type","show"),s.setAttribute("annotation",JSON.stringify(t)),s.setAttribute("position",JSON.stringify({x:i.left,y:i.top})),s.setAttribute("participantsList",JSON.stringify(this.participants)),this.pins.set(t.uuid,s)}removeAnnotationsPins(){this.pins.forEach((t=>{t.remove()})),this.pins.clear()}set participantsList(t){this.participants=t}resetSelectedPin(){this.selectedPin&&(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}moveToSweep(t,e){this.isSweeping||(this.isSweeping=!0,this.matterportSdk.Sweep.moveTo(t,{transitionTime:500,transition:this.matterportSdk.Sweep.Transition.FLY,rotation:e}).finally((()=>{this.isSweeping=!1})))}createDivWrapper(){let t=this.showcaseDiv.getBoundingClientRect(),e=document.createElement("div");return this.showcaseDiv.parentElement.style.position="relative",e.style.position="fixed",e.style.top=`${t.top}px`,e.style.left=`${t.left}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden",this.divWrapperReplacementInterval||(this.divWrapperReplacementInterval=setInterval((()=>{let t=this.showcaseDiv.getBoundingClientRect();e.style.top=`${t.top}px`,e.style.left=`${t.left}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`}),1)),this.showcaseDiv.parentElement.appendChild(e),e}async createInputListener(){let[t]=await this.matterportSdk.Scene.createObjects(1),e=t.addNode();this.inputComponent=e.addComponent("mp.input",{eventsEnabled:!1,userNavigationEnabled:!0}),e.start(),this.inputComponent.spyOnEvent(new nx)}position3DToScreen(t,e,n,r,i){let s={w:e,h:n},o=this.matterportSdk.Conversion.worldToScreen(t,this.cameraPose,s);return{top:Math.abs(o.y)+i,left:Math.abs(o.x)+r}}async checkIsVisible(t,e){let n=new wb(e.x,e.y,e.z),r=await this.matterportSdk.Renderer.getWorldPositionData({x:t.left,y:t.top});return!(!r||!r.position)&&new wb(r.position.x,r.position.y,r.position.z).distanceTo(n)<3}});var sx=Object.create,ox=Object.defineProperty,ax=Object.getOwnPropertyDescriptor,lx=Object.getOwnPropertyNames,cx=Object.getPrototypeOf,ux=Object.prototype.hasOwnProperty,hx=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),dx=(t,e,n)=>(n=null!=t?sx(cx(t)):{},((t,e,n,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of lx(e))!ux.call(t,i)&&i!==n&&ox(t,i,{get:()=>e[i],enumerable:!(r=ax(e,i))||r.enumerable});return t})(t&&t.__esModule?n:ox(n,"default",{value:t,enumerable:!0}),t)),px=hx(((t,e)=>{(function(){var n,r="Expected a function",i="__lodash_hash_undefined__",s="__lodash_placeholder__",o=16,a=32,l=64,c=128,u=256,h=1/0,d=9007199254740991,p=NaN,f=4294967295,m=f-1,g=f>>>1,v=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",o],["flip",512],["partial",a],["partialRight",l],["rearg",u]],y="[object Arguments]",_="[object Array]",b="[object Boolean]",x="[object Date]",w="[object Error]",S="[object Function]",M="[object GeneratorFunction]",E="[object Map]",T="[object Number]",A="[object Object]",C="[object Promise]",P="[object RegExp]",I="[object Set]",R="[object String]",L="[object Symbol]",N="[object WeakMap]",O="[object ArrayBuffer]",k="[object DataView]",D="[object Float32Array]",z="[object Float64Array]",U="[object Int8Array]",F="[object Int16Array]",B="[object Int32Array]",V="[object Uint8Array]",H="[object Uint8ClampedArray]",j="[object Uint16Array]",W="[object Uint32Array]",G=/\b__p \+= '';/g,q=/\b(__p \+=) '' \+/g,$=/(__e\(.*?\)|\b__t\)) \+\n'';/g,X=/&(?:amp|lt|gt|quot|#39);/g,J=/[&<>"']/g,Y=RegExp(X.source),Z=RegExp(J.source),K=/<%-([\s\S]+?)%>/g,Q=/<%([\s\S]+?)%>/g,tt=/<%=([\s\S]+?)%>/g,et=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nt=/^\w*$/,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/[\\^$.*+?()[\]{}|]/g,st=RegExp(it.source),ot=/^\s+/,at=/\s/,lt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ct=/\{\n\/\* \[wrapped with (.+)\] \*/,ut=/,? & /,ht=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,dt=/[()=,{}\[\]\/\s]/,pt=/\\(\\)?/g,ft=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mt=/\w*$/,gt=/^[-+]0x[0-9a-f]+$/i,vt=/^0b[01]+$/i,yt=/^\[object .+?Constructor\]$/,_t=/^0o[0-7]+$/i,bt=/^(?:0|[1-9]\d*)$/,xt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,wt=/($^)/,St=/['\n\r\u2028\u2029\\]/g,Mt="\\ud800-\\udfff",Et="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Tt="\\u2700-\\u27bf",At="a-z\\xdf-\\xf6\\xf8-\\xff",Ct="A-Z\\xc0-\\xd6\\xd8-\\xde",Pt="\\ufe0e\\ufe0f",It="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Rt="['\u2019]",Lt="["+Mt+"]",Nt="["+It+"]",Ot="["+Et+"]",kt="\\d+",Dt="["+Tt+"]",zt="["+At+"]",Ut="[^"+Mt+It+kt+Tt+At+Ct+"]",Ft="\\ud83c[\\udffb-\\udfff]",Bt="[^"+Mt+"]",Vt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ht="[\\ud800-\\udbff][\\udc00-\\udfff]",jt="["+Ct+"]",Wt="\\u200d",Gt="(?:"+zt+"|"+Ut+")",qt="(?:"+jt+"|"+Ut+")",$t="(?:['\u2019](?:d|ll|m|re|s|t|ve))?",Xt="(?:['\u2019](?:D|LL|M|RE|S|T|VE))?",Jt="(?:"+Ot+"|"+Ft+")"+"?",Yt="["+Pt+"]?",Zt=Yt+Jt+("(?:"+Wt+"(?:"+[Bt,Vt,Ht].join("|")+")"+Yt+Jt+")*"),Kt="(?:"+[Dt,Vt,Ht].join("|")+")"+Zt,Qt="(?:"+[Bt+Ot+"?",Ot,Vt,Ht,Lt].join("|")+")",te=RegExp(Rt,"g"),ee=RegExp(Ot,"g"),ne=RegExp(Ft+"(?="+Ft+")|"+Qt+Zt,"g"),re=RegExp([jt+"?"+zt+"+"+$t+"(?="+[Nt,jt,"$"].join("|")+")",qt+"+"+Xt+"(?="+[Nt,jt+Gt,"$"].join("|")+")",jt+"?"+Gt+"+"+$t,jt+"+"+Xt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",kt,Kt].join("|"),"g"),ie=RegExp("["+Wt+Mt+Et+Pt+"]"),se=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,oe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ae=-1,le={};le[D]=le[z]=le[U]=le[F]=le[B]=le[V]=le[H]=le[j]=le[W]=!0,le[y]=le[_]=le[O]=le[b]=le[k]=le[x]=le[w]=le[S]=le[E]=le[T]=le[A]=le[P]=le[I]=le[R]=le[N]=!1;var ce={};ce[y]=ce[_]=ce[O]=ce[k]=ce[b]=ce[x]=ce[D]=ce[z]=ce[U]=ce[F]=ce[B]=ce[E]=ce[T]=ce[A]=ce[P]=ce[I]=ce[R]=ce[L]=ce[V]=ce[H]=ce[j]=ce[W]=!0,ce[w]=ce[S]=ce[N]=!1;var ue={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},he=parseFloat,de=parseInt,pe="object"==typeof window&&window&&window.Object===Object&&window,fe="object"==typeof self&&self&&self.Object===Object&&self,me=pe||fe||Function("return this")(),ge="object"==typeof t&&t&&!t.nodeType&&t,ve=ge&&"object"==typeof e&&e&&!e.nodeType&&e,ye=ve&&ve.exports===ge,_e=ye&&pe.process,be=function(){try{return ve&&ve.require&&ve.require("util").types||_e&&_e.binding&&_e.binding("util")}catch{}}(),xe=be&&be.isArrayBuffer,we=be&&be.isDate,Se=be&&be.isMap,Me=be&&be.isRegExp,Ee=be&&be.isSet,Te=be&&be.isTypedArray;function Ae(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ce(t,e,n,r){for(var i=-1,s=null==t?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function Pe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Ie(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Re(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Le(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Ne(t,e){return!!(null==t?0:t.length)&&je(t,e,0)>-1}function Oe(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function ke(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function De(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function ze(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function Ue(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Fe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Be=$e("length");function Ve(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function He(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function je(t,e,n){return e===e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):He(t,Ge,n)}function We(t,e,n,r){for(var i=n-1,s=t.length;++i<s;)if(r(t[i],e))return i;return-1}function Ge(t){return t!==t}function qe(t,e){var n=null==t?0:t.length;return n?Ye(t,e)/n:p}function $e(t){return function(e){return null==e?n:e[t]}}function Xe(t){return function(e){return null==t?n:t[e]}}function Je(t,e,n,r,i){return i(t,(function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)})),n}function Ye(t,e){for(var r,i=-1,s=t.length;++i<s;){var o=e(t[i]);o!==n&&(r=r===n?o:r+o)}return r}function Ze(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ke(t){return t&&t.slice(0,mn(t)+1).replace(ot,"")}function Qe(t){return function(e){return t(e)}}function tn(t,e){return ke(e,(function(e){return t[e]}))}function en(t,e){return t.has(e)}function nn(t,e){for(var n=-1,r=t.length;++n<r&&je(e,t[n],0)>-1;);return n}function rn(t,e){for(var n=t.length;n--&&je(e,t[n],0)>-1;);return n}var sn=Xe({"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"}),on=Xe({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function an(t){return"\\"+ue[t]}function ln(t){return ie.test(t)}function cn(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function un(t,e){return function(n){return t(e(n))}}function hn(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];(a===e||a===s)&&(t[n]=s,o[i++]=n)}return o}function dn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function pn(t){return ln(t)?function(t){for(var e=ne.lastIndex=0;ne.test(t);)++e;return e}(t):Be(t)}function fn(t){return ln(t)?function(t){return t.match(ne)||[]}(t):function(t){return t.split("")}(t)}function mn(t){for(var e=t.length;e--&&at.test(t.charAt(e)););return e}var gn=Xe({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var vn=function t(e){var at=(e=null==e?me:vn.defaults(me.Object(),e,vn.pick(me,oe))).Array,Mt=e.Date,Et=e.Error,Tt=e.Function,At=e.Math,Ct=e.Object,Pt=e.RegExp,It=e.String,Rt=e.TypeError,Lt=at.prototype,Nt=Tt.prototype,Ot=Ct.prototype,kt=e["__core-js_shared__"],Dt=Nt.toString,zt=Ot.hasOwnProperty,Ut=0,Ft=function(){var t=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Bt=Ot.toString,Vt=Dt.call(Ct),Ht=me._,jt=Pt("^"+Dt.call(zt).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Wt=ye?e.Buffer:n,Gt=e.Symbol,qt=e.Uint8Array,$t=Wt?Wt.allocUnsafe:n,Xt=un(Ct.getPrototypeOf,Ct),Jt=Ct.create,Yt=Ot.propertyIsEnumerable,Zt=Lt.splice,Kt=Gt?Gt.isConcatSpreadable:n,Qt=Gt?Gt.iterator:n,ne=Gt?Gt.toStringTag:n,ie=function(){try{var t=ds(Ct,"defineProperty");return t({},"",{}),t}catch{}}(),ue=e.clearTimeout!==me.clearTimeout&&e.clearTimeout,pe=Mt&&Mt.now!==me.Date.now&&Mt.now,fe=e.setTimeout!==me.setTimeout&&e.setTimeout,ge=At.ceil,ve=At.floor,_e=Ct.getOwnPropertySymbols,be=Wt?Wt.isBuffer:n,Be=e.isFinite,Xe=Lt.join,yn=un(Ct.keys,Ct),_n=At.max,bn=At.min,xn=Mt.now,wn=e.parseInt,Sn=At.random,Mn=Lt.reverse,En=ds(e,"DataView"),Tn=ds(e,"Map"),An=ds(e,"Promise"),Cn=ds(e,"Set"),Pn=ds(e,"WeakMap"),In=ds(Ct,"create"),Rn=Pn&&new Pn,Ln={},Nn=Us(En),On=Us(Tn),kn=Us(An),Dn=Us(Cn),zn=Us(Pn),Un=Gt?Gt.prototype:n,Fn=Un?Un.valueOf:n,Bn=Un?Un.toString:n;function Vn(t){if(na(t)&&!Go(t)&&!(t instanceof Gn)){if(t instanceof Wn)return t;if(zt.call(t,"__wrapped__"))return Fs(t)}return new Wn(t)}var Hn=function(){function t(){}return function(e){if(!ea(e))return{};if(Jt)return Jt(e);t.prototype=e;var r=new t;return t.prototype=n,r}}();function jn(){}function Wn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=n}function Gn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}function qn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function $n(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Xn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Jn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Xn;++e<n;)this.add(t[e])}function Yn(t){var e=this.__data__=new $n(t);this.size=e.size}function Zn(t,e){var n=Go(t),r=!n&&Wo(t),i=!n&&!r&&Jo(t),s=!n&&!r&&!i&&ua(t),o=n||r||i||s,a=o?Ze(t.length,It):[],l=a.length;for(var c in t)(e||zt.call(t,c))&&(!o||!("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||_s(c,l)))&&a.push(c);return a}function Kn(t){var e=t.length;return e?t[Jr(0,e-1)]:n}function Qn(t,e){return ks(Ii(t),lr(e,0,t.length))}function tr(t){return ks(Ii(t))}function er(t,e,r){(r!==n&&!Vo(t[e],r)||r===n&&!(e in t))&&or(t,e,r)}function nr(t,e,r){var i=t[e];(!zt.call(t,e)||!Vo(i,r)||r===n&&!(e in t))&&or(t,e,r)}function rr(t,e){for(var n=t.length;n--;)if(Vo(t[n][0],e))return n;return-1}function ir(t,e,n,r){return pr(t,(function(t,i,s){e(r,t,n(t),s)})),r}function sr(t,e){return t&&Ri(e,La(e),t)}function or(t,e,n){"__proto__"==e&&ie?ie(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ar(t,e){for(var r=-1,i=e.length,s=at(i),o=null==t;++r<i;)s[r]=o?n:Aa(t,e[r]);return s}function lr(t,e,r){return t===t&&(r!==n&&(t=t<=r?t:r),e!==n&&(t=t>=e?t:e)),t}function cr(t,e,r,i,s,o){var a,l=1&e,c=2&e,u=4&e;if(r&&(a=s?r(t,i,s,o):r(t)),a!==n)return a;if(!ea(t))return t;var h=Go(t);if(h){if(a=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&zt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!l)return Ii(t,a)}else{var d=ms(t),p=d==S||d==M;if(Jo(t))return Mi(t,l);if(d==A||d==y||p&&!s){if(a=c||p?{}:vs(t),!l)return c?function(t,e){return Ri(t,fs(t),e)}(t,function(t,e){return t&&Ri(e,Na(e),t)}(a,t)):function(t,e){return Ri(t,ps(t),e)}(t,sr(a,t))}else{if(!ce[d])return s?t:{};a=function(t,e,n){var r=t.constructor;switch(e){case O:return Ei(t);case b:case x:return new r(+t);case k:return function(t,e){var n=e?Ei(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case D:case z:case U:case F:case B:case V:case H:case j:case W:return Ti(t,n);case E:return new r;case T:case R:return new r(t);case P:return function(t){var e=new t.constructor(t.source,mt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case I:return new r;case L:return function(t){return Fn?Ct(Fn.call(t)):{}}(t)}}(t,d,l)}}o||(o=new Yn);var f=o.get(t);if(f)return f;o.set(t,a),aa(t)?t.forEach((function(n){a.add(cr(n,e,r,n,t,o))})):ra(t)&&t.forEach((function(n,i){a.set(i,cr(n,e,r,i,t,o))}));var m=h?n:(u?c?ss:is:c?Na:La)(t);return Pe(m||t,(function(n,i){m&&(n=t[i=n]),nr(a,i,cr(n,e,r,i,t,o))})),a}function ur(t,e,r){var i=r.length;if(null==t)return!i;for(t=Ct(t);i--;){var s=r[i],o=e[s],a=t[s];if(a===n&&!(s in t)||!o(a))return!1}return!0}function hr(t,e,i){if("function"!=typeof t)throw new Rt(r);return Rs((function(){t.apply(n,i)}),e)}function dr(t,e,n,r){var i=-1,s=Ne,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;n&&(e=ke(e,Qe(n))),r?(s=Oe,o=!1):e.length>=200&&(s=en,o=!1,e=new Jn(e));t:for(;++i<a;){var u=t[i],h=null==n?u:n(u);if(u=r||0!==u?u:0,o&&h===h){for(var d=c;d--;)if(e[d]===h)continue t;l.push(u)}else s(e,h,r)||l.push(u)}return l}Vn.templateSettings={escape:K,evaluate:Q,interpolate:tt,variable:"",imports:{_:Vn}},Vn.prototype=jn.prototype,Vn.prototype.constructor=Vn,Wn.prototype=Hn(jn.prototype),Wn.prototype.constructor=Wn,Gn.prototype=Hn(jn.prototype),Gn.prototype.constructor=Gn,qn.prototype.clear=function(){this.__data__=In?In(null):{},this.size=0},qn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},qn.prototype.get=function(t){var e=this.__data__;if(In){var r=e[t];return r===i?n:r}return zt.call(e,t)?e[t]:n},qn.prototype.has=function(t){var e=this.__data__;return In?e[t]!==n:zt.call(e,t)},qn.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=In&&e===n?i:e,this},$n.prototype.clear=function(){this.__data__=[],this.size=0},$n.prototype.delete=function(t){var e=this.__data__,n=rr(e,t);return!(n<0)&&(n==e.length-1?e.pop():Zt.call(e,n,1),--this.size,!0)},$n.prototype.get=function(t){var e=this.__data__,r=rr(e,t);return r<0?n:e[r][1]},$n.prototype.has=function(t){return rr(this.__data__,t)>-1},$n.prototype.set=function(t,e){var n=this.__data__,r=rr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Xn.prototype.clear=function(){this.size=0,this.__data__={hash:new qn,map:new(Tn||$n),string:new qn}},Xn.prototype.delete=function(t){var e=us(this,t).delete(t);return this.size-=e?1:0,e},Xn.prototype.get=function(t){return us(this,t).get(t)},Xn.prototype.has=function(t){return us(this,t).has(t)},Xn.prototype.set=function(t,e){var n=us(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Jn.prototype.add=Jn.prototype.push=function(t){return this.__data__.set(t,i),this},Jn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.clear=function(){this.__data__=new $n,this.size=0},Yn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Yn.prototype.get=function(t){return this.__data__.get(t)},Yn.prototype.has=function(t){return this.__data__.has(t)},Yn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof $n){var r=n.__data__;if(!Tn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Xn(r)}return n.set(t,e),this.size=n.size,this};var pr=Oi(xr),fr=Oi(wr,!0);function mr(t,e){var n=!0;return pr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function gr(t,e,r){for(var i=-1,s=t.length;++i<s;){var o=t[i],a=e(o);if(null!=a&&(l===n?a===a&&!ca(a):r(a,l)))var l=a,c=o}return c}function vr(t,e){var n=[];return pr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function yr(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=ys),i||(i=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?yr(a,e-1,n,r,i):De(i,a):r||(i[i.length]=a)}return i}var _r=ki(),br=ki(!0);function xr(t,e){return t&&_r(t,e,La)}function wr(t,e){return t&&br(t,e,La)}function Sr(t,e){return Le(e,(function(e){return Ko(t[e])}))}function Mr(t,e){for(var r=0,i=(e=bi(e,t)).length;null!=t&&r<i;)t=t[zs(e[r++])];return r&&r==i?t:n}function Er(t,e,n){var r=e(t);return Go(t)?r:De(r,n(t))}function Tr(t){return null==t?t===n?"[object Undefined]":"[object Null]":ne&&ne in Ct(t)?function(t){var e=zt.call(t,ne),r=t[ne];try{t[ne]=n;var i=!0}catch{}var s=Bt.call(t);return i&&(e?t[ne]=r:delete t[ne]),s}(t):function(t){return Bt.call(t)}(t)}function Ar(t,e){return t>e}function Cr(t,e){return null!=t&&zt.call(t,e)}function Pr(t,e){return null!=t&&e in Ct(t)}function Ir(t,e,r){for(var i=r?Oe:Ne,s=t[0].length,o=t.length,a=o,l=at(o),c=1/0,u=[];a--;){var h=t[a];a&&e&&(h=ke(h,Qe(e))),c=bn(h.length,c),l[a]=!r&&(e||s>=120&&h.length>=120)?new Jn(a&&h):n}h=t[0];var d=-1,p=l[0];t:for(;++d<s&&u.length<c;){var f=h[d],m=e?e(f):f;if(f=r||0!==f?f:0,!(p?en(p,m):i(u,m,r))){for(a=o;--a;){var g=l[a];if(!(g?en(g,m):i(t[a],m,r)))continue t}p&&p.push(m),u.push(f)}}return u}function Rr(t,e,r){var i=null==(t=Cs(t,e=bi(e,t)))?t:t[zs(Ys(e))];return null==i?n:Ae(i,t,r)}function Lr(t){return na(t)&&Tr(t)==y}function Nr(t,e,r,i,s){return t===e||(null==t||null==e||!na(t)&&!na(e)?t!==t&&e!==e:function(t,e,r,i,s,o){var a=Go(t),l=Go(e),c=a?_:ms(t),u=l?_:ms(e);c=c==y?A:c;var h=c==A,d=(u=u==y?A:u)==A,p=c==u;if(p&&Jo(t)){if(!Jo(e))return!1;a=!0,h=!1}if(p&&!h)return o||(o=new Yn),a||ua(t)?ns(t,e,r,i,s,o):function(t,e,n,r,i,s,o){switch(n){case k:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case O:return!(t.byteLength!=e.byteLength||!s(new qt(t),new qt(e)));case b:case x:case T:return Vo(+t,+e);case w:return t.name==e.name&&t.message==e.message;case P:case R:return t==e+"";case E:var a=cn;case I:var l=1&r;if(a||(a=dn),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;r|=2,o.set(t,e);var u=ns(a(t),a(e),r,i,s,o);return o.delete(t),u;case L:if(Fn)return Fn.call(t)==Fn.call(e)}return!1}(t,e,c,r,i,s,o);if(!(1&r)){var f=h&&zt.call(t,"__wrapped__"),m=d&&zt.call(e,"__wrapped__");if(f||m){var g=f?t.value():t,v=m?e.value():e;return o||(o=new Yn),s(g,v,r,i,o)}}return!!p&&(o||(o=new Yn),function(t,e,r,i,s,o){var a=1&r,l=is(t),c=l.length,u=is(e),h=u.length;if(c!=h&&!a)return!1;for(var d=c;d--;){var p=l[d];if(!(a?p in e:zt.call(e,p)))return!1}var f=o.get(t),m=o.get(e);if(f&&m)return f==e&&m==t;var g=!0;o.set(t,e),o.set(e,t);for(var v=a;++d<c;){var y=t[p=l[d]],_=e[p];if(i)var b=a?i(_,y,p,e,t,o):i(y,_,p,t,e,o);if(!(b===n?y===_||s(y,_,r,i,o):b)){g=!1;break}v||(v="constructor"==p)}if(g&&!v){var x=t.constructor,w=e.constructor;x!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w)&&(g=!1)}return o.delete(t),o.delete(e),g}(t,e,r,i,s,o))}(t,e,r,i,Nr,s))}function Or(t,e,r,i){var s=r.length,o=s,a=!i;if(null==t)return!o;for(t=Ct(t);s--;){var l=r[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<o;){var c=(l=r[s])[0],u=t[c],h=l[1];if(a&&l[2]){if(u===n&&!(c in t))return!1}else{var d=new Yn;if(i)var p=i(u,h,c,t,e,d);if(!(p===n?Nr(h,u,3,i,d):p))return!1}}return!0}function kr(t){return!(!ea(t)||function(t){return!!Ft&&Ft in t}(t))&&(Ko(t)?jt:yt).test(Us(t))}function Dr(t){return"function"==typeof t?t:null==t?il:"object"==typeof t?Go(t)?Hr(t[0],t[1]):Vr(t):pl(t)}function zr(t){if(!Ms(t))return yn(t);var e=[];for(var n in Ct(t))zt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Ur(t){if(!ea(t))return function(t){var e=[];if(null!=t)for(var n in Ct(t))e.push(n);return e}(t);var e=Ms(t),n=[];for(var r in t)"constructor"==r&&(e||!zt.call(t,r))||n.push(r);return n}function Fr(t,e){return t<e}function Br(t,e){var n=-1,r=$o(t)?at(t.length):[];return pr(t,(function(t,i,s){r[++n]=e(t,i,s)})),r}function Vr(t){var e=hs(t);return 1==e.length&&e[0][2]?Ts(e[0][0],e[0][1]):function(n){return n===t||Or(n,t,e)}}function Hr(t,e){return xs(t)&&Es(e)?Ts(zs(t),e):function(r){var i=Aa(r,t);return i===n&&i===e?Ca(r,t):Nr(e,i,3)}}function jr(t,e,r,i,s){t!==e&&_r(e,(function(o,a){if(s||(s=new Yn),ea(o))!function(t,e,r,i,s,o,a){var l=Ps(t,r),c=Ps(e,r),u=a.get(c);if(u)return void er(t,r,u);var h=o?o(l,c,r+"",t,e,a):n,d=h===n;if(d){var p=Go(c),f=!p&&Jo(c),m=!p&&!f&&ua(c);h=c,p||f||m?Go(l)?h=l:Xo(l)?h=Ii(l):f?(d=!1,h=Mi(c,!0)):m?(d=!1,h=Ti(c,!0)):h=[]:sa(c)||Wo(c)?(h=l,Wo(l)?h=ya(l):(!ea(l)||Ko(l))&&(h=vs(c))):d=!1}d&&(a.set(c,h),s(h,c,i,o,a),a.delete(c)),er(t,r,h)}(t,e,a,r,jr,i,s);else{var l=i?i(Ps(t,a),o,a+"",t,e,s):n;l===n&&(l=o),er(t,a,l)}}),Na)}function Wr(t,e){var r=t.length;if(r)return _s(e+=e<0?r:0,r)?t[e]:n}function Gr(t,e,n){e=e.length?ke(e,(function(t){return Go(t)?function(e){return Mr(e,1===t.length?t[0]:t)}:t})):[il];var r=-1;return e=ke(e,Qe(cs())),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(Br(t,(function(t,n,i){return{criteria:ke(e,(function(e){return e(t)})),index:++r,value:t}})),(function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,s=e.criteria,o=i.length,a=n.length;++r<o;){var l=Ai(i[r],s[r]);if(l)return r>=a?l:l*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function qr(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Mr(t,o);n(a,o)&&ti(s,bi(o,t),a)}return s}function $r(t,e,n,r){var i=r?We:je,s=-1,o=e.length,a=t;for(t===e&&(e=Ii(e)),n&&(a=ke(t,Qe(n)));++s<o;)for(var l=0,c=e[s],u=n?n(c):c;(l=i(a,u,l,r))>-1;)a!==t&&Zt.call(a,l,1),Zt.call(t,l,1);return t}function Xr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==s){var s=i;_s(i)?Zt.call(t,i,1):di(t,i)}}return t}function Jr(t,e){return t+ve(Sn()*(e-t+1))}function Yr(t,e){var n="";if(!t||e<1||e>d)return n;do{e%2&&(n+=t),(e=ve(e/2))&&(t+=t)}while(e);return n}function Zr(t,e){return Ls(As(t,e,il),t+"")}function Kr(t){return Kn(Va(t))}function Qr(t,e){var n=Va(t);return ks(n,lr(e,0,n.length))}function ti(t,e,r,i){if(!ea(t))return t;for(var s=-1,o=(e=bi(e,t)).length,a=o-1,l=t;null!=l&&++s<o;){var c=zs(e[s]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(s!=a){var h=l[c];(u=i?i(h,c,l):n)===n&&(u=ea(h)?h:_s(e[s+1])?[]:{})}nr(l,c,u),l=l[c]}return t}var ei=Rn?function(t,e){return Rn.set(t,e),t}:il,ni=ie?function(t,e){return ie(t,"toString",{configurable:!0,enumerable:!1,value:el(e),writable:!0})}:il;function ri(t){return ks(Va(t))}function ii(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=at(i);++r<i;)s[r]=t[r+e];return s}function si(t,e){var n;return pr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function oi(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e===e&&i<=g){for(;r<i;){var s=r+i>>>1,o=t[s];null!==o&&!ca(o)&&(n?o<=e:o<e)?r=s+1:i=s}return i}return ai(t,e,il,n)}function ai(t,e,r,i){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=r(e))!==e,l=null===e,c=ca(e),u=e===n;s<o;){var h=ve((s+o)/2),d=r(t[h]),p=d!==n,f=null===d,g=d===d,v=ca(d);if(a)var y=i||g;else y=u?g&&(i||p):l?g&&p&&(i||!f):c?g&&p&&!f&&(i||!v):!f&&!v&&(i?d<=e:d<e);y?s=h+1:o=h}return bn(o,m)}function li(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var o=t[n],a=e?e(o):o;if(!n||!Vo(a,l)){var l=a;s[i++]=0===o?0:o}}return s}function ci(t){return"number"==typeof t?t:ca(t)?p:+t}function ui(t){if("string"==typeof t)return t;if(Go(t))return ke(t,ui)+"";if(ca(t))return Bn?Bn.call(t):"";var e=t+"";return"0"==e&&1/t==-h?"-0":e}function hi(t,e,n){var r=-1,i=Ne,s=t.length,o=!0,a=[],l=a;if(n)o=!1,i=Oe;else if(s>=200){var c=e?null:Yi(t);if(c)return dn(c);o=!1,i=en,l=new Jn}else l=e?[]:a;t:for(;++r<s;){var u=t[r],h=e?e(u):u;if(u=n||0!==u?u:0,o&&h===h){for(var d=l.length;d--;)if(l[d]===h)continue t;e&&l.push(h),a.push(u)}else i(l,h,n)||(l!==a&&l.push(h),a.push(u))}return a}function di(t,e){return null==(t=Cs(t,e=bi(e,t)))||delete t[zs(Ys(e))]}function pi(t,e,n,r){return ti(t,e,n(Mr(t,e)),r)}function fi(t,e,n,r){for(var i=t.length,s=r?i:-1;(r?s--:++s<i)&&e(t[s],s,t););return n?ii(t,r?0:s,r?s+1:i):ii(t,r?s+1:0,r?i:s)}function mi(t,e){var n=t;return n instanceof Gn&&(n=n.value()),ze(e,(function(t,e){return e.func.apply(e.thisArg,De([t],e.args))}),n)}function gi(t,e,n){var r=t.length;if(r<2)return r?hi(t[0]):[];for(var i=-1,s=at(r);++i<r;)for(var o=t[i],a=-1;++a<r;)a!=i&&(s[i]=dr(s[i]||o,t[a],e,n));return hi(yr(s,1),e,n)}function vi(t,e,r){for(var i=-1,s=t.length,o=e.length,a={};++i<s;){var l=i<o?e[i]:n;r(a,t[i],l)}return a}function yi(t){return Xo(t)?t:[]}function _i(t){return"function"==typeof t?t:il}function bi(t,e){return Go(t)?t:xs(t,e)?[t]:Ds(_a(t))}var xi=Zr;function wi(t,e,r){var i=t.length;return r=r===n?i:r,!e&&r>=i?t:ii(t,e,r)}var Si=ue||function(t){return me.clearTimeout(t)};function Mi(t,e){if(e)return t.slice();var n=t.length,r=$t?$t(n):new t.constructor(n);return t.copy(r),r}function Ei(t){var e=new t.constructor(t.byteLength);return new qt(e).set(new qt(t)),e}function Ti(t,e){var n=e?Ei(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Ai(t,e){if(t!==e){var r=t!==n,i=null===t,s=t===t,o=ca(t),a=e!==n,l=null===e,c=e===e,u=ca(e);if(!l&&!u&&!o&&t>e||o&&a&&c&&!l&&!u||i&&a&&c||!r&&c||!s)return 1;if(!i&&!o&&!u&&t<e||u&&r&&s&&!i&&!o||l&&r&&s||!a&&s||!c)return-1}return 0}function Ci(t,e,n,r){for(var i=-1,s=t.length,o=n.length,a=-1,l=e.length,c=_n(s-o,0),u=at(l+c),h=!r;++a<l;)u[a]=e[a];for(;++i<o;)(h||i<s)&&(u[n[i]]=t[i]);for(;c--;)u[a++]=t[i++];return u}function Pi(t,e,n,r){for(var i=-1,s=t.length,o=-1,a=n.length,l=-1,c=e.length,u=_n(s-a,0),h=at(u+c),d=!r;++i<u;)h[i]=t[i];for(var p=i;++l<c;)h[p+l]=e[l];for(;++o<a;)(d||i<s)&&(h[p+n[o]]=t[i++]);return h}function Ii(t,e){var n=-1,r=t.length;for(e||(e=at(r));++n<r;)e[n]=t[n];return e}function Ri(t,e,r,i){var s=!r;r||(r={});for(var o=-1,a=e.length;++o<a;){var l=e[o],c=i?i(r[l],t[l],l,r,t):n;c===n&&(c=t[l]),s?or(r,l,c):nr(r,l,c)}return r}function Li(t,e){return function(n,r){var i=Go(n)?Ce:ir,s=e?e():{};return i(n,t,cs(r,2),s)}}function Ni(t){return Zr((function(e,r){var i=-1,s=r.length,o=s>1?r[s-1]:n,a=s>2?r[2]:n;for(o=t.length>3&&"function"==typeof o?(s--,o):n,a&&bs(r[0],r[1],a)&&(o=s<3?n:o,s=1),e=Ct(e);++i<s;){var l=r[i];l&&t(e,l,i,o)}return e}))}function Oi(t,e){return function(n,r){if(null==n)return n;if(!$o(n))return t(n,r);for(var i=n.length,s=e?i:-1,o=Ct(n);(e?s--:++s<i)&&!1!==r(o[s],s,o););return n}}function ki(t){return function(e,n,r){for(var i=-1,s=Ct(e),o=r(e),a=o.length;a--;){var l=o[t?a:++i];if(!1===n(s[l],l,s))break}return e}}function Di(t){return function(e){var r=ln(e=_a(e))?fn(e):n,i=r?r[0]:e.charAt(0),s=r?wi(r,1).join(""):e.slice(1);return i[t]()+s}}function zi(t){return function(e){return ze(Ka(Wa(e).replace(te,"")),t,"")}}function Ui(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Hn(t.prototype),r=t.apply(n,e);return ea(r)?r:n}}function Fi(t){return function(e,r,i){var s=Ct(e);if(!$o(e)){var o=cs(r,3);e=La(e),r=function(t){return o(s[t],t,s)}}var a=t(e,r,i);return a>-1?s[o?e[a]:a]:n}}function Bi(t){return rs((function(e){var i=e.length,s=i,o=Wn.prototype.thru;for(t&&e.reverse();s--;){var a=e[s];if("function"!=typeof a)throw new Rt(r);if(o&&!l&&"wrapper"==as(a))var l=new Wn([],!0)}for(s=l?s:i;++s<i;){var c=as(a=e[s]),u="wrapper"==c?os(a):n;l=u&&ws(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[as(u[0])].apply(l,u[3]):1==a.length&&ws(a)?l[c]():l.thru(a)}return function(){var t=arguments,n=t[0];if(l&&1==t.length&&Go(n))return l.plant(n).value();for(var r=0,s=i?e[r].apply(this,t):n;++r<i;)s=e[r].call(this,s);return s}}))}function Vi(t,e,r,i,s,o,a,l,u,h){var d=e&c,p=1&e,f=2&e,m=24&e,g=512&e,v=f?n:Ui(t);return function c(){for(var y=arguments.length,_=at(y),b=y;b--;)_[b]=arguments[b];if(m)var x=ls(c),w=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(_,x);if(i&&(_=Ci(_,i,s,m)),o&&(_=Pi(_,o,a,m)),y-=w,m&&y<h){var S=hn(_,x);return Xi(t,e,Vi,c.placeholder,r,_,S,l,u,h-y)}var M=p?r:this,E=f?M[t]:t;return y=_.length,l?_=function(t,e){for(var r=t.length,i=bn(e.length,r),s=Ii(t);i--;){var o=e[i];t[i]=_s(o,r)?s[o]:n}return t}(_,l):g&&y>1&&_.reverse(),d&&u<y&&(_.length=u),this&&this!==me&&this instanceof c&&(E=v||Ui(E)),E.apply(M,_)}}function Hi(t,e){return function(n,r){return function(t,e,n,r){return xr(t,(function(t,i,s){e(r,n(t),i,s)})),r}(n,t,e(r),{})}}function ji(t,e){return function(r,i){var s;if(r===n&&i===n)return e;if(r!==n&&(s=r),i!==n){if(s===n)return i;"string"==typeof r||"string"==typeof i?(r=ui(r),i=ui(i)):(r=ci(r),i=ci(i)),s=t(r,i)}return s}}function Wi(t){return rs((function(e){return e=ke(e,Qe(cs())),Zr((function(n){var r=this;return t(e,(function(t){return Ae(t,r,n)}))}))}))}function Gi(t,e){var r=(e=e===n?" ":ui(e)).length;if(r<2)return r?Yr(e,t):e;var i=Yr(e,ge(t/pn(e)));return ln(e)?wi(fn(i),0,t).join(""):i.slice(0,t)}function qi(t){return function(e,r,i){return i&&"number"!=typeof i&&bs(e,r,i)&&(r=i=n),e=fa(e),r===n?(r=e,e=0):r=fa(r),function(t,e,n,r){for(var i=-1,s=_n(ge((e-t)/(n||1)),0),o=at(s);s--;)o[r?s:++i]=t,t+=n;return o}(e,r,i=i===n?e<r?1:-1:fa(i),t)}}function $i(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=va(e),n=va(n)),t(e,n)}}function Xi(t,e,r,i,s,o,c,u,h,d){var p=8&e;e|=p?a:l,4&(e&=~(p?l:a))||(e&=-4);var f=[t,e,s,p?o:n,p?c:n,p?n:o,p?n:c,u,h,d],m=r.apply(n,f);return ws(t)&&Is(m,f),m.placeholder=i,Ns(m,t,e)}function Ji(t){var e=At[t];return function(t,n){if(t=va(t),(n=null==n?0:bn(ma(n),292))&&Be(t)){var r=(_a(t)+"e").split("e");return+((r=(_a(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Yi=Cn&&1/dn(new Cn([,-0]))[1]==h?function(t){return new Cn(t)}:cl;function Zi(t){return function(e){var n=ms(e);return n==E?cn(e):n==I?function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}(e):function(t,e){return ke(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ki(t,e,i,h,d,p,f,m){var g=2&e;if(!g&&"function"!=typeof t)throw new Rt(r);var v=h?h.length:0;if(v||(e&=-97,h=d=n),f=f===n?f:_n(ma(f),0),m=m===n?m:ma(m),v-=d?d.length:0,e&l){var y=h,_=d;h=d=n}var b=g?n:os(t),x=[t,e,i,h,d,y,_,p,f,m];if(b&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<131,a=r==c&&8==n||r==c&&n==u&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==n;if(!o&&!a)return t;1&r&&(t[2]=e[2],i|=1&n?0:4);var l=e[3];if(l){var h=t[3];t[3]=h?Ci(h,l,e[4]):l,t[4]=h?hn(t[3],s):e[4]}l=e[5],l&&(h=t[5],t[5]=h?Pi(h,l,e[6]):l,t[6]=h?hn(t[5],s):e[6]),l=e[7],l&&(t[7]=l),r&c&&(t[8]=null==t[8]?e[8]:bn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i}(x,b),t=x[0],e=x[1],i=x[2],h=x[3],d=x[4],!(m=x[9]=x[9]===n?g?0:t.length:_n(x[9]-v,0))&&24&e&&(e&=-25),e&&1!=e)w=8==e||e==o?function(t,e,r){var i=Ui(t);return function s(){for(var o=arguments.length,a=at(o),l=o,c=ls(s);l--;)a[l]=arguments[l];var u=o<3&&a[0]!==c&&a[o-1]!==c?[]:hn(a,c);return(o-=u.length)<r?Xi(t,e,Vi,s.placeholder,n,a,u,n,n,r-o):Ae(this&&this!==me&&this instanceof s?i:t,this,a)}}(t,e,m):e!=a&&33!=e||d.length?Vi.apply(n,x):function(t,e,n,r){var i=1&e,s=Ui(t);return function e(){for(var o=-1,a=arguments.length,l=-1,c=r.length,u=at(c+a),h=this&&this!==me&&this instanceof e?s:t;++l<c;)u[l]=r[l];for(;a--;)u[l++]=arguments[++o];return Ae(h,i?n:this,u)}}(t,e,i,h);else var w=function(t,e,n){var r=1&e,i=Ui(t);return function e(){return(this&&this!==me&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,i);return Ns((b?ei:Is)(w,x),t,e)}function Qi(t,e,r,i){return t===n||Vo(t,Ot[r])&&!zt.call(i,r)?e:t}function ts(t,e,r,i,s,o){return ea(t)&&ea(e)&&(o.set(e,t),jr(t,e,n,ts,o),o.delete(e)),t}function es(t){return sa(t)?n:t}function ns(t,e,r,i,s,o){var a=1&r,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var u=o.get(t),h=o.get(e);if(u&&h)return u==e&&h==t;var d=-1,p=!0,f=2&r?new Jn:n;for(o.set(t,e),o.set(e,t);++d<l;){var m=t[d],g=e[d];if(i)var v=a?i(g,m,d,e,t,o):i(m,g,d,t,e,o);if(v!==n){if(v)continue;p=!1;break}if(f){if(!Fe(e,(function(t,e){if(!en(f,e)&&(m===t||s(m,t,r,i,o)))return f.push(e)}))){p=!1;break}}else if(m!==g&&!s(m,g,r,i,o)){p=!1;break}}return o.delete(t),o.delete(e),p}function rs(t){return Ls(As(t,n,Gs),t+"")}function is(t){return Er(t,La,ps)}function ss(t){return Er(t,Na,fs)}var os=Rn?function(t){return Rn.get(t)}:cl;function as(t){for(var e=t.name+"",n=Ln[e],r=zt.call(Ln,e)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==t)return i.name}return e}function ls(t){return(zt.call(Vn,"placeholder")?Vn:t).placeholder}function cs(){var t=Vn.iteratee||sl;return t=t===sl?Dr:t,arguments.length?t(arguments[0],arguments[1]):t}function us(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function hs(t){for(var e=La(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Es(i)]}return e}function ds(t,e){var r=function(t,e){return null==t?n:t[e]}(t,e);return kr(r)?r:n}var ps=_e?function(t){return null==t?[]:(t=Ct(t),Le(_e(t),(function(e){return Yt.call(t,e)})))}:gl,fs=_e?function(t){for(var e=[];t;)De(e,ps(t)),t=Xt(t);return e}:gl,ms=Tr;function gs(t,e,n){for(var r=-1,i=(e=bi(e,t)).length,s=!1;++r<i;){var o=zs(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&ta(i)&&_s(o,i)&&(Go(t)||Wo(t))}function vs(t){return"function"!=typeof t.constructor||Ms(t)?{}:Hn(Xt(t))}function ys(t){return Go(t)||Wo(t)||!!(Kt&&t&&t[Kt])}function _s(t,e){var n=typeof t;return!!(e=e??d)&&("number"==n||"symbol"!=n&&bt.test(t))&&t>-1&&t%1==0&&t<e}function bs(t,e,n){if(!ea(n))return!1;var r=typeof e;return!!("number"==r?$o(n)&&_s(e,n.length):"string"==r&&e in n)&&Vo(n[e],t)}function xs(t,e){if(Go(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ca(t))||(nt.test(t)||!et.test(t)||null!=e&&t in Ct(e))}function ws(t){var e=as(t),n=Vn[e];if("function"!=typeof n||!(e in Gn.prototype))return!1;if(t===n)return!0;var r=os(n);return!!r&&t===r[0]}(En&&ms(new En(new ArrayBuffer(1)))!=k||Tn&&ms(new Tn)!=E||An&&ms(An.resolve())!=C||Cn&&ms(new Cn)!=I||Pn&&ms(new Pn)!=N)&&(ms=function(t){var e=Tr(t),r=e==A?t.constructor:n,i=r?Us(r):"";if(i)switch(i){case Nn:return k;case On:return E;case kn:return C;case Dn:return I;case zn:return N}return e});var Ss=kt?Ko:vl;function Ms(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ot)}function Es(t){return t===t&&!ea(t)}function Ts(t,e){return function(r){return null!=r&&(r[t]===e&&(e!==n||t in Ct(r)))}}function As(t,e,r){return e=_n(e===n?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=_n(n.length-e,0),o=at(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=at(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),Ae(t,this,a)}}function Cs(t,e){return e.length<2?t:Mr(t,ii(e,0,-1))}function Ps(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Is=Os(ei),Rs=fe||function(t,e){return me.setTimeout(t,e)},Ls=Os(ni);function Ns(t,e,n){var r=e+"";return Ls(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(lt,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Pe(v,(function(n){var r="_."+n[0];e&n[1]&&!Ne(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(ct);return e?e[1].split(ut):[]}(r),n)))}function Os(t){var e=0,r=0;return function(){var i=xn(),s=16-(i-r);if(r=i,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(n,arguments)}}function ks(t,e){var r=-1,i=t.length,s=i-1;for(e=e===n?i:e;++r<e;){var o=Jr(r,s),a=t[o];t[o]=t[r],t[r]=a}return t.length=e,t}var Ds=function(t){var e=ko(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(rt,(function(t,n,r,i){e.push(r?i.replace(pt,"$1"):n||t)})),e}));function zs(t){if("string"==typeof t||ca(t))return t;var e=t+"";return"0"==e&&1/t==-h?"-0":e}function Us(t){if(null!=t){try{return Dt.call(t)}catch{}try{return t+""}catch{}}return""}function Fs(t){if(t instanceof Gn)return t.clone();var e=new Wn(t.__wrapped__,t.__chain__);return e.__actions__=Ii(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Bs=Zr((function(t,e){return Xo(t)?dr(t,yr(e,1,Xo,!0)):[]})),Vs=Zr((function(t,e){var r=Ys(e);return Xo(r)&&(r=n),Xo(t)?dr(t,yr(e,1,Xo,!0),cs(r,2)):[]})),Hs=Zr((function(t,e){var r=Ys(e);return Xo(r)&&(r=n),Xo(t)?dr(t,yr(e,1,Xo,!0),n,r):[]}));function js(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ma(n);return i<0&&(i=_n(r+i,0)),He(t,cs(e,3),i)}function Ws(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i-1;return r!==n&&(s=ma(r),s=r<0?_n(i+s,0):bn(s,i-1)),He(t,cs(e,3),s,!0)}function Gs(t){return(null==t?0:t.length)?yr(t,1):[]}function qs(t){return t&&t.length?t[0]:n}var $s=Zr((function(t){var e=ke(t,yi);return e.length&&e[0]===t[0]?Ir(e):[]})),Xs=Zr((function(t){var e=Ys(t),r=ke(t,yi);return e===Ys(r)?e=n:r.pop(),r.length&&r[0]===t[0]?Ir(r,cs(e,2)):[]})),Js=Zr((function(t){var e=Ys(t),r=ke(t,yi);return(e="function"==typeof e?e:n)&&r.pop(),r.length&&r[0]===t[0]?Ir(r,n,e):[]}));function Ys(t){var e=null==t?0:t.length;return e?t[e-1]:n}var Zs=Zr(Ks);function Ks(t,e){return t&&t.length&&e&&e.length?$r(t,e):t}var Qs=rs((function(t,e){var n=null==t?0:t.length,r=ar(t,e);return Xr(t,ke(e,(function(t){return _s(t,n)?+t:t})).sort(Ai)),r}));function to(t){return null==t?t:Mn.call(t)}var eo=Zr((function(t){return hi(yr(t,1,Xo,!0))})),no=Zr((function(t){var e=Ys(t);return Xo(e)&&(e=n),hi(yr(t,1,Xo,!0),cs(e,2))})),ro=Zr((function(t){var e=Ys(t);return e="function"==typeof e?e:n,hi(yr(t,1,Xo,!0),n,e)}));function io(t){if(!t||!t.length)return[];var e=0;return t=Le(t,(function(t){if(Xo(t))return e=_n(t.length,e),!0})),Ze(e,(function(e){return ke(t,$e(e))}))}function so(t,e){if(!t||!t.length)return[];var r=io(t);return null==e?r:ke(r,(function(t){return Ae(e,n,t)}))}var oo=Zr((function(t,e){return Xo(t)?dr(t,e):[]})),ao=Zr((function(t){return gi(Le(t,Xo))})),lo=Zr((function(t){var e=Ys(t);return Xo(e)&&(e=n),gi(Le(t,Xo),cs(e,2))})),co=Zr((function(t){var e=Ys(t);return e="function"==typeof e?e:n,gi(Le(t,Xo),n,e)})),uo=Zr(io);var ho=Zr((function(t){var e=t.length,r=e>1?t[e-1]:n;return r="function"==typeof r?(t.pop(),r):n,so(t,r)}));function po(t){var e=Vn(t);return e.__chain__=!0,e}function fo(t,e){return e(t)}var mo=rs((function(t){var e=t.length,r=e?t[0]:0,i=this.__wrapped__,s=function(e){return ar(e,t)};return!(e>1||this.__actions__.length)&&i instanceof Gn&&_s(r)?((i=i.slice(r,+r+(e?1:0))).__actions__.push({func:fo,args:[s],thisArg:n}),new Wn(i,this.__chain__).thru((function(t){return e&&!t.length&&t.push(n),t}))):this.thru(s)}));var go=Li((function(t,e,n){zt.call(t,n)?++t[n]:or(t,n,1)}));var vo=Fi(js),yo=Fi(Ws);function _o(t,e){return(Go(t)?Pe:pr)(t,cs(e,3))}function bo(t,e){return(Go(t)?Ie:fr)(t,cs(e,3))}var xo=Li((function(t,e,n){zt.call(t,n)?t[n].push(e):or(t,n,[e])}));var wo=Zr((function(t,e,n){var r=-1,i="function"==typeof e,s=$o(t)?at(t.length):[];return pr(t,(function(t){s[++r]=i?Ae(e,t,n):Rr(t,e,n)})),s})),So=Li((function(t,e,n){or(t,n,e)}));function Mo(t,e){return(Go(t)?ke:Br)(t,cs(e,3))}var Eo=Li((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var To=Zr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&bs(t,e[0],e[1])?e=[]:n>2&&bs(e[0],e[1],e[2])&&(e=[e[0]]),Gr(t,yr(e,1),[])})),Ao=pe||function(){return me.Date.now()};function Co(t,e,r){return e=r?n:e,e=t&&null==e?t.length:e,Ki(t,c,n,n,n,n,e)}function Po(t,e){var i;if("function"!=typeof e)throw new Rt(r);return t=ma(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=n),i}}var Io=Zr((function(t,e,n){var r=1;if(n.length){var i=hn(n,ls(Io));r|=a}return Ki(t,r,e,n,i)})),Ro=Zr((function(t,e,n){var r=3;if(n.length){var i=hn(n,ls(Ro));r|=a}return Ki(e,r,t,n,i)}));function Lo(t,e,i){var s,o,a,l,c,u,h=0,d=!1,p=!1,f=!0;if("function"!=typeof t)throw new Rt(r);function m(e){var r=s,i=o;return s=o=n,h=e,l=t.apply(i,r)}function g(t){var r=t-u;return u===n||r>=e||r<0||p&&t-h>=a}function v(){var t=Ao();if(g(t))return y(t);c=Rs(v,function(t){var n=e-(t-u);return p?bn(n,a-(t-h)):n}(t))}function y(t){return c=n,f&&s?m(t):(s=o=n,l)}function _(){var t=Ao(),r=g(t);if(s=arguments,o=this,u=t,r){if(c===n)return function(t){return h=t,c=Rs(v,e),d?m(t):l}(u);if(p)return Si(c),c=Rs(v,e),m(u)}return c===n&&(c=Rs(v,e)),l}return e=va(e)||0,ea(i)&&(d=!!i.leading,a=(p="maxWait"in i)?_n(va(i.maxWait)||0,e):a,f="trailing"in i?!!i.trailing:f),_.cancel=function(){c!==n&&Si(c),h=0,s=u=o=c=n},_.flush=function(){return c===n?l:y(Ao())},_}var No=Zr((function(t,e){return hr(t,1,e)})),Oo=Zr((function(t,e,n){return hr(t,va(e)||0,n)}));function ko(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Rt(r);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(ko.Cache||Xn),n}function Do(t){if("function"!=typeof t)throw new Rt(r);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}ko.Cache=Xn;var zo=xi((function(t,e){var n=(e=1==e.length&&Go(e[0])?ke(e[0],Qe(cs())):ke(yr(e,1),Qe(cs()))).length;return Zr((function(r){for(var i=-1,s=bn(r.length,n);++i<s;)r[i]=e[i].call(this,r[i]);return Ae(t,this,r)}))})),Uo=Zr((function(t,e){var r=hn(e,ls(Uo));return Ki(t,a,n,e,r)})),Fo=Zr((function(t,e){var r=hn(e,ls(Fo));return Ki(t,l,n,e,r)})),Bo=rs((function(t,e){return Ki(t,u,n,n,n,e)}));function Vo(t,e){return t===e||t!==t&&e!==e}var Ho=$i(Ar),jo=$i((function(t,e){return t>=e})),Wo=Lr(function(){return arguments}())?Lr:function(t){return na(t)&&zt.call(t,"callee")&&!Yt.call(t,"callee")},Go=at.isArray,qo=xe?Qe(xe):function(t){return na(t)&&Tr(t)==O};function $o(t){return null!=t&&ta(t.length)&&!Ko(t)}function Xo(t){return na(t)&&$o(t)}var Jo=be||vl,Yo=we?Qe(we):function(t){return na(t)&&Tr(t)==x};function Zo(t){if(!na(t))return!1;var e=Tr(t);return e==w||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!sa(t)}function Ko(t){if(!ea(t))return!1;var e=Tr(t);return e==S||e==M||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Qo(t){return"number"==typeof t&&t==ma(t)}function ta(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=d}function ea(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function na(t){return null!=t&&"object"==typeof t}var ra=Se?Qe(Se):function(t){return na(t)&&ms(t)==E};function ia(t){return"number"==typeof t||na(t)&&Tr(t)==T}function sa(t){if(!na(t)||Tr(t)!=A)return!1;var e=Xt(t);if(null===e)return!0;var n=zt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Dt.call(n)==Vt}var oa=Me?Qe(Me):function(t){return na(t)&&Tr(t)==P};var aa=Ee?Qe(Ee):function(t){return na(t)&&ms(t)==I};function la(t){return"string"==typeof t||!Go(t)&&na(t)&&Tr(t)==R}function ca(t){return"symbol"==typeof t||na(t)&&Tr(t)==L}var ua=Te?Qe(Te):function(t){return na(t)&&ta(t.length)&&!!le[Tr(t)]};var ha=$i(Fr),da=$i((function(t,e){return t<=e}));function pa(t){if(!t)return[];if($o(t))return la(t)?fn(t):Ii(t);if(Qt&&t[Qt])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[Qt]());var e=ms(t);return(e==E?cn:e==I?dn:Va)(t)}function fa(t){return t?(t=va(t))===h||t===-h?17976931348623157e292*(t<0?-1:1):t===t?t:0:0===t?t:0}function ma(t){var e=fa(t),n=e%1;return e===e?n?e-n:e:0}function ga(t){return t?lr(ma(t),0,f):0}function va(t){if("number"==typeof t)return t;if(ca(t))return p;if(ea(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=ea(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ke(t);var n=vt.test(t);return n||_t.test(t)?de(t.slice(2),n?2:8):gt.test(t)?p:+t}function ya(t){return Ri(t,Na(t))}function _a(t){return null==t?"":ui(t)}var ba=Ni((function(t,e){if(Ms(e)||$o(e))Ri(e,La(e),t);else for(var n in e)zt.call(e,n)&&nr(t,n,e[n])})),xa=Ni((function(t,e){Ri(e,Na(e),t)})),wa=Ni((function(t,e,n,r){Ri(e,Na(e),t,r)})),Sa=Ni((function(t,e,n,r){Ri(e,La(e),t,r)})),Ma=rs(ar);var Ea=Zr((function(t,e){t=Ct(t);var r=-1,i=e.length,s=i>2?e[2]:n;for(s&&bs(e[0],e[1],s)&&(i=1);++r<i;)for(var o=e[r],a=Na(o),l=-1,c=a.length;++l<c;){var u=a[l],h=t[u];(h===n||Vo(h,Ot[u])&&!zt.call(t,u))&&(t[u]=o[u])}return t})),Ta=Zr((function(t){return t.push(n,ts),Ae(ka,n,t)}));function Aa(t,e,r){var i=null==t?n:Mr(t,e);return i===n?r:i}function Ca(t,e){return null!=t&&gs(t,e,Pr)}var Pa=Hi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),t[e]=n}),el(il)),Ia=Hi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),zt.call(t,e)?t[e].push(n):t[e]=[n]}),cs),Ra=Zr(Rr);function La(t){return $o(t)?Zn(t):zr(t)}function Na(t){return $o(t)?Zn(t,!0):Ur(t)}var Oa=Ni((function(t,e,n){jr(t,e,n)})),ka=Ni((function(t,e,n,r){jr(t,e,n,r)})),Da=rs((function(t,e){var n={};if(null==t)return n;var r=!1;e=ke(e,(function(e){return e=bi(e,t),r||(r=e.length>1),e})),Ri(t,ss(t),n),r&&(n=cr(n,7,es));for(var i=e.length;i--;)di(n,e[i]);return n}));var za=rs((function(t,e){return null==t?{}:function(t,e){return qr(t,e,(function(e,n){return Ca(t,n)}))}(t,e)}));function Ua(t,e){if(null==t)return{};var n=ke(ss(t),(function(t){return[t]}));return e=cs(e),qr(t,n,(function(t,n){return e(t,n[0])}))}var Fa=Zi(La),Ba=Zi(Na);function Va(t){return null==t?[]:tn(t,La(t))}var Ha=zi((function(t,e,n){return e=e.toLowerCase(),t+(n?ja(e):e)}));function ja(t){return Za(_a(t).toLowerCase())}function Wa(t){return(t=_a(t))&&t.replace(xt,sn).replace(ee,"")}var Ga=zi((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),qa=zi((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),$a=Di("toLowerCase");var Xa=zi((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var Ja=zi((function(t,e,n){return t+(n?" ":"")+Za(e)}));var Ya=zi((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Za=Di("toUpperCase");function Ka(t,e,r){return t=_a(t),(e=r?n:e)===n?function(t){return se.test(t)}(t)?function(t){return t.match(re)||[]}(t):function(t){return t.match(ht)||[]}(t):t.match(e)||[]}var Qa=Zr((function(t,e){try{return Ae(t,n,e)}catch(r){return Zo(r)?r:new Et(r)}})),tl=rs((function(t,e){return Pe(e,(function(e){e=zs(e),or(t,e,Io(t[e],t))})),t}));function el(t){return function(){return t}}var nl=Bi(),rl=Bi(!0);function il(t){return t}function sl(t){return Dr("function"==typeof t?t:cr(t,1))}var ol=Zr((function(t,e){return function(n){return Rr(n,t,e)}})),al=Zr((function(t,e){return function(n){return Rr(t,n,e)}}));function ll(t,e,n){var r=La(e),i=Sr(e,r);null==n&&(!ea(e)||!i.length&&r.length)&&(n=e,e=t,t=this,i=Sr(e,La(e)));var s=!(ea(n)&&"chain"in n)||!!n.chain,o=Ko(t);return Pe(i,(function(n){var r=e[n];t[n]=r,o&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__);return(n.__actions__=Ii(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,De([this.value()],arguments))})})),t}function cl(){}var ul=Wi(ke),hl=Wi(Re),dl=Wi(Fe);function pl(t){return xs(t)?$e(zs(t)):function(t){return function(e){return Mr(e,t)}}(t)}var fl=qi(),ml=qi(!0);function gl(){return[]}function vl(){return!1}var yl=ji((function(t,e){return t+e}),0),_l=Ji("ceil"),bl=ji((function(t,e){return t/e}),1),xl=Ji("floor");var wl=ji((function(t,e){return t*e}),1),Sl=Ji("round"),Ml=ji((function(t,e){return t-e}),0);return Vn.after=function(t,e){if("function"!=typeof e)throw new Rt(r);return t=ma(t),function(){if(--t<1)return e.apply(this,arguments)}},Vn.ary=Co,Vn.assign=ba,Vn.assignIn=xa,Vn.assignInWith=wa,Vn.assignWith=Sa,Vn.at=Ma,Vn.before=Po,Vn.bind=Io,Vn.bindAll=tl,Vn.bindKey=Ro,Vn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Go(t)?t:[t]},Vn.chain=po,Vn.chunk=function(t,e,r){e=(r?bs(t,e,r):e===n)?1:_n(ma(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var s=0,o=0,a=at(ge(i/e));s<i;)a[o++]=ii(t,s,s+=e);return a},Vn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i},Vn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=at(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return De(Go(n)?Ii(n):[n],yr(e,1))},Vn.cond=function(t){var e=null==t?0:t.length,n=cs();return t=e?ke(t,(function(t){if("function"!=typeof t[1])throw new Rt(r);return[n(t[0]),t[1]]})):[],Zr((function(n){for(var r=-1;++r<e;){var i=t[r];if(Ae(i[0],this,n))return Ae(i[1],this,n)}}))},Vn.conforms=function(t){return function(t){var e=La(t);return function(n){return ur(n,t,e)}}(cr(t,1))},Vn.constant=el,Vn.countBy=go,Vn.create=function(t,e){var n=Hn(t);return null==e?n:sr(n,e)},Vn.curry=function t(e,r,i){var s=Ki(e,8,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Vn.curryRight=function t(e,r,i){var s=Ki(e,o,n,n,n,n,n,r=i?n:r);return s.placeholder=t.placeholder,s},Vn.debounce=Lo,Vn.defaults=Ea,Vn.defaultsDeep=Ta,Vn.defer=No,Vn.delay=Oo,Vn.difference=Bs,Vn.differenceBy=Vs,Vn.differenceWith=Hs,Vn.drop=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=r||e===n?1:ma(e))<0?0:e,i):[]},Vn.dropRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,0,(e=i-(e=r||e===n?1:ma(e)))<0?0:e):[]},Vn.dropRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0,!0):[]},Vn.dropWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0):[]},Vn.fill=function(t,e,r,i){var s=null==t?0:t.length;return s?(r&&"number"!=typeof r&&bs(t,e,r)&&(r=0,i=s),function(t,e,r,i){var s=t.length;for((r=ma(r))<0&&(r=-r>s?0:s+r),(i=i===n||i>s?s:ma(i))<0&&(i+=s),i=r>i?0:ga(i);r<i;)t[r++]=e;return t}(t,e,r,i)):[]},Vn.filter=function(t,e){return(Go(t)?Le:vr)(t,cs(e,3))},Vn.flatMap=function(t,e){return yr(Mo(t,e),1)},Vn.flatMapDeep=function(t,e){return yr(Mo(t,e),h)},Vn.flatMapDepth=function(t,e,r){return r=r===n?1:ma(r),yr(Mo(t,e),r)},Vn.flatten=Gs,Vn.flattenDeep=function(t){return(null==t?0:t.length)?yr(t,h):[]},Vn.flattenDepth=function(t,e){return(null==t?0:t.length)?yr(t,e=e===n?1:ma(e)):[]},Vn.flip=function(t){return Ki(t,512)},Vn.flow=nl,Vn.flowRight=rl,Vn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Vn.functions=function(t){return null==t?[]:Sr(t,La(t))},Vn.functionsIn=function(t){return null==t?[]:Sr(t,Na(t))},Vn.groupBy=xo,Vn.initial=function(t){return(null==t?0:t.length)?ii(t,0,-1):[]},Vn.intersection=$s,Vn.intersectionBy=Xs,Vn.intersectionWith=Js,Vn.invert=Pa,Vn.invertBy=Ia,Vn.invokeMap=wo,Vn.iteratee=sl,Vn.keyBy=So,Vn.keys=La,Vn.keysIn=Na,Vn.map=Mo,Vn.mapKeys=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){or(n,e(t,r,i),t)})),n},Vn.mapValues=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){or(n,r,e(t,r,i))})),n},Vn.matches=function(t){return Vr(cr(t,1))},Vn.matchesProperty=function(t,e){return Hr(t,cr(e,1))},Vn.memoize=ko,Vn.merge=Oa,Vn.mergeWith=ka,Vn.method=ol,Vn.methodOf=al,Vn.mixin=ll,Vn.negate=Do,Vn.nthArg=function(t){return t=ma(t),Zr((function(e){return Wr(e,t)}))},Vn.omit=Da,Vn.omitBy=function(t,e){return Ua(t,Do(cs(e)))},Vn.once=function(t){return Po(2,t)},Vn.orderBy=function(t,e,r,i){return null==t?[]:(Go(e)||(e=null==e?[]:[e]),Go(r=i?n:r)||(r=null==r?[]:[r]),Gr(t,e,r))},Vn.over=ul,Vn.overArgs=zo,Vn.overEvery=hl,Vn.overSome=dl,Vn.partial=Uo,Vn.partialRight=Fo,Vn.partition=Eo,Vn.pick=za,Vn.pickBy=Ua,Vn.property=pl,Vn.propertyOf=function(t){return function(e){return null==t?n:Mr(t,e)}},Vn.pull=Zs,Vn.pullAll=Ks,Vn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?$r(t,e,cs(n,2)):t},Vn.pullAllWith=function(t,e,r){return t&&t.length&&e&&e.length?$r(t,e,n,r):t},Vn.pullAt=Qs,Vn.range=fl,Vn.rangeRight=ml,Vn.rearg=Bo,Vn.reject=function(t,e){return(Go(t)?Le:vr)(t,Do(cs(e,3)))},Vn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],s=t.length;for(e=cs(e,3);++r<s;){var o=t[r];e(o,r,t)&&(n.push(o),i.push(r))}return Xr(t,i),n},Vn.rest=function(t,e){if("function"!=typeof t)throw new Rt(r);return Zr(t,e=e===n?e:ma(e))},Vn.reverse=to,Vn.sampleSize=function(t,e,r){return e=(r?bs(t,e,r):e===n)?1:ma(e),(Go(t)?Qn:Qr)(t,e)},Vn.set=function(t,e,n){return null==t?t:ti(t,e,n)},Vn.setWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:ti(t,e,r,i)},Vn.shuffle=function(t){return(Go(t)?tr:ri)(t)},Vn.slice=function(t,e,r){var i=null==t?0:t.length;return i?(r&&"number"!=typeof r&&bs(t,e,r)?(e=0,r=i):(e=null==e?0:ma(e),r=r===n?i:ma(r)),ii(t,e,r)):[]},Vn.sortBy=To,Vn.sortedUniq=function(t){return t&&t.length?li(t):[]},Vn.sortedUniqBy=function(t,e){return t&&t.length?li(t,cs(e,2)):[]},Vn.split=function(t,e,r){return r&&"number"!=typeof r&&bs(t,e,r)&&(e=r=n),(r=r===n?f:r>>>0)?(t=_a(t))&&("string"==typeof e||null!=e&&!oa(e))&&(!(e=ui(e))&&ln(t))?wi(fn(t),0,r):t.split(e,r):[]},Vn.spread=function(t,e){if("function"!=typeof t)throw new Rt(r);return e=null==e?0:_n(ma(e),0),Zr((function(n){var r=n[e],i=wi(n,0,e);return r&&De(i,r),Ae(t,this,i)}))},Vn.tail=function(t){var e=null==t?0:t.length;return e?ii(t,1,e):[]},Vn.take=function(t,e,r){return t&&t.length?ii(t,0,(e=r||e===n?1:ma(e))<0?0:e):[]},Vn.takeRight=function(t,e,r){var i=null==t?0:t.length;return i?ii(t,(e=i-(e=r||e===n?1:ma(e)))<0?0:e,i):[]},Vn.takeRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!1,!0):[]},Vn.takeWhile=function(t,e){return t&&t.length?fi(t,cs(e,3)):[]},Vn.tap=function(t,e){return e(t),t},Vn.throttle=function(t,e,n){var i=!0,s=!0;if("function"!=typeof t)throw new Rt(r);return ea(n)&&(i="leading"in n?!!n.leading:i,s="trailing"in n?!!n.trailing:s),Lo(t,e,{leading:i,maxWait:e,trailing:s})},Vn.thru=fo,Vn.toArray=pa,Vn.toPairs=Fa,Vn.toPairsIn=Ba,Vn.toPath=function(t){return Go(t)?ke(t,zs):ca(t)?[t]:Ii(Ds(_a(t)))},Vn.toPlainObject=ya,Vn.transform=function(t,e,n){var r=Go(t),i=r||Jo(t)||ua(t);if(e=cs(e,4),null==n){var s=t&&t.constructor;n=i?r?new s:[]:ea(t)&&Ko(s)?Hn(Xt(t)):{}}return(i?Pe:xr)(t,(function(t,r,i){return e(n,t,r,i)})),n},Vn.unary=function(t){return Co(t,1)},Vn.union=eo,Vn.unionBy=no,Vn.unionWith=ro,Vn.uniq=function(t){return t&&t.length?hi(t):[]},Vn.uniqBy=function(t,e){return t&&t.length?hi(t,cs(e,2)):[]},Vn.uniqWith=function(t,e){return e="function"==typeof e?e:n,t&&t.length?hi(t,n,e):[]},Vn.unset=function(t,e){return null==t||di(t,e)},Vn.unzip=io,Vn.unzipWith=so,Vn.update=function(t,e,n){return null==t?t:pi(t,e,_i(n))},Vn.updateWith=function(t,e,r,i){return i="function"==typeof i?i:n,null==t?t:pi(t,e,_i(r),i)},Vn.values=Va,Vn.valuesIn=function(t){return null==t?[]:tn(t,Na(t))},Vn.without=oo,Vn.words=Ka,Vn.wrap=function(t,e){return Uo(_i(e),t)},Vn.xor=ao,Vn.xorBy=lo,Vn.xorWith=co,Vn.zip=uo,Vn.zipObject=function(t,e){return vi(t||[],e||[],nr)},Vn.zipObjectDeep=function(t,e){return vi(t||[],e||[],ti)},Vn.zipWith=ho,Vn.entries=Fa,Vn.entriesIn=Ba,Vn.extend=xa,Vn.extendWith=wa,ll(Vn,Vn),Vn.add=yl,Vn.attempt=Qa,Vn.camelCase=Ha,Vn.capitalize=ja,Vn.ceil=_l,Vn.clamp=function(t,e,r){return r===n&&(r=e,e=n),r!==n&&(r=(r=va(r))===r?r:0),e!==n&&(e=(e=va(e))===e?e:0),lr(va(t),e,r)},Vn.clone=function(t){return cr(t,4)},Vn.cloneDeep=function(t){return cr(t,5)},Vn.cloneDeepWith=function(t,e){return cr(t,5,e="function"==typeof e?e:n)},Vn.cloneWith=function(t,e){return cr(t,4,e="function"==typeof e?e:n)},Vn.conformsTo=function(t,e){return null==e||ur(t,e,La(e))},Vn.deburr=Wa,Vn.defaultTo=function(t,e){return null==t||t!==t?e:t},Vn.divide=bl,Vn.endsWith=function(t,e,r){t=_a(t),e=ui(e);var i=t.length,s=r=r===n?i:lr(ma(r),0,i);return(r-=e.length)>=0&&t.slice(r,s)==e},Vn.eq=Vo,Vn.escape=function(t){return(t=_a(t))&&Z.test(t)?t.replace(J,on):t},Vn.escapeRegExp=function(t){return(t=_a(t))&&st.test(t)?t.replace(it,"\\$&"):t},Vn.every=function(t,e,r){var i=Go(t)?Re:mr;return r&&bs(t,e,r)&&(e=n),i(t,cs(e,3))},Vn.find=vo,Vn.findIndex=js,Vn.findKey=function(t,e){return Ve(t,cs(e,3),xr)},Vn.findLast=yo,Vn.findLastIndex=Ws,Vn.findLastKey=function(t,e){return Ve(t,cs(e,3),wr)},Vn.floor=xl,Vn.forEach=_o,Vn.forEachRight=bo,Vn.forIn=function(t,e){return null==t?t:_r(t,cs(e,3),Na)},Vn.forInRight=function(t,e){return null==t?t:br(t,cs(e,3),Na)},Vn.forOwn=function(t,e){return t&&xr(t,cs(e,3))},Vn.forOwnRight=function(t,e){return t&&wr(t,cs(e,3))},Vn.get=Aa,Vn.gt=Ho,Vn.gte=jo,Vn.has=function(t,e){return null!=t&&gs(t,e,Cr)},Vn.hasIn=Ca,Vn.head=qs,Vn.identity=il,Vn.includes=function(t,e,n,r){t=$o(t)?t:Va(t),n=n&&!r?ma(n):0;var i=t.length;return n<0&&(n=_n(i+n,0)),la(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&je(t,e,n)>-1},Vn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ma(n);return i<0&&(i=_n(r+i,0)),je(t,e,i)},Vn.inRange=function(t,e,r){return e=fa(e),r===n?(r=e,e=0):r=fa(r),function(t,e,n){return t>=bn(e,n)&&t<_n(e,n)}(t=va(t),e,r)},Vn.invoke=Ra,Vn.isArguments=Wo,Vn.isArray=Go,Vn.isArrayBuffer=qo,Vn.isArrayLike=$o,Vn.isArrayLikeObject=Xo,Vn.isBoolean=function(t){return!0===t||!1===t||na(t)&&Tr(t)==b},Vn.isBuffer=Jo,Vn.isDate=Yo,Vn.isElement=function(t){return na(t)&&1===t.nodeType&&!sa(t)},Vn.isEmpty=function(t){if(null==t)return!0;if($o(t)&&(Go(t)||"string"==typeof t||"function"==typeof t.splice||Jo(t)||ua(t)||Wo(t)))return!t.length;var e=ms(t);if(e==E||e==I)return!t.size;if(Ms(t))return!zr(t).length;for(var n in t)if(zt.call(t,n))return!1;return!0},Vn.isEqual=function(t,e){return Nr(t,e)},Vn.isEqualWith=function(t,e,r){var i=(r="function"==typeof r?r:n)?r(t,e):n;return i===n?Nr(t,e,n,r):!!i},Vn.isError=Zo,Vn.isFinite=function(t){return"number"==typeof t&&Be(t)},Vn.isFunction=Ko,Vn.isInteger=Qo,Vn.isLength=ta,Vn.isMap=ra,Vn.isMatch=function(t,e){return t===e||Or(t,e,hs(e))},Vn.isMatchWith=function(t,e,r){return r="function"==typeof r?r:n,Or(t,e,hs(e),r)},Vn.isNaN=function(t){return ia(t)&&t!=+t},Vn.isNative=function(t){if(Ss(t))throw new Et("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return kr(t)},Vn.isNil=function(t){return null==t},Vn.isNull=function(t){return null===t},Vn.isNumber=ia,Vn.isObject=ea,Vn.isObjectLike=na,Vn.isPlainObject=sa,Vn.isRegExp=oa,Vn.isSafeInteger=function(t){return Qo(t)&&t>=-d&&t<=d},Vn.isSet=aa,Vn.isString=la,Vn.isSymbol=ca,Vn.isTypedArray=ua,Vn.isUndefined=function(t){return t===n},Vn.isWeakMap=function(t){return na(t)&&ms(t)==N},Vn.isWeakSet=function(t){return na(t)&&"[object WeakSet]"==Tr(t)},Vn.join=function(t,e){return null==t?"":Xe.call(t,e)},Vn.kebabCase=Ga,Vn.last=Ys,Vn.lastIndexOf=function(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var s=i;return r!==n&&(s=(s=ma(r))<0?_n(i+s,0):bn(s,i-1)),e===e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,s):He(t,Ge,s,!0)},Vn.lowerCase=qa,Vn.lowerFirst=$a,Vn.lt=ha,Vn.lte=da,Vn.max=function(t){return t&&t.length?gr(t,il,Ar):n},Vn.maxBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Ar):n},Vn.mean=function(t){return qe(t,il)},Vn.meanBy=function(t,e){return qe(t,cs(e,2))},Vn.min=function(t){return t&&t.length?gr(t,il,Fr):n},Vn.minBy=function(t,e){return t&&t.length?gr(t,cs(e,2),Fr):n},Vn.stubArray=gl,Vn.stubFalse=vl,Vn.stubObject=function(){return{}},Vn.stubString=function(){return""},Vn.stubTrue=function(){return!0},Vn.multiply=wl,Vn.nth=function(t,e){return t&&t.length?Wr(t,ma(e)):n},Vn.noConflict=function(){return me._===this&&(me._=Ht),this},Vn.noop=cl,Vn.now=Ao,Vn.pad=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Gi(ve(i),n)+t+Gi(ge(i),n)},Vn.padEnd=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;return e&&r<e?t+Gi(e-r,n):t},Vn.padStart=function(t,e,n){t=_a(t);var r=(e=ma(e))?pn(t):0;return e&&r<e?Gi(e-r,n)+t:t},Vn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),wn(_a(t).replace(ot,""),e||0)},Vn.random=function(t,e,r){if(r&&"boolean"!=typeof r&&bs(t,e,r)&&(e=r=n),r===n&&("boolean"==typeof e?(r=e,e=n):"boolean"==typeof t&&(r=t,t=n)),t===n&&e===n?(t=0,e=1):(t=fa(t),e===n?(e=t,t=0):e=fa(e)),t>e){var i=t;t=e,e=i}if(r||t%1||e%1){var s=Sn();return bn(t+s*(e-t+he("1e-"+((s+"").length-1))),e)}return Jr(t,e)},Vn.reduce=function(t,e,n){var r=Go(t)?ze:Je,i=arguments.length<3;return r(t,cs(e,4),n,i,pr)},Vn.reduceRight=function(t,e,n){var r=Go(t)?Ue:Je,i=arguments.length<3;return r(t,cs(e,4),n,i,fr)},Vn.repeat=function(t,e,r){return e=(r?bs(t,e,r):e===n)?1:ma(e),Yr(_a(t),e)},Vn.replace=function(){var t=arguments,e=_a(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Vn.result=function(t,e,r){var i=-1,s=(e=bi(e,t)).length;for(s||(s=1,t=n);++i<s;){var o=null==t?n:t[zs(e[i])];o===n&&(i=s,o=r),t=Ko(o)?o.call(t):o}return t},Vn.round=Sl,Vn.runInContext=t,Vn.sample=function(t){return(Go(t)?Kn:Kr)(t)},Vn.size=function(t){if(null==t)return 0;if($o(t))return la(t)?pn(t):t.length;var e=ms(t);return e==E||e==I?t.size:zr(t).length},Vn.snakeCase=Xa,Vn.some=function(t,e,r){var i=Go(t)?Fe:si;return r&&bs(t,e,r)&&(e=n),i(t,cs(e,3))},Vn.sortedIndex=function(t,e){return oi(t,e)},Vn.sortedIndexBy=function(t,e,n){return ai(t,e,cs(n,2))},Vn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=oi(t,e);if(r<n&&Vo(t[r],e))return r}return-1},Vn.sortedLastIndex=function(t,e){return oi(t,e,!0)},Vn.sortedLastIndexBy=function(t,e,n){return ai(t,e,cs(n,2),!0)},Vn.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=oi(t,e,!0)-1;if(Vo(t[n],e))return n}return-1},Vn.startCase=Ja,Vn.startsWith=function(t,e,n){return t=_a(t),n=null==n?0:lr(ma(n),0,t.length),e=ui(e),t.slice(n,n+e.length)==e},Vn.subtract=Ml,Vn.sum=function(t){return t&&t.length?Ye(t,il):0},Vn.sumBy=function(t,e){return t&&t.length?Ye(t,cs(e,2)):0},Vn.template=function(t,e,r){var i=Vn.templateSettings;r&&bs(t,e,r)&&(e=n),t=_a(t),e=wa({},e,i,Qi);var s,o,a=wa({},e.imports,i.imports,Qi),l=La(a),c=tn(a,l),u=0,h=e.interpolate||wt,d="__p += '",p=Pt((e.escape||wt).source+"|"+h.source+"|"+(h===tt?ft:wt).source+"|"+(e.evaluate||wt).source+"|$","g"),f="//# sourceURL="+(zt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ae+"]")+"\n";t.replace(p,(function(e,n,r,i,a,l){return r||(r=i),d+=t.slice(u,l).replace(St,an),n&&(s=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+e.length,e})),d+="';\n";var m=zt.call(e,"variable")&&e.variable;if(m){if(dt.test(m))throw new Et("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(G,""):d).replace(q,"$1").replace($,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Qa((function(){return Tt(l,f+"return "+d).apply(n,c)}));if(g.source=d,Zo(g))throw g;return g},Vn.times=function(t,e){if((t=ma(t))<1||t>d)return[];var n=f,r=bn(t,f);e=cs(e),t-=f;for(var i=Ze(r,e);++n<t;)e(n);return i},Vn.toFinite=fa,Vn.toInteger=ma,Vn.toLength=ga,Vn.toLower=function(t){return _a(t).toLowerCase()},Vn.toNumber=va,Vn.toSafeInteger=function(t){return t?lr(ma(t),-d,d):0===t?t:0},Vn.toString=_a,Vn.toUpper=function(t){return _a(t).toUpperCase()},Vn.trim=function(t,e,r){if((t=_a(t))&&(r||e===n))return Ke(t);if(!t||!(e=ui(e)))return t;var i=fn(t),s=fn(e);return wi(i,nn(i,s),rn(i,s)+1).join("")},Vn.trimEnd=function(t,e,r){if((t=_a(t))&&(r||e===n))return t.slice(0,mn(t)+1);if(!t||!(e=ui(e)))return t;var i=fn(t);return wi(i,0,rn(i,fn(e))+1).join("")},Vn.trimStart=function(t,e,r){if((t=_a(t))&&(r||e===n))return t.replace(ot,"");if(!t||!(e=ui(e)))return t;var i=fn(t);return wi(i,nn(i,fn(e))).join("")},Vn.truncate=function(t,e){var r=30,i="...";if(ea(e)){var s="separator"in e?e.separator:s;r="length"in e?ma(e.length):r,i="omission"in e?ui(e.omission):i}var o=(t=_a(t)).length;if(ln(t)){var a=fn(t);o=a.length}if(r>=o)return t;var l=r-pn(i);if(l<1)return i;var c=a?wi(a,0,l).join(""):t.slice(0,l);if(s===n)return c+i;if(a&&(l+=c.length-l),oa(s)){if(t.slice(l).search(s)){var u,h=c;for(s.global||(s=Pt(s.source,_a(mt.exec(s))+"g")),s.lastIndex=0;u=s.exec(h);)var d=u.index;c=c.slice(0,d===n?l:d)}}else if(t.indexOf(ui(s),l)!=l){var p=c.lastIndexOf(s);p>-1&&(c=c.slice(0,p))}return c+i},Vn.unescape=function(t){return(t=_a(t))&&Y.test(t)?t.replace(X,gn):t},Vn.uniqueId=function(t){var e=++Ut;return _a(t)+e},Vn.upperCase=Ya,Vn.upperFirst=Za,Vn.each=_o,Vn.eachRight=bo,Vn.first=qs,ll(Vn,function(){var t={};return xr(Vn,(function(e,n){zt.call(Vn.prototype,n)||(t[n]=e)})),t}(),{chain:!1}),Vn.VERSION="4.17.21",Pe(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Vn[t].placeholder=Vn})),Pe(["drop","take"],(function(t,e){Gn.prototype[t]=function(r){r=r===n?1:_n(ma(r),0);var i=this.__filtered__&&!e?new Gn(this):this.clone();return i.__filtered__?i.__takeCount__=bn(r,i.__takeCount__):i.__views__.push({size:bn(r,f),type:t+(i.__dir__<0?"Right":"")}),i},Gn.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Pe(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Gn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:cs(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),Pe(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Gn.prototype[t]=function(){return this[n](1).value()[0]}})),Pe(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Gn.prototype[t]=function(){return this.__filtered__?new Gn(this):this[n](1)}})),Gn.prototype.compact=function(){return this.filter(il)},Gn.prototype.find=function(t){return this.filter(t).head()},Gn.prototype.findLast=function(t){return this.reverse().find(t)},Gn.prototype.invokeMap=Zr((function(t,e){return"function"==typeof t?new Gn(this):this.map((function(n){return Rr(n,t,e)}))})),Gn.prototype.reject=function(t){return this.filter(Do(cs(t)))},Gn.prototype.slice=function(t,e){t=ma(t);var r=this;return r.__filtered__&&(t>0||e<0)?new Gn(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==n&&(r=(e=ma(e))<0?r.dropRight(-e):r.take(e-t)),r)},Gn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Gn.prototype.toArray=function(){return this.take(f)},xr(Gn.prototype,(function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),s=Vn[i?"take"+("last"==e?"Right":""):e],o=i||/^find/.test(e);s&&(Vn.prototype[e]=function(){var e=this.__wrapped__,a=i?[1]:arguments,l=e instanceof Gn,c=a[0],u=l||Go(e),h=function(t){var e=s.apply(Vn,De([t],a));return i&&d?e[0]:e};u&&r&&"function"==typeof c&&1!=c.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,f=o&&!d,m=l&&!p;if(!o&&u){e=m?e:new Gn(this);var g=t.apply(e,a);return g.__actions__.push({func:fo,args:[h],thisArg:n}),new Wn(g,d)}return f&&m?t.apply(this,a):(g=this.thru(h),f?i?g.value()[0]:g.value():g)})})),Pe(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Lt[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Vn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Go(i)?i:[],t)}return this[n]((function(n){return e.apply(Go(n)?n:[],t)}))}})),xr(Gn.prototype,(function(t,e){var n=Vn[e];if(n){var r=n.name+"";zt.call(Ln,r)||(Ln[r]=[]),Ln[r].push({name:e,func:n})}})),Ln[Vi(n,2).name]=[{name:"wrapper",func:n}],Gn.prototype.clone=function(){var t=new Gn(this.__wrapped__);return t.__actions__=Ii(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ii(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ii(this.__views__),t},Gn.prototype.reverse=function(){if(this.__filtered__){var t=new Gn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Gn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Go(t),r=e<0,i=n?t.length:0,s=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var s=n[r],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=bn(e,t+o);break;case"takeRight":t=_n(t,e-o)}}return{start:t,end:e}}(0,i,this.__views__),o=s.start,a=s.end,l=a-o,c=r?a:o-1,u=this.__iteratees__,h=u.length,d=0,p=bn(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return mi(t,this.__actions__);var f=[];t:for(;l--&&d<p;){for(var m=-1,g=t[c+=e];++m<h;){var v=u[m],y=v.iteratee,_=v.type,b=y(g);if(2==_)g=b;else if(!b){if(1==_)continue t;break t}}f[d++]=g}return f},Vn.prototype.at=mo,Vn.prototype.chain=function(){return po(this)},Vn.prototype.commit=function(){return new Wn(this.value(),this.__chain__)},Vn.prototype.next=function(){this.__values__===n&&(this.__values__=pa(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?n:this.__values__[this.__index__++]}},Vn.prototype.plant=function(t){for(var e,r=this;r instanceof jn;){var i=Fs(r);i.__index__=0,i.__values__=n,e?s.__wrapped__=i:e=i;var s=i;r=r.__wrapped__}return s.__wrapped__=t,e},Vn.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Gn){var e=t;return this.__actions__.length&&(e=new Gn(this)),(e=e.reverse()).__actions__.push({func:fo,args:[to],thisArg:n}),new Wn(e,this.__chain__)}return this.thru(to)},Vn.prototype.toJSON=Vn.prototype.valueOf=Vn.prototype.value=function(){return mi(this.__wrapped__,this.__actions__)},Vn.prototype.first=Vn.prototype.head,Qt&&(Vn.prototype[Qt]=function(){return this}),Vn}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(me._=vn,define((function(){return vn}))):ve?((ve.exports=vn)._=vn,ge._=vn):me._=vn}).call(t)})),fx=hx(((t,e)=>{var n=1e3,r=60*n,i=60*r,s=24*i,o=7*s,a=365.25*s;function l(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}e.exports=function(t,e){e=e||{};var c=typeof t;if("string"===c&&t.length>0)return function(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var l=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*a;case"weeks":case"week":case"w":return l*o;case"days":case"day":case"d":return l*s;case"hours":case"hour":case"hrs":case"hr":case"h":return l*i;case"minutes":case"minute":case"mins":case"min":case"m":return l*r;case"seconds":case"second":case"secs":case"sec":case"s":return l*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}(t);if("number"===c&&isFinite(t))return e.long?function(t){var e=Math.abs(t);return e>=s?l(t,e,s,"day"):e>=i?l(t,e,i,"hour"):e>=r?l(t,e,r,"minute"):e>=n?l(t,e,n,"second"):t+" ms"}(t):function(t){var e=Math.abs(t);return e>=s?Math.round(t/s)+"d":e>=i?Math.round(t/i)+"h":e>=r?Math.round(t/r)+"m":e>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}})),mx=hx(((t,e)=>{e.exports=function(t){function e(t){let r,i,s,o=null;function a(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!a.enabled)return;let s=a,o=Number(new Date),l=o-(r||o);s.diff=l,s.prev=r,s.curr=o,r=o,n[0]=e.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");let c=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,((t,r)=>{if("%%"===t)return"%";c++;let i=e.formatters[r];if("function"==typeof i){let e=n[c];t=i.call(s,e),n.splice(c,1),c--}return t})),e.formatArgs.call(s,n),(s.log||e.log).apply(s,n)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=n,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function n(t,n){let r=e(this.namespace+(typeof n>"u"?":":n)+t);return r.log=this.log,r}function r(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){let t=[...e.names.map(r),...e.skips.map(r).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){e.save(t),e.namespaces=t,e.names=[],e.skips=[];let n,r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=fx(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e}})),gx=hx(((t,e)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch{}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:"/react-elden-ring-mind-map",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUPA_ANON:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdiZHlydXJ6eXlmbXVvYmVja2l0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjkzMzAyNDcsImV4cCI6MjA0NDkwNjI0N30.s5aKdX6BdWojAewKoJwCcvBVzCHJumwbe8cok9Z0yv4",REACT_APP_SUPA_URL:"https://gbdyrurzyyfmuobeckit.supabase.co",REACT_APP_SUPVIZ:"96ai280e79vr8qgpw42kk8gj7gixre"}.DEBUG),e},t.useColors=function(){if(typeof window<"u"&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch{}}(),t.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=mx()(t);var{formatters:n}=e.exports;n.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),vx=hx(((t,e)=>{e.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}})),yx=hx(((t,e)=>{var n="object"==typeof window&&window&&window.Object===Object&&window;e.exports=n})),_x=hx(((t,e)=>{var n=yx(),r="object"==typeof self&&self&&self.Object===Object&&self,i=n||r||Function("return this")();e.exports=i})),bx=hx(((t,e)=>{var n=_x();e.exports=function(){return n.Date.now()}})),xx=hx(((t,e)=>{var n=/\s/;e.exports=function(t){for(var e=t.length;e--&&n.test(t.charAt(e)););return e}})),wx=hx(((t,e)=>{var n=xx(),r=/^\s+/;e.exports=function(t){return t&&t.slice(0,n(t)+1).replace(r,"")}})),Sx=hx(((t,e)=>{var n=_x().Symbol;e.exports=n})),Mx=hx(((t,e)=>{var n=Sx(),r=Object.prototype,i=r.hasOwnProperty,s=r.toString,o=n?n.toStringTag:void 0;e.exports=function(t){var e=i.call(t,o),n=t[o];try{t[o]=void 0;var r=!0}catch{}var a=s.call(t);return r&&(e?t[o]=n:delete t[o]),a}})),Ex=hx(((t,e)=>{var n=Object.prototype.toString;e.exports=function(t){return n.call(t)}})),Tx=hx(((t,e)=>{var n=Sx(),r=Mx(),i=Ex(),s=n?n.toStringTag:void 0;e.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":s&&s in Object(t)?r(t):i(t)}})),Ax=hx(((t,e)=>{e.exports=function(t){return null!=t&&"object"==typeof t}})),Cx=hx(((t,e)=>{var n=Tx(),r=Ax();e.exports=function(t){return"symbol"==typeof t||r(t)&&"[object Symbol]"==n(t)}})),Px=hx(((t,e)=>{var n=wx(),r=vx(),i=Cx(),s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,a=/^0o[0-7]+$/i,l=parseInt;e.exports=function(t){if("number"==typeof t)return t;if(i(t))return NaN;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=n(t);var c=o.test(t);return c||a.test(t)?l(t.slice(2),c?2:8):s.test(t)?NaN:+t}})),Ix=hx(((t,e)=>{var n=vx(),r=bx(),i=Px(),s=Math.max,o=Math.min;e.exports=function(t,e,a){var l,c,u,h,d,p,f=0,m=!1,g=!1,v=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var n=l,r=c;return l=c=void 0,f=e,h=t.apply(r,n)}function _(t){var n=t-p;return void 0===p||n>=e||n<0||g&&t-f>=u}function b(){var t=r();if(_(t))return x(t);d=setTimeout(b,function(t){var n=e-(t-p);return g?o(n,u-(t-f)):n}(t))}function x(t){return d=void 0,v&&l?y(t):(l=c=void 0,h)}function w(){var t=r(),n=_(t);if(l=arguments,c=this,p=t,n){if(void 0===d)return function(t){return f=t,d=setTimeout(b,e),m?y(t):h}(p);if(g)return clearTimeout(d),d=setTimeout(b,e),y(p)}return void 0===d&&(d=setTimeout(b,e)),h}return e=i(e)||0,n(a)&&(m=!!a.leading,u=(g="maxWait"in a)?s(i(a.maxWait)||0,e):u,v="trailing"in a?!!a.trailing:v),w.cancel=function(){void 0!==d&&clearTimeout(d),f=0,l=p=c=d=void 0},w.flush=function(){return void 0===d?h:x(r())},w}})),Rx=hx(((t,e)=>{var n=Ix(),r=vx();e.exports=function(t,e,i){var s=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return r(i)&&(s="leading"in i?!!i.leading:s,o="trailing"in i?!!i.trailing:o),n(t,e,{leading:s,maxWait:e,trailing:o})}})),Lx=dx(px()),Nx="attached",Ox=1e3,kx=1001,Dx=1002,zx=1003,Ux=1006,Fx=1008,Bx=1015,Vx=2300,Hx=2301,jx=2302,Wx=2400,Gx=2401,qx=2402,$x=2500,Xx="srgb",Jx="srgb-linear",Yx="display-p3",Zx="display-p3-linear",Kx="linear",Qx="srgb",tw="rec709",ew=7680,nw=35044,rw=2e3,iw=2001,sw=class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});let n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;let n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;let n=this._listeners[t];if(void 0!==n){let t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;let e=this._listeners[t.type];if(void 0!==e){t.target=this;let n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t);t.target=null}}},ow=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],aw=1234567,lw=Math.PI/180,cw=180/Math.PI;function uw(){let t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(ow[255&t]+ow[t>>8&255]+ow[t>>16&255]+ow[t>>24&255]+"-"+ow[255&e]+ow[e>>8&255]+"-"+ow[e>>16&15|64]+ow[e>>24&255]+"-"+ow[63&n|128]+ow[n>>8&255]+"-"+ow[n>>16&255]+ow[n>>24&255]+ow[255&r]+ow[r>>8&255]+ow[r>>16&255]+ow[r>>24&255]).toLowerCase()}function hw(t,e,n){return Math.max(e,Math.min(n,t))}function dw(t,e){return(t%e+e)%e}function pw(t,e,n){return(1-n)*t+n*e}function fw(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function mw(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}var gw={DEG2RAD:lw,RAD2DEG:cw,generateUUID:uw,clamp:hw,euclideanModulo:dw,mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:pw,damp:function(t,e,n,r){return pw(t,e,1-Math.exp(-n*r))},pingpong:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e-Math.abs(dw(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(aw=t);let e=aw+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*lw},radToDeg:function(t){return t*cw},isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){let s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),d=o((e-r)/2),p=s((r-e)/2),f=o((r-e)/2);switch(i){case"XYX":t.set(a*u,l*h,l*d,a*c);break;case"YZY":t.set(l*d,a*u,l*h,a*c);break;case"ZXZ":t.set(l*h,l*d,a*u,a*c);break;case"XZX":t.set(a*u,l*f,l*p,a*c);break;case"YXY":t.set(l*p,a*u,l*f,a*c);break;case"ZYZ":t.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:mw,denormalize:fw},vw=class t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(hw(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},yw=class t{constructor(e,n,r,i,s,o,a,l,c){t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,n,r,i,s,o,a,l,c)}set(t,e,n,r,i,s,o,a,l){let c=this.elements;return c[0]=t,c[1]=r,c[2]=o,c[3]=e,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],_=r[7],b=r[2],x=r[5],w=r[8];return i[0]=s*f+o*v+a*b,i[3]=s*m+o*y+a*x,i[6]=s*g+o*_+a*w,i[1]=l*f+c*v+u*b,i[4]=l*m+c*y+u*x,i[7]=l*g+c*_+u*w,i[2]=h*f+d*v+p*b,i[5]=h*m+d*y+p*x,i[8]=h*g+d*_+p*w,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*i*c+n*o*a+r*i*l-r*s*a}invert(){let t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=c*s-o*l,h=o*a-c*i,d=l*i-s*a,p=e*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return t[0]=u*f,t[1]=(r*l-c*n)*f,t[2]=(o*n-r*s)*f,t[3]=h*f,t[4]=(c*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){let a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(_w.makeScale(t,e)),this}rotate(t){return this.premultiply(_w.makeRotation(-t)),this}translate(t,e){return this.premultiply(_w.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){let e=this.elements,n=t.elements;for(let r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}},_w=new yw;function bw(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}var xw={};function ww(t){t in xw||(xw[t]=!0,console.warn(t))}var Sw=(new yw).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Mw=(new yw).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Ew={[Jx]:{transfer:Kx,primaries:tw,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t,fromReference:t=>t},[Xx]:{transfer:Qx,primaries:tw,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[Zx]:{transfer:Kx,primaries:"p3",luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.applyMatrix3(Mw),fromReference:t=>t.applyMatrix3(Sw)},[Yx]:{transfer:Qx,primaries:"p3",luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.convertSRGBToLinear().applyMatrix3(Mw),fromReference:t=>t.applyMatrix3(Sw).convertLinearToSRGB()}},Tw=new Set([Jx,Zx]),Aw={enabled:!0,_workingColorSpace:Jx,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!Tw.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(!1===this.enabled||e===n||!e||!n)return t;let r=Ew[e].toReference;return(0,Ew[n].fromReference)(r(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return Ew[t].primaries},getTransfer:function(t){return""===t?Kx:Ew[t].transfer},getLuminanceCoefficients:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._workingColorSpace;return t.fromArray(Ew[e].luminanceCoefficients)}};function Cw(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Pw(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}var Iw,Rw=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Iw&&(Iw=bw("canvas")),Iw.width=t.width,Iw.height=t.height;let n=Iw.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Iw}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let e=bw("canvas");e.width=t.width,e.height=t.height;let n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);let r=n.getImageData(0,0,t.width,t.height),i=r.data;for(let t=0;t<i.length;t++)i[t]=255*Cw(i[t]/255);return n.putImageData(r,0,0),e}if(t.data){let e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Cw(e[t]/255)):e[t]=Cw(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},Lw=0,Nw=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:Lw++}),this.uuid=uw(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){let e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];let n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(Ow(r[e].image)):t.push(Ow(r[e]))}else t=Ow(r);n.url=t}return e||(t.images[this.uuid]=n),n}};function Ow(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?Rw.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var kw=0,Dw=class t extends sw{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.DEFAULT_IMAGE,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.DEFAULT_MAPPING,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kx,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:kx,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ux,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Fx,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1023,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1009,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:t.DEFAULT_ANISOTROPY,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"";super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:kw++}),this.uuid=uw(),this.name="",this.source=new Nw(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new vw(0,0),this.repeat=new vw(1,1),this.center=new vw(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new yw,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t){void 0===t&&(t=null),this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];let n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Ox:t.x=t.x-Math.floor(t.x);break;case kx:t.x=t.x<0?0:1;break;case Dx:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Ox:t.y=t.y-Math.floor(t.y);break;case kx:t.y=t.y<0?0:1;break;case Dx:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}};Dw.DEFAULT_IMAGE=null,Dw.DEFAULT_MAPPING=300,Dw.DEFAULT_ANISOTROPY=1;var zw=class t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i,s=t.elements,o=s[0],a=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(o+u+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let t=(o+1)/2,s=(u+1)/2,m=(f+1)/2,g=(a+c)/4,v=(l+d)/4,y=(h+p)/4;return t>s&&t>m?t<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=g/n,i=v/n):s>m?s<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=g/r,i=y/r):m<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(m),n=v/i,r=y/i),this.set(n,r,i,e),this}let m=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(m)<.001&&(m=1),this.x=(p-h)/m,this.y=(l-d)/m,this.z=(c-a)/m,this.w=Math.acos((o+u+f-1)/2),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Uw=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=r}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],h=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===o)return t[e+0]=h,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(u!==f||a!==h||l!==d||c!==p){let t=1-o,e=a*h+l*d+c*p+u*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){let i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}let i=o*n;if(a=a*t+h*i,l=l*t+d*i,c=c*t+p*i,u=u*t+f*i,t===1-o){let t=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=t,l*=t,c*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,r,i,s){let o=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[s],h=i[s+1],d=i[s+2],p=i[s+3];return t[e]=o*p+c*u+a*d-l*h,t[e+1]=a*p+c*h+l*u-o*d,t[e+2]=l*p+c*d+o*h-a*u,t[e+3]=c*p-o*u-a*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){let t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>u){let t=2*Math.sqrt(1+n-o-u);this._w=(c-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>u){let t=2*Math.sqrt(1+o-n-u);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+c)/t}else{let t=2*Math.sqrt(1+u-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(hw(this.dot(t),-1,1)))}rotateTowards(t,e){let n=this.angleTo(t);if(0===n)return this;let r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+r*l-i*a,this._y=r*c+s*a+i*o-n*l,this._z=i*c+s*l+n*a-r*o,this._w=s*c-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);let n=this._x,r=this._y,i=this._z,s=this._w,o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;let a=1-o*o;if(a<=Number.EPSILON){let t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this}let l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){let t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(t),r*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Fw=class t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Vw.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Vw.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){let e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=2*(s*r-o*n),c=2*(o*e-i*r),u=2*(i*n-s*e);return this.x=e+a*l+s*u-o*c,this.y=n+a*c+o*l-i*u,this.z=r+a*u+i*c-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){let e=t.lengthSq();if(0===e)return this.set(0,0,0);let n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Bw.copy(this).projectOnVector(t),this.sub(Bw)}reflect(t){return this.sub(Bw.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(hw(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){let r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},Bw=new Fw,Vw=new Uw,Hw=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fw(1/0,1/0,1/0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(Ww.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(Ww.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let n=Ww.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.updateWorldMatrix(!1,!1);let n=t.geometry;if(void 0!==n){let r=n.getAttribute("position");if(!0===e&&void 0!==r&&!0!==t.isInstancedMesh)for(let e=0,n=r.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,Ww):Ww.fromBufferAttribute(r,e),Ww.applyMatrix4(t.matrixWorld),this.expandByPoint(Ww);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),Gw.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Gw.copy(n.boundingBox)),Gw.applyMatrix4(t.matrixWorld),this.union(Gw)}let r=t.children;for(let i=0,s=r.length;i<s;i++)this.expandByObject(r[i],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Ww),Ww.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Kw),Qw.subVectors(this.max,Kw),qw.subVectors(t.a,Kw),$w.subVectors(t.b,Kw),Xw.subVectors(t.c,Kw),Jw.subVectors($w,qw),Yw.subVectors(Xw,$w),Zw.subVectors(qw,Xw);let e=[0,-Jw.z,Jw.y,0,-Yw.z,Yw.y,0,-Zw.z,Zw.y,Jw.z,0,-Jw.x,Yw.z,0,-Yw.x,Zw.z,0,-Zw.x,-Jw.y,Jw.x,0,-Yw.y,Yw.x,0,-Zw.y,Zw.x,0];return!(!nS(e,qw,$w,Xw,Qw)||(e=[1,0,0,0,1,0,0,0,1],!nS(e,qw,$w,Xw,Qw)))&&(tS.crossVectors(Jw,Yw),e=[tS.x,tS.y,tS.z],nS(e,qw,$w,Xw,Qw))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Ww).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Ww).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(jw[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),jw[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),jw[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),jw[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),jw[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),jw[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),jw[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),jw[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(jw)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},jw=[new Fw,new Fw,new Fw,new Fw,new Fw,new Fw,new Fw,new Fw],Ww=new Fw,Gw=new Hw,qw=new Fw,$w=new Fw,Xw=new Fw,Jw=new Fw,Yw=new Fw,Zw=new Fw,Kw=new Fw,Qw=new Fw,tS=new Fw,eS=new Fw;function nS(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){eS.fromArray(t,s);let o=i.x*Math.abs(eS.x)+i.y*Math.abs(eS.y)+i.z*Math.abs(eS.z),a=e.dot(eS),l=n.dot(eS),c=r.dot(eS);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}var rS=new Hw,iS=new Fw,sS=new Fw,oS=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fw,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let n=this.center;void 0!==e?n.copy(e):rS.setFromPoints(t).getCenter(n);let r=0;for(let i=0,s=t.length;i<s;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;iS.subVectors(t,this.center);let e=iS.lengthSq();if(e>this.radius*this.radius){let t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(iS,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(sS.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(iS.copy(t.center).add(sS)),this.expandByPoint(iS.copy(t.center).sub(sS))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}},aS=new Fw,lS=new Fw,cS=new Fw,uS=new Fw,hS=new Fw,dS=new Fw,pS=new Fw,fS=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fw,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw(0,0,-1);this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,aS)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);let n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){let e=aS.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(aS.copy(this.origin).addScaledVector(this.direction,e),aS.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){lS.copy(t).add(e).multiplyScalar(.5),cS.copy(e).sub(t).normalize(),uS.copy(this.origin).sub(lS);let i,s,o,a,l=.5*t.distanceTo(e),c=-this.direction.dot(cS),u=uS.dot(this.direction),h=-uS.dot(cS),d=uS.lengthSq(),p=Math.abs(1-c*c);if(p>0)if(i=c*h-u,s=c*u-h,a=l*p,i>=0)if(s>=-a)if(s<=a){let t=1/p;i*=t,s*=t,o=i*(i+c*s+2*u)+s*(c*i+s+2*h)+d}else s=l,i=Math.max(0,-(c*s+u)),o=-i*i+s*(s+2*h)+d;else s=-l,i=Math.max(0,-(c*s+u)),o=-i*i+s*(s+2*h)+d;else s<=-a?(i=Math.max(0,-(-c*l+u)),s=i>0?-l:Math.min(Math.max(-l,-h),l),o=-i*i+s*(s+2*h)+d):s<=a?(i=0,s=Math.min(Math.max(-l,-h),l),o=s*(s+2*h)+d):(i=Math.max(0,-(c*l+u)),s=i>0?l:Math.min(Math.max(-l,-h),l),o=-i*i+s*(s+2*h)+d);else s=c>0?-l:l,i=Math.max(0,-(c*s+u)),o=-i*i+s*(s+2*h)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,i),r&&r.copy(lS).addScaledVector(cS,s),o}intersectSphere(t,e){aS.subVectors(t.center,this.origin);let n=aS.dot(this.direction),r=aS.dot(aS)-n*n,i=t.radius*t.radius;if(r>i)return null;let s=Math.sqrt(i-r),o=n-s,a=n+s;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){let e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;let n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){let n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){let e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,s,o,a,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),n>s||i>r||((i>n||isNaN(n))&&(n=i),(s<r||isNaN(r))&&(r=s),u>=0?(o=(t.min.z-h.z)*u,a=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,a=(t.min.z-h.z)*u),n>a||o>r)||((o>n||n!==n)&&(n=o),(a<r||r!==r)&&(r=a),r<0)?null:this.at(n>=0?n:r,e)}intersectsBox(t){return null!==this.intersectBox(t,aS)}intersectTriangle(t,e,n,r,i){hS.subVectors(e,t),dS.subVectors(n,t),pS.crossVectors(hS,dS);let s,o=this.direction.dot(pS);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}uS.subVectors(this.origin,t);let a=s*this.direction.dot(dS.crossVectors(uS,dS));if(a<0)return null;let l=s*this.direction.dot(hS.cross(uS));if(l<0||a+l>o)return null;let c=-s*uS.dot(pS);return c<0?null:this.at(c/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},mS=class t{constructor(e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g){t.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,n,r,i,s,o,a,l,c,u,h,d,p,f,m,g)}set(t,e,n,r,i,s,o,a,l,c,u,h,d,p,f,m){let g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new t).fromArray(this.elements)}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){let e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,n=t.elements,r=1/gS.setFromMatrixColumn(t,0).length(),i=1/gS.setFromMatrixColumn(t,1).length(),s=1/gS.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){let e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){let t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){let t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){let t=a*c,n=a*u,r=l*c,i=l*u;e[0]=t-i*o,e[4]=-s*u,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*c,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){let t=s*c,n=s*u,r=o*c,i=o*u;e[0]=a*c,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*u,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){let t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=i-t*u,e[8]=r*u+n,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*u+r,e[10]=t-i*u}else if("XZY"===t.order){let t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=t*u+i,e[5]=s*c,e[9]=n*u-r,e[2]=r*u-n,e[6]=o*c,e[10]=i*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(yS,t,_S)}lookAt(t,e,n){let r=this.elements;return wS.subVectors(t,e),0===wS.lengthSq()&&(wS.z=1),wS.normalize(),bS.crossVectors(n,wS),0===bS.lengthSq()&&(1===Math.abs(n.z)?wS.x+=1e-4:wS.z+=1e-4,wS.normalize(),bS.crossVectors(n,wS)),bS.normalize(),xS.crossVectors(wS,bS),r[0]=bS.x,r[4]=xS.x,r[8]=wS.x,r[1]=bS.y,r[5]=xS.y,r[9]=wS.y,r[2]=bS.z,r[6]=xS.z,r[10]=wS.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],b=n[15],x=r[0],w=r[4],S=r[8],M=r[12],E=r[1],T=r[5],A=r[9],C=r[13],P=r[2],I=r[6],R=r[10],L=r[14],N=r[3],O=r[7],k=r[11],D=r[15];return i[0]=s*x+o*E+a*P+l*N,i[4]=s*w+o*T+a*I+l*O,i[8]=s*S+o*A+a*R+l*k,i[12]=s*M+o*C+a*L+l*D,i[1]=c*x+u*E+h*P+d*N,i[5]=c*w+u*T+h*I+d*O,i[9]=c*S+u*A+h*R+d*k,i[13]=c*M+u*C+h*L+d*D,i[2]=p*x+f*E+m*P+g*N,i[6]=p*w+f*T+m*I+g*O,i[10]=p*S+f*A+m*R+g*k,i[14]=p*M+f*C+m*L+g*D,i[3]=v*x+y*E+_*P+b*N,i[7]=v*w+y*T+_*I+b*O,i[11]=v*S+y*A+_*R+b*k,i[15]=v*M+y*C+_*L+b*D,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*a*u-r*l*u-i*o*h+n*l*h+r*o*d-n*a*d)+t[7]*(+e*a*d-e*l*h+i*s*h-r*s*d+r*l*c-i*a*c)+t[11]*(+e*l*u-e*o*d-i*s*u+n*s*d+i*o*c-n*l*c)+t[15]*(-r*o*c-e*a*u+e*o*h+r*s*u-n*s*h+n*a*c)}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(t,e,n){let r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){let t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=u*m*l-f*h*l+f*a*d-o*m*d-u*a*g+o*h*g,y=p*h*l-c*m*l-p*a*d+s*m*d+c*a*g-s*h*g,_=c*f*l-p*u*l+p*o*d-s*f*d-c*o*g+s*u*g,b=p*u*a-c*f*a-p*o*h+s*f*h+c*o*m-s*u*m,x=e*v+n*y+r*_+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/x;return t[0]=v*w,t[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*w,t[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*g+n*a*g)*w,t[3]=(u*a*i-o*h*i-u*r*l+n*h*l+o*r*d-n*a*d)*w,t[4]=y*w,t[5]=(c*m*i-p*h*i+p*r*d-e*m*d-c*r*g+e*h*g)*w,t[6]=(p*a*i-s*m*i-p*r*l+e*m*l+s*r*g-e*a*g)*w,t[7]=(s*h*i-c*a*i+c*r*l-e*h*l-s*r*d+e*a*d)*w,t[8]=_*w,t[9]=(p*u*i-c*f*i-p*n*d+e*f*d+c*n*g-e*u*g)*w,t[10]=(s*f*i-p*o*i+p*n*l-e*f*l-s*n*g+e*o*g)*w,t[11]=(c*o*i-s*u*i-c*n*l+e*u*l+s*n*d-e*o*d)*w,t[12]=b*w,t[13]=(c*f*r-p*u*r+p*n*h-e*f*h-c*n*m+e*u*m)*w,t[14]=(p*o*r-s*f*r-p*n*a+e*f*a+s*n*m-e*o*m)*w,t[15]=(s*u*r-c*o*r+c*n*a-e*u*a-s*n*h+e*o*h)*w,this}scale(t){let e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,c=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+n,c*a-r*s,0,l*a-r*o,c*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,s){return this.set(1,n,i,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){let r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,c=s+s,u=o+o,h=i*l,d=i*c,p=i*u,f=s*c,m=s*u,g=o*u,v=a*l,y=a*c,_=a*u,b=n.x,x=n.y,w=n.z;return r[0]=(1-(f+g))*b,r[1]=(d+_)*b,r[2]=(p-y)*b,r[3]=0,r[4]=(d-_)*x,r[5]=(1-(h+g))*x,r[6]=(m+v)*x,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){let r=this.elements,i=gS.set(r[0],r[1],r[2]).length(),s=gS.set(r[4],r[5],r[6]).length(),o=gS.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],vS.copy(this);let a=1/i,l=1/s,c=1/o;return vS.elements[0]*=a,vS.elements[1]*=a,vS.elements[2]*=a,vS.elements[4]*=l,vS.elements[5]*=l,vS.elements[6]*=l,vS.elements[8]*=c,vS.elements[9]*=c,vS.elements[10]*=c,e.setFromRotationMatrix(vS),n.x=i,n.y=s,n.z=o,this}makePerspective(t,e,n,r,i,s){let o,a,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:rw,c=this.elements,u=2*i/(e-t),h=2*i/(n-r),d=(e+t)/(e-t),p=(n+r)/(n-r);if(l===rw)o=-(s+i)/(s-i),a=-2*s*i/(s-i);else{if(l!==iw)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);o=-s/(s-i),a=-s*i/(s-i)}return c[0]=u,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=h,c[9]=p,c[13]=0,c[2]=0,c[6]=0,c[10]=o,c[14]=a,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(t,e,n,r,i,s){let o,a,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:rw,c=this.elements,u=1/(e-t),h=1/(n-r),d=1/(s-i),p=(e+t)*u,f=(n+r)*h;if(l===rw)o=(s+i)*d,a=-2*d;else{if(l!==iw)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);o=i*d,a=-1*d}return c[0]=2*u,c[4]=0,c[8]=0,c[12]=-p,c[1]=0,c[5]=2*h,c[9]=0,c[13]=-f,c[2]=0,c[6]=0,c[10]=a,c[14]=-o,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(t){let e=this.elements,n=t.elements;for(let r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}},gS=new Fw,vS=new mS,yS=new Fw(0,0,0),_S=new Fw(1,1,1),bS=new Fw,xS=new Fw,wS=new Fw,SS=new mS,MS=new Uw,ES=class t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.elements,i=r[0],s=r[4],o=r[8],a=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(hw(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-hw(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(hw(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-hw(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(hw(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-hw(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return SS.makeRotationFromQuaternion(t),this.setFromRotationMatrix(SS,e,n)}setFromVector3(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(t.x,t.y,t.z,e)}reorder(t){return MS.setFromEuler(this),this.setFromQuaternion(MS,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};ES.DEFAULT_ORDER="XYZ";var TS=class{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}isEnabled(t){return 0!==(this.mask&1<<t)}},AS=0,CS=new Fw,PS=new Uw,IS=new mS,RS=new Fw,LS=new Fw,NS=new Fw,OS=new Uw,kS=new Fw(1,0,0),DS=new Fw(0,1,0),zS=new Fw(0,0,1),US={type:"added"},FS={type:"removed"},BS={type:"childadded",child:null},VS={type:"childremoved",child:null},HS=class t extends sw{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:AS++}),this.uuid=uw(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=t.DEFAULT_UP.clone();let e=new Fw,n=new ES,r=new Uw,i=new Fw(1,1,1);n._onChange((function(){r.setFromEuler(n,!1)})),r._onChange((function(){n.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new mS},normalMatrix:{value:new yw}}),this.matrix=new mS,this.matrixWorld=new mS,this.matrixAutoUpdate=t.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=t.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new TS,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return PS.setFromAxisAngle(t,e),this.quaternion.multiply(PS),this}rotateOnWorldAxis(t,e){return PS.setFromAxisAngle(t,e),this.quaternion.premultiply(PS),this}rotateX(t){return this.rotateOnAxis(kS,t)}rotateY(t){return this.rotateOnAxis(DS,t)}rotateZ(t){return this.rotateOnAxis(zS,t)}translateOnAxis(t,e){return CS.copy(t).applyQuaternion(this.quaternion),this.position.add(CS.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(kS,t)}translateY(t){return this.translateOnAxis(DS,t)}translateZ(t){return this.translateOnAxis(zS,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(IS.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?RS.copy(t):RS.set(t,e,n);let r=this.parent;this.updateWorldMatrix(!0,!1),LS.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?IS.lookAt(LS,RS,this.up):IS.lookAt(RS,LS,this.up),this.quaternion.setFromRotationMatrix(IS),r&&(IS.extractRotation(r.matrixWorld),PS.setFromRotationMatrix(IS),this.quaternion.premultiply(PS.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(US),BS.child=t,this.dispatchEvent(BS),BS.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}let e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(FS),VS.child=t,this.dispatchEvent(VS),VS.child=null),this}removeFromParent(){let t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),IS.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),IS.multiply(t.parent.matrixWorld)),t.applyMatrix4(IS),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(US),BS.child=t,this.dispatchEvent(BS),BS.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){let r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}}getObjectsByProperty(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[t]===e&&n.push(this);let r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(LS,t,NS),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(LS,OS,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);let e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){let e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){let n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){let t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){let e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);let e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){let n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){let r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){let n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){let e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),c=s(t.animations),u=s(t.nodes);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function s(t){let e=[];for(let n in t){let r=t[n];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let n=0;n<t.children.length;n++){let e=t.children[n];this.add(e.clone())}return this}};HS.DEFAULT_UP=new Fw(0,1,0),HS.DEFAULT_MATRIX_AUTO_UPDATE=!0,HS.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var jS=new Fw,WS=new Fw,GS=new Fw,qS=new Fw,$S=new Fw,XS=new Fw,JS=new Fw,YS=new Fw,ZS=new Fw,KS=new Fw,QS=class t{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fw,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Fw;this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),jS.subVectors(t,e),r.cross(jS);let i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){jS.subVectors(r,e),WS.subVectors(n,e),GS.subVectors(t,e);let s=jS.dot(jS),o=jS.dot(WS),a=jS.dot(GS),l=WS.dot(WS),c=WS.dot(GS),u=s*l-o*o;if(0===u)return i.set(0,0,0),null;let h=1/u,d=(l*a-o*c)*h,p=(s*c-o*a)*h;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return null!==this.getBarycoord(t,e,n,r,qS)&&(qS.x>=0&&qS.y>=0&&qS.x+qS.y<=1)}static getInterpolation(t,e,n,r,i,s,o,a){return null===this.getBarycoord(t,e,n,r,qS)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(i,qS.x),a.addScaledVector(s,qS.y),a.addScaledVector(o,qS.z),a)}static isFrontFacing(t,e,n,r){return jS.subVectors(n,e),WS.subVectors(t,e),jS.cross(WS).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return jS.subVectors(this.c,this.b),WS.subVectors(this.a,this.b),.5*jS.cross(WS).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return t.getNormal(this.a,this.b,this.c,e)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return t.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,i,s){return t.getInterpolation(e,this.a,this.b,this.c,n,r,i,s)}containsPoint(e){return t.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return t.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let n,r,i=this.a,s=this.b,o=this.c;$S.subVectors(s,i),XS.subVectors(o,i),YS.subVectors(t,i);let a=$S.dot(YS),l=XS.dot(YS);if(a<=0&&l<=0)return e.copy(i);ZS.subVectors(t,s);let c=$S.dot(ZS),u=XS.dot(ZS);if(c>=0&&u<=c)return e.copy(s);let h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return n=a/(a-c),e.copy(i).addScaledVector($S,n);KS.subVectors(t,o);let d=$S.dot(KS),p=XS.dot(KS);if(p>=0&&d<=p)return e.copy(o);let f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return r=l/(l-p),e.copy(i).addScaledVector(XS,r);let m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return JS.subVectors(o,s),r=(u-c)/(u-c+(d-p)),e.copy(s).addScaledVector(JS,r);let g=1/(m+f+h);return n=f*g,r=h*g,e.copy(i).addScaledVector($S,n).addScaledVector(XS,r)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},tM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},eM={h:0,s:0,l:0},nM={h:0,s:0,l:0};function rM(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}var iM=class{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){let e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xx;return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Aw.toWorkingColorSpace(this,e),this}setRGB(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Aw.workingColorSpace;return this.r=t,this.g=e,this.b=n,Aw.toWorkingColorSpace(this,r),this}setHSL(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Aw.workingColorSpace;if(t=dw(t,1),e=hw(e,0,1),n=hw(n,0,1),0===e)this.r=this.g=this.b=n;else{let r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=rM(i,r,t+1/3),this.g=rM(i,r,t),this.b=rM(i,r,t-1/3)}return Aw.toWorkingColorSpace(this,r),this}setStyle(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xx;function r(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(e=/^(\w+)\(([^\)]*)\)/.exec(t)){let i,s=e[1],o=e[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,n);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,n);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(t)){let r=e[1],i=r.length;if(3===i)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,n);if(6===i)return this.setHex(parseInt(r,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xx,n=tM[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Cw(t.r),this.g=Cw(t.g),this.b=Cw(t.b),this}copyLinearToSRGB(t){return this.r=Pw(t.r),this.g=Pw(t.g),this.b=Pw(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xx;return Aw.fromWorkingColorSpace(sM.copy(this),t),65536*Math.round(hw(255*sM.r,0,255))+256*Math.round(hw(255*sM.g,0,255))+Math.round(hw(255*sM.b,0,255))}getHexString(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xx;return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Aw.workingColorSpace;Aw.fromWorkingColorSpace(sM.copy(this),e);let n,r,i=sM.r,s=sM.g,o=sM.b,a=Math.max(i,s,o),l=Math.min(i,s,o),c=(l+a)/2;if(l===a)n=0,r=0;else{let t=a-l;switch(r=c<=.5?t/(a+l):t/(2-a-l),a){case i:n=(s-o)/t+(s<o?6:0);break;case s:n=(o-i)/t+2;break;case o:n=(i-s)/t+4}n/=6}return t.h=n,t.s=r,t.l=c,t}getRGB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Aw.workingColorSpace;return Aw.fromWorkingColorSpace(sM.copy(this),e),t.r=sM.r,t.g=sM.g,t.b=sM.b,t}getStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xx;Aw.fromWorkingColorSpace(sM.copy(this),t);let e=sM.r,n=sM.g,r=sM.b;return t!==Xx?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(t,e,n){return this.getHSL(eM),this.setHSL(eM.h+t,eM.s+e,eM.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(eM),t.getHSL(nM);let n=pw(eM.h,nM.h,e),r=pw(eM.s,nM.s,e),i=pw(eM.l,nM.l,e);return this.setHSL(n,r,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){let e=this.r,n=this.g,r=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*r,this.g=i[1]*e+i[4]*n+i[7]*r,this.b=i[2]*e+i[5]*n+i[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},sM=new iM;iM.NAMES=tM;var oM=0,aM=class extends sw{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:oM++}),this.uuid=uw(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new iM(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ew,this.stencilZFail=ew,this.stencilZPass=ew,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(let e in t){let n=t[e];if(void 0===n){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}let r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){let e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});let n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(t){let e=[];for(let n in t){let r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),100!==this.blendEquation&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ew&&(n.stencilFail=this.stencilFail),this.stencilZFail!==ew&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==ew&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){let e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;let e=t.clippingPlanes,n=null;if(null!==e){let t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}},lM=class extends aM{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new iM(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ES,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}},cM=new Fw,uM=new vw,hM=class{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=nw,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Bx,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return ww("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)uM.fromBufferAttribute(this,e),uM.applyMatrix3(t),this.setXY(e,uM.x,uM.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)cM.fromBufferAttribute(this,e),cM.applyMatrix3(t),this.setXYZ(e,cM.x,cM.y,cM.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)cM.fromBufferAttribute(this,e),cM.applyMatrix4(t),this.setXYZ(e,cM.x,cM.y,cM.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)cM.fromBufferAttribute(this,e),cM.applyNormalMatrix(t),this.setXYZ(e,cM.x,cM.y,cM.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)cM.fromBufferAttribute(this,e),cM.transformDirection(t),this.setXYZ(e,cM.x,cM.y,cM.z);return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=fw(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=mw(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=fw(e,this.array)),e}setX(t,e){return this.normalized&&(e=mw(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=fw(e,this.array)),e}setY(t,e){return this.normalized&&(e=mw(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=fw(e,this.array)),e}setZ(t,e){return this.normalized&&(e=mw(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=fw(e,this.array)),e}setW(t,e){return this.normalized&&(e=mw(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=mw(e,this.array),n=mw(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=mw(e,this.array),n=mw(n,this.array),r=mw(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=mw(e,this.array),n=mw(n,this.array),r=mw(r,this.array),i=mw(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==nw&&(t.usage=this.usage),t}},dM=class extends hM{constructor(t,e,n){super(new Uint16Array(t),e,n)}},pM=class extends hM{constructor(t,e,n){super(new Uint32Array(t),e,n)}},fM=class extends hM{constructor(t,e,n){super(new Float32Array(t),e,n)}},mM=0,gM=new mS,vM=new HS,yM=new Fw,_M=new Hw,bM=new Hw,xM=new Fw,wM=class t extends sw{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:mM++}),this.uuid=uw(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(function(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(t)?pM:dM)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);let n=this.attributes.normal;if(void 0!==n){let e=(new yw).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}let r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return gM.makeRotationFromQuaternion(t),this.applyMatrix4(gM),this}rotateX(t){return gM.makeRotationX(t),this.applyMatrix4(gM),this}rotateY(t){return gM.makeRotationY(t),this.applyMatrix4(gM),this}rotateZ(t){return gM.makeRotationZ(t),this.applyMatrix4(gM),this}translate(t,e,n){return gM.makeTranslation(t,e,n),this.applyMatrix4(gM),this}scale(t,e,n){return gM.makeScale(t,e,n),this.applyMatrix4(gM),this}lookAt(t){return vM.lookAt(t),vM.updateMatrix(),this.applyMatrix4(vM.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(yM).negate(),this.translate(yM.x,yM.y,yM.z),this}setFromPoints(t){let e=[];for(let n=0,r=t.length;n<r;n++){let r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new fM(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Hw);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Fw(-1/0,-1/0,-1/0),new Fw(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,r=e.length;n<r;n++){let t=e[n];_M.setFromBufferAttribute(t),this.morphTargetsRelative?(xM.addVectors(this.boundingBox.min,_M.min),this.boundingBox.expandByPoint(xM),xM.addVectors(this.boundingBox.max,_M.max),this.boundingBox.expandByPoint(xM)):(this.boundingBox.expandByPoint(_M.min),this.boundingBox.expandByPoint(_M.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new oS);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Fw,1/0);if(t){let n=this.boundingSphere.center;if(_M.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){let n=e[t];bM.setFromBufferAttribute(n),this.morphTargetsRelative?(xM.addVectors(_M.min,bM.min),_M.expandByPoint(xM),xM.addVectors(_M.max,bM.max),_M.expandByPoint(xM)):(_M.expandByPoint(bM.min),_M.expandByPoint(bM.max))}_M.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)xM.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(xM));if(e)for(let i=0,s=e.length;i<s;i++){let s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)xM.fromBufferAttribute(s,e),o&&(yM.fromBufferAttribute(t,e),xM.add(yM)),r=Math.max(r,n.distanceToSquared(xM))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let n=e.position,r=e.normal,i=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new hM(new Float32Array(4*n.count),4));let s=this.getAttribute("tangent"),o=[],a=[];for(let S=0;S<n.count;S++)o[S]=new Fw,a[S]=new Fw;let l=new Fw,c=new Fw,u=new Fw,h=new vw,d=new vw,p=new vw,f=new Fw,m=new Fw;function g(t,e,r){l.fromBufferAttribute(n,t),c.fromBufferAttribute(n,e),u.fromBufferAttribute(n,r),h.fromBufferAttribute(i,t),d.fromBufferAttribute(i,e),p.fromBufferAttribute(i,r),c.sub(l),u.sub(l),d.sub(h),p.sub(h);let s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(s),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(s),o[t].add(f),o[e].add(f),o[r].add(f),a[t].add(m),a[e].add(m),a[r].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:t.count}]);for(let S=0,M=v.length;S<M;++S){let e=v[S],n=e.start;for(let r=n,i=n+e.count;r<i;r+=3)g(t.getX(r+0),t.getX(r+1),t.getX(r+2))}let y=new Fw,_=new Fw,b=new Fw,x=new Fw;function w(t){b.fromBufferAttribute(r,t),x.copy(b);let e=o[t];y.copy(e),y.sub(b.multiplyScalar(b.dot(e))).normalize(),_.crossVectors(x,e);let n=_.dot(a[t])<0?-1:1;s.setXYZW(t,y.x,y.y,y.z,n)}for(let S=0,M=v.length;S<M;++S){let e=v[S],n=e.start;for(let r=n,i=n+e.count;r<i;r+=3)w(t.getX(r+0)),w(t.getX(r+1)),w(t.getX(r+2))}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new hM(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);let r=new Fw,i=new Fw,s=new Fw,o=new Fw,a=new Fw,l=new Fw,c=new Fw,u=new Fw;if(t)for(let h=0,d=t.count;h<d;h+=3){let d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,h=e.count;t<h;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,i),u.subVectors(r,i),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){let t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)xM.fromBufferAttribute(t,e),xM.normalize(),t.setXYZ(e,xM.x,xM.y,xM.z)}toNonIndexed(){function e(t,e){let n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r),o=0,a=0;for(let l=0,c=e.length;l<c;l++){o=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new hM(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let n=new t,r=this.index.array,i=this.attributes;for(let t in i){let s=e(i[t],r);n.setAttribute(t,s)}let s=this.morphAttributes;for(let t in s){let i=[],o=s[t];for(let t=0,n=o.length;t<n;t++){let n=e(o[t],r);i.push(n)}n.morphAttributes[t]=i}n.morphTargetsRelative=this.morphTargetsRelative;let o=this.groups;for(let t=0,a=o.length;t<a;t++){let e=o[t];n.addGroup(e.start,e.count,e.materialIndex)}return n}toJSON(){let t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){let e=this.parameters;for(let n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};let e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let n=this.attributes;for(let a in n){let e=n[a];t.data.attributes[a]=e.toJSON(t.data)}let r={},i=!1;for(let a in this.morphAttributes){let e=this.morphAttributes[a],n=[];for(let r=0,i=e.length;r<i;r++){let i=e[r];n.push(i.toJSON(t.data))}n.length>0&&(r[a]=n,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));let o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let n=t.index;null!==n&&this.setIndex(n.clone(e));let r=t.attributes;for(let l in r){let t=r[l];this.setAttribute(l,t.clone(e))}let i=t.morphAttributes;for(let l in i){let t=[],n=i[l];for(let r=0,i=n.length;r<i;r++)t.push(n[r].clone(e));this.morphAttributes[l]=t}this.morphTargetsRelative=t.morphTargetsRelative;let s=t.groups;for(let l=0,c=s.length;l<c;l++){let t=s[l];this.addGroup(t.start,t.count,t.materialIndex)}let o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());let a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}},SM=new mS,MM=new fS,EM=new oS,TM=new Fw,AM=new Fw,CM=new Fw,PM=new Fw,IM=new Fw,RM=new Fw,LM=new vw,NM=new vw,OM=new vw,kM=new Fw,DM=new Fw,zM=new Fw,UM=new Fw,FM=new Fw,BM=class extends HS{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wM,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new lM;super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){let e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){let n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(r,t);let o=this.morphTargetInfluences;if(i&&o){RM.set(0,0,0);for(let n=0,r=i.length;n<r;n++){let r=o[n],a=i[n];0!==r&&(IM.fromBufferAttribute(a,t),s?RM.addScaledVector(IM,r):RM.addScaledVector(IM.sub(e),r))}e.add(RM)}return e}raycast(t,e){let n=this.geometry,r=this.material,i=this.matrixWorld;void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),EM.copy(n.boundingSphere),EM.applyMatrix4(i),MM.copy(t.ray).recast(t.near),(!1!==EM.containsPoint(MM.origin)||!(null===MM.intersectSphere(EM,TM)||MM.origin.distanceToSquared(TM)>(t.far-t.near)**2))&&(SM.copy(i).invert(),MM.copy(t.ray).applyMatrix4(SM),(null===n.boundingBox||!1!==MM.intersectsBox(n.boundingBox))&&this._computeIntersections(t,e,MM)))}_computeIntersections(t,e,n){let r,i=this.geometry,s=this.material,o=i.index,a=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv1,u=i.attributes.normal,h=i.groups,d=i.drawRange;if(null!==o)if(Array.isArray(s))for(let p=0,f=h.length;p<f;p++){let i=h[p],a=s[i.materialIndex];for(let s=Math.max(i.start,d.start),h=Math.min(o.count,Math.min(i.start+i.count,d.start+d.count));s<h;s+=3){r=VM(this,a,t,n,l,c,u,o.getX(s),o.getX(s+1),o.getX(s+2)),r&&(r.faceIndex=Math.floor(s/3),r.face.materialIndex=i.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);i<a;i+=3){r=VM(this,s,t,n,l,c,u,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}else if(void 0!==a)if(Array.isArray(s))for(let p=0,f=h.length;p<f;p++){let i=h[p],o=s[i.materialIndex];for(let s=Math.max(i.start,d.start),h=Math.min(a.count,Math.min(i.start+i.count,d.start+d.count));s<h;s+=3){r=VM(this,o,t,n,l,c,u,s,s+1,s+2),r&&(r.faceIndex=Math.floor(s/3),r.face.materialIndex=i.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);i<o;i+=3){r=VM(this,s,t,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}}};function VM(t,e,n,r,i,s,o,a,l,c){t.getVertexPosition(a,AM),t.getVertexPosition(l,CM),t.getVertexPosition(c,PM);let u=function(t,e,n,r,i,s,o,a){let l;if(l=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,0===e.side,a),null===l)return null;FM.copy(a),FM.applyMatrix4(t.matrixWorld);let c=n.ray.origin.distanceTo(FM);return c<n.near||c>n.far?null:{distance:c,point:FM.clone(),object:t}}(t,e,n,r,AM,CM,PM,UM);if(u){i&&(LM.fromBufferAttribute(i,a),NM.fromBufferAttribute(i,l),OM.fromBufferAttribute(i,c),u.uv=QS.getInterpolation(UM,AM,CM,PM,LM,NM,OM,new vw)),s&&(LM.fromBufferAttribute(s,a),NM.fromBufferAttribute(s,l),OM.fromBufferAttribute(s,c),u.uv1=QS.getInterpolation(UM,AM,CM,PM,LM,NM,OM,new vw)),o&&(kM.fromBufferAttribute(o,a),DM.fromBufferAttribute(o,l),zM.fromBufferAttribute(o,c),u.normal=QS.getInterpolation(UM,AM,CM,PM,kM,DM,zM,new Fw),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));let t={a:a,b:l,c:c,normal:new Fw,materialIndex:0};QS.getNormal(AM,CM,PM,t.normal),u.face=t}return u}function HM(t){let e={};for(let n in t){e[n]={};for(let r in t[n]){let i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function jM(t){let e={};for(let n=0;n<t.length;n++){let r=HM(t[n]);for(let t in r)e[t]=r[t]}return e}var WM=class extends HS{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new mS,this.projectionMatrix=new mS,this.projectionMatrixInverse=new mS,this.coordinateSystem=rw}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}},GM=new Fw,qM=new vw,$M=new vw,XM=class extends WM{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=2*cw*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(.5*lw*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*cw*Math.atan(Math.tan(.5*lw*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){GM.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(GM.x,GM.y).multiplyScalar(-t/GM.z),GM.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(GM.x,GM.y).multiplyScalar(-t/GM.z)}getViewSize(t,e){return this.getViewBounds(t,qM,$M),e.subVectors($M,qM)}setViewOffset(t,e,n,r,i,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(.5*lw*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,s=this.view;if(null!==this.view&&this.view.enabled){let t=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/t,e-=s.offsetY*n/o,r*=s.width/t,n*=s.height/o}let o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}},JM=new Fw,YM=new Fw,ZM=new yw,KM=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fw(1,0,0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){let r=JM.subVectors(n,e).cross(YM.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){let n=t.delta(JM),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;let i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(t.start).addScaledVector(n,i)}intersectsLine(t){let e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let n=e||ZM.getNormalMatrix(t),r=this.coplanarPoint(JM).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}},QM=new oS,tE=new Fw,eE=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KM,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KM,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new KM,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new KM,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new KM,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new KM;this.planes=[t,e,n,r,i,s]}set(t,e,n,r,i,s){let o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this}copy(t){let e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rw,n=this.planes,r=t.elements,i=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],_=r[15];if(n[0].setComponents(a-i,h-l,m-d,_-g).normalize(),n[1].setComponents(a+i,h+l,m+d,_+g).normalize(),n[2].setComponents(a+s,h+c,m+p,_+v).normalize(),n[3].setComponents(a-s,h-c,m-p,_-v).normalize(),n[4].setComponents(a-o,h-u,m-f,_-y).normalize(),e===rw)n[5].setComponents(a+o,h+u,m+f,_+y).normalize();else{if(e!==iw)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(o,u,f,y).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),QM.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{let e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),QM.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(QM)}intersectsSprite(t){return QM.center.set(0,0,0),QM.radius=.7071067811865476,QM.applyMatrix4(t.matrixWorld),this.intersectsSphere(QM)}intersectsSphere(t){let e=this.planes,n=t.center,r=-t.radius;for(let i=0;i<6;i++)if(e[i].distanceToPoint(n)<r)return!1;return!0}intersectsBox(t){let e=this.planes;for(let n=0;n<6;n++){let r=e[n];if(tE.x=r.normal.x>0?t.max.x:t.min.x,tE.y=r.normal.y>0?t.max.y:t.min.y,tE.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(tE)<0)return!1}return!0}containsPoint(t){let e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}},nE={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},rE={common:{diffuse:{value:new iM(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new yw},alphaMap:{value:null},alphaMapTransform:{value:new yw},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new yw}},envmap:{envMap:{value:null},envMapRotation:{value:new yw},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new yw}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new yw}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new yw},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new yw},normalScale:{value:new vw(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new yw},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new yw}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new yw}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new yw}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new iM(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new iM(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new yw},alphaTest:{value:0},uvTransform:{value:new yw}},sprite:{diffuse:{value:new iM(16777215)},opacity:{value:1},center:{value:new vw(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new yw},alphaMap:{value:null},alphaMapTransform:{value:new yw},alphaTest:{value:0}}},iE={basic:{uniforms:jM([rE.common,rE.specularmap,rE.envmap,rE.aomap,rE.lightmap,rE.fog]),vertexShader:nE.meshbasic_vert,fragmentShader:nE.meshbasic_frag},lambert:{uniforms:jM([rE.common,rE.specularmap,rE.envmap,rE.aomap,rE.lightmap,rE.emissivemap,rE.bumpmap,rE.normalmap,rE.displacementmap,rE.fog,rE.lights,{emissive:{value:new iM(0)}}]),vertexShader:nE.meshlambert_vert,fragmentShader:nE.meshlambert_frag},phong:{uniforms:jM([rE.common,rE.specularmap,rE.envmap,rE.aomap,rE.lightmap,rE.emissivemap,rE.bumpmap,rE.normalmap,rE.displacementmap,rE.fog,rE.lights,{emissive:{value:new iM(0)},specular:{value:new iM(1118481)},shininess:{value:30}}]),vertexShader:nE.meshphong_vert,fragmentShader:nE.meshphong_frag},standard:{uniforms:jM([rE.common,rE.envmap,rE.aomap,rE.lightmap,rE.emissivemap,rE.bumpmap,rE.normalmap,rE.displacementmap,rE.roughnessmap,rE.metalnessmap,rE.fog,rE.lights,{emissive:{value:new iM(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:nE.meshphysical_vert,fragmentShader:nE.meshphysical_frag},toon:{uniforms:jM([rE.common,rE.aomap,rE.lightmap,rE.emissivemap,rE.bumpmap,rE.normalmap,rE.displacementmap,rE.gradientmap,rE.fog,rE.lights,{emissive:{value:new iM(0)}}]),vertexShader:nE.meshtoon_vert,fragmentShader:nE.meshtoon_frag},matcap:{uniforms:jM([rE.common,rE.bumpmap,rE.normalmap,rE.displacementmap,rE.fog,{matcap:{value:null}}]),vertexShader:nE.meshmatcap_vert,fragmentShader:nE.meshmatcap_frag},points:{uniforms:jM([rE.points,rE.fog]),vertexShader:nE.points_vert,fragmentShader:nE.points_frag},dashed:{uniforms:jM([rE.common,rE.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:nE.linedashed_vert,fragmentShader:nE.linedashed_frag},depth:{uniforms:jM([rE.common,rE.displacementmap]),vertexShader:nE.depth_vert,fragmentShader:nE.depth_frag},normal:{uniforms:jM([rE.common,rE.bumpmap,rE.normalmap,rE.displacementmap,{opacity:{value:1}}]),vertexShader:nE.meshnormal_vert,fragmentShader:nE.meshnormal_frag},sprite:{uniforms:jM([rE.sprite,rE.fog]),vertexShader:nE.sprite_vert,fragmentShader:nE.sprite_frag},background:{uniforms:{uvTransform:{value:new yw},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:nE.background_vert,fragmentShader:nE.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new yw}},vertexShader:nE.backgroundCube_vert,fragmentShader:nE.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:nE.cube_vert,fragmentShader:nE.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:nE.equirect_vert,fragmentShader:nE.equirect_frag},distanceRGBA:{uniforms:jM([rE.common,rE.displacementmap,{referencePosition:{value:new Fw},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:nE.distanceRGBA_vert,fragmentShader:nE.distanceRGBA_frag},shadow:{uniforms:jM([rE.lights,rE.fog,{color:{value:new iM(0)},opacity:{value:1}}]),vertexShader:nE.shadow_vert,fragmentShader:nE.shadow_frag}};iE.physical={uniforms:jM([iE.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new yw},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new yw},clearcoatNormalScale:{value:new vw(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new yw},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new yw},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new yw},sheen:{value:0},sheenColor:{value:new iM(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new yw},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new yw},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new yw},transmissionSamplerSize:{value:new vw},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new yw},attenuationDistance:{value:0},attenuationColor:{value:new iM(0)},specularColor:{value:new iM(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new yw},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new yw},anisotropyVector:{value:new vw},anisotropyMap:{value:null},anisotropyMapTransform:{value:new yw}}]),vertexShader:nE.meshphysical_vert,fragmentShader:nE.meshphysical_frag};var sE=class extends WM{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t,s=n+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){let t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,s=i+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}},oE=(1+Math.sqrt(5))/2,aE=1/oE;new Fw(-oE,aE,0),new Fw(oE,aE,0),new Fw(-aE,0,oE),new Fw(aE,0,oE),new Fw(0,oE,-aE),new Fw(0,oE,aE),new Fw(-1,1,-1),new Fw(1,1,-1),new Fw(-1,1,1),new Fw(1,1,1);var lE,cE=class extends HS{constructor(){super(),this.isGroup=!0,this.type="Group"}},uE=class{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=nw,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=uw()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return ww("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=uw()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=uw()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},hE=new Fw,dE=class t{constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)hE.fromBufferAttribute(this,e),hE.applyMatrix4(t),this.setXYZ(e,hE.x,hE.y,hE.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)hE.fromBufferAttribute(this,e),hE.applyNormalMatrix(t),this.setXYZ(e,hE.x,hE.y,hE.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)hE.fromBufferAttribute(this,e),hE.transformDirection(t),this.setXYZ(e,hE.x,hE.y,hE.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=fw(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=mw(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=mw(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=mw(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=mw(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=mw(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=fw(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=fw(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=fw(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=fw(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=mw(e,this.array),n=mw(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=mw(e,this.array),n=mw(n,this.array),r=mw(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=mw(e,this.array),n=mw(n,this.array),r=mw(r,this.array),i=mw(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let e=0;e<this.count;e++){let n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new hM(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new t(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let e=0;e<this.count;e++){let n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},pE=class extends aM{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new iM(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}},fE=new Fw,mE=new Fw,gE=new Fw,vE=new vw,yE=new vw,_E=new mS,bE=new Fw,xE=new Fw,wE=new Fw,SE=new vw,ME=new vw,EE=new vw,TE=class extends HS{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pE;if(super(),this.isSprite=!0,this.type="Sprite",void 0===lE){lE=new wM;let t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new uE(t,5);lE.setIndex([0,1,2,0,2,3]),lE.setAttribute("position",new dE(e,3,0,!1)),lE.setAttribute("uv",new dE(e,2,3,!1))}this.geometry=lE,this.material=t,this.center=new vw(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),mE.setFromMatrixScale(this.matrixWorld),_E.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),gE.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&mE.multiplyScalar(-gE.z);let n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));let s=this.center;AE(bE.set(-.5,-.5,0),gE,s,mE,n,r),AE(xE.set(.5,-.5,0),gE,s,mE,n,r),AE(wE.set(.5,.5,0),gE,s,mE,n,r),SE.set(0,0),ME.set(1,0),EE.set(1,1);let o=t.ray.intersectTriangle(bE,xE,wE,!1,fE);if(null===o&&(AE(xE.set(-.5,.5,0),gE,s,mE,n,r),ME.set(0,1),o=t.ray.intersectTriangle(bE,wE,xE,!1,fE),null===o))return;let a=t.ray.origin.distanceTo(fE);a<t.near||a>t.far||e.push({distance:a,point:fE.clone(),uv:QS.getInterpolation(fE,bE,xE,wE,SE,ME,EE,new vw),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}};function AE(t,e,n,r,i,s){vE.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(yE.x=s*vE.x-i*vE.y,yE.y=i*vE.x+s*vE.y):yE.copy(vE),t.copy(e),t.x+=yE.x,t.y+=yE.y,t.applyMatrix4(_E)}var CE=new Fw,PE=new zw,IE=new zw,RE=new Fw,LE=new mS,NE=new Fw,OE=new oS,kE=new mS,DE=new fS,zE=class extends BM{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Nx,this.bindMatrix=new mS,this.bindMatrixInverse=new mS,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){let t=this.geometry;null===this.boundingBox&&(this.boundingBox=new Hw),this.boundingBox.makeEmpty();let e=t.getAttribute("position");for(let n=0;n<e.count;n++)this.getVertexPosition(n,NE),this.boundingBox.expandByPoint(NE)}computeBoundingSphere(){let t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new oS),this.boundingSphere.makeEmpty();let e=t.getAttribute("position");for(let n=0;n<e.count;n++)this.getVertexPosition(n,NE),this.boundingSphere.expandByPoint(NE)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){let n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),OE.copy(this.boundingSphere),OE.applyMatrix4(r),!1!==t.ray.intersectsSphere(OE)&&(kE.copy(r).invert(),DE.copy(t.ray).applyMatrix4(kE),(null===this.boundingBox||!1!==DE.intersectsBox(this.boundingBox))&&this._computeIntersections(t,e,DE)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let t=new zw,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.fromBufferAttribute(e,n);let r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===Nx?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){let n=this.skeleton,r=this.geometry;PE.fromBufferAttribute(r.attributes.skinIndex,t),IE.fromBufferAttribute(r.attributes.skinWeight,t),CE.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let i=0;i<4;i++){let t=IE.getComponent(i);if(0!==t){let r=PE.getComponent(i);LE.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(RE.copy(CE).applyMatrix4(LE),t)}}return e.applyMatrix4(this.bindMatrixInverse)}},UE=class extends HS{constructor(){super(),this.isBone=!0,this.type="Bone"}},FE=class extends Dw{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:zx,arguments.length>9&&void 0!==arguments[9]?arguments[9]:zx,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},BE=new mS,VE=new mS,HE=class t{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=uw(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){let t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new mS)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){let e=new mS;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){let e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){let e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){let t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let i=0,s=t.length;i<s;i++){let r=t[i]?t[i].matrixWorld:VE;BE.multiplyMatrices(r,e[i]),BE.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)}clone(){return new t(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);let e=new Float32Array(t*t*4);e.set(this.boneMatrices);let n=new FE(e,t,t,1023,Bx);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){let n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,r=t.bones.length;n<r;n++){let r=t.bones[n],i=e[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new UE),this.bones.push(i),this.boneInverses.push((new mS).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){let t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;let e=this.bones,n=this.boneInverses;for(let r=0,i=e.length;r<i;r++){let i=e[r];t.bones.push(i.uuid);let s=n[r];t.boneInverses.push(s.toArray())}return t}},jE=class extends hM{constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){let t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}},WE=new mS,GE=new mS,qE=[],$E=new Hw,XE=new mS,JE=new BM,YE=new oS,ZE=class extends BM{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new jE(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,XE)}computeBoundingBox(){let t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new Hw),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,WE),$E.copy(t.boundingBox).applyMatrix4(WE),this.boundingBox.union($E)}computeBoundingSphere(){let t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new oS),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,WE),YE.copy(t.boundingSphere).applyMatrix4(WE),this.boundingSphere.union(YE)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){let n=e.morphTargetInfluences,r=this.morphTexture.source.data.data,i=t*(n.length+1)+1;for(let s=0;s<n.length;s++)n[s]=r[i+s]}raycast(t,e){let n=this.matrixWorld,r=this.count;if(JE.geometry=this.geometry,JE.material=this.material,void 0!==JE.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),YE.copy(this.boundingSphere),YE.applyMatrix4(n),!1!==t.ray.intersectsSphere(YE)))for(let i=0;i<r;i++){this.getMatrixAt(i,WE),GE.multiplyMatrices(n,WE),JE.matrixWorld=GE,JE.raycast(t,qE);for(let t=0,n=qE.length;t<n;t++){let n=qE[t];n.instanceId=i,n.object=this,e.push(n)}qE.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new jE(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){let n=e.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new FE(new Float32Array(r*this.count),r,this.count,1028,Bx));let i=this.morphTexture.source.data.data,s=0;for(let l=0;l<n.length;l++)s+=n[l];let o=this.geometry.morphTargetsRelative?1:1-s,a=r*t;i[a]=o,i.set(n,a+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}},KE=class extends aM{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new iM(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}},QE=new Fw,tT=new Fw,eT=new mS,nT=new fS,rT=new oS,iT=new Fw,sT=new Fw,oT=class extends HS{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wM,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KE;super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){let t=this.geometry;if(null===t.index){let e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)QE.fromBufferAttribute(e,t-1),tT.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=QE.distanceTo(tT);t.setAttribute("lineDistance",new fM(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){let n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),rT.copy(n.boundingSphere),rT.applyMatrix4(r),rT.radius+=i,!1===t.ray.intersectsSphere(rT))return;eT.copy(r).invert(),nT.copy(t.ray).applyMatrix4(eT);let o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){let n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){let n=c.getX(i),r=c.getX(i+1),s=aT(this,t,nT,a,n,r);s&&e.push(s)}if(this.isLineLoop){let i=c.getX(r-1),s=c.getX(n),o=aT(this,t,nT,a,i,s);o&&e.push(o)}}else{let n=Math.max(0,s.start),r=Math.min(u.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){let n=aT(this,t,nT,a,i,i+1);n&&e.push(n)}if(this.isLineLoop){let i=aT(this,t,nT,a,r-1,n);i&&e.push(i)}}}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){let e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}};function aT(t,e,n,r,i,s){let o=t.geometry.attributes.position;if(QE.fromBufferAttribute(o,i),tT.fromBufferAttribute(o,s),n.distanceSqToSegment(QE,tT,iT,sT)>r)return;iT.applyMatrix4(t.matrixWorld);let a=e.ray.origin.distanceTo(iT);return a<e.near||a>e.far?void 0:{distance:a,point:sT.clone().applyMatrix4(t.matrixWorld),index:i,face:null,faceIndex:null,object:t}}var lT=new Fw,cT=new Fw,uT=class extends oT{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let t=this.geometry;if(null===t.index){let e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)lT.fromBufferAttribute(e,t),cT.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+lT.distanceTo(cT);t.setAttribute("lineDistance",new fM(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},hT=class extends oT{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}},dT=class extends aM{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new iM(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}},pT=new mS,fT=new fS,mT=new oS,gT=new Fw,vT=class extends HS{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wM,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dT;super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){let n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),mT.copy(n.boundingSphere),mT.applyMatrix4(r),mT.radius+=i,!1===t.ray.intersectsSphere(mT))return;pT.copy(r).invert(),fT.copy(t.ray).applyMatrix4(pT);let o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,s.start),i=Math.min(l.count,s.start+s.count);n<i;n++){let i=l.getX(n);gT.fromBufferAttribute(c,i),yT(gT,i,a,r,t,e,this)}}else{for(let n=Math.max(0,s.start),i=Math.min(c.count,s.start+s.count);n<i;n++)gT.fromBufferAttribute(c,n),yT(gT,n,a,r,t,e,this)}}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){let e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}};function yT(t,e,n,r,i,s,o){let a=fT.distanceSqToPoint(t);if(a<n){let n=new Fw;fT.closestPointToPoint(t,n),n.applyMatrix4(r);let l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}var _T=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){let n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){let t=this.getLengths();return t[t.length-1]}getLengths(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let e,n=[],r=this.getPoint(0),i=0;n.push(0);for(let s=1;s<=t;s++)e=this.getPoint(s/t),i+=e.distanceTo(r),n.push(i),r=e;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){let n,r=this.getLengths(),i=0,s=r.length;n=e||t*r[s-1];let o,a=0,l=s-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),o=r[i]-n,o<0)a=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,r[i]===n)return i/(s-1);let c=r[i];return(i+(n-c)/(r[i+1]-c))/(s-1)}getTangent(t,e){let n=t-1e-4,r=t+1e-4;n<0&&(n=0),r>1&&(r=1);let i=this.getPoint(n),s=this.getPoint(r),o=e||(i.isVector2?new vw:new Fw);return o.copy(s).sub(i).normalize(),o}getTangentAt(t,e){let n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){let n=new Fw,r=[],i=[],s=[],o=new Fw,a=new mS;for(let d=0;d<=t;d++){let e=d/t;r[d]=this.getTangentAt(e,new Fw)}i[0]=new Fw,s[0]=new Fw;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]);for(let d=1;d<=t;d++){if(i[d]=i[d-1].clone(),s[d]=s[d-1].clone(),o.crossVectors(r[d-1],r[d]),o.length()>Number.EPSILON){o.normalize();let t=Math.acos(hw(r[d-1].dot(r[d]),-1,1));i[d].applyMatrix4(a.makeRotationAxis(o,t))}s[d].crossVectors(r[d],i[d])}if(!0===e){let e=Math.acos(hw(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(o.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){let t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},bT=class extends _T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new vw,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,i=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=i?0:n),!0===this.aClockwise&&!i&&(r===n?r=-n:r-=n);let s=this.aStartAngle+t*r,o=this.aX+this.xRadius*Math.cos(s),a=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){let t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=o-this.aX,r=a-this.aY;o=n*t-r*e+this.aX,a=n*e+r*t+this.aY}return e.set(o,a)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){let t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}};function xT(){let t=0,e=0,n=0,r=0;function i(i,s,o,a){t=i,e=o,n=-3*i+3*s-2*o-a,r=2*i-2*s+o+a}return{initCatmullRom:function(t,e,n,r,s){i(e,n,s*(n-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,c=(n-e)/o-(r-e)/(o+a)+(r-n)/a;l*=o,c*=o,i(e,n,l,c)},calc:function(i){let s=i*i;return t+e*i+n*s+r*(s*i)}}}var wT=new Fw,ST=new xT,MT=new xT,ET=new xT;function TT(t,e,n,r,i){let s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function AT(t,e,n,r){return function(t,e){let n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function CT(t,e,n,r,i){return function(t,e){let n=1-t;return n*n*n*e}(t,e)+function(t,e){let n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}var PT=class extends _T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fw,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw).subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},IT=class extends _T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fw,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Fw;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw,n=this.v0,r=this.v1,i=this.v2;return e.set(AT(t,n.x,r.x,i.x),AT(t,n.y,r.y,i.y),AT(t,n.z,r.z,i.z)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},RT=Object.freeze({__proto__:null,ArcCurve:class extends bT{constructor(t,e,n,r,i,s){super(t,e,n,n,r,i,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends _T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}getPoint(t){let e,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw,i=this.points,s=i.length,o=(s-(this.closed?0:1))*t,a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:0===l&&a===s-1&&(a=s-2,l=1),this.closed||a>0?e=i[(a-1)%s]:(wT.subVectors(i[0],i[1]).add(i[0]),e=wT);let c=i[a%s],u=i[(a+1)%s];if(this.closed||a+2<s?n=i[(a+2)%s]:(wT.subVectors(i[s-1],i[s-2]).add(i[s-1]),n=wT),"centripetal"===this.curveType||"chordal"===this.curveType){let t="chordal"===this.curveType?.5:.25,r=Math.pow(e.distanceToSquared(c),t),i=Math.pow(c.distanceToSquared(u),t),s=Math.pow(u.distanceToSquared(n),t);i<1e-4&&(i=1),r<1e-4&&(r=i),s<1e-4&&(s=i),ST.initNonuniformCatmullRom(e.x,c.x,u.x,n.x,r,i,s),MT.initNonuniformCatmullRom(e.y,c.y,u.y,n.y,r,i,s),ET.initNonuniformCatmullRom(e.z,c.z,u.z,n.z,r,i,s)}else"catmullrom"===this.curveType&&(ST.initCatmullRom(e.x,c.x,u.x,n.x,this.tension),MT.initCatmullRom(e.y,c.y,u.y,n.y,this.tension),ET.initCatmullRom(e.z,c.z,u.z,n.z,this.tension));return r.set(ST.calc(l),MT.calc(l),ET.calc(l)),r}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){let n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){let n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){let n=t.points[e];this.points.push((new Fw).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},CubicBezierCurve:class extends _T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new vw,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new vw,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new vw,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new vw;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new vw,n=this.v0,r=this.v1,i=this.v2,s=this.v3;return e.set(CT(t,n.x,r.x,i.x,s.x),CT(t,n.y,r.y,i.y,s.y)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},CubicBezierCurve3:class extends _T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fw,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Fw,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Fw;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw,n=this.v0,r=this.v1,i=this.v2,s=this.v3;return e.set(CT(t,n.x,r.x,i.x,s.x),CT(t,n.y,r.y,i.y,s.y),CT(t,n.z,r.z,i.z,s.z)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},EllipseCurve:bT,LineCurve:class extends _T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new vw,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new vw;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new vw;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new vw).subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},LineCurve3:PT,QuadraticBezierCurve:class extends _T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new vw,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new vw,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new vw;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new vw,n=this.v0,r=this.v1,i=this.v2;return e.set(AT(t,n.x,r.x,i.x),AT(t,n.y,r.y,i.y)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve3:IT,SplineCurve:class extends _T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new vw,n=this.points,r=(n.length-1)*t,i=Math.floor(r),s=r-i,o=n[0===i?i:i-1],a=n[i],l=n[i>n.length-2?n.length-1:i+1],c=n[i>n.length-3?n.length-1:i+2];return e.set(TT(s,o.x,a.x,l.x,c.x),TT(s,o.y,a.y,l.y,c.y)),e}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){let n=t.points[e];this.points.push(n.clone())}return this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){let n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){let n=t.points[e];this.points.push((new vw).fromArray(n))}return this}}}),LT=class t extends wM{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new IT(new Fw(-1,-1,0),new Fw(-1,1,0),new Fw(1,1,0)),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};let s=t.computeFrenetFrames(e,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;let o=new Fw,a=new Fw,l=new vw,c=new Fw,u=[],h=[],d=[],p=[];function f(i){c=t.getPointAt(i/e,c);let l=s.normals[i],d=s.binormals[i];for(let t=0;t<=r;t++){let e=t/r*Math.PI*2,i=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+i*d.x,a.y=s*l.y+i*d.y,a.z=s*l.z+i*d.z,a.normalize(),h.push(a.x,a.y,a.z),o.x=c.x+n*a.x,o.y=c.y+n*a.y,o.z=c.z+n*a.z,u.push(o.x,o.y,o.z)}}(function(){for(let t=0;t<e;t++)f(t);f(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)l.x=t/e,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){let n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,o=(r+1)*(t-1)+e;p.push(n,i,o),p.push(i,s,o)}}()})(),this.setIndex(p),this.setAttribute("position",new fM(u,3)),this.setAttribute("normal",new fM(h,3)),this.setAttribute("uv",new fM(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){let t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(e){return new t((new RT[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}},NT=class extends aM{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new iM(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new iM(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vw(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ES,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}},OT=class extends NT{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new vw(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return hw(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new iM(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new iM(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new iM(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}};function kT(t,e,n){return t&&t.constructor!==e?"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t):t}function DT(t){let e=t.length,n=new Array(e);for(let r=0;r!==e;++r)n[r]=r;return n.sort((function(e,n){return t[e]-t[n]})),n}function zT(t,e,n){let r=t.length,i=new t.constructor(r);for(let s=0,o=0;o!==r;++s){let r=n[s]*e;for(let n=0;n!==e;++n)i[o++]=t[r+n]}return i}function UT(t,e,n,r){let i=1,s=t[0];for(;void 0!==s&&void 0===s[r];)s=t[i++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[i++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),n.push(o)),s=t[i++]}while(void 0!==s)}var FT=class{constructor(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let s;n:{r:if(!(t<r)){for(let s=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(i=r,r=e[++n],t<r)break e}s=e.length;break n}if(t>=i)break t;{let o=e[1];t<o&&(n=2,i=o);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(r=i,i=e[--n-1],t>=i)break e}s=n,n=0}}for(;n<s;){let r=n+s>>>1;t<e[r]?s=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let s=0;s!==r;++s)e[s]=n[i+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},BT=class extends FT{constructor(t,e,n,r){super(t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Wx,endingEnd:Wx}}intervalChanged_(t,e,n){let r=this.parameterPositions,i=t-2,s=t+1,o=r[i],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case Gx:i=t,o=2*e-n;break;case qx:i=r.length-2,o=e+r[i]-r[i+1];break;default:i=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Gx:s=t,a=2*n-e;break;case qx:s=1,a=n+r[1]-r[0];break;default:s=t-1,a=e}let l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=s*c}interpolate_(t,e,n,r){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let b=0;b!==o;++b)i[b]=g*s[c+b]+v*s[l+b]+y*s[a+b]+_*s[u+b];return i}},VT=class extends FT{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,c=(n-e)/(r-e),u=1-c;for(let h=0;h!==o;++h)i[h]=s[l+h]*u+s[a+h]*c;return i}},HT=class extends FT{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t){return this.copySampleValue_(t-1)}},jT=class{constructor(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=kT(e,this.TimeBufferType),this.values=kT(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){let e,n=t.constructor;if(n.toJSON!==this.toJSON)e=n.toJSON(t);else{e={name:t.name,times:kT(t.times,Array),values:kT(t.values,Array)};let n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e}InterpolantFactoryMethodDiscrete(t){return new HT(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new VT(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new BT(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Vx:e=this.InterpolantFactoryMethodDiscrete;break;case Hx:e=this.InterpolantFactoryMethodLinear;break;case jx:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){let e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Vx;case this.InterpolantFactoryMethodLinear:return Hx;case this.InterpolantFactoryMethodSmooth:return jx}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){let e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this}scale(t){if(1!==t){let e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this}trim(t,e){let n=this.times,r=n.length,i=0,s=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);let t=this.getValueSize();this.times=n.slice(i,s),this.values=this.values.slice(i*t,s*t)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let o=0;o!==i;o++){let e=n[o];if("number"==typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,e),t=!1;break}if(null!==s&&s>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,e,s),t=!1;break}s=e}if(void 0!==r&&function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}(r))for(let o=0,a=r.length;o!==a;++o){let e=r[o];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,e),t=!1;break}}return t}optimize(){let t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===jx,i=t.length-1,s=1;for(let o=1;o<i;++o){let i=!1,a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(r)i=!0;else{let t=o*n,r=t-n,s=t+n;for(let o=0;o!==n;++o){let n=e[t+o];if(n!==e[r+o]||n!==e[s+o]){i=!0;break}}}if(i){if(o!==s){t[s]=t[o];let r=o*n,i=s*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++s}}if(i>0){t[s]=t[i];for(let t=i*n,r=s*n,o=0;o!==n;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*n)):(this.times=t,this.values=e),this}clone(){let t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}};jT.prototype.TimeBufferType=Float32Array,jT.prototype.ValueBufferType=Float32Array,jT.prototype.DefaultInterpolation=Hx;var WT=class extends jT{constructor(t,e,n){super(t,e,n)}};WT.prototype.ValueTypeName="bool",WT.prototype.ValueBufferType=Array,WT.prototype.DefaultInterpolation=Vx,WT.prototype.InterpolantFactoryMethodLinear=void 0,WT.prototype.InterpolantFactoryMethodSmooth=void 0;var GT=class extends jT{};GT.prototype.ValueTypeName="color";var qT=class extends jT{};qT.prototype.ValueTypeName="number";var $T=class extends FT{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(r-e),l=t*o;for(let c=l+o;l!==c;l+=4)Uw.slerpFlat(i,0,s,l-o,s,l,a);return i}},XT=class extends jT{InterpolantFactoryMethodLinear(t){return new $T(this.times,this.values,this.getValueSize(),t)}};XT.prototype.ValueTypeName="quaternion",XT.prototype.InterpolantFactoryMethodSmooth=void 0;var JT=class extends jT{constructor(t,e,n){super(t,e,n)}};JT.prototype.ValueTypeName="string",JT.prototype.ValueBufferType=Array,JT.prototype.DefaultInterpolation=Vx,JT.prototype.InterpolantFactoryMethodLinear=void 0,JT.prototype.InterpolantFactoryMethodSmooth=void 0;var YT=class extends jT{};YT.prototype.ValueTypeName="vector";var ZT=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:$x;this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=uw(),this.duration<0&&this.resetDuration()}static parse(t){let e=[],n=t.tracks,r=1/(t.fps||1);for(let s=0,o=n.length;s!==o;++s)e.push(KT(n[s]).scale(r));let i=new this(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i}static toJSON(t){let e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let i=0,s=n.length;i!==s;++i)e.push(jT.toJSON(n[i]));return r}static CreateFromMorphTargetSequence(t,e,n,r){let i=e.length,s=[];for(let o=0;o<i;o++){let t=[],a=[];t.push((o+i-1)%i,o,(o+1)%i),a.push(0,1,0);let l=DT(t);t=zT(t,1,l),a=zT(a,1,l),!r&&0===t[0]&&(t.push(i),a.push(a[0])),s.push(new qT(".morphTargetInfluences["+e[o].name+"]",t,a).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){let e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let r=0;r<n.length;r++)if(n[r].name===e)return n[r];return null}static CreateClipsFromMorphTargetSequences(t,e,n){let r={},i=/^([\w-]*?)([\d]+)$/;for(let o=0,a=t.length;o<a;o++){let e=t[o],n=e.name.match(i);if(n&&n.length>1){let t=n[1],i=r[t];i||(r[t]=i=[]),i.push(e)}}let s=[];for(let o in r)s.push(this.CreateFromMorphTargetSequence(o,r[o],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(t,e,n,r,i){if(0!==n.length){let s=[],o=[];UT(n,s,o,r),0!==s.length&&i.push(new t(e,s,o))}},r=[],i=t.name||"default",s=t.fps||30,o=t.blendMode,a=t.length||-1,l=t.hierarchy||[];for(let c=0;c<l.length;c++){let t=l[c].keys;if(t&&0!==t.length)if(t[0].morphTargets){let e,n={};for(e=0;e<t.length;e++)if(t[e].morphTargets)for(let r=0;r<t[e].morphTargets.length;r++)n[t[e].morphTargets[r]]=-1;for(let i in n){let n=[],s=[];for(let r=0;r!==t[e].morphTargets.length;++r){let r=t[e];n.push(r.time),s.push(r.morphTarget===i?1:0)}r.push(new qT(".morphTargetInfluence["+i+"]",n,s))}a=n.length*s}else{let i=".bones["+e[c].name+"]";n(YT,i+".position",t,"pos",r),n(XT,i+".quaternion",t,"rot",r),n(YT,i+".scale",t,"scl",r)}}return 0===r.length?null:new this(i,a,r,o)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){let n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){let t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function KT(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return qT;case"vector":case"vector2":case"vector3":case"vector4":return YT;case"color":return GT;case"quaternion":return XT;case"bool":case"boolean":return WT;case"string":return JT}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){let e=[],n=[];UT(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}var QT={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},tA=new class{constructor(t,e,n){let r,i=this,s=!1,o=0,a=0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==i.onStart&&i.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){let e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){let n=l[e],r=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}},eA=class{constructor(t){this.manager=void 0!==t?t:tA,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){let n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}};eA.DEFAULT_MATERIAL_NAME="__DEFAULT";var nA={},rA=class extends Error{constructor(t,e){super(t),this.response=e}},iA=class extends eA{constructor(t){super(t)}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let i=QT.get(t);if(void 0!==i)return this.manager.itemStart(t),setTimeout((()=>{e&&e(i),this.manager.itemEnd(t)}),0),i;if(void 0!==nA[t])return void nA[t].push({onLoad:e,onProgress:n,onError:r});nA[t]=[],nA[t].push({onLoad:e,onProgress:n,onError:r});let s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===e.body||void 0===e.body.getReader)return e;let n=nA[t],r=e.body.getReader(),i=e.headers.get("X-File-Size")||e.headers.get("Content-Length"),s=i?parseInt(i):0,o=0!==s,a=0,l=new ReadableStream({start(t){!function e(){r.read().then((r=>{let{done:i,value:l}=r;if(i)t.close();else{a+=l.byteLength;let r=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=n.length;t<e;t++){let e=n[t];e.onProgress&&e.onProgress(r)}t.enqueue(l),e()}}),(e=>{t.error(e)}))}()}});return new Response(l)}throw new rA(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{let e=/charset="?([^;"\s]*)"?/i.exec(o),n=e&&e[1]?e[1].toLowerCase():void 0,r=new TextDecoder(n);return t.arrayBuffer().then((t=>r.decode(t)))}}})).then((e=>{QT.add(t,e);let n=nA[t];delete nA[t];for(let t=0,r=n.length;t<r;t++){let r=n[t];r.onLoad&&r.onLoad(e)}})).catch((e=>{let n=nA[t];if(void 0===n)throw this.manager.itemError(t),e;delete nA[t];for(let t=0,r=n.length;t<r;t++){let r=n[t];r.onError&&r.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}},sA=class extends eA{constructor(t){super(t)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let i=this,s=QT.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;let o=bw("img");function a(){c(),QT.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){c(),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}},oA=class extends eA{constructor(t){super(t)}load(t,e,n,r){let i=new Dw,s=new sA(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){i.image=t,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}},aA=class extends HS{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new iM(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){let e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(e.object.target=this.target.uuid),e}},lA=new mS,cA=new Fw,uA=new Fw,hA=class{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new vw(512,512),this.map=null,this.mapPass=null,this.matrix=new mS,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new eE,this._frameExtents=new vw(1,1),this._viewportCount=1,this._viewports=[new zw(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){let e=this.camera,n=this.matrix;cA.setFromMatrixPosition(t.matrixWorld),e.position.copy(cA),uA.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(uA),e.updateMatrixWorld(),lA.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(lA),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(lA)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let t={};return 1!==this.intensity&&(t.intensity=this.intensity),0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}},dA=class extends hA{constructor(){super(new XM(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){let e=this.camera,n=2*cw*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;(n!==e.fov||r!==e.aspect||i!==e.far)&&(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}},pA=class extends aA{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(HS.DEFAULT_UP),this.updateMatrix(),this.target=new HS,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.map=null,this.shadow=new dA}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},fA=new mS,mA=new Fw,gA=new Fw,vA=class extends hA{constructor(){super(new XM(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new vw(4,2),this._viewportCount=6,this._viewports=[new zw(2,1,1,1),new zw(0,1,1,1),new zw(3,1,1,1),new zw(1,1,1,1),new zw(3,0,1,1),new zw(1,0,1,1)],this._cubeDirections=[new Fw(1,0,0),new Fw(-1,0,0),new Fw(0,0,1),new Fw(0,0,-1),new Fw(0,1,0),new Fw(0,-1,0)],this._cubeUps=[new Fw(0,1,0),new Fw(0,1,0),new Fw(0,1,0),new Fw(0,1,0),new Fw(0,0,1),new Fw(0,0,-1)]}updateMatrices(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),mA.setFromMatrixPosition(t.matrixWorld),n.position.copy(mA),gA.copy(n.position),gA.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(gA),n.updateMatrixWorld(),r.makeTranslation(-mA.x,-mA.y,-mA.z),fA.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(fA)}},yA=class extends aA{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new vA}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}},_A=class extends hA{constructor(){super(new sE(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},bA=class extends aA{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(HS.DEFAULT_UP),this.updateMatrix(),this.target=new HS,this.shadow=new _A}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},xA=class{static decodeText(t){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){let e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}},wA=class extends eA{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);let i=this,s=QT.get(t);if(void 0!==s)return i.manager.itemStart(t),s.then?void s.then((n=>{e&&e(n),i.manager.itemEnd(t)})).catch((t=>{r&&r(t)})):(setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s);let o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader;let a=fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){return QT.add(t,n),e&&e(n),i.manager.itemEnd(t),n})).catch((function(e){r&&r(e),QT.remove(t),i.manager.itemError(t),i.manager.itemEnd(t)}));QT.add(t,a),i.manager.itemStart(t)}},SA=class{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=MA(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let e=MA();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}};function MA(){return(typeof performance>"u"?Date:performance).now()}var EA=class{constructor(t,e,n){let r,i,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){let n=this.buffer,r=this.valueSize,i=t*r+r,s=this.cumulativeWeight;if(0===s){for(let t=0;t!==r;++t)n[i+t]=n[t];s=e}else{s+=e;let t=e/s;this._mixBufferRegion(n,i,0,t,r)}this.cumulativeWeight=s}accumulateAdditive(t){let e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){let e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){let t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-i,e)}s>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let a=e,l=e+e;a!==l;++a)if(n[a]!==n[a+e]){o.setValue(n,r);break}}saveOriginalState(){let t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let i=n,s=r;i!==s;++i)e[i]=e[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){let t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,r,i){if(r>=.5)for(let s=0;s!==i;++s)t[e+s]=t[n+s]}_slerp(t,e,n,r){Uw.slerpFlat(t,e,t,e,t,n,r)}_slerpAdditive(t,e,n,r,i){let s=this._workIndex*i;Uw.multiplyQuaternionsFlat(t,s,t,e,t,n),Uw.slerpFlat(t,e,t,e,t,s,r)}_lerp(t,e,n,r,i){let s=1-r;for(let o=0;o!==i;++o){let i=e+o;t[i]=t[i]*s+t[n+o]*r}}_lerpAdditive(t,e,n,r,i){for(let s=0;s!==i;++s){let i=e+s;t[i]=t[i]+t[n+s]*r}}},TA="\\[\\]\\.:\\/",AA=new RegExp("["+TA+"]","g"),CA="[^"+TA+"]",PA="[^"+TA.replace("\\.","")+"]",IA=/((?:WC+[\/:])*)/.source.replace("WC",CA),RA=/(WCOD+)?/.source.replace("WCOD",PA),LA=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",CA),NA=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",CA),OA=new RegExp("^"+IA+RA+LA+NA+"$"),kA=["material","materials","bones","map"],DA=class t{constructor(e,n,r){this.path=n,this.parsedPath=r||t.parseTrackName(n),this.node=t.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,r){return e&&e.isAnimationObjectGroup?new t.Composite(e,n,r):new t(e,n,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(AA,"")}static parseTrackName(t){let e=OA.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){let t=n.nodeName.substring(r+1);-1!==kA.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){let n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){let n=function(t){for(let r=0;r<t.length;r++){let i=t[r];if(i.name===e||i.uuid===e)return i;let s=n(i.children);if(s)return s}return null},r=n(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let e=this.node,n=this.parsedPath,r=n.objectName,i=n.propertyName,s=n.propertyIndex;if(e||(e=t.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(r){let t=n.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let n=0;n<e.length;n++)if(e[n].name===t){t=n;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==t){if(void 0===e[t])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[t]}}let o=e[i];if(void 0===o){let t=n.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+t+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else void 0!==o.fromArray&&void 0!==o.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};DA.Composite=class{constructor(t,e,n){let r=n||DA.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();let n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)}setValue(t,e){let n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},DA.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},DA.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},DA.prototype.GetterByBindingType=[DA.prototype._getValue_direct,DA.prototype._getValue_array,DA.prototype._getValue_arrayElement,DA.prototype._getValue_toArray],DA.prototype.SetterByBindingTypeAndVersioning=[[DA.prototype._setValue_direct,DA.prototype._setValue_direct_setNeedsUpdate,DA.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[DA.prototype._setValue_array,DA.prototype._setValue_array_setNeedsUpdate,DA.prototype._setValue_array_setMatrixWorldNeedsUpdate],[DA.prototype._setValue_arrayElement,DA.prototype._setValue_arrayElement_setNeedsUpdate,DA.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[DA.prototype._setValue_fromArray,DA.prototype._setValue_fromArray_setNeedsUpdate,DA.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var zA=class{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.blendMode;this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;let i=e.tracks,s=i.length,o=new Array(s),a={endingStart:Wx,endingEnd:Wx};for(let l=0;l!==s;++l){let t=i[l].createInterpolant(null);o[l]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){let n=this._clip.duration,r=t._clip.duration,i=r/n,s=n/r;t.warp(1,i,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){let t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){let r=this._mixer,i=r.time,s=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);let a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){let t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,r){if(!this.enabled)return void this._updateWeight(t);let i=this._startTime;if(null!==i){let r=(t-i)*n;r<0||0===n?e=0:(this._startTime=null,e=n*r)}e*=this._updateTimeScale(t);let s=this._updateTime(e),o=this._updateWeight(t);if(o>0){let t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulateAdditive(o);else for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulate(r,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;let n=this._weightInterpolant;if(null!==n){let r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;let n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){let e=this._clip.duration,n=this.loop,r=this.time+t,i=this._loopCount,s=2202===n;if(0===t)return-1===i?r:s&&1===(1&i)?e-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=e||r<0){let n=Math.floor(r/e);r-=e*n,i+=Math.abs(n);let o=this.repetitions-i;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){let e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(s&&1===(1&i))return e-r}return r}_setEndings(t,e,n){let r=this._interpolantSettings;n?(r.endingStart=Gx,r.endingEnd=Gx):(r.endingStart=t?this.zeroSlopeAtStart?Gx:Wx:qx,r.endingEnd=e?this.zeroSlopeAtEnd?Gx:Wx:qx)}_scheduleFading(t,e,n){let r=this._mixer,i=r.time,s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let o=s.parameterPositions,a=s.sampleValues;return o[0]=i,a[0]=e,o[1]=i+t,a[1]=n,this}},UA=new Float32Array(1),FA=class extends sw{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){let n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName,c=l[a];void 0===c&&(c={},l[a]=c);for(let u=0;u!==i;++u){let t=r[u],i=t.name,l=c[i];if(void 0!==l)++l.referenceCount,s[u]=l;else{if(l=s[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,i));continue}let r=e&&e._propertyBindings[u].binding.parsedPath;l=new EA(DA.create(n,i,r),t.ValueTypeName,t.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,i),s[u]=l}o[u].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){let e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}let e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){let n=e[t];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){let e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){let n=e[t];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){let e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){let r=this._actions,i=this._actionsByClip,s=i[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=s;else{let e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){let e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;let i=t._clip.uuid,s=this._actionsByClip,o=s[i],a=o.knownActions,l=a[a.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[i],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){let e=t._propertyBindings;for(let n=0,r=e.length;n!==r;++n){let t=e[n];0===--t.referenceCount&&this._removeInactiveBinding(t)}}_lendAction(t){let e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackAction(t){let e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_addInactiveBinding(t,e,n){let r=this._bindingsByRootAndName,i=this._bindings,s=r[e];void 0===s&&(s={},r[e]=s),s[n]=t,t._cacheIndex=i.length,i.push(t)}_removeInactiveBinding(t){let e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,s=this._bindingsByRootAndName,o=s[r],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[i],0===Object.keys(o).length&&delete s[r]}_lendBinding(t){let e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_takeBackBinding(t){let e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i}_lendControlInterpolant(){let t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&(n=new VT(new Float32Array(2),new Float32Array(2),1,UA),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){let e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i}clipAction(t,e,n){let r=e||this._root,i=r.uuid,s="string"==typeof t?ZT.findByName(r,t):t,o=null!==s?s.uuid:t,a=this._actionsByClip[o],l=null;if(void 0===n&&(n=null!==s?s.blendMode:$x),void 0!==a){let t=a.actionByRoot[i];if(void 0!==t&&t.blendMode===n)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;let c=new zA(this,s,e,n);return this._bindAction(c,l),this._addInactiveAction(c,o,i),c}existingAction(t,e){let n=e||this._root,r=n.uuid,i="string"==typeof t?ZT.findByName(n,t):t,s=i?i.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[r]||null}stopAllAction(){let t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;let e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),s=this._accuIndex^=1;for(let l=0;l!==n;++l)e[l]._update(r,t,i,s);let o=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)o[l].apply(s);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){let e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){let t=i.knownActions;for(let n=0,r=t.length;n!==r;++n){let r=t[n];this._deactivateAction(r);let i=r._cacheIndex,s=e[e.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,s._cacheIndex=i,e[i]=s,e.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(t){let e=t.uuid,n=this._actionsByClip;for(let i in n){let t=n[i].actionByRoot[e];void 0!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}let r=this._bindingsByRootAndName[e];if(void 0!==r)for(let i in r){let t=r[i];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(t,e){let n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}},BA=new mS,VA=class{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new fS(t,e),this.near=n,this.far=r,this.camera=null,this.layers=new TS,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return BA.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(BA),this}intersectObject(t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return jA(t,this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),e.sort(HA),e}intersectObjects(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let r=0,i=t.length;r<i;r++)jA(t[r],this,n,e);return n.sort(HA),n}};function HA(t,e){return t.distance-e.distance}function jA(t,e,n,r){let i=!0;if(t.layers.test(e.layers)&&!1===t.raycast(e,n)&&(i=!1),!0===i&&!0===r){let r=t.children;for(let t=0,i=r.length;t<i;t++)jA(r[t],e,n,!0)}}var WA=new Fw,GA=new Fw,qA=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fw,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fw;this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){WA.subVectors(t,this.start),GA.subVectors(this.end,this.start);let n=GA.dot(GA),r=GA.dot(WA)/n;return e&&(r=hw(r,0,1)),r}closestPointToPoint(t,e,n){let r=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"167"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="167");var $A=Math.pow(2,-24),XA=Symbol("SKIP_GENERATION");function JA(t){return function(t){return t.index?t.index.count:t.attributes.position.count}(t)/3}function YA(t,e){if(!t.index){let n=t.attributes.position.count,r=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ArrayBuffer;return t>65535?new Uint32Array(new e(4*t)):new Uint16Array(new e(2*t))}(n,e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);t.setIndex(new hM(r,1));for(let t=0;t<n;t++)r[t]=t}}function ZA(t){let e=JA(t),n=t.drawRange,r=n.start/3,i=(n.start+n.count)/3,s=Math.max(0,r),o=Math.min(e,i)-s;return[{offset:Math.floor(s),count:Math.floor(o)}]}function KA(t){if(!t.groups||!t.groups.length)return ZA(t);let e=[],n=new Set,r=t.drawRange,i=r.start/3,s=(r.start+r.count)/3;for(let a of t.groups){let t=a.start/3,e=(a.start+a.count)/3;n.add(Math.max(i,t)),n.add(Math.min(s,e))}let o=Array.from(n.values()).sort(((t,e)=>t-e));for(let a=0;a<o.length-1;a++){let t=o[a],n=o[a+1];e.push({offset:Math.floor(t),count:Math.floor(n-t)})}return e}function QA(t,e,n,r,i){let s=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0;for(let v=6*e,y=6*(e+n);v<y;v+=6){let e=t[v+0],n=t[v+1],r=e-n,i=e+n;r<s&&(s=r),i>l&&(l=i),e<h&&(h=e),e>f&&(f=e);let y=t[v+2],_=t[v+3],b=y-_,x=y+_;b<o&&(o=b),x>c&&(c=x),y<d&&(d=y),y>m&&(m=y);let w=t[v+4],S=t[v+5],M=w-S,E=w+S;M<a&&(a=M),E>u&&(u=E),w<p&&(p=w),w>g&&(g=w)}r[0]=s,r[1]=o,r[2]=a,r[3]=l,r[4]=c,r[5]=u,i[0]=h,i[1]=d,i[2]=p,i[3]=f,i[4]=m,i[5]=g}function tC(t,e,n){return n.min.x=e[t],n.min.y=e[t+1],n.min.z=e[t+2],n.max.x=e[t+3],n.max.y=e[t+4],n.max.z=e[t+5],n}function eC(t){let e=-1,n=-1/0;for(let r=0;r<3;r++){let i=t[r+3]-t[r];i>n&&(n=i,e=r)}return e}function nC(t,e){e.set(t)}function rC(t,e,n){let r,i;for(let s=0;s<3;s++){let o=s+3;r=t[s],i=e[s],n[s]=r<i?r:i,r=t[o],i=e[o],n[o]=r>i?r:i}}function iC(t,e,n){for(let r=0;r<3;r++){let i=e[t+2*r],s=e[t+2*r+1],o=i-s,a=i+s;o<n[r]&&(n[r]=o),a>n[r+3]&&(n[r+3]=a)}}function sC(t){let e=t[3]-t[0],n=t[4]-t[1],r=t[5]-t[2];return 2*(e*n+n*r+r*e)}var oC=32,aC=(t,e)=>t.candidate-e.candidate,lC=new Array(oC).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),cC=new Float32Array(6);var uC=class{constructor(){this.boundingData=new Float32Array(6)}};function hC(t,e,n,r,i,s){let o=r,a=r+i-1,l=s.pos,c=2*s.axis;for(;;){for(;o<=a&&n[6*o+c]<l;)o++;for(;o<=a&&n[6*a+c]>=l;)a--;if(!(o<a))return o;for(let t=0;t<3;t++){let n=e[3*o+t];e[3*o+t]=e[3*a+t],e[3*a+t]=n}for(let t=0;t<6;t++){let e=n[6*o+t];n[6*o+t]=n[6*a+t],n[6*a+t]=e}o++,a--}}function dC(t,e,n,r,i,s){let o=r,a=r+i-1,l=s.pos,c=2*s.axis;for(;;){for(;o<=a&&n[6*o+c]<l;)o++;for(;o<=a&&n[6*a+c]>=l;)a--;if(!(o<a))return o;{let e=t[o];t[o]=t[a],t[a]=e;for(let t=0;t<6;t++){let e=n[6*o+t];n[6*o+t]=n[6*a+t],n[6*a+t]=e}o++,a--}}}function pC(t,e){return 65535===e[t+15]}function fC(t,e){return e[t+6]}function mC(t,e){return e[t+14]}function gC(t){return t+8}function vC(t,e){return e[t+6]}function yC(t,e){return e[t+7]}var _C,bC,xC,wC,SC=Math.pow(2,32);function MC(t){return"count"in t?1:1+MC(t.left)+MC(t.right)}function EC(t,e,n){return _C=new Float32Array(n),bC=new Uint32Array(n),xC=new Uint16Array(n),wC=new Uint8Array(n),TC(t,e)}function TC(t,e){let n=t/4,r=t/2,i="count"in e,s=e.boundingData;for(let o=0;o<6;o++)_C[n+o]=s[o];if(i){if(e.buffer){let r=e.buffer;wC.set(new Uint8Array(r),t);for(let e=t,i=t+r.byteLength;e<i;e+=32){pC(e/2,xC)||(bC[e/4+6]+=n)}return t+r.byteLength}{let i=e.offset,s=e.count;return bC[n+6]=i,xC[r+14]=s,xC[r+15]=65535,t+32}}{let r,i=e.left,s=e.right,o=e.splitAxis;if(r=TC(t+32,i),r/4>SC)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return bC[n+6]=r/4,r=TC(r,s),bC[n+7]=o,r}}function AC(t,e,n,r,i){let{maxDepth:s,verbose:o,maxLeafTris:a,strategy:l,onProgress:c,indirect:u}=i,h=t._indirectBuffer,d=t.geometry,p=d.index?d.index.array:null,f=u?dC:hC,m=JA(d),g=new Float32Array(6),v=!1,y=new uC;return QA(e,n,r,y.boundingData,g),function t(n,r,i){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!v&&u>=s&&(v=!0,o&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(d))),i<=a||u>=s)return _(r+i),n.offset=r,n.count=i,n;let m=function(t,e,n,r,i,s){let o=-1,a=0;if(0===s)o=eC(e),-1!==o&&(a=(e[o]+e[o+3])/2);else if(1===s)o=eC(t),-1!==o&&(a=function(t,e,n,r){let i=0;for(let s=e,o=e+n;s<o;s++)i+=t[6*s+2*r];return i/n}(n,r,i,o));else if(2===s){let s=sC(t),l=1.25*i,c=6*r,u=6*(r+i);for(let t=0;t<3;t++){let r=e[t],h=(e[t+3]-r)/oC;if(i<8){let e=[...lC];e.length=i;let r=0;for(let i=c;i<u;i+=6,r++){let s=e[r];s.candidate=n[i+2*t],s.count=0;let{bounds:o,leftCacheBounds:a,rightCacheBounds:l}=s;for(let t=0;t<3;t++)l[t]=1/0,l[t+3]=-1/0,a[t]=1/0,a[t+3]=-1/0,o[t]=1/0,o[t+3]=-1/0;iC(i,n,o)}e.sort(aC);let h=i;for(let t=0;t<h;t++){let n=e[t];for(;t+1<h&&e[t+1].candidate===n.candidate;)e.splice(t+1,1),h--}for(let i=c;i<u;i+=6){let r=n[i+2*t];for(let t=0;t<h;t++){let s=e[t];r>=s.candidate?iC(i,n,s.rightCacheBounds):(iC(i,n,s.leftCacheBounds),s.count++)}}for(let n=0;n<h;n++){let r=e[n],c=r.count,u=i-r.count,h=r.leftCacheBounds,d=r.rightCacheBounds,p=0;0!==c&&(p=sC(h)/s);let f=0;0!==u&&(f=sC(d)/s);let m=1+1.25*(p*c+f*u);m<l&&(o=t,l=m,a=r.candidate)}}else{for(let t=0;t<oC;t++){let e=lC[t];e.count=0,e.candidate=r+h+t*h;let n=e.bounds;for(let t=0;t<3;t++)n[t]=1/0,n[t+3]=-1/0}for(let i=c;i<u;i+=6){let e=~~((n[i+2*t]-r)/h);e>=oC&&(e=31);let s=lC[e];s.count++,iC(i,n,s.bounds)}let e=lC[31];nC(e.bounds,e.rightCacheBounds);for(let t=30;t>=0;t--){let e=lC[t],n=lC[t+1];rC(e.bounds,n.rightCacheBounds,e.rightCacheBounds)}let d=0;for(let n=0;n<31;n++){let e=lC[n],r=e.count,c=e.bounds,u=lC[n+1].rightCacheBounds;0!==r&&(0===d?nC(c,cC):rC(c,cC,cC)),d+=r;let h=0,p=0;0!==d&&(h=sC(cC)/s);let f=i-d;0!==f&&(p=sC(u)/s);let m=1+1.25*(h*d+p*f);m<l&&(o=t,l=m,a=e.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}(n.boundingData,c,e,r,i,l);if(-1===m.axis)return _(r+i),n.offset=r,n.count=i,n;let y=f(h,p,e,r,i,m);if(y===r||y===r+i)_(r+i),n.offset=r,n.count=i;else{n.splitAxis=m.axis;let s=new uC,o=r,a=y-r;n.left=s,QA(e,o,a,s.boundingData,g),t(s,o,a,g,u+1);let l=new uC,c=y,h=i-a;n.right=l,QA(e,c,h,l.boundingData,g),t(l,c,h,g,u+1)}return n}(y,n,r,g),y;function _(t){c&&c(t/m)}}function CC(t,e){let n=t.geometry;e.indirect&&(t._indirectBuffer=function(t,e){let n=(t.index?t.index.count:t.attributes.position.count)/3,r=n>65536,i=r?4:2,s=e?new SharedArrayBuffer(n*i):new ArrayBuffer(n*i),o=r?new Uint32Array(s):new Uint16Array(s);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}(n,e.useSharedArrayBuffer),function(t){if(0===t.groups.length)return!1;let e=JA(t),n=KA(t).sort(((t,e)=>t.offset-e.offset)),r=n[n.length-1];r.count=Math.min(e-r.offset,r.count);let i=0;return n.forEach((t=>{let{count:e}=t;return i+=e})),e!==i}(n)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),t._indirectBuffer||YA(n,e);let r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=function(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=t.attributes.position,o=t.index?t.index.array:null,a=JA(t),l=s.normalized;null===n?(e=new Float32Array(6*a*4),r=0,i=a):(e=n,r=r||0,i=i||a);let c=s.array,u=s.offset||0,h=3;s.isInterleavedBufferAttribute&&(h=s.data.stride);let d=["getX","getY","getZ"];for(let p=r;p<r+i;p++){let t=3*p,n=6*p,r=t+0,i=t+1,a=t+2;o&&(r=o[r],i=o[i],a=o[a]),l||(r=r*h+u,i=i*h+u,a=a*h+u);for(let o=0;o<3;o++){let t,u,h;l?(t=s[d[o]](r),u=s[d[o]](i),h=s[d[o]](a)):(t=c[r+o],u=c[i+o],h=c[a+o]);let p=t;u<p&&(p=u),h<p&&(p=h);let f=t;u>f&&(f=u),h>f&&(f=h);let m=(f-p)/2,g=2*o;e[n+g+0]=p+m,e[n+g+1]=m+(Math.abs(p)+m)*$A}}return e}(n),s=e.indirect?ZA(n):KA(n);t._roots=s.map((n=>{let s=AC(t,i,n.offset,n.count,e),o=MC(s),a=new r(32*o);return EC(0,s,a),a}))}var PC=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let n=1/0,r=-1/0;for(let i=0,s=t.length;i<s;i++){let s=t[i][e];n=s<n?s:n,r=s>r?s:r}this.min=n,this.max=r}setFromPoints(t,e){let n=1/0,r=-1/0;for(let i=0,s=e.length;i<s;i++){let s=e[i],o=t.dot(s);n=o<n?o:n,r=o>r?o:r}this.min=n,this.max=r}isSeparated(t){return this.min>t.max||t.min>this.max}};PC.prototype.setFromBox=function(){let t=new Fw;return function(e,n){let r=n.min,i=n.max,s=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let n=0;n<=1;n++)for(let l=0;l<=1;l++){t.x=r.x*a+i.x*(1-a),t.y=r.y*n+i.y*(1-n),t.z=r.z*l+i.z*(1-l);let c=e.dot(t);s=Math.min(c,s),o=Math.max(c,o)}this.min=s,this.max=o}}();var IC=function(){let t=new Fw,e=new Fw,n=new Fw;return function(r,i,s){let o=r.start,a=t,l=i.start,c=e;n.subVectors(o,l),t.subVectors(r.end,r.start),e.subVectors(i.end,i.start);let u,h,d=n.dot(c),p=c.dot(a),f=c.dot(c),m=n.dot(a),g=a.dot(a)*f-p*p;u=0!==g?(d*p-m*f)/g:0,h=(d+u*p)/f,s.x=u,s.y=h}}(),RC=function(){let t=new vw,e=new Fw,n=new Fw;return function(r,i,s,o){IC(r,i,t);let a=t.x,l=t.y;if(a>=0&&a<=1&&l>=0&&l<=1)return r.at(a,s),void i.at(l,o);if(a>=0&&a<=1)return l<0?i.at(0,o):i.at(1,o),void r.closestPointToPoint(o,!0,s);if(l>=0&&l<=1)return a<0?r.at(0,s):r.at(1,s),void i.closestPointToPoint(s,!0,o);{let t,c;t=a<0?r.start:r.end,c=l<0?i.start:i.end;let u=e,h=n;return r.closestPointToPoint(c,!0,e),i.closestPointToPoint(t,!0,n),u.distanceToSquared(c)<=h.distanceToSquared(t)?(s.copy(u),void o.copy(c)):(s.copy(t),void o.copy(h))}}}(),LC=function(){let t=new Fw,e=new Fw,n=new KM,r=new qA;return function(i,s){let{radius:o,center:a}=i,{a:l,b:c,c:u}=s;if(r.start=l,r.end=c,r.closestPointToPoint(a,!0,t).distanceTo(a)<=o||(r.start=l,r.end=u,r.closestPointToPoint(a,!0,t).distanceTo(a)<=o)||(r.start=c,r.end=u,r.closestPointToPoint(a,!0,t).distanceTo(a)<=o))return!0;let h=s.getPlane(n);if(Math.abs(h.distanceToPoint(a))<=o){let t=h.projectPoint(a,e);if(s.containsPoint(t))return!0}return!1}}();function NC(t){return Math.abs(t)<1e-15}var OC=class extends QS{constructor(){super(...arguments),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new Fw)),this.satBounds=new Array(4).fill().map((()=>new PC)),this.points=[this.a,this.b,this.c],this.sphere=new oS,this.plane=new KM,this.needsUpdate=!0}intersectsSphere(t){return LC(t,this)}update(){let t=this.a,e=this.b,n=this.c,r=this.points,i=this.satAxes,s=this.satBounds,o=i[0],a=s[0];this.getNormal(o),a.setFromPoints(o,r);let l=i[1],c=s[1];l.subVectors(t,e),c.setFromPoints(l,r);let u=i[2],h=s[2];u.subVectors(e,n),h.setFromPoints(u,r);let d=i[3],p=s[3];d.subVectors(n,t),p.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,t),this.needsUpdate=!1}};OC.prototype.closestPointToSegment=function(){let t=new Fw,e=new Fw,n=new qA;return function(r){let i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,{start:a,end:l}=r,c=this.points,u=1/0;for(let h=0;h<3;h++){let a=(h+1)%3;n.start.copy(c[h]),n.end.copy(c[a]),RC(n,r,t,e),i=t.distanceToSquared(e),i<u&&(u=i,s&&s.copy(t),o&&o.copy(e))}return this.closestPointToPoint(a,t),i=a.distanceToSquared(t),i<u&&(u=i,s&&s.copy(t),o&&o.copy(a)),this.closestPointToPoint(l,t),i=l.distanceToSquared(t),i<u&&(u=i,s&&s.copy(t),o&&o.copy(l)),Math.sqrt(u)}}(),OC.prototype.intersectsTriangle=function(){let t=new OC,e=new Array(3),n=new Array(3),r=new PC,i=new PC,s=new Fw,o=new Fw,a=new Fw,l=new Fw,c=new Fw,u=new qA,h=new qA,d=new qA,p=new Fw;function f(t,e,n){let r=t.points,i=0,s=-1;for(let a=0;a<3;a++){let{start:t,end:l}=u;t.copy(r[a]),l.copy(r[(a+1)%3]),u.delta(o);let c=NC(e.distanceToPoint(t));if(NC(e.normal.dot(o))&&c){n.copy(u),i=2;break}let h=e.intersectLine(u,p);if(!h&&c&&p.copy(t),(h||c)&&!NC(p.distanceTo(l))){if(i<=1)(1===i?n.start:n.end).copy(p),c&&(s=i);else if(i>=2){(1===s?n.start:n.end).copy(p),i=2;break}if(i++,2===i&&-1===s)break}}return i}return function(o){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(t.copy(o),t.update(),o=t);let m=this.plane,g=o.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let t=this.satBounds,a=this.satAxes;n[0]=o.a,n[1]=o.b,n[2]=o.c;for(let e=0;e<4;e++){let i=t[e],s=a[e];if(r.setFromPoints(s,n),i.isSeparated(r))return!1}let l=o.satBounds,c=o.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let n=0;n<4;n++){let t=l[n],i=c[n];if(r.setFromPoints(i,e),t.isSeparated(r))return!1}for(let o=0;o<4;o++){let t=a[o];for(let o=0;o<4;o++){let a=c[o];if(s.crossVectors(t,a),r.setFromPoints(s,e),i.setFromPoints(s,n),r.isSeparated(i))return!1}}return u&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),u.start.set(0,0,0),u.end.set(0,0,0)),!0}{let t=f(this,g,h);if(1===t&&o.containsPoint(h.end))return u&&(u.start.copy(h.end),u.end.copy(h.end)),!0;if(2!==t)return!1;let e=f(o,m,d);if(1===e&&this.containsPoint(d.end))return u&&(u.start.copy(d.end),u.end.copy(d.end)),!0;if(2!==e)return!1;if(h.delta(a),d.delta(l),a.dot(l)<0){let t=d.start;d.start=d.end,d.end=t}let n=h.start.dot(a),r=h.end.dot(a),i=d.start.dot(a),s=d.end.dot(a);return(n===s||i===r||r<i!==n<s)&&(u&&(c.subVectors(h.start,d.start),c.dot(a)>0?u.start.copy(h.start):u.start.copy(d.start),c.subVectors(h.end,d.end),c.dot(a)<0?u.end.copy(h.end):u.end.copy(d.end)),!0)}}}(),OC.prototype.distanceToPoint=function(){let t=new Fw;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),OC.prototype.distanceToTriangle=function(){let t=new Fw,e=new Fw,n=["a","b","c"],r=new qA,i=new qA;return function(s){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=o||a?r:null;if(this.intersectsTriangle(s,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let e=0;e<3;e++){let r,i=n[e],l=s[i];this.closestPointToPoint(l,t),r=l.distanceToSquared(t),r<c&&(c=r,o&&o.copy(t),a&&a.copy(l));let u=this[i];s.closestPointToPoint(u,t),r=u.distanceToSquared(t),r<c&&(c=r,o&&o.copy(u),a&&a.copy(t))}for(let u=0;u<3;u++){let l=n[u],h=n[(u+1)%3];r.set(this[l],this[h]);for(let u=0;u<3;u++){let l=n[u],h=n[(u+1)%3];i.set(s[l],s[h]),RC(r,i,t,e);let d=t.distanceToSquared(e);d<c&&(c=d,o&&o.copy(t),a&&a.copy(e))}}return Math.sqrt(c)}}();var kC=class{constructor(t,e,n){this.isOrientedBox=!0,this.min=new Fw,this.max=new Fw,this.matrix=new mS,this.invMatrix=new mS,this.points=new Array(8).fill().map((()=>new Fw)),this.satAxes=new Array(3).fill().map((()=>new Fw)),this.satBounds=new Array(3).fill().map((()=>new PC)),this.alignedSatBounds=new Array(3).fill().map((()=>new PC)),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),n&&this.matrix.copy(n)}set(t,e,n){this.min.copy(t),this.max.copy(e),this.matrix.copy(n),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};kC.prototype.update=function(){return function(){let t=this.matrix,e=this.min,n=this.max,r=this.points;for(let l=0;l<=1;l++)for(let i=0;i<=1;i++)for(let s=0;s<=1;s++){let o=r[1*l|2*i|4*s];o.x=l?n.x:e.x,o.y=i?n.y:e.y,o.z=s?n.z:e.z,o.applyMatrix4(t)}let i=this.satBounds,s=this.satAxes,o=r[0];for(let l=0;l<3;l++){let t=s[l],e=i[l],n=r[1<<l];t.subVectors(o,n),e.setFromPoints(t,r)}let a=this.alignedSatBounds;a[0].setFromPointsField(r,"x"),a[1].setFromPointsField(r,"y"),a[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}(),kC.prototype.intersectsBox=function(){let t=new PC;return function(e){this.needsUpdate&&this.update();let n=e.min,r=e.max,i=this.satBounds,s=this.satAxes,o=this.alignedSatBounds;if(t.min=n.x,t.max=r.x,o[0].isSeparated(t)||(t.min=n.y,t.max=r.y,o[1].isSeparated(t))||(t.min=n.z,t.max=r.z,o[2].isSeparated(t)))return!1;for(let a=0;a<3;a++){let n=s[a],r=i[a];if(t.setFromBox(n,e),r.isSeparated(t))return!1}return!0}}(),kC.prototype.intersectsTriangle=function(){let t=new OC,e=new Array(3),n=new PC,r=new PC,i=new Fw;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(t.copy(s),t.update(),s=t);let o=this.satBounds,a=this.satAxes;e[0]=s.a,e[1]=s.b,e[2]=s.c;for(let t=0;t<3;t++){let r=o[t],i=a[t];if(n.setFromPoints(i,e),r.isSeparated(n))return!1}let l=s.satBounds,c=s.satAxes,u=this.points;for(let t=0;t<3;t++){let e=l[t],r=c[t];if(n.setFromPoints(r,u),e.isSeparated(n))return!1}for(let t=0;t<3;t++){let s=a[t];for(let t=0;t<4;t++){let o=c[t];if(i.crossVectors(s,o),n.setFromPoints(i,e),r.setFromPoints(i,u),n.isSeparated(r))return!1}}return!0}}(),kC.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}(),kC.prototype.distanceToPoint=function(){let t=new Fw;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),kC.prototype.distanceToBox=function(){let t=["x","y","z"],e=new Array(12).fill().map((()=>new qA)),n=new Array(12).fill().map((()=>new qA)),r=new Fw,i=new Fw;return function(s){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(a||l)&&(s.getCenter(i),this.closestPointToPoint(i,r),s.closestPointToPoint(r,i),a&&a.copy(r),l&&l.copy(i)),0;let c=o*o,u=s.min,h=s.max,d=this.points,p=1/0;for(let t=0;t<8;t++){let e=d[t];i.copy(e).clamp(u,h);let n=e.distanceToSquared(i);if(n<p&&(p=n,a&&a.copy(e),l&&l.copy(i),n<c))return Math.sqrt(n)}let f=0;for(let r=0;r<3;r++)for(let i=0;i<=1;i++)for(let s=0;s<=1;s++){let o=(r+1)%3,a=(r+2)%3,l=1<<r|i<<o|s<<a,c=d[i<<o|s<<a],p=d[l];e[f].set(c,p);let m=t[r],g=t[o],v=t[a],y=n[f],_=y.start,b=y.end;_[m]=u[m],_[g]=i?u[g]:h[g],_[v]=s?u[v]:h[g],b[m]=h[m],b[g]=i?u[g]:h[g],b[v]=s?u[v]:h[g],f++}for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let n=0;n<=1;n++){i.x=t?h.x:u.x,i.y=e?h.y:u.y,i.z=n?h.z:u.z,this.closestPointToPoint(i,r);let s=i.distanceToSquared(r);if(s<p&&(p=s,a&&a.copy(r),l&&l.copy(i),s<c))return Math.sqrt(s)}for(let t=0;t<12;t++){let s=e[t];for(let t=0;t<12;t++){let e=n[t];RC(s,e,r,i);let o=r.distanceToSquared(i);if(o<p&&(p=o,a&&a.copy(r),l&&l.copy(i),o<c))return Math.sqrt(o)}}return Math.sqrt(p)}}();var DC,zC,UC=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){let t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}},FC=new class extends UC{constructor(){super((()=>new OC))}},BC=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;let t=[],e=null;this.setBuffer=n=>{e&&t.push(e),e=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==t.length&&this.setBuffer(t.pop())}}},VC=[],HC=new UC((()=>new Hw));function jC(t,e,n,r,i,s){DC=HC.getPrimitive(),zC=HC.getPrimitive(),VC.push(DC,zC),BC.setBuffer(t._roots[e]);let o=WC(0,t.geometry,n,r,i,s);BC.clearBuffer(),HC.releasePrimitive(DC),HC.releasePrimitive(zC),VC.pop(),VC.pop();let a=VC.length;return a>0&&(zC=VC[a-1],DC=VC[a-2]),o}function WC(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,{float32Array:a,uint16Array:l,uint32Array:c}=BC,u=2*t;if(pC(u,l)){let e=fC(t,c),n=mC(u,l);return tC(t,a,DC),r(e,n,!1,o,s+t,DC)}{let u,h,d,p,f=function(t){let{uint16Array:e,uint32Array:n}=BC,r=2*t;for(;!pC(r,e);)r=2*(t=gC(t));return fC(t,n)},m=function(t){let{uint16Array:e,uint32Array:n}=BC,r=2*t;for(;!pC(r,e);)r=2*(t=vC(t,n));return fC(t,n)+mC(r,e)},g=gC(t),v=vC(t,c),y=g,_=v;if(i&&(d=DC,p=zC,tC(y,a,d),tC(_,a,p),u=i(d),h=i(p),h<u)){y=v,_=g;let t=u;u=h,h=t,d=p}d||(d=DC,tC(y,a,d));let b,x=n(d,pC(2*y,l),u,o+1,s+y);if(2===x){let t=f(y);b=r(t,m(y)-t,!0,o+1,s+y,d)}else b=x&&WC(y,e,n,r,i,s,o+1);if(b)return!0;p=zC,tC(_,a,p);let w,S=n(p,pC(2*_,l),h,o+1,s+_);if(2===S){let t=f(_);w=r(t,m(_)-t,!0,o+1,s+_,p)}else w=S&&WC(_,e,n,r,i,s,o+1);return!!w}}var GC=new Fw,qC=new Fw;var $C=new Fw,XC=new Fw,JC=new Fw,YC=new vw,ZC=new vw,KC=new vw,QC=new Fw,tP=new Fw,eP=new Fw,nP=new Fw;function rP(t,e,n,r,i,s,o){let a=3*r,l=a+0,c=a+1,u=a+2,h=t.index;t.index&&(l=h.getX(l),c=h.getX(c),u=h.getX(u));let{position:d,normal:p,uv:f,uv1:m}=t.attributes,g=function(t,e,n,r,i,s,o,a,l,c,u){$C.fromBufferAttribute(e,s),XC.fromBufferAttribute(e,o),JC.fromBufferAttribute(e,a);let h=function(t,e,n,r,i,s,o,a){let l;if(l=1===s?t.intersectTriangle(r,n,e,!0,i):t.intersectTriangle(e,n,r,2!==s,i),null===l)return null;let c=t.origin.distanceTo(i);return c<o||c>a?null:{distance:c,point:i.clone()}}(t,$C,XC,JC,nP,l,c,u);if(h){r&&(YC.fromBufferAttribute(r,s),ZC.fromBufferAttribute(r,o),KC.fromBufferAttribute(r,a),h.uv=QS.getInterpolation(nP,$C,XC,JC,YC,ZC,KC,new vw)),i&&(YC.fromBufferAttribute(i,s),ZC.fromBufferAttribute(i,o),KC.fromBufferAttribute(i,a),h.uv1=QS.getInterpolation(nP,$C,XC,JC,YC,ZC,KC,new vw)),n&&(QC.fromBufferAttribute(n,s),tP.fromBufferAttribute(n,o),eP.fromBufferAttribute(n,a),h.normal=QS.getInterpolation(nP,$C,XC,JC,QC,tP,eP,new Fw),h.normal.dot(t.direction)>0&&h.normal.multiplyScalar(-1));let e={a:s,b:o,c:a,normal:new Fw,materialIndex:0};QS.getNormal($C,XC,JC,e.normal),h.face=e,h.faceIndex=s}return h}(n,d,p,f,m,l,c,u,e,s,o);return g?(g.faceIndex=r,i&&i.push(g),g):null}function iP(t,e,n,r){let i=t.a,s=t.b,o=t.c,a=e,l=e+1,c=e+2;n&&(a=n.getX(a),l=n.getX(l),c=n.getX(c)),i.x=r.getX(a),i.y=r.getY(a),i.z=r.getZ(a),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),o.x=r.getX(c),o.y=r.getY(c),o.z=r.getZ(c)}function sP(t,e,n,r,i,s,o){let{geometry:a}=n,{index:l}=a,c=a.attributes.position;for(let u=t,h=e+t;u<h;u++){let t;if(t=u,iP(o,3*t,l,c),o.needsUpdate=!0,r(o,t,i,s))return!0}return!1}function oP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&Array.isArray(e)&&(e=new Set(e));let n,r,i,s,o=t.geometry,a=o.index?o.index.array:null,l=o.attributes.position,c=0,u=t._roots;for(let d=0,p=u.length;d<p;d++)n=u[d],r=new Uint32Array(n),i=new Uint16Array(n),s=new Float32Array(n),h(0,c),c+=n.byteLength;function h(t,n){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=2*t;if(65535===i[c+15]){let e=r[t+6],n=1/0,o=1/0,u=1/0,h=-1/0,d=-1/0,p=-1/0;for(let t=3*e,r=3*(e+i[c+14]);t<r;t++){let e=a[t],r=l.getX(e),i=l.getY(e),s=l.getZ(e);r<n&&(n=r),r>h&&(h=r),i<o&&(o=i),i>d&&(d=i),s<u&&(u=s),s>p&&(p=s)}return(s[t+0]!==n||s[t+1]!==o||s[t+2]!==u||s[t+3]!==h||s[t+4]!==d||s[t+5]!==p)&&(s[t+0]=n,s[t+1]=o,s[t+2]=u,s[t+3]=h,s[t+4]=d,s[t+5]=p,!0)}{let i=t+8,a=r[t+6],l=i+n,c=a+n,u=o,d=!1,p=!1;e?u||(d=e.has(l),p=e.has(c),u=!d&&!p):(d=!0,p=!0);let f=u||p,m=!1;(u||d)&&(m=h(i,n,u));let g=!1;f&&(g=h(a,n,u));let v=m||g;if(v)for(let e=0;e<3;e++){let n=i+e,r=a+e,o=s[n],l=s[n+3],c=s[r],u=s[r+3];s[t+e]=o<c?o:c,s[t+e+3]=l>u?l:u}return v}}}function aP(t,e,n,r,i){let s,o,a,l,c,u,h=1/n.direction.x,d=1/n.direction.y,p=1/n.direction.z,f=n.origin.x,m=n.origin.y,g=n.origin.z,v=e[t],y=e[t+3],_=e[t+1],b=e[t+3+1],x=e[t+2],w=e[t+3+2];return h>=0?(s=(v-f)*h,o=(y-f)*h):(s=(y-f)*h,o=(v-f)*h),d>=0?(a=(_-m)*d,l=(b-m)*d):(a=(b-m)*d,l=(_-m)*d),!(s>l||a>o||((a>s||isNaN(s))&&(s=a),(l<o||isNaN(o))&&(o=l),p>=0?(c=(x-g)*p,u=(w-g)*p):(c=(w-g)*p,u=(x-g)*p),s>u||c>o))&&((c>s||s!==s)&&(s=c),(u<o||o!==o)&&(o=u),s<=i&&o>=r)}function lP(t,e,n,r,i,s,o){let{geometry:a}=n,{index:l}=a,c=a.attributes.position;for(let u=t,h=e+t;u<h;u++){let t;if(t=n.resolveTriangleIndex(u),iP(o,3*t,l,c),o.needsUpdate=!0,r(o,t,i,s))return!0}return!1}function cP(t,e,n,r,i,s,o){BC.setBuffer(t._roots[e]),uP(0,t,n,r,i,s,o),BC.clearBuffer()}function uP(t,e,n,r,i,s,o){let{float32Array:a,uint16Array:l,uint32Array:c}=BC,u=2*t;if(pC(u,l)){!function(t,e,n,r,i,s,o,a){let{geometry:l,_indirectBuffer:c}=t;for(let u=r,h=r+i;u<h;u++)rP(l,e,n,u,s,o,a)}(e,n,r,fC(t,c),mC(u,l),i,s,o)}else{let l=gC(t);aP(l,a,r,s,o)&&uP(l,e,n,r,i,s,o);let u=vC(t,c);aP(u,a,r,s,o)&&uP(u,e,n,r,i,s,o)}}var hP=["x","y","z"];function dP(t,e,n,r,i,s){BC.setBuffer(t._roots[e]);let o=pP(0,t,n,r,i,s);return BC.clearBuffer(),o}function pP(t,e,n,r,i,s){let{float32Array:o,uint16Array:a,uint32Array:l}=BC,c=2*t;if(pC(c,a)){return function(t,e,n,r,i,s,o){let{geometry:a,_indirectBuffer:l}=t,c=1/0,u=null;for(let h=r,d=r+i;h<d;h++){let t;t=rP(a,e,n,h,null,s,o),t&&t.distance<c&&(u=t,c=t.distance)}return u}(e,n,r,fC(t,l),mC(c,a),i,s)}{let a,c,u=yC(t,l),h=hP[u],d=r.direction[h]>=0;d?(a=gC(t),c=vC(t,l)):(a=vC(t,l),c=gC(t));let p=aP(a,o,r,i,s)?pP(a,e,n,r,i,s):null;if(p){let t=p.point[h];if(d?t<=o[c+u]:t>=o[c+u+3])return p}let f=aP(c,o,r,i,s)?pP(c,e,n,r,i,s):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var fP=new Hw,mP=new OC,gP=new OC,vP=new mS,yP=new kC,_P=new kC;function bP(t,e,n,r){BC.setBuffer(t._roots[e]);let i=xP(0,t,n,r);return BC.clearBuffer(),i}function xP(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,{float32Array:s,uint16Array:o,uint32Array:a}=BC,l=2*t;if(null===i&&(n.boundingBox||n.computeBoundingBox(),yP.set(n.boundingBox.min,n.boundingBox.max,r),i=yP),!pC(l,o)){let o=t+8,l=a[t+6];return tC(o,s,fP),!!(i.intersectsBox(fP)&&xP(o,e,n,r,i)||(tC(l,s,fP),i.intersectsBox(fP)&&xP(l,e,n,r,i)))}{let i=e.geometry,c=i.index,u=i.attributes.position,h=n.index,d=n.attributes.position,p=fC(t,a),f=mC(l,o);if(vP.copy(r).invert(),n.boundsTree)return tC(t,s,_P),_P.matrix.copy(vP),_P.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:t=>_P.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(r),t.b.applyMatrix4(r),t.c.applyMatrix4(r),t.needsUpdate=!0;for(let e=3*p,n=3*(f+p);e<n;e+=3)if(iP(gP,e,c,u),gP.needsUpdate=!0,t.intersectsTriangle(gP))return!0;return!1}});for(let t=3*p,e=3*(f+p);t<e;t+=3){iP(mP,t,c,u),mP.a.applyMatrix4(vP),mP.b.applyMatrix4(vP),mP.c.applyMatrix4(vP),mP.needsUpdate=!0;for(let t=0,e=h.count;t<e;t+=3)if(iP(gP,t,h,d),gP.needsUpdate=!0,mP.intersectsTriangle(gP))return!0}}}var wP=new mS,SP=new kC,MP=new kC,EP=new Fw,TP=new Fw,AP=new Fw,CP=new Fw;function PP(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0;e.boundingBox||e.computeBoundingBox(),SP.set(e.boundingBox.min,e.boundingBox.max,n),SP.needsUpdate=!0;let a=t.geometry,l=a.attributes.position,c=a.index,u=e.attributes.position,h=e.index,d=FC.getPrimitive(),p=FC.getPrimitive(),f=EP,m=TP,g=null,v=null;i&&(g=AP,v=CP);let y=1/0,_=null,b=null;return wP.copy(n).invert(),MP.matrix.copy(wP),t.shapecast({boundsTraverseOrder:t=>SP.distanceToBox(t),intersectsBounds:(t,e,n)=>n<y&&n<o&&(e&&(MP.min.copy(t.min),MP.max.copy(t.max),MP.needsUpdate=!0),!0),intersectsRange:(t,r)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:t=>MP.distanceToBox(t),intersectsBounds:(t,e,n)=>n<y&&n<o,intersectsRange:(e,i)=>{for(let o=e,a=e+i;o<a;o++){iP(p,3*o,h,u),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let e=t,n=t+r;e<n;e++){iP(d,3*e,c,l),d.needsUpdate=!0;let t=d.distanceToTriangle(p,f,g);if(t<y&&(m.copy(f),v&&v.copy(g),y=t,_=e,b=o),t<s)return!0}}}});for(let i=0,o=JA(e);i<o;i++){iP(p,3*i,h,u),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let e=t,n=t+r;e<n;e++){iP(d,3*e,c,l),d.needsUpdate=!0;let t=d.distanceToTriangle(p,f,g);if(t<y&&(m.copy(f),v&&v.copy(g),y=t,_=e,b=i),t<s)return!0}}}}),FC.releasePrimitive(d),FC.releasePrimitive(p),y===1/0?null:(r.point?r.point.copy(m):r.point=m.clone(),r.distance=y,r.faceIndex=_,i&&(i.point?i.point.copy(v):i.point=v.clone(),i.point.applyMatrix4(wP),m.applyMatrix4(wP),i.distance=m.sub(i.point).length(),i.faceIndex=b),r)}function IP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&Array.isArray(e)&&(e=new Set(e));let n,r,i,s,o=t.geometry,a=o.index?o.index.array:null,l=o.attributes.position,c=0,u=t._roots;for(let d=0,p=u.length;d<p;d++)n=u[d],r=new Uint32Array(n),i=new Uint16Array(n),s=new Float32Array(n),h(0,c),c+=n.byteLength;function h(n,o){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=2*n;if(65535===i[u+15]){let e=r[n+6],o=1/0,c=1/0,h=1/0,d=-1/0,p=-1/0,f=-1/0;for(let n=e,r=e+i[u+14];n<r;n++){let e=3*t.resolveTriangleIndex(n);for(let t=0;t<3;t++){let n=e+t;n=a?a[n]:n;let r=l.getX(n),i=l.getY(n),s=l.getZ(n);r<o&&(o=r),r>d&&(d=r),i<c&&(c=i),i>p&&(p=i),s<h&&(h=s),s>f&&(f=s)}}return(s[n+0]!==o||s[n+1]!==c||s[n+2]!==h||s[n+3]!==d||s[n+4]!==p||s[n+5]!==f)&&(s[n+0]=o,s[n+1]=c,s[n+2]=h,s[n+3]=d,s[n+4]=p,s[n+5]=f,!0)}{let t=n+8,i=r[n+6],a=t+o,l=i+o,u=c,d=!1,p=!1;e?u||(d=e.has(a),p=e.has(l),u=!d&&!p):(d=!0,p=!0);let f=u||p,m=!1;(u||d)&&(m=h(t,o,u));let g=!1;f&&(g=h(i,o,u));let v=m||g;if(v)for(let e=0;e<3;e++){let r=t+e,o=i+e,a=s[r],l=s[r+3],c=s[o],u=s[o+3];s[n+e]=a<c?a:c,s[n+e+3]=l>u?l:u}return v}}}function RP(t,e,n,r,i,s,o){BC.setBuffer(t._roots[e]),LP(0,t,n,r,i,s,o),BC.clearBuffer()}function LP(t,e,n,r,i,s,o){let{float32Array:a,uint16Array:l,uint32Array:c}=BC,u=2*t;if(pC(u,l)){!function(t,e,n,r,i,s,o,a){let{geometry:l,_indirectBuffer:c}=t;for(let u=r,h=r+i;u<h;u++)rP(l,e,n,c?c[u]:u,s,o,a)}(e,n,r,fC(t,c),mC(u,l),i,s,o)}else{let l=gC(t);aP(l,a,r,s,o)&&LP(l,e,n,r,i,s,o);let u=vC(t,c);aP(u,a,r,s,o)&&LP(u,e,n,r,i,s,o)}}var NP=["x","y","z"];function OP(t,e,n,r,i,s){BC.setBuffer(t._roots[e]);let o=kP(0,t,n,r,i,s);return BC.clearBuffer(),o}function kP(t,e,n,r,i,s){let{float32Array:o,uint16Array:a,uint32Array:l}=BC,c=2*t;if(pC(c,a)){return function(t,e,n,r,i,s,o){let{geometry:a,_indirectBuffer:l}=t,c=1/0,u=null;for(let h=r,d=r+i;h<d;h++){let t;t=rP(a,e,n,l?l[h]:h,null,s,o),t&&t.distance<c&&(u=t,c=t.distance)}return u}(e,n,r,fC(t,l),mC(c,a),i,s)}{let a,c,u=yC(t,l),h=NP[u],d=r.direction[h]>=0;d?(a=gC(t),c=vC(t,l)):(a=vC(t,l),c=gC(t));let p=aP(a,o,r,i,s)?kP(a,e,n,r,i,s):null;if(p){let t=p.point[h];if(d?t<=o[c+u]:t>=o[c+u+3])return p}let f=aP(c,o,r,i,s)?kP(c,e,n,r,i,s):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var DP=new Hw,zP=new OC,UP=new OC,FP=new mS,BP=new kC,VP=new kC;function HP(t,e,n,r){BC.setBuffer(t._roots[e]);let i=jP(0,t,n,r);return BC.clearBuffer(),i}function jP(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,{float32Array:s,uint16Array:o,uint32Array:a}=BC,l=2*t;if(null===i&&(n.boundingBox||n.computeBoundingBox(),BP.set(n.boundingBox.min,n.boundingBox.max,r),i=BP),!pC(l,o)){let o=t+8,l=a[t+6];return tC(o,s,DP),!!(i.intersectsBox(DP)&&jP(o,e,n,r,i)||(tC(l,s,DP),i.intersectsBox(DP)&&jP(l,e,n,r,i)))}{let i=e.geometry,c=i.index,u=i.attributes.position,h=n.index,d=n.attributes.position,p=fC(t,a),f=mC(l,o);if(FP.copy(r).invert(),n.boundsTree)return tC(t,s,VP),VP.matrix.copy(FP),VP.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:t=>VP.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(r),t.b.applyMatrix4(r),t.c.applyMatrix4(r),t.needsUpdate=!0;for(let n=p,r=f+p;n<r;n++)if(iP(UP,3*e.resolveTriangleIndex(n),c,u),UP.needsUpdate=!0,t.intersectsTriangle(UP))return!0;return!1}});for(let t=p,n=f+p;t<n;t++){let n=e.resolveTriangleIndex(t);iP(zP,3*n,c,u),zP.a.applyMatrix4(FP),zP.b.applyMatrix4(FP),zP.c.applyMatrix4(FP),zP.needsUpdate=!0;for(let t=0,e=h.count;t<e;t+=3)if(iP(UP,t,h,d),UP.needsUpdate=!0,zP.intersectsTriangle(UP))return!0}}}var WP=new mS,GP=new kC,qP=new kC,$P=new Fw,XP=new Fw,JP=new Fw,YP=new Fw;function ZP(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0;e.boundingBox||e.computeBoundingBox(),GP.set(e.boundingBox.min,e.boundingBox.max,n),GP.needsUpdate=!0;let a=t.geometry,l=a.attributes.position,c=a.index,u=e.attributes.position,h=e.index,d=FC.getPrimitive(),p=FC.getPrimitive(),f=$P,m=XP,g=null,v=null;i&&(g=JP,v=YP);let y=1/0,_=null,b=null;return WP.copy(n).invert(),qP.matrix.copy(WP),t.shapecast({boundsTraverseOrder:t=>GP.distanceToBox(t),intersectsBounds:(t,e,n)=>n<y&&n<o&&(e&&(qP.min.copy(t.min),qP.max.copy(t.max),qP.needsUpdate=!0),!0),intersectsRange:(r,i)=>{if(e.boundsTree){let a=e.boundsTree;return a.shapecast({boundsTraverseOrder:t=>qP.distanceToBox(t),intersectsBounds:(t,e,n)=>n<y&&n<o,intersectsRange:(e,o)=>{for(let x=e,w=e+o;x<w;x++){let e=a.resolveTriangleIndex(x);iP(p,3*e,h,u),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let n=r,o=r+i;n<o;n++){let e=t.resolveTriangleIndex(n);iP(d,3*e,c,l),d.needsUpdate=!0;let r=d.distanceToTriangle(p,f,g);if(r<y&&(m.copy(f),v&&v.copy(g),y=r,_=n,b=x),r<s)return!0}}}})}for(let o=0,a=JA(e);o<a;o++){iP(p,3*o,h,u),p.a.applyMatrix4(n),p.b.applyMatrix4(n),p.c.applyMatrix4(n),p.needsUpdate=!0;for(let e=r,n=r+i;e<n;e++){let n=t.resolveTriangleIndex(e);iP(d,3*n,c,l),d.needsUpdate=!0;let r=d.distanceToTriangle(p,f,g);if(r<y&&(m.copy(f),v&&v.copy(g),y=r,_=e,b=o),r<s)return!0}}}}),FC.releasePrimitive(d),FC.releasePrimitive(p),y===1/0?null:(r.point?r.point.copy(m):r.point=m.clone(),r.distance=y,r.faceIndex=_,i&&(i.point?i.point.copy(v):i.point=v.clone(),i.point.applyMatrix4(WP),m.applyMatrix4(WP),i.distance=m.sub(i.point).length(),i.faceIndex=b),r)}var KP=new BC.constructor,QP=new BC.constructor,tI=new UC((()=>new Hw)),eI=new Hw,nI=new Hw,rI=new Hw,iI=new Hw,sI=!1;function oI(t,e,n,r,i){let s,o,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]&&arguments[10];d?(s=QP,o=KP):(s=KP,o=QP);let p=s.float32Array,f=s.uint32Array,m=s.uint16Array,g=o.float32Array,v=o.uint32Array,y=o.uint16Array,_=2*e,b=pC(2*t,m),x=pC(_,y),w=!1;if(x&&b)w=d?i(fC(e,v),mC(2*e,y),fC(t,f),mC(2*t,m),u,l+e,c,a+t):i(fC(t,f),mC(2*t,m),fC(e,v),mC(2*e,y),c,a+t,u,l+e);else if(x){let s=tI.getPrimitive();tC(e,g,s),s.applyMatrix4(n);let o=gC(t),h=vC(t,f);tC(o,p,eI),tC(h,p,nI);let m=s.intersectsBox(eI),v=s.intersectsBox(nI);w=m&&oI(e,o,r,n,i,l,a,u,c+1,s,!d)||v&&oI(e,h,r,n,i,l,a,u,c+1,s,!d),tI.releasePrimitive(s)}else{let s=gC(e),o=vC(e,v);tC(s,g,rI),tC(o,g,iI);let m=h.intersectsBox(rI),y=h.intersectsBox(iI);if(m&&y)w=oI(t,s,n,r,i,a,l,c,u+1,h,d)||oI(t,o,n,r,i,a,l,c,u+1,h,d);else if(m)if(b)w=oI(t,s,n,r,i,a,l,c,u+1,h,d);else{let e=tI.getPrimitive();e.copy(rI).applyMatrix4(n);let o=gC(t),h=vC(t,f);tC(o,p,eI),tC(h,p,nI);let m=e.intersectsBox(eI),g=e.intersectsBox(nI);w=m&&oI(s,o,r,n,i,l,a,u,c+1,e,!d)||g&&oI(s,h,r,n,i,l,a,u,c+1,e,!d),tI.releasePrimitive(e)}else if(y)if(b)w=oI(t,o,n,r,i,a,l,c,u+1,h,d);else{let e=tI.getPrimitive();e.copy(iI).applyMatrix4(n);let s=gC(t),h=vC(t,f);tC(s,p,eI),tC(h,p,nI);let m=e.intersectsBox(eI),g=e.intersectsBox(nI);w=m&&oI(o,s,r,n,i,l,a,u,c+1,e,!d)||g&&oI(o,h,r,n,i,l,a,u,c+1,e,!d),tI.releasePrimitive(e)}}return w}var aI=new kC,lI=new Hw,cI={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0},uI=class t{static serialize(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e={cloneBuffers:!0,...e};let n,r=t.geometry,i=t._roots,s=t._indirectBuffer,o=r.getIndex();return n=e.cloneBuffers?{roots:i.map((t=>t.slice())),index:o?o.array.slice():null,indirectBuffer:s?s.slice():null}:{roots:i,index:o?o.array:null,indirectBuffer:s},n}static deserialize(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r={setIndex:!0,indirect:!!e.indirectBuffer,...r};let{index:i,roots:s,indirectBuffer:o}=e,a=new t(n,{...r,[XA]:!0});if(a._roots=s,a._indirectBuffer=o||null,r.setIndex){let t=n.getIndex();if(null===t){let t=new hM(e.index,1,!1);n.setIndex(t)}else t.array!==i&&(t.array.set(i),t.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if(e=Object.assign({...cI,[XA]:!1},e),e.useSharedArrayBuffer&&!(typeof SharedArrayBuffer<"u"))throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[XA]||(CC(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Hw))),this.resolveTriangleIndex=e.indirect?t=>this._indirectBuffer[t]:t=>t}refit(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(this.indirect?IP:oP)(this,t)}traverse(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._roots[e],r=new Uint32Array(n),i=new Uint16Array(n);!function e(s){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=2*s,l=65535===i[a+15];if(l){let e=r[s+6],c=i[a+14];t(o,l,new Float32Array(n,4*s,6),e,c)}else{let i=s+8,a=r[s+6],c=r[s+7];t(o,l,new Float32Array(n,4*s,6),c)||(e(i,o+1),e(a,o+1))}}(0)}raycast(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,i=this._roots,s=this.geometry,o=[],a=e.isMaterial,l=Array.isArray(e),c=s.groups,u=a?e.side:e,h=this.indirect?RP:cP;for(let d=0,p=i.length;d<p;d++){let i=l?e[c[d].materialIndex].side:u,s=o.length;if(h(this,d,i,t,o,n,r),l){let t=c[d].materialIndex;for(let e=s,n=o.length;e<n;e++)o[e].face.materialIndex=t}}return o}raycastFirst(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,i=this._roots,s=this.geometry,o=e.isMaterial,a=Array.isArray(e),l=null,c=s.groups,u=o?e.side:e,h=this.indirect?OP:dP;for(let d=0,p=i.length;d<p;d++){let i=h(this,d,a?e[c[d].materialIndex].side:u,t,n,r);null!=i&&(null==l||i.distance<l.distance)&&(l=i,a&&(i.face.materialIndex=c[d].materialIndex))}return l}intersectsGeometry(t,e){let n=!1,r=this._roots,i=this.indirect?HP:bP;for(let s=0,o=r.length;s<o&&(n=i(this,s,t,e),!n);s++);return n}shapecast(t){let e=FC.getPrimitive(),n=this.indirect?lP:sP,{boundsTraverseOrder:r,intersectsBounds:i,intersectsRange:s,intersectsTriangle:o}=t;if(s&&o){let t=s;s=(r,i,s,a,l)=>!!t(r,i,s,a,l)||n(r,i,this,o,s,a,e)}else s||(s=o?(t,r,i,s)=>n(t,r,this,o,i,s,e):(t,e,n)=>n);let a=!1,l=0,c=this._roots;for(let u=0,h=c.length;u<h;u++){let t=c[u];if(a=jC(this,u,i,s,r,l),a)break;l+=t.byteLength}return FC.releasePrimitive(e),a}bvhcast(t,e,n){let{intersectsRanges:r,intersectsTriangles:i}=n,s=FC.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,l=this.indirect?t=>{let e=this.resolveTriangleIndex(t);iP(s,3*e,o,a)}:t=>{iP(s,3*t,o,a)},c=FC.getPrimitive(),u=t.geometry.index,h=t.geometry.attributes.position,d=t.indirect?e=>{let n=t.resolveTriangleIndex(e);iP(c,3*n,u,h)}:t=>{iP(c,3*t,u,h)};if(i){let t=(t,n,r,o,a,u,h,p)=>{for(let f=r,m=r+o;f<m;f++){d(f),c.a.applyMatrix4(e),c.b.applyMatrix4(e),c.c.applyMatrix4(e),c.needsUpdate=!0;for(let e=t,r=t+n;e<r;e++)if(l(e),s.needsUpdate=!0,i(s,c,e,f,a,u,h,p))return!0}return!1};if(r){let e=r;r=function(n,r,i,s,o,a,l,c){return!!e(n,r,i,s,o,a,l,c)||t(n,r,i,s,o,a,l,c)}}else r=t}return function(t,e,n,r){if(sI)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");sI=!0;let i,s=t._roots,o=e._roots,a=0,l=0,c=(new mS).copy(n).invert();for(let u=0,h=s.length;u<h;u++){KP.setBuffer(s[u]),l=0;let t=tI.getPrimitive();tC(0,KP.float32Array,t),t.applyMatrix4(c);for(let e=0,s=o.length;e<s&&(QP.setBuffer(o[u]),i=oI(0,0,n,c,r,a,l,0,0,t),QP.clearBuffer(),l+=o[e].length,!i);e++);if(tI.releasePrimitive(t),KP.clearBuffer(),a+=s[u].length,i)break}return sI=!1,i}(this,t,e,r)}intersectsBox(t,e){return aI.set(t.min,t.max,e),aI.needsUpdate=!0,this.shapecast({intersectsBounds:t=>aI.intersectsBox(t),intersectsTriangle:t=>aI.intersectsTriangle(t)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0;return(this.indirect?ZP:PP)(this,t,e,n,r,i,s)}closestPointToPoint(t){return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,s=r*r,o=i*i,a=1/0,l=null;if(t.shapecast({boundsTraverseOrder:t=>(GC.copy(e).clamp(t.min,t.max),GC.distanceToSquared(e)),intersectsBounds:(t,e,n)=>n<a&&n<o,intersectsTriangle:(t,n)=>{t.closestPointToPoint(e,GC);let r=e.distanceToSquared(GC);return r<a&&(qC.copy(GC),a=r,l=n),r<s}}),a===1/0)return null;let c=Math.sqrt(a);return n.point?n.point.copy(qC):n.point=qC.clone(),n.distance=c,n.faceIndex=l,n}(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach((e=>{tC(0,new Float32Array(e),lI),t.union(lI)})),t}};function hI(t,e,n){return null===t?null:(t.point.applyMatrix4(e.matrixWorld),t.distance=t.point.distanceTo(n.ray.origin),t.object=e,t)}var dI=new fS,pI=new Fw,fI=new mS,mI=BM.prototype.raycast,gI=new Fw;function vI(t,e){if(this.geometry.boundsTree){if(void 0===this.material)return;fI.copy(this.matrixWorld).invert(),dI.copy(t.ray).applyMatrix4(fI),function(t,e){let n=t.elements,r=e.set(n[0],n[1],n[2]).length(),i=e.set(n[4],n[5],n[6]).length(),s=e.set(n[8],n[9],n[10]).length();e.set(r,i,s)}(this.matrixWorld,gI),pI.copy(dI.direction).multiply(gI);let n=pI.length(),r=t.near/n,i=t.far/n,s=this.geometry.boundsTree;if(!0===t.firstHitOnly){let n=hI(s.raycastFirst(dI,this.material,r,i),this,t);n&&e.push(n)}else{let n=s.raycast(dI,this.material,r,i);for(let r=0,i=n.length;r<i;r++){let i=hI(n[r],this,t);i&&e.push(i)}}}else mI.call(this,t,e)}function yI(t){return this.boundsTree=new uI(this,t),this.boundsTree}function _I(){this.boundsTree=null}var bI=dx(gx()),xI=class{constructor(t){this.debug=(0,bI.default)(t)}log(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.debug(t,...n)}};function wI(t,e){if(0===e)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(2===e||1===e){let n=t.getIndex();if(null===n){let e=[],r=t.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<r.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}let r=n.count-2,i=[];if(2===e)for(let t=1;t<=r;t++)i.push(n.getX(0)),i.push(n.getX(t)),i.push(n.getX(t+1));else for(let t=0;t<r;t++)t%2===0?(i.push(n.getX(t)),i.push(n.getX(t+1)),i.push(n.getX(t+2))):(i.push(n.getX(t+2)),i.push(n.getX(t+1)),i.push(n.getX(t)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let s=t.clone();return s.setIndex(i),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}var SI=class extends eA{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new PI(t)})),this.register((function(t){return new II(t)})),this.register((function(t){return new FI(t)})),this.register((function(t){return new BI(t)})),this.register((function(t){return new VI(t)})),this.register((function(t){return new LI(t)})),this.register((function(t){return new NI(t)})),this.register((function(t){return new OI(t)})),this.register((function(t){return new kI(t)})),this.register((function(t){return new CI(t)})),this.register((function(t){return new DI(t)})),this.register((function(t){return new RI(t)})),this.register((function(t){return new UI(t)})),this.register((function(t){return new zI(t)})),this.register((function(t){return new TI(t)})),this.register((function(t){return new HI(t)})),this.register((function(t){return new jI(t)}))}load(t,e,n,r){let i,s=this;if(""!==this.resourcePath)i=this.resourcePath;else if(""!==this.path){let e=xA.extractUrlBase(t);i=xA.resolveURL(e,this.path)}else i=xA.extractUrlBase(t);this.manager.itemStart(t);let o=function(e){r?r(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},a=new iA(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){try{s.parse(n,i,(function(n){e(n),s.manager.itemEnd(t)}),o)}catch(r){o(r)}}),n,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,r){let i,s={},o={},a=new TextDecoder;if("string"==typeof t)i=JSON.parse(t);else if(t instanceof ArrayBuffer)if(a.decode(new Uint8Array(t,0,4))===WI){try{s[EI.KHR_BINARY_GLTF]=new $I(t)}catch(c){return void(r&&r(c))}i=JSON.parse(s[EI.KHR_BINARY_GLTF].content)}else i=JSON.parse(a.decode(t));else i=t;if(void 0===i.asset||i.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));let l=new _R(i,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){let t=this.pluginCallbacks[u](l);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[t.name]=t,s[t.name]=!0}if(i.extensionsUsed)for(let u=0;u<i.extensionsUsed.length;++u){let t=i.extensionsUsed[u],e=i.extensionsRequired||[];switch(t){case EI.KHR_MATERIALS_UNLIT:s[t]=new AI;break;case EI.KHR_DRACO_MESH_COMPRESSION:s[t]=new XI(i,this.dracoLoader);break;case EI.KHR_TEXTURE_TRANSFORM:s[t]=new JI;break;case EI.KHR_MESH_QUANTIZATION:s[t]=new YI;break;default:e.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(s),l.setPlugins(o),l.parse(n,r)}parseAsync(t,e){let n=this;return new Promise((function(r,i){n.parse(t,e,r,i)}))}};function MI(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}var EI={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},TI=class{constructor(t){this.parser=t,this.name=EI.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let t=this.parser,e=this.parser.json.nodes||[];for(let n=0,r=e.length;n<r;n++){let r=e[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&t._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(t){let e=this.parser,n="light:"+t,r=e.cache.get(n);if(r)return r;let i,s=e.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t],a=new iM(16777215);void 0!==o.color&&a.setRGB(o.color[0],o.color[1],o.color[2],Jx);let l=void 0!==o.range?o.range:0;switch(o.type){case"directional":i=new bA(a),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new yA(a),i.distance=l;break;case"spot":i=new pA(a),i.distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,i.angle=o.spot.outerConeAngle,i.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return i.position.set(0,0,0),i.decay=2,pR(i,o),void 0!==o.intensity&&(i.intensity=o.intensity),i.name=e.createUniqueName(o.name||"light_"+t),r=Promise.resolve(i),e.cache.add(n,r),r}getDependency(t,e){if("light"===t)return this._loadLight(e)}createNodeAttachment(t){let e=this,n=this.parser,r=n.json.nodes[t],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(t){return n._getNodeRef(e.cache,i,t)}))}},AI=class{constructor(){this.name=EI.KHR_MATERIALS_UNLIT}getMaterialType(){return lM}extendParams(t,e,n){let r=[];t.color=new iM(1,1,1),t.opacity=1;let i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){let e=i.baseColorFactor;t.color.setRGB(e[0],e[1],e[2],Jx),t.opacity=e[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(t,"map",i.baseColorTexture,Xx))}return Promise.all(r)}},CI=class{constructor(t){this.parser=t,this.name=EI.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){let n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(e.emissiveIntensity=r),Promise.resolve()}},PI=class{constructor(t){this.parser=t,this.name=EI.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?OT:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];if(void 0!==s.clearcoatFactor&&(e.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&i.push(n.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&i.push(n.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(i.push(n.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){let t=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new vw(t,t)}return Promise.all(i)}},II=class{constructor(t){this.parser=t,this.name=EI.KHR_MATERIALS_DISPERSION}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?OT:null}extendMaterialParams(t,e){let n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=n.extensions[this.name];return e.dispersion=void 0!==r.dispersion?r.dispersion:0,Promise.resolve()}},RI=class{constructor(t){this.parser=t,this.name=EI.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?OT:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return void 0!==s.iridescenceFactor&&(e.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&i.push(n.assignTexture(e,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(e.iridescenceIOR=s.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&i.push(n.assignTexture(e,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}},LI=class{constructor(t){this.parser=t,this.name=EI.KHR_MATERIALS_SHEEN}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?OT:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[];e.sheenColor=new iM(0,0,0),e.sheenRoughness=0,e.sheen=1;let s=r.extensions[this.name];if(void 0!==s.sheenColorFactor){let t=s.sheenColorFactor;e.sheenColor.setRGB(t[0],t[1],t[2],Jx)}return void 0!==s.sheenRoughnessFactor&&(e.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&i.push(n.assignTexture(e,"sheenColorMap",s.sheenColorTexture,Xx)),void 0!==s.sheenRoughnessTexture&&i.push(n.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}},NI=class{constructor(t){this.parser=t,this.name=EI.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?OT:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&i.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(i)}},OI=class{constructor(t){this.parser=t,this.name=EI.KHR_MATERIALS_VOLUME}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?OT:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];e.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&i.push(n.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||1/0;let o=s.attenuationColor||[1,1,1];return e.attenuationColor=(new iM).setRGB(o[0],o[1],o[2],Jx),Promise.all(i)}},kI=class{constructor(t){this.parser=t,this.name=EI.KHR_MATERIALS_IOR}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?OT:null}extendMaterialParams(t,e){let n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=n.extensions[this.name];return e.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}},DI=class{constructor(t){this.parser=t,this.name=EI.KHR_MATERIALS_SPECULAR}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?OT:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];e.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&i.push(n.assignTexture(e,"specularIntensityMap",s.specularTexture));let o=s.specularColorFactor||[1,1,1];return e.specularColor=(new iM).setRGB(o[0],o[1],o[2],Jx),void 0!==s.specularColorTexture&&i.push(n.assignTexture(e,"specularColorMap",s.specularColorTexture,Xx)),Promise.all(i)}},zI=class{constructor(t){this.parser=t,this.name=EI.EXT_MATERIALS_BUMP}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?OT:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return e.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&i.push(n.assignTexture(e,"bumpMap",s.bumpTexture)),Promise.all(i)}},UI=class{constructor(t){this.parser=t,this.name=EI.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){let e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?OT:null}extendMaterialParams(t,e){let n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=[],s=r.extensions[this.name];return void 0!==s.anisotropyStrength&&(e.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(e.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&i.push(n.assignTexture(e,"anisotropyMap",s.anisotropyTexture)),Promise.all(i)}},FI=class{constructor(t){this.parser=t,this.name=EI.KHR_TEXTURE_BASISU}loadTexture(t){let e=this.parser,n=e.json,r=n.textures[t];if(!r.extensions||!r.extensions[this.name])return null;let i=r.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,i.source,s)}},BI=class{constructor(t){this.parser=t,this.name=EI.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){let e=this.name,n=this.parser,r=n.json,i=r.textures[t];if(!i.extensions||!i.extensions[e])return null;let s=i.extensions[e],o=r.images[s.source],a=n.textureLoader;if(o.uri){let t=n.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(t,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){let e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}},VI=class{constructor(t){this.parser=t,this.name=EI.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){let e=this.name,n=this.parser,r=n.json,i=r.textures[t];if(!i.extensions||!i.extensions[e])return null;let s=i.extensions[e],o=r.images[s.source],a=n.textureLoader;if(o.uri){let t=n.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(t,s.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){let e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}},HI=class{constructor(t){this.name=EI.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){let e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){let t=n.extensions[this.name],r=this.parser.getDependency("buffer",t.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then((function(e){let n=t.byteOffset||0,r=t.byteLength||0,s=t.count,o=t.byteStride,a=new Uint8Array(e,n,r);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(s,o,a,t.mode,t.filter).then((function(t){return t.buffer})):i.ready.then((function(){let e=new ArrayBuffer(s*o);return i.decodeGltfBuffer(new Uint8Array(e),s,o,a,t.mode,t.filter),e}))}))}return null}},jI=class{constructor(t){this.name=EI.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){let e=this.parser.json,n=e.nodes[t];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;let r=e.meshes[n.mesh];for(let a of r.primitives)if(a.mode!==tR.TRIANGLES&&a.mode!==tR.TRIANGLE_STRIP&&a.mode!==tR.TRIANGLE_FAN&&void 0!==a.mode)return null;let i=n.extensions[this.name].attributes,s=[],o={};for(let a in i)s.push(this.parser.getDependency("accessor",i[a]).then((t=>(o[a]=t,o[a]))));return s.length<1?null:(s.push(this.parser.createNodeMesh(t)),Promise.all(s).then((t=>{let e=t.pop(),n=e.isGroup?e.children:[e],r=t[0].count,i=[];for(let s of n){let t=new mS,e=new Fw,n=new Uw,a=new Fw(1,1,1),l=new ZE(s.geometry,s.material,r);for(let i=0;i<r;i++)o.TRANSLATION&&e.fromBufferAttribute(o.TRANSLATION,i),o.ROTATION&&n.fromBufferAttribute(o.ROTATION,i),o.SCALE&&a.fromBufferAttribute(o.SCALE,i),l.setMatrixAt(i,t.compose(e,n,a));for(let r in o)if("_COLOR_0"===r){let t=o[r];l.instanceColor=new jE(t.array,t.itemSize,t.normalized)}else"TRANSLATION"!==r&&"ROTATION"!==r&&"SCALE"!==r&&s.geometry.setAttribute(r,o[r]);HS.prototype.copy.call(l,s),this.parser.assignFinalMaterial(l),i.push(l)}return e.isGroup?(e.clear(),e.add(...i),e):i[0]})))}},WI="glTF",GI=1313821514,qI=5130562,$I=class{constructor(t){this.name=EI.KHR_BINARY_GLTF,this.content=null,this.body=null;let e=new DataView(t,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==WI)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-12,i=new DataView(t,12),s=0;for(;s<r;){let e=i.getUint32(s,!0);s+=4;let r=i.getUint32(s,!0);if(s+=4,r===GI){let r=new Uint8Array(t,12+s,e);this.content=n.decode(r)}else if(r===qI){let n=12+s;this.body=t.slice(n,n+e)}s+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}},XI=class{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EI.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){let n=this.json,r=this.dracoLoader,i=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,o={},a={},l={};for(let c in s){let t=sR[c]||c.toLowerCase();o[t]=s[c]}for(let c in t.attributes){let e=sR[c]||c.toLowerCase();if(void 0!==s[c]){let r=n.accessors[t.attributes[c]],i=eR[r.componentType];l[e]=i.name,a[e]=!0===r.normalized}}return e.getDependency("bufferView",i).then((function(t){return new Promise((function(e,n){r.decodeDracoFile(t,(function(t){for(let e in t.attributes){let n=t.attributes[e],r=a[e];void 0!==r&&(n.normalized=r)}e(t)}),o,l,Jx,n)}))}))}},JI=class{constructor(){this.name=EI.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(void 0===e.texCoord||e.texCoord===t.channel)&&void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.texCoord&&(t.channel=e.texCoord),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}},YI=class{constructor(){this.name=EI.KHR_MESH_QUANTIZATION}},ZI=class extends FT{constructor(t,e,n,r){super(t,e,n,r)}copySampleValue_(t){let e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r*3+r;for(let s=0;s!==r;s++)e[s]=n[i+s];return e}interpolate_(t,e,n,r){let i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=r-e,u=(n-e)/c,h=u*u,d=h*u,p=t*l,f=p-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u;for(let _=0;_!==o;_++){let t=s[f+_+o],e=s[f+_+a]*c,n=s[p+_+o],r=s[p+_]*c;i[_]=v*t+y*e+m*n+g*r}return i}},KI=new Uw,QI=class extends ZI{interpolate_(t,e,n,r){let i=super.interpolate_(t,e,n,r);return KI.fromArray(i).normalize().toArray(i),i}},tR={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},eR={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},nR={9728:zx,9729:Ux,9984:1004,9985:1007,9986:1005,9987:Fx},rR={33071:kx,33648:Dx,10497:Ox},iR={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},sR={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},oR={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},aR={CUBICSPLINE:void 0,LINEAR:Hx,STEP:Vx},lR="OPAQUE",cR="MASK",uR="BLEND";function hR(t){return void 0===t.DefaultMaterial&&(t.DefaultMaterial=new NT({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),t.DefaultMaterial}function dR(t,e,n){for(let r in n.extensions)void 0===t[r]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function pR(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function fR(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let n=0,r=e.weights.length;n<r;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){let n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let e=0,r=n.length;e<r;e++)t.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function mR(t){let e,n=t.extensions&&t.extensions[EI.KHR_DRACO_MESH_COMPRESSION];if(e=n?"draco:"+n.bufferView+":"+n.indices+":"+gR(n.attributes):t.indices+":"+gR(t.attributes)+":"+t.mode,void 0!==t.targets)for(let r=0,i=t.targets.length;r<i;r++)e+=":"+gR(t.targets[r]);return e}function gR(t){let e="",n=Object.keys(t).sort();for(let r=0,i=n.length;r<i;r++)e+=n[r]+":"+t[n[r]]+";";return e}function vR(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var yR=new mS,_R=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new MI,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=-1,i=!1,s=-1;if(typeof navigator<"u"){let t=navigator.userAgent;n=!0===/^((?!chrome|android).)*safari/i.test(t);let e=t.match(/Version\/(\d+)/);r=n&&e?parseInt(e[1],10):-1,i=t.indexOf("Firefox")>-1,s=i?t.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&r<17||i&&s<98?this.textureLoader=new oA(this.options.manager):this.textureLoader=new wA(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new iA(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){let n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(e){let s={scene:e[0][r.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:r.asset,parser:n,userData:{}};return dR(i,s,r),pR(s,r),Promise.all(n._invokeAll((function(t){return t.afterRoot&&t.afterRoot(s)}))).then((function(){for(let t of s.scenes)t.updateMatrixWorld();t(s)}))})).catch(e)}_markDefs(){let t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let r=0,i=e.length;r<i;r++){let n=e[r].joints;for(let e=0,r=n.length;e<r;e++)t[n[e]].isBone=!0}for(let r=0,i=t.length;r<i;r++){let e=t[r];void 0!==e.mesh&&(this._addNodeRef(this.meshCache,e.mesh),void 0!==e.skin&&(n[e.mesh].isSkinnedMesh=!0)),void 0!==e.camera&&this._addNodeRef(this.cameraCache,e.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;let r=n.clone(),i=(t,e)=>{let n=this.associations.get(t);null!=n&&this.associations.set(e,n);for(let[r,s]of t.children.entries())i(s,e.children[r])};return i(n,r),r.name+="_instance_"+t.uses[e]++,r}_invokeOne(t){let e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){let r=t(e[n]);if(r)return r}return null}_invokeAll(t){let e=Object.values(this.plugins);e.unshift(this);let n=[];for(let r=0;r<e.length;r++){let i=t(e[r]);i&&n.push(i)}return n}getDependency(t,e){let n=t+":"+e,r=this.cache.get(n);if(!r){switch(t){case"scene":r=this.loadScene(e);break;case"node":r=this._invokeOne((function(t){return t.loadNode&&t.loadNode(e)}));break;case"mesh":r=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":r=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":r=this.loadSkin(e);break;case"animation":r=this._invokeOne((function(t){return t.loadAnimation&&t.loadAnimation(e)}));break;case"camera":r=this.loadCamera(e);break;default:if(r=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(t,e)})),!r)throw new Error("Unknown type: "+t)}this.cache.add(n,r)}return r}getDependencies(t){let e=this.cache.get(t);if(!e){let n=this,r=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(r.map((function(e,r){return n.getDependency(t,r)}))),this.cache.add(t,e)}return e}loadBuffer(t){let e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[EI.KHR_BINARY_GLTF].body);let r=this.options;return new Promise((function(t,i){n.load(xA.resolveURL(e.uri,r.path),t,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){let e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){let n=e.byteLength||0,r=e.byteOffset||0;return t.slice(r,r+n)}))}loadAccessor(t){let e=this,n=this.json,r=this.json.accessors[t];if(void 0===r.bufferView&&void 0===r.sparse){let t=iR[r.type],e=eR[r.componentType],n=!0===r.normalized,i=new e(r.count*t);return Promise.resolve(new hM(i,t,n))}let i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(t){let i,s,o=t[0],a=iR[r.type],l=eR[r.componentType],c=l.BYTES_PER_ELEMENT,u=c*a,h=r.byteOffset||0,d=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,p=!0===r.normalized;if(d&&d!==u){let t=Math.floor(h/d),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+t+":"+r.count,u=e.cache.get(n);u||(i=new l(o,t*d,r.count*d/c),u=new uE(i,d/c),e.cache.add(n,u)),s=new dE(u,a,h%d/c,p)}else i=null===o?new l(r.count*a):new l(o,h,r.count*a),s=new hM(i,a,p);if(void 0!==r.sparse){let e=iR.SCALAR,n=eR[r.sparse.indices.componentType],i=r.sparse.indices.byteOffset||0,c=r.sparse.values.byteOffset||0,u=new n(t[1],i,r.sparse.count*e),h=new l(t[2],c,r.sparse.count*a);null!==o&&(s=new hM(s.array.slice(),s.itemSize,s.normalized));for(let t=0,r=u.length;t<r;t++){let e=u[t];if(s.setX(e,h[t*a]),a>=2&&s.setY(e,h[t*a+1]),a>=3&&s.setZ(e,h[t*a+2]),a>=4&&s.setW(e,h[t*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return s}))}loadTexture(t){let e=this.json,n=this.options,r=e.textures[t].source,i=e.images[r],s=this.textureLoader;if(i.uri){let t=n.manager.getHandler(i.uri);null!==t&&(s=t)}return this.loadTextureImage(t,r,s)}loadTextureImage(t,e,n){let r=this,i=this.json,s=i.textures[t],o=i.images[e],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];let l=this.loadImageSource(e,n).then((function(e){e.flipY=!1,e.name=s.name||o.name||"",""===e.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(e.name=o.uri);let n=(i.samplers||{})[s.sampler]||{};return e.magFilter=nR[n.magFilter]||Ux,e.minFilter=nR[n.minFilter]||Fx,e.wrapS=rR[n.wrapS]||Ox,e.wrapT=rR[n.wrapT]||Ox,r.associations.set(e,{textures:t}),e})).catch((function(){return null}));return this.textureCache[a]=l,l}loadImageSource(t,e){let n=this.json,r=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((t=>t.clone()));let i=n.images[t],s=self.URL||self.webkitURL,o=i.uri||"",a=!1;if(void 0!==i.bufferView)o=this.getDependency("bufferView",i.bufferView).then((function(t){a=!0;let e=new Blob([t],{type:i.mimeType});return o=s.createObjectURL(e),o}));else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");let l=Promise.resolve(o).then((function(t){return new Promise((function(n,i){let s=n;!0===e.isImageBitmapLoader&&(s=function(t){let e=new Dw(t);e.needsUpdate=!0,n(e)}),e.load(xA.resolveURL(t,r.path),s,void 0,i)}))})).then((function(t){return!0===a&&s.revokeObjectURL(o),pR(t,i),t.userData.mimeType=i.mimeType||function(t){return t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"}(i.uri),t})).catch((function(t){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),t}));return this.sourceCache[t]=l,l}assignTexture(t,e,n,r){let i=this;return this.getDependency("texture",n.index).then((function(s){if(!s)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((s=s.clone()).channel=n.texCoord),i.extensions[EI.KHR_TEXTURE_TRANSFORM]){let t=void 0!==n.extensions?n.extensions[EI.KHR_TEXTURE_TRANSFORM]:void 0;if(t){let e=i.associations.get(s);s=i.extensions[EI.KHR_TEXTURE_TRANSFORM].extendTexture(s,t),i.associations.set(s,e)}}return void 0!==r&&(s.colorSpace=r),t[e]=s,s}))}assignFinalMaterial(t){let e=t.geometry,n=t.material,r=void 0===e.attributes.tangent,i=void 0!==e.attributes.color,s=void 0===e.attributes.normal;if(t.isPoints){let t="PointsMaterial:"+n.uuid,e=this.cache.get(t);e||(e=new dT,aM.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,e.sizeAttenuation=!1,this.cache.add(t,e)),n=e}else if(t.isLine){let t="LineBasicMaterial:"+n.uuid,e=this.cache.get(t);e||(e=new KE,aM.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,this.cache.add(t,e)),n=e}if(r||i||s){let t="ClonedMaterial:"+n.uuid+":";r&&(t+="derivative-tangents:"),i&&(t+="vertex-colors:"),s&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=n.clone(),i&&(e.vertexColors=!0),s&&(e.flatShading=!0),r&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}t.material=n}getMaterialType(){return NT}loadMaterial(t){let e,n=this,r=this.json,i=this.extensions,s=r.materials[t],o={},a=[];if((s.extensions||{})[EI.KHR_MATERIALS_UNLIT]){let t=i[EI.KHR_MATERIALS_UNLIT];e=t.getMaterialType(),a.push(t.extendParams(o,s,n))}else{let r=s.pbrMetallicRoughness||{};if(o.color=new iM(1,1,1),o.opacity=1,Array.isArray(r.baseColorFactor)){let t=r.baseColorFactor;o.color.setRGB(t[0],t[1],t[2],Jx),o.opacity=t[3]}void 0!==r.baseColorTexture&&a.push(n.assignTexture(o,"map",r.baseColorTexture,Xx)),o.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,o.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(a.push(n.assignTexture(o,"metalnessMap",r.metallicRoughnessTexture)),a.push(n.assignTexture(o,"roughnessMap",r.metallicRoughnessTexture))),e=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),a.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)}))))}!0===s.doubleSided&&(o.side=2);let l=s.alphaMode||lR;if(l===uR?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===cR&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&e!==lM&&(a.push(n.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new vw(1,1),void 0!==s.normalTexture.scale)){let t=s.normalTexture.scale;o.normalScale.set(t,t)}if(void 0!==s.occlusionTexture&&e!==lM&&(a.push(n.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(o.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&e!==lM){let t=s.emissiveFactor;o.emissive=(new iM).setRGB(t[0],t[1],t[2],Jx)}return void 0!==s.emissiveTexture&&e!==lM&&a.push(n.assignTexture(o,"emissiveMap",s.emissiveTexture,Xx)),Promise.all(a).then((function(){let r=new e(o);return s.name&&(r.name=s.name),pR(r,s),n.associations.set(r,{materials:t}),s.extensions&&dR(i,r,s),r}))}createUniqueName(t){let e=DA.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){let e=this,n=this.extensions,r=this.primitiveCache;function i(t){return n[EI.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return bR(n,t,e)}))}let s=[];for(let o=0,a=t.length;o<a;o++){let n=t[o],a=mR(n),l=r[a];if(l)s.push(l.promise);else{let t;t=n.extensions&&n.extensions[EI.KHR_DRACO_MESH_COMPRESSION]?i(n):bR(new wM,n,e),r[a]={primitive:n,promise:t},s.push(t)}}return Promise.all(s)}loadMesh(t){let e=this,n=this.json,r=this.extensions,i=n.meshes[t],s=i.primitives,o=[];for(let a=0,l=s.length;a<l;a++){let t=void 0===s[a].material?hR(this.cache):this.getDependency("material",s[a].material);o.push(t)}return o.push(e.loadGeometries(s)),Promise.all(o).then((function(n){let o=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let u=0,h=a.length;u<h;u++){let n,c=a[u],h=s[u],d=o[u];if(h.mode===tR.TRIANGLES||h.mode===tR.TRIANGLE_STRIP||h.mode===tR.TRIANGLE_FAN||void 0===h.mode)n=!0===i.isSkinnedMesh?new zE(c,d):new BM(c,d),!0===n.isSkinnedMesh&&n.normalizeSkinWeights(),h.mode===tR.TRIANGLE_STRIP?n.geometry=wI(n.geometry,1):h.mode===tR.TRIANGLE_FAN&&(n.geometry=wI(n.geometry,2));else if(h.mode===tR.LINES)n=new uT(c,d);else if(h.mode===tR.LINE_STRIP)n=new oT(c,d);else if(h.mode===tR.LINE_LOOP)n=new hT(c,d);else{if(h.mode!==tR.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);n=new vT(c,d)}Object.keys(n.geometry.morphAttributes).length>0&&fR(n,i),n.name=e.createUniqueName(i.name||"mesh_"+t),pR(n,i),h.extensions&&dR(r,n,h),e.assignFinalMaterial(n),l.push(n)}for(let r=0,i=l.length;r<i;r++)e.associations.set(l[r],{meshes:t,primitives:r});if(1===l.length)return i.extensions&&dR(r,l[0],i),l[0];let c=new cE;i.extensions&&dR(r,c,i),e.associations.set(c,{meshes:t});for(let t=0,e=l.length;t<e;t++)c.add(l[t]);return c}))}loadCamera(t){let e,n=this.json.cameras[t],r=n[n.type];if(r)return"perspective"===n.type?e=new XM(gw.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(e=new sE(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),pR(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){let e=this.json.skins[t],n=[];for(let r=0,i=e.joints.length;r<i;r++)n.push(this._loadNodeShallow(e.joints[r]));return void 0!==e.inverseBindMatrices?n.push(this.getDependency("accessor",e.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(t){let n=t.pop(),r=t,i=[],s=[];for(let o=0,a=r.length;o<a;o++){let t=r[o];if(t){i.push(t);let e=new mS;null!==n&&e.fromArray(n.array,16*o),s.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[o])}return new HE(i,s)}))}loadAnimation(t){let e=this.json,n=this,r=e.animations[t],i=r.name?r.name:"animation_"+t,s=[],o=[],a=[],l=[],c=[];for(let u=0,h=r.channels.length;u<h;u++){let t=r.channels[u],e=r.samplers[t.sampler],n=t.target,i=n.node,h=void 0!==r.parameters?r.parameters[e.input]:e.input,d=void 0!==r.parameters?r.parameters[e.output]:e.output;void 0!==n.node&&(s.push(this.getDependency("node",i)),o.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",d)),l.push(e),c.push(n))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then((function(t){let e=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=[];for(let i=0,c=e.length;i<c;i++){let t=e[i],c=r[i],u=s[i],h=o[i],d=a[i];if(void 0===t)continue;t.updateMatrix&&t.updateMatrix();let p=n._createAnimationTracks(t,c,u,h,d);if(p)for(let e=0;e<p.length;e++)l.push(p[e])}return new ZT(i,void 0,l)}))}createNodeMesh(t){let e=this.json,n=this,r=e.nodes[t];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(t){let e=n._getNodeRef(n.meshCache,r.mesh,t);return void 0!==r.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,n=r.weights.length;e<n;e++)t.morphTargetInfluences[e]=r.weights[e]})),e}))}loadNode(t){let e=this,n=this.json.nodes[t],r=e._loadNodeShallow(t),i=[],s=n.children||[];for(let a=0,l=s.length;a<l;a++)i.push(e.getDependency("node",s[a]));let o=void 0===n.skin?Promise.resolve(null):e.getDependency("skin",n.skin);return Promise.all([r,Promise.all(i),o]).then((function(t){let e=t[0],n=t[1],r=t[2];null!==r&&e.traverse((function(t){t.isSkinnedMesh&&t.bind(r,yR)}));for(let i=0,s=n.length;i<s;i++)e.add(n[i]);return e}))}_loadNodeShallow(t){let e=this.json,n=this.extensions,r=this;if(void 0!==this.nodeCache[t])return this.nodeCache[t];let i=e.nodes[t],s=i.name?r.createUniqueName(i.name):"",o=[],a=r._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return a&&o.push(a),void 0!==i.camera&&o.push(r.getDependency("camera",i.camera).then((function(t){return r._getNodeRef(r.cameraCache,i.camera,t)}))),r._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){o.push(t)})),this.nodeCache[t]=Promise.all(o).then((function(e){let o;if(o=!0===i.isBone?new UE:e.length>1?new cE:1===e.length?e[0]:new HS,o!==e[0])for(let t=0,n=e.length;t<n;t++)o.add(e[t]);if(i.name&&(o.userData.name=i.name,o.name=s),pR(o,i),i.extensions&&dR(n,o,i),void 0!==i.matrix){let t=new mS;t.fromArray(i.matrix),o.applyMatrix4(t)}else void 0!==i.translation&&o.position.fromArray(i.translation),void 0!==i.rotation&&o.quaternion.fromArray(i.rotation),void 0!==i.scale&&o.scale.fromArray(i.scale);return r.associations.has(o)||r.associations.set(o,{}),r.associations.get(o).nodes=t,o})),this.nodeCache[t]}loadScene(t){let e=this.extensions,n=this.json.scenes[t],r=this,i=new cE;n.name&&(i.name=r.createUniqueName(n.name)),pR(i,n),n.extensions&&dR(e,i,n);let s=n.nodes||[],o=[];for(let a=0,l=s.length;a<l;a++)o.push(r.getDependency("node",s[a]));return Promise.all(o).then((function(t){for(let e=0,n=t.length;e<n;e++)i.add(t[e]);return r.associations=(t=>{let e=new Map;for(let[n,i]of r.associations)(n instanceof aM||n instanceof Dw)&&e.set(n,i);return t.traverse((t=>{let n=r.associations.get(t);null!=n&&e.set(t,n)})),e})(i),i}))}_createAnimationTracks(t,e,n,r,i){let s,o=[],a=t.name?t.name:t.uuid,l=[];switch(oR[i.path]===oR.weights?t.traverse((function(t){t.morphTargetInfluences&&l.push(t.name?t.name:t.uuid)})):l.push(a),oR[i.path]){case oR.weights:s=qT;break;case oR.rotation:s=XT;break;case oR.position:case oR.scale:s=YT;break;default:if(1===n.itemSize)s=qT;else s=YT}let c=void 0!==r.interpolation?aR[r.interpolation]:Hx,u=this._getArrayFromAccessor(n);for(let h=0,d=l.length;h<d;h++){let t=new s(l[h]+"."+oR[i.path],e.array,u,c);"CUBICSPLINE"===r.interpolation&&this._createCubicSplineTrackInterpolant(t),o.push(t)}return o}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){let t=vR(e.constructor),n=new Float32Array(e.length);for(let r=0,i=e.length;r<i;r++)n[r]=e[r]*t;e=n}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(t){return new(this instanceof XT?QI:ZI)(this.times,this.values,this.getValueSize()/3,t)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function bR(t,e,n){let r=e.attributes,i=[];function s(e,r){return n.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(let o in r){let e=sR[o]||o.toLowerCase();e in t.attributes||i.push(s(r[o],e))}if(void 0!==e.indices&&!t.index){let r=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));i.push(r)}return Aw.workingColorSpace!==Jx&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Aw.workingColorSpace}" not supported.`),pR(t,e),function(t,e,n){let r=e.attributes,i=new Hw;if(void 0===r.POSITION)return;{let t=n.json.accessors[r.POSITION],e=t.min,s=t.max;if(void 0===e||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new Fw(e[0],e[1],e[2]),new Fw(s[0],s[1],s[2])),t.normalized){let e=vR(eR[t.componentType]);i.min.multiplyScalar(e),i.max.multiplyScalar(e)}}let s=e.targets;if(void 0!==s){let t=new Fw,e=new Fw;for(let r=0,i=s.length;r<i;r++){let i=s[r];if(void 0!==i.POSITION){let r=n.json.accessors[i.POSITION],s=r.min,o=r.max;if(void 0!==s&&void 0!==o){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),r.normalized){let t=vR(eR[r.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(t)}t.boundingBox=i;let o=new oS;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,t.boundingSphere=o}(t,e,n),Promise.all(i).then((function(){return void 0!==e.targets?function(t,e,n){let r=!1,i=!1,s=!1;for(let c=0,u=e.length;c<u;c++){let t=e[c];if(void 0!==t.POSITION&&(r=!0),void 0!==t.NORMAL&&(i=!0),void 0!==t.COLOR_0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(t);let o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){let u=e[c];if(r){let e=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):t.attributes.position;o.push(e)}if(i){let e=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):t.attributes.normal;a.push(e)}if(s){let e=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):t.attributes.color;l.push(e)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(e){let n=e[0],o=e[1],a=e[2];return r&&(t.morphAttributes.position=n),i&&(t.morphAttributes.normal=o),s&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}var xR=class{constructor(t,e,n,r){this.animations={},this.position=new Fw(0,0,0),this.lastPosition=new Fw(0,0,0),this.quaternion=null,this.isOwnAvatar=!1,this.currentAnimation=null,this.lastWorldModelPos=new Fw(0,0,0),this.worldPosition=new Fw(0,0,0),this.load=async()=>{let t=new SI;return new Promise(((e,n)=>{t.load(this.url,(async t=>{this.mixer=new FA(t.scene),t.animations.forEach((t=>{let e=this.mixer.clipAction(t);this.animations[t.name]=e,this.animations[t.name].paused=!0})),t.scene.scale.set(this.scale,this.scale,this.scale),t.scene.rotation.set(0,3.14,0),t.scene.position.set(0,this.height,0);let n=new HS;n.add(t.scene),this.model=t.scene,this.root=n,e(this.root)}),void 0,(t=>{console.error("An error happened loading the avatar",t),n(t)}))}))},this.url=t,this.scale=e,this.height=n,this.clock=new SA,this.mixer=null,this.isOwnAvatar=r,this.animations={},this.isMoving=!1,this.isMovingCounter=0,this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this))}setPosition(t){this.position.set(t.x,t.y,t.z)}setQuaternion(t){this.quaternion=new Uw(t.x,t.y,t.z,t.w)}destroy(){cancelAnimationFrame(this.lerpAnimationFrame),this.root.parent.remove(this.root)}animate(){if(requestAnimationFrame(this.animate.bind(this)),!this.position||!this.quaternion)return;this.lastPosition.set(this.position.x,this.position.y,this.position.z);let t=this.clock.getDelta(),e=this.isOwnAvatar?6:2,n=this.root.position.clone();n.lerp(this.position,e*t),this.root.position.set(n.x,n.y,n.z);let r=this.root.quaternion.clone();r.slerp(this.quaternion,e*t),this.root.quaternion.set(r.x,r.y,r.z,r.w),this.mixer.update(t),this.model.getWorldPosition(this.worldPosition);let i=this.isOwnAvatar?.001:.004,s=this.isOwnAvatar?10:30;this.lastWorldModelPos.distanceTo(this.worldPosition)<i?(this.isMovingCounter++,this.isMovingCounter>s&&(this.isMoving=!1,this.isMovingCounter=0)):this.isMoving=!0,this.model.getWorldPosition(this.lastWorldModelPos)}playAnimation(t){if(!this.animations[t])return;let e=this.animations[t];if(e&&this.currentAnimation!==t){if(e.paused=!1,e.enabled=!0,e.play(),this.currentAnimation&&this.animations[this.currentAnimation]){let t=this.isOwnAvatar?.3:.7;this.animations[this.currentAnimation].crossFadeTo(e,t,!0)}this.currentAnimation=t}}stopAnimation(t){this.animations[t]&&(this.animations[t].paused=!0)}stopAllAnimations(){Object.values(this.animations).forEach((t=>{t.paused=!0}))}};function wR(t,e,n){return e=TR(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,SR()?Reflect.construct(e,n||[],TR(t).constructor):e.apply(t,n))}function SR(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(SR=function(){return!!t})()}function MR(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function ER(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,MR(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function TR(t){return TR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},TR(t)}function AR(t,e){return(AR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function CR(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,c=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,i=u}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return a}}(t,e)||IR(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function PR(t){return function(t){if(Array.isArray(t))return RR(t)}(t)||function(t){if(typeof Symbol<"u"&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||IR(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function IR(t,e){if(t){if("string"==typeof t)return RR(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return RR(t,e)}}function RR(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var LR=typeof window<"u"&&window.THREE?window.THREE:{LinearFilter:Ux,Sprite:TE,SpriteMaterial:pE,SRGBColorSpace:Xx,Texture:Dw},NR=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rgba(255, 255, 255, 1)";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=wR(this,e,[new LR.SpriteMaterial]))._text="".concat(n),t._textHeight=r,t._color=i,t._backgroundColor=!1,t._padding=0,t._borderWidth=0,t._borderRadius=0,t._borderColor="white",t._strokeWidth=0,t._strokeColor="white",t._fontFace="system-ui",t._fontSize=90,t._fontWeight="normal",t._canvas=document.createElement("canvas"),t._genCanvas(),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&AR(t,e)}(e,t),ER(e,[{key:"text",get:function(){return this._text},set:function(t){this._text=t,this._genCanvas()}},{key:"textHeight",get:function(){return this._textHeight},set:function(t){this._textHeight=t,this._genCanvas()}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._genCanvas()}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._genCanvas()}},{key:"padding",get:function(){return this._padding},set:function(t){this._padding=t,this._genCanvas()}},{key:"borderWidth",get:function(){return this._borderWidth},set:function(t){this._borderWidth=t,this._genCanvas()}},{key:"borderRadius",get:function(){return this._borderRadius},set:function(t){this._borderRadius=t,this._genCanvas()}},{key:"borderColor",get:function(){return this._borderColor},set:function(t){this._borderColor=t,this._genCanvas()}},{key:"fontFace",get:function(){return this._fontFace},set:function(t){this._fontFace=t,this._genCanvas()}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._genCanvas()}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(t){this._fontWeight=t,this._genCanvas()}},{key:"strokeWidth",get:function(){return this._strokeWidth},set:function(t){this._strokeWidth=t,this._genCanvas()}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this._strokeColor=t,this._genCanvas()}},{key:"_genCanvas",value:function(){var t=this,e=this._canvas,n=e.getContext("2d"),r=Array.isArray(this.borderWidth)?this.borderWidth:[this.borderWidth,this.borderWidth],i=r.map((function(e){return e*t.fontSize*.1})),s=(Array.isArray(this.borderRadius)?this.borderRadius:[this.borderRadius,this.borderRadius,this.borderRadius,this.borderRadius]).map((function(e){return e*t.fontSize*.1})),o=Array.isArray(this.padding)?this.padding:[this.padding,this.padding],a=o.map((function(e){return e*t.fontSize*.1})),l=this.text.split("\n"),c="".concat(this.fontWeight," ").concat(this.fontSize,"px ").concat(this.fontFace);n.font=c;var u=Math.max.apply(Math,PR(l.map((function(t){return n.measureText(t).width})))),h=this.fontSize*l.length;if(e.width=u+2*i[0]+2*a[0],e.height=h+2*i[1]+2*a[1],this.borderWidth){if(n.strokeStyle=this.borderColor,i[0]){var d=i[0]/2;n.lineWidth=i[0],n.beginPath(),n.moveTo(d,s[0]),n.lineTo(d,e.height-s[3]),n.moveTo(e.width-d,s[1]),n.lineTo(e.width-d,e.height-s[2]),n.stroke()}if(i[1]){var p=i[1]/2;n.lineWidth=i[1],n.beginPath(),n.moveTo(Math.max(i[0],s[0]),p),n.lineTo(e.width-Math.max(i[0],s[1]),p),n.moveTo(Math.max(i[0],s[3]),e.height-p),n.lineTo(e.width-Math.max(i[0],s[2]),e.height-p),n.stroke()}if(this.borderRadius){var f=Math.max.apply(Math,PR(i)),m=f/2;n.lineWidth=f,n.beginPath(),[!!s[0]&&[s[0],m,m,s[0]],!!s[1]&&[e.width-s[1],e.width-m,m,s[1]],!!s[2]&&[e.width-s[2],e.width-m,e.height-m,e.height-s[2]],!!s[3]&&[s[3],m,e.height-m,e.height-s[3]]].filter((function(t){return t})).forEach((function(t){var e=CR(t,4),r=e[0],i=e[1],s=e[2],o=e[3];n.moveTo(r,s),n.quadraticCurveTo(i,s,i,o)})),n.stroke()}}this.backgroundColor&&(n.fillStyle=this.backgroundColor,this.borderRadius?(n.beginPath(),n.moveTo(i[0],s[0]),[[i[0],s[0],e.width-s[1],i[1],i[1],i[1]],[e.width-i[0],e.width-i[0],e.width-i[0],i[1],s[1],e.height-s[2]],[e.width-i[0],e.width-s[2],s[3],e.height-i[1],e.height-i[1],e.height-i[1]],[i[0],i[0],i[0],e.height-i[1],e.height-s[3],s[0]]].forEach((function(t){var e=CR(t,6),r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5];n.quadraticCurveTo(r,o,i,a),n.lineTo(s,l)})),n.closePath(),n.fill()):n.fillRect(i[0],i[1],e.width-2*i[0],e.height-2*i[1])),n.translate.apply(n,PR(i)),n.translate.apply(n,PR(a)),n.font=c,n.fillStyle=this.color,n.textBaseline="bottom";var g=this.strokeWidth>0;g&&(n.lineWidth=this.strokeWidth*this.fontSize/10,n.strokeStyle=this.strokeColor),l.forEach((function(e,r){var i=(u-n.measureText(e).width)/2,s=(r+1)*t.fontSize;g&&n.strokeText(e,i,s),n.fillText(e,i,s)})),this.material.map&&this.material.map.dispose();var v=this.material.map=new LR.Texture(e);v.minFilter=LR.LinearFilter,v.colorSpace=LR.SRGBColorSpace,v.needsUpdate=!0;var y=this.textHeight*l.length+2*r[1]+2*o[1];this.scale.set(y*e.width/e.height,y,0)}},{key:"clone",value:function(){return new this.constructor(this.text,this.textHeight,this.color).copy(this)}},{key:"copy",value:function(t){return LR.Sprite.prototype.copy.call(this,t),this.color=t.color,this.backgroundColor=t.backgroundColor,this.padding=t.padding,this.borderWidth=t.borderWidth,this.borderColor=t.borderColor,this.fontFace=t.fontFace,this.fontSize=t.fontSize,this.fontWeight=t.fontWeight,this.strokeWidth=t.strokeWidth,this.strokeColor=t.strokeColor,this}}]),e}(LR.Sprite),OR=class{constructor(t,e,n,r){if(this.load=async()=>{let t=this.height,e=new FontFace("OpenSans-SemiBold","url(https://superviz2homologmediaserver.s3.amazonaws.com/static/fonts/OpenSans-SemiBold.woff)");await e.load(),document.fonts.add(e);let n=this.createTextGeometry(this.name,this.color);this.text=n;let r=new HS;return r.add(n),n.position.set(0,t,0),this.model=r,this.model},this.createTextGeometry=(t,e)=>{var n;let{scale:r}=this,i=(null==(n=this.slot)?void 0:n.textColor)??"#fff",s=e,o=new NR(t,.1);return o.color=i,o.padding=2.7,o.backgroundColor=s,o.fontFace="OpenSans-SemiBold",o.fontSize=100,o.material.sizeAttenuation=!0,o.borderRadius=8,o.scale.multiplyScalar(r),o},this.destroy=()=>{this.model.remove(this.text)},this.name=t,this.scale=r,e)this.color=e.color;else{let t="#878291";this.color=t}this.height=n,this.slot=e}},kR=class{constructor(t,e,n){this.destPos=new Fw(0,0,0),this.curPos=new Fw(0,0,0),this.startPos=new Fw(0,0,0),this.counter=0,this.slot=null,this.lastSlot=null,this.lastDestPos=new Fw(1e3,1e3,1e3),this.lastStartPos=new Fw(1e3,1e3,1e3),this.createdMaterial=!1,this.tempStartVec=new Fw(0,0,0),this.update=function(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.slot=r,this.destPos.x=e.x,this.destPos.y=e.y,this.destPos.z=e.z,this.tempStartVec.copy(this.origin),this.tempStartVec.applyQuaternion(n),this.startPos.copy(t),this.startPos.add(this.tempStartVec),this.counter=0}.bind(this),this.clock=new SA,this.origin=n,this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this))}load(){this.createMaterial(),this.root=new HS,0===this.origin.x&&0===this.origin.y&&0===this.origin.z&&this.origin.set(0,-.1,0)}animate(){if(this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this)),!this.createdMaterial)return;let t=this.clock.getDelta();if(!(this.counter>2&&this.lastDestPos.equals(this.destPos)&&this.lastStartPos.distanceTo(this.startPos)<.2)){if(this.counter++,this.lastSlot!==this.slot){let t=this.slot.color??"#878291";this.material&&(this.material.color.set(t),this.lastSlot=this.slot)}this.curPos.lerp(this.destPos,t/1e3*1e4),this.lastDestPos.x=this.destPos.x,this.lastDestPos.y=this.destPos.y,this.lastDestPos.z=this.destPos.z,this.lastStartPos.x=this.startPos.x,this.lastStartPos.y=this.startPos.y,this.lastStartPos.z=this.startPos.z,this.updateMesh(this.startPos,this.curPos)}}destroy(){this.material&&this.material.dispose(),cancelAnimationFrame(this.lerpAnimationFrame),this.root.parent&&this.root.parent.remove(this.root)}createMaterial(){let t=this.createTextureCanvas(),e=new Dw(t);e.needsUpdate=!0;let n=this.slot.color??"#878291";this.material=new lM({map:e,blending:2,color:n,side:2,depthWrite:!0,transparent:!0}),this.createdMaterial=!0}updateMesh(t,e){let n=new PT(t,e);this.mesh&&this.mesh.geometry&&(this.mesh.geometry.dispose(),this.root.remove(this.mesh));let r=new LT(n,1,.003,4,!1);this.material&&(this.mesh=new BM(r,this.material),this.root.add(this.mesh))}createTextureCanvas(){let t=document.createElement("canvas"),e=t.getContext("2d");t.width=1,t.height=64;let n=e.createLinearGradient(0,0,t.width,t.height);return n.addColorStop(0,"rgba(  0,  0,  0,0.1)"),n.addColorStop(.1,"rgba(160,160,160,0.3)"),n.addColorStop(.5,"rgba(255,255,255,0.5)"),n.addColorStop(.9,"rgba(160,160,160,0.3)"),n.addColorStop(1,"rgba(  0,  0,  0,0.1)"),e.fillStyle=n,e.fillRect(0,0,t.width,t.height),t}},DR=class{constructor(t){this.destPos=new Fw(0,0,0),this.curPos=new Fw(0,0,0),this.counter=0,this.slot=null,this.lastSlot=null,this.lastDestPos=new Fw(1e3,1e3,1e3),this.update=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!t||void 0===e||(this.colorIndex=e,this.destPos.x=t.x,this.destPos.y=t.y,this.destPos.z=t.z,this.counter=0)}.bind(this),this.createTextGeometry=(t,e)=>{var n;let r=(null==(n=this.slot)?void 0:n.textColor)??"#fff",i=e,s=new NR(t,.1);return s.color=r,s.padding=2.7,s.borderRadius=8,s.backgroundColor=i,s.fontFace="OpenSans-SemiBold",s.fontSize=120,s.scale.set(.005*s.scale.x,.005*s.scale.y,.005*s.scale.z),s.material.sizeAttenuation=!1,s.material.depthTest=!1,s.center.set(-.15,1),s},this.createArrowGeometry=async t=>{if(t)return new Promise((e=>{let n,r=`https://production.cdn.superviz.com/static/mouse-pointers/${t.colorName}.svg`;(new oA).load(r,(t=>{n=t;let r=new pE({map:n,color:16777215,fog:!1,sizeAttenuation:!1}),i=new TE(r);i.scale.set(.02,.02,.02),i.center.set(.2,.23),e(i)}))}))},this.clock=new SA,this.scene=t,this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this))}async load(t,e){if(this.root=new HS,this.slot=e,t.trim().length){let n=new FontFace("OpenSans-SemiBold","url(https://superviz2homologmediaserver.s3.amazonaws.com/static/fonts/OpenSans-SemiBold.woff)");await n.load(),document.fonts.add(n),this.textMesh=this.createTextGeometry(t,e.color),this.textMesh.position.set(0,0,0),this.root.add(this.textMesh)}return this.arrowMesh=await this.createArrowGeometry(e),this.root.add(this.arrowMesh),this.scene.add(this.root),this.root}async animate(){var t;this.lerpAnimationFrame=requestAnimationFrame(this.animate.bind(this));let e=this.clock.getDelta();if(!(this.counter>30&&this.lastDestPos.equals(this.destPos))){if(this.counter++,void 0!==this.slot&&this.lastSlot!==this.slot&&this.backgroundMaterial){let e=new iM((null==(t=this.slot)?void 0:t.color)??"#878291");this.backgroundMaterial.color.set(e),this.lastSlot=this.slot,this.root.remove(this.arrowMesh),this.arrowMesh=await this.createArrowGeometry(this.slot),this.root.add(this.arrowMesh)}this.curPos.lerp(this.destPos,e/1e3*1e4),this.lastDestPos.x=this.destPos.x,this.lastDestPos.y=this.destPos.y,this.lastDestPos.z=this.destPos.z,this.root.position.copy(this.curPos)}}destroy(){this.backgroundMaterial&&this.backgroundMaterial.dispose(),cancelAnimationFrame(this.lerpAnimationFrame),this.root.parent&&this.root.parent.remove(this.root)}},zR=dx(Rx()),UR=class{constructor(){var t=this;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.subscribe=t=>{this.callbacks.push(t)},this.unsubscribe=t=>{this.callbacks=this.callbacks.filter((e=>e!==t))},this.publish=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.callbacks&&t.callbacks.forEach((e=>{t.callListener(e,n).catch((r=>{t.logger.log("superviz-sdk:observer-helper:publish:error",`\n            Failed to execute callback on publish value.\n            Callback: ${e}\n            Event: ${JSON.stringify(n)}\n            Error: ${r}\n          `)}))}))},this.reset=()=>{this.callbacks=[]},this.destroy=()=>{delete this.logger,delete this.callbacks},this.callListener=(t,e)=>new Promise(((n,r)=>{try{n(t(...e))}catch(i){r(i)}}));let{logger:n,throttleTime:r}=e;this.logger=n??new xI("@superviz/sdk/observer-helper"),this.throttle=r,this.callbacks=[],this.throttle&&(this.publish=(0,zR.default)(this.publish,this.throttle))}},FR="https://production.storage.superviz.com/readyplayerme/1.glb",BR="global-store",VR="presence-3d-store";typeof window<"u"&&(window.Presence3D=class{constructor(t,e,n,r){if(this.participants=[],this.isPrivate=!1,this.isAttached=!1,this.currentLocalPointerDest=new Fw(0,0,0),this.avatars={},this.lasers={},this.mouses={},this.names={},this.positionInfos={},this.laserUpdateIntervals={},this.syncInterval=null,this.tempQuat=new Uw(0,0,0,0),this.mouse=new vw(0,0),this.mouse3D=new Fw(0,0,0),this.worldPosition=new Fw(0,0,0),this.worldQuat=new Uw(0,0,0,0),this.unsubscribeFrom=[],this.attach=t=>{if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){let t=`${this.name} @ attach - params are required`;throw this.logger.log(t),new Error(t)}this.logger.log("attached");let{eventBus:e,useStore:n,ioc:r,Presence3DManagerService:i}=t;this.isAttached=!0,this.eventBus=e,this.useStore=n.bind(this),this.room=r.createRoom(this.name),this.presence3DManager=new i(this.room,this.useStore);let{hasJoined3D:s,participants:o}=this.useStore(VR);s.subscribe(),o.subscribe(this.onParticipantsUpdated);let{localParticipant:a,hasJoinedRoom:l}=this.useStore(BR);this.localParticipant=a.value,a.subscribe((t=>{this.localParticipant=t})),l.subscribe(),this.start()},this.detach=()=>{this.isAttached?(this.logger.log("detached"),this.destroy(),this.unsubscribeFrom.forEach((t=>t(this))),this.localParticipant=void 0,this.isAttached=!1):this.logger.log(`${this.name} @ detach - component is not attached}`)},this.destroy=()=>{this.unsubscribeFromRealtimeEvents(),this.unsubscribeToEventBusEvents(),this.room.disconnect(),this.room=void 0,this.participants.forEach((t=>{this.presence3DManager.unsubscribeFromUpdates(t.id,this.onParticipantUpdated)})),this.presence3DManager=void 0,this.useStore(VR).destroy(),this.useStore=void 0,this.participants.forEach((t=>{this.removeParticipant(t,!0)})),Object.keys(this.laserUpdateIntervals).forEach((t=>{clearInterval(this.laserUpdateIntervals[t])})),window.removeEventListener("pointermove",this.onPointerMove),clearInterval(this.syncInterval),this.laserUpdateIntervals={},this.avatars={},this.lasers={},this.positionInfos={}},this.start=()=>{if(!this.hasJoinedRoom||!this.hasJoined3D||!this.localParticipant)return this.logger.log("three js component @ start - not joined yet"),void setTimeout((()=>{this.logger.log("three js component @ start - retrying"),this.start()}),1e3);this.subscribeToRealtimeEvents(),this.subscribeToEventBusEvents()},this.subscribeToRealtimeEvents=()=>{this.logger.log("three js component @ subscribeToRealtimeEvents"),this.room.on("participant-joined",this.onParticipantJoined),this.room.on("gather",this.onGatherUpdate),this.room.on("follow-me",this.onFollowParticipantUpdate),this.room.presence.on("presence.leave",this.onParticipantLeave)},this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("three js component @ unsubscribeFromRealtimeEvents"),this.room.presence.off("presence.leave"),this.room.off("participant-joined",this.onParticipantJoined),this.room.off("gather",this.onGatherUpdate),this.room.off("follow-me",this.onFollowParticipantUpdate)},this.subscribeToEventBusEvents=()=>{this.logger.log("three js component @ subscribeToEventBusEvents"),this.eventBus.subscribe("realtime.go-to-participant",this.goTo),this.eventBus.subscribe("realtime.local-follow-participant",this.localFollow),this.eventBus.subscribe("realtime.follow-participant",this.follow),this.eventBus.subscribe("realtime.private-mode",this.setPrivate)},this.unsubscribeToEventBusEvents=()=>{this.logger.log("three js component @ unsubscribeToEventBusEvents"),this.eventBus.unsubscribe("realtime.go-to-participant",this.goTo),this.eventBus.unsubscribe("realtime.local-follow-participant",this.localFollow),this.eventBus.unsubscribe("realtime.follow-participant",this.follow),this.eventBus.unsubscribe("realtime.private-mode",this.setPrivate)},this.onParticipantJoined=t=>{if(!t.data)return;this.logger.log("three js component @ onParticipantJoined",t);let{id:e,name:n,avatar:r,avatarConfig:i,type:s,slot:o}=t.data;e===this.localParticipantId&&this.onParticipantLocalJoined(t),this.addParticipant({id:e,name:n,avatar:r,avatarConfig:i,type:s,slot:o})},this.onParticipantLocalJoined=t=>{var e,n,r,i;this.createParticipantList(),this.config.avatarConfig&&this.presence3DManager.setParticipantData({avatarConfig:this.config.avatarConfig}),null!=(e=t.avatar)&&e.model3DUrl&&this.presence3DManager.setParticipantData({avatar:{model3DUrl:null==t?void 0:t.avatar.model3DUrl,imageUrl:null==(n=null==t?void 0:t.avatar)?void 0:n.imageUrl}}),null!=(r=t.avatar)&&r.model3DUrl||this.presence3DManager.setParticipantData({avatar:{model3DUrl:FR,imageUrl:null==(i=null==t?void 0:t.avatar)?void 0:i.imageUrl}})},this.onParticipantLeave=t=>{this.logger.log("three js component @ onParticipantLeave",t.data);let e=this.participants.find((e=>e.id===t.id));e&&this.removeParticipant(e,!0)},this.onParticipantUpdated=t=>{this.logger.log("three js component @ onParticipantUpdated",t);let{id:e,name:n,avatar:r,avatarConfig:i,position:s,rotation:o,type:a,slot:l}=t.data??t,c=this.followParticipantId??this.localFollowParticipantId;c&&c===e&&this.moveToAnotherParticipant(c),this.updateParticipant({position:s,rotation:o,id:e,name:n,avatar:r,avatarConfig:i,type:a,slot:l})},this.updateParticipant=async t=>{var e,n,r;if(null!=t&&t.id&&(null==(e=this.participants)||!e.length))return void this.addParticipant(t);if(!this.participants||0===this.participants.length||!t||!t.id)return;let i=this.participants.find((e=>e.id===t.id));if(i||t.isPrivate){if((null==(n=i.avatar)?void 0:n.model3DUrl)===(null==(r=t.avatar)?void 0:r.model3DUrl)&&(0,Lx.isEqual)((0,Lx.pickBy)(i.avatarConfig,Lx.identity),(0,Lx.pickBy)(t.avatarConfig,Lx.identity))&&i.name===t.name){let e=this.participants.findIndex((e=>e.id===t.id));-1!==e&&(this.participants[e]=t)}else{this.removeParticipant(t,!1);let e=this.createParticipantOn3D(t);this.participants.push(e),(i.id!==this.localParticipantId||this.config.renderLocalAvatar)&&this.create3dPresence(e)}this.logger.log("three js component @ updateParticipant",{participant:t,participants:this.participants})}else this.addParticipant(t)},this.createParticipantList=()=>{let t=this.useStore(VR).participants.value;Object.values(t).forEach((t=>{t.isPrivate||this.addParticipant(t)})),this.logger.log("three js component @ createParticipantList",this.participants)},this.createParticipantOn3D=t=>{let{id:e,name:n,avatar:r,avatarConfig:i,type:s,...o}=t,a={id:e,name:n,avatar:r,isAudience:"audience"===s,avatarConfig:e===this.localParticipantId?this.config.avatarConfig:i,position:{x:0,y:0,z:0},rotation:{x:0,y:0},...o};return this.logger.log("three js component @ createParticipantOn3D",a),a},this.removeParticipant=(t,e)=>{var n;this.logger.log("three js component @ removeParticipant",{participant:t,unsubscribe:e}),this.participants=this.participants.filter((e=>e.id!==t.id)),this.destroyAvatar(t),this.destroyLaser(t),this.destroyMouse(t),e&&(null==(n=this.presence3DManager)||n.unsubscribeFromUpdates(t.id,this.onParticipantUpdated))},this.addParticipant=async t=>{if(!t||!t.id||"audience"===t.type||!this.localParticipantId)return;let e=this.createParticipantOn3D(t);if(this.participants.find((t=>t.id===e.id)))return this.logger.log("three js component @ addParticipant - participant already exists"),void this.onParticipantUpdated(t);this.participants.push(e),this.logger.log("three js component @ addParticipant",{participant:t,participantOn3D:e,participants:this.participants}),this.presence3DManager.subscribeToUpdates(e.id,this.onParticipantUpdated),(!this.localParticipantId||t.id!==this.localParticipantId||this.config.renderLocalAvatar)&&this.create3dPresence(e)},this.goTo=t=>{this.logger.log("three js component @ goTo",t),this.moveToAnotherParticipant(t)},this.gather=()=>{this.logger.log("three js component @ gather"),this.room.emit("gather",{id:this.localParticipant.id})},this.setPrivate=t=>{this.logger.log("three js component @ private mode"),this.presence3DManager.updatePresence3D({id:this.localParticipantId,isPrivate:!!t}),this.isPrivate=!!t},this.follow=t=>{this.logger.log("three js component @ follow"),this.room.emit("follow-me",{id:t})},this.localFollow=t=>{this.localFollowParticipantId=t},this.onPointerMove=t=>{this.mouse.x=t.clientX/window.innerWidth*2-1,this.mouse.y=-t.clientY/window.innerHeight*2+1,void 0===this.raycaster&&(this.raycaster=new VA),this.raycaster.setFromCamera(this.mouse,this.camera);let e=this.raycaster.intersectObjects(this.scene.children,!0);if(e.length>0){let{point:t}=e[0];this.camera.getWorldPosition(this.mouse3D),t.lerp(this.mouse3D,.005),this.currentLocalPointerDest=t}},this.checkPlayerChanges=()=>{if(!this.hasJoined3D)return;this.player.getWorldPosition(this.worldPosition),this.player.getWorldQuaternion(this.worldQuat);let t={position:{x:this.worldPosition.x,y:this.worldPosition.y,z:this.worldPosition.z},quaternion:{x:this.worldQuat.x,y:this.worldQuat.y,z:this.worldQuat.z,w:this.worldQuat.w},pointer:{x:this.currentLocalPointerDest.x,y:this.currentLocalPointerDest.y,z:this.currentLocalPointerDest.z},isPrivate:this.isPrivate},{participants:e}=this.useStore(VR),n=e.value.find((t=>t.id===this.localParticipantId)),r={position:null==n?void 0:n.position,quaternion:null==n?void 0:n.quaternion,pointer:null==n?void 0:n.pointer,isPrivate:null==n?void 0:n.isPrivate};!(0,Lx.isEqual)(t,r)&&!this.isPrivate&&this.presence3DManager.updatePresence3D({id:this.localParticipantId,...t});let i=this.avatars[this.localParticipantId],{localParticipant:s}=this.useStore(BR),{slot:o}=s.value;i&&(this.updateAvatar(i,this.worldPosition,this.worldQuat),i.model.getWorldPosition(this.worldPosition),i.model.getWorldQuaternion(this.tempQuat),this.names[this.localParticipantId]&&void 0!==o&&this.names[this.localParticipantId].slot!==o&&this.names[this.localParticipantId].text&&(this.names[this.localParticipantId].slot=o,this.names[this.localParticipantId].text.backgroundColor=o.color??"#878291")),this.lasers[this.localParticipantId]&&this.updateLaser(this.lasers[this.localParticipantId],this.worldPosition,this.currentLocalPointerDest,this.tempQuat,o),this.mouses[this.localParticipantId]&&this.mouses[this.localParticipantId].update(this.currentLocalPointerDest,o)},this.onParticipantsUpdated=t=>{this.isAttached&&(this.logger.log("three js component @ onParticipantsUpdated",t),Object.values(t).forEach((t=>{if(t.id===this.localParticipantId)return;let e=t.id,{position:n,quaternion:r,pointer:i,isPrivate:s}=t;if(!s&&!this.participants.find((e=>e.id===t.id)))return void this.addParticipant(t);let{slot:o}=t;this.positionInfos[e]={position:n,quaternion:r,pointer:i},s&&this.avatars[e]&&this.removeParticipant(t,!0),!s&&!this.avatars[e]&&this.addParticipant(t);let a=this.avatars[e];a&&(n&&r&&this.updateAvatar(a,n,r),a.root.getWorldQuaternion(this.tempQuat),this.names[e]&&void 0!==o&&this.names[e].slot.index!==o.index&&(this.names[e].destroy(),this.createName(t,this.avatars[e].root)));let l=this.lasers[e];l&&(this.laserUpdateIntervals[e]&&clearInterval(this.laserUpdateIntervals[e]),this.laserUpdateIntervals[e]=setInterval((()=>{this.updateLaser(l,n,i,this.tempQuat,o)}),30)),this.mouses[e]&&this.mouses[e].update(i,o)})))},this.onFollowParticipantUpdate=t=>{t.data.id!==this.localParticipantId&&(this.logger.log("three js component @ onFollowParticipantUpdate",t.data.id),this.followParticipantId=t.data.id,this.moveToAnotherParticipant(t.data.id))},this.onGatherUpdate=t=>{this.logger.log("three js component @ onGatherUpdate",t.data.id),t.data.id!==this.localParticipantId&&this.eventBus.publish("realtime.go-to-participant",t.data.id)},typeof window>"u")throw new Error("[SuperViz] Presence3D component cannot be initialized in a non-browser environment. Window is not defined");this.name="presence3dThreejs",this.logger=new xI("@superviz/sdk/three-js-component"),this.logger.log("three js component @ constructor",{scene:t,camera:e,player:n,options:r}),this.config={isAvatarsEnabled:(null==r?void 0:r.isAvatarsEnabled)??!0,isLaserEnabled:(null==r?void 0:r.isLaserEnabled)??!0,isNameEnabled:(null==r?void 0:r.isNameEnabled)??!0,isMouseEnabled:(null==r?void 0:r.isMouseEnabled)??!0,renderLocalAvatar:(null==r?void 0:r.renderLocalAvatar)??!1,avatarConfig:null==r?void 0:r.avatarConfig},this.logger.log("three js component @ constructor - config",this.config),wM.prototype.computeBoundsTree=yI,wM.prototype.disposeBoundsTree=_I,BM.prototype.raycast=vI,this.createdPointerMoveEvent=!1,this.scene=t,this.camera=e,this.player=n,this.syncInterval=setInterval(this.checkPlayerChanges,30)}get localParticipantId(){var t;return null==(t=this.localParticipant)?void 0:t.id}async create3dPresence(t){if(this.config.isAvatarsEnabled){let e=await this.createAvatar(t);this.config.isNameEnabled&&this.createName(t,e)}this.config.isMouseEnabled&&this.createMouse(t),this.config.isLaserEnabled&&this.createLaser(t)}async destroyAvatar(t){this.avatars[t.id]&&(this.mouses[t.id]&&this.mouses[t.id].destroy(),this.avatars[t.id].destroy(),delete this.avatars[t.id],this.avatars[t.id]=null,this.mouses[t.id]=null)}async destroyLaser(t){this.lasers[t.id]&&(this.lasers[t.id].destroy(),delete this.lasers[t.id],this.lasers[t.id]=null)}async destroyMouse(t){this.mouses[t.id]&&(this.mouses[t.id].destroy(),delete this.mouses[t.id],this.mouses[t.id]=null)}moveToAnotherParticipant(t){if(t===this.localParticipantId||!this.positionInfos[t])return;let e=this.positionInfos[t].position,n=this.positionInfos[t].quaternion,r=setInterval((()=>{let t=this.player.position.clone();t.lerp(e,.1),this.player.position.set(t.x,t.y,t.z);let r=this.player.quaternion.clone();r.slerp(n,.1),this.player.quaternion.set(r.x,r.y,r.z,r.w)}),1);setTimeout((()=>{clearInterval(r)}),1e3)}async createAvatar(t){var e,n,r;if(!this.isAttached)return;this.avatars[t.id]&&this.avatars[t.id].destroy();let i=t.id===this.localParticipantId;if(i&&!this.config.renderLocalAvatar)return;let s=(null==(e=t.avatarConfig)?void 0:e.scale)||1,o=(null==(n=t.avatarConfig)?void 0:n.height)||0,a=(null==(r=t.avatar)?void 0:r.model3DUrl)??FR,l=new xR(a,s,o,i),c=await l.load();return this.avatars[t.id]&&this.avatars[t.id].root.parent.remove(this.avatars[t.id].root),this.scene.add(c),this.avatars[t.id]=l,this.lasers[t.id]&&this.scene.add(this.lasers[t.id].root),c}async createName(t,e){var n;if(!this.isAttached||!t.name.trim().length)return;e.traverse((t=>{t.geometry&&t.geometry.computeBoundingBox()}));let r=((null==(n=t.avatar)?void 0:n.model3DUrl)??FR).includes("readyplayerme"),i=(new Hw).setFromObject(e),s=new Fw(0,0,0);i.getSize(s);let{slot:o}=t,a=1.2*s.y;r&&(a=2.3*s.y);let l=i.max.y/50,c=new OR(t.name,o,a,l),u=await c.load();e.add(u),this.names[t.id]=c}async createLaser(t){var e;if(this.logger.log("three js component @ createLaser",t),!this.isAttached||!t.avatarConfig||t.id===this.localParticipantId&&!this.config.renderLocalAvatar)return;this.lasers[t.id]&&this.lasers[t.id].destroy();let n=new Fw(0,0,0);null!=(e=t.avatarConfig)&&e.laserOrigin&&(n=new Fw(t.avatarConfig.laserOrigin.x,t.avatarConfig.laserOrigin.y,t.avatarConfig.laserOrigin.z));let r=new kR(this.camera,this.scene,n);this.lasers[t.id]=r,r.load(),this.createdPointerMoveEvent||(this.createdPointerMoveEvent=!0,window.addEventListener("pointermove",this.onPointerMove))}createMouse(t){if(!this.isAttached||t.id===this.localParticipantId&&!this.config.renderLocalAvatar)return;this.mouses[t.id]&&this.mouses[t.id].destroy();let e=new DR(this.scene);this.mouses[t.id]=e;let{slot:n}=t;e.load(t.name,n),this.raycaster=new VA,this.createdPointerMoveEvent||(this.createdPointerMoveEvent=!0,window.addEventListener("pointermove",this.onPointerMove))}updateAvatar(t,e,n){!this.isAttached||!t||!e||!n||(t.setPosition(e),t.setQuaternion(n))}updateLaser(t,e,n,r,i){!e||!n||!r||!i||t.update(e,n,r,i)}},window.ThreeJsPin=class{constructor(t,e,n,r,i){this.isPinsVisible=!0,this.commentsSide="left",this.localParticipant={},this.hideTemporaryPin=t=>{var e;let n=t.target;this.showcaseDiv.contains(n)||null!=(e=this.pins.get("temporary-pin"))&&e.contains(n)||this.removeAnnotationPin("temporary-pin")},this.setPointerDownCoordinates=t=>{let{x:e,y:n}=t;this.pointerDownCoordinates={x:e,y:n}},this.setCommentsMetadata=t=>{this.commentsSide=t},this.annotationSelected=t=>{let{detail:e}=t;var n;let{uuid:r,haltGoToPin:i,newPin:s}=e;if(!r)return;s&&this.pins.get(r).setAttribute("newPin","");let o=JSON.parse((null==(n=this.selectedPin)?void 0:n.getAttribute("annotation"))??"{}");if(this.resetPins(),(null==o?void 0:o.uuid)===r)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let a=this.pins.get(r);if(!a)return;a.setAttribute("active",""),this.selectedPin=a;let l=JSON.parse(this.annotations.find((t=>t.uuid===r)).position);l&&!i&&this.onClickedPin(l)},this.resetPins=t=>{t&&"Escape"!==(null==t?void 0:t.key)||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)},this.onClick=t=>{if(!this.isActive)return;{let e=this.showcaseDiv.getBoundingClientRect(),{x:n,y:r}=this.pointerDownCoordinates,i=n-e.x,s=r-e.y,o=t.clientX-e.left,a=t.clientY-e.top;if(Math.hypot(o-i,a-s)>10)return}let e=new VA,n=new vw;this.camera.updateMatrixWorld();let r=this.showcaseDiv.getBoundingClientRect(),i=t.clientX-r.left,s=t.clientY-r.top;n.x=i/this.showcaseDiv.clientWidth*2-1,n.y=s/this.showcaseDiv.clientHeight*-2+1,e.setFromCamera(n,this.camera);let o=e.intersectObjects(this.scene.children,!0);if(o.length>0){let t=o.filter((t=>!t.object.isLine))[0];if(t){let e={x:t.point.x,y:t.point.y,z:t.point.z,type:"threejs"},n={position:e,camera:this.camera.position};this.resetSelectedPin(),this.onPinFixedObserver.publish(n),this.createTemporaryPin(e)}}},this.renderDivWrapper=()=>{let t=this.showcaseDiv.getBoundingClientRect(),e=this.divWrapper;e||(e=document.createElement("div"),e.id="superviz-autodesk-pins-wrapper"),e.style.position="absolute",e.style.top=`${this.showcaseDiv.offsetTop}px`,e.style.left=`${this.showcaseDiv.offsetLeft}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden",e.style.zIndex="1","static"===this.showcaseDiv.parentElement.style.position&&(this.showcaseDiv.parentElement.style.position="relative"),document.getElementById("superviz-autodesk-pins-wrapper")||this.showcaseDiv.parentElement.appendChild(e),this.divWrapper=e},this.distanceBetween=(t,e)=>{let n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return Math.sqrt(n*n+r*r+i*i)},this.onMouseMove=t=>{let{x:e,y:n}=t;this.mouseElement||(this.mouseElement=this.createMouseElement());let r=n-this.pinHeight;this.mouseElement.setAttribute("position",JSON.stringify({x:e,y:r}))},this.onMouseLeave=()=>{this.mouseElement&&(this.mouseElement.remove(),this.mouseElement=null),this.showcaseDiv.style.cursor="default"},this.onMouseEnter=()=>{this.mouseElement||(this.mouseElement=this.createMouseElement())},this.onToggleAnnotationSidebar=t=>{let{detail:e}=t,{open:n}=e;n||(this.pins.forEach((t=>{t.removeAttribute("active")})),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))},this.scene=t,this.camera=n,this.showcaseDiv=e.domElement,this.controls=i,this.player?this.player=r:this.player=n,this.logger=new xI("@superviz/sdk/comments-component/three-js-adapter"),this.isActive=!1,this.pins=new Map,this.pinHeight=40,this.onClickBinded=this.onClick.bind(this),this.animateBinded=this.animate.bind(this),document.body.style.position="relative",this.onPinFixedObserver=new UR,this.annotations=[],document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),this.renderAnnotationsPins(),this.animFrame=requestAnimationFrame(this.animateBinded),this.showcaseSides=this.showcaseDiv.getBoundingClientRect()}destroy(){document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),cancelAnimationFrame(this.animFrame),this.removeAnnotationsPins(),this.removeListeners(),this.mouseElement=null}setActive(t){this.isActive=t,this.isActive?this.addListeners():this.removeListeners()}setPinsVisibility(t){this.isPinsVisible=t,this.isPinsVisible?this.renderAnnotationsPins():this.removeAnnotationsPins()}updateAnnotations(t){this.logger.log("updateAnnotations",t),this.annotations=t,(this.isActive||this.isPinsVisible)&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}removeAnnotationPin(t){let e=this.pins.get(t);e&&(e.remove(),this.pins.delete(t),this.annotations=this.annotations.filter((e=>e.uuid!==t)))}createTemporaryPin(t){let e=document.getElementById("superviz-temporary-pin");this.temporaryPinCoordinates=t,e||(e=document.createElement("superviz-comments-annotation-pin"),e.id="superviz-temporary-pin",e.setAttribute("type","add"),e.setAttribute("showInput",""),e.setAttribute("containerSides",JSON.stringify(this.showcaseSides)),e.setAttribute("commentsSide",this.commentsSide),e.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),e.setAttribute("localAvatar",this.localParticipant.avatar??""),e.setAttribute("participantsList",JSON.stringify(this.participants)),e.setAttribute("localName",this.localParticipant.name??""),e.setAttribute("annotation",JSON.stringify({})),e.setAttributeNode(document.createAttribute("active")),e.style.pointerEvents="auto");let n=this.position3DToScreen(t,0,this.pinHeight),r={x:n.left,y:n.top,type:t.type};e.setAttribute("position",JSON.stringify(r)),this.divWrapper.appendChild(e),this.pins.set("temporary-pin",e),this.renderAnnotationsPins()}addListeners(){document.body.addEventListener("select-annotation",this.annotationSelected),this.showcaseDiv.addEventListener("pointerdown",this.setPointerDownCoordinates),this.showcaseDiv.addEventListener("click",this.onClickBinded),this.showcaseDiv.addEventListener("mousemove",this.onMouseMove),this.showcaseDiv.addEventListener("mouseout",this.onMouseLeave),this.showcaseDiv.addEventListener("mouseenter",this.onMouseEnter),document.body.addEventListener("keyup",this.resetPins),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){document.body.removeEventListener("select-annotation",this.annotationSelected),this.showcaseDiv.removeEventListener("pointerdown",this.setPointerDownCoordinates),this.showcaseDiv.removeEventListener("click",this.onClick),this.showcaseDiv.removeEventListener("mousemove",this.onMouseMove),this.showcaseDiv.removeEventListener("mouseout",this.onMouseLeave),this.showcaseDiv.removeEventListener("mouseenter",this.onMouseEnter),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("click",this.hideTemporaryPin)}animate(){(this.isActive||this.isPinsVisible)&&this.renderAnnotationsPins(),this.renderDivWrapper(),this.animFrame=requestAnimationFrame(this.animateBinded)}async renderAnnotationsPins(){if(this.annotations.forEach((async t=>{var e;if(!t.position)return;let n=null==(e=JSON.parse(t.position))?void 0:e.position;if("threejs"!==(null==n?void 0:n.type)||t.resolved)return;if(!this.pins.has(t.uuid))return void this.createPin(t,n);let r=this.position3DToScreen(n,0,this.pinHeight),i=await this.checkIsVisible(r,n),s=this.pins.get(t.uuid);i?(s.setAttribute("style","opacity: 1"),this.pins.get(t.uuid).setAttribute("position",JSON.stringify({x:r.left,y:r.top}))):s.setAttribute("style","opacity: 0")})),this.pins.get("temporary-pin")){let t=this.position3DToScreen(this.temporaryPinCoordinates,0,this.pinHeight),e=await this.checkIsVisible(t,this.temporaryPinCoordinates),n=this.pins.get("temporary-pin");e?(n.setAttribute("style","opacity: 1"),n.setAttribute("position",JSON.stringify({x:t.left,y:t.top}))):n.setAttribute("style","opacity: 0")}}createPin(t,e){let n=this.position3DToScreen(e,0,this.pinHeight),r=document.createElement("superviz-comments-annotation-pin");this.divWrapper.appendChild(r),r.setAttribute("type","show"),r.setAttribute("annotation",JSON.stringify(t)),r.setAttribute("position",JSON.stringify({x:n.left,y:n.top})),r.setAttribute("participantsList",JSON.stringify(this.participants)),r.style.pointerEvents="auto",this.pins.set(t.uuid,r)}removeAnnotationsPins(){this.pins.forEach((t=>{t.remove()})),this.pins.clear()}set participantsList(t){this.participants=t}resetSelectedPin(){this.selectedPin&&(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}onClickedPin(t){let e,n=new Fw(t.position.x,t.position.y,t.position.z),r=new Fw(t.camera.x,t.camera.y,t.camera.z);e=r.distanceTo(n)>3?r.lerp(n,.8):r,this.controls&&(this.controls.target=n);let i=setInterval((()=>{let t=this.player.position.clone();t.lerp(e,.02),this.player.position.set(t.x,t.y,t.z),this.player.lookAt(n)}),1);setTimeout((()=>{this.player.lookAt(n),clearInterval(i)}),1e3)}position3DToScreen(t,e,n){let r=new Fw(0,0,0);r.set(t.x,t.y,t.z),this.camera.updateMatrixWorld(),r.project(this.camera),this.showcaseDiv.getBoundingClientRect();let i=this.showcaseDiv.clientWidth/2,s=this.showcaseDiv.clientHeight/2;return r.x=r.x*i+i,r.y=-r.y*s+s,r.z=0,{top:r.y-n,left:r.x-e}}async checkIsVisible(t,e){let n=!1,r=new VA,i=new vw,s=t.left,o=t.top+this.pinHeight;i.x=s/this.showcaseDiv.clientWidth*2-1,i.y=o/this.showcaseDiv.clientHeight*-2+1,r.setFromCamera(i,this.camera);let a=r.intersectObjects(this.scene.children,!0);if(a.length>0){let t=a.filter((t=>!t.object.isLine))[0];if(t){let r=t.point,i=this.distanceBetween(r,e);Math.abs(i)<.2&&(n=!0)}}return n}createMouseElement(){let t=document.createElement("superviz-comments-annotation-pin");return t.setAttribute("type","add"),t.setAttribute("annotation",JSON.stringify({})),t.setAttribute("position",JSON.stringify({x:0,y:0})),document.body.appendChild(t),this.showcaseDiv.style.cursor="none",t}});function HR(e){let{position:n,styles:r,onMount:i,onUnmount:s,...o}=e;const{room:a,component:l,addComponent:c}=zn("whoIsOnline"),[u,h]=(0,t.useState)(null),d={mount:i,unmount:s};return(0,t.useEffect)((()=>{l&&Object.entries(d).forEach((t=>{let[e,n]=t;l.unsubscribe(e,n),n&&l.subscribe(e,n)}))}),[l,a,i,s]),(0,t.useEffect)((()=>{if(!a||u)return;const t=new Cn.U({position:n,styles:r,...o});c(t),h(Date.now())}),[a]),(0,t.useEffect)((()=>{!l&&u&&h(null)}),[l]),Ln.jsx(Ln.Fragment,{})}let jR=null;function WR(t){const e=document.createElement("a");e.setAttribute("download","reactflow.png"),e.setAttribute("href",t),e.click()}const GR=()=>{const[e,n]=(0,t.useState)(""),[r,i]=(0,t.useState)([]),{saveScenario:s,loadScenario:o,updateScenario:a,resetScenario:l}=ze(),{stopRoom:c}=function(){const{startRoom:e,stopRoom:n,hasJoinedRoom:r}=zn();return(0,t.useMemo)((()=>({startRoom:e,stopRoom:n,hasJoinedRoom:r})),[e,n,r])}();(0,t.useEffect)((()=>{(async()=>{const t=await(async()=>{const{data:t,error:e}=await Oe.from("scenarios").select("name");return e?(console.error("Errore durante il caricamento dei nomi degli scenari:",e),{error:e}):t.length>0?t.map((t=>t.name)):(console.warn("Nessuno scenario trovato."),[])})();t.error||i(t)})()}),[]);return(0,ke.jsxs)("div",{className:"topbar",children:[(0,ke.jsx)(Be(),{getItemValue:t=>t,items:r,renderItem:(t,e)=>(0,ke.jsx)("div",{className:e?"react-autocomplete-item-highlighted":"react-autocomplete-item",children:t},t),value:e,onChange:t=>n(t.target.value),onSelect:t=>n(t),inputProps:{placeholder:"Scenario Name",className:"react-autocomplete-input"}}),(0,ke.jsx)("button",{onClick:()=>{l(),n("")},className:"btn-top",children:"New Scenario"}),(0,ke.jsx)("button",{onClick:()=>{e?o(e):alert("Please enter a name for the scenario to load.")},className:"btn-top",children:"Load Scenario"}),(0,ke.jsx)("button",{onClick:()=>{e?s(e):alert("Please enter a name for the scenario.")},className:"btn-top",children:"Save Scenario"}),(0,ke.jsx)("button",{onClick:()=>{a()},className:"btn-top",children:"Update Scenario"}),(0,ke.jsx)("button",{onClick:()=>{(async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await Tn(t,e)).toDataURL()})(document.querySelector(".react-flow__viewport"),{style:{transform:"translate(0, 0) scale(1)"}}).then(WR)},className:"btn-top",children:"Download as Image"})]})};function qR(t){if("string"===typeof t||"number"===typeof t)return""+t;let e="";if(Array.isArray(t))for(let n,r=0;r<t.length;r++)""!==(n=qR(t[r]))&&(e+=(e&&" ")+n);else for(let n in t)t[n]&&(e+=(e&&" ")+n);return e}var $R=n(8443);const XR=t=>{let e;const n=new Set,r=(t,r)=>{const i="function"===typeof t?t(e):t;if(!Object.is(i,e)){const t=e;e=(null!=r?r:"object"!==typeof i||null===i)?i:Object.assign({},e,i),n.forEach((n=>n(e,t)))}},i=()=>e,s={setState:r,getState:i,getInitialState:()=>o,subscribe:t=>(n.add(t),()=>n.delete(t)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},o=e=t(r,i,s);return s},JR=t=>t?XR(t):XR;const{useDebugValue:YR}=t,{useSyncExternalStoreWithSelector:ZR}=$R,KR=t=>t;function QR(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:KR,n=arguments.length>2?arguments[2]:void 0;const r=ZR(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return YR(r),r}const tL=(t,e)=>{const n=JR(t),r=function(t){return QR(n,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e)};return Object.assign(r,n),r};function eL(t,e){if(Object.is(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[n,r]of t)if(!Object.is(r,e.get(n)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(e,r)||!Object.is(t[r],e[r]))return!1;return!0}var nL={value:()=>{}};function rL(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new iL(r)}function iL(t){this._=t}function sL(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function oL(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=nL,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}iL.prototype=rL.prototype={constructor:iL,on:function(t,e){var n,r,i=this._,s=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),o=-1,a=s.length;if(!(arguments.length<2)){if(null!=e&&"function"!==typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=s[o]).type)i[n]=oL(i[n],t.name,e);else if(null==e)for(n in i)i[n]=oL(i[n],t.name,null);return this}for(;++o<a;)if((n=(t=s[o]).type)&&(n=sL(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new iL(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(r=this._[t]).length;s<n;++s)r[s].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};const aL=rL;function lL(){}function cL(t){return null==t?lL:function(){return this.querySelector(t)}}function uL(){return[]}function hL(t){return null==t?uL:function(){return this.querySelectorAll(t)}}function dL(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}function pL(t){return function(){return this.matches(t)}}function fL(t){return function(e){return e.matches(t)}}var mL=Array.prototype.find;function gL(){return this.firstElementChild}var vL=Array.prototype.filter;function yL(){return Array.from(this.children)}function _L(t){return new Array(t.length)}function bL(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function xL(t,e,n,r,i,s){for(var o,a=0,l=e.length,c=s.length;a<c;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):n[a]=new bL(t,s[a]);for(;a<l;++a)(o=e[a])&&(i[a]=o)}function wL(t,e,n,r,i,s,o){var a,l,c,u=new Map,h=e.length,d=s.length,p=new Array(h);for(a=0;a<h;++a)(l=e[a])&&(p[a]=c=o.call(l,l.__data__,a,e)+"",u.has(c)?i[a]=l:u.set(c,l));for(a=0;a<d;++a)c=o.call(t,s[a],a,s)+"",(l=u.get(c))?(r[a]=l,l.__data__=s[a],u.delete(c)):n[a]=new bL(t,s[a]);for(a=0;a<h;++a)(l=e[a])&&u.get(p[a])===l&&(i[a]=l)}function SL(t){return t.__data__}function ML(t){return"object"===typeof t&&"length"in t?t:Array.from(t)}function EL(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}bL.prototype={constructor:bL,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var TL="http://www.w3.org/1999/xhtml";const AL={svg:"http://www.w3.org/2000/svg",xhtml:TL,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function CL(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),AL.hasOwnProperty(e)?{space:AL[e],local:t}:t}function PL(t){return function(){this.removeAttribute(t)}}function IL(t){return function(){this.removeAttributeNS(t.space,t.local)}}function RL(t,e){return function(){this.setAttribute(t,e)}}function LL(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function NL(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function OL(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function kL(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function DL(t){return function(){this.style.removeProperty(t)}}function zL(t,e,n){return function(){this.style.setProperty(t,e,n)}}function UL(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function FL(t,e){return t.style.getPropertyValue(e)||kL(t).getComputedStyle(t,null).getPropertyValue(e)}function BL(t){return function(){delete this[t]}}function VL(t,e){return function(){this[t]=e}}function HL(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function jL(t){return t.trim().split(/^|\s+/)}function WL(t){return t.classList||new GL(t)}function GL(t){this._node=t,this._names=jL(t.getAttribute("class")||"")}function qL(t,e){for(var n=WL(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function $L(t,e){for(var n=WL(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function XL(t){return function(){qL(this,t)}}function JL(t){return function(){$L(this,t)}}function YL(t,e){return function(){(e.apply(this,arguments)?qL:$L)(this,t)}}function ZL(){this.textContent=""}function KL(t){return function(){this.textContent=t}}function QL(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function tN(){this.innerHTML=""}function eN(t){return function(){this.innerHTML=t}}function nN(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function rN(){this.nextSibling&&this.parentNode.appendChild(this)}function iN(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function sN(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===TL&&e.documentElement.namespaceURI===TL?e.createElement(t):e.createElementNS(n,t)}}function oN(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function aN(t){var e=CL(t);return(e.local?oN:sN)(e)}function lN(){return null}function cN(){var t=this.parentNode;t&&t.removeChild(this)}function uN(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function hN(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function dN(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,s=e.length;r<s;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function pN(t,e,n){return function(){var r,i=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),void(r.value=e);this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function fN(t,e,n){var r=kL(t),i=r.CustomEvent;"function"===typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function mN(t,e){return function(){return fN(this,t,e)}}function gN(t,e){return function(){return fN(this,t,e.apply(this,arguments))}}GL.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var vN=[null];function yN(t,e){this._groups=t,this._parents=e}function _N(){return new yN([[document.documentElement]],vN)}yN.prototype=_N.prototype={constructor:yN,select:function(t){"function"!==typeof t&&(t=cL(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o,a=e[i],l=a.length,c=r[i]=new Array(l),u=0;u<l;++u)(s=a[u])&&(o=t.call(s,s.__data__,u,a))&&("__data__"in s&&(o.__data__=s.__data__),c[u]=o);return new yN(r,this._parents)},selectAll:function(t){t="function"===typeof t?dL(t):hL(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o,a=e[s],l=a.length,c=0;c<l;++c)(o=a[c])&&(r.push(t.call(o,o.__data__,c,a)),i.push(o));return new yN(r,i)},selectChild:function(t){return this.select(null==t?gL:function(t){return function(){return mL.call(this.children,t)}}("function"===typeof t?t:fL(t)))},selectChildren:function(t){return this.selectAll(null==t?yL:function(t){return function(){return vL.call(this.children,t)}}("function"===typeof t?t:fL(t)))},filter:function(t){"function"!==typeof t&&(t=pL(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o=e[i],a=o.length,l=r[i]=[],c=0;c<a;++c)(s=o[c])&&t.call(s,s.__data__,c,o)&&l.push(s);return new yN(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,SL);var n,r=e?wL:xL,i=this._parents,s=this._groups;"function"!==typeof t&&(n=t,t=function(){return n});for(var o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=0;u<o;++u){var h=i[u],d=s[u],p=d.length,f=ML(t.call(h,h&&h.__data__,u,i)),m=f.length,g=l[u]=new Array(m),v=a[u]=new Array(m);r(h,d,g,v,c[u]=new Array(p),f,e);for(var y,_,b=0,x=0;b<m;++b)if(y=g[b]){for(b>=x&&(x=b+1);!(_=v[x])&&++x<m;);y._next=_||null}}return(a=new yN(a,i))._enter=l,a._exit=c,a},enter:function(){return new yN(this._enter||this._groups.map(_L),this._parents)},exit:function(){return new yN(this._exit||this._groups.map(_L),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,s=this.exit();return"function"===typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?s.remove():n(s),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var c,u=n[l],h=r[l],d=u.length,p=a[l]=new Array(d),f=0;f<d;++f)(c=u[f]||h[f])&&(p[f]=c);for(;l<i;++l)a[l]=n[l];return new yN(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],s=i.length-1,o=i[s];--s>=0;)(r=i[s])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=EL);for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o,a=n[s],l=a.length,c=i[s]=new Array(l),u=0;u<l;++u)(o=a[u])&&(c[u]=o);c.sort(e)}return new yN(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,s=e[n],o=0,a=s.length;o<a;++o)(i=s[o])&&t.call(i,i.__data__,o,s);return this},attr:function(t,e){var n=CL(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?IL:PL:"function"===typeof e?n.local?OL:NL:n.local?LL:RL)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?DL:"function"===typeof e?UL:zL)(t,e,null==n?"":n)):FL(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?BL:"function"===typeof e?HL:VL)(t,e)):this.node()[t]},classed:function(t,e){var n=jL(t+"");if(arguments.length<2){for(var r=WL(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"===typeof e?YL:e?XL:JL)(n,e))},text:function(t){return arguments.length?this.each(null==t?ZL:("function"===typeof t?QL:KL)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?tN:("function"===typeof t?nN:eN)(t)):this.node().innerHTML},raise:function(){return this.each(rN)},lower:function(){return this.each(iN)},append:function(t){var e="function"===typeof t?t:aN(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"===typeof t?t:aN(t),r=null==e?lN:"function"===typeof e?e:cL(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(cN)},clone:function(t){return this.select(t?hN:uN)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,s=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?pN:dN,r=0;r<o;++r)this.each(a(s[r],e,n));return this}var a=this.node().__on;if(a)for(var l,c=0,u=a.length;c<u;++c)for(r=0,l=a[c];r<o;++r)if((i=s[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"===typeof e?gN:mN)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],s=0,o=i.length;s<o;++s)(r=i[s])&&(yield r)}};const bN=_N;function xN(t){return"string"===typeof t?new yN([[document.querySelector(t)]],[document.documentElement]):new yN([[t]],vN)}const wN={passive:!1},SN={capture:!0,passive:!1};function MN(t){t.stopImmediatePropagation()}function EN(t){t.preventDefault(),t.stopImmediatePropagation()}function TN(t){var e=t.document.documentElement,n=xN(t).on("dragstart.drag",EN,SN);"onselectstart"in e?n.on("selectstart.drag",EN,SN):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function AN(t,e){var n=t.document.documentElement,r=xN(t).on("dragstart.drag",null);e&&(r.on("click.drag",EN,SN),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function CN(t){return((t=Math.exp(t))+1/t)/2}const PN=function t(e,n,r){function i(t,i){var s,o,a=t[0],l=t[1],c=t[2],u=i[0],h=i[1],d=i[2],p=u-a,f=h-l,m=p*p+f*f;if(m<1e-12)o=Math.log(d/c)/e,s=function(t){return[a+t*p,l+t*f,c*Math.exp(e*t*o)]};else{var g=Math.sqrt(m),v=(d*d-c*c+r*m)/(2*c*n*g),y=(d*d-c*c-r*m)/(2*d*n*g),_=Math.log(Math.sqrt(v*v+1)-v),b=Math.log(Math.sqrt(y*y+1)-y);o=(b-_)/e,s=function(t){var r,i=t*o,s=CN(_),u=c/(n*g)*(s*(r=e*i+_,((r=Math.exp(2*r))-1)/(r+1))-function(t){return((t=Math.exp(t))-1/t)/2}(_));return[a+u*p,l+u*f,c*s/CN(e*i+_)]}}return s.duration=1e3*o*e/Math.SQRT2,s}return i.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},i}(Math.SQRT2,2,4);function IN(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}var RN,LN,NN=0,ON=0,kN=0,DN=0,zN=0,UN=0,FN="object"===typeof performance&&performance.now?performance:Date,BN="object"===typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function VN(){return zN||(BN(HN),zN=FN.now()+UN)}function HN(){zN=0}function jN(){this._call=this._time=this._next=null}function WN(t,e,n){var r=new jN;return r.restart(t,e,n),r}function GN(){zN=(DN=FN.now())+UN,NN=ON=0;try{!function(){VN(),++NN;for(var t,e=RN;e;)(t=zN-e._time)>=0&&e._call.call(void 0,t),e=e._next;--NN}()}finally{NN=0,function(){var t,e,n=RN,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:RN=e);LN=t,$N(r)}(),zN=0}}function qN(){var t=FN.now(),e=t-DN;e>1e3&&(UN-=e,DN=t)}function $N(t){NN||(ON&&(ON=clearTimeout(ON)),t-zN>24?(t<1/0&&(ON=setTimeout(GN,t-FN.now()-UN)),kN&&(kN=clearInterval(kN))):(kN||(DN=FN.now(),kN=setInterval(qN,1e3)),NN=1,BN(GN)))}function XN(t,e,n){var r=new jN;return e=null==e?0:+e,r.restart((n=>{r.stop(),t(n+e)}),e,n),r}jN.prototype=WN.prototype={constructor:jN,restart:function(t,e,n){if("function"!==typeof t)throw new TypeError("callback is not a function");n=(null==n?VN():+n)+(null==e?0:+e),this._next||LN===this||(LN?LN._next=this:RN=this,LN=this),this._call=t,this._time=n,$N()},stop:function(){this._call&&(this._call=null,this._time=1/0,$N())}};var JN=aL("start","end","cancel","interrupt"),YN=[];function ZN(t,e,n,r,i,s){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function s(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}function o(s){var c,u,h,d;if(1!==n.state)return l();for(c in i)if((d=i[c]).name===n.name){if(3===d.state)return XN(o);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[c]):+c<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[c])}if(XN((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(s))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(d=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(r[++u]=d);r.length=u+1}}function a(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(l),n.state=5,1),s=-1,o=r.length;++s<o;)r[s].call(t,i);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){for(var r in n.state=6,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=WN(s,0,n.time)}(t,n,{name:e,index:r,group:i,on:JN,tween:YN,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function KN(t,e){var n=tO(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function QN(t,e){var n=tO(t,e);if(n.state>3)throw new Error("too late; already running");return n}function tO(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function eO(t,e){var n,r,i,s=t.__transition,o=!0;if(s){for(i in e=null==e?null:e+"",s)(n=s[i]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete s[i]):o=!1;o&&delete t.__transition}}function nO(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var rO,iO=180/Math.PI,sO={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function oO(t,e,n,r,i,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),t*r<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*iO,skewX:Math.atan(l)*iO,scaleX:o,scaleY:a}}function aO(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],l=[];return s=t(s),o=t(o),function(t,r,i,s,o,a){if(t!==i||r!==s){var l=o.push("translate(",null,e,null,n);a.push({i:l-4,x:nO(t,i)},{i:l-2,x:nO(r,s)})}else(i||s)&&o.push("translate("+i+e+s+n)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(t,e,n,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:n.push(i(n)+"rotate(",null,r)-2,x:nO(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(s.rotate,o.rotate,a,l),function(t,e,n,s){t!==e?s.push({i:n.push(i(n)+"skewX(",null,r)-2,x:nO(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(s.skewX,o.skewX,a,l),function(t,e,n,r,s,o){if(t!==n||e!==r){var a=s.push(i(s)+"scale(",null,",",null,")");o.push({i:a-4,x:nO(t,n)},{i:a-2,x:nO(e,r)})}else 1===n&&1===r||s.push(i(s)+"scale("+n+","+r+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(t){for(var e,n=-1,r=l.length;++n<r;)a[(e=l[n]).i]=e.x(t);return a.join("")}}}var lO=aO((function(t){const e=new("function"===typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?sO:oO(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),cO=aO((function(t){return null==t?sO:(rO||(rO=document.createElementNS("http://www.w3.org/2000/svg","g")),rO.setAttribute("transform",t),(t=rO.transform.baseVal.consolidate())?oO((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):sO)}),", ",")",")");function uO(t,e){var n,r;return function(){var i=QN(this,t),s=i.tween;if(s!==n)for(var o=0,a=(r=n=s).length;o<a;++o)if(r[o].name===e){(r=r.slice()).splice(o,1);break}i.tween=r}}function hO(t,e,n){var r,i;if("function"!==typeof n)throw new Error;return function(){var s=QN(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:e,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===e){i[l]=a;break}l===c&&i.push(a)}s.tween=i}}function dO(t,e,n){var r=t._id;return t.each((function(){var t=QN(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return tO(t,r).value[e]}}function pO(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function fO(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function mO(){}var gO=.7,vO=1/gO,yO="\\s*([+-]?\\d+)\\s*",_O="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",bO="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xO=/^#([0-9a-f]{3,8})$/,wO=new RegExp(`^rgb\\(${yO},${yO},${yO}\\)$`),SO=new RegExp(`^rgb\\(${bO},${bO},${bO}\\)$`),MO=new RegExp(`^rgba\\(${yO},${yO},${yO},${_O}\\)$`),EO=new RegExp(`^rgba\\(${bO},${bO},${bO},${_O}\\)$`),TO=new RegExp(`^hsl\\(${_O},${bO},${bO}\\)$`),AO=new RegExp(`^hsla\\(${_O},${bO},${bO},${_O}\\)$`),CO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function PO(){return this.rgb().formatHex()}function IO(){return this.rgb().formatRgb()}function RO(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=xO.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?LO(e):3===n?new kO(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?NO(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?NO(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=wO.exec(t))?new kO(e[1],e[2],e[3],1):(e=SO.exec(t))?new kO(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=MO.exec(t))?NO(e[1],e[2],e[3],e[4]):(e=EO.exec(t))?NO(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=TO.exec(t))?VO(e[1],e[2]/100,e[3]/100,1):(e=AO.exec(t))?VO(e[1],e[2]/100,e[3]/100,e[4]):CO.hasOwnProperty(t)?LO(CO[t]):"transparent"===t?new kO(NaN,NaN,NaN,0):null}function LO(t){return new kO(t>>16&255,t>>8&255,255&t,1)}function NO(t,e,n,r){return r<=0&&(t=e=n=NaN),new kO(t,e,n,r)}function OO(t,e,n,r){return 1===arguments.length?function(t){return t instanceof mO||(t=RO(t)),t?new kO((t=t.rgb()).r,t.g,t.b,t.opacity):new kO}(t):new kO(t,e,n,null==r?1:r)}function kO(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function DO(){return`#${BO(this.r)}${BO(this.g)}${BO(this.b)}`}function zO(){const t=UO(this.opacity);return`${1===t?"rgb(":"rgba("}${FO(this.r)}, ${FO(this.g)}, ${FO(this.b)}${1===t?")":`, ${t})`}`}function UO(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function FO(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function BO(t){return((t=FO(t))<16?"0":"")+t.toString(16)}function VO(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new jO(t,e,n,r)}function HO(t){if(t instanceof jO)return new jO(t.h,t.s,t.l,t.opacity);if(t instanceof mO||(t=RO(t)),!t)return new jO;if(t instanceof jO)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(o=e===s?(n-r)/a+6*(n<r):n===s?(r-e)/a+2:(e-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new jO(o,a,l,t.opacity)}function jO(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function WO(t){return(t=(t||0)%360)<0?t+360:t}function GO(t){return Math.max(0,Math.min(1,t||0))}function qO(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function $O(t,e,n,r,i){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*n+(1+3*t+3*s-3*o)*r+o*i)/6}pO(mO,RO,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:PO,formatHex:PO,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return HO(this).formatHsl()},formatRgb:IO,toString:IO}),pO(kO,OO,fO(mO,{brighter(t){return t=null==t?vO:Math.pow(vO,t),new kO(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?gO:Math.pow(gO,t),new kO(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new kO(FO(this.r),FO(this.g),FO(this.b),UO(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:DO,formatHex:DO,formatHex8:function(){return`#${BO(this.r)}${BO(this.g)}${BO(this.b)}${BO(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:zO,toString:zO})),pO(jO,(function(t,e,n,r){return 1===arguments.length?HO(t):new jO(t,e,n,null==r?1:r)}),fO(mO,{brighter(t){return t=null==t?vO:Math.pow(vO,t),new jO(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?gO:Math.pow(gO,t),new jO(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new kO(qO(t>=240?t-240:t+120,i,r),qO(t,i,r),qO(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new jO(WO(this.h),GO(this.s),GO(this.l),UO(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=UO(this.opacity);return`${1===t?"hsl(":"hsla("}${WO(this.h)}, ${100*GO(this.s)}%, ${100*GO(this.l)}%${1===t?")":`, ${t})`}`}}));const XO=t=>()=>t;function JO(t,e){return function(n){return t+n*e}}function YO(t){return 1===(t=+t)?ZO:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):XO(isNaN(e)?n:e)}}function ZO(t,e){var n=e-t;return n?JO(t,n):XO(isNaN(t)?e:t)}const KO=function t(e){var n=YO(e);function r(t,e){var r=n((t=OO(t)).r,(e=OO(e)).r),i=n(t.g,e.g),s=n(t.b,e.b),o=ZO(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=s(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function QO(t){return function(e){var n,r,i=e.length,s=new Array(i),o=new Array(i),a=new Array(i);for(n=0;n<i;++n)r=OO(e[n]),s[n]=r.r||0,o[n]=r.g||0,a[n]=r.b||0;return s=t(s),o=t(o),a=t(a),r.opacity=1,function(t){return r.r=s(t),r.g=o(t),r.b=a(t),r+""}}}QO((function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],s=t[r+1],o=r>0?t[r-1]:2*i-s,a=r<e-1?t[r+2]:2*s-i;return $O((n-r/e)*e,o,i,s,a)}})),QO((function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],s=t[r%e],o=t[(r+1)%e],a=t[(r+2)%e];return $O((n-r/e)*e,i,s,o,a)}}));var tk=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ek=new RegExp(tk.source,"g");function nk(t,e){var n,r,i,s=tk.lastIndex=ek.lastIndex=0,o=-1,a=[],l=[];for(t+="",e+="";(n=tk.exec(t))&&(r=ek.exec(e));)(i=r.index)>s&&(i=e.slice(s,i),a[o]?a[o]+=i:a[++o]=i),(n=n[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:nO(n,r)})),s=ek.lastIndex;return s<e.length&&(i=e.slice(s),a[o]?a[o]+=i:a[++o]=i),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,r=0;r<e;++r)a[(n=l[r]).i]=n.x(t);return a.join("")})}function rk(t,e){var n;return("number"===typeof e?nO:e instanceof RO?KO:(n=RO(e))?(e=n,KO):nk)(t,e)}function ik(t){return function(){this.removeAttribute(t)}}function sk(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ok(t,e,n){var r,i,s=n+"";return function(){var o=this.getAttribute(t);return o===s?null:o===r?i:i=e(r=o,n)}}function ak(t,e,n){var r,i,s=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===r?i:i=e(r=o,n)}}function lk(t,e,n){var r,i,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttribute(t))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=e(r=o,l));this.removeAttribute(t)}}function ck(t,e,n){var r,i,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=e(r=o,l));this.removeAttributeNS(t.space,t.local)}}function uk(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,i)),n}return i._value=e,i}function hk(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,i)),n}return i._value=e,i}function dk(t,e){return function(){KN(this,t).delay=+e.apply(this,arguments)}}function pk(t,e){return e=+e,function(){KN(this,t).delay=e}}function fk(t,e){return function(){QN(this,t).duration=+e.apply(this,arguments)}}function mk(t,e){return e=+e,function(){QN(this,t).duration=e}}var gk=bN.prototype.constructor;function vk(t){return function(){this.style.removeProperty(t)}}var yk=0;function _k(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function bk(){return++yk}var xk=bN.prototype;_k.prototype=function(t){return bN().transition(t)}.prototype={constructor:_k,select:function(t){var e=this._name,n=this._id;"function"!==typeof t&&(t=cL(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a,l,c=r[o],u=c.length,h=s[o]=new Array(u),d=0;d<u;++d)(a=c[d])&&(l=t.call(a,a.__data__,d,c))&&("__data__"in a&&(l.__data__=a.__data__),h[d]=l,ZN(h[d],e,n,d,h,tO(a,n)));return new _k(s,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!==typeof t&&(t=hL(t));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l,c=r[a],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var d,p=t.call(l,l.__data__,h,c),f=tO(l,n),m=0,g=p.length;m<g;++m)(d=p[m])&&ZN(d,e,n,m,p,f);s.push(p),o.push(l)}return new _k(s,o,e,n)},selectChild:xk.selectChild,selectChildren:xk.selectChildren,filter:function(t){"function"!==typeof t&&(t=pL(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o=e[i],a=o.length,l=r[i]=[],c=0;c<a;++c)(s=o[c])&&t.call(s,s.__data__,c,o)&&l.push(s);return new _k(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l,c=e[a],u=n[a],h=c.length,d=o[a]=new Array(h),p=0;p<h;++p)(l=c[p]||u[p])&&(d[p]=l);for(;a<r;++a)o[a]=e[a];return new _k(o,this._parents,this._name,this._id)},selection:function(){return new gk(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=bk(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o,a=r[s],l=a.length,c=0;c<l;++c)if(o=a[c]){var u=tO(o,e);ZN(o,t,n,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new _k(r,this._parents,t,n)},call:xk.call,nodes:xk.nodes,node:xk.node,size:xk.size,empty:xk.empty,each:xk.each,on:function(t,e){var n=this._id;return arguments.length<2?tO(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,s=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?KN:QN;return function(){var o=s(this,t),a=o.on;a!==r&&(i=(r=a).copy()).on(e,n),o.on=i}}(n,t,e))},attr:function(t,e){var n=CL(t),r="transform"===n?cO:rk;return this.attrTween(t,"function"===typeof e?(n.local?ck:lk)(n,r,dO(this,"attr."+t,e)):null==e?(n.local?sk:ik)(n):(n.local?ak:ok)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!==typeof e)throw new Error;var r=CL(t);return this.tween(n,(r.local?uk:hk)(r,e))},style:function(t,e,n){var r="transform"===(t+="")?lO:rk;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var s=FL(this,t),o=(this.style.removeProperty(t),FL(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}(t,r)).on("end.style."+t,vk(t)):"function"===typeof e?this.styleTween(t,function(t,e,n){var r,i,s;return function(){var o=FL(this,t),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=FL(this,t)),o===l?null:o===r&&l===i?s:(i=l,s=e(r=o,a))}}(t,r,dO(this,"style."+t,e))).each(function(t,e){var n,r,i,s,o="style."+e,a="end."+o;return function(){var l=QN(this,t),c=l.on,u=null==l.value[o]?s||(s=vk(e)):void 0;c===n&&i===u||(r=(n=c).copy()).on(a,i=u),l.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,i,s=n+"";return function(){var o=FL(this,t);return o===s?null:o===r?i:i=e(r=o,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!==typeof e)throw new Error;return this.tween(r,function(t,e,n){var r,i;function s(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&function(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}(t,s,n)),r}return s._value=e,s}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"===typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(dO(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!==typeof t)throw new Error;return this.tween(e,function(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&function(t){return function(e){this.textContent=t.call(this,e)}}(r)),e}return r._value=t,r}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=tO(this.node(),n).tween,s=0,o=i.length;s<o;++s)if((r=i[s]).name===t)return r.value;return null}return this.each((null==e?uO:hO)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"===typeof t?dk:pk)(e,t)):tO(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"===typeof t?fk:mk)(e,t)):tO(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!==typeof e)throw new Error;return function(){QN(this,t).ease=e}}(e,t)):tO(this.node(),e).ease},easeVarying:function(t){if("function"!==typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!==typeof n)throw new Error;QN(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,i=n.size();return new Promise((function(s,o){var a={value:o},l={value:function(){0===--i&&s()}};n.each((function(){var n=QN(this,r),i=n.on;i!==t&&((e=(t=i).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),n.on=e})),0===i&&s()}))},[Symbol.iterator]:xk[Symbol.iterator]};var wk={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Sk(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}bN.prototype.interrupt=function(t){return this.each((function(){eO(this,t)}))},bN.prototype.transition=function(t){var e,n;t instanceof _k?(e=t._id,t=t._name):(e=bk(),(n=wk).time=VN(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o,a=r[s],l=a.length,c=0;c<l;++c)(o=a[c])&&ZN(o,t,e,c,a,n||Sk(o,e));return new _k(r,this._parents,t,e)};const Mk=t=>()=>t;function Ek(t,e){let{sourceEvent:n,target:r,transform:i,dispatch:s}=e;Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:s}})}function Tk(t,e,n){this.k=t,this.x=e,this.y=n}Tk.prototype={constructor:Tk,scale:function(t){return 1===t?this:new Tk(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Tk(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ak=new Tk(1,0,0);function Ck(t){t.stopImmediatePropagation()}function Pk(t){t.preventDefault(),t.stopImmediatePropagation()}function Ik(t){return(!t.ctrlKey||"wheel"===t.type)&&!t.button}function Rk(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Lk(){return this.__zoom||Ak}function Nk(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Ok(){return navigator.maxTouchPoints||"ontouchstart"in this}function kk(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}Tk.prototype;const Dk=t=>()=>t;function zk(t,e){let{sourceEvent:n,subject:r,target:i,identifier:s,active:o,x:a,y:l,dx:c,dy:u,dispatch:h}=e;Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:h}})}function Uk(t){return!t.ctrlKey&&!t.button}function Fk(){return this.parentNode}function Bk(t,e){return null==e?{x:t.x,y:t.y}:e}function Vk(){return navigator.maxTouchPoints||"ontouchstart"in this}zk.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var Hk=n(7950),jk=n.t(Hk,2);const Wk=(0,t.createContext)(null),Gk=Wk.Provider,qk=t=>`Node type "${t}" not found. Using fallback type "default".`,$k=()=>"The React Flow parent container needs a width and a height to render the graph.",Xk=()=>"Only child nodes can use a parent extent.",Jk=()=>"Can't create edge. An edge needs a source and a target.",Yk=t=>`Marker type "${t}" doesn't exist.`,Zk=(t,e)=>`Couldn't create edge for ${t?"target":"source"} handle id: "${t?e.targetHandle:e.sourceHandle}", edge id: ${e.id}.`,Kk=()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",Qk=t=>`Edge type "${t}" not found. Using fallback type "default".`,tD=t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,eD=(()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001")();function nD(e,n){const r=(0,t.useContext)(Wk);if(null===r)throw new Error(eD);return QR(r,e,n)}const rD=()=>{const e=(0,t.useContext)(Wk);if(null===e)throw new Error(eD);return(0,t.useMemo)((()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy})),[e])},iD=t=>t.userSelectionActive?"none":"all";function sD(e){let{position:n,children:r,className:i,style:s,...o}=e;const a=nD(iD),l=`${n}`.split("-");return t.createElement("div",{className:qR(["react-flow__panel",i,...l]),style:{...s,pointerEvents:a},...o},r)}function oD(e){let{proOptions:n,position:r="bottom-right"}=e;return n?.hideAttribution?null:t.createElement(sD,{position:r,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},t.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}var aD=(0,t.memo)((e=>{let{x:n,y:r,label:i,labelStyle:s={},labelShowBg:o=!0,labelBgStyle:a={},labelBgPadding:l=[2,4],labelBgBorderRadius:c=2,children:u,className:h,...d}=e;const p=(0,t.useRef)(null),[f,m]=(0,t.useState)({x:0,y:0,width:0,height:0}),g=qR(["react-flow__edge-textwrapper",h]);return(0,t.useEffect)((()=>{if(p.current){const t=p.current.getBBox();m({x:t.x,y:t.y,width:t.width,height:t.height})}}),[i]),"undefined"!==typeof i&&i?t.createElement("g",{transform:`translate(${n-f.width/2} ${r-f.height/2})`,className:g,visibility:f.width?"visible":"hidden",...d},o&&t.createElement("rect",{width:f.width+2*l[0],x:-l[0],y:-l[1],height:f.height+2*l[1],className:"react-flow__edge-textbg",style:a,rx:c,ry:c}),t.createElement("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:p,style:s},i),u):null}));const lD=t=>({width:t.offsetWidth,height:t.offsetHeight}),cD=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(t,e),n)},uD=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},e=arguments.length>1?arguments[1]:void 0;return{x:cD(t.x,e[0][0],e[1][0]),y:cD(t.y,e[0][1],e[1][1])}},hD=(t,e,n)=>t<e?cD(Math.abs(t-e),1,50)/50:t>n?-cD(Math.abs(t-n),1,50)/50:0,dD=(t,e)=>[20*hD(t.x,35,e.width-35),20*hD(t.y,35,e.height-35)],pD=t=>t.getRootNode?.()||window?.document,fD=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),mD=t=>{let{x:e,y:n,width:r,height:i}=t;return{x:e,y:n,x2:e+r,y2:n+i}},gD=t=>{let{x:e,y:n,x2:r,y2:i}=t;return{x:e,y:n,width:r-e,height:i-n}},vD=t=>({...t.positionAbsolute||{x:0,y:0},width:t.width||0,height:t.height||0}),yD=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},_D=t=>!isNaN(t)&&isFinite(t),bD=Symbol.for("internals"),xD=["Enter"," ","Escape"],wD=(t,e)=>{0};function SD(t){const e=(t=>"nativeEvent"in t)(t)?t.nativeEvent:t,n=e.composedPath?.()?.[0]||t.target;return["INPUT","SELECT","TEXTAREA"].includes(n?.nodeName)||n?.hasAttribute("contenteditable")||!!n?.closest(".nokey")}const MD=t=>"clientX"in t,ED=(t,e)=>{const n=MD(t),r=n?t.clientX:t.touches?.[0].clientX,i=n?t.clientY:t.touches?.[0].clientY;return{x:r-(e?.left??0),y:i-(e?.top??0)}},TD=()=>"undefined"!==typeof navigator&&navigator?.userAgent?.indexOf("Mac")>=0,AD=e=>{let{id:n,path:r,labelX:i,labelY:s,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:h,style:d,markerEnd:p,markerStart:f,interactionWidth:m=20}=e;return t.createElement(t.Fragment,null,t.createElement("path",{id:n,style:d,d:r,fill:"none",className:"react-flow__edge-path",markerEnd:p,markerStart:f}),m&&t.createElement("path",{d:r,fill:"none",strokeOpacity:0,strokeWidth:m,className:"react-flow__edge-interaction"}),o&&_D(i)&&_D(s)?t.createElement(aD,{x:i,y:s,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:h}):null)};AD.displayName="BaseEdge";function CD(t,e,n){return void 0===n?n:r=>{const i=e().edges.find((e=>e.id===t));i&&n(r,{...i})}}function PD(t){let{sourceX:e,sourceY:n,targetX:r,targetY:i}=t;const s=Math.abs(r-e)/2,o=r<e?r+s:r-s,a=Math.abs(i-n)/2;return[o,i<n?i+a:i-a,s,a]}function ID(t){let{sourceX:e,sourceY:n,targetX:r,targetY:i,sourceControlX:s,sourceControlY:o,targetControlX:a,targetControlY:l}=t;const c=.125*e+.375*s+.375*a+.125*r,u=.125*n+.375*o+.375*l+.125*i;return[c,u,Math.abs(c-e),Math.abs(u-n)]}var RD,LD,ND,OD,kD,DD;function zD(t){let{pos:e,x1:n,y1:r,x2:i,y2:s}=t;return e===DD.Left||e===DD.Right?[.5*(n+i),r]:[n,.5*(r+s)]}function UD(t){let{sourceX:e,sourceY:n,sourcePosition:r=DD.Bottom,targetX:i,targetY:s,targetPosition:o=DD.Top}=t;const[a,l]=zD({pos:r,x1:e,y1:n,x2:i,y2:s}),[c,u]=zD({pos:o,x1:i,y1:s,x2:e,y2:n}),[h,d,p,f]=ID({sourceX:e,sourceY:n,targetX:i,targetY:s,sourceControlX:a,sourceControlY:l,targetControlX:c,targetControlY:u});return[`M${e},${n} C${a},${l} ${c},${u} ${i},${s}`,h,d,p,f]}!function(t){t.Strict="strict",t.Loose="loose"}(RD||(RD={})),function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"}(LD||(LD={})),function(t){t.Partial="partial",t.Full="full"}(ND||(ND={})),function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"}(OD||(OD={})),function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"}(kD||(kD={})),function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"}(DD||(DD={}));const FD=(0,t.memo)((e=>{let{sourceX:n,sourceY:r,targetX:i,targetY:s,sourcePosition:o=DD.Bottom,targetPosition:a=DD.Top,label:l,labelStyle:c,labelShowBg:u,labelBgStyle:h,labelBgPadding:d,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,interactionWidth:v}=e;const[y,_,b]=UD({sourceX:n,sourceY:r,sourcePosition:o,targetX:i,targetY:s,targetPosition:a});return t.createElement(AD,{path:y,labelX:_,labelY:b,label:l,labelStyle:c,labelShowBg:u,labelBgStyle:h,labelBgPadding:d,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,interactionWidth:v})}));FD.displayName="SimpleBezierEdge";const BD={[DD.Left]:{x:-1,y:0},[DD.Right]:{x:1,y:0},[DD.Top]:{x:0,y:-1},[DD.Bottom]:{x:0,y:1}},VD=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function HD(t){let{source:e,sourcePosition:n=DD.Bottom,target:r,targetPosition:i=DD.Top,center:s,offset:o}=t;const a=BD[n],l=BD[i],c={x:e.x+a.x*o,y:e.y+a.y*o},u={x:r.x+l.x*o,y:r.y+l.y*o},h=(t=>{let{source:e,sourcePosition:n=DD.Bottom,target:r}=t;return n===DD.Left||n===DD.Right?e.x<r.x?{x:1,y:0}:{x:-1,y:0}:e.y<r.y?{x:0,y:1}:{x:0,y:-1}})({source:c,sourcePosition:n,target:u}),d=0!==h.x?"x":"y",p=h[d];let f,m,g=[];const v={x:0,y:0},y={x:0,y:0},[_,b,x,w]=PD({sourceX:e.x,sourceY:e.y,targetX:r.x,targetY:r.y});if(a[d]*l[d]===-1){f=s.x??_,m=s.y??b;const t=[{x:f,y:c.y},{x:f,y:u.y}],e=[{x:c.x,y:m},{x:u.x,y:m}];g=a[d]===p?"x"===d?t:e:"x"===d?e:t}else{const t=[{x:c.x,y:u.y}],s=[{x:u.x,y:c.y}];if(g="x"===d?a.x===p?s:t:a.y===p?t:s,n===i){const t=Math.abs(e[d]-r[d]);if(t<=o){const n=Math.min(o-1,o-t);a[d]===p?v[d]=(c[d]>e[d]?-1:1)*n:y[d]=(u[d]>r[d]?-1:1)*n}}if(n!==i){const e="x"===d?"y":"x",n=a[d]===l[e],r=c[e]>u[e],i=c[e]<u[e];(1===a[d]&&(!n&&r||n&&i)||1!==a[d]&&(!n&&i||n&&r))&&(g="x"===d?t:s)}const h={x:c.x+v.x,y:c.y+v.y},_={x:u.x+y.x,y:u.y+y.y};Math.max(Math.abs(h.x-g[0].x),Math.abs(_.x-g[0].x))>=Math.max(Math.abs(h.y-g[0].y),Math.abs(_.y-g[0].y))?(f=(h.x+_.x)/2,m=g[0].y):(f=g[0].x,m=(h.y+_.y)/2)}return[[e,{x:c.x+v.x,y:c.y+v.y},...g,{x:u.x+y.x,y:u.y+y.y},r],f,m,x,w]}function jD(t){let{sourceX:e,sourceY:n,sourcePosition:r=DD.Bottom,targetX:i,targetY:s,targetPosition:o=DD.Top,borderRadius:a=5,centerX:l,centerY:c,offset:u=20}=t;const[h,d,p,f,m]=HD({source:{x:e,y:n},sourcePosition:r,target:{x:i,y:s},targetPosition:o,center:{x:l,y:c},offset:u}),g=h.reduce(((t,e,n)=>{let r="";return r=n>0&&n<h.length-1?function(t,e,n,r){const i=Math.min(VD(t,e)/2,VD(e,n)/2,r),{x:s,y:o}=e;if(t.x===s&&s===n.x||t.y===o&&o===n.y)return`L${s} ${o}`;if(t.y===o)return`L ${s+i*(t.x<n.x?-1:1)},${o}Q ${s},${o} ${s},${o+i*(t.y<n.y?1:-1)}`;const a=t.x<n.x?1:-1;return`L ${s},${o+i*(t.y<n.y?-1:1)}Q ${s},${o} ${s+i*a},${o}`}(h[n-1],e,h[n+1],a):`${0===n?"M":"L"}${e.x} ${e.y}`,t+=r}),"");return[g,d,p,f,m]}const WD=(0,t.memo)((e=>{let{sourceX:n,sourceY:r,targetX:i,targetY:s,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:h,style:d,sourcePosition:p=DD.Bottom,targetPosition:f=DD.Top,markerEnd:m,markerStart:g,pathOptions:v,interactionWidth:y}=e;const[_,b,x]=jD({sourceX:n,sourceY:r,sourcePosition:p,targetX:i,targetY:s,targetPosition:f,borderRadius:v?.borderRadius,offset:v?.offset});return t.createElement(AD,{path:_,labelX:b,labelY:x,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:h,style:d,markerEnd:m,markerStart:g,interactionWidth:y})}));WD.displayName="SmoothStepEdge";const GD=(0,t.memo)((e=>t.createElement(WD,{...e,pathOptions:(0,t.useMemo)((()=>({borderRadius:0,offset:e.pathOptions?.offset})),[e.pathOptions?.offset])})));GD.displayName="StepEdge";const qD=(0,t.memo)((e=>{let{sourceX:n,sourceY:r,targetX:i,targetY:s,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:h,style:d,markerEnd:p,markerStart:f,interactionWidth:m}=e;const[g,v,y]=function(t){let{sourceX:e,sourceY:n,targetX:r,targetY:i}=t;const[s,o,a,l]=PD({sourceX:e,sourceY:n,targetX:r,targetY:i});return[`M ${e},${n}L ${r},${i}`,s,o,a,l]}({sourceX:n,sourceY:r,targetX:i,targetY:s});return t.createElement(AD,{path:g,labelX:v,labelY:y,label:o,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:h,style:d,markerEnd:p,markerStart:f,interactionWidth:m})}));function $D(t,e){return t>=0?.5*t:25*e*Math.sqrt(-t)}function XD(t){let{pos:e,x1:n,y1:r,x2:i,y2:s,c:o}=t;switch(e){case DD.Left:return[n-$D(n-i,o),r];case DD.Right:return[n+$D(i-n,o),r];case DD.Top:return[n,r-$D(r-s,o)];case DD.Bottom:return[n,r+$D(s-r,o)]}}function JD(t){let{sourceX:e,sourceY:n,sourcePosition:r=DD.Bottom,targetX:i,targetY:s,targetPosition:o=DD.Top,curvature:a=.25}=t;const[l,c]=XD({pos:r,x1:e,y1:n,x2:i,y2:s,c:a}),[u,h]=XD({pos:o,x1:i,y1:s,x2:e,y2:n,c:a}),[d,p,f,m]=ID({sourceX:e,sourceY:n,targetX:i,targetY:s,sourceControlX:l,sourceControlY:c,targetControlX:u,targetControlY:h});return[`M${e},${n} C${l},${c} ${u},${h} ${i},${s}`,d,p,f,m]}qD.displayName="StraightEdge";const YD=(0,t.memo)((e=>{let{sourceX:n,sourceY:r,targetX:i,targetY:s,sourcePosition:o=DD.Bottom,targetPosition:a=DD.Top,label:l,labelStyle:c,labelShowBg:u,labelBgStyle:h,labelBgPadding:d,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,pathOptions:v,interactionWidth:y}=e;const[_,b,x]=JD({sourceX:n,sourceY:r,sourcePosition:o,targetX:i,targetY:s,targetPosition:a,curvature:v?.curvature});return t.createElement(AD,{path:_,labelX:b,labelY:x,label:l,labelStyle:c,labelShowBg:u,labelBgStyle:h,labelBgPadding:d,labelBgBorderRadius:p,style:f,markerEnd:m,markerStart:g,interactionWidth:y})}));YD.displayName="BezierEdge";const ZD=(0,t.createContext)(null),KD=ZD.Provider;ZD.Consumer;const QD=t=>{let{source:e,sourceHandle:n,target:r,targetHandle:i}=t;return`reactflow__edge-${e}${n||""}-${r}${i||""}`},tz=(t,e)=>{if("undefined"===typeof t)return"";if("string"===typeof t)return t;return`${e?`${e}__`:""}${Object.keys(t).sort().map((e=>`${e}=${t[e]}`)).join("&")}`},ez=(t,e)=>{if(!t.source||!t.target)return wD(0,Jk()),e;let n;var r;return n="id"in(r=t)&&"source"in r&&"target"in r?{...t}:{...t,id:QD(t)},((t,e)=>e.some((e=>e.source===t.source&&e.target===t.target&&(e.sourceHandle===t.sourceHandle||!e.sourceHandle&&!t.sourceHandle)&&(e.targetHandle===t.targetHandle||!e.targetHandle&&!t.targetHandle))))(n,e)?e:e.concat(n)},nz=(t,e,n,r)=>{let{x:i,y:s}=t,[o,a,l]=e,[c,u]=r;const h={x:(i-o)/l,y:(s-a)/l};return n?{x:c*Math.round(h.x/c),y:u*Math.round(h.y/u)}:h},rz=(t,e)=>{let{x:n,y:r}=t,[i,s,o]=e;return{x:n*o+i,y:r*o+s}},iz=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];if(!t)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const n=(t.width??0)*e[0],r=(t.height??0)*e[1],i={x:t.position.x-n,y:t.position.y-r};return{...i,positionAbsolute:t.positionAbsolute?{x:t.positionAbsolute.x-n,y:t.positionAbsolute.y-r}:i}},sz=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];if(0===t.length)return{x:0,y:0,width:0,height:0};const n=t.reduce(((t,n)=>{const{x:r,y:i}=iz(n,e).positionAbsolute;return fD(t,mD({x:r,y:i,width:n.width||0,height:n.height||0}))}),{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return gD(n)},oz=function(t,e){let[n,r,i]=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,1],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0];const l={x:(e.x-n)/i,y:(e.y-r)/i,width:e.width/i,height:e.height/i},c=[];return t.forEach((t=>{const{width:e,height:n,selectable:r=!0,hidden:i=!1}=t;if(o&&!r||i)return!1;const{positionAbsolute:u}=iz(t,a),h={x:u.x,y:u.y,width:e||0,height:n||0},d=yD(l,h);("undefined"===typeof e||"undefined"===typeof n||null===e||null===n||s&&d>0||d>=(e||0)*(n||0)||t.dragging)&&c.push(t)})),c},az=(t,e)=>{const n=t.map((t=>t.id));return e.filter((t=>n.includes(t.source)||n.includes(t.target)))},lz=function(t,e,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.1;const o=e/(t.width*(1+s)),a=n/(t.height*(1+s)),l=Math.min(o,a),c=cD(l,r,i);return{x:e/2-(t.x+t.width/2)*c,y:n/2-(t.y+t.height/2)*c,zoom:c}},cz=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.transition().duration(e)};function uz(t,e,n,r){return(e[n]||[]).reduce(((e,i)=>(`${t.id}-${i.id}-${n}`!==r&&e.push({id:i.id||null,type:n,nodeId:t.id,x:(t.positionAbsolute?.x??0)+i.x+i.width/2,y:(t.positionAbsolute?.y??0)+i.y+i.height/2}),e)),[])}const hz={source:null,target:null,sourceHandle:null,targetHandle:null},dz=()=>({handleDomNode:null,isValid:!1,connection:hz,endHandle:null});function pz(t,e,n,r,i,s,o){const a="target"===i,l=o.querySelector(`.react-flow__handle[data-id="${t?.nodeId}-${t?.id}-${t?.type}"]`),c={...dz(),handleDomNode:l};if(l){const t=fz(void 0,l),i=l.getAttribute("data-nodeid"),o=l.getAttribute("data-handleid"),u=l.classList.contains("connectable"),h=l.classList.contains("connectableend"),d={source:a?i:n,sourceHandle:a?o:r,target:a?n:i,targetHandle:a?r:o};c.connection=d;u&&h&&(e===RD.Strict?a&&"source"===t||!a&&"target"===t:i!==n||o!==r)&&(c.endHandle={nodeId:i,handleId:o,type:t},c.isValid=s(d))}return c}function fz(t,e){return t||(e?.classList.contains("target")?"target":e?.classList.contains("source")?"source":null)}function mz(t){t?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function gz(t,e){let n=null;return e?n="valid":t&&!e&&(n="invalid"),n}function vz(t){let{event:e,handleId:n,nodeId:r,onConnect:i,isTarget:s,getState:o,setState:a,isValidConnection:l,edgeUpdaterType:c,onReconnectEnd:u}=t;const h=pD(e.target),{connectionMode:d,domNode:p,autoPanOnConnect:f,connectionRadius:m,onConnectStart:g,panBy:v,getNodes:y,cancelConnection:_}=o();let b,x=0;const{x:w,y:S}=ED(e),M=h?.elementFromPoint(w,S),E=fz(c,M),T=p?.getBoundingClientRect();if(!T||!E)return;let A,C=ED(e,T),P=!1,I=null,R=!1,L=null;const N=function(t){let{nodes:e,nodeId:n,handleId:r,handleType:i}=t;return e.reduce(((t,e)=>{if(e[bD]){const{handleBounds:s}=e[bD];let o=[],a=[];s&&(o=uz(e,s,"source",`${n}-${r}-${i}`),a=uz(e,s,"target",`${n}-${r}-${i}`)),t.push(...o,...a)}return t}),[])}({nodes:y(),nodeId:r,handleId:n,handleType:E}),O=()=>{if(!f)return;const[t,e]=dD(C,T);v({x:t,y:e}),x=requestAnimationFrame(O)};function k(t){const{transform:e}=o();C=ED(t,T);const{handle:i,validHandleResult:c}=function(t,e,n,r,i,s){const{x:o,y:a}=ED(t),l=e.elementsFromPoint(o,a).find((t=>t.classList.contains("react-flow__handle")));if(l){const t=l.getAttribute("data-nodeid");if(t){const e=fz(void 0,l),r=l.getAttribute("data-handleid"),o=s({nodeId:t,id:r,type:e});if(o){const s=i.find((n=>n.nodeId===t&&n.type===e&&n.id===r));return{handle:{id:r,type:e,nodeId:t,x:s?.x||n.x,y:s?.y||n.y},validHandleResult:o}}}}let c=[],u=1/0;if(i.forEach((t=>{const e=Math.sqrt((t.x-n.x)**2+(t.y-n.y)**2);if(e<=r){const n=s(t);e<=u&&(e<u?c=[{handle:t,validHandleResult:n}]:e===u&&c.push({handle:t,validHandleResult:n}),u=e)}})),!c.length)return{handle:null,validHandleResult:dz()};if(1===c.length)return c[0];const h=c.some((t=>{let{validHandleResult:e}=t;return e.isValid})),d=c.some((t=>{let{handle:e}=t;return"target"===e.type}));return c.find((t=>{let{handle:e,validHandleResult:n}=t;return d?"target"===e.type:!h||n.isValid}))||c[0]}(t,h,nz(C,e,!1,[1,1]),m,N,(t=>pz(t,d,r,n,s?"target":"source",l,h)));if(b=i,P||(O(),P=!0),L=c.handleDomNode,I=c.connection,R=c.isValid,a({connectionPosition:b&&R?rz({x:b.x,y:b.y},e):C,connectionStatus:gz(!!b,R),connectionEndHandle:c.endHandle}),!b&&!R&&!L)return mz(A);I.source!==I.target&&L&&(mz(A),A=L,L.classList.add("connecting","react-flow__handle-connecting"),L.classList.toggle("valid",R),L.classList.toggle("react-flow__handle-valid",R))}function D(t){(b||L)&&I&&R&&i?.(I),o().onConnectEnd?.(t),c&&u?.(t),mz(A),_(),cancelAnimationFrame(x),P=!1,R=!1,I=null,L=null,h.removeEventListener("mousemove",k),h.removeEventListener("mouseup",D),h.removeEventListener("touchmove",k),h.removeEventListener("touchend",D)}a({connectionPosition:C,connectionStatus:null,connectionNodeId:r,connectionHandleId:n,connectionHandleType:E,connectionStartHandle:{nodeId:r,handleId:n,type:E},connectionEndHandle:null}),g?.(e,{nodeId:r,handleId:n,handleType:E}),h.addEventListener("mousemove",k),h.addEventListener("mouseup",D),h.addEventListener("touchmove",k),h.addEventListener("touchend",D)}const yz=()=>!0,_z=t=>({connectionStartHandle:t.connectionStartHandle,connectOnClick:t.connectOnClick,noPanClassName:t.noPanClassName}),bz=(0,t.forwardRef)(((e,n)=>{let{type:r="source",position:i=DD.Top,isValidConnection:s,isConnectable:o=!0,isConnectableStart:a=!0,isConnectableEnd:l=!0,id:c,onConnect:u,children:h,className:d,onMouseDown:p,onTouchStart:f,...m}=e;const g=c||null,v="target"===r,y=rD(),_=(0,t.useContext)(ZD),{connectOnClick:b,noPanClassName:x}=nD(_z,eL),{connecting:w,clickConnecting:S}=nD(((t,e,n)=>r=>{const{connectionStartHandle:i,connectionEndHandle:s,connectionClickStartHandle:o}=r;return{connecting:i?.nodeId===t&&i?.handleId===e&&i?.type===n||s?.nodeId===t&&s?.handleId===e&&s?.type===n,clickConnecting:o?.nodeId===t&&o?.handleId===e&&o?.type===n}})(_,g,r),eL);_||y.getState().onError?.("010",Kk());const M=t=>{const{defaultEdgeOptions:e,onConnect:n,hasDefaultEdges:r}=y.getState(),i={...e,...t};if(r){const{edges:t,setEdges:e}=y.getState();e(ez(i,t))}n?.(i),u?.(i)},E=t=>{if(!_)return;const e=MD(t);a&&(e&&0===t.button||!e)&&vz({event:t,handleId:g,nodeId:_,onConnect:M,isTarget:v,getState:y.getState,setState:y.setState,isValidConnection:s||y.getState().isValidConnection||yz}),e?p?.(t):f?.(t)};return t.createElement("div",{"data-handleid":g,"data-nodeid":_,"data-handlepos":i,"data-id":`${_}-${g}-${r}`,className:qR(["react-flow__handle",`react-flow__handle-${i}`,"nodrag",x,d,{source:!v,target:v,connectable:o,connectablestart:a,connectableend:l,connecting:S,connectionindicator:o&&(a&&!w||l&&w)}]),onMouseDown:E,onTouchStart:E,onClick:b?t=>{const{onClickConnectStart:e,onClickConnectEnd:n,connectionClickStartHandle:i,connectionMode:o,isValidConnection:l}=y.getState();if(!_||!i&&!a)return;if(!i)return e?.(t,{nodeId:_,handleId:g,handleType:r}),void y.setState({connectionClickStartHandle:{nodeId:_,type:r,handleId:g}});const c=pD(t.target),u=s||l||yz,{connection:h,isValid:d}=pz({nodeId:_,id:g,type:r},o,i.nodeId,i.handleId||null,i.type,u,c);d&&M(h),n?.(t),y.setState({connectionClickStartHandle:null})}:void 0,ref:n,...m},h)}));bz.displayName="Handle";var xz=(0,t.memo)(bz);const wz=e=>{let{data:n,isConnectable:r,targetPosition:i=DD.Top,sourcePosition:s=DD.Bottom}=e;return t.createElement(t.Fragment,null,t.createElement(xz,{type:"target",position:i,isConnectable:r}),n?.label,t.createElement(xz,{type:"source",position:s,isConnectable:r}))};wz.displayName="DefaultNode";var Sz=(0,t.memo)(wz);const Mz=e=>{let{data:n,isConnectable:r,sourcePosition:i=DD.Bottom}=e;return t.createElement(t.Fragment,null,n?.label,t.createElement(xz,{type:"source",position:i,isConnectable:r}))};Mz.displayName="InputNode";var Ez=(0,t.memo)(Mz);const Tz=e=>{let{data:n,isConnectable:r,targetPosition:i=DD.Top}=e;return t.createElement(t.Fragment,null,t.createElement(xz,{type:"target",position:i,isConnectable:r}),n?.label)};Tz.displayName="OutputNode";var Az=(0,t.memo)(Tz);const Cz=()=>null;Cz.displayName="GroupNode";const Pz=t=>({selectedNodes:t.getNodes().filter((t=>t.selected)),selectedEdges:t.edges.filter((t=>t.selected)).map((t=>({...t})))}),Iz=t=>t.id;function Rz(t,e){return eL(t.selectedNodes.map(Iz),e.selectedNodes.map(Iz))&&eL(t.selectedEdges.map(Iz),e.selectedEdges.map(Iz))}const Lz=(0,t.memo)((e=>{let{onSelectionChange:n}=e;const r=rD(),{selectedNodes:i,selectedEdges:s}=nD(Pz,Rz);return(0,t.useEffect)((()=>{const t={nodes:i,edges:s};n?.(t),r.getState().onSelectionChange.forEach((e=>e(t)))}),[i,s,n]),null}));Lz.displayName="SelectionListener";const Nz=t=>!!t.onSelectionChange;function Oz(e){let{onSelectionChange:n}=e;const r=nD(Nz);return n||r?t.createElement(Lz,{onSelectionChange:n}):null}const kz=t=>({setNodes:t.setNodes,setEdges:t.setEdges,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset});function Dz(e,n){(0,t.useEffect)((()=>{"undefined"!==typeof e&&n(e)}),[e])}function zz(e,n,r){(0,t.useEffect)((()=>{"undefined"!==typeof n&&r({[e]:n})}),[n])}const Uz=e=>{let{nodes:n,edges:r,defaultNodes:i,defaultEdges:s,onConnect:o,onConnectStart:a,onConnectEnd:l,onClickConnectStart:c,onClickConnectEnd:u,nodesDraggable:h,nodesConnectable:d,nodesFocusable:p,edgesFocusable:f,edgesUpdatable:m,elevateNodesOnSelect:g,minZoom:v,maxZoom:y,nodeExtent:_,onNodesChange:b,onEdgesChange:x,elementsSelectable:w,connectionMode:S,snapGrid:M,snapToGrid:E,translateExtent:T,connectOnClick:A,defaultEdgeOptions:C,fitView:P,fitViewOptions:I,onNodesDelete:R,onEdgesDelete:L,onNodeDrag:N,onNodeDragStart:O,onNodeDragStop:k,onSelectionDrag:D,onSelectionDragStart:z,onSelectionDragStop:U,noPanClassName:F,nodeOrigin:B,rfId:V,autoPanOnConnect:H,autoPanOnNodeDrag:j,onError:W,connectionRadius:G,isValidConnection:q,nodeDragThreshold:$}=e;const{setNodes:X,setEdges:J,setDefaultNodesAndEdges:Y,setMinZoom:Z,setMaxZoom:K,setTranslateExtent:Q,setNodeExtent:tt,reset:et}=nD(kz,eL),nt=rD();return(0,t.useEffect)((()=>{const t=s?.map((t=>({...t,...C})));return Y(i,t),()=>{et()}}),[]),zz("defaultEdgeOptions",C,nt.setState),zz("connectionMode",S,nt.setState),zz("onConnect",o,nt.setState),zz("onConnectStart",a,nt.setState),zz("onConnectEnd",l,nt.setState),zz("onClickConnectStart",c,nt.setState),zz("onClickConnectEnd",u,nt.setState),zz("nodesDraggable",h,nt.setState),zz("nodesConnectable",d,nt.setState),zz("nodesFocusable",p,nt.setState),zz("edgesFocusable",f,nt.setState),zz("edgesUpdatable",m,nt.setState),zz("elementsSelectable",w,nt.setState),zz("elevateNodesOnSelect",g,nt.setState),zz("snapToGrid",E,nt.setState),zz("snapGrid",M,nt.setState),zz("onNodesChange",b,nt.setState),zz("onEdgesChange",x,nt.setState),zz("connectOnClick",A,nt.setState),zz("fitViewOnInit",P,nt.setState),zz("fitViewOnInitOptions",I,nt.setState),zz("onNodesDelete",R,nt.setState),zz("onEdgesDelete",L,nt.setState),zz("onNodeDrag",N,nt.setState),zz("onNodeDragStart",O,nt.setState),zz("onNodeDragStop",k,nt.setState),zz("onSelectionDrag",D,nt.setState),zz("onSelectionDragStart",z,nt.setState),zz("onSelectionDragStop",U,nt.setState),zz("noPanClassName",F,nt.setState),zz("nodeOrigin",B,nt.setState),zz("rfId",V,nt.setState),zz("autoPanOnConnect",H,nt.setState),zz("autoPanOnNodeDrag",j,nt.setState),zz("onError",W,nt.setState),zz("connectionRadius",G,nt.setState),zz("isValidConnection",q,nt.setState),zz("nodeDragThreshold",$,nt.setState),Dz(n,X),Dz(r,J),Dz(v,Z),Dz(y,K),Dz(T,Q),Dz(_,tt),null},Fz={display:"none"},Bz={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Vz="react-flow__node-desc",Hz="react-flow__edge-desc",jz=t=>t.ariaLiveMessage;function Wz(e){let{rfId:n}=e;const r=nD(jz);return t.createElement("div",{id:`react-flow__aria-live-${n}`,"aria-live":"assertive","aria-atomic":"true",style:Bz},r)}function Gz(e){let{rfId:n,disableKeyboardA11y:r}=e;return t.createElement(t.Fragment,null,t.createElement("div",{id:`${Vz}-${n}`,style:Fz},"Press enter or space to select a node.",!r&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),t.createElement("div",{id:`${Hz}-${n}`,style:Fz},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!r&&t.createElement(Wz,{rfId:n}))}var qz=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{actInsideInputWithModifier:!0};const[r,i]=(0,t.useState)(!1),s=(0,t.useRef)(!1),o=(0,t.useRef)(new Set([])),[a,l]=(0,t.useMemo)((()=>{if(null!==e){const t=(Array.isArray(e)?e:[e]).filter((t=>"string"===typeof t)).map((t=>t.split("+"))),n=t.reduce(((t,e)=>t.concat(...e)),[]);return[t,n]}return[[],[]]}),[e]);return(0,t.useEffect)((()=>{const t="undefined"!==typeof document?document:null,r=n?.target||t;if(null!==e){const t=t=>{s.current=t.ctrlKey||t.metaKey||t.shiftKey;if((!s.current||s.current&&!n.actInsideInputWithModifier)&&SD(t))return!1;const e=Xz(t.code,l);o.current.add(t[e]),$z(a,o.current,!1)&&(t.preventDefault(),i(!0))},e=t=>{if((!s.current||s.current&&!n.actInsideInputWithModifier)&&SD(t))return!1;const e=Xz(t.code,l);$z(a,o.current,!0)?(i(!1),o.current.clear()):o.current.delete(t[e]),"Meta"===t.key&&o.current.clear(),s.current=!1},c=()=>{o.current.clear(),i(!1)};return r?.addEventListener("keydown",t),r?.addEventListener("keyup",e),window.addEventListener("blur",c),()=>{r?.removeEventListener("keydown",t),r?.removeEventListener("keyup",e),window.removeEventListener("blur",c)}}}),[e,i]),r};function $z(t,e,n){return t.filter((t=>n||t.length===e.size)).some((t=>t.every((t=>e.has(t)))))}function Xz(t,e){return e.includes(t)?"code":"key"}function Jz(t,e,n,r){const i=t.parentNode||t.parentId;if(!i)return n;const s=e.get(i),o=iz(s,r);return Jz(s,e,{x:(n.x??0)+o.x,y:(n.y??0)+o.y,z:(s[bD]?.z??0)>(n.z??0)?s[bD]?.z??0:n.z??0},r)}function Yz(t,e,n){t.forEach((r=>{const i=r.parentNode||r.parentId;if(i&&!t.has(i))throw new Error(`Parent node ${i} not found`);if(i||n?.[r.id]){const{x:i,y:s,z:o}=Jz(r,t,{...r.position,z:r[bD]?.z??0},e);r.positionAbsolute={x:i,y:s},r[bD].z=o,n?.[r.id]&&(r[bD].isParent=!0)}}))}function Zz(t,e,n,r){const i=new Map,s={},o=r?1e3:0;return t.forEach((t=>{const n=(_D(t.zIndex)?t.zIndex:0)+(t.selected?o:0),r=e.get(t.id),a={...t,positionAbsolute:{x:t.position.x,y:t.position.y}},l=t.parentNode||t.parentId;l&&(s[l]=!0);const c=r?.type&&r?.type!==t.type;Object.defineProperty(a,bD,{enumerable:!1,value:{handleBounds:c?void 0:r?.[bD]?.handleBounds,z:n}}),i.set(t.id,a)})),Yz(i,n,s),i}function Kz(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{getNodes:n,width:r,height:i,minZoom:s,maxZoom:o,d3Zoom:a,d3Selection:l,fitViewOnInitDone:c,fitViewOnInit:u,nodeOrigin:h}=t(),d=e.initial&&!c&&u;if(a&&l&&(d||!e.initial)){const t=n().filter((t=>{const n=e.includeHiddenNodes?t.width&&t.height:!t.hidden;return e.nodes?.length?n&&e.nodes.some((e=>e.id===t.id)):n})),c=t.every((t=>t.width&&t.height));if(t.length>0&&c){const n=sz(t,h),{x:c,y:u,zoom:d}=lz(n,r,i,e.minZoom??s,e.maxZoom??o,e.padding??.1),p=Ak.translate(c,u).scale(d);return"number"===typeof e.duration&&e.duration>0?a.transform(cz(l,e.duration),p):a.transform(l,p),!0}}return!1}function Qz(t,e){return t.forEach((t=>{const n=e.get(t.id);n&&e.set(n.id,{...n,[bD]:n[bD],selected:t.selected})})),new Map(e)}function tU(t,e){return e.map((e=>{const n=t.find((t=>t.id===e.id));return n&&(e.selected=n.selected),e}))}function eU(t){let{changedNodes:e,changedEdges:n,get:r,set:i}=t;const{nodeInternals:s,edges:o,onNodesChange:a,onEdgesChange:l,hasDefaultNodes:c,hasDefaultEdges:u}=r();e?.length&&(c&&i({nodeInternals:Qz(e,s)}),a?.(e)),n?.length&&(u&&i({edges:tU(n,o)}),l?.(n))}const nU=()=>{},rU={zoomIn:nU,zoomOut:nU,zoomTo:nU,getZoom:()=>1,setViewport:nU,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:nU,fitBounds:nU,project:t=>t,screenToFlowPosition:t=>t,flowToScreenPosition:t=>t,viewportInitialized:!1},iU=t=>({d3Zoom:t.d3Zoom,d3Selection:t.d3Selection});function sU(){const e=(()=>{const e=rD(),{d3Zoom:n,d3Selection:r}=nD(iU,eL),i=(0,t.useMemo)((()=>r&&n?{zoomIn:t=>n.scaleBy(cz(r,t?.duration),1.2),zoomOut:t=>n.scaleBy(cz(r,t?.duration),1/1.2),zoomTo:(t,e)=>n.scaleTo(cz(r,e?.duration),t),getZoom:()=>e.getState().transform[2],setViewport:(t,i)=>{const[s,o,a]=e.getState().transform,l=Ak.translate(t.x??s,t.y??o).scale(t.zoom??a);n.transform(cz(r,i?.duration),l)},getViewport:()=>{const[t,n,r]=e.getState().transform;return{x:t,y:n,zoom:r}},fitView:t=>Kz(e.getState,t),setCenter:(t,i,s)=>{const{width:o,height:a,maxZoom:l}=e.getState(),c="undefined"!==typeof s?.zoom?s.zoom:l,u=o/2-t*c,h=a/2-i*c,d=Ak.translate(u,h).scale(c);n.transform(cz(r,s?.duration),d)},fitBounds:(t,i)=>{const{width:s,height:o,minZoom:a,maxZoom:l}=e.getState(),{x:c,y:u,zoom:h}=lz(t,s,o,a,l,i?.padding??.1),d=Ak.translate(c,u).scale(h);n.transform(cz(r,i?.duration),d)},project:t=>{const{transform:n,snapToGrid:r,snapGrid:i}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),nz(t,n,r,i)},screenToFlowPosition:t=>{const{transform:n,snapToGrid:r,snapGrid:i,domNode:s}=e.getState();if(!s)return t;const{x:o,y:a}=s.getBoundingClientRect(),l={x:t.x-o,y:t.y-a};return nz(l,n,r,i)},flowToScreenPosition:t=>{const{transform:n,domNode:r}=e.getState();if(!r)return t;const{x:i,y:s}=r.getBoundingClientRect(),o=rz(t,n);return{x:o.x+i,y:o.y+s}},viewportInitialized:!0}:rU),[n,r]);return i})(),n=rD(),r=(0,t.useCallback)((()=>n.getState().getNodes().map((t=>({...t})))),[]),i=(0,t.useCallback)((t=>n.getState().nodeInternals.get(t)),[]),s=(0,t.useCallback)((()=>{const{edges:t=[]}=n.getState();return t.map((t=>({...t})))}),[]),o=(0,t.useCallback)((t=>{const{edges:e=[]}=n.getState();return e.find((e=>e.id===t))}),[]),a=(0,t.useCallback)((t=>{const{getNodes:e,setNodes:r,hasDefaultNodes:i,onNodesChange:s}=n.getState(),o=e(),a="function"===typeof t?t(o):t;if(i)r(a);else if(s){const t=0===a.length?o.map((t=>({type:"remove",id:t.id}))):a.map((t=>({item:t,type:"reset"})));s(t)}}),[]),l=(0,t.useCallback)((t=>{const{edges:e=[],setEdges:r,hasDefaultEdges:i,onEdgesChange:s}=n.getState(),o="function"===typeof t?t(e):t;if(i)r(o);else if(s){s(0===o.length?e.map((t=>({type:"remove",id:t.id}))):o.map((t=>({item:t,type:"reset"}))))}}),[]),c=(0,t.useCallback)((t=>{const e=Array.isArray(t)?t:[t],{getNodes:r,setNodes:i,hasDefaultNodes:s,onNodesChange:o}=n.getState();if(s){i([...r(),...e])}else if(o){const t=e.map((t=>({item:t,type:"add"})));o(t)}}),[]),u=(0,t.useCallback)((t=>{const e=Array.isArray(t)?t:[t],{edges:r=[],setEdges:i,hasDefaultEdges:s,onEdgesChange:o}=n.getState();if(s)i([...r,...e]);else if(o){o(e.map((t=>({item:t,type:"add"}))))}}),[]),h=(0,t.useCallback)((()=>{const{getNodes:t,edges:e=[],transform:r}=n.getState(),[i,s,o]=r;return{nodes:t().map((t=>({...t}))),edges:e.map((t=>({...t}))),viewport:{x:i,y:s,zoom:o}}}),[]),d=(0,t.useCallback)((t=>{let{nodes:e,edges:r}=t;const{nodeInternals:i,getNodes:s,edges:o,hasDefaultNodes:a,hasDefaultEdges:l,onNodesDelete:c,onEdgesDelete:u,onNodesChange:h,onEdgesChange:d}=n.getState(),p=(e||[]).map((t=>t.id)),f=(r||[]).map((t=>t.id)),m=s().reduce(((t,e)=>{const n=e.parentNode||e.parentId,r=!p.includes(e.id)&&n&&t.find((t=>t.id===n));return("boolean"!==typeof e.deletable||e.deletable)&&(p.includes(e.id)||r)&&t.push(e),t}),[]),g=o.filter((t=>"boolean"!==typeof t.deletable||t.deletable)),v=g.filter((t=>f.includes(t.id)));if(m||v){const t=az(m,g),e=[...v,...t],r=e.reduce(((t,e)=>(t.includes(e.id)||t.push(e.id),t)),[]);if((l||a)&&(l&&n.setState({edges:o.filter((t=>!r.includes(t.id)))}),a&&(m.forEach((t=>{i.delete(t.id)})),n.setState({nodeInternals:new Map(i)}))),r.length>0&&(u?.(e),d&&d(r.map((t=>({id:t,type:"remove"}))))),m.length>0&&(c?.(m),h)){const t=m.map((t=>({id:t.id,type:"remove"})));h(t)}}}),[]),p=(0,t.useCallback)((t=>{const e=_D((r=t).width)&&_D(r.height)&&_D(r.x)&&_D(r.y);var r;const i=e?null:n.getState().nodeInternals.get(t.id);if(!e&&!i)return[null,null,e];return[e?t:vD(i),i,e]}),[]),f=(0,t.useCallback)((function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;const[i,s,o]=p(t);return i?(r||n.getState().getNodes()).filter((t=>{if(!o&&(t.id===s.id||!t.positionAbsolute))return!1;const n=vD(t),r=yD(n,i);return e&&r>0||r>=i.width*i.height})):[]}),[]),m=(0,t.useCallback)((function(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const[r]=p(t);if(!r)return!1;const i=yD(r,e);return n&&i>0||i>=r.width*r.height}),[]);return(0,t.useMemo)((()=>({...e,getNodes:r,getNode:i,getEdges:s,getEdge:o,setNodes:a,setEdges:l,addNodes:c,addEdges:u,toObject:h,deleteElements:d,getIntersectingNodes:f,isNodeIntersecting:m})),[e,r,i,s,o,a,l,c,u,h,d,f,m])}const oU={actInsideInputWithModifier:!1};const aU={position:"absolute",width:"100%",height:"100%",top:0,left:0},lU=t=>({x:t.x,y:t.y,zoom:t.k}),cU=(t,e)=>t.target.closest(`.${e}`),uU=(t,e)=>2===e&&Array.isArray(t)&&t.includes(2),hU=t=>{const e=t.ctrlKey&&TD()?10:1;return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*e},dU=t=>({d3Zoom:t.d3Zoom,d3Selection:t.d3Selection,d3ZoomHandler:t.d3ZoomHandler,userSelectionActive:t.userSelectionActive}),pU=e=>{let{onMove:n,onMoveStart:r,onMoveEnd:i,onPaneContextMenu:s,zoomOnScroll:o=!0,zoomOnPinch:a=!0,panOnScroll:l=!1,panOnScrollSpeed:c=.5,panOnScrollMode:u=LD.Free,zoomOnDoubleClick:h=!0,elementsSelectable:d,panOnDrag:p=!0,defaultViewport:f,translateExtent:m,minZoom:g,maxZoom:v,zoomActivationKeyCode:y,preventScrolling:_=!0,children:b,noWheelClassName:x,noPanClassName:w}=e;const S=(0,t.useRef)(),M=rD(),E=(0,t.useRef)(!1),T=(0,t.useRef)(!1),A=(0,t.useRef)(null),C=(0,t.useRef)({x:0,y:0,zoom:0}),{d3Zoom:P,d3Selection:I,d3ZoomHandler:R,userSelectionActive:L}=nD(dU,eL),N=qz(y),O=(0,t.useRef)(0),k=(0,t.useRef)(!1),D=(0,t.useRef)();return function(e){const n=rD();(0,t.useEffect)((()=>{let t;const r=()=>{if(!e.current)return;const t=lD(e.current);0!==t.height&&0!==t.width||n.getState().onError?.("004",$k()),n.setState({width:t.width||500,height:t.height||500})};return r(),window.addEventListener("resize",r),e.current&&(t=new ResizeObserver((()=>r())),t.observe(e.current)),()=>{window.removeEventListener("resize",r),t&&e.current&&t.unobserve(e.current)}}),[])}(A),(0,t.useEffect)((()=>{if(A.current){const t=A.current.getBoundingClientRect(),e=function(){var t,e,n,r=Ik,i=Rk,s=kk,o=Nk,a=Ok,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,h=PN,d=aL("start","zoom","end"),p=0,f=10;function m(t){t.property("__zoom",Lk).on("wheel.zoom",w,{passive:!1}).on("mousedown.zoom",S).on("dblclick.zoom",M).filter(a).on("touchstart.zoom",E).on("touchmove.zoom",T).on("touchend.zoom touchcancel.zoom",A).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(t,e){return(e=Math.max(l[0],Math.min(l[1],e)))===t.k?t:new Tk(e,t.x,t.y)}function v(t,e,n){var r=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return r===t.x&&i===t.y?t:new Tk(t.k,r,i)}function y(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function _(t,e,n,r){t.on("start.zoom",(function(){b(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){b(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,s=arguments,o=b(t,s).event(r),a=i.apply(t,s),l=null==n?y(a):"function"===typeof n?n.apply(t,s):n,c=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),u=t.__zoom,d="function"===typeof e?e.apply(t,s):e,p=h(u.invert(l).concat(c/u.k),d.invert(l).concat(c/d.k));return function(t){if(1===t)t=d;else{var e=p(t),n=c/e[2];t=new Tk(n,l[0]-e[0]*n,l[1]-e[1]*n)}o.zoom(null,t)}}))}function b(t,e,n){return!n&&t.__zooming||new x(t,e)}function x(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=i.apply(t,e),this.taps=0}function w(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];if(r.apply(this,arguments)){var a=b(this,n).event(t),u=this.__zoom,h=Math.max(l[0],Math.min(l[1],u.k*Math.pow(2,o.apply(this,arguments)))),d=IN(t);if(a.wheel)a.mouse[0][0]===d[0]&&a.mouse[0][1]===d[1]||(a.mouse[1]=u.invert(a.mouse[0]=d)),clearTimeout(a.wheel);else{if(u.k===h)return;a.mouse=[d,u.invert(d)],eO(this),a.start()}Pk(t),a.wheel=setTimeout((function(){a.wheel=null,a.end()}),150),a.zoom("mouse",s(v(g(u,h),a.mouse[0],a.mouse[1]),a.extent,c))}}function S(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];if(!n&&r.apply(this,arguments)){var a=t.currentTarget,l=b(this,i,!0).event(t),u=xN(t.view).on("mousemove.zoom",(function(t){if(Pk(t),!l.moved){var e=t.clientX-d,n=t.clientY-f;l.moved=e*e+n*n>p}l.event(t).zoom("mouse",s(v(l.that.__zoom,l.mouse[0]=IN(t,a),l.mouse[1]),l.extent,c))}),!0).on("mouseup.zoom",(function(t){u.on("mousemove.zoom mouseup.zoom",null),AN(t.view,l.moved),Pk(t),l.event(t).end()}),!0),h=IN(t,a),d=t.clientX,f=t.clientY;TN(t.view),Ck(t),l.mouse=[h,this.__zoom.invert(h)],eO(this),l.start()}}function M(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];if(r.apply(this,arguments)){var a=this.__zoom,l=IN(t.changedTouches?t.changedTouches[0]:t,this),h=a.invert(l),d=a.k*(t.shiftKey?.5:2),p=s(v(g(a,d),l,h),i.apply(this,n),c);Pk(t),u>0?xN(this).transition().duration(u).call(_,p,l,t):xN(this).call(m.transform,p,l,t)}}function E(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];if(r.apply(this,arguments)){var a,l,c,u,h=n.touches,d=h.length,p=b(this,s,n.changedTouches.length===d).event(n);for(Ck(n),l=0;l<d;++l)u=[u=IN(c=h[l],this),this.__zoom.invert(u),c.identifier],p.touch0?p.touch1||p.touch0[2]===u[2]||(p.touch1=u,p.taps=0):(p.touch0=u,a=!0,p.taps=1+!!t);t&&(t=clearTimeout(t)),a&&(p.taps<2&&(e=u[0],t=setTimeout((function(){t=null}),500)),eO(this),p.start())}}function T(t){if(this.__zooming){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i,o,a,l,u=b(this,n).event(t),h=t.changedTouches,d=h.length;for(Pk(t),i=0;i<d;++i)a=IN(o=h[i],this),u.touch0&&u.touch0[2]===o.identifier?u.touch0[0]=a:u.touch1&&u.touch1[2]===o.identifier&&(u.touch1[0]=a);if(o=u.that.__zoom,u.touch1){var p=u.touch0[0],f=u.touch0[1],m=u.touch1[0],y=u.touch1[1],_=(_=m[0]-p[0])*_+(_=m[1]-p[1])*_,x=(x=y[0]-f[0])*x+(x=y[1]-f[1])*x;o=g(o,Math.sqrt(_/x)),a=[(p[0]+m[0])/2,(p[1]+m[1])/2],l=[(f[0]+y[0])/2,(f[1]+y[1])/2]}else{if(!u.touch0)return;a=u.touch0[0],l=u.touch0[1]}u.zoom("touch",s(v(o,a,l),u.extent,c))}}function A(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];if(this.__zooming){var o,a,l=b(this,i).event(t),c=t.changedTouches,u=c.length;for(Ck(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),500),o=0;o<u;++o)a=c[o],l.touch0&&l.touch0[2]===a.identifier?delete l.touch0:l.touch1&&l.touch1[2]===a.identifier&&delete l.touch1;if(l.touch1&&!l.touch0&&(l.touch0=l.touch1,delete l.touch1),l.touch0)l.touch0[1]=this.__zoom.invert(l.touch0[0]);else if(l.end(),2===l.taps&&(a=IN(a,this),Math.hypot(e[0]-a[0],e[1]-a[1])<f)){var h=xN(this).on("dblclick.zoom");h&&h.apply(this,arguments)}}}return m.transform=function(t,e,n,r){var i=t.selection?t.selection():t;i.property("__zoom",Lk),t!==i?_(t,e,n,r):i.interrupt().each((function(){b(this,arguments).event(r).start().zoom(null,"function"===typeof e?e.apply(this,arguments):e).end()}))},m.scaleBy=function(t,e,n,r){m.scaleTo(t,(function(){return this.__zoom.k*("function"===typeof e?e.apply(this,arguments):e)}),n,r)},m.scaleTo=function(t,e,n,r){m.transform(t,(function(){var t=i.apply(this,arguments),r=this.__zoom,o=null==n?y(t):"function"===typeof n?n.apply(this,arguments):n,a=r.invert(o),l="function"===typeof e?e.apply(this,arguments):e;return s(v(g(r,l),o,a),t,c)}),n,r)},m.translateBy=function(t,e,n,r){m.transform(t,(function(){return s(this.__zoom.translate("function"===typeof e?e.apply(this,arguments):e,"function"===typeof n?n.apply(this,arguments):n),i.apply(this,arguments),c)}),null,r)},m.translateTo=function(t,e,n,r,o){m.transform(t,(function(){var t=i.apply(this,arguments),o=this.__zoom,a=null==r?y(t):"function"===typeof r?r.apply(this,arguments):r;return s(Ak.translate(a[0],a[1]).scale(o.k).translate("function"===typeof e?-e.apply(this,arguments):-e,"function"===typeof n?-n.apply(this,arguments):-n),t,c)}),r,o)},x.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=xN(this.that).datum();d.call(t,this.that,new Ek(t,{sourceEvent:this.sourceEvent,target:m,type:t,transform:this.that.__zoom,dispatch:d}),e)}},m.wheelDelta=function(t){return arguments.length?(o="function"===typeof t?t:Mk(+t),m):o},m.filter=function(t){return arguments.length?(r="function"===typeof t?t:Mk(!!t),m):r},m.touchable=function(t){return arguments.length?(a="function"===typeof t?t:Mk(!!t),m):a},m.extent=function(t){return arguments.length?(i="function"===typeof t?t:Mk([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):i},m.scaleExtent=function(t){return arguments.length?(l[0]=+t[0],l[1]=+t[1],m):[l[0],l[1]]},m.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],m):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},m.constrain=function(t){return arguments.length?(s=t,m):s},m.duration=function(t){return arguments.length?(u=+t,m):u},m.interpolate=function(t){return arguments.length?(h=t,m):h},m.on=function(){var t=d.on.apply(d,arguments);return t===d?m:t},m.clickDistance=function(t){return arguments.length?(p=(t=+t)*t,m):Math.sqrt(p)},m.tapDistance=function(t){return arguments.length?(f=+t,m):f},m}().scaleExtent([g,v]).translateExtent(m),n=xN(A.current).call(e),r=Ak.translate(f.x,f.y).scale(cD(f.zoom,g,v)),i=[[0,0],[t.width,t.height]],s=e.constrain()(r,i,m);e.transform(n,s),e.wheelDelta(hU),M.setState({d3Zoom:e,d3Selection:n,d3ZoomHandler:n.on("wheel.zoom"),transform:[s.x,s.y,s.k],domNode:A.current.closest(".react-flow")})}}),[]),(0,t.useEffect)((()=>{I&&P&&(!l||N||L?"undefined"!==typeof R&&I.on("wheel.zoom",(function(t,e){if(!_&&"wheel"===t.type&&!t.ctrlKey||cU(t,x))return null;t.preventDefault(),R.call(this,t,e)}),{passive:!1}):I.on("wheel.zoom",(t=>{if(cU(t,x))return!1;t.preventDefault(),t.stopImmediatePropagation();const e=I.property("__zoom").k||1;if(t.ctrlKey&&a){const n=IN(t),r=hU(t),i=e*Math.pow(2,r);return void P.scaleTo(I,i,n,t)}const s=1===t.deltaMode?20:1;let o=u===LD.Vertical?0:t.deltaX*s,l=u===LD.Horizontal?0:t.deltaY*s;!TD()&&t.shiftKey&&u!==LD.Vertical&&(o=t.deltaY*s,l=0),P.translateBy(I,-o/e*c,-l/e*c,{internal:!0});const h=lU(I.property("__zoom")),{onViewportChangeStart:d,onViewportChange:p,onViewportChangeEnd:f}=M.getState();clearTimeout(D.current),k.current||(k.current=!0,r?.(t,h),d?.(h)),k.current&&(n?.(t,h),p?.(h),D.current=setTimeout((()=>{i?.(t,h),f?.(h),k.current=!1}),150))}),{passive:!1}))}),[L,l,u,I,P,R,N,a,_,x,r,n,i]),(0,t.useEffect)((()=>{P&&P.on("start",(t=>{if(!t.sourceEvent||t.sourceEvent.internal)return null;O.current=t.sourceEvent?.button;const{onViewportChangeStart:e}=M.getState(),n=lU(t.transform);E.current=!0,C.current=n,"mousedown"===t.sourceEvent?.type&&M.setState({paneDragging:!0}),e?.(n),r?.(t.sourceEvent,n)}))}),[P,r]),(0,t.useEffect)((()=>{P&&(L&&!E.current?P.on("zoom",null):L||P.on("zoom",(t=>{const{onViewportChange:e}=M.getState();if(M.setState({transform:[t.transform.x,t.transform.y,t.transform.k]}),T.current=!(!s||!uU(p,O.current??0)),(n||e)&&!t.sourceEvent?.internal){const r=lU(t.transform);e?.(r),n?.(t.sourceEvent,r)}})))}),[L,P,n,p,s]),(0,t.useEffect)((()=>{P&&P.on("end",(t=>{if(!t.sourceEvent||t.sourceEvent.internal)return null;const{onViewportChangeEnd:e}=M.getState();if(E.current=!1,M.setState({paneDragging:!1}),s&&uU(p,O.current??0)&&!T.current&&s(t.sourceEvent),T.current=!1,(i||e)&&(n=C.current,r=t.transform,n.x!==r.x||n.y!==r.y||n.zoom!==r.k)){const n=lU(t.transform);C.current=n,clearTimeout(S.current),S.current=setTimeout((()=>{e?.(n),i?.(t.sourceEvent,n)}),l?150:0)}var n,r}))}),[P,l,p,i,s]),(0,t.useEffect)((()=>{P&&P.filter((t=>{const e=N||o,n=a&&t.ctrlKey;if((!0===p||Array.isArray(p)&&p.includes(1))&&1===t.button&&"mousedown"===t.type&&(cU(t,"react-flow__node")||cU(t,"react-flow__edge")))return!0;if(!p&&!e&&!l&&!h&&!a)return!1;if(L)return!1;if(!h&&"dblclick"===t.type)return!1;if(cU(t,x)&&"wheel"===t.type)return!1;if(cU(t,w)&&("wheel"!==t.type||l&&"wheel"===t.type&&!N))return!1;if(!a&&t.ctrlKey&&"wheel"===t.type)return!1;if(!e&&!l&&!n&&"wheel"===t.type)return!1;if(!p&&("mousedown"===t.type||"touchstart"===t.type))return!1;if(Array.isArray(p)&&!p.includes(t.button)&&"mousedown"===t.type)return!1;const r=Array.isArray(p)&&p.includes(t.button)||!t.button||t.button<=1;return(!t.ctrlKey||"wheel"===t.type)&&r}))}),[L,P,o,a,l,h,p,d,N]),t.createElement("div",{className:"react-flow__renderer",ref:A,style:aU},b)},fU=t=>({userSelectionActive:t.userSelectionActive,userSelectionRect:t.userSelectionRect});function mU(){const{userSelectionActive:e,userSelectionRect:n}=nD(fU,eL);return e&&n?t.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:n.width,height:n.height,transform:`translate(${n.x}px, ${n.y}px)`}}):null}function gU(t,e){const n=e.parentNode||e.parentId,r=t.find((t=>t.id===n));if(r){const t=e.position.x+e.width-r.width,n=e.position.y+e.height-r.height;if(t>0||n>0||e.position.x<0||e.position.y<0){if(r.style={...r.style}||{},r.style.width=r.style.width??r.width,r.style.height=r.style.height??r.height,t>0&&(r.style.width+=t),n>0&&(r.style.height+=n),e.position.x<0){const t=Math.abs(e.position.x);r.position.x=r.position.x-t,r.style.width+=t,e.position.x=0}if(e.position.y<0){const t=Math.abs(e.position.y);r.position.y=r.position.y-t,r.style.height+=t,e.position.y=0}r.width=r.style.width,r.height=r.style.height}}}function vU(t,e){if(t.some((t=>"reset"===t.type)))return t.filter((t=>"reset"===t.type)).map((t=>t.item));const n=t.filter((t=>"add"===t.type)).map((t=>t.item));return e.reduce(((e,n)=>{const r=t.filter((t=>t.id===n.id));if(0===r.length)return e.push(n),e;const i={...n};for(const t of r)if(t)switch(t.type){case"select":i.selected=t.selected;break;case"position":"undefined"!==typeof t.position&&(i.position=t.position),"undefined"!==typeof t.positionAbsolute&&(i.positionAbsolute=t.positionAbsolute),"undefined"!==typeof t.dragging&&(i.dragging=t.dragging),i.expandParent&&gU(e,i);break;case"dimensions":"undefined"!==typeof t.dimensions&&(i.width=t.dimensions.width,i.height=t.dimensions.height),"undefined"!==typeof t.updateStyle&&(i.style={...i.style||{},...t.dimensions}),"boolean"===typeof t.resizing&&(i.resizing=t.resizing),i.expandParent&&gU(e,i);break;case"remove":return e}return e.push(i),e}),n)}function yU(t,e){return vU(t,e)}const _U=(t,e)=>({id:t,type:"select",selected:e});function bU(t,e){return t.reduce(((t,n)=>{const r=e.includes(n.id);return!n.selected&&r?(n.selected=!0,t.push(_U(n.id,!0))):n.selected&&!r&&(n.selected=!1,t.push(_U(n.id,!1))),t}),[])}const xU=(t,e)=>n=>{n.target===e.current&&t?.(n)},wU=t=>({userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable,dragging:t.paneDragging}),SU=(0,t.memo)((e=>{let{isSelecting:n,selectionMode:r=ND.Full,panOnDrag:i,onSelectionStart:s,onSelectionEnd:o,onPaneClick:a,onPaneContextMenu:l,onPaneScroll:c,onPaneMouseEnter:u,onPaneMouseMove:h,onPaneMouseLeave:d,children:p}=e;const f=(0,t.useRef)(null),m=rD(),g=(0,t.useRef)(0),v=(0,t.useRef)(0),y=(0,t.useRef)(),{userSelectionActive:_,elementsSelectable:b,dragging:x}=nD(wU,eL),w=()=>{m.setState({userSelectionActive:!1,userSelectionRect:null}),g.current=0,v.current=0},S=t=>{a?.(t),m.getState().resetSelectedElements(),m.setState({nodesSelectionActive:!1})},M=c?t=>c(t):void 0,E=b&&(n||_);return t.createElement("div",{className:qR(["react-flow__pane",{dragging:x,selection:n}]),onClick:E?void 0:xU(S,f),onContextMenu:xU((t=>{Array.isArray(i)&&i?.includes(2)?t.preventDefault():l?.(t)}),f),onWheel:xU(M,f),onMouseEnter:E?void 0:u,onMouseDown:E?t=>{const{resetSelectedElements:e,domNode:r}=m.getState();if(y.current=r?.getBoundingClientRect(),!b||!n||0!==t.button||t.target!==f.current||!y.current)return;const{x:i,y:o}=ED(t,y.current);e(),m.setState({userSelectionRect:{width:0,height:0,startX:i,startY:o,x:i,y:o}}),s?.(t)}:void 0,onMouseMove:E?t=>{const{userSelectionRect:e,nodeInternals:i,edges:s,transform:o,onNodesChange:a,onEdgesChange:l,nodeOrigin:c,getNodes:u}=m.getState();if(!n||!y.current||!e)return;m.setState({userSelectionActive:!0,nodesSelectionActive:!1});const h=ED(t,y.current),d=e.startX??0,p=e.startY??0,f={...e,x:h.x<d?h.x:d,y:h.y<p?h.y:p,width:Math.abs(h.x-d),height:Math.abs(h.y-p)},_=u(),b=oz(i,f,o,r===ND.Partial,!0,c),x=az(b,s).map((t=>t.id)),w=b.map((t=>t.id));if(g.current!==w.length){g.current=w.length;const t=bU(_,w);t.length&&a?.(t)}if(v.current!==x.length){v.current=x.length;const t=bU(s,x);t.length&&l?.(t)}m.setState({userSelectionRect:f})}:h,onMouseUp:E?t=>{if(0!==t.button)return;const{userSelectionRect:e}=m.getState();!_&&e&&t.target===f.current&&S?.(t),m.setState({nodesSelectionActive:g.current>0}),w(),o?.(t)}:void 0,onMouseLeave:E?t=>{_&&(m.setState({nodesSelectionActive:g.current>0}),o?.(t)),w()}:d,ref:f,style:aU},p,t.createElement(mU,null))}));function MU(t,e){const n=t.parentNode||t.parentId;if(!n)return!1;const r=e.get(n);return!!r&&(!!r.selected||MU(r,e))}function EU(t,e,n){let r=t;do{if(r?.matches(e))return!0;if(r===n.current)return!1;r=r.parentElement}while(r);return!1}function TU(t,e,n,r){return Array.from(t.values()).filter((n=>(n.selected||n.id===r)&&(!n.parentNode||n.parentId||!MU(n,t))&&(n.draggable||e&&"undefined"===typeof n.draggable))).map((t=>({id:t.id,position:t.position||{x:0,y:0},positionAbsolute:t.positionAbsolute||{x:0,y:0},distance:{x:n.x-(t.positionAbsolute?.x??0),y:n.y-(t.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:t.extent,parentNode:t.parentNode||t.parentId,parentId:t.parentNode||t.parentId,width:t.width,height:t.height,expandParent:t.expandParent})))}function AU(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],s=arguments.length>5?arguments[5]:void 0;const o=function(t,e){return e&&"parent"!==e?[e[0],[e[1][0]-(t.width||0),e[1][1]-(t.height||0)]]:e}(t,t.extent||r);let a=o;const l=t.parentNode||t.parentId;if("parent"!==t.extent||t.expandParent){if(t.extent&&l&&"parent"!==t.extent){const e=n.get(l),{x:r,y:s}=iz(e,i).positionAbsolute;a=[[t.extent[0][0]+r,t.extent[0][1]+s],[t.extent[1][0]+r,t.extent[1][1]+s]]}}else if(l&&t.width&&t.height){const e=n.get(l),{x:r,y:s}=iz(e,i).positionAbsolute;a=e&&_D(r)&&_D(s)&&_D(e.width)&&_D(e.height)?[[r+t.width*i[0],s+t.height*i[1]],[r+e.width-t.width+t.width*i[0],s+e.height-t.height+t.height*i[1]]]:a}else s?.("005",Xk()),a=o;let c={x:0,y:0};if(l){const t=n.get(l);c=iz(t,i).positionAbsolute}const u=a&&"parent"!==a?uD(e,a):e;return{position:{x:u.x-c.x,y:u.y-c.y},positionAbsolute:u}}function CU(t){let{nodeId:e,dragItems:n,nodeInternals:r}=t;const i=n.map((t=>({...r.get(t.id),position:t.position,positionAbsolute:t.positionAbsolute})));return[e?i.find((t=>t.id===e)):i[0],i]}SU.displayName="Pane";const PU=(t,e,n,r)=>{const i=e.querySelectorAll(t);if(!i||!i.length)return null;const s=Array.from(i),o=e.getBoundingClientRect(),a=o.width*r[0],l=o.height*r[1];return s.map((t=>{const e=t.getBoundingClientRect();return{id:t.getAttribute("data-handleid"),position:t.getAttribute("data-handlepos"),x:(e.left-o.left-a)/n,y:(e.top-o.top-l)/n,...lD(t)}}))};function IU(t,e,n){return void 0===n?n:r=>{const i=e().nodeInternals.get(t);i&&n(r,{...i})}}function RU(t){let{id:e,store:n,unselect:r=!1,nodeRef:i}=t;const{addSelectedNodes:s,unselectNodesAndEdges:o,multiSelectionActive:a,nodeInternals:l,onError:c}=n.getState(),u=l.get(e);u?(n.setState({nodesSelectionActive:!1}),u.selected?(r||u.selected&&a)&&(o({nodes:[u],edges:[]}),requestAnimationFrame((()=>i?.current?.blur()))):s([e])):c?.("012",tD(e))}function LU(t){return(e,n,r)=>t?.(e,r)}function NU(e){let{nodeRef:n,disabled:r=!1,noDragClassName:i,handleSelector:s,nodeId:o,isSelectable:a,selectNodesOnDrag:l}=e;const c=rD(),[u,h]=(0,t.useState)(!1),d=(0,t.useRef)([]),p=(0,t.useRef)({x:null,y:null}),f=(0,t.useRef)(0),m=(0,t.useRef)(null),g=(0,t.useRef)({x:0,y:0}),v=(0,t.useRef)(null),y=(0,t.useRef)(!1),_=(0,t.useRef)(!1),b=(0,t.useRef)(!1),x=function(){const e=rD(),n=(0,t.useCallback)((t=>{let{sourceEvent:n}=t;const{transform:r,snapGrid:i,snapToGrid:s}=e.getState(),o=n.touches?n.touches[0].clientX:n.clientX,a=n.touches?n.touches[0].clientY:n.clientY,l={x:(o-r[0])/r[2],y:(a-r[1])/r[2]};return{xSnapped:s?i[0]*Math.round(l.x/i[0]):l.x,ySnapped:s?i[1]*Math.round(l.y/i[1]):l.y,...l}}),[]);return n}();return(0,t.useEffect)((()=>{if(n?.current){const t=xN(n.current),e=t=>{let{x:e,y:n}=t;const{nodeInternals:r,onNodeDrag:i,onSelectionDrag:s,updateNodePositions:a,nodeExtent:l,snapGrid:u,snapToGrid:f,nodeOrigin:m,onError:g}=c.getState();p.current={x:e,y:n};let y=!1,_={x:0,y:0,x2:0,y2:0};if(d.current.length>1&&l){const t=sz(d.current,m);_=mD(t)}if(d.current=d.current.map((t=>{const i={x:e-t.distance.x,y:n-t.distance.y};f&&(i.x=u[0]*Math.round(i.x/u[0]),i.y=u[1]*Math.round(i.y/u[1]));const s=[[l[0][0],l[0][1]],[l[1][0],l[1][1]]];d.current.length>1&&l&&!t.extent&&(s[0][0]=t.positionAbsolute.x-_.x+l[0][0],s[1][0]=t.positionAbsolute.x+(t.width??0)-_.x2+l[1][0],s[0][1]=t.positionAbsolute.y-_.y+l[0][1],s[1][1]=t.positionAbsolute.y+(t.height??0)-_.y2+l[1][1]);const o=AU(t,i,r,s,m,g);return y=y||t.position.x!==o.position.x||t.position.y!==o.position.y,t.position=o.position,t.positionAbsolute=o.positionAbsolute,t})),!y)return;a(d.current,!0,!0),h(!0);const b=o?i:LU(s);if(b&&v.current){const[t,e]=CU({nodeId:o,dragItems:d.current,nodeInternals:r});b(v.current,t,e)}},u=()=>{if(!m.current)return;const[t,n]=dD(g.current,m.current);if(0!==t||0!==n){const{transform:r,panBy:i}=c.getState();p.current.x=(p.current.x??0)-t/r[2],p.current.y=(p.current.y??0)-n/r[2],i({x:t,y:n})&&e(p.current)}f.current=requestAnimationFrame(u)},w=t=>{const{nodeInternals:e,multiSelectionActive:r,nodesDraggable:i,unselectNodesAndEdges:s,onNodeDragStart:u,onSelectionDragStart:h}=c.getState();_.current=!0;const f=o?u:LU(h);l&&a||r||!o||e.get(o)?.selected||s(),o&&a&&l&&RU({id:o,store:c,nodeRef:n});const m=x(t);if(p.current=m,d.current=TU(e,i,m,o),f&&d.current){const[n,r]=CU({nodeId:o,dragItems:d.current,nodeInternals:e});f(t.sourceEvent,n,r)}};if(!r){const r=function(){var t,e,n,r,i=Uk,s=Fk,o=Bk,a=Vk,l={},c=aL("start","drag","end"),u=0,h=0;function d(t){t.on("mousedown.drag",p).filter(a).on("touchstart.drag",g).on("touchmove.drag",v,wN).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(o,a){if(!r&&i.call(this,o,a)){var l=_(this,s.call(this,o,a),o,a,"mouse");l&&(xN(o.view).on("mousemove.drag",f,SN).on("mouseup.drag",m,SN),TN(o.view),MN(o),n=!1,t=o.clientX,e=o.clientY,l("start",o))}}function f(r){if(EN(r),!n){var i=r.clientX-t,s=r.clientY-e;n=i*i+s*s>h}l.mouse("drag",r)}function m(t){xN(t.view).on("mousemove.drag mouseup.drag",null),AN(t.view,n),EN(t),l.mouse("end",t)}function g(t,e){if(i.call(this,t,e)){var n,r,o=t.changedTouches,a=s.call(this,t,e),l=o.length;for(n=0;n<l;++n)(r=_(this,a,t,e,o[n].identifier,o[n]))&&(MN(t),r("start",t,o[n]))}}function v(t){var e,n,r=t.changedTouches,i=r.length;for(e=0;e<i;++e)(n=l[r[e].identifier])&&(EN(t),n("drag",t,r[e]))}function y(t){var e,n,i=t.changedTouches,s=i.length;for(r&&clearTimeout(r),r=setTimeout((function(){r=null}),500),e=0;e<s;++e)(n=l[i[e].identifier])&&(MN(t),n("end",t,i[e]))}function _(t,e,n,r,i,s){var a,h,p,f=c.copy(),m=IN(s||n,e);if(null!=(p=o.call(t,new zk("beforestart",{sourceEvent:n,target:d,identifier:i,active:u,x:m[0],y:m[1],dx:0,dy:0,dispatch:f}),r)))return a=p.x-m[0]||0,h=p.y-m[1]||0,function n(s,o,c){var g,v=m;switch(s){case"start":l[i]=n,g=u++;break;case"end":delete l[i],--u;case"drag":m=IN(c||o,e),g=u}f.call(s,t,new zk(s,{sourceEvent:o,subject:p,target:d,identifier:i,active:g,x:m[0]+a,y:m[1]+h,dx:m[0]-v[0],dy:m[1]-v[1],dispatch:f}),r)}}return d.filter=function(t){return arguments.length?(i="function"===typeof t?t:Dk(!!t),d):i},d.container=function(t){return arguments.length?(s="function"===typeof t?t:Dk(t),d):s},d.subject=function(t){return arguments.length?(o="function"===typeof t?t:Dk(t),d):o},d.touchable=function(t){return arguments.length?(a="function"===typeof t?t:Dk(!!t),d):a},d.on=function(){var t=c.on.apply(c,arguments);return t===c?d:t},d.clickDistance=function(t){return arguments.length?(h=(t=+t)*t,d):Math.sqrt(h)},d}().on("start",(t=>{const{domNode:e,nodeDragThreshold:n}=c.getState();0===n&&w(t),b.current=!1;const r=x(t);p.current=r,m.current=e?.getBoundingClientRect()||null,g.current=ED(t.sourceEvent,m.current)})).on("drag",(t=>{const n=x(t),{autoPanOnNodeDrag:r,nodeDragThreshold:i}=c.getState();if("touchmove"===t.sourceEvent.type&&t.sourceEvent.touches.length>1&&(b.current=!0),!b.current){if(!y.current&&_.current&&r&&(y.current=!0,u()),!_.current){const e=n.xSnapped-(p?.current?.x??0),r=n.ySnapped-(p?.current?.y??0);Math.sqrt(e*e+r*r)>i&&w(t)}(p.current.x!==n.xSnapped||p.current.y!==n.ySnapped)&&d.current&&_.current&&(v.current=t.sourceEvent,g.current=ED(t.sourceEvent,m.current),e(n))}})).on("end",(t=>{if(_.current&&!b.current&&(h(!1),y.current=!1,_.current=!1,cancelAnimationFrame(f.current),d.current)){const{updateNodePositions:e,nodeInternals:n,onNodeDragStop:r,onSelectionDragStop:i}=c.getState(),s=o?r:LU(i);if(e(d.current,!1,!1),s){const[e,r]=CU({nodeId:o,dragItems:d.current,nodeInternals:n});s(t.sourceEvent,e,r)}}})).filter((t=>{const e=t.target;return!t.button&&(!i||!EU(e,`.${i}`,n))&&(!s||EU(e,s,n))}));return t.call(r),()=>{t.on(".drag",null)}}t.on(".drag",null)}}),[n,r,i,s,a,c,o,l,x]),u}function OU(){const e=rD(),n=(0,t.useCallback)((t=>{const{nodeInternals:n,nodeExtent:r,updateNodePositions:i,getNodes:s,snapToGrid:o,snapGrid:a,onError:l,nodesDraggable:c}=e.getState(),u=s().filter((t=>t.selected&&(t.draggable||c&&"undefined"===typeof t.draggable))),h=o?a[0]:5,d=o?a[1]:5,p=t.isShiftPressed?4:1,f=t.x*h*p,m=t.y*d*p,g=u.map((t=>{if(t.positionAbsolute){const e={x:t.positionAbsolute.x+f,y:t.positionAbsolute.y+m};o&&(e.x=a[0]*Math.round(e.x/a[0]),e.y=a[1]*Math.round(e.y/a[1]));const{positionAbsolute:i,position:s}=AU(t,e,n,r,void 0,l);t.position=s,t.positionAbsolute=i}return t}));i(g,!0,!1)}),[]);return n}const kU={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var DU=e=>{const n=n=>{let{id:r,type:i,data:s,xPos:o,yPos:a,xPosOrigin:l,yPosOrigin:c,selected:u,onClick:h,onMouseEnter:d,onMouseMove:p,onMouseLeave:f,onContextMenu:m,onDoubleClick:g,style:v,className:y,isDraggable:_,isSelectable:b,isConnectable:x,isFocusable:w,selectNodesOnDrag:S,sourcePosition:M,targetPosition:E,hidden:T,resizeObserver:A,dragHandle:C,zIndex:P,isParent:I,noDragClassName:R,noPanClassName:L,initialized:N,disableKeyboardA11y:O,ariaLabel:k,rfId:D,hasHandleBounds:z}=n;const U=rD(),F=(0,t.useRef)(null),B=(0,t.useRef)(null),V=(0,t.useRef)(M),H=(0,t.useRef)(E),j=(0,t.useRef)(i),W=b||_||h||d||p||f,G=OU(),q=IU(r,U.getState,d),$=IU(r,U.getState,p),X=IU(r,U.getState,f),J=IU(r,U.getState,m),Y=IU(r,U.getState,g);(0,t.useEffect)((()=>()=>{B.current&&(A?.unobserve(B.current),B.current=null)}),[]),(0,t.useEffect)((()=>{if(F.current&&!T){const t=F.current;N&&z&&B.current===t||(B.current&&A?.unobserve(B.current),A?.observe(t),B.current=t)}}),[T,N,z]),(0,t.useEffect)((()=>{const t=j.current!==i,e=V.current!==M,n=H.current!==E;F.current&&(t||e||n)&&(t&&(j.current=i),e&&(V.current=M),n&&(H.current=E),U.getState().updateNodeDimensions([{id:r,nodeElement:F.current,forceUpdate:!0}]))}),[r,i,M,E]);const Z=NU({nodeRef:F,disabled:T||!_,noDragClassName:R,handleSelector:C,nodeId:r,isSelectable:b,selectNodesOnDrag:S});return T?null:t.createElement("div",{className:qR(["react-flow__node",`react-flow__node-${i}`,{[L]:_},y,{selected:u,selectable:b,parent:I,dragging:Z}]),ref:F,style:{zIndex:P,transform:`translate(${l}px,${c}px)`,pointerEvents:W?"all":"none",visibility:N?"visible":"hidden",...v},"data-id":r,"data-testid":`rf__node-${r}`,onMouseEnter:q,onMouseMove:$,onMouseLeave:X,onContextMenu:J,onClick:t=>{const{nodeDragThreshold:e}=U.getState();if(b&&(!S||!_||e>0)&&RU({id:r,store:U,nodeRef:F}),h){const e=U.getState().nodeInternals.get(r);e&&h(t,{...e})}},onDoubleClick:Y,onKeyDown:w?t=>{if(!SD(t)&&!O)if(xD.includes(t.key)&&b){const e="Escape"===t.key;RU({id:r,store:U,unselect:e,nodeRef:F})}else _&&u&&Object.prototype.hasOwnProperty.call(kU,t.key)&&(U.setState({ariaLiveMessage:`Moved selected node ${t.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~o}, y: ${~~a}`}),G({x:kU[t.key].x,y:kU[t.key].y,isShiftPressed:t.shiftKey}))}:void 0,tabIndex:w?0:void 0,role:w?"button":void 0,"aria-describedby":O?void 0:`${Vz}-${D}`,"aria-label":k},t.createElement(KD,{value:r},t.createElement(e,{id:r,data:s,type:i,xPos:o,yPos:a,selected:u,isConnectable:x,sourcePosition:M,targetPosition:E,dragging:Z,dragHandle:C,zIndex:P})))};return n.displayName="NodeWrapper",(0,t.memo)(n)};const zU=t=>{const e=t.getNodes().filter((t=>t.selected));return{...sz(e,t.nodeOrigin),transformString:`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]})`,userSelectionActive:t.userSelectionActive}};var UU=(0,t.memo)((function(e){let{onSelectionContextMenu:n,noPanClassName:r,disableKeyboardA11y:i}=e;const s=rD(),{width:o,height:a,x:l,y:c,transformString:u,userSelectionActive:h}=nD(zU,eL),d=OU(),p=(0,t.useRef)(null);if((0,t.useEffect)((()=>{i||p.current?.focus({preventScroll:!0})}),[i]),NU({nodeRef:p}),h||!o||!a)return null;const f=n?t=>{const e=s.getState().getNodes().filter((t=>t.selected));n(t,e)}:void 0;return t.createElement("div",{className:qR(["react-flow__nodesselection","react-flow__container",r]),style:{transform:u}},t.createElement("div",{ref:p,className:"react-flow__nodesselection-rect",onContextMenu:f,tabIndex:i?void 0:-1,onKeyDown:i?void 0:t=>{Object.prototype.hasOwnProperty.call(kU,t.key)&&d({x:kU[t.key].x,y:kU[t.key].y,isShiftPressed:t.shiftKey})},style:{width:o,height:a,top:c,left:l}}))}));const FU=t=>t.nodesSelectionActive,BU=e=>{let{children:n,onPaneClick:r,onPaneMouseEnter:i,onPaneMouseMove:s,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:l,deleteKeyCode:c,onMove:u,onMoveStart:h,onMoveEnd:d,selectionKeyCode:p,selectionOnDrag:f,selectionMode:m,onSelectionStart:g,onSelectionEnd:v,multiSelectionKeyCode:y,panActivationKeyCode:_,zoomActivationKeyCode:b,elementsSelectable:x,zoomOnScroll:w,zoomOnPinch:S,panOnScroll:M,panOnScrollSpeed:E,panOnScrollMode:T,zoomOnDoubleClick:A,panOnDrag:C,defaultViewport:P,translateExtent:I,minZoom:R,maxZoom:L,preventScrolling:N,onSelectionContextMenu:O,noWheelClassName:k,noPanClassName:D,disableKeyboardA11y:z}=e;const U=nD(FU),F=qz(p),B=qz(_),V=B||C,H=B||M,j=F||f&&!0!==V;return(e=>{let{deleteKeyCode:n,multiSelectionKeyCode:r}=e;const i=rD(),{deleteElements:s}=sU(),o=qz(n,oU),a=qz(r);(0,t.useEffect)((()=>{if(o){const{edges:t,getNodes:e}=i.getState(),n=e().filter((t=>t.selected)),r=t.filter((t=>t.selected));s({nodes:n,edges:r}),i.setState({nodesSelectionActive:!1})}}),[o]),(0,t.useEffect)((()=>{i.setState({multiSelectionActive:a})}),[a])})({deleteKeyCode:c,multiSelectionKeyCode:y}),t.createElement(pU,{onMove:u,onMoveStart:h,onMoveEnd:d,onPaneContextMenu:a,elementsSelectable:x,zoomOnScroll:w,zoomOnPinch:S,panOnScroll:H,panOnScrollSpeed:E,panOnScrollMode:T,zoomOnDoubleClick:A,panOnDrag:!F&&V,defaultViewport:P,translateExtent:I,minZoom:R,maxZoom:L,zoomActivationKeyCode:b,preventScrolling:N,noWheelClassName:k,noPanClassName:D},t.createElement(SU,{onSelectionStart:g,onSelectionEnd:v,onPaneClick:r,onPaneMouseEnter:i,onPaneMouseMove:s,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:l,panOnDrag:V,isSelecting:!!j,selectionMode:m},n,U&&t.createElement(UU,{onSelectionContextMenu:O,noPanClassName:D,disableKeyboardA11y:z})))};BU.displayName="FlowRenderer";var VU=(0,t.memo)(BU);function HU(t){const e={input:DU(t.input||Ez),default:DU(t.default||Sz),output:DU(t.output||Az),group:DU(t.group||Cz)},n=Object.keys(t).filter((t=>!["input","default","output","group"].includes(t))).reduce(((e,n)=>(e[n]=DU(t[n]||Sz),e)),{});return{...e,...n}}const jU=t=>({nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,nodesFocusable:t.nodesFocusable,elementsSelectable:t.elementsSelectable,updateNodeDimensions:t.updateNodeDimensions,onError:t.onError}),WU=e=>{const{nodesDraggable:n,nodesConnectable:r,nodesFocusable:i,elementsSelectable:s,updateNodeDimensions:o,onError:a}=nD(jU,eL),l=(c=e.onlyRenderVisibleElements,nD((0,t.useCallback)((t=>c?oz(t.nodeInternals,{x:0,y:0,width:t.width,height:t.height},t.transform,!0):t.getNodes()),[c])));var c;const u=(0,t.useRef)(),h=(0,t.useMemo)((()=>{if("undefined"===typeof ResizeObserver)return null;const t=new ResizeObserver((t=>{const e=t.map((t=>({id:t.target.getAttribute("data-id"),nodeElement:t.target,forceUpdate:!0})));o(e)}));return u.current=t,t}),[]);return(0,t.useEffect)((()=>()=>{u?.current?.disconnect()}),[]),t.createElement("div",{className:"react-flow__nodes",style:aU},l.map((o=>{let l=o.type||"default";e.nodeTypes[l]||(a?.("003",qk(l)),l="default");const c=e.nodeTypes[l]||e.nodeTypes.default,u=!!(o.draggable||n&&"undefined"===typeof o.draggable),d=!!(o.selectable||s&&"undefined"===typeof o.selectable),p=!!(o.connectable||r&&"undefined"===typeof o.connectable),f=!!(o.focusable||i&&"undefined"===typeof o.focusable),m=e.nodeExtent?uD(o.positionAbsolute,e.nodeExtent):o.positionAbsolute,g=m?.x??0,v=m?.y??0,y=(t=>{let{x:e,y:n,width:r,height:i,origin:s}=t;return r&&i?s[0]<0||s[1]<0||s[0]>1||s[1]>1?{x:e,y:n}:{x:e-r*s[0],y:n-i*s[1]}:{x:e,y:n}})({x:g,y:v,width:o.width??0,height:o.height??0,origin:e.nodeOrigin});return t.createElement(c,{key:o.id,id:o.id,className:o.className,style:o.style,type:l,data:o.data,sourcePosition:o.sourcePosition||DD.Bottom,targetPosition:o.targetPosition||DD.Top,hidden:o.hidden,xPos:g,yPos:v,xPosOrigin:y.x,yPosOrigin:y.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!o.selected,isDraggable:u,isSelectable:d,isConnectable:p,isFocusable:f,resizeObserver:h,dragHandle:o.dragHandle,zIndex:o[bD]?.z??0,isParent:!!o[bD]?.isParent,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!o.width&&!!o.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:o.ariaLabel,hasHandleBounds:!!o[bD]?.handleBounds})})))};WU.displayName="NodeRenderer";var GU=(0,t.memo)(WU);const qU=(t,e,n)=>n===DD.Left?t-e:n===DD.Right?t+e:t,$U=(t,e,n)=>n===DD.Top?t-e:n===DD.Bottom?t+e:t,XU="react-flow__edgeupdater",JU=e=>{let{position:n,centerX:r,centerY:i,radius:s=10,onMouseDown:o,onMouseEnter:a,onMouseOut:l,type:c}=e;return t.createElement("circle",{onMouseDown:o,onMouseEnter:a,onMouseOut:l,className:qR([XU,`${XU}-${c}`]),cx:qU(r,s,n),cy:$U(i,s,n),r:s,stroke:"transparent",fill:"transparent"})},YU=()=>!0;var ZU=e=>{const n=n=>{let{id:r,className:i,type:s,data:o,onClick:a,onEdgeDoubleClick:l,selected:c,animated:u,label:h,labelStyle:d,labelShowBg:p,labelBgStyle:f,labelBgPadding:m,labelBgBorderRadius:g,style:v,source:y,target:_,sourceX:b,sourceY:x,targetX:w,targetY:S,sourcePosition:M,targetPosition:E,elementsSelectable:T,hidden:A,sourceHandleId:C,targetHandleId:P,onContextMenu:I,onMouseEnter:R,onMouseMove:L,onMouseLeave:N,reconnectRadius:O,onReconnect:k,onReconnectStart:D,onReconnectEnd:z,markerEnd:U,markerStart:F,rfId:B,ariaLabel:V,isFocusable:H,isReconnectable:j,pathOptions:W,interactionWidth:G,disableKeyboardA11y:q}=n;const $=(0,t.useRef)(null),[X,J]=(0,t.useState)(!1),[Y,Z]=(0,t.useState)(!1),K=rD(),Q=(0,t.useMemo)((()=>`url('#${tz(F,B)}')`),[F,B]),tt=(0,t.useMemo)((()=>`url('#${tz(U,B)}')`),[U,B]);if(A)return null;const et=CD(r,K.getState,l),nt=CD(r,K.getState,I),rt=CD(r,K.getState,R),it=CD(r,K.getState,L),st=CD(r,K.getState,N),ot=(t,e)=>{if(0!==t.button)return;const{edges:n,isValidConnection:i}=K.getState(),s=e?_:y,o=(e?P:C)||null,a=e?"target":"source",l=i||YU,c=e,u=n.find((t=>t.id===r));Z(!0),D?.(t,u,a);vz({event:t,handleId:o,nodeId:s,onConnect:t=>k?.(u,t),isTarget:c,getState:K.getState,setState:K.setState,isValidConnection:l,edgeUpdaterType:a,onReconnectEnd:t=>{Z(!1),z?.(t,u,a)}})},at=()=>J(!0),lt=()=>J(!1),ct=!T&&!a;return t.createElement("g",{className:qR(["react-flow__edge",`react-flow__edge-${s}`,i,{selected:c,animated:u,inactive:ct,updating:X}]),onClick:t=>{const{edges:e,addSelectedEdges:n,unselectNodesAndEdges:i,multiSelectionActive:s}=K.getState(),o=e.find((t=>t.id===r));o&&(T&&(K.setState({nodesSelectionActive:!1}),o.selected&&s?(i({nodes:[],edges:[o]}),$.current?.blur()):n([r])),a&&a(t,o))},onDoubleClick:et,onContextMenu:nt,onMouseEnter:rt,onMouseMove:it,onMouseLeave:st,onKeyDown:H?t=>{if(!q&&xD.includes(t.key)&&T){const{unselectNodesAndEdges:e,addSelectedEdges:n,edges:i}=K.getState();"Escape"===t.key?($.current?.blur(),e({edges:[i.find((t=>t.id===r))]})):n([r])}}:void 0,tabIndex:H?0:void 0,role:H?"button":"img","data-testid":`rf__edge-${r}`,"aria-label":null===V?void 0:V||`Edge from ${y} to ${_}`,"aria-describedby":H?`${Hz}-${B}`:void 0,ref:$},!Y&&t.createElement(e,{id:r,source:y,target:_,selected:c,animated:u,label:h,labelStyle:d,labelShowBg:p,labelBgStyle:f,labelBgPadding:m,labelBgBorderRadius:g,data:o,style:v,sourceX:b,sourceY:x,targetX:w,targetY:S,sourcePosition:M,targetPosition:E,sourceHandleId:C,targetHandleId:P,markerStart:Q,markerEnd:tt,pathOptions:W,interactionWidth:G}),j&&t.createElement(t.Fragment,null,("source"===j||!0===j)&&t.createElement(JU,{position:M,centerX:b,centerY:x,radius:O,onMouseDown:t=>ot(t,!0),onMouseEnter:at,onMouseOut:lt,type:"source"}),("target"===j||!0===j)&&t.createElement(JU,{position:E,centerX:w,centerY:S,radius:O,onMouseDown:t=>ot(t,!1),onMouseEnter:at,onMouseOut:lt,type:"target"})))};return n.displayName="EdgeWrapper",(0,t.memo)(n)};function KU(t){const e={default:ZU(t.default||YD),straight:ZU(t.bezier||qD),step:ZU(t.step||GD),smoothstep:ZU(t.step||WD),simplebezier:ZU(t.simplebezier||FD)},n=Object.keys(t).filter((t=>!["default","bezier"].includes(t))).reduce(((e,n)=>(e[n]=ZU(t[n]||YD),e)),{});return{...e,...n}}function QU(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=(n?.x||0)+e.x,i=(n?.y||0)+e.y,s=n?.width||e.width,o=n?.height||e.height;switch(t){case DD.Top:return{x:r+s/2,y:i};case DD.Right:return{x:r+s,y:i+o/2};case DD.Bottom:return{x:r+s/2,y:i+o};case DD.Left:return{x:r,y:i+o/2}}}function tF(t,e){return t?1!==t.length&&e?e&&t.find((t=>t.id===e))||null:t[0]:null}function eF(t){const e=t?.[bD]?.handleBounds||null,n=e&&t?.width&&t?.height&&"undefined"!==typeof t?.positionAbsolute?.x&&"undefined"!==typeof t?.positionAbsolute?.y;return[{x:t?.positionAbsolute?.x||0,y:t?.positionAbsolute?.y||0,width:t?.width||0,height:t?.height||0},e,!!n]}const nF=[{level:0,isMaxLevel:!0,edges:[]}];function rF(e,n,r){const i=nD((0,t.useCallback)((t=>e?t.edges.filter((e=>{const r=n.get(e.source),i=n.get(e.target);return r?.width&&r?.height&&i?.width&&i?.height&&function(t){let{sourcePos:e,targetPos:n,sourceWidth:r,sourceHeight:i,targetWidth:s,targetHeight:o,width:a,height:l,transform:c}=t;const u={x:Math.min(e.x,n.x),y:Math.min(e.y,n.y),x2:Math.max(e.x+r,n.x+s),y2:Math.max(e.y+i,n.y+o)};u.x===u.x2&&(u.x2+=1),u.y===u.y2&&(u.y2+=1);const h=mD({x:(0-c[0])/c[2],y:(0-c[1])/c[2],width:a/c[2],height:l/c[2]}),d=Math.max(0,Math.min(h.x2,u.x2)-Math.max(h.x,u.x)),p=Math.max(0,Math.min(h.y2,u.y2)-Math.max(h.y,u.y));return Math.ceil(d*p)>0}({sourcePos:r.positionAbsolute||{x:0,y:0},targetPos:i.positionAbsolute||{x:0,y:0},sourceWidth:r.width,sourceHeight:r.height,targetWidth:i.width,targetHeight:i.height,width:t.width,height:t.height,transform:t.transform})})):t.edges),[e,n]));return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=-1;const i=t.reduce(((t,i)=>{const s=_D(i.zIndex);let o=s?i.zIndex:0;if(n){const t=e.get(i.target),n=e.get(i.source),r=i.selected||t?.selected||n?.selected,a=Math.max(n?.[bD]?.z||0,t?.[bD]?.z||0,1e3);o=(s?i.zIndex:0)+(r?a:0)}return t[o]?t[o].push(i):t[o]=[i],r=o>r?o:r,t}),{}),s=Object.entries(i).map((t=>{let[e,n]=t;const i=+e;return{edges:n,level:i,isMaxLevel:i===r}}));return 0===s.length?nF:s}(i,n,r)}const iF={[kD.Arrow]:e=>{let{color:n="none",strokeWidth:r=1}=e;return t.createElement("polyline",{style:{stroke:n,strokeWidth:r},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"})},[kD.ArrowClosed]:e=>{let{color:n="none",strokeWidth:r=1}=e;return t.createElement("polyline",{style:{stroke:n,fill:n,strokeWidth:r},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})}};const sF=e=>{let{id:n,type:r,color:i,width:s=12.5,height:o=12.5,markerUnits:a="strokeWidth",strokeWidth:l,orient:c="auto-start-reverse"}=e;const u=function(e){const n=rD();return(0,t.useMemo)((()=>Object.prototype.hasOwnProperty.call(iF,e)?iF[e]:(n.getState().onError?.("009",Yk(e)),null)),[e])}(r);return u?t.createElement("marker",{className:"react-flow__arrowhead",id:n,markerWidth:`${s}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:a,orient:c,refX:"0",refY:"0"},t.createElement(u,{color:i,strokeWidth:l})):null},oF=e=>{let{defaultColor:n,rfId:r}=e;const i=nD((0,t.useCallback)((t=>{let{defaultColor:e,rfId:n}=t;return t=>{const r=[];return t.edges.reduce(((t,i)=>([i.markerStart,i.markerEnd].forEach((i=>{if(i&&"object"===typeof i){const s=tz(i,n);r.includes(s)||(t.push({id:s,color:i.color||e,...i}),r.push(s))}})),t)),[]).sort(((t,e)=>t.id.localeCompare(e.id)))}})({defaultColor:n,rfId:r}),[n,r]),((t,e)=>!(t.length!==e.length||t.some(((t,n)=>t.id!==e[n].id)))));return t.createElement("defs",null,i.map((e=>t.createElement(sF,{id:e.id,key:e.id,type:e.type,color:e.color,width:e.width,height:e.height,markerUnits:e.markerUnits,strokeWidth:e.strokeWidth,orient:e.orient}))))};oF.displayName="MarkerDefinitions";var aF=(0,t.memo)(oF);const lF=t=>({nodesConnectable:t.nodesConnectable,edgesFocusable:t.edgesFocusable,edgesUpdatable:t.edgesUpdatable,elementsSelectable:t.elementsSelectable,width:t.width,height:t.height,connectionMode:t.connectionMode,nodeInternals:t.nodeInternals,onError:t.onError}),cF=e=>{let{defaultMarkerColor:n,onlyRenderVisibleElements:r,elevateEdgesOnSelect:i,rfId:s,edgeTypes:o,noPanClassName:a,onEdgeContextMenu:l,onEdgeMouseEnter:c,onEdgeMouseMove:u,onEdgeMouseLeave:h,onEdgeClick:d,onEdgeDoubleClick:p,onReconnect:f,onReconnectStart:m,onReconnectEnd:g,reconnectRadius:v,children:y,disableKeyboardA11y:_}=e;const{edgesFocusable:b,edgesUpdatable:x,elementsSelectable:w,width:S,height:M,connectionMode:E,nodeInternals:T,onError:A}=nD(lF,eL),C=rF(r,T,i);return S?t.createElement(t.Fragment,null,C.map((e=>{let{level:r,edges:i,isMaxLevel:y}=e;return t.createElement("svg",{key:r,style:{zIndex:r},width:S,height:M,className:"react-flow__edges react-flow__container"},y&&t.createElement(aF,{defaultColor:n,rfId:s}),t.createElement("g",null,i.map((e=>{const[n,r,i]=eF(T.get(e.source)),[y,S,M]=eF(T.get(e.target));if(!i||!M)return null;let C=e.type||"default";o[C]||(A?.("011",Qk(C)),C="default");const P=o[C]||o.default,I=E===RD.Strict?S.target:(S.target??[]).concat(S.source??[]),R=tF(r.source,e.sourceHandle),L=tF(I,e.targetHandle),N=R?.position||DD.Bottom,O=L?.position||DD.Top,k=!!(e.focusable||b&&"undefined"===typeof e.focusable),D=e.reconnectable||e.updatable,z="undefined"!==typeof f&&(D||x&&"undefined"===typeof D);if(!R||!L)return A?.("008",Zk(R,e)),null;const{sourceX:U,sourceY:F,targetX:B,targetY:V}=((t,e,n,r,i,s)=>{const o=QU(n,t,e),a=QU(s,r,i);return{sourceX:o.x,sourceY:o.y,targetX:a.x,targetY:a.y}})(n,R,N,y,L,O);return t.createElement(P,{key:e.id,id:e.id,className:qR([e.className,a]),type:C,data:e.data,selected:!!e.selected,animated:!!e.animated,hidden:!!e.hidden,label:e.label,labelStyle:e.labelStyle,labelShowBg:e.labelShowBg,labelBgStyle:e.labelBgStyle,labelBgPadding:e.labelBgPadding,labelBgBorderRadius:e.labelBgBorderRadius,style:e.style,source:e.source,target:e.target,sourceHandleId:e.sourceHandle,targetHandleId:e.targetHandle,markerEnd:e.markerEnd,markerStart:e.markerStart,sourceX:U,sourceY:F,targetX:B,targetY:V,sourcePosition:N,targetPosition:O,elementsSelectable:w,onContextMenu:l,onMouseEnter:c,onMouseMove:u,onMouseLeave:h,onClick:d,onEdgeDoubleClick:p,onReconnect:f,onReconnectStart:m,onReconnectEnd:g,reconnectRadius:v,rfId:s,ariaLabel:e.ariaLabel,isFocusable:k,isReconnectable:z,pathOptions:"pathOptions"in e?e.pathOptions:void 0,interactionWidth:e.interactionWidth,disableKeyboardA11y:_})}))))})),y):null};cF.displayName="EdgeRenderer";var uF=(0,t.memo)(cF);const hF=t=>`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]})`;function dF(e){let{children:n}=e;const r=nD(hF);return t.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:r}},n)}const pF={[DD.Left]:DD.Right,[DD.Right]:DD.Left,[DD.Top]:DD.Bottom,[DD.Bottom]:DD.Top},fF=e=>{let{nodeId:n,handleType:r,style:i,type:s=OD.Bezier,CustomComponent:o,connectionStatus:a}=e;const{fromNode:l,handleId:c,toX:u,toY:h,connectionMode:d}=nD((0,t.useCallback)((t=>({fromNode:t.nodeInternals.get(n),handleId:t.connectionHandleId,toX:(t.connectionPosition.x-t.transform[0])/t.transform[2],toY:(t.connectionPosition.y-t.transform[1])/t.transform[2],connectionMode:t.connectionMode})),[n]),eL),p=l?.[bD]?.handleBounds;let f=p?.[r];if(d===RD.Loose&&(f=f||p?.["source"===r?"target":"source"]),!l||!f)return null;const m=c?f.find((t=>t.id===c)):f[0],g=m?m.x+m.width/2:(l.width??0)/2,v=m?m.y+m.height/2:l.height??0,y=(l.positionAbsolute?.x??0)+g,_=(l.positionAbsolute?.y??0)+v,b=m?.position,x=b?pF[b]:null;if(!b||!x)return null;if(o)return t.createElement(o,{connectionLineType:s,connectionLineStyle:i,fromNode:l,fromHandle:m,fromX:y,fromY:_,toX:u,toY:h,fromPosition:b,toPosition:x,connectionStatus:a});let w="";const S={sourceX:y,sourceY:_,sourcePosition:b,targetX:u,targetY:h,targetPosition:x};return s===OD.Bezier?[w]=JD(S):s===OD.Step?[w]=jD({...S,borderRadius:0}):s===OD.SmoothStep?[w]=jD(S):s===OD.SimpleBezier?[w]=UD(S):w=`M${y},${_} ${u},${h}`,t.createElement("path",{d:w,fill:"none",className:"react-flow__connection-path",style:i})};fF.displayName="ConnectionLine";const mF=t=>({nodeId:t.connectionNodeId,handleType:t.connectionHandleType,nodesConnectable:t.nodesConnectable,connectionStatus:t.connectionStatus,width:t.width,height:t.height});function gF(e){let{containerStyle:n,style:r,type:i,component:s}=e;const{nodeId:o,handleType:a,nodesConnectable:l,width:c,height:u,connectionStatus:h}=nD(mF,eL);return!!(o&&a&&c&&l)?t.createElement("svg",{style:n,width:c,height:u,className:"react-flow__edges react-flow__connectionline react-flow__container"},t.createElement("g",{className:qR(["react-flow__connection",h])},t.createElement(fF,{nodeId:o,handleType:a,style:r,type:i,CustomComponent:s,connectionStatus:h}))):null}function vF(e,n){(0,t.useRef)(null),rD();return(0,t.useMemo)((()=>n(e)),[e])}const yF=e=>{let{nodeTypes:n,edgeTypes:r,onMove:i,onMoveStart:s,onMoveEnd:o,onInit:a,onNodeClick:l,onEdgeClick:c,onNodeDoubleClick:u,onEdgeDoubleClick:h,onNodeMouseEnter:d,onNodeMouseMove:p,onNodeMouseLeave:f,onNodeContextMenu:m,onSelectionContextMenu:g,onSelectionStart:v,onSelectionEnd:y,connectionLineType:_,connectionLineStyle:b,connectionLineComponent:x,connectionLineContainerStyle:w,selectionKeyCode:S,selectionOnDrag:M,selectionMode:E,multiSelectionKeyCode:T,panActivationKeyCode:A,zoomActivationKeyCode:C,deleteKeyCode:P,onlyRenderVisibleElements:I,elementsSelectable:R,selectNodesOnDrag:L,defaultViewport:N,translateExtent:O,minZoom:k,maxZoom:D,preventScrolling:z,defaultMarkerColor:U,zoomOnScroll:F,zoomOnPinch:B,panOnScroll:V,panOnScrollSpeed:H,panOnScrollMode:j,zoomOnDoubleClick:W,panOnDrag:G,onPaneClick:q,onPaneMouseEnter:$,onPaneMouseMove:X,onPaneMouseLeave:J,onPaneScroll:Y,onPaneContextMenu:Z,onEdgeContextMenu:K,onEdgeMouseEnter:Q,onEdgeMouseMove:tt,onEdgeMouseLeave:et,onReconnect:nt,onReconnectStart:rt,onReconnectEnd:it,reconnectRadius:st,noDragClassName:ot,noWheelClassName:at,noPanClassName:lt,elevateEdgesOnSelect:ct,disableKeyboardA11y:ut,nodeOrigin:ht,nodeExtent:dt,rfId:pt}=e;const ft=vF(n,HU),mt=vF(r,KU);return function(e){const n=sU(),r=(0,t.useRef)(!1);(0,t.useEffect)((()=>{!r.current&&n.viewportInitialized&&e&&(setTimeout((()=>e(n)),1),r.current=!0)}),[e,n.viewportInitialized])}(a),t.createElement(VU,{onPaneClick:q,onPaneMouseEnter:$,onPaneMouseMove:X,onPaneMouseLeave:J,onPaneContextMenu:Z,onPaneScroll:Y,deleteKeyCode:P,selectionKeyCode:S,selectionOnDrag:M,selectionMode:E,onSelectionStart:v,onSelectionEnd:y,multiSelectionKeyCode:T,panActivationKeyCode:A,zoomActivationKeyCode:C,elementsSelectable:R,onMove:i,onMoveStart:s,onMoveEnd:o,zoomOnScroll:F,zoomOnPinch:B,zoomOnDoubleClick:W,panOnScroll:V,panOnScrollSpeed:H,panOnScrollMode:j,panOnDrag:G,defaultViewport:N,translateExtent:O,minZoom:k,maxZoom:D,onSelectionContextMenu:g,preventScrolling:z,noDragClassName:ot,noWheelClassName:at,noPanClassName:lt,disableKeyboardA11y:ut},t.createElement(dF,null,t.createElement(uF,{edgeTypes:mt,onEdgeClick:c,onEdgeDoubleClick:h,onlyRenderVisibleElements:I,onEdgeContextMenu:K,onEdgeMouseEnter:Q,onEdgeMouseMove:tt,onEdgeMouseLeave:et,onReconnect:nt,onReconnectStart:rt,onReconnectEnd:it,reconnectRadius:st,defaultMarkerColor:U,noPanClassName:lt,elevateEdgesOnSelect:!!ct,disableKeyboardA11y:ut,rfId:pt},t.createElement(gF,{style:b,type:_,component:x,containerStyle:w})),t.createElement("div",{className:"react-flow__edgelabel-renderer"}),t.createElement(GU,{nodeTypes:ft,onNodeClick:l,onNodeDoubleClick:u,onNodeMouseEnter:d,onNodeMouseMove:p,onNodeMouseLeave:f,onNodeContextMenu:m,selectNodesOnDrag:L,onlyRenderVisibleElements:I,noPanClassName:lt,noDragClassName:ot,disableKeyboardA11y:ut,nodeOrigin:ht,nodeExtent:dt,rfId:pt})))};yF.displayName="GraphView";var _F=(0,t.memo)(yF);const bF=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],xF={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:bF,nodeExtent:bF,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:RD.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:wD,isValidConnection:void 0},wF=()=>{return t=(t,e)=>({...xF,setNodes:n=>{const{nodeInternals:r,nodeOrigin:i,elevateNodesOnSelect:s}=e();t({nodeInternals:Zz(n,r,i,s)})},getNodes:()=>Array.from(e().nodeInternals.values()),setEdges:n=>{const{defaultEdgeOptions:r={}}=e();t({edges:n.map((t=>({...r,...t})))})},setDefaultNodesAndEdges:(n,r)=>{const i="undefined"!==typeof n,s="undefined"!==typeof r,o=i?Zz(n,new Map,e().nodeOrigin,e().elevateNodesOnSelect):new Map;t({nodeInternals:o,edges:s?r:[],hasDefaultNodes:i,hasDefaultEdges:s})},updateNodeDimensions:n=>{const{onNodesChange:r,nodeInternals:i,fitViewOnInit:s,fitViewOnInitDone:o,fitViewOnInitOptions:a,domNode:l,nodeOrigin:c}=e(),u=l?.querySelector(".react-flow__viewport");if(!u)return;const h=window.getComputedStyle(u),{m22:d}=new window.DOMMatrixReadOnly(h.transform),p=n.reduce(((t,e)=>{const n=i.get(e.id);if(n?.hidden)i.set(n.id,{...n,[bD]:{...n[bD],handleBounds:void 0}});else if(n){const r=lD(e.nodeElement);r.width&&r.height&&(n.width!==r.width||n.height!==r.height||e.forceUpdate)&&(i.set(n.id,{...n,[bD]:{...n[bD],handleBounds:{source:PU(".source",e.nodeElement,d,c),target:PU(".target",e.nodeElement,d,c)}},...r}),t.push({id:n.id,type:"dimensions",dimensions:r}))}return t}),[]);Yz(i,c);const f=o||s&&!o&&Kz(e,{initial:!0,...a});t({nodeInternals:new Map(i),fitViewOnInitDone:f}),p?.length>0&&r?.(p)},updateNodePositions:function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{triggerNodeChanges:i}=e(),s=t.map((t=>{const e={id:t.id,type:"position",dragging:r};return n&&(e.positionAbsolute=t.positionAbsolute,e.position=t.position),e}));i(s)},triggerNodeChanges:n=>{const{onNodesChange:r,nodeInternals:i,hasDefaultNodes:s,nodeOrigin:o,getNodes:a,elevateNodesOnSelect:l}=e();if(n?.length){if(s){const e=Zz(yU(n,a()),i,o,l);t({nodeInternals:e})}r?.(n)}},addSelectedNodes:n=>{const{multiSelectionActive:r,edges:i,getNodes:s}=e();let o,a=null;r?o=n.map((t=>_U(t,!0))):(o=bU(s(),n),a=bU(i,[])),eU({changedNodes:o,changedEdges:a,get:e,set:t})},addSelectedEdges:n=>{const{multiSelectionActive:r,edges:i,getNodes:s}=e();let o,a=null;r?o=n.map((t=>_U(t,!0))):(o=bU(i,n),a=bU(s(),[])),eU({changedNodes:a,changedEdges:o,get:e,set:t})},unselectNodesAndEdges:function(){let{nodes:n,edges:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{edges:i,getNodes:s}=e(),o=r||i,a=(n||s()).map((t=>(t.selected=!1,_U(t.id,!1))));eU({changedNodes:a,changedEdges:o.map((t=>_U(t.id,!1))),get:e,set:t})},setMinZoom:n=>{const{d3Zoom:r,maxZoom:i}=e();r?.scaleExtent([n,i]),t({minZoom:n})},setMaxZoom:n=>{const{d3Zoom:r,minZoom:i}=e();r?.scaleExtent([i,n]),t({maxZoom:n})},setTranslateExtent:n=>{e().d3Zoom?.translateExtent(n),t({translateExtent:n})},resetSelectedElements:()=>{const{edges:n,getNodes:r}=e(),i=r().filter((t=>t.selected)).map((t=>_U(t.id,!1))),s=n.filter((t=>t.selected)).map((t=>_U(t.id,!1)));eU({changedNodes:i,changedEdges:s,get:e,set:t})},setNodeExtent:n=>{const{nodeInternals:r}=e();r.forEach((t=>{t.positionAbsolute=uD(t.position,n)})),t({nodeExtent:n,nodeInternals:new Map(r)})},panBy:t=>{const{transform:n,width:r,height:i,d3Zoom:s,d3Selection:o,translateExtent:a}=e();if(!s||!o||!t.x&&!t.y)return!1;const l=Ak.translate(n[0]+t.x,n[1]+t.y).scale(n[2]),c=[[0,0],[r,i]],u=s?.constrain()(l,c,a);return s.transform(o,u),n[0]!==u.x||n[1]!==u.y||n[2]!==u.k},cancelConnection:()=>t({connectionNodeId:xF.connectionNodeId,connectionHandleId:xF.connectionHandleId,connectionHandleType:xF.connectionHandleType,connectionStatus:xF.connectionStatus,connectionStartHandle:xF.connectionStartHandle,connectionEndHandle:xF.connectionEndHandle}),reset:()=>t({...xF})}),e=Object.is,t?tL(t,e):tL;var t,e},SF=e=>{let{children:n}=e;const r=(0,t.useRef)(null);return r.current||(r.current=wF()),t.createElement(Gk,{value:r.current},n)};SF.displayName="ReactFlowProvider";const MF=e=>{let{children:n}=e;return(0,t.useContext)(Wk)?t.createElement(t.Fragment,null,n):t.createElement(SF,null,n)};MF.displayName="ReactFlowWrapper";const EF={input:Ez,default:Sz,output:Az,group:Cz},TF={default:YD,straight:qD,step:GD,smoothstep:WD,simplebezier:FD},AF=[0,0],CF=[15,15],PF={x:0,y:0,zoom:1},IF={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},RF=(0,t.forwardRef)(((e,n)=>{let{nodes:r,edges:i,defaultNodes:s,defaultEdges:o,className:a,nodeTypes:l=EF,edgeTypes:c=TF,onNodeClick:u,onEdgeClick:h,onInit:d,onMove:p,onMoveStart:f,onMoveEnd:m,onConnect:g,onConnectStart:v,onConnectEnd:y,onClickConnectStart:_,onClickConnectEnd:b,onNodeMouseEnter:x,onNodeMouseMove:w,onNodeMouseLeave:S,onNodeContextMenu:M,onNodeDoubleClick:E,onNodeDragStart:T,onNodeDrag:A,onNodeDragStop:C,onNodesDelete:P,onEdgesDelete:I,onSelectionChange:R,onSelectionDragStart:L,onSelectionDrag:N,onSelectionDragStop:O,onSelectionContextMenu:k,onSelectionStart:D,onSelectionEnd:z,connectionMode:U=RD.Strict,connectionLineType:F=OD.Bezier,connectionLineStyle:B,connectionLineComponent:V,connectionLineContainerStyle:H,deleteKeyCode:j="Backspace",selectionKeyCode:W="Shift",selectionOnDrag:G=!1,selectionMode:q=ND.Full,panActivationKeyCode:$="Space",multiSelectionKeyCode:X=(TD()?"Meta":"Control"),zoomActivationKeyCode:J=(TD()?"Meta":"Control"),snapToGrid:Y=!1,snapGrid:Z=CF,onlyRenderVisibleElements:K=!1,selectNodesOnDrag:Q=!0,nodesDraggable:tt,nodesConnectable:et,nodesFocusable:nt,nodeOrigin:rt=AF,edgesFocusable:it,edgesUpdatable:st,elementsSelectable:ot,defaultViewport:at=PF,minZoom:lt=.5,maxZoom:ct=2,translateExtent:ut=bF,preventScrolling:ht=!0,nodeExtent:dt,defaultMarkerColor:pt="#b1b1b7",zoomOnScroll:ft=!0,zoomOnPinch:mt=!0,panOnScroll:gt=!1,panOnScrollSpeed:vt=.5,panOnScrollMode:yt=LD.Free,zoomOnDoubleClick:_t=!0,panOnDrag:bt=!0,onPaneClick:xt,onPaneMouseEnter:wt,onPaneMouseMove:St,onPaneMouseLeave:Mt,onPaneScroll:Et,onPaneContextMenu:Tt,children:At,onEdgeContextMenu:Ct,onEdgeDoubleClick:Pt,onEdgeMouseEnter:It,onEdgeMouseMove:Rt,onEdgeMouseLeave:Lt,onEdgeUpdate:Nt,onEdgeUpdateStart:Ot,onEdgeUpdateEnd:kt,onReconnect:Dt,onReconnectStart:zt,onReconnectEnd:Ut,reconnectRadius:Ft=10,edgeUpdaterRadius:Bt=10,onNodesChange:Vt,onEdgesChange:Ht,noDragClassName:jt="nodrag",noWheelClassName:Wt="nowheel",noPanClassName:Gt="nopan",fitView:qt=!1,fitViewOptions:$t,connectOnClick:Xt=!0,attributionPosition:Jt,proOptions:Yt,defaultEdgeOptions:Zt,elevateNodesOnSelect:Kt=!0,elevateEdgesOnSelect:Qt=!1,disableKeyboardA11y:te=!1,autoPanOnConnect:ee=!0,autoPanOnNodeDrag:ne=!0,connectionRadius:re=20,isValidConnection:ie,onError:se,style:oe,id:ae,nodeDragThreshold:le,...ce}=e;const ue=ae||"1";return t.createElement("div",{...ce,style:{...oe,...IF},ref:n,className:qR(["react-flow",a]),"data-testid":"rf__wrapper",id:ae},t.createElement(MF,null,t.createElement(_F,{onInit:d,onMove:p,onMoveStart:f,onMoveEnd:m,onNodeClick:u,onEdgeClick:h,onNodeMouseEnter:x,onNodeMouseMove:w,onNodeMouseLeave:S,onNodeContextMenu:M,onNodeDoubleClick:E,nodeTypes:l,edgeTypes:c,connectionLineType:F,connectionLineStyle:B,connectionLineComponent:V,connectionLineContainerStyle:H,selectionKeyCode:W,selectionOnDrag:G,selectionMode:q,deleteKeyCode:j,multiSelectionKeyCode:X,panActivationKeyCode:$,zoomActivationKeyCode:J,onlyRenderVisibleElements:K,selectNodesOnDrag:Q,defaultViewport:at,translateExtent:ut,minZoom:lt,maxZoom:ct,preventScrolling:ht,zoomOnScroll:ft,zoomOnPinch:mt,zoomOnDoubleClick:_t,panOnScroll:gt,panOnScrollSpeed:vt,panOnScrollMode:yt,panOnDrag:bt,onPaneClick:xt,onPaneMouseEnter:wt,onPaneMouseMove:St,onPaneMouseLeave:Mt,onPaneScroll:Et,onPaneContextMenu:Tt,onSelectionContextMenu:k,onSelectionStart:D,onSelectionEnd:z,onEdgeContextMenu:Ct,onEdgeDoubleClick:Pt,onEdgeMouseEnter:It,onEdgeMouseMove:Rt,onEdgeMouseLeave:Lt,onReconnect:Dt??Nt,onReconnectStart:zt??Ot,onReconnectEnd:Ut??kt,reconnectRadius:Ft??Bt,defaultMarkerColor:pt,noDragClassName:jt,noWheelClassName:Wt,noPanClassName:Gt,elevateEdgesOnSelect:Qt,rfId:ue,disableKeyboardA11y:te,nodeOrigin:rt,nodeExtent:dt}),t.createElement(Uz,{nodes:r,edges:i,defaultNodes:s,defaultEdges:o,onConnect:g,onConnectStart:v,onConnectEnd:y,onClickConnectStart:_,onClickConnectEnd:b,nodesDraggable:tt,nodesConnectable:et,nodesFocusable:nt,edgesFocusable:it,edgesUpdatable:st,elementsSelectable:ot,elevateNodesOnSelect:Kt,minZoom:lt,maxZoom:ct,nodeExtent:dt,onNodesChange:Vt,onEdgesChange:Ht,snapToGrid:Y,snapGrid:Z,connectionMode:U,translateExtent:ut,connectOnClick:Xt,defaultEdgeOptions:Zt,fitView:qt,fitViewOptions:$t,onNodesDelete:P,onEdgesDelete:I,onNodeDragStart:T,onNodeDrag:A,onNodeDragStop:C,onSelectionDrag:N,onSelectionDragStart:L,onSelectionDragStop:O,noPanClassName:Gt,nodeOrigin:rt,rfId:ue,autoPanOnConnect:ee,autoPanOnNodeDrag:ne,onError:se,connectionRadius:re,isValidConnection:ie,nodeDragThreshold:le}),t.createElement(Oz,{onSelectionChange:R}),At,t.createElement(oD,{proOptions:Yt,position:Jt}),t.createElement(Gz,{rfId:ue,disableKeyboardA11y:te})))}));RF.displayName="ReactFlow";const LF=t=>({x:t.transform[0],y:t.transform[1],zoom:t.transform[2]});function NF(e){return n=>{const[r,i]=(0,t.useState)(n),s=(0,t.useCallback)((t=>i((n=>e(t,n)))),[]);return[r,i,s]}}const OF=NF(yU),kF=NF((function(t,e){return vU(t,e)}));var DF;function zF(e){let{color:n,dimensions:r,lineWidth:i}=e;return t.createElement("path",{stroke:n,strokeWidth:i,d:`M${r[0]/2} 0 V${r[1]} M0 ${r[1]/2} H${r[0]}`})}function UF(e){let{color:n,radius:r}=e;return t.createElement("circle",{cx:r,cy:r,r:r,fill:n})}!function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"}(DF||(DF={}));const FF={[DF.Dots]:"#91919a",[DF.Lines]:"#eee",[DF.Cross]:"#e2e2e2"},BF={[DF.Dots]:1,[DF.Lines]:1,[DF.Cross]:6},VF=t=>({transform:t.transform,patternId:`pattern-${t.rfId}`});function HF(e){let{id:n,variant:r=DF.Dots,gap:i=20,size:s,lineWidth:o=1,offset:a=2,color:l,style:c,className:u}=e;const h=(0,t.useRef)(null),{transform:d,patternId:p}=nD(VF,eL),f=l||FF[r],m=s||BF[r],g=r===DF.Dots,v=r===DF.Cross,y=Array.isArray(i)?i:[i,i],_=[y[0]*d[2]||1,y[1]*d[2]||1],b=m*d[2],x=v?[b,b]:_,w=g?[b/a,b/a]:[x[0]/a,x[1]/a];return t.createElement("svg",{className:qR(["react-flow__background",u]),style:{...c,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:h,"data-testid":"rf__background"},t.createElement("pattern",{id:p+n,x:d[0]%_[0],y:d[1]%_[1],width:_[0],height:_[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${w[0]},-${w[1]})`},g?t.createElement(UF,{color:f,radius:b/a}):t.createElement(zF,{dimensions:x,color:f,lineWidth:o})),t.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${p+n})`}))}HF.displayName="Background";var jF=(0,t.memo)(HF);function WF(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},t.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function GF(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},t.createElement("path",{d:"M0 0h32v4.2H0z"}))}function qF(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},t.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function $F(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},t.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function XF(){return t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},t.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const JF=e=>{let{children:n,className:r,...i}=e;return t.createElement("button",{type:"button",className:qR(["react-flow__controls-button",r]),...i},n)};JF.displayName="ControlButton";const YF=t=>({isInteractive:t.nodesDraggable||t.nodesConnectable||t.elementsSelectable,minZoomReached:t.transform[2]<=t.minZoom,maxZoomReached:t.transform[2]>=t.maxZoom}),ZF=e=>{let{style:n,showZoom:r=!0,showFitView:i=!0,showInteractive:s=!0,fitViewOptions:o,onZoomIn:a,onZoomOut:l,onFitView:c,onInteractiveChange:u,className:h,children:d,position:p="bottom-left"}=e;const f=rD(),[m,g]=(0,t.useState)(!1),{isInteractive:v,minZoomReached:y,maxZoomReached:_}=nD(YF,eL),{zoomIn:b,zoomOut:x,fitView:w}=sU();if((0,t.useEffect)((()=>{g(!0)}),[]),!m)return null;return t.createElement(sD,{className:qR(["react-flow__controls",h]),position:p,style:n,"data-testid":"rf__controls"},r&&t.createElement(t.Fragment,null,t.createElement(JF,{onClick:()=>{b(),a?.()},className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:_},t.createElement(WF,null)),t.createElement(JF,{onClick:()=>{x(),l?.()},className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:y},t.createElement(GF,null))),i&&t.createElement(JF,{className:"react-flow__controls-fitview",onClick:()=>{w(o),c?.()},title:"fit view","aria-label":"fit view"},t.createElement(qF,null)),s&&t.createElement(JF,{className:"react-flow__controls-interactive",onClick:()=>{f.setState({nodesDraggable:!v,nodesConnectable:!v,elementsSelectable:!v}),u?.(!v)},title:"toggle interactivity","aria-label":"toggle interactivity"},v?t.createElement(XF,null):t.createElement($F,null)),d)};ZF.displayName="Controls";var KF=(0,t.memo)(ZF);const QF={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var tB,eB=new Uint8Array(16);function nB(){if(!tB&&!(tB="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return tB(eB)}for(var rB=[],iB=0;iB<256;++iB)rB.push((iB+256).toString(16).slice(1));function sB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(rB[t[e+0]]+rB[t[e+1]]+rB[t[e+2]]+rB[t[e+3]]+"-"+rB[t[e+4]]+rB[t[e+5]]+"-"+rB[t[e+6]]+rB[t[e+7]]+"-"+rB[t[e+8]]+rB[t[e+9]]+"-"+rB[t[e+10]]+rB[t[e+11]]+rB[t[e+12]]+rB[t[e+13]]+rB[t[e+14]]+rB[t[e+15]]).toLowerCase()}const oB=function(t,e,n){if(QF.randomUUID&&!e&&!t)return QF.randomUUID();var r=(t=t||{}).random||(t.rng||nB)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(var i=0;i<16;++i)e[n+i]=r[i];return e}return sB(r)};class aB extends Error{response;request;constructor(t,e){super(`${aB.extractMessage(t)}: ${JSON.stringify({response:t,request:e})}`),Object.setPrototypeOf(this,aB.prototype),this.response=t,this.request=e,"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,aB)}static extractMessage(t){return t.errors?.[0]?.message??`GraphQL Error (Code: ${String(t.status)})`}}const lB=t=>t.toUpperCase(),cB=t=>"function"===typeof t?t():t,uB=(t,e)=>t.map(((t,n)=>[t,e[n]])),hB=t=>{let e={};return t instanceof Headers?e=dB(t):Array.isArray(t)?t.forEach((t=>{let[n,r]=t;n&&void 0!==r&&(e[n]=r)})):t&&(e=t),e},dB=t=>{const e={};return t.forEach(((t,n)=>{e[n]=t})),e},pB=t=>t instanceof Error?t:new Error(String(t)),fB=t=>"object"===typeof t&&null!==t&&"then"in t&&"function"===typeof t.then&&"catch"in t&&"function"===typeof t.catch&&"finally"in t&&"function"===typeof t.finally,mB=t=>{throw new Error(`Unhandled case: ${String(t)}`)},gB=t=>"object"===typeof t&&null!==t&&!Array.isArray(t);var vB;!function(t){t.NAME="Name",t.DOCUMENT="Document",t.OPERATION_DEFINITION="OperationDefinition",t.VARIABLE_DEFINITION="VariableDefinition",t.SELECTION_SET="SelectionSet",t.FIELD="Field",t.ARGUMENT="Argument",t.FRAGMENT_SPREAD="FragmentSpread",t.INLINE_FRAGMENT="InlineFragment",t.FRAGMENT_DEFINITION="FragmentDefinition",t.VARIABLE="Variable",t.INT="IntValue",t.FLOAT="FloatValue",t.STRING="StringValue",t.BOOLEAN="BooleanValue",t.NULL="NullValue",t.ENUM="EnumValue",t.LIST="ListValue",t.OBJECT="ObjectValue",t.OBJECT_FIELD="ObjectField",t.DIRECTIVE="Directive",t.NAMED_TYPE="NamedType",t.LIST_TYPE="ListType",t.NON_NULL_TYPE="NonNullType",t.SCHEMA_DEFINITION="SchemaDefinition",t.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",t.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",t.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",t.FIELD_DEFINITION="FieldDefinition",t.INPUT_VALUE_DEFINITION="InputValueDefinition",t.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",t.UNION_TYPE_DEFINITION="UnionTypeDefinition",t.ENUM_TYPE_DEFINITION="EnumTypeDefinition",t.ENUM_VALUE_DEFINITION="EnumValueDefinition",t.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",t.DIRECTIVE_DEFINITION="DirectiveDefinition",t.SCHEMA_EXTENSION="SchemaExtension",t.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",t.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",t.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",t.UNION_TYPE_EXTENSION="UnionTypeExtension",t.ENUM_TYPE_EXTENSION="EnumTypeExtension",t.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"}(vB||(vB={}));const yB="Accept",_B="Content-Type",bB="application/json",xB="application/graphql-response+json",wB=t=>t.replace(/([\s,]|#[^\n\r]+)+/g," ").trim(),SB=t=>{try{if(Array.isArray(t))return{_tag:"Batch",executionResults:t.map(MB)};if(gB(t))return{_tag:"Single",executionResult:MB(t)};throw new Error(`Invalid execution result: result is not object or array. \nGot:\n${String(t)}`)}catch(jR){return jR}},MB=t=>{if("object"!==typeof t||null===t)throw new Error("Invalid execution result: result is not object");let e,n,r;if("errors"in t){if(!gB(t.errors)&&!Array.isArray(t.errors))throw new Error("Invalid execution result: errors is not plain object OR array");e=t.errors}if("data"in t){if(!gB(t.data)&&null!==t.data)throw new Error("Invalid execution result: data is not plain object");n=t.data}if("extensions"in t){if(!gB(t.extensions))throw new Error("Invalid execution result: extensions is not plain object");r=t.extensions}return{data:n,errors:e,extensions:r}},EB=t=>Array.isArray(t.errors)?t.errors.length>0:Boolean(t.errors),TB=t=>"object"===typeof t&&null!==t&&"kind"in t&&t.kind===vB.OPERATION_DEFINITION;class AB{constructor(t,e,n){this.start=t.start,this.end=e.end,this.startToken=t,this.endToken=e,this.source=n}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}}class CB{constructor(t,e,n,r,i,s){this.kind=t,this.start=e,this.end=n,this.line=r,this.column=i,this.value=s,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const PB={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},IB=new Set(Object.keys(PB));function RB(t){const e=null===t||void 0===t?void 0:t.kind;return"string"===typeof e&&IB.has(e)}var LB;function NB(t,e){if(!Boolean(t))throw new Error(null!=e?e:"Unexpected invariant triggered.")}!function(t){t.QUERY="query",t.MUTATION="mutation",t.SUBSCRIPTION="subscription"}(LB||(LB={}));const OB=/\r\n|[\n\r]/g;function kB(t,e){let n=0,r=1;for(const i of t.body.matchAll(OB)){if("number"===typeof i.index||NB(!1),i.index>=e)break;n=i.index+i[0].length,r+=1}return{line:r,column:e+1-n}}function DB(t){return zB(t.source,kB(t.source,t.start))}function zB(t,e){const n=t.locationOffset.column-1,r="".padStart(n)+t.body,i=e.line-1,s=t.locationOffset.line-1,o=e.line+s,a=1===e.line?n:0,l=e.column+a,c=`${t.name}:${o}:${l}\n`,u=r.split(/\r\n|[\n\r]/g),h=u[i];if(h.length>120){const t=Math.floor(l/80),e=l%80,n=[];for(let r=0;r<h.length;r+=80)n.push(h.slice(r,r+80));return c+UB([[`${o} |`,n[0]],...n.slice(1,t+1).map((t=>["|",t])),["|","^".padStart(e)],["|",n[t+1]]])}return c+UB([[o-1+" |",u[i-1]],[`${o} |`,h],["|","^".padStart(l)],[`${o+1} |`,u[i+1]]])}function UB(t){const e=t.filter((t=>{let[e,n]=t;return void 0!==n})),n=Math.max(...e.map((t=>{let[e]=t;return e.length})));return e.map((t=>{let[e,r]=t;return e.padStart(n)+(r?" "+r:"")})).join("\n")}class FB extends Error{constructor(t){for(var e,n,r,i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];const{nodes:a,source:l,positions:c,path:u,originalError:h,extensions:d}=function(t){const e=t[0];return null==e||"kind"in e||"length"in e?{nodes:e,source:t[1],positions:t[2],path:t[3],originalError:t[4],extensions:t[5]}:e}(s);super(t),this.name="GraphQLError",this.path=null!==u&&void 0!==u?u:void 0,this.originalError=null!==h&&void 0!==h?h:void 0,this.nodes=BB(Array.isArray(a)?a:a?[a]:void 0);const p=BB(null===(e=this.nodes)||void 0===e?void 0:e.map((t=>t.loc)).filter((t=>null!=t)));this.source=null!==l&&void 0!==l?l:null===p||void 0===p||null===(n=p[0])||void 0===n?void 0:n.source,this.positions=null!==c&&void 0!==c?c:null===p||void 0===p?void 0:p.map((t=>t.start)),this.locations=c&&l?c.map((t=>kB(l,t))):null===p||void 0===p?void 0:p.map((t=>kB(t.source,t.start)));const f="object"==typeof(m=null===h||void 0===h?void 0:h.extensions)&&null!==m?null===h||void 0===h?void 0:h.extensions:void 0;var m;this.extensions=null!==(r=null!==d&&void 0!==d?d:f)&&void 0!==r?r:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),null!==h&&void 0!==h&&h.stack?Object.defineProperty(this,"stack",{value:h.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,FB):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let t=this.message;if(this.nodes)for(const e of this.nodes)e.loc&&(t+="\n\n"+DB(e.loc));else if(this.source&&this.locations)for(const e of this.locations)t+="\n\n"+zB(this.source,e);return t}toJSON(){const t={message:this.message};return null!=this.locations&&(t.locations=this.locations),null!=this.path&&(t.path=this.path),null!=this.extensions&&Object.keys(this.extensions).length>0&&(t.extensions=this.extensions),t}}function BB(t){return void 0===t||0===t.length?void 0:t}function VB(t,e,n){return new FB(`Syntax Error: ${n}`,{source:t,positions:[e]})}var HB,jB;function WB(t){return 9===t||32===t}function GB(t){return t>=48&&t<=57}function qB(t){return t>=97&&t<=122||t>=65&&t<=90}function $B(t){return qB(t)||95===t}function XB(t){return qB(t)||GB(t)||95===t}function JB(t){var e;let n=Number.MAX_SAFE_INTEGER,r=null,i=-1;for(let o=0;o<t.length;++o){var s;const e=t[o],a=YB(e);a!==e.length&&(r=null!==(s=r)&&void 0!==s?s:o,i=o,0!==o&&a<n&&(n=a))}return t.map(((t,e)=>0===e?t:t.slice(n))).slice(null!==(e=r)&&void 0!==e?e:0,i+1)}function YB(t){let e=0;for(;e<t.length&&WB(t.charCodeAt(e));)++e;return e}!function(t){t.QUERY="QUERY",t.MUTATION="MUTATION",t.SUBSCRIPTION="SUBSCRIPTION",t.FIELD="FIELD",t.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",t.FRAGMENT_SPREAD="FRAGMENT_SPREAD",t.INLINE_FRAGMENT="INLINE_FRAGMENT",t.VARIABLE_DEFINITION="VARIABLE_DEFINITION",t.SCHEMA="SCHEMA",t.SCALAR="SCALAR",t.OBJECT="OBJECT",t.FIELD_DEFINITION="FIELD_DEFINITION",t.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",t.INTERFACE="INTERFACE",t.UNION="UNION",t.ENUM="ENUM",t.ENUM_VALUE="ENUM_VALUE",t.INPUT_OBJECT="INPUT_OBJECT",t.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"}(HB||(HB={})),function(t){t.SOF="<SOF>",t.EOF="<EOF>",t.BANG="!",t.DOLLAR="$",t.AMP="&",t.PAREN_L="(",t.PAREN_R=")",t.SPREAD="...",t.COLON=":",t.EQUALS="=",t.AT="@",t.BRACKET_L="[",t.BRACKET_R="]",t.BRACE_L="{",t.PIPE="|",t.BRACE_R="}",t.NAME="Name",t.INT="Int",t.FLOAT="Float",t.STRING="String",t.BLOCK_STRING="BlockString",t.COMMENT="Comment"}(jB||(jB={}));class ZB{constructor(t){const e=new CB(jB.SOF,0,0,0,0);this.source=t,this.lastToken=e,this.token=e,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){this.lastToken=this.token;return this.token=this.lookahead()}lookahead(){let t=this.token;if(t.kind!==jB.EOF)do{if(t.next)t=t.next;else{const e=iV(this,t.end);t.next=e,e.prev=t,t=e}}while(t.kind===jB.COMMENT);return t}}function KB(t){return t>=0&&t<=55295||t>=57344&&t<=1114111}function QB(t,e){return tV(t.charCodeAt(e))&&eV(t.charCodeAt(e+1))}function tV(t){return t>=55296&&t<=56319}function eV(t){return t>=56320&&t<=57343}function nV(t,e){const n=t.source.body.codePointAt(e);if(void 0===n)return jB.EOF;if(n>=32&&n<=126){const t=String.fromCodePoint(n);return'"'===t?"'\"'":`"${t}"`}return"U+"+n.toString(16).toUpperCase().padStart(4,"0")}function rV(t,e,n,r,i){const s=t.line,o=1+n-t.lineStart;return new CB(e,n,r,s,o,i)}function iV(t,e){const n=t.source.body,r=n.length;let i=e;for(;i<r;){const e=n.charCodeAt(i);switch(e){case 65279:case 9:case 32:case 44:++i;continue;case 10:++i,++t.line,t.lineStart=i;continue;case 13:10===n.charCodeAt(i+1)?i+=2:++i,++t.line,t.lineStart=i;continue;case 35:return sV(t,i);case 33:return rV(t,jB.BANG,i,i+1);case 36:return rV(t,jB.DOLLAR,i,i+1);case 38:return rV(t,jB.AMP,i,i+1);case 40:return rV(t,jB.PAREN_L,i,i+1);case 41:return rV(t,jB.PAREN_R,i,i+1);case 46:if(46===n.charCodeAt(i+1)&&46===n.charCodeAt(i+2))return rV(t,jB.SPREAD,i,i+3);break;case 58:return rV(t,jB.COLON,i,i+1);case 61:return rV(t,jB.EQUALS,i,i+1);case 64:return rV(t,jB.AT,i,i+1);case 91:return rV(t,jB.BRACKET_L,i,i+1);case 93:return rV(t,jB.BRACKET_R,i,i+1);case 123:return rV(t,jB.BRACE_L,i,i+1);case 124:return rV(t,jB.PIPE,i,i+1);case 125:return rV(t,jB.BRACE_R,i,i+1);case 34:return 34===n.charCodeAt(i+1)&&34===n.charCodeAt(i+2)?fV(t,i):lV(t,i)}if(GB(e)||45===e)return oV(t,i,e);if($B(e))return mV(t,i);throw VB(t.source,i,39===e?"Unexpected single quote character ('), did you mean to use a double quote (\")?":KB(e)||QB(n,i)?`Unexpected character: ${nV(t,i)}.`:`Invalid character: ${nV(t,i)}.`)}return rV(t,jB.EOF,r,r)}function sV(t,e){const n=t.source.body,r=n.length;let i=e+1;for(;i<r;){const t=n.charCodeAt(i);if(10===t||13===t)break;if(KB(t))++i;else{if(!QB(n,i))break;i+=2}}return rV(t,jB.COMMENT,e,i,n.slice(e+1,i))}function oV(t,e,n){const r=t.source.body;let i=e,s=n,o=!1;if(45===s&&(s=r.charCodeAt(++i)),48===s){if(s=r.charCodeAt(++i),GB(s))throw VB(t.source,i,`Invalid number, unexpected digit after 0: ${nV(t,i)}.`)}else i=aV(t,i,s),s=r.charCodeAt(i);if(46===s&&(o=!0,s=r.charCodeAt(++i),i=aV(t,i,s),s=r.charCodeAt(i)),69!==s&&101!==s||(o=!0,s=r.charCodeAt(++i),43!==s&&45!==s||(s=r.charCodeAt(++i)),i=aV(t,i,s),s=r.charCodeAt(i)),46===s||$B(s))throw VB(t.source,i,`Invalid number, expected digit but got: ${nV(t,i)}.`);return rV(t,o?jB.FLOAT:jB.INT,e,i,r.slice(e,i))}function aV(t,e,n){if(!GB(n))throw VB(t.source,e,`Invalid number, expected digit but got: ${nV(t,e)}.`);const r=t.source.body;let i=e+1;for(;GB(r.charCodeAt(i));)++i;return i}function lV(t,e){const n=t.source.body,r=n.length;let i=e+1,s=i,o="";for(;i<r;){const r=n.charCodeAt(i);if(34===r)return o+=n.slice(s,i),rV(t,jB.STRING,e,i+1,o);if(92!==r){if(10===r||13===r)break;if(KB(r))++i;else{if(!QB(n,i))throw VB(t.source,i,`Invalid character within String: ${nV(t,i)}.`);i+=2}}else{o+=n.slice(s,i);const e=117===n.charCodeAt(i+1)?123===n.charCodeAt(i+2)?cV(t,i):uV(t,i):pV(t,i);o+=e.value,i+=e.size,s=i}}throw VB(t.source,i,"Unterminated string.")}function cV(t,e){const n=t.source.body;let r=0,i=3;for(;i<12;){const t=n.charCodeAt(e+i++);if(125===t){if(i<5||!KB(r))break;return{value:String.fromCodePoint(r),size:i}}if(r=r<<4|dV(t),r<0)break}throw VB(t.source,e,`Invalid Unicode escape sequence: "${n.slice(e,e+i)}".`)}function uV(t,e){const n=t.source.body,r=hV(n,e+2);if(KB(r))return{value:String.fromCodePoint(r),size:6};if(tV(r)&&92===n.charCodeAt(e+6)&&117===n.charCodeAt(e+7)){const t=hV(n,e+8);if(eV(t))return{value:String.fromCodePoint(r,t),size:12}}throw VB(t.source,e,`Invalid Unicode escape sequence: "${n.slice(e,e+6)}".`)}function hV(t,e){return dV(t.charCodeAt(e))<<12|dV(t.charCodeAt(e+1))<<8|dV(t.charCodeAt(e+2))<<4|dV(t.charCodeAt(e+3))}function dV(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:-1}function pV(t,e){const n=t.source.body;switch(n.charCodeAt(e+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:"\n",size:2};case 114:return{value:"\r",size:2};case 116:return{value:"\t",size:2}}throw VB(t.source,e,`Invalid character escape sequence: "${n.slice(e,e+2)}".`)}function fV(t,e){const n=t.source.body,r=n.length;let i=t.lineStart,s=e+3,o=s,a="";const l=[];for(;s<r;){const r=n.charCodeAt(s);if(34===r&&34===n.charCodeAt(s+1)&&34===n.charCodeAt(s+2)){a+=n.slice(o,s),l.push(a);const r=rV(t,jB.BLOCK_STRING,e,s+3,JB(l).join("\n"));return t.line+=l.length-1,t.lineStart=i,r}if(92!==r||34!==n.charCodeAt(s+1)||34!==n.charCodeAt(s+2)||34!==n.charCodeAt(s+3))if(10!==r&&13!==r)if(KB(r))++s;else{if(!QB(n,s))throw VB(t.source,s,`Invalid character within String: ${nV(t,s)}.`);s+=2}else a+=n.slice(o,s),l.push(a),13===r&&10===n.charCodeAt(s+1)?s+=2:++s,a="",o=s,i=s;else a+=n.slice(o,s),o=s+1,s+=4}throw VB(t.source,s,"Unterminated string.")}function mV(t,e){const n=t.source.body,r=n.length;let i=e+1;for(;i<r;){if(!XB(n.charCodeAt(i)))break;++i}return rV(t,jB.NAME,e,i,n.slice(e,i))}function gV(t,e){if(!Boolean(t))throw new Error(e)}function vV(t){return yV(t,[])}function yV(t,e){switch(typeof t){case"string":return JSON.stringify(t);case"function":return t.name?`[function ${t.name}]`:"[function]";case"object":return function(t,e){if(null===t)return"null";if(e.includes(t))return"[Circular]";const n=[...e,t];if(function(t){return"function"===typeof t.toJSON}(t)){const e=t.toJSON();if(e!==t)return"string"===typeof e?e:yV(e,n)}else if(Array.isArray(t))return function(t,e){if(0===t.length)return"[]";if(e.length>2)return"[Array]";const n=Math.min(10,t.length),r=t.length-n,i=[];for(let s=0;s<n;++s)i.push(yV(t[s],e));1===r?i.push("... 1 more item"):r>1&&i.push(`... ${r} more items`);return"["+i.join(", ")+"]"}(t,n);return function(t,e){const n=Object.entries(t);if(0===n.length)return"{}";if(e.length>2)return"["+function(t){const e=Object.prototype.toString.call(t).replace(/^\[object /,"").replace(/]$/,"");if("Object"===e&&"function"===typeof t.constructor){const e=t.constructor.name;if("string"===typeof e&&""!==e)return e}return e}(t)+"]";const r=n.map((t=>{let[n,r]=t;return n+": "+yV(r,e)}));return"{ "+r.join(", ")+" }"}(t,n)}(t,e);default:return String(t)}}const _V=globalThis.process&&!0?function(t,e){return t instanceof e}:function(t,e){if(t instanceof e)return!0;if("object"===typeof t&&null!==t){var n;const r=e.prototype[Symbol.toStringTag];if(r===(Symbol.toStringTag in t?t[Symbol.toStringTag]:null===(n=t.constructor)||void 0===n?void 0:n.name)){const e=vV(t);throw new Error(`Cannot use ${r} "${e}" from another module or realm.\n\nEnsure that there is only one instance of "graphql" in the node_modules\ndirectory. If different versions of "graphql" are the dependencies of other\nrelied on modules, use "resolutions" to ensure only one version is installed.\n\nhttps://yarnpkg.com/en/docs/selective-version-resolutions\n\nDuplicate "graphql" modules cannot be used at the same time since different\nversions may have different capabilities and behavior. The data from one\nversion used in the function from another could produce confusing and\nspurious results.`)}}return!1};class bV{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GraphQL request",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{line:1,column:1};"string"===typeof t||gV(!1,`Body must be a string. Received: ${vV(t)}.`),this.body=t,this.name=e,this.locationOffset=n,this.locationOffset.line>0||gV(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||gV(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}}class xV{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=function(t){return _V(t,bV)}(t)?t:new bV(t);this._lexer=new ZB(n),this._options=e,this._tokenCounter=0}parseName(){const t=this.expectToken(jB.NAME);return this.node(t,{kind:vB.NAME,value:t.value})}parseDocument(){return this.node(this._lexer.token,{kind:vB.DOCUMENT,definitions:this.many(jB.SOF,this.parseDefinition,jB.EOF)})}parseDefinition(){if(this.peek(jB.BRACE_L))return this.parseOperationDefinition();const t=this.peekDescription(),e=t?this._lexer.lookahead():this._lexer.token;if(e.kind===jB.NAME){switch(e.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(t)throw VB(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(e.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(e)}parseOperationDefinition(){const t=this._lexer.token;if(this.peek(jB.BRACE_L))return this.node(t,{kind:vB.OPERATION_DEFINITION,operation:LB.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const e=this.parseOperationType();let n;return this.peek(jB.NAME)&&(n=this.parseName()),this.node(t,{kind:vB.OPERATION_DEFINITION,operation:e,name:n,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const t=this.expectToken(jB.NAME);switch(t.value){case"query":return LB.QUERY;case"mutation":return LB.MUTATION;case"subscription":return LB.SUBSCRIPTION}throw this.unexpected(t)}parseVariableDefinitions(){return this.optionalMany(jB.PAREN_L,this.parseVariableDefinition,jB.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:vB.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(jB.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(jB.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const t=this._lexer.token;return this.expectToken(jB.DOLLAR),this.node(t,{kind:vB.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:vB.SELECTION_SET,selections:this.many(jB.BRACE_L,this.parseSelection,jB.BRACE_R)})}parseSelection(){return this.peek(jB.SPREAD)?this.parseFragment():this.parseField()}parseField(){const t=this._lexer.token,e=this.parseName();let n,r;return this.expectOptionalToken(jB.COLON)?(n=e,r=this.parseName()):r=e,this.node(t,{kind:vB.FIELD,alias:n,name:r,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(jB.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(t){const e=t?this.parseConstArgument:this.parseArgument;return this.optionalMany(jB.PAREN_L,e,jB.PAREN_R)}parseArgument(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=this._lexer.token,n=this.parseName();return this.expectToken(jB.COLON),this.node(e,{kind:vB.ARGUMENT,name:n,value:this.parseValueLiteral(t)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const t=this._lexer.token;this.expectToken(jB.SPREAD);const e=this.expectOptionalKeyword("on");return!e&&this.peek(jB.NAME)?this.node(t,{kind:vB.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(t,{kind:vB.INLINE_FRAGMENT,typeCondition:e?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const t=this._lexer.token;return this.expectKeyword("fragment"),!0===this._options.allowLegacyFragmentVariables?this.node(t,{kind:vB.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(t,{kind:vB.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()}parseValueLiteral(t){const e=this._lexer.token;switch(e.kind){case jB.BRACKET_L:return this.parseList(t);case jB.BRACE_L:return this.parseObject(t);case jB.INT:return this.advanceLexer(),this.node(e,{kind:vB.INT,value:e.value});case jB.FLOAT:return this.advanceLexer(),this.node(e,{kind:vB.FLOAT,value:e.value});case jB.STRING:case jB.BLOCK_STRING:return this.parseStringLiteral();case jB.NAME:switch(this.advanceLexer(),e.value){case"true":return this.node(e,{kind:vB.BOOLEAN,value:!0});case"false":return this.node(e,{kind:vB.BOOLEAN,value:!1});case"null":return this.node(e,{kind:vB.NULL});default:return this.node(e,{kind:vB.ENUM,value:e.value})}case jB.DOLLAR:if(t){if(this.expectToken(jB.DOLLAR),this._lexer.token.kind===jB.NAME){const t=this._lexer.token.value;throw VB(this._lexer.source,e.start,`Unexpected variable "$${t}" in constant value.`)}throw this.unexpected(e)}return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const t=this._lexer.token;return this.advanceLexer(),this.node(t,{kind:vB.STRING,value:t.value,block:t.kind===jB.BLOCK_STRING})}parseList(t){return this.node(this._lexer.token,{kind:vB.LIST,values:this.any(jB.BRACKET_L,(()=>this.parseValueLiteral(t)),jB.BRACKET_R)})}parseObject(t){return this.node(this._lexer.token,{kind:vB.OBJECT,fields:this.any(jB.BRACE_L,(()=>this.parseObjectField(t)),jB.BRACE_R)})}parseObjectField(t){const e=this._lexer.token,n=this.parseName();return this.expectToken(jB.COLON),this.node(e,{kind:vB.OBJECT_FIELD,name:n,value:this.parseValueLiteral(t)})}parseDirectives(t){const e=[];for(;this.peek(jB.AT);)e.push(this.parseDirective(t));return e}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(t){const e=this._lexer.token;return this.expectToken(jB.AT),this.node(e,{kind:vB.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(t)})}parseTypeReference(){const t=this._lexer.token;let e;if(this.expectOptionalToken(jB.BRACKET_L)){const n=this.parseTypeReference();this.expectToken(jB.BRACKET_R),e=this.node(t,{kind:vB.LIST_TYPE,type:n})}else e=this.parseNamedType();return this.expectOptionalToken(jB.BANG)?this.node(t,{kind:vB.NON_NULL_TYPE,type:e}):e}parseNamedType(){return this.node(this._lexer.token,{kind:vB.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(jB.STRING)||this.peek(jB.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const t=this._lexer.token,e=this.parseDescription();this.expectKeyword("schema");const n=this.parseConstDirectives(),r=this.many(jB.BRACE_L,this.parseOperationTypeDefinition,jB.BRACE_R);return this.node(t,{kind:vB.SCHEMA_DEFINITION,description:e,directives:n,operationTypes:r})}parseOperationTypeDefinition(){const t=this._lexer.token,e=this.parseOperationType();this.expectToken(jB.COLON);const n=this.parseNamedType();return this.node(t,{kind:vB.OPERATION_TYPE_DEFINITION,operation:e,type:n})}parseScalarTypeDefinition(){const t=this._lexer.token,e=this.parseDescription();this.expectKeyword("scalar");const n=this.parseName(),r=this.parseConstDirectives();return this.node(t,{kind:vB.SCALAR_TYPE_DEFINITION,description:e,name:n,directives:r})}parseObjectTypeDefinition(){const t=this._lexer.token,e=this.parseDescription();this.expectKeyword("type");const n=this.parseName(),r=this.parseImplementsInterfaces(),i=this.parseConstDirectives(),s=this.parseFieldsDefinition();return this.node(t,{kind:vB.OBJECT_TYPE_DEFINITION,description:e,name:n,interfaces:r,directives:i,fields:s})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(jB.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(jB.BRACE_L,this.parseFieldDefinition,jB.BRACE_R)}parseFieldDefinition(){const t=this._lexer.token,e=this.parseDescription(),n=this.parseName(),r=this.parseArgumentDefs();this.expectToken(jB.COLON);const i=this.parseTypeReference(),s=this.parseConstDirectives();return this.node(t,{kind:vB.FIELD_DEFINITION,description:e,name:n,arguments:r,type:i,directives:s})}parseArgumentDefs(){return this.optionalMany(jB.PAREN_L,this.parseInputValueDef,jB.PAREN_R)}parseInputValueDef(){const t=this._lexer.token,e=this.parseDescription(),n=this.parseName();this.expectToken(jB.COLON);const r=this.parseTypeReference();let i;this.expectOptionalToken(jB.EQUALS)&&(i=this.parseConstValueLiteral());const s=this.parseConstDirectives();return this.node(t,{kind:vB.INPUT_VALUE_DEFINITION,description:e,name:n,type:r,defaultValue:i,directives:s})}parseInterfaceTypeDefinition(){const t=this._lexer.token,e=this.parseDescription();this.expectKeyword("interface");const n=this.parseName(),r=this.parseImplementsInterfaces(),i=this.parseConstDirectives(),s=this.parseFieldsDefinition();return this.node(t,{kind:vB.INTERFACE_TYPE_DEFINITION,description:e,name:n,interfaces:r,directives:i,fields:s})}parseUnionTypeDefinition(){const t=this._lexer.token,e=this.parseDescription();this.expectKeyword("union");const n=this.parseName(),r=this.parseConstDirectives(),i=this.parseUnionMemberTypes();return this.node(t,{kind:vB.UNION_TYPE_DEFINITION,description:e,name:n,directives:r,types:i})}parseUnionMemberTypes(){return this.expectOptionalToken(jB.EQUALS)?this.delimitedMany(jB.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const t=this._lexer.token,e=this.parseDescription();this.expectKeyword("enum");const n=this.parseName(),r=this.parseConstDirectives(),i=this.parseEnumValuesDefinition();return this.node(t,{kind:vB.ENUM_TYPE_DEFINITION,description:e,name:n,directives:r,values:i})}parseEnumValuesDefinition(){return this.optionalMany(jB.BRACE_L,this.parseEnumValueDefinition,jB.BRACE_R)}parseEnumValueDefinition(){const t=this._lexer.token,e=this.parseDescription(),n=this.parseEnumValueName(),r=this.parseConstDirectives();return this.node(t,{kind:vB.ENUM_VALUE_DEFINITION,description:e,name:n,directives:r})}parseEnumValueName(){if("true"===this._lexer.token.value||"false"===this._lexer.token.value||"null"===this._lexer.token.value)throw VB(this._lexer.source,this._lexer.token.start,`${wV(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const t=this._lexer.token,e=this.parseDescription();this.expectKeyword("input");const n=this.parseName(),r=this.parseConstDirectives(),i=this.parseInputFieldsDefinition();return this.node(t,{kind:vB.INPUT_OBJECT_TYPE_DEFINITION,description:e,name:n,directives:r,fields:i})}parseInputFieldsDefinition(){return this.optionalMany(jB.BRACE_L,this.parseInputValueDef,jB.BRACE_R)}parseTypeSystemExtension(){const t=this._lexer.lookahead();if(t.kind===jB.NAME)switch(t.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(t)}parseSchemaExtension(){const t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const e=this.parseConstDirectives(),n=this.optionalMany(jB.BRACE_L,this.parseOperationTypeDefinition,jB.BRACE_R);if(0===e.length&&0===n.length)throw this.unexpected();return this.node(t,{kind:vB.SCHEMA_EXTENSION,directives:e,operationTypes:n})}parseScalarTypeExtension(){const t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const e=this.parseName(),n=this.parseConstDirectives();if(0===n.length)throw this.unexpected();return this.node(t,{kind:vB.SCALAR_TYPE_EXTENSION,name:e,directives:n})}parseObjectTypeExtension(){const t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const e=this.parseName(),n=this.parseImplementsInterfaces(),r=this.parseConstDirectives(),i=this.parseFieldsDefinition();if(0===n.length&&0===r.length&&0===i.length)throw this.unexpected();return this.node(t,{kind:vB.OBJECT_TYPE_EXTENSION,name:e,interfaces:n,directives:r,fields:i})}parseInterfaceTypeExtension(){const t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const e=this.parseName(),n=this.parseImplementsInterfaces(),r=this.parseConstDirectives(),i=this.parseFieldsDefinition();if(0===n.length&&0===r.length&&0===i.length)throw this.unexpected();return this.node(t,{kind:vB.INTERFACE_TYPE_EXTENSION,name:e,interfaces:n,directives:r,fields:i})}parseUnionTypeExtension(){const t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const e=this.parseName(),n=this.parseConstDirectives(),r=this.parseUnionMemberTypes();if(0===n.length&&0===r.length)throw this.unexpected();return this.node(t,{kind:vB.UNION_TYPE_EXTENSION,name:e,directives:n,types:r})}parseEnumTypeExtension(){const t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const e=this.parseName(),n=this.parseConstDirectives(),r=this.parseEnumValuesDefinition();if(0===n.length&&0===r.length)throw this.unexpected();return this.node(t,{kind:vB.ENUM_TYPE_EXTENSION,name:e,directives:n,values:r})}parseInputObjectTypeExtension(){const t=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const e=this.parseName(),n=this.parseConstDirectives(),r=this.parseInputFieldsDefinition();if(0===n.length&&0===r.length)throw this.unexpected();return this.node(t,{kind:vB.INPUT_OBJECT_TYPE_EXTENSION,name:e,directives:n,fields:r})}parseDirectiveDefinition(){const t=this._lexer.token,e=this.parseDescription();this.expectKeyword("directive"),this.expectToken(jB.AT);const n=this.parseName(),r=this.parseArgumentDefs(),i=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const s=this.parseDirectiveLocations();return this.node(t,{kind:vB.DIRECTIVE_DEFINITION,description:e,name:n,arguments:r,repeatable:i,locations:s})}parseDirectiveLocations(){return this.delimitedMany(jB.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const t=this._lexer.token,e=this.parseName();if(Object.prototype.hasOwnProperty.call(HB,e.value))return e;throw this.unexpected(t)}node(t,e){return!0!==this._options.noLocation&&(e.loc=new AB(t,this._lexer.lastToken,this._lexer.source)),e}peek(t){return this._lexer.token.kind===t}expectToken(t){const e=this._lexer.token;if(e.kind===t)return this.advanceLexer(),e;throw VB(this._lexer.source,e.start,`Expected ${SV(t)}, found ${wV(e)}.`)}expectOptionalToken(t){return this._lexer.token.kind===t&&(this.advanceLexer(),!0)}expectKeyword(t){const e=this._lexer.token;if(e.kind!==jB.NAME||e.value!==t)throw VB(this._lexer.source,e.start,`Expected "${t}", found ${wV(e)}.`);this.advanceLexer()}expectOptionalKeyword(t){const e=this._lexer.token;return e.kind===jB.NAME&&e.value===t&&(this.advanceLexer(),!0)}unexpected(t){const e=null!==t&&void 0!==t?t:this._lexer.token;return VB(this._lexer.source,e.start,`Unexpected ${wV(e)}.`)}any(t,e,n){this.expectToken(t);const r=[];for(;!this.expectOptionalToken(n);)r.push(e.call(this));return r}optionalMany(t,e,n){if(this.expectOptionalToken(t)){const t=[];do{t.push(e.call(this))}while(!this.expectOptionalToken(n));return t}return[]}many(t,e,n){this.expectToken(t);const r=[];do{r.push(e.call(this))}while(!this.expectOptionalToken(n));return r}delimitedMany(t,e){this.expectOptionalToken(t);const n=[];do{n.push(e.call(this))}while(this.expectOptionalToken(t));return n}advanceLexer(){const{maxTokens:t}=this._options,e=this._lexer.advance();if(void 0!==t&&e.kind!==jB.EOF&&(++this._tokenCounter,this._tokenCounter>t))throw VB(this._lexer.source,e.start,`Document contains more that ${t} tokens. Parsing aborted.`)}}function wV(t){const e=t.value;return SV(t.kind)+(null!=e?` "${e}"`:"")}function SV(t){return function(t){return t===jB.BANG||t===jB.DOLLAR||t===jB.AMP||t===jB.PAREN_L||t===jB.PAREN_R||t===jB.SPREAD||t===jB.COLON||t===jB.EQUALS||t===jB.AT||t===jB.BRACKET_L||t===jB.BRACKET_R||t===jB.BRACE_L||t===jB.PIPE||t===jB.BRACE_R}(t)?`"${t}"`:t}const MV=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function EV(t){return TV[t.charCodeAt(0)]}const TV=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"],AV=Object.freeze({});function CV(t,e){const n=t[e];return"object"===typeof n?n:"function"===typeof n?{enter:n,leave:void 0}:{enter:t.enter,leave:t.leave}}function PV(t){return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:PB;const r=new Map;for(const v of Object.values(vB))r.set(v,CV(e,v));let i,s,o,a=Array.isArray(t),l=[t],c=-1,u=[],h=t;const d=[],p=[];do{c++;const t=c===l.length,v=t&&0!==u.length;if(t){if(s=0===p.length?void 0:d[d.length-1],h=o,o=p.pop(),v)if(a){h=h.slice();let t=0;for(const[e,n]of u){const r=e-t;null===n?(h.splice(r,1),t++):h[r]=n}}else{h=Object.defineProperties({},Object.getOwnPropertyDescriptors(h));for(const[t,e]of u)h[t]=e}c=i.index,l=i.keys,u=i.edits,a=i.inArray,i=i.prev}else if(o){if(s=a?c:l[c],h=o[s],null===h||void 0===h)continue;d.push(s)}let y;if(!Array.isArray(h)){var f,m;RB(h)||gV(!1,`Invalid AST Node: ${vV(h)}.`);const n=t?null===(f=r.get(h.kind))||void 0===f?void 0:f.leave:null===(m=r.get(h.kind))||void 0===m?void 0:m.enter;if(y=null===n||void 0===n?void 0:n.call(e,h,s,o,d,p),y===AV)break;if(!1===y){if(!t){d.pop();continue}}else if(void 0!==y&&(u.push([s,y]),!t)){if(!RB(y)){d.pop();continue}h=y}}var g;void 0===y&&v&&u.push([s,h]),t?d.pop():(i={inArray:a,index:c,keys:l,edits:u,prev:i},a=Array.isArray(h),l=a?h:null!==(g=n[h.kind])&&void 0!==g?g:[],c=-1,u=[],o&&p.push(o),o=h)}while(void 0!==i);return 0!==u.length?u[u.length-1][1]:t}(t,IV)}const IV={Name:{leave:t=>t.value},Variable:{leave:t=>"$"+t.name},Document:{leave:t=>RV(t.definitions,"\n\n")},OperationDefinition:{leave(t){const e=NV("(",RV(t.variableDefinitions,", "),")"),n=RV([t.operation,RV([t.name,e]),RV(t.directives," ")]," ");return("query"===n?"":n+" ")+t.selectionSet}},VariableDefinition:{leave:t=>{let{variable:e,type:n,defaultValue:r,directives:i}=t;return e+": "+n+NV(" = ",r)+NV(" ",RV(i," "))}},SelectionSet:{leave:t=>{let{selections:e}=t;return LV(e)}},Field:{leave(t){let{alias:e,name:n,arguments:r,directives:i,selectionSet:s}=t;const o=NV("",e,": ")+n;let a=o+NV("(",RV(r,", "),")");return a.length>80&&(a=o+NV("(\n",OV(RV(r,"\n")),"\n)")),RV([a,RV(i," "),s]," ")}},Argument:{leave:t=>{let{name:e,value:n}=t;return e+": "+n}},FragmentSpread:{leave:t=>{let{name:e,directives:n}=t;return"..."+e+NV(" ",RV(n," "))}},InlineFragment:{leave:t=>{let{typeCondition:e,directives:n,selectionSet:r}=t;return RV(["...",NV("on ",e),RV(n," "),r]," ")}},FragmentDefinition:{leave:t=>{let{name:e,typeCondition:n,variableDefinitions:r,directives:i,selectionSet:s}=t;return`fragment ${e}${NV("(",RV(r,", "),")")} on ${n} ${NV("",RV(i," ")," ")}`+s}},IntValue:{leave:t=>{let{value:e}=t;return e}},FloatValue:{leave:t=>{let{value:e}=t;return e}},StringValue:{leave:t=>{let{value:e,block:n}=t;return n?function(t,e){const n=t.replace(/"""/g,'\\"""'),r=n.split(/\r\n|[\n\r]/g),i=1===r.length,s=r.length>1&&r.slice(1).every((t=>0===t.length||WB(t.charCodeAt(0)))),o=n.endsWith('\\"""'),a=t.endsWith('"')&&!o,l=t.endsWith("\\"),c=a||l,u=!(null!==e&&void 0!==e&&e.minimize)&&(!i||t.length>70||c||s||o);let h="";const d=i&&WB(t.charCodeAt(0));return(u&&!d||s)&&(h+="\n"),h+=n,(u||c)&&(h+="\n"),'"""'+h+'"""'}(e):`"${e.replace(MV,EV)}"`}},BooleanValue:{leave:t=>{let{value:e}=t;return e?"true":"false"}},NullValue:{leave:()=>"null"},EnumValue:{leave:t=>{let{value:e}=t;return e}},ListValue:{leave:t=>{let{values:e}=t;return"["+RV(e,", ")+"]"}},ObjectValue:{leave:t=>{let{fields:e}=t;return"{"+RV(e,", ")+"}"}},ObjectField:{leave:t=>{let{name:e,value:n}=t;return e+": "+n}},Directive:{leave:t=>{let{name:e,arguments:n}=t;return"@"+e+NV("(",RV(n,", "),")")}},NamedType:{leave:t=>{let{name:e}=t;return e}},ListType:{leave:t=>{let{type:e}=t;return"["+e+"]"}},NonNullType:{leave:t=>{let{type:e}=t;return e+"!"}},SchemaDefinition:{leave:t=>{let{description:e,directives:n,operationTypes:r}=t;return NV("",e,"\n")+RV(["schema",RV(n," "),LV(r)]," ")}},OperationTypeDefinition:{leave:t=>{let{operation:e,type:n}=t;return e+": "+n}},ScalarTypeDefinition:{leave:t=>{let{description:e,name:n,directives:r}=t;return NV("",e,"\n")+RV(["scalar",n,RV(r," ")]," ")}},ObjectTypeDefinition:{leave:t=>{let{description:e,name:n,interfaces:r,directives:i,fields:s}=t;return NV("",e,"\n")+RV(["type",n,NV("implements ",RV(r," & ")),RV(i," "),LV(s)]," ")}},FieldDefinition:{leave:t=>{let{description:e,name:n,arguments:r,type:i,directives:s}=t;return NV("",e,"\n")+n+(kV(r)?NV("(\n",OV(RV(r,"\n")),"\n)"):NV("(",RV(r,", "),")"))+": "+i+NV(" ",RV(s," "))}},InputValueDefinition:{leave:t=>{let{description:e,name:n,type:r,defaultValue:i,directives:s}=t;return NV("",e,"\n")+RV([n+": "+r,NV("= ",i),RV(s," ")]," ")}},InterfaceTypeDefinition:{leave:t=>{let{description:e,name:n,interfaces:r,directives:i,fields:s}=t;return NV("",e,"\n")+RV(["interface",n,NV("implements ",RV(r," & ")),RV(i," "),LV(s)]," ")}},UnionTypeDefinition:{leave:t=>{let{description:e,name:n,directives:r,types:i}=t;return NV("",e,"\n")+RV(["union",n,RV(r," "),NV("= ",RV(i," | "))]," ")}},EnumTypeDefinition:{leave:t=>{let{description:e,name:n,directives:r,values:i}=t;return NV("",e,"\n")+RV(["enum",n,RV(r," "),LV(i)]," ")}},EnumValueDefinition:{leave:t=>{let{description:e,name:n,directives:r}=t;return NV("",e,"\n")+RV([n,RV(r," ")]," ")}},InputObjectTypeDefinition:{leave:t=>{let{description:e,name:n,directives:r,fields:i}=t;return NV("",e,"\n")+RV(["input",n,RV(r," "),LV(i)]," ")}},DirectiveDefinition:{leave:t=>{let{description:e,name:n,arguments:r,repeatable:i,locations:s}=t;return NV("",e,"\n")+"directive @"+n+(kV(r)?NV("(\n",OV(RV(r,"\n")),"\n)"):NV("(",RV(r,", "),")"))+(i?" repeatable":"")+" on "+RV(s," | ")}},SchemaExtension:{leave:t=>{let{directives:e,operationTypes:n}=t;return RV(["extend schema",RV(e," "),LV(n)]," ")}},ScalarTypeExtension:{leave:t=>{let{name:e,directives:n}=t;return RV(["extend scalar",e,RV(n," ")]," ")}},ObjectTypeExtension:{leave:t=>{let{name:e,interfaces:n,directives:r,fields:i}=t;return RV(["extend type",e,NV("implements ",RV(n," & ")),RV(r," "),LV(i)]," ")}},InterfaceTypeExtension:{leave:t=>{let{name:e,interfaces:n,directives:r,fields:i}=t;return RV(["extend interface",e,NV("implements ",RV(n," & ")),RV(r," "),LV(i)]," ")}},UnionTypeExtension:{leave:t=>{let{name:e,directives:n,types:r}=t;return RV(["extend union",e,RV(n," "),NV("= ",RV(r," | "))]," ")}},EnumTypeExtension:{leave:t=>{let{name:e,directives:n,values:r}=t;return RV(["extend enum",e,RV(n," "),LV(r)]," ")}},InputObjectTypeExtension:{leave:t=>{let{name:e,directives:n,fields:r}=t;return RV(["extend input",e,RV(n," "),LV(r)]," ")}}};function RV(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";var n;return null!==(n=null===t||void 0===t?void 0:t.filter((t=>t)).join(e))&&void 0!==n?n:""}function LV(t){return NV("{\n",OV(RV(t,"\n")),"\n}")}function NV(t,e){return null!=e&&""!==e?t+e+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:""):""}function OV(t){return NV("  ",t.replace(/\n/g,"\n  "))}function kV(t){var e;return null!==(e=null===t||void 0===t?void 0:t.some((t=>t.includes("\n"))))&&void 0!==e&&e}const DV=(t,e)=>{const n="string"===typeof t?t:PV(t);let r,i=!1;if(e)return{expression:n,isMutation:i,operationName:r};const s=(t=>{try{const e=t();return fB(e)?e.catch((t=>pB(t))):e}catch(e){return pB(e)}})((()=>{return"string"===typeof t?new xV(t,e).parseDocument():t;var e}));return s instanceof Error?{expression:n,isMutation:i,operationName:r}:(r=(t=>{let e;const n=t.definitions.filter(TB);return 1===n.length&&(e=n[0].name?.value),e})(s),i=(t=>{let e=!1;const n=t.definitions.filter(TB);return 1===n.length&&(e=n[0].operation===LB.MUTATION),e})(s),{expression:n,operationName:r,isMutation:i})},zV=JSON,UV=async t=>{const e={...t,method:"Single"===t.request._tag?t.request.document.isMutation?"POST":lB(t.method??"post"):t.request.hasMutations?"POST":lB(t.method??"post"),fetchOptions:{...t.fetchOptions,errorPolicy:t.fetchOptions.errorPolicy??"none"}},n=VV(e.method),r=await n(e);if(!r.ok)return new aB({status:r.status,headers:r.headers},{query:"Single"===t.request._tag?t.request.document.expression:t.request.query,variables:t.request.variables});const i=await BV(r,t.fetchOptions.jsonSerializer??zV);if(i instanceof Error)throw i;const s={status:r.status,headers:r.headers};if((t=>"Batch"===t._tag?t.executionResults.some(EB):EB(t.executionResult))(i)&&"none"===e.fetchOptions.errorPolicy){const e="Batch"===i._tag?{...i.executionResults,...s}:{...i.executionResult,...s};return new aB(e,{query:"Single"===t.request._tag?t.request.document.expression:t.request.query,variables:t.request.variables})}switch(i._tag){case"Single":return{...s,...FV(e)(i.executionResult)};case"Batch":return{...s,data:i.executionResults.map(FV(e))};default:mB(i)}},FV=t=>e=>({extensions:e.extensions,data:e.data,errors:"all"===t.fetchOptions.errorPolicy?e.errors:void 0}),BV=async(t,e)=>{const n=t.headers.get(_B),r=await t.text();return n&&(t=>{const e=t.toLowerCase();return e.includes(xB)||e.includes(bB)})(n)?SB(e.parse(r)):SB(r)},VV=t=>async e=>{const n=new Headers(e.headers);let r,i=null;if(n.has(yB)||n.set(yB,[xB,bB].join(", ")),"POST"===t){r=(e.fetchOptions.jsonSerializer??zV).stringify(HV(e)),"string"!==typeof r||n.has(_B)||n.set(_B,bB)}else i=jV(e);const s={method:t,headers:n,body:r,...e.fetchOptions};let o=new URL(e.url),a=s;if(e.middleware){const t=await Promise.resolve(e.middleware({...s,url:e.url,operationName:"Single"===e.request._tag?e.request.document.operationName:void 0,variables:e.request.variables})),{url:n,...r}=t;o=new URL(n),a=r}i&&i.forEach(((t,e)=>{o.searchParams.append(e,t)}));const l=e.fetch??fetch;return await l(o,a)},HV=t=>{switch(t.request._tag){case"Single":return{query:t.request.document.expression,variables:t.request.variables,operationName:t.request.document.operationName};case"Batch":return uB(t.request.query,t.request.variables??[]).map((t=>{let[e,n]=t;return{query:e,variables:n}}));default:throw mB(t.request)}},jV=t=>{const e=t.fetchOptions.jsonSerializer??zV,n=new URLSearchParams;switch(t.request._tag){case"Single":return n.append("query",wB(t.request.document.expression)),t.request.variables&&n.append("variables",e.stringify(t.request.variables)),t.request.document.operationName&&n.append("operationName",t.request.document.operationName),n;case"Batch":{const r=t.request.variables?.map((t=>e.stringify(t)))??[],i=t.request.query.map(wB),s=uB(i,r).map((t=>{let[e,n]=t;return{query:e,variables:n}}));return n.append("query",e.stringify(s)),n}default:throw mB(t.request)}};class WV{url;requestConfig;constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=t,this.requestConfig=e}rawRequest=(()=>{var t=this;return async function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];const[i,s,o]=n,a=((t,e,n)=>t.query?t:{query:t,variables:e,requestHeaders:n,signal:void 0})(i,s,o),{headers:l,fetch:c=globalThis.fetch,method:u="POST",requestMiddleware:h,responseMiddleware:d,excludeOperationName:p,...f}=t.requestConfig,{url:m}=t;void 0!==a.signal&&(f.signal=a.signal);const g=DV(a.query,p),v=await UV({url:m,request:{_tag:"Single",document:g,variables:a.variables},headers:{...hB(cB(l)),...hB(a.requestHeaders)},fetch:c,method:u,fetchOptions:f,middleware:h});if(d&&await d(v,{operationName:g.operationName,variables:s,url:t.url}),v instanceof Error)throw v;return v}})();async request(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const[i,s]=n,o=GV(t,i,s),{headers:a,fetch:l=globalThis.fetch,method:c="POST",requestMiddleware:u,responseMiddleware:h,excludeOperationName:d,...p}=this.requestConfig,{url:f}=this;void 0!==o.signal&&(p.signal=o.signal);const m=DV(o.document,d),g=await UV({url:f,request:{_tag:"Single",document:m,variables:o.variables},headers:{...hB(cB(a)),...hB(o.requestHeaders)},fetch:l,method:c,fetchOptions:p,middleware:u});if(h&&await h(g,{operationName:m.operationName,variables:o.variables,url:this.url}),g instanceof Error)throw g;return g.data}async batchRequests(t,e){const n=((t,e)=>t.documents?t:{documents:t,requestHeaders:e,signal:void 0})(t,e),{headers:r,excludeOperationName:i,...s}=this.requestConfig;void 0!==n.signal&&(s.signal=n.signal);const o=n.documents.map((t=>{let{document:e}=t;return DV(e,i)})),a=o.map((t=>{let{expression:e}=t;return e})),l=o.some((t=>{let{isMutation:e}=t;return e})),c=n.documents.map((t=>{let{variables:e}=t;return e})),u=await UV({url:this.url,request:{_tag:"Batch",operationName:void 0,query:a,hasMutations:l,variables:c},headers:{...hB(cB(r)),...hB(n.requestHeaders)},fetch:this.requestConfig.fetch??globalThis.fetch,method:this.requestConfig.method||"POST",fetchOptions:s,middleware:this.requestConfig.requestMiddleware});if(this.requestConfig.responseMiddleware&&await this.requestConfig.responseMiddleware(u,{operationName:void 0,variables:c,url:this.url}),u instanceof Error)throw u;return u.data}setHeaders(t){return this.requestConfig.headers=t,this}setHeader(t,e){const{headers:n}=this.requestConfig;return n?n[t]=e:this.requestConfig.headers={[t]:e},this}setEndpoint(t){return this.url=t,this}}const GV=(t,e,n)=>t.document?t:{document:t,variables:e,requestHeaders:n,signal:void 0},qV=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t.reduce(((t,e,r)=>`${t}${e}${r in n?String(n[r]):""}`),"")},$V={weapon:{allNames:qV`
      query {
        weapon(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        weapon(name: $name) {
          id
          name
          image
          description
        }
      }
    `},shield:{allNames:qV`
      query {
        shield(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        shield(name: $name) {
          id
          name
          image
          description
        }
      }
    `},npc:{allNames:qV`
      query {
        npc(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        npc(name: $name) {
          id
          name
          image
          description
        }
      }
    `},armor:{allNames:qV`
      query {
        armor(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        armor(name: $name) {
          id
          name
          image
          description
        }
      }
    `},boss:{allNames:qV`
      query {
        boss(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        boss(name: $name) {
          id
          name
          image
          description
        }
      }
    `},ammo:{allNames:qV`
      query {
        ammo(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        ammo(name: $name) {
          id
          name
          image
          description
        }
      }
    `},ashOfWar:{allNames:qV`
      query {
        ashOfWar(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        ashOfWar(name: $name) {
          id
          name
          image
          description
        }
      }
    `},creature:{allNames:qV`
      query {
        creature(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        creature(name: $name) {
          id
          name
          image
          description
        }
      }
    `},incantation:{allNames:qV`
      query {
        incantation(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        incantation(name: $name) {
          id
          name
          image
          description
        }
      }
    `},item:{allNames:qV`
      query {
        item(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        item(name: $name) {
          id
          name
          image
          description
        }
      }
    `},sorcery:{allNames:qV`
      query {
        sorcery(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        sorcery(name: $name) {
          id
          name
          image
          description
        }
      }
    `},spirit:{allNames:qV`
      query {
        spirit(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        spirit(name: $name) {
          id
          name
          image
          description
        }
      }
    `},talisman:{allNames:qV`
      query {
        talisman(limit: -1) {
          name
        }
      }
    `,details:qV`
      query SearchItems($name: String!) {
        talisman(name: $name) {
          id
          name
          image
          description
        }
      }
    `}},XV=new WV("https://eldenring.fanapis.com/api/graphql"),JV=async t=>{try{const e=(await XV.request($V[t].allNames))[t];return[...new Set(e.map((t=>t.name)))]}catch(e){throw console.error("Errore nel recupero dei dati:",e),e}},YV=new WV("https://eldenring.fanapis.com/api/graphql"),ZV=e=>{let{onUpdateNode:n,selectedNodeData:r}=e;const[i,s]=(0,t.useState)(""),[o,a]=(0,t.useState)([]),[l,c]=(0,t.useState)(""),[u,h]=(0,t.useState)("default"),[d,p]=(0,t.useState)(""),[f,m]=(0,t.useState)(""),[g,v]=(0,t.useState)(""),[y,_]=(0,t.useState)("");(0,t.useEffect)((()=>{r?(c(r.setItemType||""),s(r.label||""),_(r.notes||""),m(r.image||""),v(r.description||"")):(c(""),s(""),m(""),v(""),_(""))}),[r]);return(0,ke.jsxs)("aside",{className:"sidebar common-style",children:[(0,ke.jsxs)("div",{className:"section",children:[(0,ke.jsx)("h3",{children:"Select Object Type"}),(0,ke.jsx)("label",{htmlFor:"itemType",children:"Choose a type (e.g., NPC, Boss, Item):"}),(0,ke.jsxs)("select",{id:"itemType",value:l,onChange:async t=>{const e=t.target.value;c(e),s(""),a([]);const n=await JV(e);a(n)},className:"input-dropdown",children:[(0,ke.jsx)("option",{value:"",disabled:!0,children:"Select a type"}),(0,ke.jsx)("option",{value:"ammo",children:"Ammo"}),(0,ke.jsx)("option",{value:"armor",children:"Armor"}),(0,ke.jsx)("option",{value:"ashOfWar",children:"Ash Of War"}),(0,ke.jsx)("option",{value:"boss",children:"Boss"}),(0,ke.jsx)("option",{value:"creature",children:"Creature"}),(0,ke.jsx)("option",{value:"incantation",children:"Incantation"}),(0,ke.jsx)("option",{value:"item",children:"Item"}),(0,ke.jsx)("option",{value:"npc",children:"NPC"}),(0,ke.jsx)("option",{value:"shield",children:"Shield"}),(0,ke.jsx)("option",{value:"sorcery",children:"Sorcery"}),(0,ke.jsx)("option",{value:"spirit",children:"Spirit"}),(0,ke.jsx)("option",{value:"talisman",children:"Talisman"}),(0,ke.jsx)("option",{value:"weapon",children:"Weapon"})]}),(0,ke.jsx)("label",{children:"Search by name:"}),(0,ke.jsx)(Be(),{getItemValue:t=>t,items:o,renderItem:(t,e)=>(0,ke.jsx)("div",{className:"autocomplete-item "+(e?"highlighted":""),children:t},t),value:i,onChange:t=>{const e=t.target.value;if(s(e),e.length>2){const t=o.filter((t=>t.toLowerCase().includes(e.toLowerCase())));a(t)}else JV(l).then((t=>{a(t)}))},onSelect:async t=>{s(t);const e=await(async(t,e)=>{try{return await YV.request($V[t].details,{name:e})}catch(n){throw console.error("Error fetching item details:",n),n}})(l,t),n=e[l][0];n&&(p(n.name?n.name:""),m(n.image?n.image:""),v(n.description?n.description:""),_(""))},inputProps:{className:"autocomplete-input",placeholder:"Type to search..."},wrapperStyle:{position:"relative"}})]}),(0,ke.jsxs)("div",{className:"section",children:[(0,ke.jsx)("h3",{children:"Node Details"}),(0,ke.jsx)("input",{type:"text",placeholder:"Node Title",value:d,onChange:t=>p(t.target.value),className:"input-text"}),(0,ke.jsx)("input",{type:"text",placeholder:"Image URL (Optional)",value:f,onChange:t=>m(t.target.value),className:"input-text"}),(0,ke.jsx)("input",{type:"text",placeholder:"Description (Auto-filled)",value:g,onChange:t=>v(t.target.value),className:"input-text"}),(0,ke.jsx)("input",{type:"text",placeholder:"Additional Notes (Optional)",value:y,onChange:t=>_(t.target.value),className:"input-text"}),(0,ke.jsx)("button",{onClick:()=>{n({name:d,image:f,description:g,notes:y,type:u})},className:"btn",children:"Update Node"})]}),(0,ke.jsxs)("div",{className:"section",children:[(0,ke.jsx)("h3",{children:"Node Settings"}),(0,ke.jsx)("label",{children:"Node Type:"}),(0,ke.jsxs)("select",{className:"input-dropdown",onChange:t=>h(t.target.value),value:u,children:[(0,ke.jsx)("option",{value:"input",children:"Input Node"}),(0,ke.jsx)("option",{value:"default",children:"Default Node"}),(0,ke.jsx)("option",{value:"output",children:"Output Node"})]})]}),(0,ke.jsxs)("div",{className:"section",children:[(0,ke.jsx)("h3",{children:"Custom Node"}),(0,ke.jsx)("p",{children:"Drag and drop this custom node to the pane on the right."}),(0,ke.jsxs)("div",{className:"dndnode-sidebar",onDragStart:t=>{const e={type:u,name:d,image:f,description:g,notes:y};t.dataTransfer.setData("application/reactflow",JSON.stringify(e)),t.dataTransfer.effectAllowed="move"},draggable:!0,children:[(0,ke.jsx)("img",{src:"https://p325k7wa.twic.pics/high/elden-ring/elden-ring/02-screenshots/ELDENRING_14_4K.jpg",alt:"Node Icon"}),(0,ke.jsx)("div",{className:"node-title",children:"Default Node"}),(0,ke.jsx)("div",{className:"node-description",children:"An example of a node"})]})]}),(0,ke.jsx)("div",{className:"btn-container",children:(0,ke.jsx)("button",{onClick:async function(){const{error:t}=await Oe.auth.signOut();t?console.error("Logout failed:",t):window.location.href="/react-elden-ring-mind-map/login"},className:"btn",children:"LogOut"})})]})},KV=t=>{let{data:e}=t;return(0,ke.jsxs)("div",{className:"custom-node",children:[(0,ke.jsx)("button",{onClick:e.onDelete,className:"delete-node-button",children:"X"}),(0,ke.jsx)("strong",{className:"custom-node-label",children:e.label}),e.image&&(0,ke.jsx)("img",{src:e.image,alt:e.label,className:"custom-node-image"}),e.description&&(0,ke.jsx)("p",{className:"custom-node-description",children:e.description}),e.notes&&(0,ke.jsx)("p",{className:"custom-node-notes",children:e.notes}),"input"===e.nodeType&&(0,ke.jsx)(xz,{type:"source",position:"bottom"}),"output"===e.nodeType&&(0,ke.jsx)(xz,{type:"target",position:"top"}),"default"===e.nodeType&&(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)(xz,{type:"target",position:"top"}),(0,ke.jsx)(xz,{type:"source",position:"bottom"})]})]})},QV={customNode:KV},tH=e=>{const{isReady:n,subscribe:r,unsubscribe:i,publish:s}=function(e){const[n,r]=(0,t.useState)(!1),[i,s]=(0,t.useState)(!1),{component:o,room:a,...l}=zn("realtime"),c=(0,t.useRef)({}),u=(0,t.useRef)(null);(0,t.useEffect)((()=>{if(o){if(o.state===Cn.S.STARTED)return void r(!0);o.subscribe("realtime-component.state-changed",(t=>{r(t===Cn.S.STARTED)}))}}),[o,c.current]),(0,t.useEffect)((()=>{(async()=>{if((n||u.current)&&o){if(u.current=await o.connect(e),"CONNECTED"===u.current.state)return void s(!0);u.current.subscribe("realtime-channel.state-changed",(t=>{s("CONNECTED"===t)}))}})()}),[n]),(0,t.useEffect)((()=>{u.current&&!a&&(u.current.disconnect(),u.current=null,s(!1),r(!1))}),[o,a]),(0,t.useEffect)((()=>{i&&Object.keys(c.current).length&&(Object.entries(c.current).forEach((t=>{let[e,n]=t;n.forEach((t=>{u.current.subscribe(e,t)}))})),c.current={})}),[i]);const h=(0,t.useCallback)(((t,e)=>{if(u.current)u.current.subscribe(t,e);else{const n=c.current[t]||[];c.current[t]=n.includes(e)?n:[...n,e]}}),[o,l,c.current]),d=(0,t.useCallback)(((t,e)=>{!n||!i||u.current.publish(t,e)}),[o,l,n]),p=(0,t.useCallback)(((t,e)=>{!n||!i||u.current.unsubscribe(t,e)}),[o,l,n]),f=(0,t.useCallback)((async t=>n?i?await u.current.fetchHistory(t):(console.warn(`[SuperViz] Channel ${e} is not ready - try again later`),Promise.resolve(null)):(console.warn("[SuperViz] Realtime component is not ready - try again later"),Promise.resolve(null))),[o,l,n]);return(0,t.useMemo)((()=>({isReady:i&&n,publish:d,subscribe:h,unsubscribe:p,fetchHistory:f})),[o,l,n,i])}("default"),o=(0,t.useRef)(null),{nodes:a,setNodes:l,edges:c,setEdges:u}=ze(),[h,d,p]=OF([]),[f,m,g]=kF([]),[v,y]=(0,t.useState)(null),[_,b]=(0,t.useState)(),[x,w]=(0,t.useState)(null),[S,M]=(0,t.useState)(!1),E=(0,t.useRef)(!1);(0,t.useEffect)((()=>{S||(0===a.length&&0===c.length?(d([]),m([])):(console.log("Aggiungo un nuovo useffect:"),d(a),m(c)))}),[a,c,d,m]);const T=(0,t.useCallback)(((t,e)=>{M(!1),console.log("Pubblico evento node-drag:",e),s("node-drag",{node:e})}),[s]),A=(0,t.useCallback)((t=>{const e={...t,animated:!1,type:"bezier"};console.log("Aggiungo un nuovo edge:",e),m((t=>ez(e,t))),u((t=>ez(e,t))),console.log("Pubblico evento new-edge:",e),s("new-edge",{edge:e})}),[u,m,s]),C=(0,t.useCallback)((t=>{console.log("Elimino nodo:",t),d((e=>e.filter((e=>e.id!==t)))),m((e=>e.filter((e=>e.source!==t&&e.target!==t)))),l((e=>e.filter((e=>e.id!==t)))),u((e=>e.filter((e=>e.source!==t&&e.target!==t)))),console.log("Pubblico evento delete-node:",t),s("delete-node",{nodeId:t})}),[d,m,l,u,s]);(0,t.useEffect)((()=>{if(!n||E.current)return;console.log("Connesso alla stanza realtime");return(()=>{const t=document.querySelector(".react-flow__controls-fitview");null===t||void 0===t||t.click()})(),r("new-edge",(t=>{let{data:n,participantId:r}=t;console.log("Evento new-edge ricevuto da:",r),console.log("Participant ID corrente:",e),r!==e&&(console.log("Aggiorno edges con:",n.edge),m((t=>ez(n.edge,t))),u((t=>ez(n.edge,t))))})),r("node-drag",(t=>{let{data:n,participantId:r}=t;console.log("Evento node-drag ricevuto da:",r),r!==e&&(console.log("Aggiorno nodi con:",n.node),d((t=>{const e=t.some((t=>t.id===n.node.id));return e?t.map((t=>t.id===n.node.id?{...n.node}:t)):(console.log("Nodo non trovato, aggiungo nuovo nodo:",n.node),[...t,n.node])})),l((t=>{const e=t.some((t=>t.id===n.node.id));return e?t.map((t=>t.id===n.node.id?{...n.node}:t)):(console.log("Nodo non trovato in initialNodes, aggiungo nuovo nodo:",n.node),[...t,n.node])})))})),E.current=!0,()=>{i("new-edge"),i("node-drag")}}),[n,m,d,r,i,e]);const P=(0,t.useCallback)((t=>{t.preventDefault();const e=o.current.getBoundingClientRect(),n=JSON.parse(t.dataTransfer.getData("application/reactflow"));if(!n)return;const r=v.project({x:t.clientX-e.left,y:t.clientY-e.top}),i=oB(),a={id:i,type:"customNode",position:r,data:{label:n.name||`${n.type} node`,image:n.image,notes:n.notes,description:n.description,nodeType:n.type,onDelete:()=>C(i)}};console.log("Aggiungo nuovo nodo:",a),d((t=>[...t,a])),l((t=>[...t,a])),console.log("Pubblico evento node-drag:",a),s("node-drag",{node:a})}),[v,l,d,C,s]),I=(0,t.useCallback)((t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"}),[]);return(0,ke.jsx)("div",{className:"dndflow",children:(0,ke.jsxs)(SF,{children:[(0,ke.jsx)("div",{id:"react-flow-container",className:"reactflow-wrapper",ref:o,children:(0,ke.jsxs)(RF,{nodes:h,edges:f,onNodesChange:p,onEdgesChange:g,onNodeClick:(t,e)=>{S||(b(e.id),w(e.data))},onNodeDragStart:()=>{M(!0)},onNodeDragStop:T,onConnect:A,onInit:y,onDrop:P,onDragOver:I,fitView:!0,nodeTypes:QV,children:[(0,ke.jsx)(jF,{color:"#f1f1f1",variant:DF.Dots}),(0,ke.jsx)(KF,{})]})}),(0,ke.jsx)(ZV,{selectedNodeData:x,onUpdateNode:t=>{const e=h.map((e=>{if(e.id===_){const n={...e,data:{...e.data,label:t.name,image:t.image,description:t.description,notes:t.notes,nodeType:t.type,onDelete:()=>C(e.id)}};return console.log("Pubblico evento node-update:",n),s("node-update",{node:n}),n}return e}));d(e)}})]})})};function eH(){return eH=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},eH.apply(this,arguments)}var nH;!function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"}(nH||(nH={}));const rH="popstate";function iH(t,e){if(!1===t||null===t||"undefined"===typeof t)throw new Error(e)}function sH(t,e){if(!t){"undefined"!==typeof console&&console.warn(e);try{throw new Error(e)}catch(jR){}}}function oH(t,e){return{usr:t.state,key:t.key,idx:e}}function aH(t,e,n,r){return void 0===n&&(n=null),eH({pathname:"string"===typeof t?t:t.pathname,search:"",hash:""},"string"===typeof e?cH(e):e,{state:n,key:e&&e.key||r||Math.random().toString(36).substr(2,8)})}function lH(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&"?"!==n&&(e+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(e+="#"===r.charAt(0)?r:"#"+r),e}function cH(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function uH(t,e,n,r){void 0===r&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a=nH.Pop,l=null,c=u();function u(){return(o.state||{idx:null}).idx}function h(){a=nH.Pop;let t=u(),e=null==t?null:t-c;c=t,l&&l({action:a,location:p.location,delta:e})}function d(t){let e="null"!==i.location.origin?i.location.origin:i.location.href,n="string"===typeof t?t:lH(t);return n=n.replace(/ $/,"%20"),iH(e,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,e)}null==c&&(c=0,o.replaceState(eH({},o.state,{idx:c}),""));let p={get action(){return a},get location(){return t(i,o)},listen(t){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(rH,h),l=t,()=>{i.removeEventListener(rH,h),l=null}},createHref:t=>e(i,t),createURL:d,encodeLocation(t){let e=d(t);return{pathname:e.pathname,search:e.search,hash:e.hash}},push:function(t,e){a=nH.Push;let r=aH(p.location,t,e);n&&n(r,t),c=u()+1;let h=oH(r,c),d=p.createHref(r);try{o.pushState(h,"",d)}catch(f){if(f instanceof DOMException&&"DataCloneError"===f.name)throw f;i.location.assign(d)}s&&l&&l({action:a,location:p.location,delta:1})},replace:function(t,e){a=nH.Replace;let r=aH(p.location,t,e);n&&n(r,t),c=u();let i=oH(r,c),h=p.createHref(r);o.replaceState(i,"",h),s&&l&&l({action:a,location:p.location,delta:0})},go:t=>o.go(t)};return p}var hH;!function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"}(hH||(hH={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function dH(t,e,n){return void 0===n&&(n="/"),pH(t,e,n,!1)}function pH(t,e,n,r){let i=AH(("string"===typeof e?cH(e):e).pathname||"/",n);if(null==i)return null;let s=fH(t);!function(t){t.sort(((t,e)=>t.score!==e.score?e.score-t.score:function(t,e){let n=t.length===e.length&&t.slice(0,-1).every(((t,n)=>t===e[n]));return n?t[t.length-1]-e[e.length-1]:0}(t.routesMeta.map((t=>t.childrenIndex)),e.routesMeta.map((t=>t.childrenIndex)))))}(s);let o=null;for(let a=0;null==o&&a<s.length;++a){let t=TH(i);o=MH(s[a],t,r)}return o}function fH(t,e,n,r){void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===r&&(r="");let i=(t,i,s)=>{let o={relativePath:void 0===s?t.path||"":s,caseSensitive:!0===t.caseSensitive,childrenIndex:i,route:t};o.relativePath.startsWith("/")&&(iH(o.relativePath.startsWith(r),'Absolute route path "'+o.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(r.length));let a=LH([r,o.relativePath]),l=n.concat(o);t.children&&t.children.length>0&&(iH(!0!==t.index,'Index routes must not have child routes. Please remove all child routes from route path "'+a+'".'),fH(t.children,e,l,a)),(null!=t.path||t.index)&&e.push({path:a,score:SH(a,t.index),routesMeta:l})};return t.forEach(((t,e)=>{var n;if(""!==t.path&&null!=(n=t.path)&&n.includes("?"))for(let r of mH(t.path))i(t,e,r);else i(t,e)})),e}function mH(t){let e=t.split("/");if(0===e.length)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(0===r.length)return i?[s,""]:[s];let o=mH(r.join("/")),a=[];return a.push(...o.map((t=>""===t?s:[s,t].join("/")))),i&&a.push(...o),a.map((e=>t.startsWith("/")&&""===e?"/":e))}const gH=/^:[\w-]+$/,vH=3,yH=2,_H=1,bH=10,xH=-2,wH=t=>"*"===t;function SH(t,e){let n=t.split("/"),r=n.length;return n.some(wH)&&(r+=xH),e&&(r+=yH),n.filter((t=>!wH(t))).reduce(((t,e)=>t+(gH.test(e)?vH:""===e?_H:bH)),r)}function MH(t,e,n){void 0===n&&(n=!1);let{routesMeta:r}=t,i={},s="/",o=[];for(let a=0;a<r.length;++a){let t=r[a],l=a===r.length-1,c="/"===s?e:e.slice(s.length)||"/",u=EH({path:t.relativePath,caseSensitive:t.caseSensitive,end:l},c),h=t.route;if(!u&&l&&n&&!r[r.length-1].route.index&&(u=EH({path:t.relativePath,caseSensitive:t.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),o.push({params:i,pathname:LH([s,u.pathname]),pathnameBase:NH(LH([s,u.pathnameBase])),route:h}),"/"!==u.pathnameBase&&(s=LH([s,u.pathnameBase]))}return o}function EH(t,e){"string"===typeof t&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=function(t,e,n){void 0===e&&(e=!1);void 0===n&&(n=!0);sH("*"===t||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were "'+t.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+t.replace(/\*$/,"/*")+'".');let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((t,e,n)=>(r.push({paramName:e,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));t.endsWith("*")?(r.push({paramName:"*"}),i+="*"===t||"/*"===t?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==t&&"/"!==t&&(i+="(?:(?=\\/|$))");let s=new RegExp(i,e?void 0:"i");return[s,r]}(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce(((t,e,n)=>{let{paramName:r,isOptional:i}=e;if("*"===r){let t=a[n]||"";o=s.slice(0,s.length-t.length).replace(/(.)\/+$/,"$1")}const l=a[n];return t[r]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),t}),{}),pathname:s,pathnameBase:o,pattern:t}}function TH(t){try{return t.split("/").map((t=>decodeURIComponent(t).replace(/\//g,"%2F"))).join("/")}catch(e){return sH(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+e+")."),t}}function AH(t,e){if("/"===e)return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&"/"!==r?null:t.slice(n)||"/"}function CH(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified `to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function PH(t){return t.filter(((t,e)=>0===e||t.route.path&&t.route.path.length>0))}function IH(t,e){let n=PH(t);return e?n.map(((t,e)=>e===n.length-1?t.pathname:t.pathnameBase)):n.map((t=>t.pathnameBase))}function RH(t,e,n,r){let i;void 0===r&&(r=!1),"string"===typeof t?i=cH(t):(i=eH({},t),iH(!i.pathname||!i.pathname.includes("?"),CH("?","pathname","search",i)),iH(!i.pathname||!i.pathname.includes("#"),CH("#","pathname","hash",i)),iH(!i.search||!i.search.includes("#"),CH("#","search","hash",i)));let s,o=""===t||""===i.pathname,a=o?"/":i.pathname;if(null==a)s=n;else{let t=e.length-1;if(!r&&a.startsWith("..")){let e=a.split("/");for(;".."===e[0];)e.shift(),t-=1;i.pathname=e.join("/")}s=t>=0?e[t]:"/"}let l=function(t,e){void 0===e&&(e="/");let{pathname:n,search:r="",hash:i=""}="string"===typeof t?cH(t):t,s=n?n.startsWith("/")?n:function(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach((t=>{".."===t?n.length>1&&n.pop():"."!==t&&n.push(t)})),n.length>1?n.join("/"):"/"}(n,e):e;return{pathname:s,search:OH(r),hash:kH(i)}}(i,s),c=a&&"/"!==a&&a.endsWith("/"),u=(o||"."===a)&&n.endsWith("/");return l.pathname.endsWith("/")||!c&&!u||(l.pathname+="/"),l}const LH=t=>t.join("/").replace(/\/\/+/g,"/"),NH=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),OH=t=>t&&"?"!==t?t.startsWith("?")?t:"?"+t:"",kH=t=>t&&"#"!==t?t.startsWith("#")?t:"#"+t:"";Error;function DH(t){return null!=t&&"number"===typeof t.status&&"string"===typeof t.statusText&&"boolean"===typeof t.internal&&"data"in t}const zH=["post","put","patch","delete"],UH=(new Set(zH),["get",...zH]);new Set(UH),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function FH(){return FH=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},FH.apply(this,arguments)}const BH=t.createContext(null);const VH=t.createContext(null);const HH=t.createContext(null);const jH=t.createContext(null);const WH=t.createContext({outlet:null,matches:[],isDataRoute:!1});const GH=t.createContext(null);function qH(){return null!=t.useContext(jH)}function $H(){return qH()||iH(!1),t.useContext(jH).location}function XH(e){t.useContext(HH).static||t.useLayoutEffect(e)}function JH(){let{isDataRoute:e}=t.useContext(WH);return e?function(){let{router:e}=ij(nj.UseNavigateStable),n=oj(rj.UseNavigateStable),r=t.useRef(!1);XH((()=>{r.current=!0}));let i=t.useCallback((function(t,i){void 0===i&&(i={}),r.current&&("number"===typeof t?e.navigate(t):e.navigate(t,FH({fromRouteId:n},i)))}),[e,n]);return i}():function(){qH()||iH(!1);let e=t.useContext(BH),{basename:n,future:r,navigator:i}=t.useContext(HH),{matches:s}=t.useContext(WH),{pathname:o}=$H(),a=JSON.stringify(IH(s,r.v7_relativeSplatPath)),l=t.useRef(!1);XH((()=>{l.current=!0}));let c=t.useCallback((function(t,r){if(void 0===r&&(r={}),!l.current)return;if("number"===typeof t)return void i.go(t);let s=RH(t,JSON.parse(a),o,"path"===r.relative);null==e&&"/"!==n&&(s.pathname="/"===s.pathname?n:LH([n,s.pathname])),(r.replace?i.replace:i.push)(s,r.state,r)}),[n,i,a,o,e]);return c}()}function YH(e,n,r,i){qH()||iH(!1);let{navigator:s}=t.useContext(HH),{matches:o}=t.useContext(WH),a=o[o.length-1],l=a?a.params:{},c=(a&&a.pathname,a?a.pathnameBase:"/");a&&a.route;let u,h=$H();if(n){var d;let t="string"===typeof n?cH(n):n;"/"===c||(null==(d=t.pathname)?void 0:d.startsWith(c))||iH(!1),u=t}else u=h;let p=u.pathname||"/",f=p;if("/"!==c){let t=c.replace(/^\//,"").split("/");f="/"+p.replace(/^\//,"").split("/").slice(t.length).join("/")}let m=dH(e,{pathname:f});let g=ej(m&&m.map((t=>Object.assign({},t,{params:Object.assign({},l,t.params),pathname:LH([c,s.encodeLocation?s.encodeLocation(t.pathname).pathname:t.pathname]),pathnameBase:"/"===t.pathnameBase?c:LH([c,s.encodeLocation?s.encodeLocation(t.pathnameBase).pathname:t.pathnameBase])}))),o,r,i);return n&&g?t.createElement(jH.Provider,{value:{location:FH({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:nH.Pop}},g):g}function ZH(){let e=function(){var e;let n=t.useContext(GH),r=sj(rj.UseRouteError),i=oj(rj.UseRouteError);if(void 0!==n)return n;return null==(e=r.errors)?void 0:e[i]}(),n=DH(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:i};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:s},r):null,null)}const KH=t.createElement(ZH,null);class QH extends t.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||"idle"!==e.revalidation&&"idle"===t.revalidation?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:void 0!==t.error?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return void 0!==this.state.error?t.createElement(WH.Provider,{value:this.props.routeContext},t.createElement(GH.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function tj(e){let{routeContext:n,match:r,children:i}=e,s=t.useContext(BH);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(WH.Provider,{value:n},i)}function ej(e,n,r,i){var s;if(void 0===n&&(n=[]),void 0===r&&(r=null),void 0===i&&(i=null),null==e){var o;if(!r)return null;if(r.errors)e=r.matches;else{if(!(null!=(o=i)&&o.v7_partialHydration&&0===n.length&&!r.initialized&&r.matches.length>0))return null;e=r.matches}}let a=e,l=null==(s=r)?void 0:s.errors;if(null!=l){let t=a.findIndex((t=>t.route.id&&void 0!==(null==l?void 0:l[t.route.id])));t>=0||iH(!1),a=a.slice(0,Math.min(a.length,t+1))}let c=!1,u=-1;if(r&&i&&i.v7_partialHydration)for(let t=0;t<a.length;t++){let e=a[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=t),e.route.id){let{loaderData:t,errors:n}=r,i=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||i){c=!0,a=u>=0?a.slice(0,u+1):[a[0]];break}}}return a.reduceRight(((e,i,s)=>{let o,h=!1,d=null,p=null;var f;r&&(o=l&&i.route.id?l[i.route.id]:void 0,d=i.route.errorElement||KH,c&&(u<0&&0===s?(f="route-fallback",!1||aj[f]||(aj[f]=!0),h=!0,p=null):u===s&&(h=!0,p=i.route.hydrateFallbackElement||null)));let m=n.concat(a.slice(0,s+1)),g=()=>{let n;return n=o?d:h?p:i.route.Component?t.createElement(i.route.Component,null):i.route.element?i.route.element:e,t.createElement(tj,{match:i,routeContext:{outlet:e,matches:m,isDataRoute:null!=r},children:n})};return r&&(i.route.ErrorBoundary||i.route.errorElement||0===s)?t.createElement(QH,{location:r.location,revalidation:r.revalidation,component:d,error:o,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}var nj=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(nj||{}),rj=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(rj||{});function ij(e){let n=t.useContext(BH);return n||iH(!1),n}function sj(e){let n=t.useContext(VH);return n||iH(!1),n}function oj(e){let n=function(){let e=t.useContext(WH);return e||iH(!1),e}(),r=n.matches[n.matches.length-1];return r.route.id||iH(!1),r.route.id}const aj={};e.startTransition;function lj(e){let{to:n,replace:r,state:i,relative:s}=e;qH()||iH(!1);let{future:o,static:a}=t.useContext(HH),{matches:l}=t.useContext(WH),{pathname:c}=$H(),u=JH(),h=RH(n,IH(l,o.v7_relativeSplatPath),c,"path"===s),d=JSON.stringify(h);return t.useEffect((()=>u(JSON.parse(d),{replace:r,state:i,relative:s})),[u,d,s,r,i]),null}function cj(t){iH(!1)}function uj(e){let{basename:n="/",children:r=null,location:i,navigationType:s=nH.Pop,navigator:o,static:a=!1,future:l}=e;qH()&&iH(!1);let c=n.replace(/^\/*/,"/"),u=t.useMemo((()=>({basename:c,navigator:o,static:a,future:FH({v7_relativeSplatPath:!1},l)})),[c,l,o,a]);"string"===typeof i&&(i=cH(i));let{pathname:h="/",search:d="",hash:p="",state:f=null,key:m="default"}=i,g=t.useMemo((()=>{let t=AH(h,c);return null==t?null:{location:{pathname:t,search:d,hash:p,state:f,key:m},navigationType:s}}),[c,h,d,p,f,m,s]);return null==g?null:t.createElement(HH.Provider,{value:u},t.createElement(jH.Provider,{children:r,value:g}))}function hj(t){let{children:e,location:n}=t;return YH(dj(e),n)}new Promise((()=>{}));t.Component;function dj(e,n){void 0===n&&(n=[]);let r=[];return t.Children.forEach(e,((e,i)=>{if(!t.isValidElement(e))return;let s=[...n,i];if(e.type===t.Fragment)return void r.push.apply(r,dj(e.props.children,s));e.type!==cj&&iH(!1),e.props.index&&e.props.children&&iH(!1);let o={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=dj(e.props.children,s)),r.push(o)})),r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(jR){}new Map;const pj=e.startTransition;jk.flushSync,e.useId;function fj(e){let{basename:n,children:r,future:i,window:s}=e,o=t.useRef();var a;null==o.current&&(o.current=(void 0===(a={window:s,v5Compat:!0})&&(a={}),uH((function(t,e){let{pathname:n,search:r,hash:i}=t.location;return aH("",{pathname:n,search:r,hash:i},e.state&&e.state.usr||null,e.state&&e.state.key||"default")}),(function(t,e){return"string"===typeof e?e:lH(e)}),null,a)));let l=o.current,[c,u]=t.useState({action:l.action,location:l.location}),{v7_startTransition:h}=i||{},d=t.useCallback((t=>{h&&pj?pj((()=>u(t))):u(t)}),[u,h]);return t.useLayoutEffect((()=>l.listen(d)),[l,d]),t.createElement(uj,{basename:n,children:r,location:c.location,navigationType:c.action,navigator:l,future:i})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var mj,gj;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(mj||(mj={})),function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"}(gj||(gj={}));const vj=()=>{const[e,n]=(0,t.useState)(""),[r,i]=(0,t.useState)("");return(0,ke.jsx)("div",{className:"login-page",children:(0,ke.jsxs)("div",{className:"login-container",children:[(0,ke.jsx)("h2",{className:"login-title",children:"Login"}),(0,ke.jsxs)("form",{onSubmit:async t=>{t.preventDefault();const{data:n,error:i}=await Oe.auth.signInWithPassword({email:e,password:r});i?console.error("Errore di login:",i.message):window.location.href="/react-elden-ring-mind-map"},className:"login-form",children:[(0,ke.jsx)("input",{type:"email",placeholder:"Email",value:e,onChange:t=>n(t.target.value),className:"login-input"}),(0,ke.jsx)("input",{type:"password",placeholder:"Password",value:r,onChange:t=>i(t.target.value),className:"login-input"}),(0,ke.jsx)("button",{type:"submit",className:"login-button",children:"Login"})]})]})})},yj=e=>{let{children:n}=e;const[r,i]=(0,t.useState)(null),[s,o]=(0,t.useState)(!0);return(0,t.useEffect)((()=>{(async()=>{const{data:t}=await Oe.auth.getSession();i(t.session),o(!1)})()}),[]),s?(0,ke.jsx)("div",{children:"Loading..."}):r?n:(0,ke.jsx)(lj,{to:"/login",replace:!0})};function _j(e){let{participantId:n}=e;const{x:r,y:i,zoom:s}=nD(LF,eL),{openThreads:o}=function(){const{component:e,...n}=zn("comments");return(0,t.useMemo)((()=>e?{isReady:!0,openThreads:()=>{e.openThreads()},closeThreads:()=>{e.closeThreads()},enable:()=>{e.enable()},disable:()=>{e.disable()}}:{isReady:!1,openThreads:()=>{},closeThreads:()=>{},enable:()=>{},disable:()=>{}}),[e,n.room,n.activeComponents])}(),{pin:a}=function(e){let{containerId:n,...r}=e;const{room:i}=zn(),[s,o]=(0,t.useState)(!1);return(0,t.useEffect)((()=>{!i&&jR&&(jR=null,o(!1))}),[i]),(0,t.useMemo)((()=>n&&document.getElementById(n)?(jR||(jR=new Cn.R(n,r),o(!0)),{pin:jR,destroy:()=>{null==jR||jR.destroy(),o(!1)}}):{pin:null,destroy:()=>{}}),[n,i,s])}({containerId:"react-flow-container",dataAttributeName:"data-id",dataAttributeValueFilters:[/.*null-(target|source)$/]}),{transform:l}=function(){const{component:e,room:n,...r}=zn("presence"),i=(0,t.useRef)(null),[s,o]=(0,t.useState)(!1);(0,t.useEffect)((()=>{e&&(i.current=e,o(!0)),!n&&s&&(i.current=null,o(!1))}),[e]);const a=(0,t.useCallback)((t=>{i.current&&i.current.transform(t)}),[i.current]);return(0,t.useMemo)((()=>({isReady:s,transform:a})),[n,r.activeComponents,e,s])}();return(0,t.useEffect)((()=>{l&&l({translate:{x:r,y:i},scale:s})}),[r,i,s,l]),(0,t.useEffect)((()=>{const t=document.querySelector(".react-flow__pane");t&&t.setAttribute("data-superviz-id","plane")}),[]),(0,ke.jsxs)(ke.Fragment,{children:[(0,ke.jsx)("div",{id:"comments"}),(0,ke.jsx)(ix,{}),(0,ke.jsx)(HR,{position:"bottom-right"}),(0,ke.jsx)(A_,{pin:a,onPinActive:()=>{o()},onMount:()=>{o()},position:"left"}),(0,ke.jsx)(rx,{elementId:"react-flow-container",transform:{translate:{x:r,y:i},scale:s}}),(0,ke.jsx)(tH,{participantId:n})]})}const bj={appContainer:{display:"flex",flexDirection:"column",height:"100vh"},mainContent:{marginTop:"60px",flexGrow:1,display:"flex",overflow:"auto"}},xj=()=>{const[e,n]=(0,t.useState)(null);return(0,t.useEffect)((()=>{(async()=>{const{data:{user:t}}=await Oe.auth.getUser();n(null===t||void 0===t?void 0:t.email)})();const{subscription:t}=Oe.auth.onAuthStateChange(((t,e)=>{"SIGNED_OUT"===t||null===e?n(null):"SIGNED_IN"===t&&null!==e&&void 0!==e&&e.user&&n(e.user.email)}));return()=>null===t||void 0===t?void 0:t.unsubscribe()}),[]),(0,ke.jsx)(Ue,{children:(0,ke.jsx)(fj,{basename:"/react-elden-ring-mind-map",children:(0,ke.jsxs)(hj,{children:[(0,ke.jsx)(cj,{path:"/login",element:(0,ke.jsx)(vj,{})}),(0,ke.jsx)(cj,{path:"/",element:(0,ke.jsx)(yj,{children:(0,ke.jsx)(Un,{developerKey:"96ai280e79vr8qgpw42kk8gj7gixre",group:{id:"demos-react-flow-group",name:"Demos: React Flow"},participant:{id:e,name:e?`${e} Participant`:"Unknown Participant"},roomId:"react-flow-demo",children:(0,ke.jsx)(SF,{children:(0,ke.jsx)(Ue,{children:(0,ke.jsxs)("div",{style:bj.appContainer,children:[(0,ke.jsx)(GR,{}),(0,ke.jsx)("div",{style:bj.mainContent,children:(0,ke.jsx)(_j,{participantId:e})})]})})})})})})]})})})},wj=t=>{t&&t instanceof Function&&n.e(453).then(n.bind(n,6453)).then((e=>{let{getCLS:n,getFID:r,getFCP:i,getLCP:s,getTTFB:o}=e;n(t),r(t),i(t),s(t),o(t)}))};r.createRoot(document.getElementById("root")).render((0,ke.jsx)(t.StrictMode,{children:(0,ke.jsx)(xj,{})})),wj()})()})();
//# sourceMappingURL=main.5baac1a2.js.map